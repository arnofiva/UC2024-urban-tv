import{aj as e,ak as r,am as g,aQ as V,h0 as S,e3 as U,bj as x,h$ as H,aL as I,dV as w,aM as O}from"./index-b9c5f9ae.js";import{l as _}from"./LayerView3D-2a51d3a6.js";import{y as C}from"./LayerView-fa457db7.js";const u=Symbol(),N=f=>{let a=class extends f{constructor(){super(...arguments),this.layerViews=new V,this._debouncedUpdate=S(async()=>{const{layer:i,parent:n}=this,d=n?.footprintLayerView;let o=[];const p=this._createQuery();if(p&&d){const{features:h}=await d.queryFeatures(p);this.suspended||(o=h.map(m=>i.acquireLayer(m)))}this.removeHandles(u),this.addHandles(o,u)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(i=>i.updating)}enableLayerUpdates(){return U([this._updatingHandles.addWhen(()=>this.parent?.footprintLayerView?.dataUpdating===!1,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),x(()=>this.removeHandles(u))])}updateLayers(){this.suspended?this.removeHandles(u):this._updatingHandles.addPromise(H(this._debouncedUpdate()).catch(i=>{I.getLogger(this).error(i)}))}_createQuery(){const i=this.parent?.footprintLayerView,n=this.layer?.parent;if(!i||!n||n.destroyed)return null;const{layer:{maximumVisibleSublayers:d},view:{scale:o}}=this;if(!d)return null;const{itemTypeField:p,itemSourceField:h,itemNameField:m,minScaleField:c,maxScaleField:L,objectIdField:$,orderBy:v}=n,b=w(`${c} IS NULL OR ${o} <= ${c} OR ${c} = 0`,`${L} IS NULL OR ${o} >= ${L}`),l=v?.find(y=>y.field&&!y.valueExpression),t=i.createQuery();if(t.returnGeometry=!1,t.num=d,t.outFields=[$,h,m],t.where=w(t.where,b),this.unsupportedItemTypes!=null){const y=`${p} NOT IN (${this.unsupportedItemTypes.map(F=>`'${F}'`)})`;t.where=w(t.where,y)}return l?.field&&(t.orderByFields=[`${l.field} ${l.order==="descending"?"DESC":"ASC"}`],t.outFields.push(l.field)),t}};return e([r({readOnly:!0})],a.prototype,"creatingLayerViews",null),e([r()],a.prototype,"layer",void 0),e([r()],a.prototype,"layerViews",void 0),e([r({readOnly:!0})],a.prototype,"unsupportedItemTypes",void 0),e([r()],a.prototype,"parent",void 0),e([r({readOnly:!0})],a.prototype,"isUpdating",null),a=e([g("esri.views.layers.CatalogDynamicGroupLayerView")],a),a};let s=class extends N(_(C)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new V}initialize(){this.addHandles([this.enableLayerUpdates(),O(()=>this.view.stationary,()=>this.updateLayers())])}};e([r()],s.prototype,"layerViews",void 0),e([r()],s.prototype,"parent",void 0),e([r()],s.prototype,"view",void 0),s=e([g("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],s);const E=s;export{E as default};
