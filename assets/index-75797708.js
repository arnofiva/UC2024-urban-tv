(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();function d(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function JAt(t,e){return function(i,r){e(i,r,t)}}function QAt(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}let __;function se(t){return typeof __[t]=="function"?__[t]=__[t](globalThis):__[t]}__=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},se.add=(t,e,i,r)=>((r||__[t]===void 0)&&(__[t]=e),i&&se(t)),se.cache=__,se.add("big-integer-warning-enabled",!0),se.add("esri-deprecation-warnings",!0),se.add("esri-tests-disable-screenshots",!1),se.add("esri-tests-use-full-window",!1),se.add("esri-tests-post-to-influx",!0),(()=>{se.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(se.add("host-browser",t),se.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),se.add("dom",t),se("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,s=parseFloat(r);if(se.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),se.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),se.add("khtml",r.includes("Konqueror")?s:void 0),se.add("edge",parseFloat(i.split("Edge/")[1])||void 0),se.add("opr",parseFloat(i.split("OPR/")[1])||void 0),se.add("webkit",!se("wp")&&!se("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),se.add("chrome",!se("edge")&&!se("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),se.add("android",!se("wp")&&parseFloat(i.split("Android ")[1])||void 0),se.add("safari",!r.includes("Safari")||se("wp")||se("chrome")||se("android")||se("edge")||se("opr")?void 0:parseFloat(r.split("Version/")[1])),se.add("mac",r.includes("Macintosh")),!se("wp")&&/(iPhone|iPod|iPad)/.test(i)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));se.add(n,a),se.add("ios",a)}se("webkit")||(!i.includes("Gecko")||se("wp")||se("khtml")||se("edge")||se.add("mozilla",s),se("mozilla")&&se.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&se.add("esri-mobile",e),i&&se.add("esri-iPhone",i),se.add("esri-geolocation",!!navigator.geolocation)}se.add("esri-wasm","WebAssembly"in globalThis),se.add("esri-performance-mode-frames-between-render",20),se.add("esri-force-performance-mode",!1),se.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),se.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),se.add("esri-atomics","Atomics"in globalThis),se.add("esri-workers","Worker"in globalThis),se.add("web-feat:cache","caches"in globalThis),se.add("esri-workers-arraybuffer-transfer",!se("safari")||Number(se("safari"))>=12),se.add("workers-pool-size",8),se.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),se.add("featurelayer-simplify-payload-size-factors",[1,1,4]),se.add("featurelayer-fast-triangulation-enabled",!0),se.add("featurelayer-animation-enabled",!0),se.add("featurelayer-snapshot-enabled",!0),se.add("featurelayer-snapshot-point-min-threshold",8e4),se.add("featurelayer-snapshot-point-max-threshold",4e5),se.add("featurelayer-snapshot-point-coverage",.1),se.add("featurelayer-query-max-depth",4),se.add("featurelayer-query-pausing-enabled",!1),se.add("featurelayer-advanced-symbols",!1),se.add("featurelayer-pbf",!0),se.add("featurelayer-pbf-statistics",!1),se.add("feature-layers-workers",!0),se.add("feature-polyline-generalization-factor",1),se.add("mapview-transitions-duration",200),se.add("mapview-essential-goto-duration",200),se.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),se.add("mapserver-pbf-version-support",10.81),se.add("mapservice-popup-identify-max-tolerance",20),se("host-webworker")||se("host-browser")&&(se.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),se.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{se.add("esri-image-decode",!0,!0,!0)}).catch(()=>{se.add("esri-image-decode",!1,!0,!0)})}return!1}),se.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let Yb=class S1{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*S1._m}getInt(){return this._seed=(S1._a*this._seed+S1._c)%S1._m,this._seed}getFloat(){return this.getInt()/(S1._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/S1._m*r}};Yb._m=2147483647,Yb._a=48271,Yb._c=0;const Z5=1.5,IRe=1/Z5,LRe=.5;function J5(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function s0(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Ide(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function H6(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function DRe(t){return t&&typeof t.length=="number"}function KAt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function eMt(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let Lde=class{constructor(){this.last=0}};const Dde=new Lde;function q6(t,e,i,r){r=r||Dde;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function EO(t,e,i,r){const s=i??t.length,n=q6(t,e,s,r);if(n!==-1)return t[n]=t[s-1],i==null&&t.pop(),e}const qh=new Set;function NRe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;qh.clear();for(let a=0;a<r;++a)qh.add(e[a]);s=s||Dde;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(qh.has(t[a])&&(n?.push(t[a]),qh.delete(t[a]),t[a]=t[i-1],--i,--a,qh.size===0||i===0))return qh.clear(),i;for(let a=0;a<o;++a)if(qh.has(t[a])&&(n?.push(t[a]),qh.delete(t[a]),t[a]=t[i-1],--i,--a,qh.size===0||i===0))return qh.clear(),i;return qh.clear(),i}function FRe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function kRe(t){return t?(EK.seed=t,()=>EK.getFloat()):Math.random}function iMt(t,e){const i=kRe(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const EK=new Yb;function Nde(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function rMt(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function YC(t,e){return t!=null}const URe=[];function Fde(t){return 32+t.length}function GW(){return 16}function kde(t){if(!t)return 0;let e=Bde;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=Fde(r);break;case"number":e+=GW();break;case"boolean":e+=4}}return e}function Ude(t){if(!t)return 0;if(Array.isArray(t))return zRe(t);let e=Bde;for(const i in t)t.hasOwnProperty(i)&&(e+=zde(t[i]));return e}function zRe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=Vde;for(let r=0;r<e;r++)i+=zde(t[r]);return i}function zde(t){switch(typeof t){case"object":return Ude(t);case"string":return Fde(t);case"number":return GW();case"boolean":return 4;default:return 8}}function BRe(t,e){return Vde+t.length*e}const Bde=32,Vde=16;function DA(t){return t instanceof ArrayBuffer}function jW(t){return t?.constructor?.name==="Int8Array"}function v_(t){return t?.constructor?.name==="Uint8Array"}function Gde(t){return t?.constructor?.name==="Uint8ClampedArray"}function HW(t){return t?.constructor?.name==="Int16Array"}function Q5(t){return t?.constructor?.name==="Uint16Array"}function qW(t){return t?.constructor?.name==="Int32Array"}function WW(t){return t?.constructor?.name==="Uint32Array"}function LR(t){return t?.constructor?.name==="Float32Array"}function DR(t){return t?.constructor?.name==="Float64Array"}function am(t){return!("buffer"in t)}function G_(...t){return t.reduce((e,i)=>e+(i?am(i)?BRe(i,GW()):i.byteLength+jde:0),0)}const jde=145,Au=1024;function VRe(t){return DR(t)||LR(t)||qW(t)||HW(t)||jW(t)}function GRe(t){return DR(t)||LR(t)}function jRe(t){return DR(t)?179769e303:LR(t)?3402823e32:WW(t)?4294967295:Q5(t)?65535:v_(t)||Gde(t)?255:qW(t)?2147483647:HW(t)?32767:jW(t)?127:256}function K5(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&K5(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function ge(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Wde(t);if(e!=null)return e;if(uF(t))return t.clone();if(Hde(t))return t.map(ge);if(qde(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=ge(t[r]);return i}function W6(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Wde(t);if(e!=null)return e;if(Hde(t)){let i=!0;const r=t.map(s=>{const n=W6(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(uF(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!qde(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=W6(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function uF(t){return typeof t.clone=="function"}function Hde(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function qde(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function AK(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Wde(t){if(jW(t)||v_(t)||Gde(t)||HW(t)||Q5(t)||qW(t)||WW(t)||LR(t)||DR(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,ge(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(ge(i));return e}return null}function YW(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function Yde(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&s0(t,e):t instanceof Set?e instanceof Set&&qRe(t,e):t instanceof Map?e instanceof Map&&WRe(t,e):!!AK(t)&&AK(e)&&HRe(t,e))}function HRe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function qRe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function WRe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function YRe(t,e,i=!1){return Zde(t,e,i)}function Vg(t,e){if(e!=null)return e[t]||Xde(t.split("."),!1,e)}function Xf(t,e,i){const r=t.split("."),s=r.pop(),n=Xde(r,!0,i);n&&s&&(n[s]=e)}function MK(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(MK(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(MK(t[i],e[i]))return!0;return!1}return t!==e}function Xde(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function Zde(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=ge(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=Zde(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}const Gi={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(YRe(Gi,globalThis.esriConfig,!0),delete Gi.has),!Gi.assetsPath){{const t="4.30";Gi.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Gi.defaultAssetsPath=Gi.assetsPath}const XRe=/\{([^}]+)\}/g;function PK(t){return t??""}function ek(t,e){return e?t.replaceAll(XRe,typeof e=="object"?(i,r)=>PK(Vg(r,e)):(i,r)=>PK(e(r))):t}function sMt(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e?.includes(i)?i:`\\${i}`)}function XW(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let OK;function nMt(t){return OK??(OK=new DOMParser),OK.parseFromString(t||"","text/html").body.innerText||""}function oMt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function ZRe(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const RK={info:0,warn:1,error:2,none:3};let le=class jc{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,jc._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=jc.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,jc._loggers.get(e)||new jc({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!jc._throttlingDisabled){const s=QRe(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=jc._tickCounter)return;this._loggedMessages[e].set(s,jc._tickCounter),jc._scheduleTickCounterIncrement()}for(const s of Gi.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",JRe)}_matchLevel(e){const i=Gi.log.level||"warn";return RK[this._parentWithMember("level",i)]<=RK[e]}static _scheduleTickCounterIncrement(){jc._tickCounterScheduled||(jc._tickCounterScheduled=!0,Promise.resolve().then(()=>{jc._tickCounter++,jc._tickCounterScheduled=!1}))}};function JRe(t,e,...i){console[t](`[${e}]`,...i)}function QRe(...t){return XW(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}le._loggers=new Map,le._tickCounter=0,le._tickCounterScheduled=!1,le._throttlingDisabled=!1;function vu(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function aMt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function ZW(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function lMt(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const l2=()=>le.getLogger("esri.core.accessorSupport.ensureTypes");function KRe(t){return t==null?t:new Date(t)}function e$e(t){return t==null?t:!!t}function t$e(t){return t==null?t:t.toString()}function $d(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function JW(t){return t==null?t:Math.round(parseFloat(t))}function i$e(t){return null}function Jde(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function hF(t,e){return e!=null&&t&&!(e instanceof t)}function Qde(t){return t&&"isCollection"in t}function $K(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function r$e(t,e){if(!e?.constructor||!Qde(e.constructor))return Y6(t,e)?e:new t(e);const i=$K(t.prototype.itemType),r=$K(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(Y6(t,e),e):new t(e):e}function Y6(t,e){return!!Jde(e)&&(l2().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+tk(t)+"'"),!0)}function _w(t,e){return e==null?e:Qde(t)?r$e(t,e):hF(t,e)?Y6(t,e)?e:new t(e):e}function tk(t){return t?.prototype?.declaredClass||"unknown"}const s$e=new WeakMap;function n$e(t){switch(t){case Number:return $d;case Rr:return JW;case Boolean:return e$e;case String:return t$e;case Date:return KRe;case NR:return i$e;default:return ZW(s$e,t,()=>_w.bind(null,t))}}function mo(t,e){const i=n$e(t);return arguments.length===1?i:i(e)}function AO(t,e,i){return arguments.length===1?AO.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function o$e(t,e){return arguments.length===1?AO(i=>mo(t,i)):AO(i=>mo(t,i),e)}function Kde(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>Kde(t,e-1,r)):t(i)}function dF(t,e,i){if(arguments.length===2)return n=>dF(t,e,n);if(!i)return i;i=Kde(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function a$e(t,e,i){return arguments.length===2?dF(r=>mo(t,r),e):dF(r=>mo(t,r),e,i)}function epe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function X6(t,e){if(arguments.length===2)return X6(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||s.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&s.some(h=>!hF(a,h))?a:(u&&r.length?(n||(n=r.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),l2().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(h=>tk(h)).join(", ")),l2().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):l2().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function lm(t,e){if(arguments.length===2)return lm(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=mo(c),r.push(tk(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!hF(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return l2().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!hF(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Jde(l)){const h={};for(const p in l)p!==t.key&&(h[p]=l[p]);return u(h)}return u(l)}}let Rr=class{},NR=class{};const hMt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function l$e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function tpe(t){switch(t.type){case"native":return mo(t.value);case"array":return AO(tpe(t.value));case"one-of":return c$e(t);default:return null}}function c$e(t){let e=null;return(i,r)=>J6(i,t)?i:(e==null&&(e=Z6(t)),l2().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function Z6(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Rr:return"integer";case Date:return"date";case NR:return"null";default:return tk(t.value)}case"array":return`array of ${Z6(t.value)}`;case"one-of":{const e=t.values.map(i=>Z6(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function J6(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Rr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case NR:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!J6(i,e.value));case"one-of":return e.values.some(i=>J6(t,i))}}const u$e={remove:()=>{}};function Mi(t){return t?{remove(){t&&(t(),t=void 0)}}:u$e}function h$e(t){t.forEach(e=>e?.remove())}function vw(t){return Mi(()=>h$e(t))}function dMt(t){return Mi(()=>t()?.remove())}function ipe(t){return Mi(t!=null?()=>t.destroy():void 0)}function Ul(t){return t.__accessor__??null}function d$e(t,e){return t?.metadata?.[e]!=null}function JL(t,e,i){return i?pF(t,e,{policy:i,path:""}):pF(t,e,null)}function pF(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=ge(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.concat():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[n]=pF(l,c,i),i.path=u}else r[n]=pF(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function rpe(t){return Array.isArray(t)?t:t.split(".")}function IK(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function p$e(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...IK(i));return e}return IK(t)}function spe(t,e,i,r){const s=p$e(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return vw(n)}return r(t,s[0],i)}function npe(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=Ul(e);return d$e(r,i)?r.get(i):e[i]}function ope(t,e,i){if(t==null)return t;const r=npe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:ope(r,e,i+1)}function FR(t,e,i=0){return typeof e!="string"||e.includes(".")?ope(t,rpe(e),i):npe(e,t)}function ep(t,e){return FR(t,e)}function LK(t,e){return FR(e,t)!==void 0}function kR(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=ge(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function ik(t,e){const i=kR(t);let r=i[e];return r||(r=i[e]={}),r}function f$e(t,e){return JL(t,e,g$e)}const m$e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function g$e(t){return m$e.test(t)?"replace":"merge"}function y$e(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(Vg(r,e)??"").toString())}let ape=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&y$e(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},W=class lpe extends ape{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ge(i)}catch{return"[object]"}}))}}catch(e){throw le.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new lpe(e.name,e.message,e.details)}};W.prototype.type="error";function fF(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))fF(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void fF(ep(t,s),n,i)}const r=t.__accessor__;r!=null&&_$e(e,r),t[e]=i}}function _$e(t,e){if(se("esri-unknown-property-errors")&&!v$e(t,e))throw new W("set:unknown-property",b$e(t,e))}function v$e(t,e){return e.metadata[t]!=null}function b$e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function m(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=ik(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&le.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let h=ep(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=ep(this,u);p&&(h=h.bind(p))}return h},s.readOnly||(s.set=c?function(h){this._override(i,h)}:function(h){fF(this,l,h)})}const o=t.type,a=t.types;s.cast||(o?s.cast=w$e(o):a&&(Array.isArray(a)?s.cast=AO(lm(a[0])):s.cast=lm(a))),f$e(s,t),t.range&&(s.cast=x$e(s.cast,t.range))}}function cpe(t,e,i){const r=ik(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function w$e(t){let e=0,i=t;if(l$e(t))return tpe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(epe(r))return e===0?X6(r):dF(X6(r),e);if(e===1)return o$e(r);if(e>1)return a$e(r,e);const s=t;return s.from?s.from:mo(s)}function x$e(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}const upe=Symbol("Accessor-beforeDestroy");var pc;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(pc||(pc={}));var Vr;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Vr||(Vr={}));const mF={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},NA=[];let IP=mF;function Ot(t){IP.onObservableAccessed(t)}let QL=!1,KL=!1;function n0(t,e,i){if(QL)return QW(t,e,i);hpe(t);const r=e.call(i);return dpe(),r}function T$e(t,e){return n0(mF,t,e)}function QW(t,e,i){const r=QL;QL=!0,hpe(t);let s=null;try{s=e.call(i)}catch(n){KL&&le.getLogger("esri.core.accessorSupport.tracking").error(n)}return dpe(),QL=r,s}function hpe(t){IP=t,NA.push(t)}function dpe(){const t=NA.length;if(t>1){const e=NA.pop();IP=NA[t-2],e.onTrackingEnd()}else if(t===1){const e=NA.pop();IP=mF,e.onTrackingEnd()}else IP=mF}function ppe(t,e){if(e.flags&Vr.DepTrackingInitialized)return;const i=KL;KL=!1,e.flags&Vr.AutoTracked?QW(e,e.metadata.get,t):fpe(t,e),KL=i}const S$e=[];function fpe(t,e){e.flags&Vr.ExplicitlyTracking||(e.flags|=Vr.ExplicitlyTracking,QW(e,()=>{const i=e.metadata.dependsOn||S$e;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=rpe(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=DK(o,s[n],n!==s.length-1)}else DK(t,r,!1)}),e.flags&=~Vr.ExplicitlyTracking)}function DK(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=Ul(t);if(s){const n=s.propertiesByName.get(r);n&&(Ot(n),ppe(t,n))}return i?t[r]:void 0}function C$e(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let bw=class extends ape{constructor(e,i,r){super(e,i,r)}};bw.prototype.type="warning";function mpe(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const Q6=()=>le.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function NK(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||M$e(t)&&Xf("read.reader",KW(t),e))}function KW(t){const e=t.ndimArray??0;if(e>1)return A$e(t);if(e===1)return FK(t);if("type"in t&&ype(t.type)){const i=t.type.prototype?.itemType?.Type,r=FK(typeof i=="function"?{type:i}:{types:i});return(s,n,o)=>{const a=r(s,n,o);return a&&new t.type(a)}}return eY(t)}function eY(t){return"type"in t?E$e(t.type):P$e(t.types)}function E$e(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void Q6().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function gpe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>gpe(t,s,i,r-1)):t(e,void 0,i)}function A$e(t){const e=eY(t),i=gpe.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function FK(t){const e=eY(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function ype(t){if(!mpe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?tY(e.Type):_pe(e.Type))}function M$e(t){return"types"in t?_pe(t.types):tY(t.type)}function tY(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||ype(t))}function _pe(t){for(const e in t.typeMap)if(!tY(t.typeMap[e]))return!1;return!0}function P$e(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void Q6().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=O$e(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o?.messages&&s&&o.messages.push(new bw(`${i}:unsupported`,p,{definition:s,context:o})),void Q6().error(p)}const h=new u;return h.read(s,o),r?r(h):h}}function O$e(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],s=kR(r.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;if(n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"){e[n.json.type[0]]=r;continue}const o=n.json?.write;if(!o?.writer){e[i]=r;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(i,c,l),c[l]&&(e[c[l]]=r)}return e}function R$e(t){if(t.json||(t.json={}),UK(t.json),zK(t.json),kK(t.json),t.json.origins)for(const e in t.json.origins)UK(t.json.origins[e]),zK(t.json.origins[e]),kK(t.json.origins[e]);return!0}function kK(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function UK(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function zK(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function BK(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&mpe(t.type))?e.write.writer=L$e:i>1?e.write.writer=D$e(i):e.types?Array.isArray(e.types)?e.write.writer=I$e(e.types[0]):e.write.writer=$$e(e.types):e.write.writer=MO}function $$e(t){return(e,i,r,s)=>e?vpe(e,t,s)?MO(e,i,r,s):void 0:MO(e,i,r,s)}function vpe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new W(`${r}:unsupported`,s,{definition:t,context:i})),le.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function I$e(t){return(e,i,r,s)=>!e||!Array.isArray(e)?MO(e,i,r,s):MO(e.filter(n=>vpe(n,t,s)),i,r,s)}function MO(t,e,i,r){Xf(i,gF(t,r),e)}function gF(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?yF(t):t}function yF(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function L$e(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>gF(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[gF(t,r)],Xf(i,s,e)}function bpe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>bpe(r,e,i-1)):gF(t,e)}function D$e(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=bpe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Xf(r,n,i)}}function N$e(t,e){return iY(t,"any",e?.origin)}function K6(t,e){return iY(t,"read",e?.origin)}function wpe(t,e){return iY(t,"write",e?.origin)}function iY(t,e,i){let r=t?.json;if(r?.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function F$e(t){const e=k$e(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?U$e(r):e;NK(s,r,!1),r.types&&!r.write&&t.json.write?.enabled&&(r.write={...t.json.write}),BK(s,r)}NK(e,t.json,!0),BK(e,t.json)}function k$e(t){return t.json.types?ej(t.json):t.type?xpe(t):ej(t)}function U$e(t){return t.type?xpe(t):ej(t)}function xpe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!epe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function ej(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function z$e(t){R$e(t)&&(C$e(t),F$e(t))}const $z=new Set,Iz=new Set;function U(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,V$e(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!$z.has(s.initialize)&&($z.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!Iz.has(s.destroy)&&(Iz.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);$z.clear(),Iz.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[upe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=kR(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function B$e(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;Ot(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function V$e(t){const e=t.prototype,i=kR(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];z$e(n),r[s]={enumerable:!0,configurable:!0,get:B$e(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this))return a.initialized&&n.readOnly?VK("read-only",s):a.lifecycle===pc.CONSTRUCTED&&n.constructOnly?VK("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const VK=(t,e)=>{le.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)},GK=new WeakMap;function G$e(t,e,i=!1){const r=`🛑 DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=GK.get(t);s||(s=new Set,GK.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}function rY(t,e,i={}){if(se("esri-deprecation-warnings")){const{moduleName:r}=i;o0(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function mMt(t,e,i={}){if(se("esri-deprecation-warnings")){const{moduleName:r}=i;o0(t,`Property: ${(r?r+"::":"")+e}`,i)}}function j$e(t,e,i={}){se("esri-deprecation-warnings")&&o0(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function o0(t,e,i={}){if(se("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),G$e(t,a,o)}}function gMt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function H$e(t,e){for(const i of t)if(i!=null&&e(i))return i}function tj(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let _m=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(tj(e)){const r=this._getOrCreateGroup(i);for(const s of e)HK(s)&&r.push(s)}else HK(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(Y$(e))}remove(e){if(typeof e!="string"&&tj(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(jK(this._getGroup(e)),this._groups.delete(Y$(e)),this):this}removeAll(){return this._groups.forEach(jK),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(Y$(e),i),i}_getGroup(e){return this._groups.get(Y$(e))}};function Y$(t){return t||"_default_"}function jK(t){for(const e of t)e instanceof _m?e.removeAll():e.remove()}function HK(t){return t!=null&&(!!t.remove||t instanceof _m)}function rk(t,e){if(t==null)throw new Error(e??"value is None")}function Oe(t){return t?.destroy(),null}function Tt(t){return t?.dispose(),null}function gr(t){return t?.remove(),null}function il(t){return t?.abort(),null}function Xt(t){return t?.release(),null}function q$e(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function qK(t,e){return t?.[e]}function W$e(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}function Y$e(t){return t?.release&&typeof t.release=="function"}function X$e(t){return t?.acquire&&typeof t.acquire=="function"}let Ko=class ij{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(ij.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):X$e(i)&&i.acquire(...e),i}release(e){e&&!ij.test.disabled&&(this._releaseFunction?this._releaseFunction(e):Y$e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Ko.test={disabled:!1};let Z$e=class{constructor(e,i){this._observers=e,this._observer=i}remove(){Nde(this._observers,this._observer)}},Tpe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return J$e;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new Z$e(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const J$e=Mi();var Ti;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Ti||(Ti={}));const rj=Ti.USER+1;function b_(t){switch(t){case"defaults":return Ti.DEFAULTS;case"service":return Ti.SERVICE;case"portal-item":return Ti.PORTAL_ITEM;case"web-scene":return Ti.WEB_SCENE;case"web-map":return Ti.WEB_MAP;case"link-chart":return Ti.LINK_CHART;case"user":return Ti.USER;default:return null}}function _F(t){switch(t){case Ti.DEFAULTS:return"defaults";case Ti.SERVICE:return"service";case Ti.PORTAL_ITEM:return"portal-item";case Ti.WEB_SCENE:return"web-scene";case Ti.WEB_MAP:return"web-map";case Ti.LINK_CHART:return"link-chart";case Ti.USER:return"user"}}function Q$e(t){return _F(t)}let WK=class extends Tpe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=Vr.Dirty|(i.nonNullable?Vr.NonNullable:0)|(i.hasOwnProperty("value")?Vr.HasDefaultValue:0)|(i.get===void 0?Vr.DepTrackingInitialized:0)|(i.dependsOn===void 0?Vr.AutoTracked:0)}destroy(){this.flags&Vr.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Ot(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&Vr.Computing||~s&Vr.Dirty&&i.has(r))return n;this.flags|=Vr.Computing;const o=e.host;let a;s&Vr.AutoTracked?a=n0(this,this.metadata.get,o):(fpe(o,this),a=this.metadata.get.call(o)),i.set(r,a,Ti.COMPUTED);const l=i.get(r);return l===n?this.flags&=~Vr.Dirty:T$e(this.commit,this),this.flags&=~Vr.Computing,l}onObservableAccessed(e){e!==this&&(this._accessed??(this._accessed=new Set),this._accessed.add(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Vr.DepTrackingInitialized,this._accessed!=null&&(this._handles??(this._handles=[]),this._accessed.forEach(e=>{this._handles.push(e.observe(this))}),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~Vr.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&Vr.Overridden&&(this.flags|=Vr.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},K$e=class Spe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Spe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ge(r))}),i}get(e){return this._values.get(e)}originOf(){return Ti.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function X$(t,e,i){return t!==void 0}function YK(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&Vr.NonNullable)||(r.lifecycle,pc.INITIALIZING,!1))}let e3e=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=pc.INITIALIZING,this.store=new K$e,this._origin=Ti.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new WK(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=pc.CONSTRUCTING}constructed(){this.lifecycle=pc.CONSTRUCTED}destroy(){this.lifecycle=pc.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==pc.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);Ot(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&Vr.HasDefaultValue)return"defaults"}return _F(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(X$(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);X$(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!X$(s))return"";const n=new Set,o=n0({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>s.metadata.get?.call(e));let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n)l instanceof WK&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(X$(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&Vr.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&Vr.Overridden&&(i.flags&=~Vr.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!YK(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(Lz.release(n),!o)return;i=a}r.flags|=Vr.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!YK(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(Lz.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=b_(e)}getDefaultOrigin(){return _F(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==pc.INITIALIZING?this._origin:Ti.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&YW(i,s.get(n))&&~e.flags&Vr.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),ppe(this.host,e))}_cast(e,i){const r=Lz.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},t3e=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const Lz=new Ko(t3e);let i3e;function r3e(){return i3e}var XK;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(XK||(XK={}));function s3e(t){t.length=0}let fc=class{constructor(e=50,i=50){this._pool=new Ko(Array,void 0,s3e,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Dz.acquire()}static release(e){return Dz.release(e)}static prune(){Dz.prune()}};const Dz=new fc(100);let Cpe=class extends Ko{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const Z$=[];function B2(t){Z$.push(t),Z$.length===1&&queueMicrotask(()=>{const e=Z$.slice();Z$.length=0;for(const i of e)i()})}let Gg=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var sj;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const h=a>>>1,p=n[c-1];for(;u<=h;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const f=n[u-1];if(l(f,p)<=0)break;n[c-1]=f,c=u}n[c-1]=p},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const h=n[o];n[o]=n[u],n[u]=h,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const h=n[o];n[o]=n[u],n[u]=h,e(n,c,u,l),yield}}t.sort=r,t.iterableSort=s})(sj||(sj={}));const ZK=sj,n3e=1.5,o3e=1.1;let Gt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Lde,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>JK(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,JK(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=q6(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(q6(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=NRe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){ZK.sort(this.data,0,this.length,e)}iterableSort(e){return ZK.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function JK(t){t.data.length>n3e*t.length&&(t.data.length=Math.floor(t.length*o3e))}function a3e(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Mi(()=>t.clearTimeout(r))}}}const UR=a3e(globalThis);function sk(t){return l3e(t)||Epe(t)}function l3e(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function Epe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function qg(t,e,i){if(!sk(t))throw new TypeError("target is not a Evented or EventTarget object");return Epe(t)?c3e(t,e,i):t.on(e,i)}function c3e(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return Mi(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),Mi(()=>t.removeEventListener(e,i,r))}function Ape(t,e,i){if(!sk(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=qg(t,e,s=>{r.remove(),i.call(t,s)});return r}function vi(t="Aborted"){return new W("AbortError",t)}function yt(t,e="Aborted"){if(qn(t))throw vi(e)}function nk(t){return t instanceof AbortSignal?t:t?.signal}function qn(t){const e=nk(t);return e!=null&&e.aborted}function a0(t){if(sn(t))throw t}function QK(t){if(!sn(t))throw t}function un(t,e){const i=nk(t);if(i!=null){if(!i.aborted)return Ape(i,"abort",()=>e());e()}}function zR(t,e){const i=nk(t);if(i!=null)return yt(i),Ape(i,"abort",()=>e(vi()))}function sY(t,e){return nk(e)==null?t:new Promise((i,r)=>{let s=un(e,()=>r(vi()));const n=()=>{s=gr(s)};t.then(n,n),t.then(i,r)})}function sn(t){return t?.name==="AbortError"}async function vF(t){try{return await t}catch(e){if(!sn(e))throw e;return}}async function AMt(t,e=le.getLogger("esri")){try{return await t}catch(i){sn(i)||e.error(i)}}async function ok(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await ok(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function bF(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function u3e(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function PO(t,e=void 0,i){const r=new AbortController;return un(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);un(r,()=>{o&&(clearTimeout(o),n(vi()))})})}function h3e(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return un(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function $c(t){return t&&typeof t.then=="function"}function nj(t){return $c(t)?t:Promise.resolve(t)}function Mpe(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(vi()),n=Pn();const p=n.promise;if(o){const f=o;o=null,f.abort()}return p}if(s=n||Pn(),n=null,e>0){const p=new AbortController;i=nj(t(...l,p.signal));const f=i;PO(e).then(()=>{i===f&&(n?p.abort():o=p)})}else i=1,i=nj(t(...l));const c=()=>{const p=r;r=s=i=o=null,p!=null&&a(...p)},u=i,h=s;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return a}function Pn(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>UR.setTimeout(()=>r.reject(n),s),r.promise=i,r}function MMt(t,e){return t.then(e,e)}async function KK(t){await Promise.resolve(),yt(t)}function PMt(t){return t}function Ppe(t){return 1e3*t}function OMt(t){return t}function nY(t){return .001*t}let d3e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},p3e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},oj=0,aj=0;const ME={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},lj=["prepare","preRender","render","postRender","update","finish"],cj=[],ww=new Gt;let f3e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function m3e(){Xb!=null&&(cancelAnimationFrame(Xb),Xb=requestAnimationFrame(oY))}const wF={frameTasks:ww,willDispatch:!1,clearFrameTasks:g3e,dispatch:Rpe,executeFrameTasks:_3e,reschedule:m3e};function XC(t){const e=new p3e(t);return cj.push(e),wF.willDispatch||(wF.willDispatch=!0,B2(Rpe)),e}function xw(t){const e=new d3e(t);return ww.push(e),Xb==null&&(oj=performance.now(),Xb=requestAnimationFrame(oY)),new f3e(e)}let Xb=null;function g3e(t=!1){ww.forAll(e=>{e.removed=!0}),t&&Ope()}function y3e(t){aj=Math.max(0,t)}function oY(){const t=performance.now();Xb=null,Xb=ww.length>0?requestAnimationFrame(oY):null,wF.executeFrameTasks(t)}function _3e(t){const e=t-oj;oj=t;const i=aj>0?aj:1e3/60,r=Math.max(0,e-i);ME.time=t,ME.frameDuration=i-r;for(let s=0;s<lj.length;s++){const n=performance.now(),o=lj[s];ww.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(ME.elapsedFrameTime=performance.now()-t,ME.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,ME)))}),w3e[s].record(performance.now()-n)}Ope(),x3e.record(performance.now()-t)}const J$=new Gt;function Ope(){ww.forAll(t=>{t.removed&&J$.push(t)}),ww.removeUnorderedMany(J$.data,J$.length),J$.clear()}function Rpe(){for(;cj.length;){const t=cj.shift();t.isActive&&t.callback()}wF.willDispatch=!1}function v3e(t=1,e){const i=Pn(),r=()=>{qn(e)?i.reject(vi()):t===0?i():(--t,B2(()=>r()))};return r(),i.promise}function b3e(t){return v3e(1,t)}async function LMt(){await b3e(),await new Promise(t=>requestAnimationFrame(t))}const w3e=lj.map(t=>new Gg(t)),x3e=new Gg("total");function eD(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function eee(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function DMt(t,e){return e!=null&&t.add(e),t}function $pe(t,e){const i=new Set;return eee(i,t),eee(i,e),i}function T3e(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function NMt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function FMt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function S3e(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function C3e(t,e){return S3e($pe(t,e),T3e(t,e))}let E3e=0;const A3e=0;function wu(){return++E3e}let ak=class{constructor(e){this._accessed=new Set,this._handles=[],this._observerObject=new M3e(e),tee.register(this,new WeakRef(this._observerObject),this)}destroy(){tee.unregister(this._observerObject),this._accessed.clear(),this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){this._accessed.add(e)}onTrackingEnd(){const e=this._handles,i=this._observerObject;this._accessed.forEach(r=>{e.push(r.observe(i))}),this._accessed.clear()}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},M3e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=P3e}};const tee=new FinalizationRegistry(t=>{t.deref()?.destroy()});function P3e(){}let c2=!1;const xF=[];function Ipe(t,e){let i=new ak(n),r=null,s=!1;function n(){if(!i||s)return;if(c2)return void Dpe(n);const a=r;i.clear(),c2=!0,s=!0,r=n0(i,t),s=!1,c2=!1,e(r,a),Npe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=n0(i,t),s=!1,Mi(o)}function Lpe(t,e){let i=new ak(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=n0(i,t),r):null}return o(),Mi(n)}function O3e(t){let e=new ak(r),i=!1;function r(){e&&!i&&(c2?Dpe(r):(e.clear(),c2=!0,i=!0,n0(e,t),i=!1,c2=!1,Npe()))}function s(){e&&(e.destroy(),e=null)}return i=!0,n0(e,t),i=!1,Mi(s)}function Dpe(t){xF.includes(t)||xF.unshift(t)}function Npe(){for(;xF.length;)xF.pop()()}var LP;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(LP||(LP={}));let OO=class{constructor(){this.uid=wu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(LP.Untracked,e,i,r,s,n,YW)}static acquireTracked(e,i,r,s){return this.pool.acquire(LP.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===LP.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=wu(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=wu(),this.removed=!0}};OO.pool=new Cpe(OO);const tD=new fc,Wg=new Set;let TF;function SF(t){Wg.delete(t),Wg.add(t),TF||(TF=XC(I3e))}function R3e(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function $3e(t){for(const e of Wg.values())e.target===t&&(e.removed=!0)}function I3e(){let t=10;for(;TF&&t--;){TF=null;const e=L3e(),i=tD.acquire();for(const r of e){const s=r.uid;R3e(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Wg)r.removed&&(i.push(r),Wg.delete(r));for(const r of i)OO.pool.release(r);tD.release(i),tD.release(e),uj.forEach(r=>r())}}function L3e(){const t=tD.acquire();t.length=Wg.size;let e=0;for(const i of Wg)t[e]=i,++e;return Wg.clear(),t}const uj=new Set;function Fpe(t){return uj.add(t),Mi(()=>uj.delete(t))}function D3e(t,e,i){let r=spe(t,e,i,(s,n,o)=>{let a,l,c=Lpe(()=>FR(s,n),(u,h)=>{s.__accessor__?.lifecycle===pc.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=OO.acquireUntracked(u,o,h,s,n),l=a.uid),SF(a))});return Mi(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,SF(a)),a=null),r=c=null})});return r}function N3e(t,e,i){const r=spe(t,e,i,(s,n,o)=>{let a=!1;return Ipe(()=>FR(s,n),(l,c)=>{s.__accessor__.lifecycle!==pc.DESTROYED?a||(a=!0,YW(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function F3e(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==pc.DESTROYED?r?N3e(t,e,i):D3e(t,e,i):Mi()}function k3e(t,e,i){let r,s,n=Lpe(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=OO.acquireTracked(o,e,a,i),s=r.uid),SF(r))});return Mi(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,SF(r)),r=null),n=null})}function U3e(t,e,i){let r=!1;return Ipe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function z3e(t,e,i=!1,r=Yde){return i?U3e(t,e,r):k3e(t,e,r)}function iee(t){return eD(Wg,e=>e.oldValue===t)}var kpe,Upe;function B3e(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Qp=Symbol("Accessor-Handles"),hj=Symbol("Accessor-Initialized");let Pe=class zpe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}kR(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{h=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,h}:e[a]}for(const a in i){const l=B3e(i[a]);m(l)(o.prototype,a)}return U(r)(o)}constructor(...e){if(this[kpe]=null,this[Upe]=!1,this.constructor===zpe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new e3e(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[hj]=!0}initialize(){}[upe](){this[Qp]=Oe(this[Qp])}destroy(){this.destroyed||($3e(this),this.__accessor__.destroy(),r3e()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[hj]}get destroyed(){return this.__accessor__?.lifecycle===pc.DESTROYED||!1}commitProperty(e){ep(this,e)}get(e){return rY(le.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),ep(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return fF(this,e,i),this}watch(e,i,r){return F3e(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[Qp]??(this[Qp]=new _m)).add(e,i)}removeHandles(e){this[Qp]?.remove(e)}removeAllHandles(){this[Qp]?.removeAll()}removeHandlesReference(e){this[Qp]?.removeReference(e)}hasHandles(e){return this[Qp]?.has(e)===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};kpe=Qp,Upe=hj;let V3e=class Bpe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Bpe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ge(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??Ti.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===Ti.DEFAULTS){const s=this._values.get(e);if(s?.origin!=null&&s.origin>r)return}this._values.set(e,new G3e(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Ti.DEFAULTS?e:Ti.USER}},G3e=class{constructor(e,i){this.value=e,this.origin=i}};function Vpe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Ti.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Ti.DEFAULTS)})}function j3e(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&LK(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&LK(s,i))return!0;return!1}function H3e(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function q3e(t,e,i,r,s){let n=K6(e[i],s);H3e(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=K6(e[o],s),j3e(n,i,r)&&(t[o]=!0)}function W3e(t,e,i,r){const s=i.metadata,n=N$e(s[e],r),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const Gpe={origin:"service"};function jpe(t,e,i=Gpe){if(!e||typeof e!="object")return;const r=Ul(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))q3e(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=K6(s[o],i).read,l=a?.source;let c;c=l&&typeof l=="string"?FR(e,l):e[o],a?.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||W3e(t,o,r,i)}r.setDefaultOrigin("user")}function Y3e(t,e,i,r=Gpe){const s={...r,messages:[]};i(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?r?.messages&&r.messages.push(n):t.loadWarnings.push(n)})}function X3e(t,e,i,r,s){const n={};return e.write?.writer?.call(t,r,n,i,s),n}function Hpe(t,e,i,r,s,n){if(!r?.write)return!1;const o=ep(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&n?.layerContainerType&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new W("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&n?.messages?n.messages.push(a):a&&!n&&le.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Ti.DEFAULTS)&&Z3e(t,i,n,r,o)||!s.ignoreOrigin&&n?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<b_(n.origin))}function Z3e(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return s0(o,s)}return!1}return n===s}function VMt(t,e,i,r){const s=Ul(t),n=s.metadata,o=wpe(n[e],r);return!!o&&Hpe(t,s,e,o,i,r)}function qpe(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return JL(e,t.toJSON(i));const r=Ul(t),s=r.metadata;for(const n in s){const o=wpe(s[n],i);if(!Hpe(t,r,n,o,void 0,i))continue;const a=ep(t,n),l=X3e(t,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,i);Object.keys(l).length>0&&(e=JL(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>JL(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:n,oldOrigin:Q$e(r.store.originOf(n)),newOrigin:i.origin}))}return e}const BR=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ul(this),s=r.store,n=new V3e;r.store=n,Vpe(r,s,n)}read(i,r){jpe(this,i,r)}write(i,r){return qpe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return J3e.call(this,i,r)}};return e=d([U("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function J3e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function dj(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let Me=class extends BR(Pe){};Me=d([U("esri.core.JSONSupport")],Me);function _i(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=cpe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let Do=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=Q3e(e),this.apiValues=ree(this._apiToJSON),this.jsonValues=ree(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&Xf(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function Q3e(t){const e={};for(const i in t)e[t[i]]=i;return e}function ree(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function rl(){return function(t,e){return new Do(t,{ignoreUnknown:!0,...e})}}let aY=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const ji=new aY(6378137,1/298.257223563,3e5,.006694379990137799),tp=new aY(3396190,1/169.8944472236118,23e4),l0=new aY(1737400,0,0),K3e="modulepreload",eIe=function(t,e){return new URL(t,e).href},see={},ue=function(e,i,r){if(!i||i.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=eIe(n,r),n in see)return;see[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=s.length-1;u>=0;u--){const h=s[u];if(h.href===n&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":K3e,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})},tIe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,iIe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function nee(t){const e=t?.match(tIe);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=iIe;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function Wpe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function CF(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function Ype(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function rIe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const sIe=()=>le.getLogger("esri.core.urlUtils"),ZC=Gi.request,oee="esri/config: esriConfig.request.proxyUrl is not set.",Xpe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Zpe=/^\s*http:/i,nIe=/^\s*https:/i,oIe=/^\s*file:/i,aIe=/:\d+$/,lIe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,cIe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),uIe=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let vc=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(cIe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(uIe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const Q$={},hIe=new vc(Gi.applicationUrl);let Za=hIe;const dIe=pIe();let lY=dIe;const cY=()=>Za,WMt=()=>lY;function pIe(){const t=Za.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Za.scheme}://${Za.host}${Za.port!=null?`:${Za.port}`:""}`}${e}`}function Hs(t){if(!t)return null;const e={path:null,query:null},i=new vc(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=Ib(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function Ib(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function Tw(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e?.[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>dj(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):dj(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function fIe(t=!1){let e,i=ZC.proxyUrl;if(typeof t=="string"){e=vIe(t);const r=VR(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw sIe().warn(oee),new W("urlUtils:proxy-not-set",oee);return e&&fj()&&(i=fY(i)),Hs(i)}function YMt(t){const e=VR(t);let i,r;if(e){const s=uY(e.proxyUrl);i=s.path,r=s.query?Ib(s.query):null}if(i){const s=Hs(t);t=i+"?"+s.path;const n=Tw({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const PE={path:"",query:""};function uY(t){const e=t.indexOf("?");return e!==-1?(PE.path=t.slice(0,e),PE.query=t.slice(e+1)):(PE.path=t,PE.query=null),PE}function Jpe(t){return t=(t=AF(t=SIe(t=uY(t).path),!0)).toLowerCase()}function mIe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Jpe(t.urlPrefix)},i=ZC.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function VR(t){const e=ZC.proxyRules,i=Jpe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function XMt(t,e){if(!t||!e)return!1;t=EF(t),e=EF(e);const i=nee(t),r=nee(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&ac(t,e,!0)}function gIe(t,e){return t=EF(t),e=EF(e),AF(t)===AF(e)}function EF(t){const e=(t=ip(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function pj(t,e=ZC.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function ac(t,e,i=!1){if(!t||!e)return!1;const r=gj(t),s=gj(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function hY(t){if(typeof t=="string"){if(!xu(t))return!0;t=gj(t)}if(ac(t,Za))return!0;const e=ZC.trustedServers||[];for(let i=0;i<e.length;i++){const r=yIe(e[i]);for(let s=0;s<r.length;s++)if(ac(t,r[s]))return!0}return!1}function yIe(t){return Q$[t]||(pY(t)||cm(t)?Q$[t]=[new vc(Ja(t))]:Q$[t]=[new vc(`http://${t}`),new vc(`https://${t}`)]),Q$[t]}function Ja(t,e=lY,i){return cm(t)?i?.preserveProtocolRelative?t:Za.scheme==="http"&&Za.authority===Mh(t).slice(2)?`http:${t}`:`https:${t}`:pY(t)?t:vm(t[0]==="/"?TIe(e):e,t)}function lk(t,e=lY,i){if(t==null||!xu(t))return t;const r=ip(t),s=r.toLowerCase(),n=ip(e).toLowerCase().replace(/\/+$/,""),o=i?ip(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(h,p,f)=>(f=h.indexOf(p,f))===-1?h.length:f;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)t=`../${t}`;else t=`./${t}`;return t}function ip(t){return t=AIe(t=EIe(t=CIe(t=Ja(t=t.trim()))))}function vm(...t){const e=t.filter(YC);if(!e?.length)return;const i=[];if(xu(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),wIe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Mh(t,e=!1){if(t==null||RO(t)||bm(t))return null;let i=t.indexOf("://");if(i===-1&&cm(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=AF(t,!0)),t}function xu(t){return cm(t)||pY(t)}function RO(t){return t!=null&&t.slice(0,5)==="blob:"}function bm(t){return t!=null&&t.slice(0,5)==="data:"}function dY(t){const e=j_(t);return e?.isBase64?Ype(e.data):null}function Nz(t){return rIe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const _Ie=/^data:(.*?)(;base64)?,(.*)$/;function j_(t){const e=t.match(_Ie);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function Qpe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function ZMt(t){return(await fetch(t)).blob()}function JMt(t){const e=dY(t);if(!e)return null;const i=j_(t);return new Blob([e],{type:i.mediaType})}function cm(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function pY(t){return t!=null&&Xpe.test(t)}function vIe(t){return t!=null&&nIe.test(t)||Za.scheme==="https"&&cm(t)}function bIe(t){return t!=null&&Zpe.test(t)||Za.scheme==="http"&&cm(t)}function wIe(t){return t!=null&&oIe.test(t)}function fY(t){return cm(t)?`https:${t}`:t.replace(Zpe,"https:")}function xIe(){return Za.scheme==="http"}function fj(){return Za.scheme==="https"}function AF(t,e=!1){return cm(t)?t.slice(2):(t=t.replace(Xpe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function TIe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function ck(t){let e=0;if(xu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function QMt(t,e){if(!t)return"";const i=Hs(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!e?.length)return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function SIe(t){return t.endsWith("/")?t:`${t}/`}function Kpe(t){return t.replace(/\/+$/,"")}function CIe(t){if(/^https?:\/\//i.test(t)){const e=uY(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function EIe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function AIe(t){const e=ZC.httpsDomains;if(!bIe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),aIe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return xIe()&&r===Za.authority&&!lIe.test(t)||(fj()&&r===Za.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||fj()&&!VR(t))&&(t=fY(t)),t}function mj(t,e,i){if(!(e&&i&&t&&xu(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function gj(t){return typeof t=="string"?new vc(Ja(t)):(t.scheme||(t.scheme=Za.scheme),t)}function efe(t){return PIe.test(t)}function tfe(t,e){const i=Hs(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function ife(t,e,i){const r=Hs(t),s=r.query||{};return s[e]=String(i),`${r.path}?${Tw(s)}`}function iD(t,e){if(!e)return t;const i=Hs(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=Tw(r);return s?`${i.path}?${s}`:i.path}function MIe(t){if(t==null)return null;const e=t.match(rfe);return e?e[2]:null}function aee(t){if(t==null)return null;const e=t.match(rfe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function KMt(t){return typeof t=="string"?j_(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(j_(r.result)),r.onerror=s=>i(s)})}const rfe=/([^.]*)\.([^/]*)$/,PIe=/(^data:image\/svg|\.svg$)/i,sfe="20240628",nfe="0794d5875b3af14a9310da1885edae2bf95af6a9";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const ofe="4.30";let Jr,uk=ofe;uk="4.30.2";function OIe(t){Jr=t}function ePt(t){const e=Jr?.findCredential(t);return e?.token?ife(t,"token",e.token):t}se("host-webworker");const RIe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function mY(t){const e=Mh(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!RIe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function afe(t,e,i=!1,r){return new Promise((s,n)=>{if(qn(r))return void n(lee());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(lee())};const c=()=>{se("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r?.addEventListener("abort",l),se("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function lee(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const lfe="Timeout exceeded";function $Ie(){return new Error(lfe)}function tPt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===lfe}function IIe(t){Gi.request.crossOriginNoCorsDomains||(Gi.request.crossOriginNoCorsDomains={});const e=Gi.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Mh(i)??""]=0:(e[Mh("http://"+i)??""]=0,e[Mh("https://"+i)??""]=0)}function LIe(t){const e=Gi.request.crossOriginNoCorsDomains;if(e){let i=Mh(t);if(i)return i=i.toLowerCase(),!ac(i,cY())&&e[i]<Date.now()-36e5}return!1}async function DIe(t){const e=Gi.request.crossOriginNoCorsDomains,i=Mh(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=Hs(t);t=r.path,r.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Yi(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=Ib(e.query.toString().replaceAll("+"," ")));const i=bm(t),r=RO(t);r||i||(t=ip(t));const s={url:t,requestOptions:{...e}},n=p=>({data:p,getAllHeaders:V2,getHeader:V2,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=pj(t,ph.internalInterceptors);if(o){const p=await uee(o,s);if(p!=null)return n(p)}let a=pj(t);if(a){const p=await uee(a,s);if(p!=null)return n(p);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(se("host-webworker")||se("host-node")))throw Zf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Zf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Zf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await zIe(),MF)return MF.execute(t,e);const l=new AbortController,c=un(e,()=>l.abort()),u={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:ph.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},h=await jIe(u).finally(()=>c?.remove());return a?.after?.(h),h}let MF;const ph=Gi.request,cfe="FormData"in globalThis,NIe=new Set([499,498,403,401]),FIe=new Set(["COM_0056","COM_0057","SB_0008"]),kIe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],V2=()=>null,PF=Symbol();function UIe(t){const e=Mh(t);e&&!Yi._corsServers.includes(e)&&Yi._corsServers.push(e)}function cee(t){const e=Mh(t);return!e||e.endsWith(".arcgis.com")||Yi._corsServers.includes(e)||hY(e)}function Zf(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:V2,getHeader:V2,ssl:!1};if(e instanceof W)return e.details?(e.details=ge(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(u=>r.headers.get(u)),l=r?.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=PF in e?e[PF]:e}return sn(e)?vi():new W(t,s,n)}async function zIe(){se("host-webworker")&&!MF&&(MF=await ue(()=>import("./request-7ed2c3f4.js"),[],import.meta.url))}async function yj(){Jr||await ue(()=>Promise.resolve().then(()=>HAt),void 0,import.meta.url)}async function BIe(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(cfe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:ph.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||n?.get("token")),!t.hasToken&&Gi.apiKey&&mY(e)&&(i.query||(i.query={}),i.query.token=Gi.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!ufe(e)&&!qn(r)){let a;i.authMode==="immediate"?(await yj(),a=await Jr.getCredential(e,{signal:r}),t.credential=a):i.authMode==="no-prompt"?(await yj(),a=await Jr.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=a):Jr&&(a=Jr.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function ufe(t){return kIe.some(e=>e.test(t))}async function VIe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=RO(e)||bm(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:ph.timeout;let a=!1;if(!s){t.useSSL&&(e=fY(e));let p={...i.query};t.credentialToken&&(p.token=t.credentialToken);let f=Tw(p);se("esri-url-encodes-apostrophe")&&(f=f.replaceAll("'","%27"));const g=e.length+1+f.length;let _;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>ph.maxUrlLength;const v=i.useProxy||!!VR(e);if(v){const b=fIe(e);_=b.path,!a&&_.length+1+g>ph.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(r.method==="HEAD"&&(a||v)){if(a)throw g>ph.maxUrlLength?Zf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Zf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Zf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=iD(e,p):(r.body=Tw(p),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=iD(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&cfe&&r.body instanceof FormData&&!Wpe(e)&&r.body.set("token",p.token),i.hasOwnProperty("withCredentials")?t.withCredentials=i.withCredentials:ac(e,cY())||(hY(e)||Jr&&Jr.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(r.credentials="include",LIe(e)&&await DIe(a?iD(e,p):e))}let l,c,u=0,h=!1;o>0&&(u=setTimeout(()=>{h=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||GIe(i.headers)||!s&&!t.useProxy&&ph.proxyUrl&&!cee(e)){if(Yi._beforeFetch&&await Yi._beforeFetch(e,r),l=await fetch(e,r),Yi._afterFetch&&await Yi._afterFetch(l),t.useProxy||UIe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=hee(c,"application/xml");break;case"document":c=hee(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const f=await new Response(c).json();f.error&&(c=f)}catch{}}n==="image"&&c instanceof Blob&&(c=await dee(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await dee(e,t)}catch(p){if(p.name==="AbortError")throw h?$Ie():vi("Request canceled");if(!(!l&&p instanceof TypeError&&ph.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||cee(e))throw p;t.redoRequest=!0,mIe({proxyUrl:ph.proxyUrl,urlPrefix:Mh(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function uee(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=Zf("request:interceptor",s,e)}if((r instanceof Error||r instanceof W)&&(i=Zf("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function GIe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function hee(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function jIe(t){let e,i;await BIe(t);try{do[e,i]=await VIe(t);while(!await HIe(t,e,i))}catch(n){const o=Zf("request:server",n,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!hY(r)){const n=Mh(r,!0);n&&ph.trustedServers.push(n)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&IIe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Jr){let o=Jr.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=Jr.findCredential(o,s.userId);a&&Jr._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):V2,getHeader:e?n=>e.headers.get(n):V2,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function HIe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[PF]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[PF]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=r.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&NIe.has(n)&&!ufe(t.params.url)&&(n!==403||(!o||!FIe.has(o))&&(a==null||a===2&&t.credentialToken))){await yj();try{const c=await Jr.getCredential(t.params.url,{error:Zf("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function dee(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=ph.priority,s.src=t,afe(s,t,i,r)}Yi._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Yi._beforeFetch=void 0,Yi._afterFetch=void 0;function qIe(t,e){return Yi(sr(t),e)}function sr(t){if(!Gi.assetsPath)throw le.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new W("assets:path-not-set","config.assetsPath is not set");return vm(Gi.assetsPath,t)}let Fz,ne=null;function hfe(){return!!ne}function WIe(){return!!se("esri-wasm")}function dfe(){return Fz||(Fz=ue(()=>import("./pe-wasm-27f8cbd6.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>sr(`esri/geometry/support/${e}`)})).then(t=>{ffe(t)}),Fz)}var _j,Bs,vj;(function(t){function e(n,o,a){ne.ensureCache.prepare();const l=vb(a),c=a===l,u=ne.ensureFloat64(l),h=ne._pe_geog_to_proj(ne.getPointer(n),o,u);return h&&u_(a,o,u,c),h}function i(n,o,a,l){switch(l){case Bs.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Bs.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ne.ensureCache.prepare();const c=vb(a),u=a===c,h=ne.ensureFloat64(c),p=ne._pe_proj_to_geog_center(ne.getPointer(n),o,h,l);return p&&u_(a,o,h,u),p}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(_j||(_j={})),function(t){function e(){t.PE_BUFFER_MAX=ne.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ne.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ne.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ne.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ne.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ne.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ne.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ne.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ne.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ne.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ne.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ne.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ne.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ne.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ne.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ne.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ne.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ne.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ne.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ne.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=ne.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=ne.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=ne.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ne.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ne.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ne.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ne.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ne.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ne.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ne.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ne.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ne.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Bs||(Bs={})),function(t){const e={},i={},r=f=>{if(f){const g=f.getType();switch(g){case Bs.PE_TYPE_GEOGCS:f=ne.castObject(f,ne.PeGeogcs);break;case Bs.PE_TYPE_PROJCS:f=ne.castObject(f,ne.PeProjcs);break;case Bs.PE_TYPE_GEOGTRAN:f=ne.castObject(f,ne.PeGeogtran);break;default:g&Bs.PE_TYPE_UNIT&&(f=ne.castObject(f,ne.PeUnit))}}return f};function s(){ne.PeFactory.prototype.initialize(null)}function n(f){return o(Bs.PE_TYPE_COORDSYS,f)}function o(f,g){let _=null,v=e[f];if(v||(v={},e[f]=v),v.hasOwnProperty(String(g)))_=v[g];else{const b=ne.PeFactory.prototype.factoryByType(f,g);ne.compare(b,ne.NULL)||(_=b,v[g]=_)}return _=r(_),_}function a(f,g){let _=null,v=i[f];if(v||(v={},i[f]=v),v.hasOwnProperty(g))_=v[g];else{const b=ne.PeFactory.prototype.fromString(f,g);ne.compare(b,ne.NULL)||(_=b,v[g]=_)}return _=r(_),_}function l(f){return o(Bs.PE_TYPE_GEOGCS,f)}function c(f){return o(Bs.PE_TYPE_GEOGTRAN,f)}function u(f){return ne.PeFactory.prototype.getCode(f)}function h(f){return o(Bs.PE_TYPE_PROJCS,f)}function p(f){return o(Bs.PE_TYPE_UNIT,f)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=h,t.unit=p}(vj||(vj={}));let pfe=null;var OF,bj,wj,xj,RF,Tj,$F,IF,Sj;function ffe(t){function e(n,o,a){n[o]=a(n[o])}ne=t,Bs.init(),OF.init(),RF.init(),$F.init(),IF.init(),pfe=class extends ne.PeGCSExtent{destroy(){ne.destroy(this)}};const i=[ne.PeDatum,ne.PeGeogcs,ne.PeGeogtran,ne.PeObject,ne.PeParameter,ne.PePrimem,ne.PeProjcs,ne.PeSpheroid,ne.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Bs.PE_NAME_MAX))});for(const n of[ne.PeGeogtran,ne.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Bs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ne.getValue(l,"*");a[c]=u?ne.wrapPointer(u,ne.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ne.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return u_(a,o,n.call(this)),a}),e(ne.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ne._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ne.getPointer(l);for(let h=1;h<c;h++)a.push(ne.wrapPointer(u+o*h,ne.PeGTlistExtendedGTs))}}return a}});const r=ne._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ne.getPointer(l);for(let h=1;h<c;h++)a.push(ne.wrapPointer(u+r*h,ne.PeHorizon))}}return o.set(n,a),a};e(ne.PeProjcs.prototype,"horizonGcsGenerate",s),e(ne.PeProjcs.prototype,"horizonPcsGenerate",s),ne.PeObject.prototype.toString=function(n=Bs.PE_STR_OPTS_NONE){ne.ensureCache.prepare();const o=ne.getPointer(this),a=ne.ensureInt8(new Array(Bs.PE_BUFFER_MAX));return ne.UTF8ToString(ne._pe_object_to_string_ext(o,n,a))}}function km(t){if(!t)return;const e=ne.getClass(t);if(!e)return;const i=ne.getCache(e);if(!i)return;const r=ne.getPointer(t);r&&delete i[r]}function K$(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(ne.ensureInt8(r));return i}function vb(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function u_(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=ne.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ne.getValue(i,"double"),t[n][1]=ne.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=ne.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ne._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let u=null;const h=new ne.PeInteger(c);try{const p=ne.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,h);if((c=h.val)&&(u=[p],c>1)){const f=ne.getPointer(p);for(let g=1;g<c;g++)u.push(ne.wrapPointer(f+e*g,ne.PeGTlistExtendedEntry))}}finally{ne.destroy(h)}return u}t.init=i,t.getGTlist=r})(OF||(OF={})),function(t){function e(i){if(i?.length){for(const r of i)km(r),r.getEntries().forEach(s=>{km(s);const n=s.getGeogtran();km(n),n.getParameters().forEach(km),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{km(o);const a=o.getDatum();km(a),km(a.getSpheroid()),km(o.getPrimem()),km(o.getUnit())})});ne.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(bj||(bj={})),function(t){function e(i,r,s,n,o){ne.ensureCache.prepare();const a=vb(s),l=s===a,c=ne.ensureFloat64(a);let u=0;n&&(u=ne.ensureFloat64(n));const h=ne._pe_geog_to_geog(ne.getPointer(i),r,c,u,o);return h&&u_(s,r,c,l),h}t.geogToGeog=e}(wj||(wj={})),function(t){const e=(c,u,h,p,f,g)=>{let _,v;switch(ne.ensureCache.prepare(),c){case"dd":_=ne._pe_geog_to_dd,v=Bs.PE_DD_MAX;break;case"ddm":_=ne._pe_geog_to_ddm,v=Bs.PE_DDM_MAX;break;case"dms":_=ne._pe_geog_to_dms,v=Bs.PE_DMS_MAX}let b=0;u&&(b=ne.getPointer(u));const w=vb(p),T=ne.ensureFloat64(w),S=K$(h,v),A=_(b,h,T,f,ne.ensureInt32(S));if(A)for(let P=0;P<h;P++)g[P]=ne.UTF8ToString(S[P]);return A},i=(c,u,h,p,f)=>{let g;switch(ne.ensureCache.prepare(),c){case"dd":g=ne._pe_dd_to_geog;break;case"ddm":g=ne._pe_ddm_to_geog;break;case"dms":g=ne._pe_dms_to_geog}let _=0;u&&(_=ne.getPointer(u));const v=p.map(S=>ne.ensureString(S)),b=ne.ensureInt32(v),w=ne.ensureFloat64(new Array(2*h)),T=g(_,h,b,w);return T&&u_(f,h,w),T};function r(c,u,h,p,f){return e("dms",c,u,h,p,f)}function s(c,u,h,p){return i("dms",c,u,h,p)}function n(c,u,h,p,f){return e("ddm",c,u,h,p,f)}function o(c,u,h,p){return i("ddm",c,u,h,p)}function a(c,u,h,p,f){return e("dd",c,u,h,p,f)}function l(c,u,h,p){return i("dd",c,u,h,p)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(xj||(xj={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ne.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ne.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,u){ne.ensureCache.prepare();let h=0;s&&(h=ne.getPointer(s));const p=vb(o),f=ne.ensureFloat64(p),g=K$(n,Bs.PE_MGRS_MAX),_=ne.ensureInt32(g),v=ne._pe_geog_to_mgrs_extended(h,n,f,a,l,c,_);if(v)for(let b=0;b<n;b++)u[b]=ne.UTF8ToString(g[b]);return v}function r(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const u=o.map(g=>ne.ensureString(g)),h=ne.ensureInt32(u),p=ne.ensureFloat64(new Array(2*n)),f=ne._pe_mgrs_to_geog_extended(c,n,h,a,p);return f&&u_(l,n,p),f}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(RF||(RF={})),function(t){function e(r,s,n,o,a,l,c){ne.ensureCache.prepare();let u=0;r&&(u=ne.getPointer(r));const h=vb(n),p=ne.ensureFloat64(h),f=K$(s,Bs.PE_MGRS_MAX),g=ne.ensureInt32(f),_=ne._pe_geog_to_usng(u,s,p,o,a,l,g);if(_)for(let v=0;v<s;v++)c[v]=ne.UTF8ToString(f[v]);return _}function i(r,s,n,o){ne.ensureCache.prepare();let a=0;r&&(a=ne.getPointer(r));const l=n.map(p=>ne.ensureString(p)),c=ne.ensureInt32(l),u=ne.ensureFloat64(new Array(2*s)),h=ne._pe_usng_to_geog(a,s,c,u);return h&&u_(o,s,u),h}t.geogToUsng=e,t.usngToGeog=i}(Tj||(Tj={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ne.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const u=vb(o),h=ne.ensureFloat64(u),p=K$(n,Bs.PE_UTM_MAX),f=ne.ensureInt32(p),g=ne._pe_geog_to_utm(c,n,h,a,f);if(g)for(let _=0;_<n;_++)l[_]=ne.UTF8ToString(p[_]);return g}function r(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const u=o.map(g=>ne.ensureString(g)),h=ne.ensureInt32(u),p=ne.ensureFloat64(new Array(2*n)),f=ne._pe_utm_to_geog(c,n,h,a,p);return f&&u_(l,n,p),f}t.init=e,t.geogToUtm=i,t.utmToGeog=r}($F||($F={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ne.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ne.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=ne.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(IF||(IF={})),function(t){function e(){return ne.PeVersion.prototype.version_string()}t.versionString=e}(Sj||(Sj={}));const YIe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return _j},get PeDefs(){return Bs},get PeFactory(){return vj},get PeGCSExtent(){return pfe},get PeGTTransformations(){return wj},get PeGTlistExtended(){return OF},get PeGTlistExtendedEntry(){return bj},get PeNotationDms(){return xj},get PeNotationMgrs(){return RF},get PeNotationUsng(){return Tj},get PeNotationUtm(){return $F},get PePCSInfo(){return IF},get PeVersion(){return Sj},_init:ffe,get _pe(){return ne},isLoaded:hfe,isSupported:WIe,load:dfe},Symbol.toStringTag,{value:"Module"}));var bc;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(bc||(bc={}));let y;const L={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(y=2e3;y<=2045;y++)L[y]=0;for(y=2056;y<=2065;y++)L[y]=0;for(y=2067;y<=2135;y++)L[y]=0;for(y=2137;y<=2154;y++)L[y]=0;for(y=2161;y<=2170;y++)L[y]=0;for(y=2172;y<=2193;y++)L[y]=0;for(y=2195;y<=2198;y++)L[y]=0;for(y=2200;y<=2203;y++)L[y]=0;for(y=2205;y<=2217;y++)L[y]=0;for(y=2222;y<=2224;y++)L[y]=1;for(y=2225;y<=2250;y++)L[y]=2;for(y=2251;y<=2253;y++)L[y]=1;for(y=2257;y<=2264;y++)L[y]=2;for(y=2274;y<=2279;y++)L[y]=2;for(y=2280;y<=2282;y++)L[y]=1;for(y=2283;y<=2289;y++)L[y]=2;for(y=2290;y<=2292;y++)L[y]=0;for(y=2308;y<=2313;y++)L[y]=0;for(y=2315;y<=2491;y++)L[y]=0;for(y=2494;y<=2866;y++)L[y]=0;for(y=2867;y<=2869;y++)L[y]=1;for(y=2870;y<=2888;y++)L[y]=2;for(y=2891;y<=2895;y++)L[y]=2;for(y=2896;y<=2898;y++)L[y]=1;for(y=2902;y<=2908;y++)L[y]=2;for(y=2915;y<=2920;y++)L[y]=2;for(y=2921;y<=2923;y++)L[y]=1;for(y=2924;y<=2930;y++)L[y]=2;for(y=2931;y<=2962;y++)L[y]=0;for(y=2964;y<=2968;y++)L[y]=2;for(y=2969;y<=2973;y++)L[y]=0;for(y=2975;y<=2991;y++)L[y]=0;for(y=2995;y<=3051;y++)L[y]=0;for(y=3054;y<=3079;y++)L[y]=0;for(y=3081;y<=3088;y++)L[y]=0;for(y=3092;y<=3101;y++)L[y]=0;for(y=3106;y<=3138;y++)L[y]=0;for(y=3146;y<=3151;y++)L[y]=0;for(y=3153;y<=3166;y++)L[y]=0;for(y=3168;y<=3172;y++)L[y]=0;for(y=3174;y<=3203;y++)L[y]=0;for(y=3294;y<=3358;y++)L[y]=0;for(y=3367;y<=3403;y++)L[y]=0;for(y=3408;y<=3416;y++)L[y]=0;for(y=3417;y<=3438;y++)L[y]=2;for(y=3441;y<=3446;y++)L[y]=2;for(y=3447;y<=3450;y++)L[y]=0;for(y=3451;y<=3459;y++)L[y]=2;for(y=3460;y<=3478;y++)L[y]=0;for(y=3554;y<=3559;y++)L[y]=0;for(y=3560;y<=3570;y++)L[y]=2;for(y=3571;y<=3581;y++)L[y]=0;for(y=3594;y<=3597;y++)L[y]=0;for(y=3601;y<=3604;y++)L[y]=0;for(y=3637;y<=3639;y++)L[y]=0;for(y=3665;y<=3667;y++)L[y]=0;for(y=3693;y<=3695;y++)L[y]=0;for(y=3701;y<=3727;y++)L[y]=0;for(y=3728;y<=3739;y++)L[y]=2;for(y=3740;y<=3751;y++)L[y]=0;for(y=3753;y<=3760;y++)L[y]=2;for(y=3761;y<=3773;y++)L[y]=0;for(y=3775;y<=3777;y++)L[y]=0;for(y=3779;y<=3781;y++)L[y]=0;for(y=3783;y<=3785;y++)L[y]=0;for(y=3788;y<=3791;y++)L[y]=0;for(y=3797;y<=3802;y++)L[y]=0;for(y=3814;y<=3816;y++)L[y]=0;for(y=3825;y<=3829;y++)L[y]=0;for(y=3832;y<=3841;y++)L[y]=0;for(y=3844;y<=3852;y++)L[y]=0;for(y=3873;y<=3885;y++)L[y]=0;for(y=3890;y<=3893;y++)L[y]=0;for(y=3907;y<=3912;y++)L[y]=0;for(y=3942;y<=3950;y++)L[y]=0;for(y=3968;y<=3970;y++)L[y]=0;for(y=3973;y<=3976;y++)L[y]=0;for(y=3986;y<=3989;y++)L[y]=0;for(y=3994;y<=3997;y++)L[y]=0;for(y=4048;y<=4051;y++)L[y]=0;for(y=4056;y<=4063;y++)L[y]=0;for(y=4093;y<=4096;y++)L[y]=0;for(y=4390;y<=4398;y++)L[y]=0;for(y=4399;y<=4413;y++)L[y]=2;for(y=4418;y<=4433;y++)L[y]=2;for(y=4455;y<=4457;y++)L[y]=2;for(y=4484;y<=4489;y++)L[y]=0;for(y=4491;y<=4554;y++)L[y]=0;for(y=4568;y<=4589;y++)L[y]=0;for(y=4652;y<=4656;y++)L[y]=0;for(y=4766;y<=4800;y++)L[y]=0;for(y=5014;y<=5016;y++)L[y]=0;for(y=5069;y<=5072;y++)L[y]=0;for(y=5105;y<=5130;y++)L[y]=0;for(y=5167;y<=5188;y++)L[y]=0;for(y=5253;y<=5259;y++)L[y]=0;for(y=5269;y<=5275;y++)L[y]=0;for(y=5292;y<=5311;y++)L[y]=0;for(y=5329;y<=5331;y++)L[y]=0;for(y=5343;y<=5349;y++)L[y]=0;for(y=5355;y<=5357;y++)L[y]=0;for(y=5387;y<=5389;y++)L[y]=0;for(y=5459;y<=5463;y++)L[y]=0;for(y=5479;y<=5482;y++)L[y]=0;for(y=5518;y<=5520;y++)L[y]=0;for(y=5530;y<=5539;y++)L[y]=0;for(y=5550;y<=5552;y++)L[y]=0;for(y=5562;y<=5583;y++)L[y]=0;for(y=5623;y<=5625;y++)L[y]=2;for(y=5631;y<=5639;y++)L[y]=0;for(y=5649;y<=5653;y++)L[y]=0;for(y=5663;y<=5680;y++)L[y]=0;for(y=5682;y<=5685;y++)L[y]=0;for(y=5875;y<=5877;y++)L[y]=0;for(y=5896;y<=5899;y++)L[y]=0;for(y=5921;y<=5940;y++)L[y]=0;for(y=6050;y<=6125;y++)L[y]=0;for(y=6244;y<=6275;y++)L[y]=0;for(y=6328;y<=6348;y++)L[y]=0;for(y=6350;y<=6356;y++)L[y]=0;for(y=6366;y<=6372;y++)L[y]=0;for(y=6381;y<=6387;y++)L[y]=0;for(y=6393;y<=6404;y++)L[y]=0;for(y=6480;y<=6483;y++)L[y]=0;for(y=6511;y<=6514;y++)L[y]=0;for(y=6579;y<=6581;y++)L[y]=0;for(y=6619;y<=6624;y++)L[y]=0;for(y=6625;y<=6627;y++)L[y]=2;for(y=6628;y<=6632;y++)L[y]=0;for(y=6634;y<=6637;y++)L[y]=0;for(y=6669;y<=6692;y++)L[y]=0;for(y=6707;y<=6709;y++)L[y]=0;for(y=6720;y<=6723;y++)L[y]=0;for(y=6732;y<=6738;y++)L[y]=0;for(y=6931;y<=6933;y++)L[y]=0;for(y=6956;y<=6959;y++)L[y]=0;for(y=7005;y<=7007;y++)L[y]=0;for(y=7057;y<=7070;y++)L[y]=2;for(y=7074;y<=7082;y++)L[y]=0;for(y=7109;y<=7118;y++)L[y]=0;for(y=7119;y<=7127;y++)L[y]=1;for(y=7374;y<=7376;y++)L[y]=0;for(y=7528;y<=7586;y++)L[y]=0;for(y=7587;y<=7645;y++)L[y]=2;for(y=7692;y<=7696;y++)L[y]=0;for(y=7755;y<=7787;y++)L[y]=0;for(y=7791;y<=7795;y++)L[y]=0;for(y=7799;y<=7801;y++)L[y]=0;for(y=7803;y<=7805;y++)L[y]=0;for(y=7825;y<=7831;y++)L[y]=0;for(y=7845;y<=7859;y++)L[y]=0;for(y=8013;y<=8032;y++)L[y]=0;for(y=8065;y<=8068;y++)L[y]=1;for(y=8518;y<=8529;y++)L[y]=2;for(y=8533;y<=8536;y++)L[y]=2;for(y=8538;y<=8540;y++)L[y]=2;for(y=8677;y<=8679;y++)L[y]=0;for(y=8836;y<=8840;y++)L[y]=0;for(y=8857;y<=8859;y++)L[y]=0;for(y=8908;y<=8910;y++)L[y]=0;for(y=9154;y<=9159;y++)L[y]=0;for(y=9205;y<=9218;y++)L[y]=0;for(y=9271;y<=9273;y++)L[y]=0;for(y=9295;y<=9297;y++)L[y]=0;for(y=9356;y<=9360;y++)L[y]=0;for(y=9404;y<=9407;y++)L[y]=0;for(y=9476;y<=9482;y++)L[y]=0;for(y=9487;y<=9494;y++)L[y]=0;for(y=9697;y<=9699;y++)L[y]=0;for(y=9821;y<=9865;y++)L[y]=0;for(y=10285;y<=10291;y++)L[y]=0;for(y=10314;y<=10317;y++)L[y]=0;for(y=10448;y<=10465;y++)L[y]=0;for(y=10731;y<=10733;y++)L[y]=0;for(y=11114;y<=11118;y++)L[y]=0;for(y=20004;y<=20032;y++)L[y]=0;for(y=20047;y<=20049;y++)L[y]=0;for(y=20062;y<=20092;y++)L[y]=0;for(y=20135;y<=20138;y++)L[y]=0;for(y=20248;y<=20258;y++)L[y]=0;for(y=20348;y<=20358;y++)L[y]=0;for(y=20436;y<=20440;y++)L[y]=0;for(y=20822;y<=20824;y++)L[y]=0;for(y=20904;y<=20932;y++)L[y]=0;for(y=20934;y<=20936;y++)L[y]=0;for(y=21004;y<=21032;y++)L[y]=0;for(y=21035;y<=21037;y++)L[y]=0;for(y=21095;y<=21097;y++)L[y]=0;for(y=21148;y<=21150;y++)L[y]=0;for(y=21207;y<=21264;y++)L[y]=0;for(y=21307;y<=21364;y++)L[y]=0;for(y=21413;y<=21423;y++)L[y]=0;for(y=21453;y<=21463;y++)L[y]=0;for(y=21473;y<=21483;y++)L[y]=0;for(y=21780;y<=21782;y++)L[y]=0;for(y=21891;y<=21894;y++)L[y]=0;for(y=21896;y<=21899;y++)L[y]=0;for(y=22171;y<=22177;y++)L[y]=0;for(y=22181;y<=22187;y++)L[y]=0;for(y=22191;y<=22197;y++)L[y]=0;for(y=22207;y<=22222;y++)L[y]=0;for(y=22229;y<=22232;y++)L[y]=0;for(y=22234;y<=22236;y++)L[y]=0;for(y=22243;y<=22250;y++)L[y]=0;for(y=22262;y<=22265;y++)L[y]=0;for(y=22307;y<=22322;y++)L[y]=0;for(y=22348;y<=22357;y++)L[y]=0;for(y=22407;y<=22422;y++)L[y]=0;for(y=22462;y<=22465;y++)L[y]=0;for(y=22521;y<=22525;y++)L[y]=0;for(y=22607;y<=22622;y++)L[y]=0;for(y=22641;y<=22646;y++)L[y]=0;for(y=22648;y<=22657;y++)L[y]=0;for(y=22707;y<=22722;y++)L[y]=0;for(y=22762;y<=22765;y++)L[y]=0;for(y=22807;y<=22822;y++)L[y]=0;for(y=22991;y<=22994;y++)L[y]=0;for(y=23028;y<=23038;y++)L[y]=0;for(y=23301;y<=23333;y++)L[y]=2;for(y=23830;y<=23853;y++)L[y]=0;for(y=23866;y<=23872;y++)L[y]=0;for(y=23877;y<=23884;y++)L[y]=0;for(y=23886;y<=23894;y++)L[y]=0;for(y=23946;y<=23948;y++)L[y]=0;for(y=24311;y<=24313;y++)L[y]=0;for(y=24342;y<=24347;y++)L[y]=0;for(y=24370;y<=24374;y++)L[y]=10;for(y=24375;y<=24381;y++)L[y]=0;for(y=24718;y<=24721;y++)L[y]=0;for(y=24817;y<=24821;y++)L[y]=0;for(y=24877;y<=24882;y++)L[y]=0;for(y=24891;y<=24893;y++)L[y]=0;for(y=25391;y<=25395;y++)L[y]=0;for(y=25828;y<=25838;y++)L[y]=0;for(y=26191;y<=26195;y++)L[y]=0;for(y=26391;y<=26393;y++)L[y]=0;for(y=26701;y<=26722;y++)L[y]=0;for(y=26729;y<=26799;y++)L[y]=2;for(y=26801;y<=26803;y++)L[y]=2;for(y=26811;y<=26813;y++)L[y]=2;for(y=26847;y<=26870;y++)L[y]=2;for(y=26891;y<=26899;y++)L[y]=0;for(y=26901;y<=26923;y++)L[y]=0;for(y=26929;y<=26946;y++)L[y]=0;for(y=26948;y<=26998;y++)L[y]=0;for(y=27037;y<=27040;y++)L[y]=0;for(y=27205;y<=27232;y++)L[y]=0;for(y=27258;y<=27260;y++)L[y]=0;for(y=27391;y<=27398;y++)L[y]=0;for(y=27561;y<=27564;y++)L[y]=0;for(y=27571;y<=27574;y++)L[y]=0;for(y=27581;y<=27584;y++)L[y]=0;for(y=27591;y<=27594;y++)L[y]=0;for(y=27700;y<=27707;y++)L[y]=0;for(y=28191;y<=28193;y++)L[y]=0;for(y=28348;y<=28358;y++)L[y]=0;for(y=28402;y<=28432;y++)L[y]=0;for(y=28462;y<=28492;y++)L[y]=0;for(y=29118;y<=29122;y++)L[y]=0;for(y=29168;y<=29172;y++)L[y]=0;for(y=29177;y<=29185;y++)L[y]=0;for(y=29187;y<=29195;y++)L[y]=0;for(y=29900;y<=29903;y++)L[y]=0;for(y=30161;y<=30179;y++)L[y]=0;for(y=30491;y<=30494;y++)L[y]=0;for(y=30729;y<=30732;y++)L[y]=0;for(y=31251;y<=31259;y++)L[y]=0;for(y=31265;y<=31268;y++)L[y]=0;for(y=31275;y<=31279;y++)L[y]=0;for(y=31281;y<=31297;y++)L[y]=0;for(y=31461;y<=31469;y++)L[y]=0;for(y=31491;y<=31495;y++)L[y]=0;for(y=31917;y<=31922;y++)L[y]=0;for(y=31965;y<=32e3;y++)L[y]=0;for(y=32001;y<=32003;y++)L[y]=2;for(y=32005;y<=32031;y++)L[y]=2;for(y=32033;y<=32060;y++)L[y]=2;for(y=32064;y<=32067;y++)L[y]=2;for(y=32074;y<=32077;y++)L[y]=2;for(y=32081;y<=32086;y++)L[y]=0;for(y=32107;y<=32130;y++)L[y]=0;for(y=32133;y<=32159;y++)L[y]=0;for(y=32164;y<=32167;y++)L[y]=2;for(y=32180;y<=32199;y++)L[y]=0;for(y=32201;y<=32260;y++)L[y]=0;for(y=32301;y<=32360;y++)L[y]=0;for(y=32401;y<=32460;y++)L[y]=0;for(y=32501;y<=32560;y++)L[y]=0;for(y=32601;y<=32662;y++)L[y]=0;for(y=32664;y<=32667;y++)L[y]=2;for(y=32701;y<=32761;y++)L[y]=0;for(y=53001;y<=53004;y++)L[y]=0;for(y=53008;y<=53019;y++)L[y]=0;for(y=53021;y<=53032;y++)L[y]=0;for(y=53034;y<=53037;y++)L[y]=0;for(y=53042;y<=53046;y++)L[y]=0;for(y=53074;y<=53080;y++)L[y]=0;for(y=54001;y<=54004;y++)L[y]=0;for(y=54008;y<=54019;y++)L[y]=0;for(y=54021;y<=54032;y++)L[y]=0;for(y=54034;y<=54037;y++)L[y]=0;for(y=54042;y<=54046;y++)L[y]=0;for(y=54048;y<=54053;y++)L[y]=0;for(y=54074;y<=54080;y++)L[y]=0;for(y=54098;y<=54101;y++)L[y]=0;for(y=102001;y<=102040;y++)L[y]=0;for(y=102042;y<=102063;y++)L[y]=0;for(y=102065;y<=102067;y++)L[y]=0;for(y=102070;y<=102117;y++)L[y]=0;for(y=102122;y<=102216;y++)L[y]=0;for(y=102221;y<=102377;y++)L[y]=0;for(y=102382;y<=102388;y++)L[y]=0;for(y=102389;y<=102398;y++)L[y]=2;for(y=102399;y<=102444;y++)L[y]=0;for(y=102445;y<=102447;y++)L[y]=2;for(y=102448;y<=102458;y++)L[y]=0;for(y=102459;y<=102468;y++)L[y]=2;for(y=102469;y<=102499;y++)L[y]=0;for(y=102500;y<=102519;y++)L[y]=1;for(y=102520;y<=102524;y++)L[y]=0;for(y=102525;y<=102529;y++)L[y]=2;for(y=102530;y<=102588;y++)L[y]=0;for(y=102590;y<=102598;y++)L[y]=0;for(y=102601;y<=102603;y++)L[y]=0;for(y=102605;y<=102628;y++)L[y]=0;for(y=102629;y<=102646;y++)L[y]=2;for(y=102648;y<=102700;y++)L[y]=2;for(y=102701;y<=102703;y++)L[y]=0;for(y=102707;y<=102730;y++)L[y]=2;for(y=102733;y<=102758;y++)L[y]=2;for(y=102767;y<=102900;y++)L[y]=0;for(y=102901;y<=102933;y++)L[y]=2;for(y=102934;y<=102950;y++)L[y]=13;for(y=102951;y<=102963;y++)L[y]=0;for(y=102965;y<=102969;y++)L[y]=0;for(y=102971;y<=102973;y++)L[y]=0;for(y=102975;y<=102989;y++)L[y]=0;for(y=102990;y<=102992;y++)L[y]=1;for(y=102997;y<=103002;y++)L[y]=0;for(y=103003;y<=103008;y++)L[y]=2;for(y=103009;y<=103011;y++)L[y]=0;for(y=103012;y<=103014;y++)L[y]=2;for(y=103019;y<=103021;y++)L[y]=0;for(y=103022;y<=103024;y++)L[y]=2;for(y=103029;y<=103031;y++)L[y]=0;for(y=103032;y<=103034;y++)L[y]=2;for(y=103065;y<=103068;y++)L[y]=0;for(y=103074;y<=103076;y++)L[y]=0;for(y=103077;y<=103079;y++)L[y]=1;for(y=103080;y<=103082;y++)L[y]=0;for(y=103083;y<=103085;y++)L[y]=2;for(y=103090;y<=103093;y++)L[y]=0;for(y=103097;y<=103099;y++)L[y]=0;for(y=103100;y<=103102;y++)L[y]=2;for(y=103107;y<=103109;y++)L[y]=0;for(y=103110;y<=103112;y++)L[y]=2;for(y=103113;y<=103116;y++)L[y]=0;for(y=103117;y<=103120;y++)L[y]=2;for(y=103153;y<=103157;y++)L[y]=0;for(y=103158;y<=103162;y++)L[y]=2;for(y=103163;y<=103165;y++)L[y]=0;for(y=103166;y<=103168;y++)L[y]=1;for(y=103169;y<=103171;y++)L[y]=2;for(y=103186;y<=103188;y++)L[y]=0;for(y=103189;y<=103191;y++)L[y]=2;for(y=103192;y<=103195;y++)L[y]=0;for(y=103196;y<=103199;y++)L[y]=2;for(y=103200;y<=103224;y++)L[y]=0;for(y=103225;y<=103227;y++)L[y]=1;for(y=103232;y<=103237;y++)L[y]=0;for(y=103238;y<=103243;y++)L[y]=2;for(y=103244;y<=103246;y++)L[y]=0;for(y=103247;y<=103249;y++)L[y]=2;for(y=103254;y<=103256;y++)L[y]=0;for(y=103257;y<=103259;y++)L[y]=2;for(y=103264;y<=103266;y++)L[y]=0;for(y=103267;y<=103269;y++)L[y]=2;for(y=103300;y<=103375;y++)L[y]=0;for(y=103381;y<=103383;y++)L[y]=0;for(y=103384;y<=103386;y++)L[y]=1;for(y=103387;y<=103389;y++)L[y]=0;for(y=103390;y<=103392;y++)L[y]=2;for(y=103397;y<=103399;y++)L[y]=0;for(y=103400;y<=103471;y++)L[y]=2;for(y=103476;y<=103478;y++)L[y]=0;for(y=103479;y<=103481;y++)L[y]=2;for(y=103486;y<=103488;y++)L[y]=0;for(y=103489;y<=103491;y++)L[y]=2;for(y=103492;y<=103495;y++)L[y]=0;for(y=103496;y<=103499;y++)L[y]=2;for(y=103528;y<=103543;y++)L[y]=0;for(y=103544;y<=103548;y++)L[y]=2;for(y=103549;y<=103551;y++)L[y]=0;for(y=103552;y<=103554;y++)L[y]=1;for(y=103555;y<=103557;y++)L[y]=2;for(y=103558;y<=103560;y++)L[y]=0;for(y=103571;y<=103573;y++)L[y]=0;for(y=103574;y<=103576;y++)L[y]=2;for(y=103577;y<=103580;y++)L[y]=0;for(y=103581;y<=103583;y++)L[y]=2;for(y=103595;y<=103694;y++)L[y]=0;for(y=103696;y<=103699;y++)L[y]=0;for(y=103700;y<=103793;y++)L[y]=2;for(y=103794;y<=103890;y++)L[y]=0;for(y=103891;y<=103896;y++)L[y]=2;for(y=103900;y<=103971;y++)L[y]=2;for(y=103972;y<=103977;y++)L[y]=0;for(y=112e3;y<=112101;y++)L[y]=0;const mfe=[102100,102113,3857,3785],XIe=[104905,104971],ZIe=[4326,...mfe,...XIe],pee='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',e3=[-20037508342788905e-9,20037508342788905e-9],t3=[-20037508342787e-6,20037508342787e-6],gfe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:e3,origin:t3,dx:1e-5},102100:{wkTemplate:pee,valid:e3,origin:t3,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:e3,origin:t3,dx:1e-5},3857:{wkTemplate:pee,valid:e3,origin:t3,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function ls(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||cp(t)&&cp(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function Yg(t){const e=t?.wkid;return e!=null&&e>=2e3&&gfe[e]||null}function fee(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function GR(t){if(!jd(t))return!1;const{wkid:e}=t;if(e)return L[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function Sw(t){return!(ex(t)||tx(t))}function c0(t){return t?.wkid===4326}function iPt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function G2(t){return t?.wkid===bc.CGCS2000}function cp(t){const e=t?.wkid;return e!=null&&e>=2e3&&mfe.includes(e)}function Cw(t){return t?.wkid===32662}function j2(t){return t===bc.GCSMARS2000||t===bc.GCSMARS2000_SPHERE}function ex(t){return j2(t?.wkid)}function H2(t){return t===bc.GCSMOON2000}function tx(t){return H2(t?.wkid)}function JIe(t){const e=t?.wkid;return e!=null&&e>=2e3&&ZIe.includes(e)}function jd(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const yfe={wkid:4326,wkt:ek(gfe[4326].wkTemplate,{Central_Meridian:"0.0"})},_fe={wkid:102100,latestWkid:3857},QIe={wkid:32662};function gY(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const vfe=gY(ji),hk=gY(tp),dk=gY(l0),bfe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ji.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},KIe=hk.wkt.toUpperCase(),eLe=dk.wkt.toUpperCase();function er(t){if(t!=null&&jd(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(j2(e))return tp;const r=i?.toUpperCase();if(i&&r===KIe)return tp;if(H2(e)||r&&r===eLe)return l0}return ji}function rPt(t){return j2(t)?tp:H2(t)?l0:ji}function $O(t){return ls(t,vfe)}function H_(t){return $O(t)||ls(t,hk)||ls(t,dk)}const yY=39.37,tLe=ji.radius*Math.PI/200,wfe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,Zb=L,xfe=/UNIT\[([^\]]+)]/i,iLe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),rLe=rl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Mp=t=>t*t,B0=t=>t*t*t,IO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Mp(.001)},"square-centimeters":{inBaseUnits:Mp(.01)},"square-decimeters":{inBaseUnits:Mp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Mp(1e3)},"square-inches":{inBaseUnits:Mp(.0254)},"square-feet":{inBaseUnits:Mp(.3048)},"square-yards":{inBaseUnits:Mp(.9144)},"square-miles":{inBaseUnits:Mp(1609.344)},"square-us-feet":{inBaseUnits:Mp(1200/3937)},acres:{inBaseUnits:.0015625*Mp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*B0(.001)},"cubic-centimeters":{inBaseUnits:1e3*B0(.01)},"cubic-decimeters":{inBaseUnits:1e3*B0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*B0(1e3)},"cubic-inches":{inBaseUnits:1e3*B0(.0254)},"cubic-feet":{inBaseUnits:1e3*B0(.3048)},"cubic-yards":{inBaseUnits:1e3*B0(.9144)},"cubic-miles":{inBaseUnits:1e3*B0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},sLe=(()=>{const t={};for(const e in IO)for(const i in IO[e].units)t[i]=e;return t})();function nLe(t,e,i){return t*IO[i].units[e].inBaseUnits}function oLe(t,e,i){return t/IO[i].units[e].inBaseUnits}const Tfe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],aLe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function Ew(t){const e=sLe[t];if(!e)throw new Error("unknown type");return e}function mee(t,e=null){return e=e||Ew(t),IO[e].baseUnit===t}function Cn(t,e,i){if(e===i)return t;const r=Ew(e);if(r!==Ew(i))throw new Error("incompatible units");const s=mee(e,r)?t:nLe(t,e,r);return mee(i,r)?s:oLe(s,i,r)}function lLe(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function sPt(t){return lLe(t)}function nPt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function oPt(t,e,i){switch(i){case"metric":return cLe(t,e);case"imperial":return hLe(t,e);default:return i}}function aPt(t,e,i){switch(i){case"metric":return uLe(t,e);case"imperial":return dLe(t,e);default:return i}}function cLe(t,e){const i=Cn(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function uLe(t,e){const i=Cn(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function hLe(t,e){const i=Cn(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function dLe(t,e){const i=Cn(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function lPt(t,e){const i=Cn(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function cPt(t,e){const i=Cn(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function pLe(t,e,i){return Cn(t,e,"meters")/(i*Math.PI/180)}function Sfe(t){return rLe.fromJSON(t.toLowerCase())||null}function LO(t){if(t!=null&&!Sw(t))return 1;const e=sl(t);return e>1e5?1:e}function Cfe(t){return sl(t)>=er(t).metersPerDegree?"meters":jR(t)}function sl(t,e=ji.metersPerDegree){return fLe(t,!0)??e}function fLe(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let s=null;if(i){if(j2(i))return tp.metersPerDegree;if(H2(i))return l0.metersPerDegree;s=Zb.values[Zb[i]],!s&&e&&iLe.has(i)&&(s=tLe)}else r&&(Ofe(r)?s=gee(wfe.exec(r),s):Pfe(r)&&(s=gee(xfe.exec(r),s)));return s}function Cj(t){return GR(t)?1:sl(t)}function gee(t,e){return t?.[1]?Efe(t[1]):e}function Efe(t){return parseFloat(t.split(",")[1])}function jR(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=Zb.units[Zb[e]];else if(i){const s=Ofe(i)?wfe:Pfe(i)?xfe:null;if(s){const n=s.exec(i);n?.[1]&&(r=gLe(n[1]))}}return r!=null?Sfe(r):null}function Afe(t){const e=jR(t);return e!=null&&Tfe.includes(e)?e:null}function Mfe(t){const e=Cfe(t);return e!=null&&Tfe.includes(e)?e:null}function uPt(t){const e=jR(t);return e==null?null:aLe.get(e)}function Pfe(t){return/^GEOCCS/i.test(t)}function Ofe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const mLe=1e-7;function gLe(t){let i=/[\\"']{1}([^\\"']+)/.exec(t)?.[1];if(!i||!Zb.units.includes(i)){const r=Efe(t);i=null;const s=Zb.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<mLe){i=Zb.units[n];break}}return i}function hPt(t){const e=jR(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const yLe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},_Le={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},vLe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},dPt=rl()(yLe),pPt=rl()(_Le),fPt=rl()(vLe);function Ut(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=cpe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var Kp;let _r=Kp=class extends Me{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Kp.WebMercator;if(t.wkid===4326)return Kp.WGS84}const e=new Kp;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return c0(this)}get isWebMercator(){return cp(this)}get isGeographic(){return GR(this)}get isWrappable(){return JIe(this)}get metersPerUnit(){return sl(this)}get unit(){return jR(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Kp.WGS84)return new Kp(yfe);if(this===Kp.WebMercator)return new Kp(_fe);const t=new Kp;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ge(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return ls(this,t)}toJSON(t){return this.write(void 0,t)}};_r.GCS_NAD_1927=null,_r.WGS84=null,_r.WebMercator=null,_r.PlateCarree=null,d([m({readOnly:!0})],_r.prototype,"isWGS84",null),d([m({readOnly:!0})],_r.prototype,"isWebMercator",null),d([m({readOnly:!0})],_r.prototype,"isGeographic",null),d([m({readOnly:!0})],_r.prototype,"isWrappable",null),d([m({type:Rr,json:{write:!0}})],_r.prototype,"latestWkid",void 0),d([m({readOnly:!0})],_r.prototype,"metersPerUnit",null),d([m({readOnly:!0})],_r.prototype,"unit",null),d([m({type:Rr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],_r.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],_r.prototype,"wkt",void 0),d([Ut("wkt"),Ut("web-scene","wkt")],_r.prototype,"writeWkt",null),d([m({type:String,json:{write:!1}})],_r.prototype,"wkt2",void 0),d([m({type:Rr,json:{write:!0}})],_r.prototype,"vcsWkid",void 0),d([m({type:Rr,json:{write:!0}})],_r.prototype,"latestVcsWkid",void 0),d([m()],_r.prototype,"imageCoordinateSystem",void 0),_r=Kp=d([U("esri.geometry.SpatialReference")],_r),_r.prototype.toJSON.isDefaultToJSON=!0,_r.GCS_NAD_1927=new _r({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),_r.WGS84=new _r(yfe),_r.WebMercator=new _r(_fe),_r.PlateCarree=new _r(QIe),Object.freeze&&(Object.freeze(_r.GCS_NAD_1927),Object.freeze(_r.WGS84),Object.freeze(_r.WebMercator),Object.freeze(_r.PlateCarree));const We=_r;let ef=class extends Me{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=We.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof We)return e;if(e!=null){const r=new We;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};d([m()],ef.prototype,"type",void 0),d([m({readOnly:!0})],ef.prototype,"cache",null),d([m({readOnly:!0})],ef.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ef.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ef.prototype,"hasZ",void 0),d([m({type:We,json:{write:!0},value:We.WGS84})],ef.prototype,"spatialReference",void 0),d([_i("spatialReference")],ef.prototype,"readSpatialReference",null),ef=d([U("esri.geometry.Geometry")],ef);const T0=ef,bLe=Object.prototype.toString;function wLe(t){const e="__accessorMetadata__"in t?mo(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return xLe.apply(this,i)}}function xLe(t,e,i,r){ik(t,e).cast=r}function TLe(t){return(e,i)=>{ik(e,t).cast=e[i]}}function cr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&bLe.call(t[0])==="[object Function]"?wLe(t[0]):t.length===1&&typeof t[0]=="string"?TLe(t[0]):void 0}const SLe=57.29577951308232,CLe=.017453292519943;function yee(t){return t*SLe}function _ee(t){return t*CLe}function vee(t){return t/ji.radius}function LF(t){return Math.PI/2-2*Math.atan(Math.exp(-t/ji.radius))}function Ej(t){return t.wkid!=null||t.wkt!=null}const kz=[0,0];function DF(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,kz,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,kz,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,kz,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const h=a[u];c=[],l.push(c);for(let p=0;p<h.length;p++)c.push(e(h[p][0],h[p][1],[0,0],r)),h[p].length>2&&c[p].push(h[p][2]),h[p].length>3&&c[p].push(h[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function rD(t,e){const i=t&&(Ej(t)?t:t.spatialReference),r=e&&(Ej(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!ls(r,i)||cp(r)&&c0(i)||cp(i)&&c0(r))}function HR(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(Ej(e)?e:e.spatialReference);return rD(i,r)?ls(i,r)?ge(t):cp(r)?DF(t,MS,We.WebMercator,!1,ge(t)):c0(r)?DF(t,pk,We.WGS84,!1,ge(t)):null:null}function MS(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=_ee(e);return i[0]=_ee(t)*ji.radius,i[1]=ji.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function pk(t,e,i=[0,0],r=!1){const s=yee(t/ji.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=yee(Math.PI/2-2*Math.atan(Math.exp(-e/ji.radius))),i}function DP(t,e=!1,i=ge(t)){return DF(t,MS,We.WebMercator,e,i)}function FA(t,e=!1,i=ge(t)){return DF(t,pk,We.WGS84,e,i)}function ELe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function ALe(t){return Rfe(t,$fe)?.[0]??null}function MLe(t){return Rfe(t,$fe)?.[1]??null}function Rfe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(cp(i))return pk(t,e,r);if(GR(i))return r[0]=t,r[1]=e,r}return null}const $fe=[0,0];var sD;const Uz=[0,0];function bee(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let vl=sD=class extends T0{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new We(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)le.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)le.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s?.isWebMercator){const a=MS(n.longitude,n.latitude,Uz);t=a[0],e=a[1]}}}else bee(i)?(s=i,i=null):bee(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?le.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&le.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return MLe(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",MS(i,t,Uz)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return ALe(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",MS(t,e,Uz)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new sD;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return sD.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=MS(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=pk(l,c),u=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Yg(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return ELe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],vl.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],vl.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],vl.prototype,"hasZ",null),d([m({type:Number})],vl.prototype,"latitude",null),d([m({type:Number})],vl.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),cr(t=>isNaN(t)?t:$d(t))],vl.prototype,"x",void 0),d([Ut("x")],vl.prototype,"writeX",null),d([_i("x")],vl.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],vl.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],vl.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],vl.prototype,"m",void 0),vl=sD=d([U("esri.geometry.Point")],vl),vl.prototype.toJSON.isDefaultToJSON=!0;const Xe=vl,zz=[0,0];function _Y(t,e){return e!=null&&Va(t,e.x,e.y,e.z)}function gPt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!q2(t,i))return!1;return!0}function PLe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Va(t,i,r,s)&&Va(t,i,o,s)&&Va(t,n,o,s)&&Va(t,n,r,s)&&Va(t,i,r,a)&&Va(t,i,o,a)&&Va(t,n,o,a)&&Va(t,n,r,a):Va(t,i,r)&&Va(t,i,o)&&Va(t,n,o)&&Va(t,n,r)}function q2(t,e){return Va(t,e[0],e[1])}function OLe(t,e){return Va(t,e[0],e[1],e[2])}function Va(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function RLe(t,e){return zz[1]=e.y,zz[0]=e.x,$Le(t,zz)}function $Le(t,e){return Ife(t.rings,e)}function Ife(t,e){if(!t)return!1;if(ILe(t))return wee(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=wee(i,t[r],e);return i}function ILe(t){return!Array.isArray(t[0][0])}function wee(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[h,p]=e[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(h-c)<r&&(n=!n)}return n}function LLe(t,e){return _Y(t,e)}function DLe(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function NLe(t,e){const{points:i,hasZ:r}=e,s=r?OLe:q2;for(const n of i)if(s(t,n))return!0;return!1}const Aw=[0,0],Mw=[0,0],Pw=[0,0],Ow=[0,0],FLe=[Aw,Mw,Pw,Ow],Lfe=[[Pw,Aw],[Aw,Mw],[Mw,Ow],[Ow,Pw]];function kLe(t,e){return ULe(t,e.rings)}function ULe(t,e){Aw[0]=t.xmin,Aw[1]=t.ymax,Mw[0]=t.xmax,Mw[1]=t.ymax,Pw[0]=t.xmin,Pw[1]=t.ymin,Ow[0]=t.xmax,Ow[1]=t.ymin;for(const i of FLe)if(Ife(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(q2(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(q2(t,n)||Dfe(r,n,Lfe))return!0;r=n}}return!1}function zLe(t,e){Aw[0]=t.xmin,Aw[1]=t.ymax,Mw[0]=t.xmax,Mw[1]=t.ymax,Pw[0]=t.xmin,Pw[1]=t.ymin,Ow[0]=t.xmax,Ow[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(q2(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(q2(t,o)||Dfe(s,o,Lfe))return!0;s=o}}return!1}const Uo=[0,0];function BLe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(NF(n,o,c,u,Uo)&&!(Uo[0]===n[0]&&Uo[1]===n[1]||Uo[0]===c[0]&&Uo[1]===c[1]||Uo[0]===o[0]&&Uo[1]===o[1]||Uo[0]===u[0]&&Uo[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],u=i[l+1];if(NF(o,a,c,u,Uo)&&!(Uo[0]===o[0]&&Uo[1]===o[1]||Uo[0]===c[0]&&Uo[1]===c[1]||Uo[0]===a[0]&&Uo[1]===a[1]||Uo[0]===u[0]&&Uo[1]===u[1]))return!0}}}return!1}function Dfe(t,e,i){for(let r=0;r<i.length;r++)if(NF(t,e,i[r][0],i[r][1]))return!0;return!1}function NF(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,u]=i,[h,p]=r,f=h-c,g=n-c,_=a-n,v=p-u,b=o-u,w=l-o,T=v*_-f*w;if(T===0)return!1;const S=(f*b-v*g)/T,A=(_*b-w*g)/T;return S>=0&&S<=1&&A>=0&&A<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function VLe(t){switch(t){case"esriGeometryEnvelope":case"extent":return DLe;case"esriGeometryMultipoint":case"multipoint":return NLe;case"esriGeometryPoint":case"point":return LLe;case"esriGeometryPolygon":case"polygon":return kLe;case"esriGeometryPolyline":case"polyline":return zLe}}var ju;function GLe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function V0(t,e,i){return e==null?i:i==null?e:t(e,i)}let xo=ju=class extends T0{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return GLe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?We.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??We.WGS84}}static fromBounds(t,e){return new ju({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new ju({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Xe({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new ju;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&rD(e,i)&&(t=e.isWebMercator?DP(t):FA(t,!0)),t.type==="point"?_Y(this,t):t.type==="extent"&&PLe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&rD(e,i)&&(t=e.isWebMercator?DP(t):FA(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!ls(e,i)&&rD(e,i)&&(t=e.isWebMercator?DP(t):FA(t,!0)),VLe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=V0(Math.min,this.zmin,t.zmin),this.zmax=V0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=V0(Math.min,this.mmin,t.mmin),this.mmax=V0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=V0(Math.max,this.zmin,t.zmin),this.zmax=V0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=V0(Math.max,this.mmin,t.mmin),this.mmax=V0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Yg(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?FA(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=Bz(r.x,t).x),this.spatialReference=new We(ek((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??Yg(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Yg(o);const[h,p]=t.valid;u=Bz(this.xmin,t);const f=u.x,g=u.frameId;u=Bz(this.xmax,t);const _=u.x,v=u.frameId,b=f===_&&a>0;if(a>2*p){const w=new ju(l<c?f:_,s,p,n,o),T=new ju(h,s,l<c?_:f,n,o),S=new ju(0,s,p,n,o),A=new ju(h,s,0,n,o),P=[],R=[];w.contains(S)&&P.push(g),w.contains(A)&&R.push(g),T.contains(S)&&P.push(v),T.contains(A)&&R.push(v);for(let F=g+1;F<v;F++)P.push(F),R.push(F);e.push({extent:w,frameIds:[g]},{extent:T,frameIds:[v]},{extent:S,frameIds:P},{extent:A,frameIds:R})}else f>_||b?e.push({extent:new ju(f,s,p,n,o),frameIds:[g]},{extent:new ju(h,s,_,n,o),frameIds:[v]}):e.push({extent:new ju(f,s,_,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function Bz(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}d([m({readOnly:!0})],xo.prototype,"cache",null),d([m({readOnly:!0})],xo.prototype,"center",null),d([m({readOnly:!0})],xo.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],xo.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],xo.prototype,"hasZ",null),d([m({readOnly:!0})],xo.prototype,"height",null),d([m({readOnly:!0})],xo.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],xo.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],xo.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],xo.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],xo.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],xo.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],xo.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],xo.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],xo.prototype,"zmax",void 0),xo=ju=d([U("esri.geometry.Extent")],xo),xo.prototype.toJSON.isDefaultToJSON=!0;const Qi=xo;function W2(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var Aj;function xee(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function jLe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Ty=Aj=class extends T0{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):jLe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points?.[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Qi,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=xee(Math.min),a=xee(Math.max);let l,c,u,h,[p,f]=n,[g,_]=n;for(let v=0,b=t.length;v<b;v++){const w=t[v],[T,S]=w;if(p=o(p,T),f=o(f,S),g=a(g,T),_=a(_,S),i&&w.length>2){const A=w[2];l=o(l,A),u=a(u,A)}if(r&&w.length>s){const A=w[s];c=o(c,A),h=a(h,A)}}return e.xmin=p,e.ymin=f,e.xmax=g,e.ymax=_,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=h):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ge(this.points)}addPoint(t){return W2(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ge(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new Aj(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Xe(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Xe(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(W2(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],Ty.prototype,"cache",null),d([m()],Ty.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],Ty.prototype,"points",void 0),d([Ut("points")],Ty.prototype,"writePoints",null),Ty=Aj=d([U("esri.geometry.Multipoint")],Ty),Ty.prototype.toJSON.isDefaultToJSON=!0;const JC=Ty;function qR(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function M_(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var Xr;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Xr||(Xr={}));function fk(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Nfe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function HLe(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,u=l-o,h=c-a,p=u*u+h*h,f=(s-o)*u+(n-a)*h,g=Math.min(1,Math.max(0,f/p));return t[0]=o+u*g,t[1]=a+h*g,t}function qLe(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function Ffe(t,e){return Nfe(t,e,.5)}function vY(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=fk(t[r],t[r+1]);return i}function kfe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=fk(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return Nfe(t[s],t[s+1],o)}r+=n}return t[i-1]}function kA(t,e=Xr.X,i=Xr.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!Ufe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function Ufe(t){const e=t.length;return e<3||s0(t[0],t[e-1])}function WLe(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)Ufe(i)||(i.push(i[0].slice()),e=!0);return e}function yPt(t){return t.type!=="polygon"&&t.type!=="polyline"||YLe(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function YLe(t,e){const i=Yg(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const u of o){const h=XLe(u[0],r,s);a=Math.min(a,h),l=Math.max(l,h),u[0]=h}const c=l-a;n-c<c&&o.forEach(u=>{u[0]<0&&(u[0]+=n)})}}function XLe(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function _Pt(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function vPt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function zfe(t){return t?Bfe(t.rings,t.hasZ??!1):null}function Bfe(t,e){if(!t?.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=Vfe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?JLe(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function Vfe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const f=t[p],g=t[(p+1)%t.length],[_,v,b]=f,w=_-l,T=v-c,[S,A,P]=g,R=S-l,F=A-c,k=w*F-R*T;if(o+=k,r+=(w+R)*k,s+=(T+F)*k,e&&f.length>2&&g.length>2){const N=b-u,j=P-u,z=w*j-R*N;n+=(N+j)*z,a+=z}_<i[0]&&(i[0]=_),_>i[1]&&(i[1]=_),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(h[3]=(i[4]+i[5])/2,h[4]=0):(h[3]=n/(6*a)+u,h[4]=a)),h}function ZLe(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,h]=l,p=u-n,f=h-o,[g,_]=c,v=g-n,b=_-o,w=p*b-v*f;s+=w,i+=(p+v)*w,r+=(f+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),h<e[2]&&(e[2]=h),h>e[3]&&(e[3]=h)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function JLe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],h=t[l+1];if(u&&h){i[0]=u[0],i[1]=u[1],r[0]=h[0],r[1]=h[1],e&&u.length>2&&h.length>2&&(i[2]=u[2],r[2]=h[2]);const p=fk(i,r);if(p){s+=p;const f=Ffe(u,h);n+=p*f[0],o+=p*f[1],e&&f.length>2&&(a+=p*f[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function QLe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Vfe(M_(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?KLe(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function KLe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const h=t.x,p=t.y,f=t.z;i[0]=l,i[1]=c,r[0]=h,r[1]=p,e&&(i[2]=u,r[2]=f);const g=fk(i,r);if(g){s+=g;const _=Ffe(i,r);n+=g*_[0],o+=g*_[1],e&&_.length>2&&(a+=g*_[2])}l=h,c=p,u=f}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const eDe=1e-6;function tDe(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<eDe){const s=QLe(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)rDe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const iDe=1/3;function rDe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*iDe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),h=[r,s];return h[0]-=e[0],h[1]-=e[1],h[0]*=u,h[1]*=u,t[0]+=h[0],t[1]+=h[1],t}function C(){return[0,0,0]}function Kr(t){return[t[0],t[1],t[2]]}function Ce(t,e,i){return[t,e,i]}function ya(t,e=C()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function sDe(t,e){return new Float64Array(t,e,3)}function bY(){return C()}function Gfe(){return Ce(1,1,1)}function jfe(){return Ce(1,0,0)}function Hfe(){return Ce(0,1,0)}function wY(){return Ce(0,0,1)}const xs=bY(),Uf=Gfe(),xY=jfe(),TY=Hfe(),Y2=wY();Object.freeze(Object.defineProperty({__proto__:null,ONES:Uf,UNIT_X:xY,UNIT_Y:TY,UNIT_Z:Y2,ZEROS:xs,clone:Kr,create:C,createView:sDe,fromArray:ya,fromValues:Ce,ones:Gfe,unitX:jfe,unitY:Hfe,unitZ:wY,zeros:bY},Symbol.toStringTag,{value:"Module"}));let SY=1e-6;function go(){return SY}function nDe(t){SY=t}const WR=Math.random,oDe=Math.PI/180,aDe=180/Math.PI;function mk(t){return t*oDe}function lDe(t){return t*aDe}function cDe(t,e){return Math.abs(t-e)<=SY*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:WR,equals:cDe,getEpsilon:go,setEpsilon:nDe,toDegree:lDe,toRadian:mk},Symbol.toStringTag,{value:"Module"}));function Se(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ae(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function te(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function me(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function _e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function gk(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function FF(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function uDe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function qfe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function X2(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function Wfe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function Yfe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Xfe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function hDe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ie(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function hn(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function hr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function Wn(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function xa(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Yn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function CY(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function fe(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function pe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ke(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function or(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function dDe(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*u,t}function pDe(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,h=3*l*o,p=l*n;return t[0]=e[0]*c+i[0]*u+r[0]*h+s[0]*p,t[1]=e[1]*c+i[1]*u+r[1]*h+s[1]*p,t[2]=e[2]*c+i[2]*u+r[2]*h+s[2]*p,t}function fDe(t,e){e=e||1;const i=WR,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function Ve(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function On(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function uc(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],u=s*c-n*l,h=n*a-r*c,p=r*l-s*a,f=s*p-n*h,g=n*u-r*p,_=r*h-s*u,v=2*o;return t[0]=a+u*v+2*f,t[1]=l+h*v+2*g,t[2]=c+p*v+2*_,t}function mDe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function gDe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function yDe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Zfe(t,e){fe(Tee,t),fe(See,e);const i=pe(Tee,See);return i>1?0:i<-1?Math.PI:Math.acos(i)}const Tee=C(),See=C();function _De(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ho(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Rw(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=go();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function S0(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const yi=_e,vDe=gk,bDe=FF,P_=hr,DO=Wn,ja=Se,kF=xa,Cee=Object.freeze(Object.defineProperty({__proto__:null,abs:X2,add:me,angle:Zfe,bezier:pDe,ceil:uDe,copy:ae,cross:Ke,direction:S0,dist:P_,distance:hr,div:bDe,divide:FF,dot:pe,equals:Rw,exactEquals:ho,floor:qfe,hermite:dDe,inverse:CY,len:ja,length:Se,lerp:or,max:Xfe,min:Yfe,mul:vDe,multiply:gk,negate:Yn,normalize:fe,random:fDe,rotateX:mDe,rotateY:gDe,rotateZ:yDe,round:hDe,scale:ie,scaleAndAdd:hn,set:te,sign:Wfe,sqrDist:DO,sqrLen:kF,squaredDistance:Wn,squaredLength:xa,str:_De,sub:yi,subtract:_e,transformMat3:On,transformMat4:Ve,transformQuat:uc},Symbol.toStringTag,{value:"Module"})),Eee=new Float32Array(1);function Jfe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Te(t,e,i){return Math.min(Math.max(t,e),i)}function NO(t){return!(t&t-1)}function bPt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function wPt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Et(t,e,i){return t+(e-t)*i}function xPt(t,e,i,r,s){return Et(r,s,(t-e)/(i-e))}function xt(t){return t*Math.PI/180}function ea(t){return 180*t/Math.PI}function Mj(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Zn(t){return Math.acos(Te(t,-1,1))}function up(t){return Math.asin(Te(t,-1,1))}function O_(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const UF=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function Pj(t){return UF.setFloat64(0,t),UF.getBigInt64(0)}function wDe(t){return UF.setBigInt64(0,t),UF.getFloat64(0)}const nD=BigInt("1000000"),xDe=Qfe(1);function Qfe(t){const e=Pj(t=Math.abs(t)),i=wDe(e<=nD?nD:e-nD);return Math.abs(t-i)}function TDe(t,e,i=xDe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&Qfe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=Pj(t),s=Pj(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>nD)}function SDe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function CDe(t){return Kfe(Math.max(-Oj,Math.min(t,Oj)))}function Kfe(t){return Eee[0]=t,Eee[0]}function FO(t,e,i){const r=Te((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Aee(t,e){const i=Se(t),r=up(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return te(e,i,r,s),e}function zF(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(O_(e,1)&&O_(i,1)&&O_(r,1))}function EDe(t,e){return(t%e+e)%e}const Oj=Kfe(34028234663852886e22);function Vt(t=ODe){return[t[0],t[1],t[2],t[3]]}function TPt(t){return[t[0],t[1],t[2],t[3]]}function u0(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function yk(t,e,i,r,s=Vt()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function eme(t,e=Vt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function _k(t,e){return new Qi({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function EY(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function R_(t,e,i){if(e!=null)if("length"in e)Ij(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else u0(i,t)}function Vz(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function Rj(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Ta(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Il(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function SPt(t){return Ta(t)*Il(t)}function BF(t){return Ta(t)>0&&Il(t)>0}function AY(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function tme(t,e){return vk(t,e[0],e[1])}function Mee(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=i*i}function CPt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,h=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=h(r,o),f=h(n,o),g=h(n,s),_=h(r,s);return!(p===f&&f===g&&g===_&&_===p||a<r&&c<r||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function EPt(t,e){return vk(t,e.x,e.y)}function vk(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function ADe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function bk(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Pee(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function $j(t,e,i){if(e==null)return u0(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=Te(t[0],r,n),i[1]=Te(t[1],s,o),i[2]=Te(t[2],r,n),i[3]=Te(t[3],s,o),i}function MDe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-Ta(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Il(t)/2,0);return Math.sqrt(s*s+n*n)}function VF(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function Mu(t){return t?u0(t,Lj):Vt(Lj)}function Ij(t){return t!=null&&t.length===4}function PDe(t){return!(Ta(t)!==0&&isFinite(t[0])||Il(t)!==0&&isFinite(t[1]))}function Jb(t,e){return Ij(t)&&Ij(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const APt=[-1/0,-1/0,1/0,1/0],Lj=[1/0,1/0,-1/0,-1/0],ODe=[0,0,0,0];function ime(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function rme(t){return t.points!==void 0}function sme(t){return t.x!==void 0&&t.y!==void 0}function nme(t){return t.paths!==void 0}function ome(t){return t.rings!==void 0}function ame(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const w_=ame(Math.min),x_=ame(Math.max);function RDe(t,e){return nme(e)?Z2(t,e.paths,!1,!1):ome(e)?Z2(t,e.rings,!1,!1):rme(e)?MY(t,e.points,!1,!1,!1,!1):ime(e)?cme(t,e):(sme(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function wk(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=lme(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return Vt([e,r,i,s])}function lme(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return Vt([e,r,i,s])}function MPt(t,e){return nme(e)?Z2(t,e.paths,!0,!1):ome(e)?Z2(t,e.rings,!0,!1):rme(e)?MY(t,e.points,!0,!1,!0,!1):ime(e)?cme(t,e,!0,!1,!0,!1):(sme(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function Z2(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[h,p]=e[0][0];for(let f=0;f<e.length;f++){const g=e[f];for(let _=0;_<g.length;_++){const v=g[_],[b,w]=v;if(c=w_(c,b),u=w_(u,w),h=x_(h,b),p=x_(p,w),i&&v.length>2){const T=v[2];n=w_(n,T),o=x_(o,T)}if(r&&v.length>s){const T=v[s];a=w_(n,T),l=x_(o,T)}}}return i?r?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=h,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=h,t[4]=p,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=h,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=h,t[3]=p,t.length=4,t)}function cme(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,h=e.zmax,p=e.mmin,f=e.mmax;return s?(u=u||0,h=h||0,n?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=h,t[7]=f,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=f,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function MY(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,u,h,p,[f,g]=e[0],[_,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[T,S]=w;if(f=w_(f,T),g=w_(g,S),_=x_(_,T),v=x_(v,S),l&&w.length>2){const A=w[2];c=w_(c,A),u=x_(u,A)}if(a&&w.length>o){const A=w[o];h=w_(c,A),p=x_(u,A)}}return s?(c=c||0,u=u||0,n?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=c,t[3]=h,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=f,t[1]=g,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):n?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=h,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=f,t[1]=g,t[2]=_,t[3]=v,t)}function $De(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function IDe(t){return t.points!==void 0}function LDe(t){return t.x!==void 0&&t.y!==void 0}function DDe(t){return t.paths!==void 0}function NDe(t){return t.rings!==void 0}const PY=[];function ume(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function hme(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function dme(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function pme(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function OY(t,e=!1,i=!1){return e?i?pme(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):hme(t[0],t[1],t[2],t[3],t[4],t[5]):i?dme(t[0],t[1],t[2],t[3],t[4],t[5]):ume(t[0],t[1],t[2],t[3])}function PPt(t){return t?$De(t)?t:LDe(t)?kDe(t):NDe(t)?fme(t):DDe(t)?mme(t):IDe(t)?FDe(t):null:null}function FDe(t){const{hasZ:e,hasM:i,points:r}=t;return OY(MY(PY,r,e??!1,i??!1),e,i)}function kDe(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?pme(e,i,r,s,e,i,r,s):hme(e,i,r,e,i,r):n?dme(e,i,s,e,i,s):ume(e,i,e,i)}function fme(t){const{hasZ:e,hasM:i,rings:r}=t,s=Z2(PY,r,e??!1,i??!1);return s?OY(s,e,i):null}function mme(t){const{hasZ:e,hasM:i,paths:r}=t,s=Z2(PY,r,e??!1,i??!1);return s?OY(s,e,i):null}var oD;function Oee(t){return!Array.isArray(t[0])}let tf=oD=class extends T0{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new oD(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||We.WGS84,s.length&&s[0]?.[0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]?.[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=zfe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Xe;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=fme(this);if(!e)return null;const i=new Qi(e);return i.spatialReference=t,i}get isSelfIntersecting(){return BLe(this.rings)}writeRings(t,e){e.rings=ge(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Oee(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new oD;return t.spatialReference=this.spatialReference,t.rings=ge(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,u,h])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&h==null||a===h);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!s0(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=HR(t,this.spatialReference);return RLe(this,e??t)}isClockwise(t){const e=Oee(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return kA(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Xe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Xe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Xe(i[0],i[1],i[2],i[3],this.spatialReference):new Xe(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(W2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Xe(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Xe(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(W2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],tf.prototype,"cache",null),d([m({readOnly:!0})],tf.prototype,"centroid",null),d([m({readOnly:!0})],tf.prototype,"extent",null),d([m({readOnly:!0})],tf.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],tf.prototype,"rings",void 0),d([Ut("rings")],tf.prototype,"writeRings",null),tf=oD=d([U("esri.geometry.Polygon")],tf),tf.prototype.toJSON.isDefaultToJSON=!0;const mv=tf;var Dj;function UDe(t){return!Array.isArray(t[0])}let Sy=Dj=class extends T0{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||We.WGS84,s.length&&s[0]?.[0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]?.[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=mme(this);if(!e)return null;const i=new Qi(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=ge(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(UDe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new Dj;return t.spatialReference=this.spatialReference,t.paths=ge(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Xe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Xe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Xe(i[0],i[1],i[2],i[3],this.spatialReference):new Xe(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(W2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Xe(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Xe(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(W2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Sy.prototype,"cache",null),d([m({readOnly:!0})],Sy.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],Sy.prototype,"paths",void 0),d([Ut("paths")],Sy.prototype,"writePaths",null),Sy=Dj=d([U("esri.geometry.Polyline")],Sy),Sy.prototype.toJSON.isDefaultToJSON=!0;const xk=Sy,gme=rl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),OPt=rl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function kd(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Qb(t){return t.points!==void 0}function J2(t){return t.x!==void 0&&t.y!==void 0}function Ud(t){return t.paths!==void 0}function fu(t){return t.rings!==void 0}function $w(t){return t==null?null:t instanceof T0?t:J2(t)?Xe.fromJSON(t):Ud(t)?xk.fromJSON(t):fu(t)?mv.fromJSON(t):Qb(t)?JC.fromJSON(t):kd(t)?Qi.fromJSON(t):null}function RY(t){return t?J2(t)?"esriGeometryPoint":Ud(t)?"esriGeometryPolyline":fu(t)?"esriGeometryPolygon":kd(t)?"esriGeometryEnvelope":Qb(t)?"esriGeometryMultipoint":null:null}const zDe={esriGeometryPoint:Xe,esriGeometryPolyline:xk,esriGeometryPolygon:mv,esriGeometryEnvelope:Qi,esriGeometryMultipoint:JC};function BDe(t){return t&&zDe[t]||null}const Tk={base:T0,key:"type",typeMap:{extent:Qi,multipoint:JC,point:Xe,polyline:xk,polygon:mv}};lm(Tk);const Ic=t=>{let e=class extends t{clone(){const i=Ul(this);rk(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const l in r){const c=r[l],u=s?.originOf(l),h=c.clonable;if(c.readOnly||h===!1||u!==Ti.USER&&u!==Ti.DEFAULTS&&u!==Ti.WEB_MAP&&u!==Ti.WEB_SCENE)continue;const p=this[l];let f=null;f=typeof h=="function"?h(p):h==="reference"?p:W6(p),p!=null&&f==null||(u===Ti.DEFAULTS?o.set(l,f):n[l]=f)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=Ul(a)?.store;if(l)for(const[c,u]of o)l.set(c,u,Ti.DEFAULTS)}return a}};return e=d([U("esri.core.Clonable")],e),e};let q_=class extends Ic(Pe){};q_=d([U("esri.core.Clonable")],q_);let aD=class yme{constructor(){this._emitter=new yme.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){let o=this._listenersMap?.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const c of o.slice()){const u="deref"in c?c.deref():c;u?u?.call(a,n):l=!0}return l&&(o=o.filter(c=>!("deref"in c)||c.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return vw(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Mi(()=>{const a=this._listenersMap?.get(s),l=a?.indexOf(n)??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove(),("deref"in n?n.deref():n)?.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap?.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=d([U("esri.core.Evented")],s),s};let i=class extends Pe{constructor(){super(...arguments),this._emitter=new aD.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=d([U("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(aD||(aD={}));const Ls=aD;var vr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(vr||(vr={}));function _me(t){return(e,i)=>{e[i]=t}}let YR=class extends Tpe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Ig;let VDe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},GDe=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const Iu=new Ko(VDe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function Ree(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function Gz(t){return t?t instanceof Eg?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function jz(t){if(t?.length)return t[0]}function jDe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function vme(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),vme(t,i.call(r,s,n,o),i,r)})}const G0=new Set,j0=new Set,H0=new Set,Hz=new Map;let HDe=0,Eg=Ig=class extends Ls.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Ig}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new YR,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:HDe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Ig?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return Ot(this._observable),this._items}set items(t){this._emitBeforeChanges(vr.ADD)||(this._splice(0,this.length,Gz(t)),this._emitAfterChanges(vr.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return Mi();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Mi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{i()?.call(null,s),r.remove()});return r}add(t,e){if(Ot(this._observable),this._emitBeforeChanges(vr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(vr.ADD),this}addMany(t,e=this._items.length){if(Ot(this._observable),!t?.length)return this;if(this._emitBeforeChanges(vr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,Gz(t)),this._emitAfterChanges(vr.ADD),this}at(t){if(Ot(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(vr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ot(this._observable),this._createNewInstance({items:this._items.map(ge)})}concat(...t){Ot(this._observable);const e=t.map(Gz);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(vr.REMOVE)}destroyAll(){this.drain(Ree)}destroyMany(t){const e=this.removeMany(t);return e.forEach(Ree),e}every(t,e){return Ot(this._observable),this._items.every(t,e)}filter(t,e){let i;return Ot(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Ot(this._observable),this._items.find(t,e)}findIndex(t,e){return Ot(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ot(this._observable);const i=[];return vme(i,this,t,e),new Ig(i)}forEach(t,e){return Ot(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ot(this._observable),this._items[t]}getNextIndex(t){Ot(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ot(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ot(this._observable),this._items.indexOf(t,e)}join(t=","){return Ot(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ot(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ot(this._observable);const i=this._items.map(t,e);return new Ig({items:i})}reorder(t,e=this.length-1){Ot(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(vr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(vr.MOVE)}return t}}pop(){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vr.REMOVE))return;const t=jz(this._splice(this.length-1,1));return this._emitAfterChanges(vr.REMOVE),t}push(...t){return Ot(this._observable),this._emitBeforeChanges(vr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(vr.ADD)),this.length}reduce(t,e){Ot(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Ot(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Ot(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ot(this._observable),t<0||t>=this.length||this._emitBeforeChanges(vr.REMOVE))return;const e=jz(this._splice(t,1));return this._emitAfterChanges(vr.REMOVE),e}removeMany(t){if(Ot(this._observable),!t?.length||this._emitBeforeChanges(vr.REMOVE))return[];const e=t instanceof Ig?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+jDe(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(vr.REMOVE),r}reverse(){if(Ot(this._observable),this._emitBeforeChanges(vr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(vr.MOVE),this}shift(){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vr.REMOVE))return;const t=jz(this._splice(0,1));return this._emitAfterChanges(vr.REMOVE),t}slice(t=0,e=this.length){return Ot(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ot(this._observable),this._items.some(t,e)}sort(t){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(vr.MOVE),this}splice(t,e,...i){Ot(this._observable);const r=(e?vr.REMOVE:0)|(i.length?vr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Ot(this._observable),this._items.slice()}toJSON(){return Ot(this._observable),this.toArray()}toLocaleString(){return Ot(this._observable),this._items.toLocaleString()}toString(){return Ot(this._observable),this._items.toString()}unshift(...t){return Ot(this._observable),!t.length||this._emitBeforeChanges(vr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(vr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=XC(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=Iu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);Iu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Iu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Iu.release(a)}}if(i?.length){if(s){const u=[];for(const h of i){const p=s.ensureType(h);p==null&&h!=null||u.push(p)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Iu.acquire();u.target=this,u.cancellable=!0;const h=Iu.acquire();h.target=this,h.cancellable=!1;for(const p of i)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),l&&(h.reset(p),this.emit("after-add",h)))):(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),h.reset(p),this.emit("after-add",h));Iu.release(h),Iu.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||o?.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new GDe(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=Iu.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,Iu.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Iu.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Iu.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;G0.clear(),j0.clear(),H0.clear();for(const{added:l,removed:c}of i){if(l)if(H0.size===0&&j0.size===0)for(const u of l)G0.add(u);else for(const u of l)j0.has(u)?(H0.add(u),j0.delete(u)):H0.has(u)||G0.add(u);if(c)if(H0.size===0&&G0.size===0)for(const u of c)j0.add(u);else for(const u of c)G0.has(u)?G0.delete(u):(H0.delete(u),j0.add(u))}const r=fc.acquire();G0.forEach(l=>{r.push(l)});const s=fc.acquire();j0.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=fc.acquire();if(H0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const h=e.listeners[u];h.removed||h.callback.call(this,l)}}fc.release(r),fc.release(s),fc.release(a)}G0.clear(),j0.clear(),H0.clear()}};Eg.ofType=t=>{if(!t)return Ig;if(Hz.has(t))return Hz.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Ig{};return d([_me({Type:t,ensureType:typeof t=="function"?mo(t):lm(t)})],i.prototype,"itemType",void 0),i=d([U(`esri.core.Collection<${e}>`)],i),Hz.set(t,i),i},d([m()],Eg.prototype,"_updating",void 0),d([m()],Eg.prototype,"length",void 0),d([m()],Eg.prototype,"items",null),d([m({readOnly:!0})],Eg.prototype,"updating",null),Eg=Ig=d([U("esri.core.Collection")],Eg);const lt=Eg;async function bme(t,e){const{WhereClause:i}=await ue(()=>import("./WhereClause-2da3dfba.js").then(r=>r.W),["./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js"],import.meta.url);return i.create(t,e)}function DPt(t,e){return t==="1=1"?e??t:e==="1=1"?t??e:t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}let NP;const qDe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function wme(){return qDe??globalThis.navigator?.language??"en"}function Ec(){return NP===void 0&&(NP=wme()),NP}function WDe(t=Ec()){return/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(t)?.[1].toLowerCase()}const lD=[];function xme(t){return lD.push(t),Mi(()=>lD.splice(lD.indexOf(t),1))}const cD=[];function $Y(t){return cD.push(t),Mi(()=>cD.splice(cD.indexOf(t),1))}function YDe(){const t=wme();NP!==t&&([...cD].forEach(e=>e(t)),NP=t,[...lD].forEach(e=>e(t)))}globalThis.addEventListener?.("languagechange",YDe);const $ee=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class ix extends Error{}class XDe extends ix{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class ZDe extends ix{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class JDe extends ix{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class PS extends ix{}class Tme extends ix{constructor(e){super(`Invalid unit ${e}`)}}class mc extends ix{}class q0 extends ix{constructor(){super("Zone is an abstract class")}}const rt="numeric",hp="short",Tu="long",GF={year:rt,month:rt,day:rt},Sme={year:rt,month:hp,day:rt},QDe={year:rt,month:hp,day:rt,weekday:hp},Cme={year:rt,month:Tu,day:rt},Eme={year:rt,month:Tu,day:rt,weekday:Tu},Ame={hour:rt,minute:rt},Mme={hour:rt,minute:rt,second:rt},Pme={hour:rt,minute:rt,second:rt,timeZoneName:hp},Ome={hour:rt,minute:rt,second:rt,timeZoneName:Tu},Rme={hour:rt,minute:rt,hourCycle:"h23"},$me={hour:rt,minute:rt,second:rt,hourCycle:"h23"},Ime={hour:rt,minute:rt,second:rt,hourCycle:"h23",timeZoneName:hp},Lme={hour:rt,minute:rt,second:rt,hourCycle:"h23",timeZoneName:Tu},Dme={year:rt,month:rt,day:rt,hour:rt,minute:rt},Nme={year:rt,month:rt,day:rt,hour:rt,minute:rt,second:rt},Fme={year:rt,month:hp,day:rt,hour:rt,minute:rt},kme={year:rt,month:hp,day:rt,hour:rt,minute:rt,second:rt},KDe={year:rt,month:hp,day:rt,weekday:hp,hour:rt,minute:rt},Ume={year:rt,month:Tu,day:rt,hour:rt,minute:rt,timeZoneName:hp},zme={year:rt,month:Tu,day:rt,hour:rt,minute:rt,second:rt,timeZoneName:hp},Bme={year:rt,month:Tu,day:rt,weekday:Tu,hour:rt,minute:rt,timeZoneName:Tu},Vme={year:rt,month:Tu,day:rt,weekday:Tu,hour:rt,minute:rt,second:rt,timeZoneName:Tu};class XR{get type(){throw new q0}get name(){throw new q0}get ianaName(){return this.name}get isUniversal(){throw new q0}offsetName(e,i){throw new q0}formatOffset(e,i){throw new q0}offset(e){throw new q0}equals(e){throw new q0}get isValid(){throw new q0}}let qz=null;class Sk extends XR{static get instance(){return qz===null&&(qz=new Sk),qz}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return Jme(e,i,r)}formatOffset(e,i){return FP(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let uD={};function eNe(t){return uD[t]||(uD[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),uD[t]}const tNe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function iNe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,u]=r;return[o,s,n,a,l,c,u]}function rNe(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=tNe[n];n==="era"?r[a]=o:mi(a)||(r[a]=parseInt(o,10))}return r}let i3={};class dp extends XR{static create(e){return i3[e]||(i3[e]=new dp(e)),i3[e]}static resetCache(){i3={},uD={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=dp.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return Jme(e,i,r,this.name)}formatOffset(e,i){return FP(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=eNe(this.name);let[s,n,o,a,l,c,u]=r.formatToParts?rNe(r,i):iNe(r,i);a==="BC"&&(s=-Math.abs(s)+1);const p=Ek({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let f=+i;const g=f%1e3;return f-=g>=0?g:1e3+g,(p-f)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Iee={};function sNe(t,e={}){const i=JSON.stringify([t,e]);let r=Iee[i];return r||(r=new Intl.ListFormat(t,e),Iee[i]=r),r}let Nj={};function Fj(t,e={}){const i=JSON.stringify([t,e]);let r=Nj[i];return r||(r=new Intl.DateTimeFormat(t,e),Nj[i]=r),r}let kj={};function nNe(t,e={}){const i=JSON.stringify([t,e]);let r=kj[i];return r||(r=new Intl.NumberFormat(t,e),kj[i]=r),r}let Uj={};function oNe(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=Uj[s];return n||(n=new Intl.RelativeTimeFormat(t,e),Uj[s]=n),n}let UA=null;function aNe(){return UA||(UA=new Intl.DateTimeFormat().resolvedOptions().locale,UA)}let Lee={};function lNe(t){let e=Lee[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,Lee[t]=e}return e}function cNe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=Fj(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=Fj(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function uNe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function hNe(t){const e=[];for(let i=1;i<=12;i++){const r=ti.utc(2009,i,1);e.push(t(r))}return e}function dNe(t){const e=[];for(let i=1;i<=7;i++){const r=ti.utc(2016,11,13+i);e.push(t(r))}return e}function r3(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function pNe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class fNe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=nNe(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):NY(e,3);return lo(i,this.padTo)}}}class mNe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&dp.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=Fj(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class gNe{constructor(e,i,r){this.opts={style:"long",...r},!i&&Xme()&&(this.rtf=oNe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):NNe(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const yNe={firstDay:1,minimalDays:4,weekend:[6,7]};class rs{static fromOpts(e){return rs.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||kn.defaultLocale,a=o||(n?"en-US":aNe()),l=i||kn.defaultNumberingSystem,c=r||kn.defaultOutputCalendar,u=zj(s)||kn.defaultWeekSettings;return new rs(a,l,c,u,o)}static resetCache(){UA=null,Nj={},kj={},Uj={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return rs.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=cNe(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=uNe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=pNe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:rs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,zj(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return r3(this,e,ege,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=hNe(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return r3(this,e,rge,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=dNe(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return r3(this,void 0,()=>sge,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ti.utc(2016,11,13,9),ti.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return r3(this,e,nge,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[ti.utc(-40,1,1),ti.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new fNe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new mNe(e,this.intl,i)}relFormatter(e={}){return new gNe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return sNe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:Zme()?lNe(this.locale):yNe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let Wz=null;class tl extends XR{static get utcInstance(){return Wz===null&&(Wz=new tl(0)),Wz}static instance(e){return e===0?tl.utcInstance:new tl(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new tl(Ak(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${FP(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${FP(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return FP(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class _Ne extends XR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function h_(t,e){if(mi(t)||t===null)return e;if(t instanceof XR)return t;if(wNe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?Sk.instance:i==="utc"||i==="gmt"?tl.utcInstance:tl.parseSpecifier(i)||dp.create(t)}else return Kb(t)?tl.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new _Ne(t)}let Dee=()=>Date.now(),Nee="system",Fee=null,kee=null,Uee=null,zee=60,Bee,Vee=null;class kn{static get now(){return Dee}static set now(e){Dee=e}static set defaultZone(e){Nee=e}static get defaultZone(){return h_(Nee,Sk.instance)}static get defaultLocale(){return Fee}static set defaultLocale(e){Fee=e}static get defaultNumberingSystem(){return kee}static set defaultNumberingSystem(e){kee=e}static get defaultOutputCalendar(){return Uee}static set defaultOutputCalendar(e){Uee=e}static get defaultWeekSettings(){return Vee}static set defaultWeekSettings(e){Vee=zj(e)}static get twoDigitCutoffYear(){return zee}static set twoDigitCutoffYear(e){zee=e%100}static get throwOnInvalid(){return Bee}static set throwOnInvalid(e){Bee=e}static resetCaches(){rs.resetCache(),dp.resetCache()}}class Hd{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Gme=[0,31,59,90,120,151,181,212,243,273,304,334],jme=[0,31,60,91,121,152,182,213,244,274,305,335];function Th(t,e){return new Hd("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function IY(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function Hme(t,e,i){return i+(ZR(t)?jme:Gme)[e-1]}function qme(t,e){const i=ZR(t)?jme:Gme,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function LY(t,e){return(t-e+7)%7+1}function jF(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=Hme(r,s,n),a=LY(IY(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=kO(c,e,i)):l>kO(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...Mk(t)}}function Gee(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=LY(IY(r,1,e),i),a=u2(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=u2(c)):l>a?(c=r+1,l-=u2(r)):c=r;const{month:u,day:h}=qme(c,l);return{year:c,month:u,day:h,...Mk(t)}}function Yz(t){const{year:e,month:i,day:r}=t,s=Hme(e,i,r);return{year:e,ordinal:s,...Mk(t)}}function jee(t){const{year:e,ordinal:i}=t,{month:r,day:s}=qme(e,i);return{year:e,month:r,day:s,...Mk(t)}}function Hee(t,e){if(!mi(t.localWeekday)||!mi(t.localWeekNumber)||!mi(t.localWeekYear)){if(!mi(t.weekday)||!mi(t.weekNumber)||!mi(t.weekYear))throw new PS("Cannot mix locale-based week fields with ISO-based week fields");return mi(t.localWeekday)||(t.weekday=t.localWeekday),mi(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),mi(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function vNe(t,e=4,i=1){const r=Ck(t.weekYear),s=Sh(t.weekNumber,1,kO(t.weekYear,e,i)),n=Sh(t.weekday,1,7);return r?s?n?!1:Th("weekday",t.weekday):Th("week",t.weekNumber):Th("weekYear",t.weekYear)}function bNe(t){const e=Ck(t.year),i=Sh(t.ordinal,1,u2(t.year));return e?i?!1:Th("ordinal",t.ordinal):Th("year",t.year)}function Wme(t){const e=Ck(t.year),i=Sh(t.month,1,12),r=Sh(t.day,1,HF(t.year,t.month));return e?i?r?!1:Th("day",t.day):Th("month",t.month):Th("year",t.year)}function Yme(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=Sh(e,0,23)||e===24&&i===0&&r===0&&s===0,o=Sh(i,0,59),a=Sh(r,0,59),l=Sh(s,0,999);return n?o?a?l?!1:Th("millisecond",s):Th("second",r):Th("minute",i):Th("hour",e)}function mi(t){return typeof t>"u"}function Kb(t){return typeof t=="number"}function Ck(t){return typeof t=="number"&&t%1===0}function wNe(t){return typeof t=="string"}function xNe(t){return Object.prototype.toString.call(t)==="[object Date]"}function Xme(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Zme(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function TNe(t){return Array.isArray(t)?t:[t]}function qee(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function SNe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function Q2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zj(t){if(t==null)return null;if(typeof t!="object")throw new mc("Week settings must be an object");if(!Sh(t.firstDay,1,7)||!Sh(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Sh(e,1,7)))throw new mc("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Sh(t,e,i){return Ck(t)&&t>=e&&t<=i}function CNe(t,e){return t-e*Math.floor(t/e)}function lo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function Ky(t){if(!(mi(t)||t===null||t===""))return parseInt(t,10)}function Uv(t){if(!(mi(t)||t===null||t===""))return parseFloat(t)}function DY(t){if(!(mi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function NY(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function ZR(t){return t%4===0&&(t%100!==0||t%400===0)}function u2(t){return ZR(t)?366:365}function HF(t,e){const i=CNe(e-1,12)+1,r=t+(e-i)/12;return i===2?ZR(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Ek(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function Wee(t,e,i){return-LY(IY(t,1,e),i)+e-1}function kO(t,e=4,i=1){const r=Wee(t,e,i),s=Wee(t+1,e,i);return(u2(t)-r+s)/7}function Bj(t){return t>99?t:t>kn.twoDigitCutoffYear?1900+t:2e3+t}function Jme(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function Ak(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function Qme(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new mc(`Invalid unit value ${t}`);return e}function qF(t,e){const i={};for(const r in t)if(Q2(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=Qme(s)}return i}function FP(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${lo(i,2)}:${lo(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${lo(i,2)}${lo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Mk(t){return SNe(t,["hour","minute","second","millisecond"])}const ENe=["January","February","March","April","May","June","July","August","September","October","November","December"],Kme=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ANe=["J","F","M","A","M","J","J","A","S","O","N","D"];function ege(t){switch(t){case"narrow":return[...ANe];case"short":return[...Kme];case"long":return[...ENe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const tge=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ige=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],MNe=["M","T","W","T","F","S","S"];function rge(t){switch(t){case"narrow":return[...MNe];case"short":return[...ige];case"long":return[...tge];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const sge=["AM","PM"],PNe=["Before Christ","Anno Domini"],ONe=["BC","AD"],RNe=["B","A"];function nge(t){switch(t){case"narrow":return[...RNe];case"short":return[...ONe];case"long":return[...PNe];default:return null}}function $Ne(t){return sge[t.hour<12?0:1]}function INe(t,e){return rge(e)[t.weekday-1]}function LNe(t,e){return ege(e)[t.month-1]}function DNe(t,e){return nge(e)[t.year<0?0:1]}function NNe(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const h=t==="days";switch(e){case 1:return h?"tomorrow":`next ${s[t][0]}`;case-1:return h?"yesterday":`last ${s[t][0]}`;case 0:return h?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Yee(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const FNe={D:GF,DD:Sme,DDD:Cme,DDDD:Eme,t:Ame,tt:Mme,ttt:Pme,tttt:Ome,T:Rme,TT:$me,TTT:Ime,TTTT:Lme,f:Dme,ff:Fme,fff:Ume,ffff:Bme,F:Nme,FF:kme,FFF:zme,FFFF:Vme};class Qa{static create(e,i={}){return new Qa(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return FNe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return lo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(f,g)=>this.loc.extract(e,f,g),o=f=>e.isOffsetFixed&&e.offset===0&&f.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,f.format):"",a=()=>r?$Ne(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(f,g)=>r?LNe(e,f):n(g?{month:f}:{month:f,day:"numeric"},"month"),c=(f,g)=>r?INe(e,f):n(g?{weekday:f}:{weekday:f,month:"long",day:"numeric"},"weekday"),u=f=>{const g=Qa.macroTokenToFormatOpts(f);return g?this.formatWithSystemDefault(e,g):f},h=f=>r?DNe(e,f):n({era:f},"era"),p=f=>{switch(f){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(f)}};return Yee(Qa.parseFormat(i),p)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},n=Qa.parseFormat(i),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Yee(n,s(a))}}const oge=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function QC(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function KC(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function eE(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function age(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=Ky(e[i+s]);return[r,null,i+s]}}const lge=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,kNe=`(?:${lge.source}?(?:\\[(${oge.source})\\])?)?`,FY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,cge=RegExp(`${FY.source}${kNe}`),kY=RegExp(`(?:T${cge.source})?`),UNe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,zNe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,BNe=/(\d{4})-?(\d{3})/,VNe=age("weekYear","weekNumber","weekDay"),GNe=age("year","ordinal"),jNe=/(\d{4})-(\d\d)-(\d\d)/,uge=RegExp(`${FY.source} ?(?:${lge.source}|(${oge.source}))?`),HNe=RegExp(`(?: ${uge.source})?`);function h2(t,e,i){const r=t[e];return mi(r)?i:Ky(r)}function qNe(t,e){return[{year:h2(t,e),month:h2(t,e+1,1),day:h2(t,e+2,1)},null,e+3]}function tE(t,e){return[{hours:h2(t,e,0),minutes:h2(t,e+1,0),seconds:h2(t,e+2,0),milliseconds:DY(t[e+3])},null,e+4]}function JR(t,e){const i=!t[e]&&!t[e+1],r=Ak(t[e+1],t[e+2]),s=i?null:tl.instance(r);return[{},s,e+3]}function QR(t,e){const i=t[e]?dp.create(t[e]):null;return[{},i,e+1]}const WNe=RegExp(`^T?${FY.source}$`),YNe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function XNe(t){const[e,i,r,s,n,o,a,l,c]=t,u=e[0]==="-",h=l&&l[0]==="-",p=(f,g=!1)=>f!==void 0&&(g||f&&u)?-f:f;return[{years:p(Uv(i)),months:p(Uv(r)),weeks:p(Uv(s)),days:p(Uv(n)),hours:p(Uv(o)),minutes:p(Uv(a)),seconds:p(Uv(l),l==="-0"),milliseconds:p(DY(c),h)}]}const ZNe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function UY(t,e,i,r,s,n,o){const a={year:e.length===2?Bj(Ky(e)):Ky(e),month:Kme.indexOf(i)+1,day:Ky(r),hour:Ky(s),minute:Ky(n)};return o&&(a.second=Ky(o)),t&&(a.weekday=t.length>3?tge.indexOf(t)+1:ige.indexOf(t)+1),a}const JNe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function QNe(t){const[,e,i,r,s,n,o,a,l,c,u,h]=t,p=UY(e,s,r,i,n,o,a);let f;return l?f=ZNe[l]:c?f=0:f=Ak(u,h),[p,new tl(f)]}function KNe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const eFe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,tFe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,iFe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Xee(t){const[,e,i,r,s,n,o,a]=t;return[UY(e,s,r,i,n,o,a),tl.utcInstance]}function rFe(t){const[,e,i,r,s,n,o,a]=t;return[UY(e,a,i,r,s,n,o),tl.utcInstance]}const sFe=QC(UNe,kY),nFe=QC(zNe,kY),oFe=QC(BNe,kY),aFe=QC(cge),hge=KC(qNe,tE,JR,QR),lFe=KC(VNe,tE,JR,QR),cFe=KC(GNe,tE,JR,QR),uFe=KC(tE,JR,QR);function hFe(t){return eE(t,[sFe,hge],[nFe,lFe],[oFe,cFe],[aFe,uFe])}function dFe(t){return eE(KNe(t),[JNe,QNe])}function pFe(t){return eE(t,[eFe,Xee],[tFe,Xee],[iFe,rFe])}function fFe(t){return eE(t,[YNe,XNe])}const mFe=KC(tE);function gFe(t){return eE(t,[WNe,mFe])}const yFe=QC(jNe,HNe),_Fe=QC(uge),vFe=KC(tE,JR,QR);function bFe(t){return eE(t,[yFe,hge],[_Fe,vFe])}const Zee="Invalid Duration",dge={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},wFe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...dge},Lu=146097/400,Cx=146097/4800,xFe={years:{quarters:4,months:12,weeks:Lu/7,days:Lu,hours:Lu*24,minutes:Lu*24*60,seconds:Lu*24*60*60,milliseconds:Lu*24*60*60*1e3},quarters:{months:3,weeks:Lu/28,days:Lu/4,hours:Lu*24/4,minutes:Lu*24*60/4,seconds:Lu*24*60*60/4,milliseconds:Lu*24*60*60*1e3/4},months:{weeks:Cx/7,days:Cx,hours:Cx*24,minutes:Cx*24*60,seconds:Cx*24*60*60,milliseconds:Cx*24*60*60*1e3},...dge},Lb=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],TFe=Lb.slice(0).reverse();function W0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Tr(r)}function pge(t,e){let i=e.milliseconds??0;for(const r of TFe.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Jee(t,e){const i=pge(t,e)<0?-1:1;Lb.reduceRight((r,s)=>{if(mi(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),Lb.reduce((r,s)=>{if(mi(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function SFe(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Tr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?xFe:wFe;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||rs.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Tr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new mc(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Tr({values:qF(e,Tr.normalizeUnit),loc:rs.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(Kb(e))return Tr.fromMillis(e);if(Tr.isDuration(e))return e;if(typeof e=="object")return Tr.fromObject(e);throw new mc(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=fFe(e);return r?Tr.fromObject(r,i):Tr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=gFe(e);return r?Tr.fromObject(r,i):Tr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new mc("need to specify a reason the Duration is invalid");const r=e instanceof Hd?e:new Hd(e,i);if(kn.throwOnInvalid)throw new JDe(r);return new Tr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new Tme(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Qa.create(this.loc,r).formatDurationFromString(this,e):Zee}toHuman(e={}){if(!this.isValid)return Zee;const i=Lb.map(r=>{const s=this.values[r];return mi(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=NY(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},ti.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?pge(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Tr.fromDurationLike(e),r={};for(const s of Lb)(Q2(i.values,s)||Q2(this.values,s))&&(r[s]=i.get(s)+this.get(s));return W0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Tr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=Qme(e(this.values[r],r));return W0(this,{values:i},!0)}get(e){return this[Tr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...qF(e,Tr.normalizeUnit)};return W0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return W0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Jee(this.matrix,e),W0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=SFe(this.normalize().shiftToAll().toObject());return W0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Tr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of Lb)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;Kb(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else Kb(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Jee(this.matrix,i),W0(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return W0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Lb)if(!i(this.values[r],e.values[r]))return!1;return!0}}const Ex="Invalid Interval";function CFe(t,e){return!t||!t.isValid?vn.invalid("missing or invalid start"):!e||!e.isValid?vn.invalid("missing or invalid end"):e<t?vn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class vn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new mc("need to specify a reason the Interval is invalid");const r=e instanceof Hd?e:new Hd(e,i);if(kn.throwOnInvalid)throw new ZDe(r);return new vn({invalid:r})}static fromDateTimes(e,i){const r=RE(e),s=RE(i),n=CFe(r,s);return n??new vn({start:r,end:s})}static after(e,i){const r=Tr.fromDurationLike(i),s=RE(e);return vn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=Tr.fromDurationLike(i),s=RE(e);return vn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=ti.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=ti.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return vn.fromDateTimes(n,a);if(o){const c=Tr.fromISO(s,i);if(c.isValid)return vn.after(n,c)}else if(l){const c=Tr.fromISO(r,i);if(c.isValid)return vn.before(a,c)}}return vn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i?.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?vn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(RE).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(vn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=Tr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(vn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:vn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return vn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(vn.fromDateTimes(i,l.time)),i=null);return vn.merge(s)}difference(...e){return vn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Ex}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=GF,i={}){return this.isValid?Qa.create(this.s.loc.clone(i),e).formatInterval(this):Ex}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ex}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ex}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ex}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:Ex}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Tr.invalid(this.invalidReason)}mapEndpoints(e){return vn.fromDateTimes(e(this.s),e(this.e))}}class s3{static hasDST(e=kn.defaultZone){const i=ti.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return dp.isValidZone(e)}static normalizeZone(e){return h_(e,kn.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||rs.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||rs.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||rs.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||rs.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||rs.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||rs.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||rs.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return rs.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return rs.create(i,null,"gregory").eras(e)}static features(){return{relative:Xme(),localeWeek:Zme()}}}function Qee(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Tr.fromMillis(r).as("days"))}function EFe(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=Qee(l,c);return(u-u%7)/7}],["days",Qee]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function AFe(t,e,i,r){let[s,n,o,a]=EFe(t,e,i);const l=e-s,c=i.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=Tr.fromObject(n,r);return c.length>0?Tr.fromMillis(l,r).shiftTo(...c).plus(u):u}const zY={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Kee={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},MFe=zY.hanidec.replace(/[\[|\]]/g,"").split("");function PFe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(zY.hanidec)!==-1)e+=MFe.indexOf(t[i]);else for(const s in Kee){const[n,o]=Kee[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function Wh({numberingSystem:t},e=""){return new RegExp(`${zY[t||"latn"]}${e}`)}const OFe="missing Intl.DateTimeFormat.formatToParts support";function Lr(t,e=i=>i){return{regex:t,deser:([i])=>e(PFe(i))}}const RFe=String.fromCharCode(160),fge=`[ ${RFe}]`,mge=new RegExp(fge,"g");function $Fe(t){return t.replace(/\./g,"\\.?").replace(mge,fge)}function ete(t){return t.replace(/\./g,"").replace(mge," ").toLowerCase()}function Yh(t,e){return t===null?null:{regex:RegExp(t.map($Fe).join("|")),deser:([i])=>t.findIndex(r=>ete(i)===ete(r))+e}}function tte(t,e){return{regex:t,deser:([,i,r])=>Ak(i,r),groups:e}}function n3(t){return{regex:t,deser:([e])=>e}}function IFe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function LFe(t,e){const i=Wh(e),r=Wh(e,"{2}"),s=Wh(e,"{3}"),n=Wh(e,"{4}"),o=Wh(e,"{6}"),a=Wh(e,"{1,2}"),l=Wh(e,"{1,3}"),c=Wh(e,"{1,6}"),u=Wh(e,"{1,9}"),h=Wh(e,"{2,4}"),p=Wh(e,"{4,6}"),f=v=>({regex:RegExp(IFe(v.val)),deser:([b])=>b,literal:!0}),_=(v=>{if(t.literal)return f(v);switch(v.val){case"G":return Yh(e.eras("short"),0);case"GG":return Yh(e.eras("long"),0);case"y":return Lr(c);case"yy":return Lr(h,Bj);case"yyyy":return Lr(n);case"yyyyy":return Lr(p);case"yyyyyy":return Lr(o);case"M":return Lr(a);case"MM":return Lr(r);case"MMM":return Yh(e.months("short",!0),1);case"MMMM":return Yh(e.months("long",!0),1);case"L":return Lr(a);case"LL":return Lr(r);case"LLL":return Yh(e.months("short",!1),1);case"LLLL":return Yh(e.months("long",!1),1);case"d":return Lr(a);case"dd":return Lr(r);case"o":return Lr(l);case"ooo":return Lr(s);case"HH":return Lr(r);case"H":return Lr(a);case"hh":return Lr(r);case"h":return Lr(a);case"mm":return Lr(r);case"m":return Lr(a);case"q":return Lr(a);case"qq":return Lr(r);case"s":return Lr(a);case"ss":return Lr(r);case"S":return Lr(l);case"SSS":return Lr(s);case"u":return n3(u);case"uu":return n3(a);case"uuu":return Lr(i);case"a":return Yh(e.meridiems(),0);case"kkkk":return Lr(n);case"kk":return Lr(h,Bj);case"W":return Lr(a);case"WW":return Lr(r);case"E":case"c":return Lr(i);case"EEE":return Yh(e.weekdays("short",!1),1);case"EEEE":return Yh(e.weekdays("long",!1),1);case"ccc":return Yh(e.weekdays("short",!0),1);case"cccc":return Yh(e.weekdays("long",!0),1);case"Z":case"ZZ":return tte(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return tte(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return n3(/[a-z_+-/]{1,256}?/i);case" ":return n3(/[^\S\n\r]/);default:return f(v)}})(t)||{invalidReason:OFe};return _.token=t,_}const DFe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function NFe(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=DFe[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function FFe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function kFe(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(Q2(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function UFe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return mi(t.z)||(i=dp.create(t.z)),mi(t.Z)||(i||(i=new tl(t.Z)),r=t.Z),mi(t.q)||(t.M=(t.q-1)*3+1),mi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),mi(t.u)||(t.S=DY(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let Xz=null;function zFe(){return Xz||(Xz=ti.fromMillis(1555555555555)),Xz}function BFe(t,e){if(t.literal)return t;const i=Qa.macroTokenToFormatOpts(t.val),r=_ge(i,e);return r==null||r.includes(void 0)?t:r}function gge(t,e){return Array.prototype.concat(...t.map(i=>BFe(i,e)))}function yge(t,e,i){const r=gge(Qa.parseFormat(i),t),s=r.map(o=>LFe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=FFe(s),l=RegExp(o,"i"),[c,u]=kFe(e,l,a),[h,p,f]=u?UFe(u):[null,null,void 0];if(Q2(u,"a")&&Q2(u,"H"))throw new PS("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:h,zone:p,specificOffset:f}}}function VFe(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=yge(t,e,i);return[r,s,n,o]}function _ge(t,e){if(!t)return null;const r=Qa.create(e,t).dtFormatter(zFe()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>NFe(o,t,n))}const Zz="Invalid DateTime",ite=864e13;function o3(t){return new Hd("unsupported zone",`the zone "${t.name}" is not supported`)}function Jz(t){return t.weekData===null&&(t.weekData=jF(t.c)),t.weekData}function Qz(t){return t.localWeekData===null&&(t.localWeekData=jF(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function zv(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new ti({...i,...e,old:i})}function vge(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function a3(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function hD(t,e,i){return vge(Ek(t),e,i)}function rte(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,HF(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Tr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Ek(n);let[l,c]=vge(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function OE(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=ti.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return ti.invalid(new Hd("unparsable",`the input "${s}" can't be parsed as ${r}`))}function l3(t,e,i=!0){return t.isValid?Qa.create(rs.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Kz(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=lo(t.c.year,i?6:4),e?(r+="-",r+=lo(t.c.month),r+="-",r+=lo(t.c.day)):(r+=lo(t.c.month),r+=lo(t.c.day)),r}function ste(t,e,i,r,s,n){let o=lo(t.c.hour);return e?(o+=":",o+=lo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=lo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=lo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=lo(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=lo(Math.trunc(-t.o/60)),o+=":",o+=lo(Math.trunc(-t.o%60))):(o+="+",o+=lo(Math.trunc(t.o/60)),o+=":",o+=lo(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const bge={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},GFe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},jFe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},wge=["year","month","day","hour","minute","second","millisecond"],HFe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],qFe=["year","ordinal","hour","minute","second","millisecond"];function WFe(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Tme(t);return e}function nte(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return WFe(t)}}function ote(t,e){const i=h_(e.zone,kn.defaultZone),r=rs.fromObject(e),s=kn.now();let n,o;if(mi(t.year))n=s;else{for(const c of wge)mi(t[c])&&(t[c]=bge[c]);const a=Wme(t)||Yme(t);if(a)return ti.invalid(a);const l=i.offset(s);[n,o]=hD(t,l,i)}return new ti({ts:n,zone:i,loc:r,o})}function ate(t,e,i){const r=mi(i.round)?!0:i.round,s=(o,a)=>(o=NY(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function lte(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class ti{constructor(e){const i=e.zone||kn.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Hd("invalid input"):null)||(i.isValid?null:o3(i));this.ts=mi(e.ts)?kn.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=a3(this.ts,a),r=Number.isNaN(s.year)?new Hd("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||rs.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new ti({})}static local(){const[e,i]=lte(arguments),[r,s,n,o,a,l,c]=i;return ote({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=lte(arguments),[r,s,n,o,a,l,c]=i;return e.zone=tl.utcInstance,ote({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=xNe(e)?e.valueOf():NaN;if(Number.isNaN(r))return ti.invalid("invalid input");const s=h_(i.zone,kn.defaultZone);return s.isValid?new ti({ts:r,zone:s,loc:rs.fromObject(i)}):ti.invalid(o3(s))}static fromMillis(e,i={}){if(Kb(e))return e<-ite||e>ite?ti.invalid("Timestamp out of range"):new ti({ts:e,zone:h_(i.zone,kn.defaultZone),loc:rs.fromObject(i)});throw new mc(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(Kb(e))return new ti({ts:e*1e3,zone:h_(i.zone,kn.defaultZone),loc:rs.fromObject(i)});throw new mc("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=h_(i.zone,kn.defaultZone);if(!r.isValid)return ti.invalid(o3(r));const s=rs.fromObject(i),n=qF(e,nte),{minDaysInFirstWeek:o,startOfWeek:a}=Hee(n,s),l=kn.now(),c=mi(i.specificOffset)?r.offset(l):i.specificOffset,u=!mi(n.ordinal),h=!mi(n.year),p=!mi(n.month)||!mi(n.day),f=h||p,g=n.weekYear||n.weekNumber;if((f||u)&&g)throw new PS("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&u)throw new PS("Can't mix ordinal dates with month/day");const _=g||n.weekday&&!f;let v,b,w=a3(l,c);_?(v=HFe,b=GFe,w=jF(w,o,a)):u?(v=qFe,b=jFe,w=Yz(w)):(v=wge,b=bge);let T=!1;for(const N of v){const j=n[N];mi(j)?T?n[N]=b[N]:n[N]=w[N]:T=!0}const S=_?vNe(n,o,a):u?bNe(n):Wme(n),A=S||Yme(n);if(A)return ti.invalid(A);const P=_?Gee(n,o,a):u?jee(n):n,[R,F]=hD(P,c,r),k=new ti({ts:R,zone:r,o:F,loc:s});return n.weekday&&f&&e.weekday!==k.weekday?ti.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${k.toISO()}`):k}static fromISO(e,i={}){const[r,s]=hFe(e);return OE(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=dFe(e);return OE(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=pFe(e);return OE(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(mi(e)||mi(i))throw new mc("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=rs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=VFe(o,e,i);return u?ti.invalid(u):OE(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return ti.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=bFe(e);return OE(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new mc("need to specify a reason the DateTime is invalid");const r=e instanceof Hd?e:new Hd(e,i);if(kn.throwOnInvalid)throw new XDe(r);return new ti({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=_ge(e,rs.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return gge(Qa.parseFormat(e),rs.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Jz(this).weekYear:NaN}get weekNumber(){return this.isValid?Jz(this).weekNumber:NaN}get weekday(){return this.isValid?Jz(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?Qz(this).weekday:NaN}get localWeekNumber(){return this.isValid?Qz(this).weekNumber:NaN}get localWeekYear(){return this.isValid?Qz(this).weekYear:NaN}get ordinal(){return this.isValid?Yz(this.c).ordinal:NaN}get monthShort(){return this.isValid?s3.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?s3.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?s3.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?s3.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=Ek(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,u=a3(l,o),h=a3(c,a);return u.hour===h.hour&&u.minute===h.minute&&u.second===h.second&&u.millisecond===h.millisecond?[zv(this,{ts:l}),zv(this,{ts:c})]:[this]}get isInLeapYear(){return ZR(this.year)}get daysInMonth(){return HF(this.year,this.month)}get daysInYear(){return this.isValid?u2(this.year):NaN}get weeksInWeekYear(){return this.isValid?kO(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?kO(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=Qa.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(tl.instance(e),i)}toLocal(){return this.setZone(kn.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=h_(e,kn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=hD(o,n,e)}return zv(this,{ts:s,zone:e})}else return ti.invalid(o3(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return zv(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=qF(e,nte),{minDaysInFirstWeek:r,startOfWeek:s}=Hee(i,this.loc),n=!mi(i.weekYear)||!mi(i.weekNumber)||!mi(i.weekday),o=!mi(i.ordinal),a=!mi(i.year),l=!mi(i.month)||!mi(i.day),c=a||l,u=i.weekYear||i.weekNumber;if((c||o)&&u)throw new PS("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new PS("Can't mix ordinal dates with month/day");let h;n?h=Gee({...jF(this.c,r,s),...i},r,s):mi(i.ordinal)?(h={...this.toObject(),...i},mi(i.day)&&(h.day=Math.min(HF(h.year,h.month),h.day))):h=jee({...Yz(this.c),...i});const[p,f]=hD(h,this.o,this.zone);return zv(this,{ts:p,o:f})}plus(e){if(!this.isValid)return this;const i=Tr.fromDurationLike(e);return zv(this,rte(this,i))}minus(e){if(!this.isValid)return this;const i=Tr.fromDurationLike(e).negate();return zv(this,rte(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=Tr.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?Qa.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):Zz}toLocaleString(e=GF,i={}){return this.isValid?Qa.create(this.loc.clone(i),e).formatDateTime(this):Zz}toLocaleParts(e={}){return this.isValid?Qa.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=Kz(this,o);return a+="T",a+=ste(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?Kz(this,e==="extended"):null}toISOWeekDate(){return l3(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+ste(this,o==="extended",i,e,r,n):null}toRFC2822(){return l3(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return l3(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Kz(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),l3(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Zz}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Tr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=TNe(i).map(Tr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=AFe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(ti.now(),e,i)}until(e){return this.isValid?vn.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||ti.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),ate(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?ate(e.base||ti.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(ti.isDateTime))throw new mc("min requires all arguments be DateTimes");return qee(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(ti.isDateTime))throw new mc("max requires all arguments be DateTimes");return qee(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=rs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return yge(o,e,i)}static fromStringExplain(e,i,r={}){return ti.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return GF}static get DATE_MED(){return Sme}static get DATE_MED_WITH_WEEKDAY(){return QDe}static get DATE_FULL(){return Cme}static get DATE_HUGE(){return Eme}static get TIME_SIMPLE(){return Ame}static get TIME_WITH_SECONDS(){return Mme}static get TIME_WITH_SHORT_OFFSET(){return Pme}static get TIME_WITH_LONG_OFFSET(){return Ome}static get TIME_24_SIMPLE(){return Rme}static get TIME_24_WITH_SECONDS(){return $me}static get TIME_24_WITH_SHORT_OFFSET(){return Ime}static get TIME_24_WITH_LONG_OFFSET(){return Lme}static get DATETIME_SHORT(){return Dme}static get DATETIME_SHORT_WITH_SECONDS(){return Nme}static get DATETIME_MED(){return Fme}static get DATETIME_MED_WITH_SECONDS(){return kme}static get DATETIME_MED_WITH_WEEKDAY(){return KDe}static get DATETIME_FULL(){return Ume}static get DATETIME_FULL_WITH_SECONDS(){return zme}static get DATETIME_HUGE(){return Bme}static get DATETIME_HUGE_WITH_SECONDS(){return Vme}}function RE(t){if(ti.isDateTime(t))return t;if(t&&t.valueOf&&Kb(t.valueOf()))return ti.fromJSDate(t);if(t&&typeof t=="object")return ti.fromObject(t);throw new mc(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const um="system",BY="unknown",UO="UTC",YFe=Intl.DateTimeFormat().resolvedOptions().timeZone,XFe="shortOffset";function ZFe(t){return"timeZoneIANA"in t}function JFe(t){return t.startsWith("UTC")}function NPt(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?QFe(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?KFe(i):null}}}}}function QFe(t,e=um){return t?ZFe(t)?t.timeZoneIANA:e4e(t,e):e}function KFe(t){return{timeZoneIANA:t}}function e4e(t,e=um){if(!t||!$ee.has(t.timeZone))return e;const i=$ee.get(t.timeZone);return JFe(t.timeZone)||t.respectsDaylightSaving?i:t4e(i)}function t4e(t){const e=ti.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${tl.instance(-i).formatOffset(0,"narrow")}`}function FPt(t,e,i,r,s){if(e&&s==="date")return{timeZone:UO,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===BY;return{timeZone:o?s==="timestamp-offset"?void 0:t??UO:i,timeZoneName:o&&n?XFe:void 0}}const i4e={year:void 0,month:void 0,day:void 0,weekday:void 0},r4e={hour:void 0,minute:void 0,second:void 0},xge={timeZone:UO},Pp={year:"numeric",month:"numeric",day:"numeric"},$E={year:"numeric",month:"long",day:"numeric"},IE={year:"numeric",month:"short",day:"numeric"},LE={year:"numeric",month:"long",weekday:"long",day:"numeric"},e_={hour:"numeric",minute:"numeric"},C1={...e_,second:"numeric"},Tge={hourCycle:"h23"},DE={...e_,...Tge},NE={...C1,...Tge},Sge={"short-date":Pp,"short-date-short-time":{...Pp,...e_},"short-date-short-time-24":{...Pp,...DE},"short-date-long-time":{...Pp,...C1},"short-date-long-time-24":{...Pp,...NE},"short-date-le":Pp,"short-date-le-short-time":{...Pp,...e_},"short-date-le-short-time-24":{...Pp,...DE},"short-date-le-long-time":{...Pp,...C1},"short-date-le-long-time-24":{...Pp,...NE},"long-month-day-year":$E,"long-month-day-year-short-time":{...$E,...e_},"long-month-day-year-short-time-24":{...$E,...DE},"long-month-day-year-long-time":{...$E,...C1},"long-month-day-year-long-time-24":{...$E,...NE},"day-short-month-year":IE,"day-short-month-year-short-time":{...IE,...e_},"day-short-month-year-short-time-24":{...IE,...DE},"day-short-month-year-long-time":{...IE,...C1},"day-short-month-year-long-time-24":{...IE,...NE},"long-date":LE,"long-date-short-time":{...LE,...e_},"long-date-short-time-24":{...LE,...DE},"long-date-long-time":{...LE,...C1},"long-date-long-time-24":{...LE,...NE},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":e_,"long-time":C1},s4e=rl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Cge={ar:"ar-u-nu-latn-ca-gregory"};let Vj=new WeakMap;const Pk=Sge["short-date-short-time"];function n4e(t){let e=Vj.get(t);if(!e){const i=Ec(),r=Cge[i]||i,s=VY(t.timeZone??um),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),Vj.set(t,e)}return e}function o4e(t){return Sge[t]}function W_(t,e=Pk){return n4e(e).format(t)}function kPt(t,e=Pk){return W_(new Date(t),{...e,...xge,...r4e})}function UPt(t,e=Pk){return W_(new Date(`1970-01-01T${t}Z`),{...e,...xge,...i4e})}function zPt(t,e=Pk){if(e.timeZone)return W_(new Date(t),e);const i=ti.fromISO(t,{setZone:!0}),r=Ec(),s=Cge[r]??r,n=i.offset===0?UO:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function VY(t){switch(t){case um:return YFe;case BY:return UO;default:return t}}$Y(()=>{Vj=new WeakMap});const a4e={ar:"ar-u-nu-latn"};let dD=new WeakMap,Ege={};function Gj(t){const e=t||Ege;if(!dD.has(e)){const i=Ec(),r=a4e[Ec()]||i;dD.set(e,new Intl.NumberFormat(r,t))}return dD.get(e)}function BPt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function zO(t,e){return Object.is(t,-0)&&(t=0),Gj(e).format(t)}function VPt(t,e=Ec()){if(!t)return null;let i=cte.get(e);if(!i){const r=Gj().formatToParts(12345.6),s=[...Gj({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(s.map((h,p)=>[h,p])),o=new RegExp(`[${r.find(h=>h.type==="group")?.value}]`,"g"),a=new RegExp(`[${r.find(h=>h.type==="decimal")?.value}]`),l=new RegExp(`[${s.join("")}]`,"g"),c=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,u=/[-\u2212\u2013\u2014\u2015]/g;i=h=>{if((h=h.trim().replaceAll(o,"").replace(a,".").replace(l,f=>String(n.get(f))).replaceAll(c,"").replaceAll(u,"-"))==="")return null;const p=Number(h);return isNaN(p)?null:p},cte.set(e,i)}return i(t)}$Y(()=>{dD=new WeakMap,Ege={}});const cte=new Map,Age=()=>le.getLogger("esri.intl.substitute");function l4e(t,e,i={}){const{format:r={}}=i;return ek(t,s=>c4e(s,e,r))}function c4e(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const o=Vg(r,e);if(o==null)return"";const a=(s?i?.[s]:null)??i?.[r];return a?u4e(o,a):s?h4e(o,s):GY(o)}function u4e(t,e){switch(e.type){case"date":return W_(t,e.intlOptions);case"number":return zO(t,e.intlOptions);default:return Age().warn("missing format descriptor for key {key}"),GY(t)}}function h4e(t,e){switch(e.toLowerCase()){case"dateformat":return W_(t);case"numberformat":return zO(t);default:return Age().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?W_(t):/^numberformat/i.test(e)?zO(t):GY(t)}}function GY(t){switch(typeof t){case"string":return t;case"number":return zO(t);case"boolean":return""+t;default:return t instanceof Date?W_(t):""}}const ute=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,d4e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function hte(t){return t in d4e}const zA=[],d2=new Map;function dte(t){for(const e of d2.keys())Pge(t.pattern,e)&&d2.delete(e)}function p4e(t){return zA.includes(t)||(dte(t),zA.unshift(t)),Mi(()=>{const e=zA.indexOf(t);e>-1&&(zA.splice(e,1),dte(t))})}async function Mge(t){const e=Ec();d2.has(t)||d2.set(t,m4e(t,e));const i=d2.get(t);return i&&await g4e.add(i),i}function f4e(t){if(!ute.test(t))return null;const e=ute.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return hte(s)?s:hte(i)?i:null}async function m4e(t,e){const i=[];for(const r of zA)if(Pge(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new W("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new W("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Pge(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}$Y(()=>{d2.clear()});const g4e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Pn())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function y4e(t,e,i,r){const s=e.exec(i);if(!s)throw new W("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=f4e(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await pte(t(c))}catch(h){if(c===l)throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:h});try{u=await pte(t(l))}catch(p){throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p})}}return u}async function pte(t){if(fte.fetchBundleAsset!=null)return fte.fetchBundleAsset(t);const e=await Yi(t,{responseType:"text"});return JSON.parse(e.data)}let _4e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return y4e(this.getAssetUrl,this.matcher,e,i)}};function v4e(t){return new _4e(t)}const fte={};p4e(v4e({pattern:"esri/",location:sr}));function jPt(t){return typeof t=="number"}function jY(t){return typeof t=="string"||t instanceof String}const b4e="yyyy-MM-dd",w4e="TT";var kP;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(kP||(kP={}));const x4e=[kP.HMS_MS,kP.HMS,kP.HM,w4e];function mte(t){if(!t||!jY(t))return null;const e=ti.fromFormat(t,b4e);return e.isValid?e:null}function gte(t){return t&&jY(t)?W$e(x4e,e=>{const i=ti.fromFormat(t,e);return i.isValid?i:null})??null:null}function yte(t){if(!t||!jY(t))return null;const e=ti.fromISO(t);return e.isValid?e:null}var K2;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(K2||(K2={}));const T4e=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function S4e(t){return t!=null&&T4e.has(t.type)}function Oge(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function Rge(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function $ge(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function C4e(t,e,i){const r=i??t?.domain;if(!r)return null;switch(r.type){case"range":{const{min:s,max:n}=Ige(t,i);if(s!=null&&+e<s||n!=null&&+e>n)return K2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(s=>s==null||s.code!==e))return K2.INVALID_CODED_VALUE}return null}function Ige(t,e){const i=e??t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=S4e(t);return Oge(t)||$ge(t)||Rge(t)?{...E4e(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function E4e(t,e,i){return Oge(t)?{min:mte(i)?.toMillis(),max:mte(e)?.toMillis(),rawMin:i,rawMax:e}:$ge(t)?{min:gte(i)?.toMillis(),max:gte(e)?.toMillis(),rawMin:i,rawMax:e}:Rge(t)?{min:yte(i)?.toMillis(),max:yte(e)?.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}const A4e=()=>le.getLogger("esri.support.arcadeOnDemand");let eB;function HY(){return eB||(eB=(async()=>{const t=await ue(()=>import("./arcadeUtils-cf56dd4d.js").then(e=>e.aN),["./arcadeUtils-cf56dd4d.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./ImmutableArray-d5cad66d.js","./number-6c4d71c9.js","./FieldsIndex-e68ff75c.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),eB}const M4e=(t,e,i)=>qY.create(t,e,i,null,["$feature","$view"],[]),Lge=(t,e,i)=>qY.create(t,e,i,null,["$feature","$view"],[]),HPt=(t,e,i,r)=>qY.create(t,e,i,r,["$feature","$view"],[]);let qY=class Dge{constructor(e,i,r,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o?.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await HY(),u=We.fromJSON(i);let h;try{h=a.parseScript(e,o)}catch(F){return A4e().error(new W("arcade-bad-expression","Failed to parse arcade script",{script:e,error:F})),null}const p=n.reduce((F,k)=>({...F,[k]:null}),{});let f=null;s!=null&&(f=new c(s),f.immutable=!0,p.$config=null);const g=a.scriptUsesGeometryEngine(h),_=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(h)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(h),w=b&&a.enableAsyncSupport(),T={vars:p,spatialReference:u,useAsync:!!w};await Promise.all([_,v,w]);const S=new Set;await a.loadDependentModules(S,h,null,b,g);const A=new c;A.immutable=!1,A.setField("scale",0);const P=a.compileScript(h,T),R=(F,k)=>{const N=F.$view?.timeZone;return"$view"in F&&F.$view&&(A.setField("scale",typeof F.$view=="object"&&"scale"in F.$view?F.$view.scale:void 0),F.$view=A),f&&(F.$config=f),P({vars:F,spatialReference:u,services:k,timeZone:N})};return new Dge(e,a,h,R,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const P4e=/^([0-9_])/,O4e=/[^a-z0-9_\u0080-\uffff]+/gi;function qPt(t){return t==null?null:t.trim().replaceAll(O4e,"_").replace(P4e,"F$1")||null}const R4e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],$4e=["field","normalizationField"];function WPt(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(_te(R4e,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)_te($4e,r,e)}}function _te(t,e,i){if(t)for(const r of t){const s=Vg(r,e),n=s&&typeof s!="function"&&i.get(s);n&&Xf(r,n.name,e)}}function YPt(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const tB=new Set;function Nge(t,e){return t&&e?(tB.clear(),BO(tB,t,e),Array.from(tB).sort()):[]}function BO(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)Ok(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function Ok(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function XPt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Y_(t,e,i){if(!i)return;const{arcadeUtils:r}=await HY(),s=r.extractFieldNames(i,e?.fields?.map(n=>n.name));for(const n of s)Ok(t,e,n)}async function Fge(t,e,i){if(i&&i!=="1=1"){const r=await bme(i,e);if(!r.isStandardized)throw new W("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});BO(t,e,r.fieldNames)}}function ZPt({displayField:t,fields:e}){return t||(e?.length?iB(e,"name-or-title")||iB(e,"unique-identifier")||iB(e,"type-or-category")||I4e(e):null)}function I4e(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function iB(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function JPt(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function L4e(t,e,i){i.onStatisticExpression?Y_(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function QPt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(D4e(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>L4e(t,e.fieldsIndex,n))),await Promise.all(r)}async function D4e(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(n=>Y_(t,e.fieldsIndex,n.expression)));const s=i?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Y_(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function KPt(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&BO(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&BO(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await Fge(t,e.fieldsIndex,i.where))}async function eOt(t,e,i){e&&i&&await Promise.all(i.map(r=>N4e(t,e,r)))}async function N4e(t,e,i){e&&i&&(i.valueExpression?await Y_(t,e.fieldsIndex,i.valueExpression):i.field&&Ok(t,e.fieldsIndex,i.field))}function tOt(t){return t?Nge(t.fieldsIndex,kge(t)):[]}function F4e(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?Nge(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const k4e=new Set(["oid","global-id","guid"]),U4e=new Set(["oid","global-id"]),z4e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function B4e(t){const e=new Set;Uge(t).forEach(r=>e.add(r)),F4e(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function kge(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function Uge(t){return kge(t).map(e=>e.toLowerCase())}function iOt(t,e){return t.editable&&!k4e.has(t.type)&&!Uge(e).includes(t.name?.toLowerCase()??"")}function rOt(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||B4e(e).includes(i)||U4e.has(t.type)||z4e.some(r=>r.test(i)))}async function sOt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(s=>V4e(t,r,s)))}async function V4e(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Y_(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Ok(t,e,o.slice(1,-1))})}await Fge(t,e,s)}function nOt(t){const e=t.defaultValue;return e!==void 0&&Vge(t,e)?e:t.nullable?null:void 0}function oOt(t){const e=typeof t=="string"?{type:t}:t;return e5e(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function zge(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function G4e(t){return t===null||zge(t)}function j4e(t){return t===null||Number.isInteger(t)}function Bge(t){return t!=null&&typeof t=="string"}function H4e(t){return t===null||Bge(t)}function q4e(){return!0}function Vge(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?j4e:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?G4e:zge;break;case"string":case"esriFieldTypeString":i=t.nullable?H4e:Bge;break;default:i=q4e}return arguments.length===1?i:i(e)}const W4e=["integer","small-integer","big-integer"],Y4e=["single","double"],X4e=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Z4e=["esriFieldTypeSingle","esriFieldTypeDouble"],J4e=new Set([...W4e,...X4e]),Q4e=new Set([...Y4e,...Z4e]),K4e=$pe(J4e,Q4e);function Gge(t){return t!=null&&K4e.has(t.type)}function e5e(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function t5e(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function aOt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function lOt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function cOt(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function uOt(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function hOt(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function dOt(t,e){return i5e(t,e)===null}var WF,YF;function pOt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function i5e(t,e){return t==null||t.nullable&&e===null?null:Gge(t)&&!r5e(t.type,Number(e))?WF.OUT_OF_RANGE:Vge(t,e)?t.domain?C4e(t,e):null:YF.INVALID_TYPE}function r5e(t,e){const i=typeof t=="string"?jge(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function jge(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return s5e;case"esriFieldTypeInteger":case"integer":return n5e;case"esriFieldTypeBigInteger":case"big-integer":return o5e;case"esriFieldTypeSingle":case"single":return a5e;case"esriFieldTypeDouble":case"double":return l5e}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(WF||(WF={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(YF||(YF={}));const s5e={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},n5e={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},o5e={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},a5e={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},l5e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function fOt(t,e,i){switch(t){case K2.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case K2.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case YF.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case WF.OUT_OF_RANGE:{const{min:r,max:s}=jge(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function mOt(t,e){return!c5e(t,e,null)}function c5e(t,e,i){if(!e?.attributes||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function gOt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function u5e(t){const e=t?.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let pD=class extends Me{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],pD.prototype,"type",void 0),pD=d([U("esri.popup.content.Content")],pD);const gv=pD;var jj;let E1=jj=class extends gv{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new jj({description:this.description,displayType:this.displayType,title:this.title})}};d([m({type:String,json:{write:!0}})],E1.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],E1.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],E1.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],E1.prototype,"type",void 0),E1=jj=d([U("esri.popup.content.AttachmentsContent")],E1);const XF=E1;var Hj;let A1=Hj=class extends gv{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new Hj({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ge(this.outFields):null})}};d([m()],A1.prototype,"creator",void 0),d([m()],A1.prototype,"destroyer",void 0),d([m()],A1.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],A1.prototype,"type",void 0),A1=Hj=d([U("esri.popup.content.CustomContent")],A1);const h5e=A1;var qj;let FT=qj=class extends Me{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new qj({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],FT.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],FT.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],FT.prototype,"returnType",void 0),FT=qj=d([U("esri.popup.ElementExpressionInfo")],FT);const d5e=FT;var Wj;let BA=Wj=class extends gv{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new Wj({expressionInfo:this.expressionInfo?.clone()})}};d([m({type:d5e,json:{write:!0}})],BA.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],BA.prototype,"type",void 0),BA=Wj=d([U("esri.popup.content.ExpressionContent")],BA);const WY=BA;function At(t,e={}){const i=t instanceof Do?t:new Do(t,e),r={type:e?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!e?.readOnly&&{reader:i.read},write:{writer:i.write}}};return e?.readOnly!==void 0&&(r.readOnly=!!e.readOnly),e?.default!==void 0&&(r.json.default=e.default),e?.name!==void 0&&(r.json.name=e.name),e?.nonNullable!==void 0&&(r.nonNullable=e.nonNullable),m(r)}let kT=class extends Ic(Me){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};d([At(s4e)],kT.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],kT.prototype,"digitSeparator",void 0),d([m({type:Rr,json:{write:!0}})],kT.prototype,"places",void 0),kT=d([U("esri.popup.support.FieldInfoFormat")],kT);const p5e=kT;var Yj;let ld=Yj=class extends Me{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Yj({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([m({type:String,json:{write:!0}})],ld.prototype,"fieldName",void 0),d([m({type:p5e,json:{write:!0}})],ld.prototype,"format",void 0),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],ld.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],ld.prototype,"label",void 0),d([At(new Do({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],ld.prototype,"stringFieldOption",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],ld.prototype,"statisticType",void 0),d([m({type:String,json:{write:!0}})],ld.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],ld.prototype,"visible",void 0),ld=Yj=d([U("esri.popup.FieldInfo")],ld);const Hge=ld;var Xj;let ng=Xj=class extends gv{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new Xj(ge({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],ng.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],ng.prototype,"description",void 0),d([m({type:[Hge]})],ng.prototype,"fieldInfos",void 0),d([Ut("fieldInfos")],ng.prototype,"writeFieldInfos",null),d([m({type:String,json:{write:!0}})],ng.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],ng.prototype,"type",void 0),ng=Xj=d([U("esri.popup.content.FieldsContent")],ng);const ZF=ng;let M1=class extends Me{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],M1.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],M1.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],M1.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],M1.prototype,"type",void 0),M1=d([U("esri.popup.content.mixins.MediaInfo")],M1);const YY=M1,JF={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function qge(t){return!!JF[t]||!!JF[t.toLowerCase()]}function XY(t){return JF[t]??JF[t.toLowerCase()]}function f5e(t){return[...XY(t)]}function rB(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Wge(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*rB(o,n,s+1/3)),Math.round(255*rB(o,n,s)),Math.round(255*rB(o,n,s-1/3)),r]}function m5e(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function c3(t){return Te(JW(t),0,255)}function u3(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function h3(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let fD=class To{static blendColors(e,i,r,s=new To){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),To.fromArray(a,i)}return To.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return To.fromArray(Wge(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new To){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return To.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return To.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new To){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=qge(e)?XY(e):null;return r&&To.fromArray(r,i)||To.fromRgb(e,i)||To.fromHex(e,i)}static fromJSON(e){return e!=null?new To([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?To.fromString(e,this):Array.isArray(e)?To.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof To||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,s=r===3||r===4,n=r===4||r===8,o=`#${h3(this.r,s)}${h3(this.g,s)}${h3(this.b,s)}${n?h3(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=To.AlphaMode.ALWAYS){const i=c3(this.r),r=c3(this.g),s=c3(this.b);return e===To.AlphaMode.ALWAYS||this.a!==1?[i,r,s,c3(255*this.a)]:[i,r,s]}clone(){return new To(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(u3(this.r,0,255)),this.g=Math.round(u3(this.g,0,255)),this.b=Math.round(u3(this.b,0,255)),this.a=u3(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};fD.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(fD||(fD={}));const et=fD;var Zj;let P1=Zj=class extends Pe{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Zj({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],P1.prototype,"color",void 0),d([m()],P1.prototype,"fieldName",void 0),d([m()],P1.prototype,"tooltip",void 0),d([m()],P1.prototype,"value",void 0),P1=Zj=d([U("esri.popup.content.support.ChartMediaInfoValueSeries")],P1);const g5e=P1;var Jj;let Cy=Jj=class extends Me{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Jj({colors:ge(this.colors),fields:ge(this.fields),normalizeField:this.normalizeField,series:ge(this.series),tooltipField:this.tooltipField})}};d([m({type:[et],json:{type:[[Rr]],write:!0}})],Cy.prototype,"colors",void 0),d([m({type:[String],json:{write:!0}})],Cy.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],Cy.prototype,"normalizeField",void 0),d([m({type:[g5e],json:{read:!1}})],Cy.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],Cy.prototype,"tooltipField",void 0),Cy=Jj=d([U("esri.popup.content.support.ChartMediaInfoValue")],Cy);const y5e=Cy;let VA=class extends YY{constructor(e){super(e),this.type=null,this.value=void 0}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],VA.prototype,"type",void 0),d([m({type:y5e,json:{write:!0}})],VA.prototype,"value",void 0),VA=d([U("esri.popup.content.mixins.ChartMediaInfo")],VA);const Rk=VA,$k=rl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Qj;let mD=Qj=class extends Rk{constructor(t){super(t),this.type="bar-chart"}clone(){return new Qj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:$k.write}})],mD.prototype,"type",void 0),mD=Qj=d([U("esri.popup.content.BarChartMediaInfo")],mD);const Yge=mD;var Kj;let gD=Kj=class extends Rk{constructor(t){super(t),this.type="column-chart"}clone(){return new Kj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:$k.write}})],gD.prototype,"type",void 0),gD=Kj=d([U("esri.popup.content.ColumnChartMediaInfo")],gD);const Xge=gD;var eH;let GA=eH=class extends Me{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new eH({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],GA.prototype,"linkURL",void 0),d([m({type:String,json:{write:!0}})],GA.prototype,"sourceURL",void 0),GA=eH=d([U("esri.popup.content.support.ImageMediaInfoValue")],GA);const _5e=GA;var tH;let UT=tH=class extends YY{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new tH({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};d([m({type:Number,json:{write:!0}})],UT.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],UT.prototype,"type",void 0),d([m({type:_5e,json:{write:!0}})],UT.prototype,"value",void 0),UT=tH=d([U("esri.popup.content.ImageMediaInfo")],UT);const Zge=UT;var iH;let yD=iH=class extends Rk{constructor(t){super(t),this.type="line-chart"}clone(){return new iH({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:$k.write}})],yD.prototype,"type",void 0),yD=iH=d([U("esri.popup.content.LineChartMediaInfo")],yD);const Jge=yD;var rH;let _D=rH=class extends Rk{constructor(t){super(t),this.type="pie-chart"}clone(){return new rH({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:$k.write}})],_D.prototype,"type",void 0),_D=rH=d([U("esri.popup.content.PieChartMediaInfo")],_D);const Qge=_D,Kge={base:YY,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Yge,"column-chart":Xge,"line-chart":Jge,"pie-chart":Qge,image:Zge}};var sH;let cd=sH=class extends gv{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?Zge.fromJSON(e):e.type==="barchart"?Yge.fromJSON(e):e.type==="columnchart"?Xge.fromJSON(e):e.type==="linechart"?Jge.fromJSON(e):e.type==="piechart"?Qge.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new sH(ge({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],cd.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],cd.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],cd.prototype,"description",void 0),d([m({types:[Kge]})],cd.prototype,"mediaInfos",void 0),d([_i("mediaInfos")],cd.prototype,"readMediaInfos",null),d([Ut("mediaInfos")],cd.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],cd.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],cd.prototype,"type",void 0),cd=sH=d([U("esri.popup.content.MediaContent")],cd);const QF=cd;var nH;let jA=nH=class extends Me{constructor(t){super(t),this.field=null,this.order=null}clone(){return new nH({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],jA.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],jA.prototype,"order",void 0),jA=nH=d([U("esri.popup.support.RelatedRecordsInfoFieldOrder")],jA);const e0e=jA;let rf=class extends Ic(gv){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],rf.prototype,"description",void 0),d([m({type:Number,json:{type:Rr,write:!0}})],rf.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],rf.prototype,"displayType",void 0),d([m({type:[e0e],json:{write:!0}})],rf.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:Rr,write:!0}})],rf.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],rf.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],rf.prototype,"type",void 0),rf=d([U("esri.popup.content.RelationshipContent")],rf);const KF=rf;var oH;let HA=oH=class extends gv{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new oH({text:this.text})}};d([m({type:String,json:{write:!0}})],HA.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],HA.prototype,"type",void 0),HA=oH=d([U("esri.popup.content.TextContent")],HA);const e4=HA,v5e={base:null,key:"type",typeMap:{attachment:XF,media:QF,text:e4,expression:WY,field:ZF,relationship:KF}};var aH;let O1=aH=class extends Me{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new aH({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],O1.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],O1.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],O1.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],O1.prototype,"returnType",void 0),O1=aH=d([U("esri.popup.ExpressionInfo")],O1);const b5e=O1;var lH;let qA=lH=class extends Me{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new lH({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],qA.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],qA.prototype,"showNoDataRecords",void 0),qA=lH=d([U("esri.popup.LayerOptions")],qA);const w5e=qA;var cH;let WA=cH=class extends Me{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new cH({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ge(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],WA.prototype,"showRelatedRecords",void 0),d([m({type:[e0e],json:{write:!0}})],WA.prototype,"orderByFields",void 0),WA=cH=d([U("esri.popup.RelatedRecordsInfo")],WA);const x5e=WA;let t0e=0;const ZY=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+t0e++})}};return e=d([U("esri.core.Identifiable")],e),e},xOt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:t0e++})}};return e=d([U("esri.core.Identifiable.NumericIdentifiable")],e),e};let vte=class extends ZY(class{}){};vte=d([U("esri.core.Identifiable")],vte);var uH;let Hu=uH=class extends ZY(Pe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new uH({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],Hu.prototype,"active",void 0),d([m()],Hu.prototype,"className",void 0),d([m()],Hu.prototype,"disabled",void 0),d([m()],Hu.prototype,"icon",void 0),d([m()],Hu.prototype,"id",void 0),d([m()],Hu.prototype,"indicator",void 0),d([m()],Hu.prototype,"title",void 0),d([m()],Hu.prototype,"type",void 0),d([m()],Hu.prototype,"visible",void 0),Hu=uH=d([U("esri.support.actions.ActionBase")],Hu);const JY=Hu;var hH;let vD=hH=class extends JY{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new hH({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],vD.prototype,"image",void 0),vD=hH=d([U("esri.support.actions.ActionButton")],vD);const T5e=vD;var dH;let YA=dH=class extends JY{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new dH({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],YA.prototype,"image",void 0),d([m()],YA.prototype,"value",void 0),YA=dH=d([U("esri.support.actions.ActionToggle")],YA);const S5e=YA,FE="relationships/",bte="expression/",C5e=lt.ofType({key:"type",defaultKeyValue:"button",base:JY,typeMap:{button:T5e,toggle:S5e}}),E5e={base:gv,key:"type",typeMap:{media:QF,custom:h5e,text:e4,attachments:XF,fields:ZF,expression:WY,relationship:KF}},A5e=new Set(["attachments","fields","media","text","expression","relationship"]);let So=class extends Ic(Me){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>lm(E5e,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||$c(e)?e:(le.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>A5e.has(n.type)).map(n=>n?.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),BO(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ge(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>o.fieldName?.toLowerCase()===s.fieldName?.toLowerCase());n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ge(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),QF.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),e4.fromJSON(n)):n.type==="attachments"?XF.fromJSON(n):n.type==="fields"?ZF.fromJSON(n):n.type==="expression"?WY.fromJSON(n):n.type==="relationship"?KF.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(FE))return null;const s=i.replace(FE,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?KF.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${FE}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new e4({text:e})):n.push(new ZF),Array.isArray(i)&&i.length&&n.push(QF.fromJSON({mediaInfos:i})),r&&n.push(XF.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,h=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&h.push(a),l&&h.push(l),h}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>Y_(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(FE)||i.startsWith(bte))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return u5e(e).filter(i=>!(i.indexOf(FE)===0||i.indexOf(bte)===0))}};d([m({type:C5e})],So.prototype,"actions",void 0),d([m()],So.prototype,"content",void 0),d([cr("content")],So.prototype,"castContent",null),d([_i("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],So.prototype,"readContent",null),d([Ut("content",{popupElements:{type:lt.ofType(v5e)},showAttachments:{type:Boolean},mediaInfos:{type:lt.ofType(Kge)},description:{type:String},relatedRecordsInfo:{type:x5e}})],So.prototype,"writeContent",null),d([m({type:[b5e],json:{write:!0}})],So.prototype,"expressionInfos",void 0),d([m({type:[Hge]})],So.prototype,"fieldInfos",void 0),d([Ut("fieldInfos")],So.prototype,"writeFieldInfos",null),d([m({type:w5e})],So.prototype,"layerOptions",void 0),d([Ut("layerOptions")],So.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],So.prototype,"lastEditInfoEnabled",void 0),d([m()],So.prototype,"outFields",void 0),d([m()],So.prototype,"overwriteActions",void 0),d([m()],So.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],So.prototype,"title",void 0),d([Ut("title")],So.prototype,"writeTitle",null),So=d([U("esri.PopupTemplate")],So);const M5e=So,wte=new Do({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let P5e=0,zT=class extends Me{constructor(e){super(e),this.id="sym"+P5e++,this.type=null,this.color=new et([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:wte.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:wte.write}}})],zT.prototype,"type",void 0),d([m({type:et,json:{write:{allowNull:!0}}})],zT.prototype,"color",void 0),d([_i("color")],zT.prototype,"readColor",null),zT=d([U("esri.symbols.Symbol")],zT);const nl=zT;var pH;let Ey=pH=class extends nl{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return n?Y_(t,e,n.expression):null});await Promise.all(r)}}}clone(){return new pH({data:ge(this.data)})}hash(){return XW(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],Ey.prototype,"color",void 0),d([m({json:{write:!0}})],Ey.prototype,"data",void 0),d([_i("data",["symbol"])],Ey.prototype,"readData",null),d([Ut("data",{})],Ey.prototype,"writeData",null),d([At({CIMSymbolReference:"cim"},{readOnly:!0})],Ey.prototype,"type",void 0),Ey=pH=d([U("esri.symbols.CIMSymbol")],Ey);const rx=Ey;let BT=class extends Me{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],BT.prototype,"enabled",void 0),d([Ut("enabled")],BT.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],BT.prototype,"type",void 0),BT=d([U("esri.symbols.Symbol3DLayer")],BT);const wm=BT,O5e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,R5e="screenUtils.toPt: input not recognized!",i0e=96;function dn(t){return t?t/72*i0e:0}function No(t){return t?72*t/i0e:0}function en(t){if(typeof t=="string"){const e=t.match(O5e);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?No(i):i;return s?-n:n}return console.warn(R5e),null}return t}function $h(t=0,e=0){return{x:t,y:e}}function ns(t=0,e=0){return[t,e]}function r0e(t=0,e=0){return[t,e]}function Jo(t=0,e=0,i=0){return[t,e,i]}function AOt(t){return t}function MOt(t){return t}function POt(t){return t}function zd(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function QY(t){const e=JW(100*(1-t));return Math.max(0,Math.min(e,100))}function KY(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}function $5e(t,e){const i=e.transparency!=null?KY(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new et([r[0]||0,r[1]||0,r[2]||0,i]):null}function I5e(t,e){e.color=t.toJSON().slice(0,3);const i=QY(t.a);i!==0&&(e.transparency=i)}const C0={type:et,json:{type:[Rr],default:null,read:{source:["color","transparency"],reader:$5e},write:{target:{color:{type:[Rr]},transparency:{type:Rr}},writer:I5e}}},hm={type:Number,cast:en,json:{write:!0}};let R1=class extends Me{constructor(e){super(e),this.color=new et([0,0,0,1]),this.extensionLength=0,this.size=No(1)}clone(){}cloneProperties(){return{color:ge(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],R1.prototype,"type",void 0),d([m(C0)],R1.prototype,"color",void 0),d([m({...hm,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],R1.prototype,"extensionLength",void 0),d([m(hm)],R1.prototype,"size",void 0),R1=d([U("esri.symbols.edges.Edges3D")],R1);const eX=R1;var fH;let bD=fH=class extends eX{constructor(t){super(t),this.type="sketch"}clone(){return new fH(this.cloneProperties())}};d([At({sketch:"sketch"},{readOnly:!0})],bD.prototype,"type",void 0),bD=fH=d([U("esri.symbols.edges.SketchEdges3D")],bD);const L5e=bD;var mH;let wD=mH=class extends eX{constructor(t){super(t),this.type="solid"}clone(){return new mH(this.cloneProperties())}};d([At({solid:"solid"},{readOnly:!0})],wD.prototype,"type",void 0),wD=mH=d([U("esri.symbols.edges.SolidEdges3D")],wD);const s0e=wD,n0e={types:{key:"type",base:eX,typeMap:{solid:s0e,sketch:L5e}},json:{write:!0}};var gH;let Su=gH=class extends Me{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new gH(t)}};d([m(C0)],Su.prototype,"color",void 0),Su=gH=d([U("esri.symbols.support.Symbol3DMaterial")],Su);var yH;let Ay=yH=class extends wm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new yH({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}};d([At({Extrude:"extrude"},{readOnly:!0})],Ay.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Ay.prototype,"size",void 0),d([m({type:Su,json:{write:!0}})],Ay.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ay.prototype,"castShadows",void 0),d([m(n0e)],Ay.prototype,"edges",void 0),Ay=yH=d([U("esri.symbols.ExtrudeSymbol3DLayer")],Ay);const o0e=Ay;let XA=class extends nl{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([At({esriSLS:"simple-line"},{readOnly:!0})],XA.prototype,"type",void 0),d([m({type:Number,cast:en,json:{write:!0}})],XA.prototype,"width",void 0),XA=d([U("esri.symbols.LineSymbol")],XA);const D5e=XA,N5e=["begin","end","begin-end"],a0e=["arrow","circle","square","diamond","cross","x"];var _H;let sf=_H=class extends Me{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new _H({color:ge(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],sf.prototype,"placement",void 0),d([At({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],sf.prototype,"type",void 0),d([m({type:a0e})],sf.prototype,"style",void 0),d([Ut("style")],sf.prototype,"writeStyle",null),d([m({type:et,value:null,json:{write:{allowNull:!0}}})],sf.prototype,"color",null),d([_i("color")],sf.prototype,"readColor",null),d([Ut("color")],sf.prototype,"writeColor",null),sf=_H=d([U("esri.symbols.LineSymbolMarker")],sf);const F5e=sf;var vH;const sB=new Do({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let og=vH=class extends D5e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=en(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=en(n)),o}clone(){return new vH({color:ge(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};d([At({esriSLS:"simple-line"},{readOnly:!0})],og.prototype,"type",void 0),d([m({type:sB.apiValues,json:{read:sB.read,write:sB.write}})],og.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],og.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],og.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":F5e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],og.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],og.prototype,"miterLimit",void 0),og=vH=d([U("esri.symbols.SimpleLineSymbol")],og);const xm=og;let ZA=class extends nl{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":xm}},json:{default:null,write:!0}})],ZA.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],ZA.prototype,"type",void 0),ZA=d([U("esri.symbols.FillSymbol")],ZA);const l0e=ZA;let xD=class extends Me{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],xD.prototype,"type",void 0),xD=d([U("esri.symbols.patterns.LinePattern3D")],xD);const c0e=xD,k5e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var bH;const U5e=rl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let JA=bH=class extends c0e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new bH(t)}};d([m({type:["style"]})],JA.prototype,"type",void 0),d([At(U5e),m({type:k5e})],JA.prototype,"style",void 0),JA=bH=d([U("esri.symbols.patterns.LineStylePattern3D")],JA);const tX=JA;let TD=class extends Me{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],TD.prototype,"type",void 0),TD=d([U("esri.symbols.patterns.Pattern3D")],TD);const u0e=TD,z5e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var wH;let QA=wH=class extends u0e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new wH({style:this.style})}};d([m({type:["style"]})],QA.prototype,"type",void 0),d([m({type:z5e,json:{read:!0,write:!0}})],QA.prototype,"style",void 0),QA=wH=d([U("esri.symbols.patterns.StylePattern3D")],QA);const h0e=QA,B5e={types:{key:"type",base:u0e,typeMap:{style:h0e}},json:{write:!0}},d0e={types:{key:"type",base:c0e,typeMap:{style:tX}},json:{write:!0}},UP=new et("white");new et("black");const V5e=new et([255,255,255,0]);function G5e(t){return t.r===0&&t.g===0&&t.b===0}var xH;let zP=xH=class extends Su{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new xH(t)}};d([At({multiply:"multiply",replace:"replace",tint:"tint"})],zP.prototype,"colorMixMode",void 0),zP=xH=d([U("esri.symbols.support.Symbol3DFillMaterial")],zP);function pn(t=nX){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Iw(t,e,i,r,s,n,o=pn()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function DOt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new Qi(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function eC(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function j5e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function pp(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Tc(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)s=Math.min(s,e[i+3*u]),n=Math.min(n,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function nB(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const h=e[u];s=Math.min(s,h[0]),n=Math.min(n,h[1]),o=Math.min(o,h[2]),a=Math.max(a,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<r;u++){const h=e[u];s=Math.min(s,h[0]),n=Math.min(n,h[1]),a=Math.max(a,h[0]),l=Math.max(l,h[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function H5e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function sx(t){return t[0]>=t[3]?0:t[3]-t[0]}function nx(t){return t[1]>=t[4]?0:t[4]-t[1]}function yv(t){return t[2]>=t[5]?0:t[5]-t[2]}function p0e(t){const e=sx(t),i=yv(t),r=nx(t);return Math.sqrt(e*e+i*i+r*r)}function qd(t,e=[0,0,0]){return e[0]=t[0]+sx(t)/2,e[1]=t[1]+nx(t)/2,e[2]=t[2]+yv(t)/2,e}function SD(t,e=[0,0,0]){return e[0]=sx(t),e[1]=nx(t),e[2]=yv(t),e}function iX(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function NOt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function q5e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Wd(t,e){return e==null||q5e(t,e)}function f0e(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function FOt(t,e,i=t){const r=t[0]+sx(t)/2,s=t[1]+nx(t)/2,n=t[2]+yv(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function kOt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function m0e(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function g0e(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function Ik(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Or(t){return t?Ik(t,xte):pn(xte)}function rX(t,e){return e||(e=Vt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function UOt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function W5e(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function TH(t){return t.length===6}function sX(t){return sx(t)===0&&nx(t)===0&&yv(t)===0}function zOt(t,e,i){if(t==null||e==null)return t===e;if(!TH(t)||!TH(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Y5e(t,e,i,r,s,n){return Iw(t,e,i,r,s,n,X5e)}const BOt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],xte=[1/0,1/0,1/0,-1/0,-1/0,-1/0],nX=[0,0,0,0,0,0],X5e=pn();function oB(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=Ce(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Z5e=Iw(-.5,-.5,-.5,.5,.5,.5),J5e=Iw(-.5,-.5,0,.5,.5,1),Q5e=Iw(-.5,-.5,0,.5,.5,.5);function K5e(t){switch(t){case"sphere":case"cube":case"diamond":return Z5e;case"cylinder":case"cone":case"inverted-cone":return J5e;case"tetrahedron":return Q5e;default:return}}const oX=["butt","square","round"],eke=[...oX,"none"],y0e=["miter","bevel","round"];var SH;let $1=SH=class extends Me{constructor(t){super(t),this.color=new et([0,0,0,1]),this.size=No(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new SH(t)}};d([m(C0)],$1.prototype,"color",void 0),d([m(hm)],$1.prototype,"size",void 0),d([m(d0e)],$1.prototype,"pattern",void 0),d([m({type:oX,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],$1.prototype,"patternCap",void 0),$1=SH=d([U("esri.symbols.support.Symbol3DOutline")],$1);var CD;let ag=CD=class extends wm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new CD(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new tX({style:t.outline.style}):null,i={size:t.outline?.width??0,color:(t.outline?.color??UP).clone(),pattern:e};return e&&t.outline?.cap&&(i.patternCap=t.outline.cap),new CD({material:new zP({color:(t.color??V5e).clone()}),pattern:t.style&&t.style!=="solid"?new h0e({style:t.style}):null,outline:i})}};d([At({Fill:"fill"},{readOnly:!0})],ag.prototype,"type",void 0),d([m({type:zP,json:{write:!0}})],ag.prototype,"material",void 0),d([m(B5e)],ag.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ag.prototype,"castShadows",void 0),d([m({type:$1,json:{write:!0}})],ag.prototype,"outline",void 0),d([m(n0e)],ag.prototype,"edges",void 0),ag=CD=d([U("esri.symbols.FillSymbol3DLayer")],ag);const _v=ag,tke=["none","underline","line-through"],ike=["normal","italic","oblique"],rke=["normal","lighter","bold","bolder"],_0e={type:Number,cast:t=>{const e=$d(t);return e===0?1:Te(e,.1,4)},nonNullable:!0},ske=["left","right","center"],nke=["baseline","top","middle","bottom"],v0e={type:ske,nonNullable:!0},b0e={type:nke,nonNullable:!0},oke=8;var CH;let lg=CH=class extends Me{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return en(t)}clone(){return new CH({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:tke,json:{default:"none",write:!0}})],lg.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],lg.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],lg.prototype,"size",void 0),d([cr("size")],lg.prototype,"castSize",null),d([m({type:ike,json:{default:"normal",write:!0}})],lg.prototype,"style",void 0),d([m({type:rke,json:{default:"normal",write:!0}})],lg.prototype,"weight",void 0),lg=CH=d([U("esri.symbols.Font")],lg);const KR=lg;function Lw(t,e){const i=e?.url?.path;if(t&&i&&(t=Ja(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=lk(t,e.portalItem.itemUrl);r!=null&&ake.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return(t=EH(t,e?.portal))&&Lk.test(t)?lX(t):t}function tC(t,e,i=VO.YES){if((t=t&&Lk.test(t)?x0e(t):t)==null)return t;!xu(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=Ja(t);if(e){const s=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(s){const n=EH(s,e.portal),o=EH(r,e.portal);r=lk(o,n,n),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=w0e(r,e?.portal),xu(r)&&(r=ip(r)),e?.resources&&e?.portalItem&&!xu(r)&&!bm(r)&&i===VO.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function aX(t,e,i){return Lw(t,i)}function Dw(t,e,i,r){const s=tC(t,r);s!==void 0&&(e[i]=s)}const Lk=/\/items\/([^/]+)\/resources\/(.*)/,ake=/^\.\/resources\//;function lke(t){return(t?.match(Lk)??null)?.[1]??null}function cke(t){const e=t?.match(Lk)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=aee(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=aee(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function w0e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?mj(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function EH(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=cY();return ac(r,`${r.scheme}://${i}`)?mj(t,e.portalHostname,i):mj(t,i,e.portalHostname)}function lX(t){if(!t)return t||null;let e=t;return e&&Jr&&!Jr.findCredential(e)&&(e=CF(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function x0e(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Jr&&!Jr.findCredential(e)&&(e=CF(e)),e}var VO;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(VO||(VO={}));const VOt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return VO},ensureMainOnlineDomain:w0e,fromCDNUrl:x0e,fromJSON:Lw,itemIdFromResourceUrl:lke,prefixAndFilenameFromResourceUrl:cke,read:aX,toCDNUrl:lX,toJSON:tC,write:Dw},Symbol.toStringTag,{value:"Module"}));var AH;const uke=rl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let I1=AH=class extends Me{constructor(t){super(t)}readHref(t,e,i){return t?Lw(t,i):e.dataURI}writeHref(t,e,i,r){t&&(bm(t)?e.dataURI=t:(e.href=tC(t,r),xu(e.href)&&(e.href=ip(e.href))))}clone(){return new AH({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],I1.prototype,"href",void 0),d([_i("href")],I1.prototype,"readHref",null),d([Ut("href",{href:{type:String},dataURI:{type:String}})],I1.prototype,"writeHref",null),d([At(uke)],I1.prototype,"primitive",void 0),I1=AH=d([U("esri.symbols.support.IconSymbol3DLayerResource")],I1);const hke="circle";var MH;let Db=MH=class extends Pe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new MH({x:this.x,y:this.y})}};d([m({type:Number})],Db.prototype,"x",void 0),d([m({type:Number})],Db.prototype,"y",void 0),Db=MH=d([U("esri.symbols.support.Symbol3DAnchorPosition2D")],Db);var PH;let KA=PH=class extends Me{constructor(t){super(t),this.color=new et([0,0,0,1]),this.size=No(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new PH(t)}};d([m(C0)],KA.prototype,"color",void 0),d([m(hm)],KA.prototype,"size",void 0),KA=PH=d([U("esri.symbols.support.Symbol3DIconOutline")],KA);var VT;const T0e="esri.symbols.IconSymbol3DLayer";let nf=VT=class extends wm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new VT({anchor:this.anchor,anchorPosition:ge(this.anchorPosition),enabled:this.enabled,material:ge(this.material),outline:ge(this.outline),resource:ge(this.resource),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||UP,i=Tte(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||UP).clone()}:null;return new VT({size:t.size,resource:{primitive:pke(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||G5e(t.color)?UP:t.color,i=Tte(t);return new VT({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new VT({resource:{href:Qpe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};d([m({type:Su,json:{write:!0}})],nf.prototype,"material",void 0),d([m({type:I1,json:{write:!0}})],nf.prototype,"resource",void 0),d([At({Icon:"icon"},{readOnly:!0})],nf.prototype,"type",void 0),d([m(hm)],nf.prototype,"size",void 0),d([At({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),m({json:{default:"center"}})],nf.prototype,"anchor",void 0),d([m({type:Db,json:{type:[Number],read:{reader:t=>new Db({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],nf.prototype,"anchorPosition",void 0),d([m({type:KA,json:{write:!0}})],nf.prototype,"outline",void 0),nf=VT=d([U(T0e)],nf);const T_=nf;function Tte(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=Ste(t.xoffset),s=Ste(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function Ste(t){return isFinite(t)?t:0}const dke={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function pke(t){return dke[t]||(le.getLogger(T0e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}function dm(t,e,i=lt){return e||(e=new i),e===t||(e.removeAll(),fke(t)?e.addMany(t):t&&e.add(t)),e}function cX(t){return t}function fke(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var t_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(t_||(t_={}));let mke=class{constructor(){this._resolver=Pn(),this._status=t_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=t_.RESOLVED,this._cleanUp()},()=>{this._status=t_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===t_.RESOLVED}isRejected(){return this._status===t_.REJECTED}isFulfilled(){return this._status!==t_.PENDING}abort(){this._resolver.reject(vi())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Pn(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||sn(s)||this._resolver.reject(s)}),e.resolve()}};const e$=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new mke,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=d([U("esri.core.Promise")],e),e};let t4=class extends e$(Pe){};t4=d([U("esri.core.Promise")],t4);const gke="not-loaded",yke="loading",_ke="failed",Cte="loaded",S0e=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=zR(n,l);this.destroyed&&l(new W("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===gke){this._set("loadStatus",yke);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",Cte),this._loadController=null},r=>{this._set("loadStatus",_ke),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=il(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Cte}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new W("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return d([m({readOnly:!0})],e.prototype,"loaded",null),d([m({readOnly:!0})],e.prototype,"loadError",void 0),d([m({clonable:!1})],e.prototype,"loadStatus",void 0),d([m({type:[bw],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([U("esri.core.Loadable")],e),e};let eM=class extends S0e(t4){};eM=d([U("esri.core.Loadable")],eM),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=S0e,t.isLoadable=e}(eM||(eM={}));const pm=eM;let d3;function vke(t){return d3&&!d3.destroyed||(d3=t()),d3}var OH;const bke=new Do({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let qu=OH=class extends Pe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new OH({categories:this.categories?ge(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=HR(this.extent,We.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>bke.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};d([m()],qu.prototype,"categories",void 0),d([m()],qu.prototype,"disableExtraQuery",void 0),d([m({type:Qi})],qu.prototype,"extent",void 0),d([m()],qu.prototype,"filter",void 0),d([m()],qu.prototype,"num",void 0),d([m()],qu.prototype,"query",void 0),d([m()],qu.prototype,"sortField",void 0),d([m()],qu.prototype,"sortOrder",null),d([m()],qu.prototype,"start",void 0),qu=OH=d([U("esri.portal.PortalQueryParams")],qu);const Of=qu;var RH;let to=RH=class extends Me{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new W("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new RH({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=mo(Of,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Of,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Of,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Of({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Of({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s?.categorySchema;return n?.length?n:[]}):[])}};d([m()],to.prototype,"access",void 0),d([m({type:Date})],to.prototype,"created",void 0),d([m()],to.prototype,"description",void 0),d([m()],to.prototype,"id",void 0),d([m()],to.prototype,"isInvitationOnly",void 0),d([m({type:Date})],to.prototype,"modified",void 0),d([m()],to.prototype,"owner",void 0),d([m()],to.prototype,"portal",void 0),d([m()],to.prototype,"snippet",void 0),d([m()],to.prototype,"sortField",void 0),d([m()],to.prototype,"sortOrder",void 0),d([m()],to.prototype,"sourceJSON",void 0),d([m()],to.prototype,"tags",void 0),d([m()],to.prototype,"thumbnail",void 0),d([m({readOnly:!0})],to.prototype,"thumbnailUrl",null),d([m()],to.prototype,"title",void 0),d([m({readOnly:!0})],to.prototype,"url",null),to=RH=d([U("esri.portal.PortalGroup")],to);const $H=to;let L1=class extends Pe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],L1.prototype,"nextQueryParams",void 0),d([m()],L1.prototype,"queryParams",void 0),d([m()],L1.prototype,"results",void 0),d([m()],L1.prototype,"total",void 0),L1=d([U("esri.portal.PortalQueryResult")],L1);const wke=L1;let cg=class extends Me{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new W("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],cg.prototype,"created",void 0),d([m()],cg.prototype,"id",void 0),d([m()],cg.prototype,"portal",void 0),d([m()],cg.prototype,"title",void 0),d([m({readOnly:!0})],cg.prototype,"url",null),d([m()],cg.prototype,"username",void 0),cg=d([U("esri.portal.PortalFolder")],cg);const xke=cg;var IH;let ps=IH=class extends Me{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.concat();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(h=>a.itemId===h.id),c=a.success;let u=null;c?(l.id=null,l.portal=null):a.error&&(u=new W("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:u})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=xke.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=$H.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??(t={});let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await ue(()=>Promise.resolve().then(()=>H0e),void 0,import.meta.url),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s?.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new $H({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new W("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new W("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new IH({sourceJSON:t});return e.read(t),e}};d([m()],ps.prototype,"access",void 0),d([m({type:Date})],ps.prototype,"created",void 0),d([m()],ps.prototype,"culture",void 0),d([m()],ps.prototype,"description",void 0),d([m()],ps.prototype,"email",void 0),d([m()],ps.prototype,"favGroupId",void 0),d([m()],ps.prototype,"fullName",void 0),d([m({type:Date})],ps.prototype,"modified",void 0),d([m()],ps.prototype,"orgId",void 0),d([m()],ps.prototype,"portal",void 0),d([m()],ps.prototype,"preferredView",void 0),d([m()],ps.prototype,"privileges",void 0),d([m()],ps.prototype,"region",void 0),d([m()],ps.prototype,"role",void 0),d([m()],ps.prototype,"roleId",void 0),d([m()],ps.prototype,"sourceJSON",void 0),d([m()],ps.prototype,"thumbnail",void 0),d([m({readOnly:!0})],ps.prototype,"thumbnailUrl",null),d([m()],ps.prototype,"units",void 0),d([m({readOnly:!0})],ps.prototype,"userContentUrl",null),d([m({readOnly:!0})],ps.prototype,"url",null),d([m()],ps.prototype,"username",void 0),d([m()],ps.prototype,"userLicenseTypeId",void 0),d([m()],ps.prototype,"userType",void 0),ps=IH=d([U("esri.portal.PortalUser")],ps);const C0e=ps;var Hc;let p3;const Ete={PortalGroup:()=>Promise.resolve({default:$H}),PortalItem:()=>ue(()=>Promise.resolve().then(()=>H0e),void 0,import.meta.url),PortalUser:()=>Promise.resolve({default:C0e})};let ke=Hc=class extends BR(pm){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Gi.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Ate.unregister(this),this.defaultBasemap=Oe(this.defaultBasemap),this.defaultDevBasemap=Oe(this.defaultDevBasemap),this.defaultVectorBasemap=Oe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=gr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Gi.request.trustedServers.includes(e)||Gi.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=C0e.fromJSON(t),e.portal=this),e}load(t){const e=ue(()=>Promise.resolve().then(()=>hUe),void 0,import.meta.url).then(({default:i})=>{yt(t),p3=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(Jr){const r=Jr;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Hc.AUTH_MODE_AUTO&&this.authMode!==Hc.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=r.on("credential-create",Tke(new WeakRef(this))),Ate.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ue(()=>import("./ElevationLayer-745b91fd.js"),["./ElevationLayer-745b91fd.js","./ArcGISCachedService-bfbce3c4.js","./TileInfoTilemapCache-e5c020eb.js","./TilemapCache-8331be43.js","./ArcGISService-d812484b.js","./OperationalLayer-4cc379ff.js","./layerContainerType-e1118fe6.js","./commonProperties-97bbff58.js","./PortalLayer-995215c8.js","./LercDecoder-1bf5560e.js","./WorkerHandle-becb41d0.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):qn(t)?Promise.reject(vi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Of({num:100,sortField:"title"});if(e?.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return qn(t)?Promise.reject(vi()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||Ec();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||Ec();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return vke(()=>new Hc)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Ec().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=mo(Of,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new wke({nextQueryParams:l,queryParams:s,total:a.total,results:Hc._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(a0(l),a)));return i&&Ete[i]?Ete[i]().then(({default:o})=>(yt(r),n(o))):n()}signIn(){if(this.authMode===Hc.AUTH_MODE_ANONYMOUS||this.authMode===Hc.AUTH_MODE_NO_PROMPT&&!Jr)return Promise.reject(new W("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Jr?Jr.getCredential(this.restUrl,{prompt:this.authMode!==Hc.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential?.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=Hc._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Hc.AUTH_MODE_ANONYMOUS||this.authMode===Hc.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Yi(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new W("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Hc({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new W("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Of;i.query=t||(Gi.apiKey&&mY(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new p3({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new Of({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new p3({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=p3.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};ke.AUTH_MODE_ANONYMOUS="anonymous",ke.AUTH_MODE_AUTO="auto",ke.AUTH_MODE_IMMEDIATE="immediate",ke.AUTH_MODE_NO_PROMPT="no-prompt",d([m()],ke.prototype,"access",void 0),d([m()],ke.prototype,"allSSL",void 0),d([m()],ke.prototype,"authMode",void 0),d([m()],ke.prototype,"authorizedCrossOriginDomains",void 0),d([_i("authorizedCrossOriginDomains")],ke.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],ke.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],ke.prototype,"basemapGalleryGroupQuery3D",void 0),d([m()],ke.prototype,"bingKey",void 0),d([m()],ke.prototype,"canListApps",void 0),d([m()],ke.prototype,"canListData",void 0),d([m()],ke.prototype,"canListPreProvisionedItems",void 0),d([m()],ke.prototype,"canProvisionDirectPurchase",void 0),d([m()],ke.prototype,"canSearchPublic",void 0),d([m()],ke.prototype,"canShareBingPublic",void 0),d([m()],ke.prototype,"canSharePublic",void 0),d([m()],ke.prototype,"canSignInArcGIS",void 0),d([m()],ke.prototype,"canSignInIDP",void 0),d([m()],ke.prototype,"colorSetsGroupQuery",void 0),d([m()],ke.prototype,"commentsEnabled",void 0),d([m({type:Date})],ke.prototype,"created",void 0),d([m()],ke.prototype,"credential",void 0),d([m()],ke.prototype,"culture",void 0),d([m()],ke.prototype,"currentVersion",void 0),d([m()],ke.prototype,"customBaseUrl",void 0),d([m()],ke.prototype,"defaultBasemap",void 0),d([_i("defaultBasemap")],ke.prototype,"readDefaultBasemap",null),d([m()],ke.prototype,"defaultDevBasemap",void 0),d([_i("defaultDevBasemap")],ke.prototype,"readDefaultDevBasemap",null),d([m({type:Qi})],ke.prototype,"defaultExtent",void 0),d([m()],ke.prototype,"defaultVectorBasemap",void 0),d([_i("defaultVectorBasemap")],ke.prototype,"readDefaultVectorBasemap",null),d([m()],ke.prototype,"description",void 0),d([m()],ke.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],ke.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],ke.prototype,"extraQuery",null),d([m()],ke.prototype,"featuredGroups",void 0),d([m()],ke.prototype,"featuredItemsGroupQuery",void 0),d([m()],ke.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],ke.prototype,"layoutGroupQuery",void 0),d([m()],ke.prototype,"livingAtlasGroupQuery",void 0),d([m()],ke.prototype,"hasCategorySchema",void 0),d([m()],ke.prototype,"helpBase",void 0),d([m()],ke.prototype,"helperServices",void 0),d([m()],ke.prototype,"helpMap",void 0),d([m()],ke.prototype,"homePageFeaturedContent",void 0),d([m()],ke.prototype,"homePageFeaturedContentCount",void 0),d([m()],ke.prototype,"httpPort",void 0),d([m()],ke.prototype,"httpsPort",void 0),d([m()],ke.prototype,"id",void 0),d([m()],ke.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],ke.prototype,"isOrganization",null),d([m()],ke.prototype,"isPortal",void 0),d([m()],ke.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],ke.prototype,"itemPageUrl",null),d([m()],ke.prototype,"layerTemplatesGroupQuery",void 0),d([m()],ke.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],ke.prototype,"modified",void 0),d([m()],ke.prototype,"name",void 0),d([m()],ke.prototype,"portalHostname",void 0),d([m()],ke.prototype,"portalMode",void 0),d([m()],ke.prototype,"portalProperties",void 0),d([m()],ke.prototype,"region",void 0),d([m()],ke.prototype,"recycleBinEnabled",void 0),d([m({readOnly:!0})],ke.prototype,"restUrl",null),d([m()],ke.prototype,"rotatorPanels",void 0),d([m()],ke.prototype,"showHomePageDescription",void 0),d([m()],ke.prototype,"sourceJSON",void 0),d([m()],ke.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],ke.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],ke.prototype,"stylesGroupQuery3d",void 0),d([m()],ke.prototype,"supportsHostedServices",void 0),d([m()],ke.prototype,"symbolSetsGroupQuery",void 0),d([m()],ke.prototype,"templatesGroupQuery",void 0),d([m()],ke.prototype,"thumbnail",void 0),d([m({readOnly:!0})],ke.prototype,"thumbnailUrl",null),d([m()],ke.prototype,"units",void 0),d([m()],ke.prototype,"url",void 0),d([m()],ke.prototype,"urlKey",void 0),d([_i("urlKey")],ke.prototype,"readUrlKey",null),d([m()],ke.prototype,"user",void 0),d([_i("user")],ke.prototype,"readUser",null),d([m()],ke.prototype,"use3dBasemaps",void 0),d([m()],ke.prototype,"useStandardizedQuery",void 0),d([m()],ke.prototype,"useVectorBasemaps",void 0),d([m()],ke.prototype,"vectorBasemapGalleryGroupQuery",void 0),ke=Hc=d([U("esri.portal.Portal")],ke);const Ea=ke,Ate=new FinalizationRegistry(t=>{t.remove()});function Tke(t){const e=Jr;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let D1=class extends Ic(Me){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],D1.prototype,"type",void 0),d([m({type:N5e,json:{default:"begin-end",write:!0}})],D1.prototype,"placement",void 0),d([m({type:a0e,json:{default:"arrow",write:!0}})],D1.prototype,"style",void 0),d([m({type:et,json:{type:[Rr],default:null,write:!0}})],D1.prototype,"color",void 0),D1=d([U("esri.symbols.LineStyleMarker3D")],D1);const LH=D1;var ED;let of=ED=class extends wm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=No(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new ED(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??No(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new tX({style:t.style}):null,material:new Su({color:(t.color||UP).clone()}),marker:t.marker?new LH({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new ED(e)}};d([m({type:Su,json:{write:!0}})],of.prototype,"material",void 0),d([At({Line:"line"},{readOnly:!0})],of.prototype,"type",void 0),d([m({type:y0e,json:{write:!0,default:"miter"}})],of.prototype,"join",void 0),d([m({type:oX,json:{write:!0,default:"butt"}})],of.prototype,"cap",void 0),d([m(hm)],of.prototype,"size",void 0),d([m(d0e)],of.prototype,"pattern",void 0),d([m({types:{key:"type",base:LH,typeMap:{style:LH}},json:{write:!0}})],of.prototype,"marker",void 0),of=ED=d([U("esri.symbols.LineSymbol3DLayer")],of);const iE=of;var DH;const Ske=rl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let tM=DH=class extends Me{clone(){return new DH({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:aX,write:Dw}})],tM.prototype,"href",void 0),d([At(Ske)],tM.prototype,"primitive",void 0),tM=DH=d([U("esri.symbols.support.ObjectSymbol3DLayerResource")],tM);const E0e="sphere";var NH;let bb=NH=class extends Pe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new NH({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],bb.prototype,"x",void 0),d([m({type:Number})],bb.prototype,"y",void 0),d([m({type:Number})],bb.prototype,"z",void 0),bb=NH=d([U("esri.symbols.support.Symbol3DAnchorPosition3D")],bb);var FH;let Da=FH=class extends wm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new FH({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([m({type:Su,json:{write:!0}})],Da.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Da.prototype,"castShadows",void 0),d([m({type:tM,json:{write:!0}})],Da.prototype,"resource",void 0),d([At({Object:"object"},{readOnly:!0})],Da.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],Da.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],Da.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],Da.prototype,"depth",void 0),d([At({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),m({json:{default:"origin"}})],Da.prototype,"anchor",void 0),d([m({type:bb,json:{type:[Number],read:{reader:t=>new bb({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Da.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],Da.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],Da.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],Da.prototype,"roll",void 0),d([m({readOnly:!0})],Da.prototype,"isPrimitive",null),Da=FH=d([U("esri.symbols.ObjectSymbol3DLayer")],Da);const uX=Da;var kH;let bl=kH=class extends wm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new kH({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([m({type:Su,json:{write:!0}})],bl.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],bl.prototype,"castShadows",void 0),d([At({Path:"path"},{readOnly:!0})],bl.prototype,"type",void 0),d([m({type:["circle","quad"],json:{write:!0,default:"circle"}})],bl.prototype,"profile",void 0),d([m({type:y0e,json:{write:!0,default:"miter"}})],bl.prototype,"join",void 0),d([m({type:eke,json:{write:!0,default:"butt"}})],bl.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],bl.prototype,"width",void 0),d([_i("width",["width","size","height"])],bl.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],bl.prototype,"height",void 0),d([_i("height",["height","size","width"])],bl.prototype,"readHeight",null),d([m({type:["center","bottom","top"],json:{write:!0,default:"center"}})],bl.prototype,"anchor",void 0),d([m({type:["heading","all"],json:{write:!0,default:"all"}})],bl.prototype,"profileRotation",void 0),bl=kH=d([U("esri.symbols.PathSymbol3DLayer")],bl);const hX=bl;var UH;let OS=UH=class extends Me{constructor(){super(...arguments),this.color=new et([0,0,0,1]),this.size=0}clone(){const t={color:ge(this.color),size:this.size};return new UH(t)}};d([m(C0)],OS.prototype,"color",void 0),d([m(hm)],OS.prototype,"size",void 0),OS=UH=d([U("esri.symbols.support.Symbol3DHalo")],OS);let BP=class extends Ic(Me){constructor(e){super(e),this.color=null}};d([m(C0)],BP.prototype,"color",void 0),BP=d([U("esri.symbols.support.Symbol3DTextBackground")],BP);var AD;let ec=AD=class extends wm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new AD({enabled:this.enabled,font:this.font&&ge(this.font),halo:this.halo&&ge(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ge(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new AD({font:t.font!=null?t.font.clone():new KR,halo:Cke(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Su({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new BP({color:t.backgroundColor.clone()}):null})}};function Cke(t,e){return t&&e!=null&&e>0?new OS({color:ge(t),size:e}):null}d([m({type:KR,json:{write:!0}})],ec.prototype,"font",null),d([Ut("font")],ec.prototype,"writeFont",null),d([m({type:OS,json:{write:!0}})],ec.prototype,"halo",void 0),d([m({...v0e,json:{default:"center",write:!0}})],ec.prototype,"horizontalAlignment",void 0),d([m({..._0e,json:{default:1,write:!0}})],ec.prototype,"lineHeight",void 0),d([m({type:Su,json:{write:!0}})],ec.prototype,"material",void 0),d([m({type:BP,json:{write:!0}})],ec.prototype,"background",void 0),d([m(hm)],ec.prototype,"size",null),d([m({type:String,json:{write:!0}})],ec.prototype,"text",void 0),d([At({Text:"text"},{readOnly:!0})],ec.prototype,"type",void 0),d([m({...b0e,json:{default:"baseline",write:!0}})],ec.prototype,"verticalAlignment",void 0),ec=AD=d([U("esri.symbols.TextSymbol3DLayer")],ec);const ox=ec;var zH;let My=zH=class extends wm{constructor(t){super(t),this.color=BH.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new zH({color:ge(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([m({type:et,nonNullable:!0,json:{type:[Rr],write:(t,e,i)=>e[i]=t.toArray(et.AlphaMode.UNLESS_OPAQUE),default:()=>BH.clone(),defaultEquals:t=>t.toCss(!0)===BH.toCss(!0)}})],My.prototype,"color",void 0),d([At({Water:"water"},{readOnly:!0})],My.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],My.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],My.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],My.prototype,"waveStrength",void 0),My=zH=d([U("esri.symbols.WaterSymbol3DLayer")],My);const A0e=My,BH=new et([0,119,190]);var VH;let N1=VH=class extends Pe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new VH({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],N1.prototype,"name",void 0),d([m({type:String})],N1.prototype,"styleUrl",void 0),d([m({type:String})],N1.prototype,"styleName",void 0),d([m({type:Ea})],N1.prototype,"portal",void 0),N1=VH=d([U("esri.symbols.support.StyleOrigin")],N1);const GO=N1;var GH;let ew=GH=class extends Pe{constructor(){super(...arguments),this.url=""}clone(){return new GH({url:this.url})}};d([m({type:String})],ew.prototype,"url",void 0),ew=GH=d([U("esri.symbols.support.Thumbnail")],ew);const M0e={icon:T_,object:uX,line:iE,path:hX,fill:_v,extrude:o0e,text:ox,water:A0e},Eke=lt.ofType({base:wm,key:"type",typeMap:M0e,errorContext:"symbol-layer"});let af=class extends nl{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i?.type,s=r||lt;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&le.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){dm(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=Lw(e.styleUrl,r);return new GO({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new GO({portal:r?.portal||Ea.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new bw("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=tC(e.styleUrl,s);xu(n)&&(n=ip(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s?.portal&&!gIe(e.portal.restUrl,s.portal.restUrl)?s?.messages&&s.messages.push(new bw("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof wm||e&&M0e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],af.prototype,"color",null),d([m({type:Eke,nonNullable:!0,json:{write:!0}}),cr(cX)],af.prototype,"symbolLayers",null),d([m({type:GO})],af.prototype,"styleOrigin",void 0),d([_i("styleOrigin")],af.prototype,"readStyleOrigin",null),d([Ut("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],af.prototype,"writeStyleOrigin",null),d([m({type:ew,json:{read:!1}})],af.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],af.prototype,"type",void 0),af=d([U("esri.symbols.Symbol3D")],af);const rE=af;let iM=class extends Me{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};d([m({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],iM.prototype,"type",void 0),d([m({readOnly:!0})],iM.prototype,"visible",void 0),iM=d([U("esri.symbols.callouts.Callout3D")],iM);const P0e=iM;var jH;let MD=jH=class extends Me{constructor(t){super(t),this.color=new et("white")}clone(){return new jH({color:ge(this.color)})}};d([m(C0)],MD.prototype,"color",void 0),MD=jH=d([U("esri.symbols.callouts.LineCallout3DBorder")],MD);const Ake=MD;var HH;let Py=HH=class extends P0e{constructor(t){super(t),this.type="line",this.color=new et([0,0,0,1]),this.size=No(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new HH({color:ge(this.color),size:this.size,border:ge(this.border)})}};d([At({line:"line"})],Py.prototype,"type",void 0),d([m(C0)],Py.prototype,"color",void 0),d([m(hm)],Py.prototype,"size",void 0),d([m({type:Ake,json:{write:!0}})],Py.prototype,"border",void 0),d([m({readOnly:!0})],Py.prototype,"visible",null),Py=HH=d([U("esri.symbols.callouts.LineCallout3D")],Py);const O0e=Py;function dX(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function R0e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!dX(t)}function pX(t){return t.type==="point-3d"||t.type==="label-3d"}function $0e(t){return t.horizontalAlignment==="center"}const I0e={types:{key:"type",base:P0e,typeMap:{line:O0e}},json:{write:!0}};var qH;let GT=qH=class extends Me{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new qH({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m(hm)],GT.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],GT.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],GT.prototype,"maxWorldLength",void 0),GT=qH=d([U("esri.symbols.support.Symbol3DVerticalOffset")],GT);const fX=GT;var PD;const L0e=lt.ofType({base:null,key:"type",typeMap:{text:ox}});let Oy=PD=class extends rE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new L0e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return R0e(this)}hasVisibleVerticalOffset(){return dX(this)}clone(){return new PD({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail),callout:ge(this.callout),verticalOffset:ge(this.verticalOffset)})}static fromTextSymbol(t){return new PD({symbolLayers:new lt([ox.fromTextSymbol(t)])})}};d([m({type:fX,json:{write:!0}})],Oy.prototype,"verticalOffset",void 0),d([m(I0e)],Oy.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],Oy.prototype,"styleOrigin",void 0),d([m({type:L0e})],Oy.prototype,"symbolLayers",void 0),d([At({LabelSymbol3D:"label-3d"},{readOnly:!0})],Oy.prototype,"type",void 0),Oy=PD=d([U("esri.symbols.LabelSymbol3D")],Oy);const Dk=Oy;var OD;const D0e=lt.ofType({base:null,key:"type",typeMap:{line:iE,path:hX}}),Mke=lt.ofType({base:null,key:"type",typeMap:{line:iE,path:hX}});let rM=OD=class extends rE{constructor(t){super(t),this.symbolLayers=new D0e,this.type="line-3d"}clone(){return new OD({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromSimpleLineSymbol(t){return new OD({symbolLayers:new lt([iE.fromSimpleLineSymbol(t)])})}};d([m({type:D0e,json:{type:Mke}})],rM.prototype,"symbolLayers",void 0),d([At({LineSymbol3D:"line-3d"},{readOnly:!0})],rM.prototype,"type",void 0),rM=OD=d([U("esri.symbols.LineSymbol3D")],rM);const ax=rM;let Ry=class extends nl{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Ry.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],Ry.prototype,"type",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Ry.prototype,"xoffset",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Ry.prototype,"yoffset",void 0),d([m({type:Number,cast:t=>t==="auto"?t:en(t),json:{write:!0}})],Ry.prototype,"size",void 0),Ry=d([U("esri.symbols.MarkerSymbol")],Ry);const N0e=Ry;var RD;const F0e=lt.ofType({base:null,key:"type",typeMap:{fill:_v}});let sM=RD=class extends rE{constructor(t){super(t),this.symbolLayers=new F0e,this.type="mesh-3d"}clone(){return new RD({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromSimpleFillSymbol(t){return new RD({symbolLayers:new lt([_v.fromSimpleFillSymbol(t)])})}};d([m({type:F0e})],sM.prototype,"symbolLayers",void 0),d([At({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],sM.prototype,"type",void 0),sM=RD=d([U("esri.symbols.MeshSymbol3D")],sM);const sE=sM;function Pke(t,e,i){return e.imageData?Qpe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):k0e(e.url,i)}function k0e(t,e){if(!xu(t)){const i=Rke(e);if(i)return vm(i,"images",t)}return Lw(t,e)}function Oke(t,e,i,r){if(bm(t)){const s=j_(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&Dw(i.url,e,"url",r)}else Dw(t,e,"url",r)}const U0e={json:{read:{source:["imageData","url"],reader:Pke},write:{writer(t,e,i,r){Oke(t,e,this.source,r)}}}},z0e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=k0e(e.url,i)),r}}}};function Rke(t){if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i?.type;return r==="feature"||r==="stream"?i.parsedUrl?.path:r==="map-image"||r==="tile"?t.url?.path:null}var WH;let Wu=WH=class extends l0e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=en(i)),r!=null&&(s.height=en(r)),s}clone(){const t=new WH({color:ge(this.color),height:this.height,outline:ge(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ge(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([At({esriPFS:"picture-fill"},{readOnly:!0})],Wu.prototype,"type",void 0),d([m(U0e)],Wu.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],Wu.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],Wu.prototype,"yscale",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Wu.prototype,"width",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Wu.prototype,"height",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Wu.prototype,"xoffset",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Wu.prototype,"yoffset",void 0),d([m(z0e)],Wu.prototype,"source",void 0),Wu=WH=d([U("esri.symbols.PictureFillSymbol")],Wu);const mX=Wu;var YH;let ud=YH=class extends N0e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=en(e)),i!=null&&(r.height=en(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new YH({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ge(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],ud.prototype,"color",void 0),d([At({esriPMS:"picture-marker"},{readOnly:!0})],ud.prototype,"type",void 0),d([m(U0e)],ud.prototype,"url",void 0),d([m(z0e)],ud.prototype,"source",void 0),d([m({type:Number,cast:en,json:{write:!0}})],ud.prototype,"height",void 0),d([_i("height",["height","size"])],ud.prototype,"readHeight",null),d([m({type:Number,cast:en,json:{write:!0}})],ud.prototype,"width",void 0),d([m({json:{write:!1}})],ud.prototype,"size",void 0),ud=YH=d([U("esri.symbols.PictureMarkerSymbol")],ud);const t$=ud;var F1;const B0e=lt.ofType({base:null,key:"type",typeMap:{icon:T_,object:uX,text:ox}});let k1=F1=class extends rE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new B0e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return R0e(this)}hasVisibleVerticalOffset(){return dX(this)}clone(){return new F1({verticalOffset:ge(this.verticalOffset),callout:ge(this.callout),styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new F1({symbolLayers:new lt([T_.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new F1({symbolLayers:new lt([T_.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new F1(i?.callout?{symbolLayers:new lt([T_.fromCIMSymbol(t)]),callout:new O0e({size:.5,color:new et([0,0,0])}),verticalOffset:new fX({screenLength:40})}:{symbolLayers:new lt([T_.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new F1({symbolLayers:new lt([ox.fromTextSymbol(t)])})}};d([m({type:fX,json:{write:!0}})],k1.prototype,"verticalOffset",void 0),d([m(I0e)],k1.prototype,"callout",void 0),d([m({type:B0e,json:{origins:{"web-scene":{write:!0}}}})],k1.prototype,"symbolLayers",void 0),d([At({PointSymbol3D:"point-3d"},{readOnly:!0})],k1.prototype,"type",void 0),k1=F1=d([U("esri.symbols.PointSymbol3D")],k1);const zf=k1;function Nk(t,e,i){return ok(t.map((r,s)=>e.apply(i,[r,s])))}async function $ke(t,e,i){return(await ok(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function gX(t){return{ok:!0,value:t}}function yX(t){return{ok:!1,error:t}}function Ike(t){return t!=null&&t.ok===!0?t.value:null}function Lke(t){return t!=null&&t.ok===!1?t.error:null}async function fp(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return gX(await t)}catch(e){return yX(e)}}async function KOt(t){try{return gX(await t)}catch(e){return a0(e),yX(e)}}function eRt(t){if(t.ok===!0)return t.value;throw t.error}function Tm(t,e){return new $y(t,e)}let $y=class extends Pe{get value(){return Ike(this._result)}get error(){return Lke(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=il(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=gX(s),this._cleanup()},s=>{this._result=yX(s),this._cleanup()}),this._abortHandle=un(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=gr(this._abortHandle),this._abortController=null}};d([m()],$y.prototype,"value",null),d([m()],$y.prototype,"error",null),d([m()],$y.prototype,"finished",null),d([m()],$y.prototype,"promise",void 0),d([m()],$y.prototype,"_result",void 0),$y=d([U("esri.core.asyncUtils.ReactiveTask")],$y);function he(t,e,i={}){return _X(t,e,i,V0e)}function zl(t,e,i={}){return _X(t,e,i,G0e)}function _X(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(gr(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=z3e(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function yo(t,e,i,r={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),r.onListenerRemove?.(s),s=null,n=null)}function l(u){r.once&&r.once&&gr(o),i(u)}const c=he(t,(u,h)=>{a(),sk(u)&&(s=u,n=qg(u,e,l),r.onListenerAdd?.(u))},{sync:r.sync,initial:!0});return o=Mi(()=>{c.remove(),a()}),o}function iC(t,e){return Dke(t,G0e,e)}function Dke(t,e,i){if(qn(i))return Promise.reject(vi());const r=t();if(e?.(r))return Promise.resolve(r);let s=null;function n(){s=gr(s)}return new Promise((o,a)=>{s=vw([un(i,()=>{n(),a(vi())}),_X(t,l=>{n(),o(l)},{sync:!1,once:!0},e??V0e)])})}function V0e(t){return!0}function G0e(t){return!!t}function Nke(t,e){const i=new lt,r=yo(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s?.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function iRt(t,e){const i=new lt,r=Nke(t,a=>Tm(async l=>{const c=await e(a,l);if(qn(l))throw c.remove(),vi();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)vF(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=i.splice(l,c);for(const h of u)h?.remove();if(a?.length){i.addMany(a.map(s),l);for(const h of a)vF(n(h))}});return i.addHandles([ipe(r),o]),i}const Ji={sync:!0},Ki={initial:!0},qi={sync:!0,initial:!0};var nM;const j0e=lt.ofType({base:null,key:"type",typeMap:{extrude:o0e,fill:_v,icon:T_,line:iE,object:uX,text:ox,water:A0e}});let oM=nM=class extends rE{constructor(t){super(t),this.symbolLayers=new j0e,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&o0(le.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&o0(le.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(yo(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Ji))}clone(){return new nM({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromJSON(t){const e=new nM;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new nM({symbolLayers:new lt([_v.fromSimpleFillSymbol(t)])})}};d([m({type:j0e,json:{write:!0}})],oM.prototype,"symbolLayers",void 0),d([At({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],oM.prototype,"type",void 0),oM=nM=d([U("esri.symbols.PolygonSymbol3D")],oM);const lx=oM;var XH;const aB=new Do({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let U1=XH=class extends l0e{constructor(...t){super(...t),this.color=new et([0,0,0,.25]),this.outline=new xm,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new XH({color:ge(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],U1.prototype,"color",void 0),d([m()],U1.prototype,"outline",void 0),d([At({esriSFS:"simple-fill"},{readOnly:!0})],U1.prototype,"type",void 0),d([m({type:aB.apiValues,json:{read:aB.read,write:aB.write}})],U1.prototype,"style",void 0),U1=XH=d([U("esri.symbols.SimpleFillSymbol")],U1);const nE=U1;var ZH;const lB=new Do({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let lf=ZH=class extends N0e{constructor(...t){super(...t),this.color=new et([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new xm}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=en(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new ZH({angle:this.angle,color:ge(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};d([m()],lf.prototype,"color",void 0),d([Ut("color")],lf.prototype,"writeColor",null),d([At({esriSMS:"simple-marker"},{readOnly:!0})],lf.prototype,"type",void 0),d([m()],lf.prototype,"size",void 0),d([m({type:lB.apiValues,json:{read:lB.read,write:lB.write}})],lf.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],lf.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":xm}},json:{default:null,write:!0}})],lf.prototype,"outline",void 0),lf=ZH=d([U("esri.symbols.SimpleMarkerSymbol")],lf);const cx=lf;var JH;let Fs=JH=class extends nl{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new KR,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return en(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new JH({angle:this.angle,backgroundColor:ge(this.backgroundColor),borderLineColor:ge(this.borderLineColor),borderLineSize:this.borderLineSize,color:ge(this.color),font:this.font&&this.font.clone(),haloColor:ge(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:et,json:{write:!0}})],Fs.prototype,"backgroundColor",void 0),d([m({type:et,json:{write:!0}})],Fs.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:en})],Fs.prototype,"borderLineSize",void 0),d([m({type:KR,json:{write:!0}})],Fs.prototype,"font",void 0),d([m({...v0e,json:{write:!0}})],Fs.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],Fs.prototype,"kerning",void 0),d([m({type:et,json:{write:!0}})],Fs.prototype,"haloColor",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Fs.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],Fs.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],Fs.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],Fs.prototype,"text",void 0),d([At({esriTS:"text"},{readOnly:!0})],Fs.prototype,"type",void 0),d([m({...b0e,json:{write:!0}})],Fs.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Fs.prototype,"xoffset",void 0),d([m({type:Number,cast:en,json:{write:!0}})],Fs.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Fs.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],Fs.prototype,"width",void 0),d([m({type:Number})],Fs.prototype,"lineWidth",void 0),d([Ut("lineWidth")],Fs.prototype,"writeLineWidth",null),d([cr("lineWidth")],Fs.prototype,"castLineWidth",null),d([m(_0e)],Fs.prototype,"lineHeight",void 0),d([Ut("lineHeight")],Fs.prototype,"writeLineHeight",null),Fs=JH=d([U("esri.symbols.TextSymbol")],Fs);const oE=Fs;var QH;let hd=QH=class extends nl{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Ea.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new QH({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ue(()=>Promise.resolve().then(()=>qmt),void 0,import.meta.url);yt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{le.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i?.set(r,o.clone()),o):null}};d([m({json:{write:!1}})],hd.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],hd.prototype,"styleName",void 0),d([m({type:Ea,json:{write:!1}})],hd.prototype,"portal",void 0),d([m({type:String,json:{read:aX,write:Dw}})],hd.prototype,"styleUrl",void 0),d([m({type:ew,json:{read:!1}})],hd.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],hd.prototype,"name",void 0),d([At({styleSymbolReference:"web-style"},{readOnly:!0})],hd.prototype,"type",void 0),d([m()],hd.prototype,"_fetchCacheKey",null),hd=QH=d([U("esri.symbols.WebStyleSymbol")],hd);const aE=hd;function Fk(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Nw(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const vX={base:nl,key:"type",typeMap:{"simple-fill":nE,"picture-fill":mX,"picture-marker":t$,"simple-line":xm,"simple-marker":cx,text:oE,"label-3d":Dk,"line-3d":ax,"mesh-3d":sE,"point-3d":zf,"polygon-3d":lx,"web-style":aE,cim:rx},errorContext:"symbol"},rRt={base:nl,key:"type",typeMap:{"picture-marker":t$,"simple-marker":cx,"point-3d":zf,cim:rx},errorContext:"symbol"},sRt={base:nl,key:"type",typeMap:{"simple-line":xm,"line-3d":ax,cim:rx},errorContext:"symbol"},nRt={base:nl,key:"type",typeMap:{"simple-fill":nE,"picture-fill":mX,"polygon-3d":lx,cim:rx},errorContext:"symbol"},oRt={base:nl,key:"type",typeMap:{"picture-marker":t$,"simple-marker":cx,text:oE,"web-style":aE,cim:rx},errorContext:"symbol"},Fke=KW({types:vX}),aRt={base:nl,key:"type",typeMap:{"simple-fill":nE,"picture-fill":mX,"picture-marker":t$,"simple-line":xm,"simple-marker":cx,text:oE,"line-3d":ax,"mesh-3d":sE,"point-3d":zf,"polygon-3d":lx,"web-style":aE,cim:rx},errorContext:"symbol"},lRt={base:nl,key:"type",typeMap:{text:oE,"label-3d":Dk},errorContext:"symbol"},cRt={base:nl,key:"type",typeMap:{"line-3d":ax,"mesh-3d":sE,"point-3d":zf,"polygon-3d":lx,"web-style":aE,cim:rx},errorContext:"symbol"},uRt={base:nl,key:"type",typeMap:{"label-3d":Dk},errorContext:"symbol"},hRt=lm(vX);var KH;function kke(t){if(!t)return null;const e={};for(const i in t){const r=$w(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function Uke(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let wl=KH=class extends Ic(Me){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:wu(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&j$e(le.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),t?.type!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new KH({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:Uke(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:dj(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([zl(()=>this.geometry?.type==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0,({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),zl(()=>this.geometry?.type==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0,()=>{const t=this.geometry;t?.type==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=t.transform?.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};d([m({value:null,json:{read:kke}})],wl.prototype,"aggregateGeometries",null),d([m({value:null})],wl.prototype,"attributes",null),d([m({value:null,types:Tk,json:{read:$w}})],wl.prototype,"geometry",null),d([m({type:Boolean})],wl.prototype,"isAggregate",void 0),d([m({clonable:"reference"})],wl.prototype,"layer",void 0),d([m({clonable:"reference"})],wl.prototype,"origin",void 0),d([m({type:M5e})],wl.prototype,"popupTemplate",void 0),d([m({clonable:"reference"})],wl.prototype,"sourceLayer",void 0),d([m({value:null,types:vX})],wl.prototype,"symbol",null),d([m({type:Boolean,value:!0})],wl.prototype,"visible",null),wl=KH=d([U("esri.Graphic")],wl),function(t){t.generateUID=wu}(wl||(wl={}));const X_=wl;async function bX(t,e){return await t.load(),zke(t,e)}async function zke(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):lt.isCollection(o)?o.forEach(a=>r(a)):pm.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await $ke(i,async n=>{const o=await fp(Bke(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function Bke(t){return"loadAll"in t&&typeof t.loadAll=="function"}let ug=class extends Pe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:Mte(e.path,e.portalItem)}:e}set path(e){e!=null&&xu(e)?le.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Mte(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new W("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i?.signal})}async update(e,i){const{addOrUpdateResources:r}=await ue(()=>Promise.resolve().then(()=>$S),void 0,import.meta.url);return await r(this.portalItem,[{resource:this,content:e,compress:i?.compress,access:i?.access}],"update",i),this}hasPath(){return this.path!=null}};function Mte(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&xu(t)&&(t=lk(t,e.itemUrl)),t?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}d([m()],ug.prototype,"portalItem",void 0),d([m({type:String,value:null})],ug.prototype,"path",null),d([cr("path")],ug.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],ug.prototype,"url",null),d([m({type:String,readOnly:!0})],ug.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],ug.prototype,"itemRelativeUrl",null),ug=d([U("esri.portal.PortalItemResource")],ug);const Vke=ug;let aM=class extends Pe{constructor(e){super(e),this.created=null,this.rating=null}};d([m()],aM.prototype,"created",void 0),d([m()],aM.prototype,"rating",void 0),aM=d([U("esri.portal.PortalRating")],aM);const cB=aM;var z1;const Gke=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),jke=new Set(["KML","GeoJson","CSV"]);let oi=z1=class extends BR(pm){static from(t){return _w(z1,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t?.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new Qi(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1,p=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),h=e.includes("Relational"),s=c||h?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(p=e.includes("Map"),s=p?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?sr(i+s+r+".png"):null}get isLayer(){return this.type!=null&&Gke.has(this.type)}get itemCdnUrl(){return lX(this.itemUrl)}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.username;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Ea.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof cB&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new cB({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ge(this.applicationProxies),avgRating:this.avgRating,categories:ge(this.categories),created:ge(this.created),culture:this.culture,description:this.description,extent:ge(this.extent),groupCategories:ge(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ge(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ge(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ge(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ge(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new z1({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=t[i]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new cB(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},z1)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new W("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!r,tags:n?.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new z1({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")bm(e)?r.query={data:e}:r.query={url:Ja(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await ue(()=>Promise.resolve().then(()=>$S),void 0,import.meta.url);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await ue(()=>Promise.resolve().then(()=>$S),void 0,import.meta.url);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i?.compress,access:i?.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await ue(()=>Promise.resolve().then(()=>$S),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new W("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ue(()=>Promise.resolve().then(()=>$S),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new Vke({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ge(this.categories),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ge(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ge(this.typeKeywords),url:this.url};return K5(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new z1({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],oi.prototype,"access",void 0),d([m()],oi.prototype,"accessInformation",void 0),d([m({type:String})],oi.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],oi.prototype,"applicationProxies",void 0),d([m()],oi.prototype,"avgRating",void 0),d([m()],oi.prototype,"categories",void 0),d([m({type:Date})],oi.prototype,"created",void 0),d([m()],oi.prototype,"culture",void 0),d([m()],oi.prototype,"description",void 0),d([m({readOnly:!0})],oi.prototype,"displayName",null),d([m({type:Qi})],oi.prototype,"extent",void 0),d([_i("extent")],oi.prototype,"readExtent",null),d([m()],oi.prototype,"groupCategories",void 0),d([m({readOnly:!0})],oi.prototype,"iconUrl",null),d([m()],oi.prototype,"id",void 0),d([m({readOnly:!0})],oi.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],oi.prototype,"isOrgItem",void 0),d([m()],oi.prototype,"itemControl",void 0),d([m({readOnly:!0})],oi.prototype,"itemPageUrl",null),d([m({readOnly:!0})],oi.prototype,"itemUrl",null),d([m()],oi.prototype,"licenseInfo",void 0),d([m({type:Date})],oi.prototype,"modified",void 0),d([m()],oi.prototype,"name",void 0),d([m()],oi.prototype,"numComments",void 0),d([m()],oi.prototype,"numRatings",void 0),d([m()],oi.prototype,"numViews",void 0),d([m()],oi.prototype,"owner",void 0),d([m()],oi.prototype,"ownerFolder",void 0),d([m({type:Ea})],oi.prototype,"portal",void 0),d([m()],oi.prototype,"screenshots",void 0),d([m()],oi.prototype,"size",void 0),d([m()],oi.prototype,"snippet",void 0),d([m()],oi.prototype,"sourceJSON",void 0),d([m({type:String})],oi.prototype,"sourceUrl",void 0),d([m({type:String})],oi.prototype,"spatialReference",void 0),d([m()],oi.prototype,"tags",void 0),d([m()],oi.prototype,"thumbnail",void 0),d([m({readOnly:!0})],oi.prototype,"thumbnailUrl",null),d([m()],oi.prototype,"title",void 0),d([m()],oi.prototype,"type",void 0),d([m()],oi.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){if(jke.has(e.type)){const i=this.portal?.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],oi.prototype,"url",void 0),d([m({readOnly:!0})],oi.prototype,"userItemUrl",null),oi=z1=d([U("esri.portal.PortalItem")],oi);const kk=oi,H0e=Object.freeze(Object.defineProperty({__proto__:null,default:kk},Symbol.toStringTag,{value:"Module"}));async function Hke(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await Mge("esri/t9n/basemaps");return i[t]||i[e]}const e8={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return sr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return sr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return sr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return sr("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return sr("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return sr("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return sr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return sr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return sr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return sr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return sr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return sr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return sr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return sr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return sr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return sr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},qke=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let Iy=class extends Pe{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=Ec().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=WDe(e);return i==="pt"?"pt-BR":i&&qke.has(i)?i:"global"}};d([m()],Iy.prototype,"id",void 0),d([m()],Iy.prototype,"language",void 0),d([m()],Iy.prototype,"places",void 0),d([m()],Iy.prototype,"serviceUrl",void 0),d([m()],Iy.prototype,"worldview",void 0),Iy=d([U("esri.support.BasemapStyle")],Iy);const Wke=Iy;function mRt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function Yke(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function B1(t){return t?.type==="subtype-sublayer"}function VP(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function rC(t){return t!=null&&"type"in t&&t.type==="group"}const gRt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Xke(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function Zke(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function jO(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function Pte(t){return t?.type==="voxel"}function Ote(t){return t?.type==="imagery-tile"}function $D(t){return t?.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Uk(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function yRt(t){return(t?.type==="feature"||t?.type==="subtype-group")&&t.source?.type==="feature-layer"}function Jke(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function _Rt(t,e){const i=Jr?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Yi(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function Qke(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function Kke(t){return Qke(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function eUe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function tUe(t){return!!eUe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const iUe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),rUe=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function sUe(t){return t.layerContainerType==="basemap"?iUe:t.layerContainerType==="operational-layers"?rUe:null}function nUe(t,e){if(e.restrictedWebMapWriting){const i=sUe(e);return i==null||i.has(t.type)&&!Uk(t)}return!0}function oUe(t,e){if(e)if(Uk(t)){const i=Vg("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&Rte(t,r)}else t.type!=="group"&&Rte(t,e)}function Rte(t,e){"maxScale"in t&&(e.maxScale=yF(t.maxScale)??void 0),"minScale"in t&&(e.minScale=yF(t.minScale)??void 0)}function aUe(t,e){if(oUe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=yF(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Uk(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function $te(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new W("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(Uk(t)&&!t.isTable)e=t.resourceInfo;else if(nUe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&aUe(t,e=ge(e)),e}var lM;let lUe=0,qc=lM=class extends BR(pm){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+lUe++,this.baseLayers=new lt,this.referenceLayers=new lt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&le.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{le.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Oe(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",dm(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=$te(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=$te(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",dm(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return bX(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>uF(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>uF(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new lM({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e?.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ge(i);return r.url&&cm(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&cm(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;yt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(Hke(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo?.context,s=this.portalItem?.portal||r?.portal||null,n=uUe[r?.origin||""]??"web-map",{populateOperationalLayers:o}=await ue(()=>import("./layersCreator-235289ec.js"),["./layersCreator-235289ec.js","./portalLayers-74558c37.js","./associatedFeatureServiceUtils-379c9e31.js","./fetchService-e12ac4b2.js","./styleUtils-f3879cce.js"],import.meta.url),a=[];if(yt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>n==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const h=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(h)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=Hs(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:cUe[t.type||""]??"web-map",portal:t.portal||Ea.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Ea.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await Yi(i,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e?.signal})).data,s=Hs(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=e8[t];return e?e.itemId?new lM({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):lM.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};d([m({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:lt}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],qc.prototype,"baseLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],qc.prototype,"id",void 0),d([m({type:kk})],qc.prototype,"portalItem",void 0),d([m()],qc.prototype,"referenceLayers",null),d([m({readOnly:!0})],qc.prototype,"resourceInfo",void 0),d([m({type:We})],qc.prototype,"spatialReference",void 0),d([m({type:Wke})],qc.prototype,"style",void 0),d([m()],qc.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],qc.prototype,"title",void 0),d([Ut("title")],qc.prototype,"writeTitle",null),qc=lM=d([U("esri.Basemap")],qc);const cUe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},uUe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},p2=qc,hUe=Object.freeze(Object.defineProperty({__proto__:null,default:p2},Symbol.toStringTag,{value:"Module"}));function vRt(t){}function dUe(t){return()=>t}var t8;let ID=t8=class extends Me{constructor(t){super(t),this.type="none"}clone(){return new t8({type:this.type})}};d([At({none:"none",stayAbove:"stay-above"})],ID.prototype,"type",void 0),ID=t8=d([U("esri.ground.NavigationConstraint")],ID);var i8;let hg=i8=class extends BR(pm){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new lt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&le.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{sn(t)||le.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Oe(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",dm(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};dUe(n)().write(o,r)&&s.push(o)}else r?.messages&&r.messages.push(new W("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return bX(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ue(()=>import("./ElevationQuery-11abeea7.js"),[],import.meta.url);yt(e);const r=new i,s=this.layers.filter(Ite).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ue(()=>import("./ElevationQuery-11abeea7.js"),[],import.meta.url);yt(e);const r=new i,s=this.layers.filter(Ite).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ge(this.surfaceColor),navigationConstraint:ge(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new i8({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",s=e?.portal||null,n=e?.url||null,{populateOperationalLayers:o}=await ue(()=>import("./layersCreator-235289ec.js"),["./layersCreator-235289ec.js","./portalLayers-74558c37.js","./associatedFeatureServiceUtils-379c9e31.js","./fetchService-e12ac4b2.js","./styleUtils-f3879cce.js"],import.meta.url);yt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function pUe(t){return t&&"createElevationSampler"in t}function Ite(t){return t.type==="elevation"||pUe(t)}d([m({json:{read:!1}})],hg.prototype,"layers",null),d([Ut("layers")],hg.prototype,"writeLayers",null),d([m({readOnly:!0})],hg.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Rr,read:{reader:KY,source:"transparency"},write:{writer:(t,e)=>{e.transparency=QY(t)},target:"transparency"}}})],hg.prototype,"opacity",void 0),d([m({type:et,json:{type:[Rr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],hg.prototype,"surfaceColor",void 0),d([m({type:ID,json:{write:!0}})],hg.prototype,"navigationConstraint",void 0),hg=i8=d([U("esri.Ground")],hg);const HO=hg;let jT=class extends lt{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(O3e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new lt(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};d([m()],jT.prototype,"getCollections",void 0),d([m()],jT.prototype,"getChildrenFunction",void 0),d([m()],jT.prototype,"itemFilterFunction",void 0),jT=d([U("esri.core.CollectionFlattener")],jT);const qO=jT,f3=new WeakMap;function q0e(t){return!t.destroyed&&(f3.has(t)||t.addHandles([he(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||q0e(e))},e=>f3.set(t,e),qi),Mi(()=>f3.delete(t))]),f3.get(t))}function fUe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function mUe(t){return!(!fUe(t)||!Kke(t)?.operations?.supportsEditing||"editingEnabled"in t&&!tUe(t)||q0e(t))}function zk(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function gUe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function yUe(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=_,v}function _Ue(t,e){return new Float32Array(t,e,16)}const vUe=zk();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vUe,clone:gUe,create:zk,createView:_Ue,fromValues:yUe},Symbol.toStringTag,{value:"Module"}));function tn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Sm(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,_,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=f,t[13]=g,t[14]=_,t[15]=v,t}function Ih(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pc(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function vv(t,e){return Is(t,e)||Ih(t),t}function Is(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15],w=i*a-r*o,T=i*l-s*o,S=i*c-n*o,A=r*l-s*a,P=r*c-n*a,R=s*c-n*l,F=u*_-h*g,k=u*v-p*g,N=u*b-f*g,j=h*v-p*_,z=h*b-f*_,X=p*b-f*v;let q=w*X-T*z+S*j+A*N-P*k+R*F;return q?(q=1/q,t[0]=(a*X-l*z+c*j)*q,t[1]=(s*z-r*X-n*j)*q,t[2]=(_*R-v*P+b*A)*q,t[3]=(p*P-h*R-f*A)*q,t[4]=(l*N-o*X-c*k)*q,t[5]=(i*X-s*N+n*k)*q,t[6]=(v*S-g*R-b*T)*q,t[7]=(u*R-p*S+f*T)*q,t[8]=(o*z-a*N+c*F)*q,t[9]=(r*N-i*z-n*F)*q,t[10]=(g*P-_*S+b*w)*q,t[11]=(h*S-u*P-f*w)*q,t[12]=(a*k-o*j-l*F)*q,t[13]=(i*j-r*k+s*F)*q,t[14]=(_*T-g*A-v*w)*q,t[15]=(u*A-h*T+p*w)*q,t):null}function bUe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-f*v)-h*(l*b-c*v)+_*(l*f-c*p),t[1]=-(r*(p*b-f*v)-h*(s*b-n*v)+_*(s*f-n*p)),t[2]=r*(l*b-c*v)-a*(s*b-n*v)+_*(s*c-n*l),t[3]=-(r*(l*f-c*p)-a*(s*f-n*p)+h*(s*c-n*l)),t[4]=-(o*(p*b-f*v)-u*(l*b-c*v)+g*(l*f-c*p)),t[5]=i*(p*b-f*v)-u*(s*b-n*v)+g*(s*f-n*p),t[6]=-(i*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=i*(l*f-c*p)-o*(s*f-n*p)+u*(s*c-n*l),t[8]=o*(h*b-f*_)-u*(a*b-c*_)+g*(a*f-c*h),t[9]=-(i*(h*b-f*_)-u*(r*b-n*_)+g*(r*f-n*h)),t[10]=i*(a*b-c*_)-o*(r*b-n*_)+g*(r*c-n*a),t[11]=-(i*(a*f-c*h)-o*(r*f-n*h)+u*(r*c-n*a)),t[12]=-(o*(h*v-p*_)-u*(a*v-l*_)+g*(a*p-l*h)),t[13]=i*(h*v-p*_)-u*(r*v-s*_)+g*(r*p-s*h),t[14]=-(i*(a*v-l*_)-o*(r*v-s*_)+g*(r*l-s*a)),t[15]=i*(a*p-l*h)-o*(r*p-s*h)+u*(r*l-s*a),t}function wUe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],_=t[14],v=t[15];return(e*o-i*n)*(h*v-p*_)-(e*a-r*n)*(u*v-p*g)+(e*l-s*n)*(u*_-h*g)+(i*a-r*o)*(c*v-p*f)-(i*l-s*o)*(c*_-h*f)+(r*l-s*a)*(c*g-u*f)}function Ai(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],f=e[10],g=e[11],_=e[12],v=e[13],b=e[14],w=e[15];let T=i[0],S=i[1],A=i[2],P=i[3];return t[0]=T*r+S*a+A*h+P*_,t[1]=T*s+S*l+A*p+P*v,t[2]=T*n+S*c+A*f+P*b,t[3]=T*o+S*u+A*g+P*w,T=i[4],S=i[5],A=i[6],P=i[7],t[4]=T*r+S*a+A*h+P*_,t[5]=T*s+S*l+A*p+P*v,t[6]=T*n+S*c+A*f+P*b,t[7]=T*o+S*u+A*g+P*w,T=i[8],S=i[9],A=i[10],P=i[11],t[8]=T*r+S*a+A*h+P*_,t[9]=T*s+S*l+A*p+P*v,t[10]=T*n+S*c+A*f+P*b,t[11]=T*o+S*u+A*g+P*w,T=i[12],S=i[13],A=i[14],P=i[15],t[12]=T*r+S*a+A*h+P*_,t[13]=T*s+S*l+A*p+P*v,t[14]=T*n+S*c+A*f+P*b,t[15]=T*o+S*u+A*g+P*w,t}function Aa(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],_=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=p,t[7]=f,t[8]=g,t[9]=_,t[10]=v,t[11]=b,t[12]=o*r+u*s+g*n+e[12],t[13]=a*r+h*s+_*n+e[13],t[14]=l*r+p*s+v*n+e[14],t[15]=c*r+f*s+b*n+e[15]}return t}function E0(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Sc(t,e,i,r){let s,n,o,a,l,c,u,h,p,f,g,_,v,b,w,T,S,A,P,R,F,k,N,j,z=r[0],X=r[1],q=r[2],Z=Math.sqrt(z*z+X*X+q*q);return Z<go()?null:(Z=1/Z,z*=Z,X*=Z,q*=Z,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],_=e[8],v=e[9],b=e[10],w=e[11],T=z*z*o+n,S=X*z*o+q*s,A=q*z*o-X*s,P=z*X*o-q*s,R=X*X*o+n,F=q*X*o+z*s,k=z*q*o+X*s,N=X*q*o-z*s,j=q*q*o+n,t[0]=a*T+h*S+_*A,t[1]=l*T+p*S+v*A,t[2]=c*T+f*S+b*A,t[3]=u*T+g*S+w*A,t[4]=a*P+h*R+_*F,t[5]=l*P+p*R+v*F,t[6]=c*P+f*R+b*F,t[7]=u*P+g*R+w*F,t[8]=a*k+h*N+_*j,t[9]=l*k+p*N+v*j,t[10]=c*k+f*N+b*j,t[11]=u*k+g*N+w*j,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function sC(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+u*r,t[6]=a*s+h*r,t[7]=l*s+p*r,t[8]=c*s-n*r,t[9]=u*s-o*r,t[10]=h*s-a*r,t[11]=p*s-l*r,t}function Bk(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-u*r,t[2]=a*s-h*r,t[3]=l*s-p*r,t[8]=n*r+c*s,t[9]=o*r+u*s,t[10]=a*r+h*s,t[11]=l*r+p*s,t}function nC(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+u*r,t[2]=a*s+h*r,t[3]=l*s+p*r,t[4]=c*s-n*r,t[5]=u*s-o*r,t[6]=h*s-a*r,t[7]=p*s-l*r,t}function ux(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function W0e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bl(t,e,i){if(e===0)return Ih(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<go()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Y0e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xUe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function X0e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Z0e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,u=r*a,h=r*l,p=r*c,f=s*l,g=s*c,_=n*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(f+_),t[1]=h+w,t[2]=p-b,t[3]=0,t[4]=h-w,t[5]=1-(u+_),t[6]=g+v,t[7]=0,t[8]=p+b,t[9]=g-v,t[10]=1-(u+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function TUe(t,e){const i=SUe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=r*r+s*s+n*n+o*o;return h>0?(i[0]=2*(a*o+u*r+l*n-c*s)/h,i[1]=2*(l*o+u*s+c*r-a*n)/h,i[2]=2*(c*o+u*n+a*s-l*r)/h):(i[0]=2*(a*o+u*r+l*n-c*s),i[1]=2*(l*o+u*s+c*r-a*n),i[2]=2*(c*o+u*n+a*s-l*r)),Z0e(t,e,i),t}const SUe=C();function oC(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Vk(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function J0e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function Q0e(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,h=s*l,p=s*c,f=s*u,g=n*c,_=n*u,v=o*u,b=a*l,w=a*c,T=a*u,S=r[0],A=r[1],P=r[2];return t[0]=(1-(g+v))*S,t[1]=(p+T)*S,t[2]=(f-w)*S,t[3]=0,t[4]=(p-T)*A,t[5]=(1-(h+v))*A,t[6]=(_+b)*A,t[7]=0,t[8]=(f+w)*P,t[9]=(_-b)*P,t[10]=(1-(h+g))*P,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function wX(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,h=a+a,p=n*c,f=n*u,g=n*h,_=o*u,v=o*h,b=a*h,w=l*c,T=l*u,S=l*h,A=r[0],P=r[1],R=r[2],F=s[0],k=s[1],N=s[2],j=(1-(_+b))*A,z=(f+S)*A,X=(g-T)*A,q=(f-S)*P,Z=(1-(p+b))*P,ce=(v+w)*P,I=(g+T)*R,D=(v-w)*R,G=(1-(p+_))*R;return t[0]=j,t[1]=z,t[2]=X,t[3]=0,t[4]=q,t[5]=Z,t[6]=ce,t[7]=0,t[8]=I,t[9]=D,t[10]=G,t[11]=0,t[12]=i[0]+F-(j*F+q*k+I*N),t[13]=i[1]+k-(z*F+Z*k+D*N),t[14]=i[2]+N-(X*F+ce*k+G*N),t[15]=1,t}function CUe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,h=r*a,p=s*o,f=s*a,g=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-h-g,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=f+_,t[7]=0,t[8]=p+v,t[9]=f-_,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function K0e(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function EUe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function AUe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function eye(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function Gk(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const u=go();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Ih(t);let h=1/Math.sqrt(a*a+l*l+c*c);a*=h,l*=h,c*=h;const p=r[0],f=r[1],g=r[2];let _=f*c-g*l,v=g*a-p*c,b=p*l-f*a;h=Math.sqrt(_*_+v*v+b*b),h?(h=1/h,_*=h,v*=h,b*=h):(_=0,v=0,b=0);let w=l*b-c*v,T=c*_-a*b,S=a*v-l*_;h=Math.sqrt(w*w+T*T+S*S),h?(h=1/h,w*=h,T*=h,S*=h):(w=0,T=0,S=0),t[0]=_,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+b*o),t[13]=-(w*s+T*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function tye(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=s-i[0],h=n-i[1],p=o-i[2],f=u*u+h*h+p*p;f>0&&(f=1/Math.sqrt(f),u*=f,h*=f,p*=f);let g=l*p-c*h,_=c*u-a*p,v=a*h-l*u;return f=g*g+_*_+v*v,f>0&&(f=1/Math.sqrt(f),g*=f,_*=f,v*=f),t[0]=g,t[1]=_,t[2]=v,t[3]=0,t[4]=h*v-p*_,t[5]=p*g-u*v,t[6]=u*_-h*g,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function MUe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function PUe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function OUe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function iye(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function RUe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function $Ue(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function jk(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Hk(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],f=t[11],g=t[12],_=t[13],v=t[14],b=t[15],w=e[0],T=e[1],S=e[2],A=e[3],P=e[4],R=e[5],F=e[6],k=e[7],N=e[8],j=e[9],z=e[10],X=e[11],q=e[12],Z=e[13],ce=e[14],I=e[15],D=go();return Math.abs(i-w)<=D*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-T)<=D*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-S)<=D*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-A)<=D*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(o-P)<=D*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(a-R)<=D*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-F)<=D*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(c-k)<=D*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(u-N)<=D*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(h-j)<=D*Math.max(1,Math.abs(h),Math.abs(j))&&Math.abs(p-z)<=D*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(f-X)<=D*Math.max(1,Math.abs(f),Math.abs(X))&&Math.abs(g-q)<=D*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(_-Z)<=D*Math.max(1,Math.abs(_),Math.abs(Z))&&Math.abs(v-ce)<=D*Math.max(1,Math.abs(v),Math.abs(ce))&&Math.abs(b-I)<=D*Math.max(1,Math.abs(b),Math.abs(I))}function xX(t){const e=go(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function qk(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const WO=Ai,IUe=iye;Object.freeze(Object.defineProperty({__proto__:null,add:OUe,adjoint:bUe,copy:tn,determinant:wUe,equals:Hk,exactEquals:jk,frob:PUe,fromQuat:CUe,fromQuat2:TUe,fromRotation:Bl,fromRotationTranslation:Z0e,fromRotationTranslationScale:Q0e,fromRotationTranslationScaleOrigin:wX,fromScaling:W0e,fromTranslation:ux,fromXRotation:Y0e,fromYRotation:xUe,fromZRotation:X0e,frustum:K0e,getRotation:J0e,getScaling:Vk,getTranslation:oC,hasIdentityRotation:qk,identity:Ih,invert:Is,invertOrIdentity:vv,isOrthoNormal:xX,lookAt:Gk,mul:WO,multiply:Ai,multiplyScalar:RUe,multiplyScalarAndAdd:$Ue,ortho:eye,perspective:EUe,perspectiveFromFieldOfView:AUe,rotate:Sc,rotateX:sC,rotateY:Bk,rotateZ:nC,scale:E0,set:Sm,str:MUe,sub:IUe,subtract:iye,targetTo:tye,translate:Aa,transpose:Pc},Symbol.toStringTag,{value:"Module"}));const LUe=(t,e)=>{const i=Sm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Pc(i,i)},DUe=(t,e)=>{const i=Sm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Pc(i,i)},NUe=(t,e)=>{const i=1-e,r=Sm(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Pc(r,r)},FUe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=Sm(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Pc(s,s)},kUe=(t,e)=>{const i=1-2*e,r=Sm(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Pc(r,r)},UUe=(t,e)=>{const i=Sm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Pc(i,i)},zUe=(t,e)=>{const i=1-e,r=Sm(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Pc(r,r)};let rye=class sye{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=hc(e.strength,i.strength,r),this.radius=hc(e.radius,i.radius,r),this.threshold=hc(e.threshold,i.threshold,r)}clone(){return new sye(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:GP(this.radius),strength:this.strength,threshold:this.threshold}}},nye=class oye{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(hc(e.radius,i.radius,r))}clone(){return new oye(this.radius)}toJSON(){return{type:"blur",radius:GP(this.radius)}}},r8=class aye{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=hc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new aye(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||zk();switch(this.type){case"brightness":this._colorMatrix=LUe(e,this.amount);break;case"contrast":this._colorMatrix=DUe(e,this.amount);break;case"grayscale":this._colorMatrix=NUe(e,this.amount);break;case"invert":this._colorMatrix=kUe(e,this.amount);break;case"saturate":this._colorMatrix=UUe(e,this.amount);break;case"sepia":this._colorMatrix=zUe(e,this.amount)}}},lye=class cye{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=hc(e.offsetX,i.offsetX,r),this.offsetY=hc(e.offsetY,i.offsetY,r),this.blurRadius=hc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(hc(e.color[0],i.color[0],r)),this.color[1]=Math.round(hc(e.color[1],i.color[1],r)),this.color[2]=Math.round(hc(e.color[2],i.color[2],r)),this.color[3]=hc(e.color[3],i.color[3],r)}clone(){return new cye(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:GP(this.offsetX),yoffset:GP(this.offsetY),blurRadius:GP(this.blurRadius),color:e}}},uye=class hye{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=hc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new hye(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||zk();this._colorMatrix=FUe(e,this.angle)}},dye=class pye{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=hc(e.amount,i.amount,r)}clone(){return new pye(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function hc(t,e,i){return t+(e-t)*i}function GP(t){return Math.round(1e3*No(t))/1e3}function BUe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new r8(t.type,0);case"saturate":case"brightness":case"contrast":return new r8(t.type,1);case"opacity":return new dye(1);case"hue-rotate":return new uye(0);case"blur":return new nye(0);case"drop-shadow":return new lye(0,0,0,[...XY("transparent")]);case"bloom":return new rye(0,0,1)}}function VUe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function GUe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(BUe(i[s]))}function jUe(t){const e=t[0];return!!e&&"type"in e}function HUe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const Lte=()=>le.getLogger("esri.support.basemapUtils");function qUe(){return{}}function WUe(t){for(const e in t){const i=t[e];Oe(i),delete t[e]}}function TX(t,e){let i;if(typeof t=="string"){const r=t in e8,s=!r&&t.includes("/");if(!r&&!s){const n=Object.entries(e8).filter(([o,a])=>Gi.apiKey&&!a.classic||!Gi.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return Lte().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(i=e[t]),i||(i=r?p2.fromId(t):new p2({style:{id:t}}),e&&(e[t]=i))}else i=mo(p2,t);return i?.destroyed&&(Lte().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function wRt(t,e){return t.basemap?.referenceLayers?.some(i=>i.uid===e)||t.basemap?.baseLayers?.some(i=>i.uid===e)}function YUe(t,e=null){const i=TX(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=Dte(r.baseLayers,e.baseLayers),r.referenceLayers=Dte(r.referenceLayers,e.referenceLayers)),r}function Dte(t,e){const i=new lt;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&JUe(kte(r),kte(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function Nte(t){return!!t?.baseLayers.concat(t.referenceLayers).some(XUe)}function XUe(t){if(Fte(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(Fte(i?.sourceUrl))return!0}return!1}const ZUe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function Fte(t){if(!t)return!1;const e=new vc(Ja(t));return!!e.authority&&ZUe.test(e.authority)}function kte(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:QUe("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function JUe(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!HUe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if(r?.id!==s?.id||r?.visible!==s?.visible)return!1}}return!0}function QUe(t){return t?ip(t).replace(/^\s*https?:/i,"").toLowerCase():""}function KUe(t){return new qO({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function uB(t){for(const e of t.values())e?.destroy();t.clear()}const Ute={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function eze(t){let e=null;if(typeof t=="string")if(t in Ute){const i=Ute[t];e=new HO({resourceInfo:{data:{layers:[i]}}})}else le.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=mo(HO,t);return e}const zte={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function hB(t,e,i,r=um){const s=new dp(VY(r)),n=ti.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":mye(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function xRt(t,e,i="milliseconds"){const r=t.getTime(),s=fye(e,i,"milliseconds");return new Date(r+s)}function Bte(t,e,i=um){const r=new dp(VY(i)),s=ti.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=mye(e);return s.startOf(n).toJSDate()}function fye(t,e,i){return t===0?0:t*zte[e]/zte[i]}function TRt(t,e){return t&&e?t.intersection(e):t||e}function mye(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Yu;let su=Yu=class extends Me{static get allTime(){return Vte}static get empty(){return tze}static fromArray(t){return new Yu({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?.getTime()??null}get isAllTime(){return this.equals(Yu.allTime)}get isEmpty(){return this.equals(Yu.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?.getTime()??null}clone(){return new Yu({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=t.start?.getTime()??t.start,s=t.end?.getTime()??t.end;return e===r&&i===s}expandTo(t,e=um){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=Bte(i,t,e));let r=this.end;if(r){const s=Bte(r,t,e);r=r.getTime()===s.getTime()?s:hB(s,1,t,e)}return new Yu({start:i,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Yu.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,r=t.start?.getTime()??-1/0,s=t.end?.getTime()??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?Yu.empty:new Yu({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=um){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Yu,{start:s,end:n}=this;return s!=null&&(r.start=hB(s,t,e,i)),n!=null&&(r.end=hB(n,t,e,i)),r}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Vte.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Yu({start:e,end:i})}};d([m({type:Date,json:{write:{allowNull:!0}}})],su.prototype,"end",void 0),d([_i("end")],su.prototype,"readEnd",null),d([Ut("end")],su.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],su.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],su.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],su.prototype,"start",void 0),d([_i("start")],su.prototype,"readStart",null),d([Ut("start")],su.prototype,"writeStart",null),su=Yu=d([U("esri.TimeExtent")],su);const Vte=new su,tze=new su({start:void 0,end:void 0}),rp=su;async function ize(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await ue(()=>import("./portalLayers-74558c37.js").then(r=>r.p),["./portalLayers-74558c37.js","./associatedFeatureServiceUtils-379c9e31.js","./fetchService-e12ac4b2.js"],import.meta.url);try{return await i(e)}catch(r){const s=e?.portalItem,n=s?.id||"unset",o=s?.portal?.url||Gi.portalUrl;throw le.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let rze=0,Ln=class extends Ls.EventedMixin(ZY(pm)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Qi(-180,-90,180,90,We.WGS84),this.id=Date.now().toString(16)+"-layer-"+rze++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=We.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await ue(()=>import("./arcgisLayers-0e844c2c.js"),["./arcgisLayers-0e844c2c.js","./associatedFeatureServiceUtils-379c9e31.js","./fetchService-e12ac4b2.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return ize(e)}initialize(){this.when().catch(e=>{sn(e)||le.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Hs(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Yi(e,{query:{f:"json"},responseType:"json"})).data;throw new W("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],Ln.prototype,"attributionDataUrl",void 0),d([m({type:Qi})],Ln.prototype,"fullExtent",void 0),d([m({readOnly:!0})],Ln.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],Ln.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],Ln.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],Ln.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],Ln.prototype,"opacity",void 0),d([m({clonable:!1})],Ln.prototype,"parent",void 0),d([m({readOnly:!0})],Ln.prototype,"parsedUrl",null),d([m({type:Boolean,readOnly:!0})],Ln.prototype,"persistenceEnabled",void 0),d([m({type:Boolean})],Ln.prototype,"popupEnabled",void 0),d([m({type:Boolean})],Ln.prototype,"attributionVisible",void 0),d([m({type:We})],Ln.prototype,"spatialReference",void 0),d([m({type:String})],Ln.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],Ln.prototype,"type",void 0),d([m()],Ln.prototype,"url",void 0),d([m({type:rp})],Ln.prototype,"visibilityTimeExtent",void 0),d([m({type:Boolean,nonNullable:!0})],Ln.prototype,"visible",void 0),Ln=d([U("esri.layers.Layer")],Ln);const SX=Ln;function s8(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),r?.[e]===i)return r;if(r?.type==="group"&&(s=s8(r.layers,e,i),s))return s}}const sze=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new lt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||le.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void le.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",dm(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof SX){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else $c(i)?i.then(n=>{this.destroyed||this.add(n,r)}):le.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return s8(this.layers,"id",i)}findLayerByUid(i){return s8(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return d([m()],e.prototype,"layers",null),e=d([U("esri.support.LayersMixin")],e),e};function n8(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if(n?.type==="group"){const o=n8(n.tables,e,i);if(o)return o}}}const nze=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new lt,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&le.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",dm(i,this._get("tables")))}findTableById(i){return n8(this.tables,"id",i)}findTableByUid(i){return n8(this.tables,"uid",i)}};return d([m()],e.prototype,"tables",null),e=d([U("esri.support.TablesMixin")],e),e};let dd=class extends nze(sze(Ls.EventedMixin(Pe))){constructor(e){super(e),this.allLayers=new qO({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=KUe(this),this.basemap=null,this.editableLayers=new qO({getCollections:()=>[this.allLayers],itemFilterFunction:mUe}),this.ground=new HO,this._basemapCache=qUe()}destroy(){WUe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Oe(this.basemap),Oe(this.ground),this._set("ground",null)}castBasemap(e){return TX(e,this._basemapCache)}castGround(e){return eze(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};d([m({readOnly:!0,dependsOn:[]})],dd.prototype,"allLayers",void 0),d([m({readOnly:!0})],dd.prototype,"allTables",void 0),d([m({type:p2,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],dd.prototype,"basemap",void 0),d([cr("basemap")],dd.prototype,"castBasemap",null),d([m({readOnly:!0})],dd.prototype,"editableLayers",void 0),d([m({type:HO,nonNullable:!0})],dd.prototype,"ground",void 0),d([cr("ground")],dd.prototype,"castGround",null),d([m()],dd.prototype,"undoRedo",void 0),dd=d([U("esri.Map")],dd);const gye=dd;let V1=class extends q_{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],V1.prototype,"row",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],V1.prototype,"column",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],V1.prototype,"rows",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],V1.prototype,"columns",void 0),V1=d([U("esri.CameraLayout")],V1);const yye=V1;let Z_=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return Gte(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Te(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+o8(this.range,e-i,r)}minimalMonotonic(e,i,r){return Gte(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function Gte(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=o8(t,e-r):r>i&&(r-=o8(t,r-i)),n&&r===i&&(r=e),r+s}function o8(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const oze=new Z_(0,2*Math.PI),J_=new Z_(-Math.PI,Math.PI),CX=new Z_(0,360);let cf=class extends Ic(Me){constructor(...e){super(...e),this.position=new Xe([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new yye}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=$d(e.x||0),n.y=$d(e.y||0),n.z=e.hasZ?$d(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new Xe;return r.read(e,i),r.x=$d(r.x||0),r.y=$d(r.y||0),r.z=r.hasZ?$d(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};d([m({type:Xe,json:{write:{isRequired:!0}}})],cf.prototype,"position",void 0),d([Ut("position")],cf.prototype,"writePosition",null),d([_i("position")],cf.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),cr(t=>CX.normalize($d(t)))],cf.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),cr(t=>Te($d(t),-180,180))],cf.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],cf.prototype,"fov",void 0),d([m({type:yye,nonNullable:!0,json:{read:!1,write:!1}})],cf.prototype,"layout",void 0),cf=d([U("esri.Camera")],cf);const Pu=cf;var a8;let Ly=a8=class extends Me{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new a8({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:dB}}}}})],Ly.prototype,"rotation",void 0),d([cr("rotation")],Ly.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:dB}}}}})],Ly.prototype,"scale",void 0),d([m({types:Tk,json:{read:$w,write:!0,origins:{"web-scene":{read:$w,write:{overridePolicy:dB}}}}})],Ly.prototype,"targetGeometry",void 0),d([m({type:Pu,json:{write:!0}})],Ly.prototype,"camera",void 0),Ly=a8=d([U("esri.Viewpoint")],Ly);const mp=Ly;function dB(){return{enabled:!this.camera}}let aze=class _ye{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(rj),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new _ye,r=this._originStores[Ti.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ge(s),Ti.DEFAULTS)});for(let s=Ti.SERVICE;s<rj;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,ge(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Ti.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Ti.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r?.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Ti.DEFAULTS}forEach(e){this._values.forEach(e)}};const vye=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ul(this),s=r.store,n=new aze;r.store=n,Vpe(r,s,n)}read(i,r){jpe(this,i,r)}getAtOrigin(i,r){const s=pB(this),n=b_(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return _F(this.originIdOf(i))}originIdOf(i){return pB(this).originOf(i)}revert(i,r){const s=pB(this),n=b_(r),o=Ul(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=d([U("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function pB(t){return Ul(t).store}let jte=class extends vye(Pe){};jte=d([U("esri.core.ReadOnlyMultiOriginJSONSupport")],jte);const lze=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return fB(this).delete(i,b_(r))}write(i,r){return qpe(this,i=i||{},r),i}setAtOrigin(i,r,s){Ul(this).setAtOrigin(i,r,b_(s))}removeOrigin(i){const r=fB(this),s=b_(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Ti.USER)}updateOrigin(i,r){const s=fB(this),n=b_(r),o=ep(this,i);for(let a=n+1;a<rj;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=d([U("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function fB(t){return Ul(t).store}const bye=t=>{let e=class extends lze(vye(t)){constructor(...i){super(...i)}};return e=d([U("esri.core.MultiOriginJSONSupport")],e),e};let l8=class extends bye(Pe){};l8=d([U("esri.core.MultiOriginJSONSupport")],l8);function cze(t){return t&&"getAtOrigin"in t&&"originOf"in t}function Hte(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{cze(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var cM;const i4=rl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),wye=i4.jsonValues.slice();EO(wye,"orthometric");const jP=rl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let pd=cM=class extends Me{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return i4.write(t,e,i)}readHeightModel(t,e,i){return i4.read(t)||(i?.messages&&i.messages.push(uze(t,{context:i})),null)}readHeightUnit(t,e,i){return jP.read(t)||(i?.messages&&i.messages.push(qte(t,{context:i})),null)}readHeightUnitService(t,e,i){return Sfe(t)||jP.read(t)||(i?.messages&&i.messages.push(qte(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new cM({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=Cfe(e);return new cM({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new cM;return e.read(t,{origin:"web-scene"}),e}};function qte(t,e){return new bw("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function uze(t,e){return new bw("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:i4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:wye,default:"ellipsoidal"}}}})],pd.prototype,"heightModel",void 0),d([Ut("web-scene","heightModel")],pd.prototype,"writeHeightModel",null),d([_i(["web-scene","service"],"heightModel")],pd.prototype,"readHeightModel",null),d([m({type:jP.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:jP.jsonValues,write:jP.write}}}})],pd.prototype,"heightUnit",void 0),d([_i("web-scene","heightUnit")],pd.prototype,"readHeightUnit",null),d([_i("service","heightUnit")],pd.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],pd.prototype,"vertCRS",void 0),d([_i("service","vertCRS",["vertCRS","ellipsoid","geoid"])],pd.prototype,"readVertCRS",null),pd=cM=d([U("esri.geometry.HeightModelInfo")],pd);const hx=pd,RRt=Math.PI/180,$Rt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Y0=ji.radius,Xh=ji.eccentricitySquared,hze={a1:Y0*Xh,a2:Y0*Xh*Y0*Xh,a3:Y0*Xh*Xh/2,a4:Y0*Xh*Y0*Xh*2.5,a5:Y0*Xh+Y0*Xh*Xh/2,a6:1-Xh},IRt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ji.radius,f:ji.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:l0.radius,f:l0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:tp.radius,f:tp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:tp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var re;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(re||(re={}));const uM={[re.WGS84]:{[re.CGCS2000]:gs,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:gs,[re.SPHERICAL_ECEF]:g2,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:tw,[re.PLATE_CARREE]:iw,[re.WGS84]:gs,[re.WGS84_ECEF]:sw},[re.CGCS2000]:{[re.CGCS2000]:gs,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:gs,[re.SPHERICAL_ECEF]:g2,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:tw,[re.PLATE_CARREE]:iw,[re.WGS84]:gs,[re.WGS84_ECEF]:sw},[re.GCSMARS2000]:{[re.CGCS2000]:null,[re.GCSMARS2000]:gs,[re.GCSMOON2000]:null,[re.LON_LAT]:gs,[re.SPHERICAL_ECEF]:null,[re.SPHERICAL_MARS_PCPF]:u8,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:null,[re.PLATE_CARREE]:null,[re.WGS84]:null,[re.WGS84_ECEF]:null},[re.GCSMOON2000]:{[re.CGCS2000]:null,[re.GCSMARS2000]:null,[re.GCSMOON2000]:gs,[re.LON_LAT]:gs,[re.SPHERICAL_ECEF]:null,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:c8,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:null,[re.PLATE_CARREE]:null,[re.WGS84]:null,[re.WGS84_ECEF]:null},[re.WEB_MERCATOR]:{[re.CGCS2000]:f2,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:f2,[re.SPHERICAL_ECEF]:xye,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:gs,[re.PLATE_CARREE]:Sye,[re.WGS84]:f2,[re.WGS84_ECEF]:Tye},[re.WGS84_ECEF]:{[re.CGCS2000]:nw,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:nw,[re.SPHERICAL_ECEF]:Aye,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:Mye,[re.PLATE_CARREE]:dze,[re.WGS84]:nw,[re.WGS84_ECEF]:gs},[re.SPHERICAL_ECEF]:{[re.CGCS2000]:rw,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:rw,[re.SPHERICAL_ECEF]:gs,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:Cye,[re.PLATE_CARREE]:pze,[re.WGS84]:rw,[re.WGS84_ECEF]:Eye},[re.SPHERICAL_MARS_PCPF]:{[re.CGCS2000]:null,[re.GCSMARS2000]:d8,[re.GCSMOON2000]:null,[re.LON_LAT]:d8,[re.SPHERICAL_ECEF]:null,[re.SPHERICAL_MARS_PCPF]:gs,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:null,[re.PLATE_CARREE]:null,[re.WGS84]:null,[re.WGS84_ECEF]:null},[re.SPHERICAL_MOON_PCPF]:{[re.CGCS2000]:null,[re.GCSMARS2000]:null,[re.GCSMOON2000]:h8,[re.LON_LAT]:h8,[re.SPHERICAL_ECEF]:null,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:gs,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:null,[re.PLATE_CARREE]:null,[re.WGS84]:null,[re.WGS84_ECEF]:null},[re.UNKNOWN]:{[re.CGCS2000]:null,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:null,[re.SPHERICAL_ECEF]:null,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:gs,[re.WEB_MERCATOR]:null,[re.PLATE_CARREE]:null,[re.WGS84]:null,[re.WGS84_ECEF]:null},[re.LON_LAT]:{[re.CGCS2000]:gs,[re.GCSMARS2000]:gs,[re.GCSMOON2000]:gs,[re.LON_LAT]:gs,[re.SPHERICAL_ECEF]:g2,[re.SPHERICAL_MARS_PCPF]:u8,[re.SPHERICAL_MOON_PCPF]:c8,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:tw,[re.PLATE_CARREE]:iw,[re.WGS84]:gs,[re.WGS84_ECEF]:sw},[re.PLATE_CARREE]:{[re.CGCS2000]:m2,[re.GCSMARS2000]:null,[re.GCSMOON2000]:null,[re.LON_LAT]:m2,[re.SPHERICAL_ECEF]:fze,[re.SPHERICAL_MARS_PCPF]:null,[re.SPHERICAL_MOON_PCPF]:null,[re.UNKNOWN]:null,[re.WEB_MERCATOR]:mze,[re.PLATE_CARREE]:gs,[re.WGS84]:m2,[re.WGS84_ECEF]:gze}};function Q_(t,e,i=PX()){return t==null||e==null?null:_ze(t,e,i).projector}function LRt(t,e){switch(Q_(t,e,Wk)){case gs:return"copy3";case g2:return"wgs84ToSphericalECEF";case tw:return"wgs84ToWebMercator";case iw:return"wgs84ToPlateCarree";case sw:return"wgs84ToWGS84ECEF";case f2:return"webMercatorToWGS84";case xye:return"webMercatorToSphericalECEF";case Tye:return"webMercatorToWGS84ECEF";case Sye:return"webMercatorToPlateCarree";case nw:return"wgs84ECEFToWGS84";case Aye:return"wgs84ECEFToSphericalECEF";case Mye:return"wgs84ECEFToWebMercator";case rw:return"sphericalECEFToWGS84";case Cye:return"sphericalECEFToWebMercator";case d8:return"sphericalMarsPCPFToMars2000";case h8:return"sphericalMoonPCPFToMoon2000";case Eye:return"sphericalECEFToWGS84ECEF";case u8:return"mars2000ToSphericalPCPF";case c8:return"moon2000ToSphericalPCPF";default:return null}}function r4(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=sl(t,1)),$O(t)?e.spatialReferenceId=re.SPHERICAL_ECEF:c0(t)?e.spatialReferenceId=re.WGS84:cp(t)?e.spatialReferenceId=re.WEB_MERCATOR:Cw(t)?e.spatialReferenceId=re.PLATE_CARREE:t.wkt===bfe.wkt?e.spatialReferenceId=re.WGS84_ECEF:t.wkid===bc.CGCS2000?e.spatialReferenceId=re.CGCS2000:t.wkt===hk.wkt?e.spatialReferenceId=re.SPHERICAL_MARS_PCPF:t.wkt===dk.wkt?e.spatialReferenceId=re.SPHERICAL_MOON_PCPF:ex(t)?e.spatialReferenceId=re.GCSMARS2000:tx(t)?e.spatialReferenceId=re.GCSMOON2000:e.spatialReferenceId=re.UNKNOWN):re.UNKNOWN}function gs(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function f2(t,e,i,r){i[r]=lC*(t[e]/ow),i[r+1]=lC*(Pye-2*Math.atan(Math.exp(-t[e+1]/ow))),i[r+2]=t[e+2]}function xye(t,e,i,r){const s=t[e]/ow,n=Pye-2*Math.atan(Math.exp(-t[e+1]/ow)),o=ow+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function Tye(t,e,i,r){f2(t,e,i,r),sw(i,r,i,r)}function EX(t,e,i,r,s){const n=.4999999*Yk,o=Te(aC*t[e+1],-n,n),a=Math.sin(o);i[r++]=aC*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function tw(t,e,i,r){EX(t,e,i,r,ji)}function iw(t,e,i,r){i[r]=t[e]*Wte,i[r+1]=t[e+1]*Wte,i[r+2]=t[e+2]}function m2(t,e,i,r){i[r]=t[e]*Yte,i[r+1]=t[e+1]*Yte,i[r+2]=t[e+2]}function Sye(t,e,i,r){f2(t,e,i,r),iw(i,r,i,r)}function dze(t,e,i,r){nw(t,e,i,r),iw(i,r,i,r)}function pze(t,e,i,r){rw(t,e,i,r),iw(i,r,i,r)}function fze(t,e,i,r){m2(t,e,i,r),g2(i,r,i,r)}function mze(t,e,i,r){m2(t,e,i,r),tw(i,r,i,r)}function gze(t,e,i,r){m2(t,e,i,r),sw(i,r,i,r)}function AX(t,e,i,r,s){const n=s+t[e+2],o=aC*t[e+1],a=aC*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function c8(t,e,i,r){AX(t,e,i,r,l0.radius)}function u8(t,e,i,r){AX(t,e,i,r,tp.radius)}function g2(t,e,i,r){AX(t,e,i,r,ji.radius)}function MX(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=up(a/(l===0?1:l)),u=Math.atan2(o,n);i[r++]=lC*u,i[r++]=lC*c,i[r]=l-s}function h8(t,e,i,r){MX(t,e,i,r,l0.radius)}function d8(t,e,i,r){MX(t,e,i,r,tp.radius)}function rw(t,e,i,r){MX(t,e,i,r,ji.radius)}function Cye(t,e,i,r){rw(t,e,i,r),tw(i,r,i,r)}function Eye(t,e,i,r){rw(t,e,i,r),sw(i,r,i,r)}function yze(t,e,i,r,s){const n=aC*t[e],o=aC*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(n),i[r++]=(u+a)*c*Math.sin(n),i[r++]=(u*(1-s.eccentricitySquared)+a)*l}function sw(t,e,i,r){yze(t,e,i,r,ji)}function nw(t,e,i,r){const s=hze,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,h,p,f,g,_,v,b,w,T,S,A,P,R,F,k,N,j,z;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),h=c+a*a,p=Math.sqrt(h),j=Math.atan2(o,n),f=a*a/h,g=c/h,A=s.a2/p,P=s.a3-s.a4/p,g>.3?(_=l/p*(1+g*(s.a1+A+f*P)/p),N=Math.asin(_),b=_*_,v=Math.sqrt(1-b)):(v=u/p*(1-f*(s.a5-A-g*P)/p),N=Math.acos(v),b=1-v*v,_=Math.sqrt(b)),w=1-ji.eccentricitySquared*b,T=ji.radius/Math.sqrt(w),S=s.a6*T,A=u-T*v,P=l-S*_,F=v*A+_*P,R=v*P-_*A,k=R/(S/w+F),N+=k,z=F+R*k/2,a<0&&(N=-N),i[r++]=lC*j,i[r++]=lC*N,i[r]=z}function Aye(t,e,i,r){nw(t,e,i,r),g2(i,r,i,r)}function Mye(t,e,i,r){nw(t,e,i,r),tw(i,r,i,r)}function _ze(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=r4(t,i.source),s=r4(e,i.dest);return r===re.UNKNOWN&&s===re.UNKNOWN?ls(t,e)?i.projector=gs:i.projector=null:i.projector=uM[r][s],i}function PX(){return{source:{spatialReference:null,spatialReferenceId:re.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:re.UNKNOWN,metersPerUnit:1},projector:gs}}const vze={spatialReference:null,spatialReferenceId:re.UNKNOWN},bze={spatialReference:null,spatialReferenceId:re.UNKNOWN},Wk=PX(),aC=xt(1),lC=ea(1),Yk=Math.PI,Pye=.5*Yk,ow=ji.radius,Wte=ow*Yk/180,Yte=180/(ow*Yk);function jr(t,e,i,r,s,n,o=1){const a=Q_(e,s,Wk);if(a==null)return!1;if(a===gs){if(t===r&&i===n)return!0;const c=i+3*o;for(let u=i,h=n;u<c;u++,h++)r[h]=t[u];return!0}const l=i+3*o;for(let c=i,u=n;c<l;c+=3,u+=3)a(t,c,r,u);return!0}const DRt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:jr},Symbol.toStringTag,{value:"Module"}));function Xte(t,e,i,r,s,n){return m3[0]=t,m3[1]=e,m3[2]=i,jr(m3,r,0,s,n,0,1)}const m3=C();let g3=0,mB=class p8{static fromGE(e){const i=new p8;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=g3++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=g3++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=g3++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=g3++}getInverse(){const e=new p8;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},s4=class hM{static cacheKey(e,i){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",i.wkid?.toString()??"-1",i.wkt?.toString()??"",i.wkt2?.toString()??""].join()}static fromGE(e){const i=new hM;let r="";for(const s of e.steps){const n=mB.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const i of e.steps)i instanceof mB?this.steps.push(i):this.steps.push(new mB({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new hM;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[hM.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[hM.cacheKey(e,i)];return s===void 0?null:s}};function wze(t,e,i){if(e==null||i==null||i.vcsWkid||ls(e,i)||H_(e)||H_(i))return null;const r=LO(e)/LO(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>xze(s,r);case"polyline":case"esriGeometryPolyline":return s=>Sze(s,r);case"polygon":case"esriGeometryPolygon":return s=>Tze(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>Cze(s,r);case"extent":case"esriGeometryEnvelope":return s=>Eze(s,r);default:return null}}function xze(t,e){t?.z!=null&&(t.z*=e)}function Tze(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function Sze(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function Cze(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function Eze(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let sp=null,K_=null,HP=null,LD={};const OX=new YR;function lE(){return!!sp&&hfe()}function Oye(){return!!lE()||(Ot(OX),cC(),!1)}function HT(t,e){return!t||!e||Vl(t,e)||Oye()}function Rye(t,e){return!Vl(t,e)&&!lE()}function cC(t){return HP==null&&(HP=Promise.all([dfe(),ue(()=>import("./geometryEngineBase-1fd17bb5.js"),[],import.meta.url).then(e=>e.g),ue(()=>import("./hydrated-109b30e2.js"),[],import.meta.url)])),HP.then(([,e,{hydratedAdapter:i}])=>{yt(t),K_=i,sp=e.default,sp._enableProjection(YIe),OX.notify()})}function bv(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:f8(K_,t,t[0].spatialReference,e,i,r):f8(K_,[t],t.spatialReference,e,i,r)[0]}function f8(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(Vl(i,r,s))return e.map(o=>qP(o,i,r));if(s==null&&$O(i))return e.map(o=>qP(o,i,We.WGS84)).map(o=>ev(o,r));if(s==null&&$O(r))return e.map(o=>ev(o,We.WGS84)).map(o=>qP(o,We.WGS84,r));if(s==null){const o=s4.cacheKey(i,r);LD[o]!==void 0?s=LD[o]:((s=Iye(i,r,void 0))==null&&(s=new s4),LD[o]=s)}if(sp==null||t==null)throw new Xk;return n!=null?sp._project(t,e,i,r,s,n):sp._project(t,e,i,r,s)}function Aze(t,e){const i=$ye([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function $ye(t,e){if(!lE()){for(const i of t)if(i!=null&&!ls(i.spatialReference,e)&&jd(i.spatialReference)&&jd(e)&&!Vl(i.spatialReference,e))return Ot(OX),{pending:cC(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:ls(i.spatialReference,e)?i:jd(i.spatialReference)&&jd(e)?ev(i,e):null)}}function Iye(t,e,i=null){if(t==null||e==null)return null;if(sp==null||K_==null)throw new Xk;const r=sp._getTransformation(K_,t,e,i,i?.spatialReference);return r!==null?s4.fromGE(r):null}function Mze(t,e,i=null){if(sp==null||K_==null)throw new Xk;const r=sp._getTransformationBySuitability(K_,t,e,i,i?.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(s4.fromGE(n));return s}return[]}let Xk=class extends W{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function Pze(){sp=null,K_=null,HP=null,LD={}}const Oze={get loadPromise(){return HP}};function ev(t,e){try{const i=bv(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=wze(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof Xk))throw i;return null}}async function tv(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await i$(r,e,null,i),ev(t,e)}function Vl(t,e,i){return!i&&(!!ls(t,e)||jd(t)&&jd(e)&&!!Q_(t,e,Wk))}function Rze(t,e){if(ls(t,e))return!0;if(!jd(t)||!jd(e))return!1;const i=c0(t)||cp(t)||G2(t),r=c0(e)||cp(e)||G2(e);return i&&r}async function i$(t,e,i,r){if(lE())return KK(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!Vl(s,n,o))return cC(r)}else if(t&&e&&!Vl(t,e,i))return cC(r);return KK(r)}function qP(t,e,i){return t?"x"in t?Dye(t,e,new Xe,i,0):"xmin"in t?Uye(t,e,new Qi,i,0):"rings"in t?kye(t,e,new mv,i,0):"paths"in t?Fye(t,e,new xk,i,0):"points"in t?Nye(t,e,new JC,i,0):null:null}function Lye(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&Dye(t,t.spatialReference,e,i,r)!=null}function Dye(t,e,i,r,s){Ha[0]=t.x,Ha[1]=t.y;const n=t.z;return Ha[2]=n!==void 0?n:s,jr(Ha,e,0,Ha,r,0,1)?(i.x=Ha[0],i.y=Ha[1],i.spatialReference=r,n!==void 0||H_(r)?(i.z=Ha[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function $ze(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&Nye(t,t.spatialReference,e,i,r)!=null}function Nye(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const p of n)u.push(p[0],p[1],o?p[2]:s);if(!jr(u,e,0,u,r,0,c))return null;const h=o||H_(r);for(let p=0;p<c;++p){const f=3*p,g=u[f],_=u[f+1];h&&a?l.push([g,_,u[f+2],n[p][3]]):h?l.push([g,_,u[f+2]]):a?l.push([g,_,n[p][2]]):l.push([g,_])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function Ize(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&Fye(t,t.spatialReference,e,i,r)!=null}function Fye(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!zye(n,o??!1,a??!1,e,l,r,s))return null;const c=o||H_(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function Lze(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&kye(t,t.spatialReference,e,i,r)!=null}function kye(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!zye(n,o??!1,a??!1,e,l,r,s))return null;const c=o||H_(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function Dze(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&Uye(t,t.spatialReference,e,i,r)!=null}function Uye(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,h=c?t.zmin:s;if(!Xte(n,o,h,e,Ha,r))return null;const p=c||H_(r);i.xmin=Ha[0],i.ymin=Ha[1],p&&(i.zmin=Ha[2]);const f=c?t.zmax:s;return Xte(a,l,f,e,Ha,r)?(i.xmax=Ha[0],i.ymax=Ha[1],p&&(i.zmax=Ha[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function zye(t,e,i,r,s,n,o=0){const a=new Array;for(const u of t)for(const h of u)a.push(h[0],h[1],e?h[2]:o);if(!jr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||H_(n);for(const u of t){const h=new Array;for(const p of u)c&&i?h.push([a[l++],a[l++],a[l++],p[3]]):c?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}const Ha=C(),FRt=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Vl,getTransformation:Iye,getTransformations:Mze,initializeProjection:i$,isEqualBaseGCS:Rze,isLoaded:lE,isLoadedOrLoad:Oye,isLoadedOrLoadFor:HT,load:cC,project:bv,projectExtent:Dze,projectMany:f8,projectMultipoint:$ze,projectOrLoad:Aze,projectOrLoadMany:$ye,projectPoint:Lye,projectPolygon:Lze,projectPolyline:Ize,projectWithZConversion:tv,projectWithoutEngine:qP,requiresLoad:Rye,test:Oze,tryProjectWithZConversion:ev,unload:Pze},Symbol.toStringTag,{value:"Module"})),Bye={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},Vye=Object.values(Bye),Gye=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Vye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Nze=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${Vye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Fze=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function kRt(t){return Gye.test(t)}function RX(t){if(t==null)return null;const e=Hs(t),i=e?.path.match(Gye)||e?.path.match(Nze);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:jye(a!==-1?s.slice(a+1):s),serverType:Bye[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function kze(t){const e=Hs(t).path.match(Fze);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function jye(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function URt(t,e){const i=[];if(t){const r=RX(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=jye(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function zRt(t){let e=Mh(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function BRt(t,e){return t&&Kpe(tfe(t,e))}function VRt(t){let{url:e}=t;if(!e)return{url:e};e=tfe(e,t.logger);const i=Hs(e),r=RX(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=kze(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:Kpe(e),layerId:s}}function GRt(t,e,i,r,s){Dw(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=vm(r.url,i,t.layerId.toString()))}function jRt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function Uze(t,e){if(!t)return null;if(!m8(t))return new W("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=hx.deriveUnitFromSR(t,e).heightUnit;return i!==r?new W("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function HRt(t,e,i){const r=Hye(t),s=e,n=zze(r,s,i);if(r){const o=hx.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new W("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!Bze(t)||n===lc.Unsupported)return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case lc.Units:{const o=r?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new W("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case lc.HeightModel:{const o=r?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new W("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case lc.CRS:{const o=r?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new W("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function zze(t,e,i){if(!m8(t)||!m8(e))return lc.Unsupported;if(t==null||e==null)return lc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return lc.Units;if(t.heightModel!==e.heightModel)return lc.HeightModel;switch(t.heightModel){case"gravity-related-height":return lc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?lc.Ok:lc.CRS;default:return lc.Unsupported}}var lc;function m8(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function Bze(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!Yye(t)}function Hye(t){if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?RX(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&qye(t)&&t.heightModelInfo?t.heightModelInfo:Yye(t)?hx.deriveUnitFromSR(Gze,t.spatialReference):null}function qye(t){return"heightModelInfo"in t}function Wye(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Yye(t){return Wye(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):Xye(t)}function Vze(t){return t.layers!=null||Xye(t)||Wye(t)||qye(t)}function Xye(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(lc||(lc={}));const Gze=new hx({heightModel:"gravity-related-height"});function qRt(t,e){return{...Zye(t,e),readResourcePaths:[]}}function Zte(t,e,i){const r=Hs(t.itemUrl);return{...Zye(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function Zye(t,e){return{origin:e,url:Hs(t.itemUrl),portal:t.portal||Ea.getDefault(),portalItem:t}}async function jze(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return FA(t);const i=We.WGS84;return await i$(e,i),bv(t,i)}function Hze(t,e){if(!Jye(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function Jye(t,e){return!!t.typeKeywords?.includes(e)}function WRt(t){return Jye(t,g8.HOSTED_SERVICE)}function qze(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Jte(t,e,i){i?Hze(t,e):qze(t,e)}async function YRt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return jze(i)}const g8={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function XRt(t){const{portal:e,isOrgItem:i,itemControl:r}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!s?.includes("features:user:fullEdit");const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}let Dy=class extends Me{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([m({type:String,json:{write:!0}})],Dy.prototype,"facilityIdField",void 0),d([m({type:String,json:{write:!0}})],Dy.prototype,"layerId",void 0),d([m({type:String,json:{write:!0}})],Dy.prototype,"nameField",void 0),d([m({type:String,json:{write:!0}})],Dy.prototype,"siteIdField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Dy.prototype,"sublayerId",void 0),Dy=d([U("esri.layers.support.FacilityLayerInfo")],Dy);const Wze=Dy;let fd=class extends Me{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};d([m({type:String,json:{write:!0}})],fd.prototype,"facilityIdField",void 0),d([m({type:String,json:{write:!0}})],fd.prototype,"layerId",void 0),d([m({type:String,json:{write:!0}})],fd.prototype,"levelIdField",void 0),d([m({type:String,json:{write:!0}})],fd.prototype,"levelNumberField",void 0),d([m({type:String,json:{write:!0}})],fd.prototype,"longNameField",void 0),d([m({type:String,json:{write:!0}})],fd.prototype,"shortNameField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],fd.prototype,"sublayerId",void 0),d([m({type:String,json:{write:!0}})],fd.prototype,"verticalOrderField",void 0),fd=d([U("esri.layers.support.LevelLayerInfo")],fd);const Yze=fd;let G1=class extends Me{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([m({type:String,json:{write:!0}})],G1.prototype,"layerId",void 0),d([m({type:String,json:{write:!0}})],G1.prototype,"nameField",void 0),d([m({type:String,json:{write:!0}})],G1.prototype,"siteIdField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],G1.prototype,"sublayerId",void 0),G1=d([U("esri.layers.support.SiteLayerInfo")],G1);const Xze=G1;let qT=class extends Me{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};d([m({type:Yze,json:{write:!0}})],qT.prototype,"levelLayer",void 0),d([m({type:Wze,json:{write:!0}})],qT.prototype,"facilityLayer",void 0),d([m({type:Xze,json:{write:!0}})],qT.prototype,"siteLayer",void 0),qT=d([U("esri.support.MapFloorInfo")],qT);const Zze=qT,Jze=Symbol("WebScene"),Qze="webscene:failed-to-copy-embedded-resources",Kze="webscene:schema-validation";function eBe(){return new W(Qze,"Copying of embedded resources is currently not supported")}function tBe(t){return new W(Kze,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var Ne;function Qte(t){return t==="global"?Ne.Global:Ne.Local}function gB(t){return t===Ne.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ne||(Ne={}));function YO(t,e){return t!=null&&(e==null||(e===Ne.Local?!t.isGeographic||t.isWGS84||t.wkid===bc.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===bc.CGCS2000||t.wkid===bc.GCSMARS2000||t.wkid===bc.GCSMARS2000_SPHERE||t.wkid===bc.GCSMOON2000))}var RS;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(RS||(RS={}));var y8;let uf=y8=class extends Me{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new y8(ge({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};d([m({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],uf.prototype,"enabled",void 0),d([m({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],uf.prototype,"longNames",void 0),d([m({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],uf.prototype,"minimized",void 0),d([m({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],uf.prototype,"pinnedLevels",void 0),d([m({type:String,json:{read:{source:"site"},write:{target:"site"}}})],uf.prototype,"site",void 0),d([m({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],uf.prototype,"facility",void 0),d([m({type:String,json:{read:{source:"level"},write:{target:"level"}}})],uf.prototype,"level",void 0),uf=y8=d([U("esri.webdoc.widgets.FloorFilter")],uf);const iBe=uf;var _8;const y3=new Do({slider:"slider",picker:"picker"});let WT=_8=class extends Me{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new _8({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};d([m({type:y3.apiValues,nonNullable:!0,json:{type:y3.jsonValues,default:null,read:{reader:y3.read},write:{isRequired:!0,writer:y3.write}}})],WT.prototype,"interactionMode",void 0),d([m({type:Rr,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],WT.prototype,"numStops",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],WT.prototype,"stopInterval",void 0),WT=_8=d([U("esri.webdoc.widgets.Range")],WT);const rBe=WT,Qye=rl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let dM=class extends Ic(Me){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return fye(this.value,this.unit,"milliseconds")}};d([At(Qye,{nonNullable:!0})],dM.prototype,"unit",void 0),d([m({type:Number,json:{write:!0},nonNullable:!0})],dM.prototype,"value",void 0),dM=d([U("esri.TimeInterval")],dM);const Kye=dM;var v8;let Co=v8=class extends Me{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){if(!t)return;const e=t[0]!=null?new Date(t[0]):null,i=t[1]!=null?new Date(t[1]):null;return new rp({start:e,end:i})}writeCurrentTimeExtent(t,e,i){t&&Xf(i,[t.start!=null?t.start.getTime():null,t.end!=null?t.end.getTime():null],e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new rp({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?Kye.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);Xf("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t?.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t?.length&&Xf(i,t.map(r=>r.getTime()),e)}clone(){return new v8(ge({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};d([m({type:rp,json:{type:[[Rr,NR]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],Co.prototype,"currentTimeExtent",void 0),d([_i("currentTimeExtent")],Co.prototype,"readCurrentTimeExtent",null),d([Ut("currentTimeExtent")],Co.prototype,"writeCurrentTimeExtent",null),d([m({type:rp,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],Co.prototype,"fullTimeExtent",void 0),d([_i("fullTimeExtent")],Co.prototype,"readFullTimeExtent",null),d([Ut("fullTimeExtent")],Co.prototype,"writeFullTimeExtent",null),d([m({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],Co.prototype,"loop",void 0),d([m({type:Rr,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const t=!!this.stopInterval,e=!!this.stops?.length,i=!(t||e);return{enabled:i,isRequired:i}}}}})],Co.prototype,"numStops",void 0),d([m({type:[1,2],nonNullable:!0,json:{type:Rr,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],Co.prototype,"numThumbs",void 0),d([m({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],Co.prototype,"stopDelay",void 0),d([m({type:Kye,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Qye.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){const t=this.numStops!=null,e=!!this.stops?.length;return{enabled:!e,isRequired:!(t||e)}}}}})],Co.prototype,"stopInterval",void 0),d([_i("stopInterval")],Co.prototype,"readStopInterval",null),d([Ut("stopInterval")],Co.prototype,"writeStopInterval",null),d([m({type:[Date],json:{type:[Rr],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],Co.prototype,"stops",void 0),d([_i("stops")],Co.prototype,"readStops",null),d([Ut("stops")],Co.prototype,"writeStops",null),Co=v8=d([U("esri.webdoc.widgets.TimeSlider")],Co);const sBe=Co;var b8;let YT=b8=class extends Me{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new b8(ge({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};d([m({type:rBe,json:{write:!0}})],YT.prototype,"range",void 0),d([m({type:sBe,json:{write:!0}})],YT.prototype,"timeSlider",void 0),d([m({type:iBe,json:{write:!0}})],YT.prototype,"floorFilter",void 0),YT=b8=d([U("esri.webdoc.Widgets")],YT);const nBe=YT,oBe="randomUUID"in crypto;function Zk(){if(oBe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function t$t(){return`{${Zk().toUpperCase()}}`}function i$t(){return`{${Zk()}}`}async function aBe(t,e={},i){await t.load(i);const r=vm(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i?.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:h,resource:p})=>({created:new Date(u),size:h,resource:t.resourceFromPath(p)}))}}async function lBe(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new W(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[u,h]=e_e(o.path),p=`${u}/${l??""}/${c??""}`;s.has(p)||s.set(p,{prefix:u,compress:l,access:c,files:[]}),s.get(p).files.push({fileName:h,content:a})}await t.load(r);const n=vm(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let h=0;h<c.length;h+=25){const p=c.slice(h,h+25),f=new FormData;o&&o!=="."&&f.append("resourcesPrefix",o),a&&f.append("compress","true"),l&&f.append("access",l);let g=0;for(const{fileName:_,content:v}of p)f.append("file"+ ++g,v,_);f.append("f","json"),await t.portal.request(n,{method:"post",body:f,signal:r?.signal})}}async function cBe(t,e,i){if(!e.hasPath())throw new W("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=vm(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function uBe(t,e){await t.load(e);const i=vm(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function e_e(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function $X(t){const[e,i]=hBe(t),[r,s]=e_e(e);return[r,s,i]}function hBe(t){const e=MIe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function DD(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Yi(t.url,{responseType:"blob"})).data}function dBe(t,e){if(!t.hasPath())return null;const[i,,r]=$X(t.path);return t.portalItem.resourceFromPath(vm(i,e+r))}function t_e(t,e){if(!t.hasPath())return null;const[i,,r]=$X(t.path);return t.portalItem.resourceFromPath(vm(i,e+r))}const $S=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:lBe,contentToBlob:DD,fetchResources:aBe,getSiblingOfSameType:dBe,getSiblingOfSameTypeI:t_e,removeAllResources:uBe,removeResource:cBe,splitPrefixFileNameAndExtension:$X},Symbol.toStringTag,{value:"Module"}));async function pBe(t,e,i){const r=await i_e(t,e,i);await r_e(r,e,i)}async function fBe(t,e,i,r,s){const n=await i_e(i,r,s);await t.update({data:e}),await r_e(n,r,s)}async function i_e(t,e,i){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(h=>h.resource.path)),n=new Set,o=[];s.forEach(h=>{r.delete(h),t.paths.push(h)});const a=[],l=[],c=[];for(const h of e.resources.toUpdate)if(r.delete(h.resource.path),s.has(h.resource.path)||n.has(h.resource.path)){const{resource:p,content:f,finish:g}=h,_=t_e(p,Zk());t.paths.push(_.path),a.push({resource:_,content:await DD(f),compress:h.compress}),g&&c.push(()=>g(_))}else{t.paths.push(h.resource.path),l.push({resource:h.resource,content:await DD(h.content),compress:h.compress});const p=h.finish;p&&c.push(()=>p(h.resource)),n.add(h.resource.path)}for(const h of e.resources.toAdd)if(t.paths.push(h.resource.path),r.has(h.resource.path))r.delete(h.resource.path);else{a.push({resource:h.resource,content:await DD(h.content),compress:h.compress});const p=h.finish;p&&c.push(()=>p(h.resource))}if(a.length||l.length){const{addOrUpdateResources:h}=await ue(()=>Promise.resolve().then(()=>$S),void 0,import.meta.url);await h(e.portalItem,a,"add",i),await h(e.portalItem,l,"update",i)}if(c.forEach(h=>h()),o.length===0)return r;const u=await u3e(o);if(yt(i),u.length>0)throw new W("save:resources","Failed to save one or more resources",{errors:u});return r}async function r_e(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await ok(r)}function Kte(t){if(Gi.apiKey&&mY(t.portal.url))throw new W("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}async function r$t(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const mBe=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function gBe(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new W(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new W("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(mBe.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new W(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const yBe={width:600,height:400},_3=1.5;function _Be(t,e){e=e||yBe;let{width:i,height:r}=e;const s=i/r;return s<_3?r=i/_3:s>_3&&(i=r*_3),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function eie(t){return{enabled:!!t?.length}}const IX=new Do({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var w8;let XT=w8=class extends Me{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new w8({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([m({type:Boolean,json:{write:!0}})],XT.prototype,"exactMatch",void 0),d([m({type:String,json:{write:!0}})],XT.prototype,"name",void 0),d([At(IX)],XT.prototype,"type",void 0),XT=w8=d([U("esri.webdoc.applicationProperties.SearchLayerField")],XT);const vBe=XT;var x8;let ZT=x8=class extends Me{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new x8(ge({field:this.field,id:this.id,subLayer:this.subLayer}))}};d([m({type:vBe,json:{write:{isRequired:!0}}})],ZT.prototype,"field",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],ZT.prototype,"id",void 0),d([m({type:Rr,json:{write:!0}})],ZT.prototype,"subLayer",void 0),ZT=x8=d([U("esri.webdoc.applicationProperties.SearchLayer")],ZT);const bBe=ZT;var T8;let JT=T8=class extends Me{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new T8({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([m({type:Boolean,json:{write:!0}})],JT.prototype,"exactMatch",void 0),d([m({type:String,json:{write:!0}})],JT.prototype,"name",void 0),d([At(IX)],JT.prototype,"type",void 0),JT=T8=d([U("esri.webdoc.applicationProperties.SearchTableField")],JT);const wBe=JT;var S8;let pM=S8=class extends Me{constructor(t){super(t),this.field=null,this.id=null}clone(){return new S8(ge({field:this.field,id:this.id}))}};d([m({type:wBe,json:{write:{isRequired:!0}}})],pM.prototype,"field",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],pM.prototype,"id",void 0),pM=S8=d([U("esri.webdoc.applicationProperties.SearchTable")],pM);const xBe=pM;var C8;const s_e=lt.ofType(bBe),n_e=lt.ofType(xBe);let hf=C8=class extends Me{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new s_e,this.tables=new n_e}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new C8(ge({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};d([m({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],hf.prototype,"addressSearchEnabled",void 0),d([_i("addressSearchEnabled")],hf.prototype,"readAddressSearchEnabled",null),d([Ut("addressSearchEnabled")],hf.prototype,"writeAddressSearchEnabled",null),d([m({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],hf.prototype,"enabled",void 0),d([m({type:String,json:{write:!0}})],hf.prototype,"hintText",void 0),d([m({type:s_e,json:{write:{overridePolicy:eie},origins:{"web-scene":{write:{isRequired:!0}}}}})],hf.prototype,"layers",void 0),d([m({type:n_e,json:{read:!0,write:{overridePolicy:eie}}})],hf.prototype,"tables",void 0),hf=C8=d([U("esri.webdoc.applicationProperties.Search")],hf);const TBe=hf;var E8;let ND=E8=class extends Me{constructor(t){super(t),this.search=null}clone(){return new E8(ge({search:this.search}))}};d([m({type:TBe,json:{write:!0}})],ND.prototype,"search",void 0),ND=E8=d([U("esri.webdoc.applicationProperties.Viewing")],ND);const SBe=ND;var A8;let FD=A8=class extends Me{constructor(t){super(t),this.viewing=null}clone(){return new A8({viewing:this.viewing?.clone()??null})}};d([m({type:SBe,json:{write:!0}})],FD.prototype,"viewing",void 0),FD=A8=d([U("esri.webscene.ApplicationProperties")],FD);const CBe=FD;var M8;let fM=M8=class extends Me{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new M8({cloudCover:this.cloudCover})}};d([At({sunny:"sunny"})],fM.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],fM.prototype,"cloudCover",void 0),fM=M8=d([U("esri.views.3d.environment.SunnyWeather")],fM);const n4=fM;var P8;let mM=P8=class extends Me{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new P8({cloudCover:this.cloudCover})}};d([At({cloudy:"cloudy"})],mM.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],mM.prototype,"cloudCover",void 0),mM=P8=d([U("esri.views.3d.environment.CloudyWeather")],mM);const EBe=mM;var O8;let gM=O8=class extends Me{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new O8({fogStrength:this.fogStrength})}};d([At({foggy:"foggy"})],gM.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],gM.prototype,"fogStrength",void 0),gM=O8=d([U("esri.views.3d.environment.FoggyWeather")],gM);const ABe=gM;var R8;let QT=R8=class extends Me{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new R8({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([At({rainy:"rainy"})],QT.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],QT.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],QT.prototype,"precipitation",void 0),QT=R8=d([U("esri.views.3d.environment.RainyWeather")],QT);const MBe=QT;var $8;let j1=$8=class extends Me{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new $8({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([At({snowy:"snowy"})],j1.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],j1.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],j1.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],j1.prototype,"snowCover",void 0),j1=$8=d([U("esri.views.3d.environment.SnowyWeather")],j1);const PBe=j1,LX={key:"type",base:n4,typeMap:{sunny:n4,cloudy:EBe,rainy:MBe,snowy:PBe,foggy:ABe}},OBe=Object.keys(LX.typeMap);function RBe(t,e){return!!OBe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Lg=1e4,$Be=1e5;var I8;let Xu=I8=class extends Me{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new I8(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([m({readOnly:!0,type:["sun"],json:{write:!0}})],Xu.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],Xu.prototype,"date",void 0),d([_i("date",["datetime"])],Xu.prototype,"readDate",null),d([Ut("date")],Xu.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Xu.prototype,"directShadowsEnabled",void 0),d([_i("directShadowsEnabled",["directShadows"])],Xu.prototype,"readDirectShadowsEnabled",null),d([Ut("directShadowsEnabled")],Xu.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],Xu.prototype,"displayUTCOffset",void 0),d([Ut("displayUTCOffset")],Xu.prototype,"writeDisplayUTCOffset",null),Xu=I8=d([U("esri.webscene.SunLighting")],Xu);const Fw=Xu;var L8;let yM=L8=class extends Me{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new L8(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([m({readOnly:!0,type:["virtual"],json:{write:!0}})],yM.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],yM.prototype,"directShadowsEnabled",void 0),yM=L8=d([U("esri.webscene.VirtualLighting")],yM);const r$=yM,o_e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Fw,virtual:r$}};let kD=class extends Me{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};d([m({readOnly:!0,json:{read:!1}})],kD.prototype,"type",void 0),kD=d([U("esri.webscene.background.Background")],kD);const a_e=kD;var D8;const IBe={...C0,nonNullable:!0};let _M=D8=class extends a_e{constructor(t){super(t),this.type="color",this.color=new et([0,0,0,1])}clone(){return new D8(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([At({color:"color"},{readOnly:!0})],_M.prototype,"type",void 0),d([m(IBe)],_M.prototype,"color",void 0),_M=D8=d([U("esri.webscene.background.ColorBackground")],_M);const l_e=_M,tie={base:a_e,key:"type",typeMap:{color:l_e}};function LBe(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const DBe={types:tie,json:{read:LBe(tie),write:{overridePolicy:(t,e,i)=>({enabled:!i?.isPresentation})}}};var N8;const iie=(t,e,i)=>({enabled:!i?.isPresentation});let Ny=N8=class extends Me{constructor(t){super(t),this.lighting=new Fw,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){RBe(t?.type,le.getLogger(this))&&this._set("weather",t)}clone(){return new N8(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?r$.prototype.clone.call(this.lighting):Fw.prototype.clone.call(this.lighting),background:ge(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([m({types:o_e,nonNullable:!0,json:{write:!0}})],Ny.prototype,"lighting",void 0),d([m(DBe)],Ny.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:iie}}})],Ny.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:iie}}})],Ny.prototype,"starsEnabled",void 0),d([m({types:LX,nonNullable:!0,json:{write:!0},value:new n4})],Ny.prototype,"weather",null),Ny=N8=d([U("esri.webscene.Environment")],Ny);const uC=Ny,c_e={type:rp,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?rp.fromArray(t):rp.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r?.messages&&r.messages.push(new W("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[Rr,NR]]}}}}};var F8;let Fy=F8=class extends Me{constructor(t){super(t),this.environment=new uC,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new F8({environment:this.environment.clone(),spatialReference:this.spatialReference?.clone()??null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?.clone()??null,timeExtent:this.timeExtent?.clone()??null})}};d([m({type:uC,json:{write:{isRequired:!0}}})],Fy.prototype,"environment",void 0),d([m({type:We})],Fy.prototype,"spatialReference",void 0),d([m({type:["local","global"]})],Fy.prototype,"viewingMode",null),d([m({type:mp,json:{write:{isRequired:!0}}})],Fy.prototype,"viewpoint",void 0),d([m(c_e)],Fy.prototype,"timeExtent",void 0),Fy=F8=d([U("esri.webscene.InitialViewProperties")],Fy);const o4=Fy;let NBe=class{constructor(e,i){this._observable=new YR,this._value=e,this._equalityFunction=i}get value(){return Ot(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Jf(t,e=Yde){return new NBe(t,e)}const $o=Symbol("Yield");let FBe=class{constructor(){this._tasks=new Array,this._runningTasks=Jf(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return $o;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new rie(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new rie(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const r=qn(i.signal);if(r&&!i.abortCallback)i.reject(vi());else{const s=r?i.abortCallback?.(vi()):i.callback(e);$c(s)?s.then(i.resolve,i.reject):i.resolve(s)}}catch(r){i.reject(r)}return!0}cancelAll(){const e=vi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},rie=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},vM=class extends Pe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],vM.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],vM.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),vM=d([U("esri.views.support.debugFlags")],vM);const kBe=new vM;var gi;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(gi||(gi={}));function UBe(){return new a4.Scheduler}var wt;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(wt||(wt={}));const Ef=0,sie=new Map([[wt.RESOURCE_CONTROLLER_IMMEDIATE,Ef],[wt.RESOURCE_CONTROLLER,4],[wt.SLIDE,Ef],[wt.STREAM_DATA_LOADER,Ef],[wt.ELEVATION_QUERY,Ef],[wt.TERRAIN_SURFACE,1],[wt.SURFACE_GEOMETRY_UPDATES,1],[wt.LOD_RENDERER,2],[wt.GRAPHICS_CORE,2],[wt.I3S_CONTROLLER,2],[wt.POINT_CLOUD_LAYER,2],[wt.FEATURE_TILE_FETCHER,2],[wt.OVERLAY,4],[wt.STAGE,4],[wt.GRAPHICS_DECONFLICTOR,4],[wt.FILTER_VISIBILITY,4],[wt.SCALE_VISIBILITY,4],[wt.FRUSTUM_VISIBILITY,4],[wt.CLOUDS_GENERATOR,4],[wt.POINT_OF_INTEREST_FREQUENT,6],[wt.POINT_OF_INTEREST_INFREQUENT,30],[wt.LABELER,8],[wt.FEATURE_QUERY_ENGINE,8],[wt.FEATURE_TILE_TREE,16],[wt.FEATURE_TILE_TREE_ACTIVE,Ef],[wt.ELEVATION_ALIGNMENT,12],[wt.ELEVATION_ALIGNMENT_SCENE,14],[wt.TEXT_TEXTURE_ATLAS,12],[wt.TEXTURE_UNLOAD,12],[wt.LINE_OF_SIGHT_TOOL,16],[wt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Ef],[wt.SNAPPING,Ef],[wt.SHADOW_ACCUMULATOR,30]]);function nie(t){return sie.has(t)?sie.get(t):typeof t=="number"?t:1}const zBe=6.5,oie=1,BBe=30,VBe=1e3/30,GBe=100,aie=.9;var a4,Bv;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=Jf(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Gg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=gi.INTERACTING,this._tasks=new Gt,this._runQueue=new Gt,this._load=0,this._idleStateCallbacks=new Gt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=he(()=>kBe.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,Ki);for(const n of Object.keys(wt))this.performanceInfo.tasks.set(wt[n],new Gg(wt[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),gr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Gg(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===gi.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===gi.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==gi.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let o=zBe,a=n.frameDuration,l=oie;switch(this.state){case gi.IDLE:o=0,a=Math.max(GBe,n.frameDuration),l=BBe;break;case gi.INTERACTING:a=Math.max(VBe,n.frameDuration);case gi.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==gi.IDLE&&a<oie&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case gi.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case gi.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Bv.SCHEDULED;let o=Bv.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Bv.READY:o!==Bv.READY&&(o=Bv.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*aie+n*(1-aie)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Ef&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Ef&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===$o&&(a.blockFrame=this._frameNumber)}catch(c){le.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,wt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(wt))this._frameTaskTimes.set(wt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new FBe,this._handles=new _m,this._basePriority=nie(o),this.schedulePriority=this._basePriority,this._task=Jf(a??this._queue),this._handles.add(zl(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(wc),this._scheduler.removeTask(this),this.schedule=hC.schedule,this.reschedule=hC.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=nie(n);this._basePriority!==Ef&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=gi.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(a4||(a4={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Bv||(Bv={}));const wc=(()=>{const t=new a4.Budget;return t.enabled=!1,t})();let jBe=class{remove(){}processQueue(){}schedule(e,i,r){try{if(qn(i)){const s=vi();return r?Promise.resolve(r(s)):Promise.reject(s)}return nj(e(wc))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const hC=new jBe;function HBe(t){return!!t&&/^https:\/\/.*/i.test(t)}function qBe(t){return!!t&&/data:([-\w]+\/[-+\w.]+)?(;?\w+=[-\w]+)*(;base64)?,.*/gu.test(t)}var k8;let Bd=k8=class extends Me{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return HBe(this.url)}get isDataURI(){return qBe(this.url)}clone(){return new k8({url:this.url})}};d([m({type:String,json:{write:{isRequired:!0}}})],Bd.prototype,"url",void 0),d([m()],Bd.prototype,"isSecureUrl",null),d([m()],Bd.prototype,"isDataURI",null),Bd=k8=d([U("esri.webdoc.support.SlideThumbnail")],Bd);var U8;let UD=U8=class extends Me{constructor(){super(...arguments),this.text=""}clone(){return new U8({text:this.text})}};d([m({type:String,json:{write:!0}})],UD.prototype,"text",void 0),UD=U8=d([U("esri.webscene.support.Description")],UD);const zD=UD;var z8;let IS=z8=class extends Me{constructor(){super(...arguments),this.lighting=new Fw,this.weather=new n4}clone(){return new z8({lighting:ge(this.lighting),weather:ge(this.weather)})}};d([m({types:o_e,json:{write:!0}})],IS.prototype,"lighting",void 0),d([m({types:LX,json:{write:!0}})],IS.prototype,"weather",void 0),IS=z8=d([U("esri.webscene.Environment")],IS);var BD;let VD=BD=class extends Me{constructor(){super(...arguments),this.opacity=null}clone(){return new BD({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new HO).opacity=this.opacity),t}static fromGround(t){return new BD({opacity:t.opacity})}};d([m({type:Number,json:{type:Rr,read:{reader:KY,source:"transparency"},write:{writer:(t,e)=>{e.transparency=QY(t)},target:"transparency"}}})],VD.prototype,"opacity",void 0),VD=BD=d([U("esri.webscene.support.SlideGround")],VD);const u_e=VD;var B8;let LS=B8=class extends Me{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new B8({id:this.id,sublayerIds:ge(this.sublayerIds)})}};d([m({type:String,json:{write:!0}})],LS.prototype,"id",void 0),d([m({type:[Rr],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],LS.prototype,"sublayerIds",void 0),LS=B8=d([U("esri.webscene.support.SlideVisibleLayer")],LS);var V8;let GD=V8=class extends Me{constructor(){super(...arguments),this.text=""}clone(){return new V8({text:this.text})}};d([m({type:String,json:{write:{isRequired:!0}}})],GD.prototype,"text",void 0),GD=V8=d([U("esri.webscene.support.Title")],GD);const WP=GD;let WBe=0;const G8=lt.ofType(LS);let Eo=class extends Me{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+WBe++,this.title=new WP,this.description=new zD,this.hidden=!1,this.thumbnail=new Bd,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new IS,this.timeExtent=null,this.visibleLayers=new G8}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=Oe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new WP({text:e}):mo(WP,e)}castDescription(e){return typeof e=="string"?new zD({text:e}):mo(zD,e)}castThumbnail(e){return typeof e=="string"?new Bd({url:e}):mo(Bd,e)}castBasemap(e){return TX(e)}set visibleLayers(e){this._set("visibleLayers",dm(e,this._get("visibleLayers"),G8))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof SX){const r=lie(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(le.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap?.clone()||null,ground:this.ground?.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden,timeExtent:this.timeExtent?.clone()??null})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(s=>{if(s.visible){const n=lie(r);i.push(new LS({id:s.layer.id,sublayerIds:n}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?r$.prototype.clone.apply(e.environment.lighting):Fw.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?u_e.fromGround(e.map.ground):null,this.timeExtent=e.timeExtent?.clone()??null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(s=>(this.thumbnail=new Bd({url:s.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const s=zR(i,()=>r?.abort()),n=()=>{this._applyToController===r&&(this._applyToController=null),r=null,s?.remove()};try{await iC(()=>e.ready,r.signal)}catch(h){throw n(),h}if(r.signal.aborted)throw n(),vi();const o=e.resourceController.scheduler.registerTask(wt.SLIDE);let a=!1;const l={animate:!0,...i,signal:this._applyToController.signal},c=async()=>{await Promise.all([o.schedule(async()=>a=await this._setViewpointOfInterest(e,l)),o.schedule(()=>this._applyBasemap(e,l),l.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([o.schedule(()=>this._applyLayerVisibility(e),l.signal),o.schedule(()=>this._applyGround(e),l.signal),o.schedule(()=>this._applyViewpoint(e,l),l.signal),o.schedule(()=>e.timeExtent=this.timeExtent?.clone()??null,l.signal)]),await o.schedule(()=>e.environment.weather=this.environment.weather.clone())},u=await fp(e.addUpdatingPromise(c()));if(a&&(e.contentCamera=null),o.remove(),n(),u.ok===!1)throw u.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(sn(r))throw r}e.map.basemap=YUe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new lt;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(s=>s.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const s=r?.sublayerIds,n=h_e(i);s&&n&&n.forEach(o=>o.visible=s.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await ue(()=>Promise.resolve().then(()=>rtt),void 0,import.meta.url),s=await r(e,this.viewpoint);return e.contentCamera=s,s!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(s=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),s}).finally(()=>{gr(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const s=new Date(i.date.toString()),[n,o]=this._getTime(s),[a,l]=this._getTime(r.date),c=XBe(o,l),u=e.renderCoordsHelper,h=C();u.toRenderCoords(e.camera.position,h);const p=C(),f=C();this.viewpoint.camera!=null&&u.toRenderCoords(this.viewpoint.camera.position,p);const g=new Date;return zl(()=>e.camera,_=>{u.toRenderCoords(_.position,f);const v=Wn(h,f),b=Wn(p,f);let w=0;v+b!==0&&(w=v/(v+b));const T=n+(a-n)*w,S=ZBe(o,c*w);i.date=this._setTime(g,T,S)})}static createFrom(e,i){return new this().updateFrom(e,i)}};d([m({type:String,json:{write:{isRequired:!0}}})],Eo.prototype,"id",void 0),d([m({type:WP,json:{default:()=>new WP({text:""}),write:{isRequired:!0}}})],Eo.prototype,"title",void 0),d([cr("title")],Eo.prototype,"castTitle",null),d([m({type:zD,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Eo.prototype,"description",void 0),d([cr("description")],Eo.prototype,"castDescription",null),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Eo.prototype,"hidden",void 0),d([m({type:Bd,json:{default:()=>new Bd({url:""}),write:{isRequired:!0}}})],Eo.prototype,"thumbnail",void 0),d([cr("thumbnail")],Eo.prototype,"castThumbnail",null),d([m({type:mp,nonNullable:!0,json:{write:{isRequired:!0}}})],Eo.prototype,"viewpoint",void 0),d([m({type:p2,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Eo.prototype,"basemap",void 0),d([cr("basemap")],Eo.prototype,"castBasemap",null),d([m({type:u_e,json:{write:!0}})],Eo.prototype,"ground",void 0),d([m({type:G8,json:{write:{isRequired:!0}}})],Eo.prototype,"visibleLayers",null),d([cr("visibleLayers")],Eo.prototype,"castVisibleLayers",null),d([m({type:IS,json:{write:!0}})],Eo.prototype,"environment",void 0),d([m(c_e)],Eo.prototype,"timeExtent",void 0),Eo=d([U("esri.webscene.Slide")],Eo);const YBe=Eo;function h_e(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function lie(t){const e=h_e(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const j8=86400,cie=43200;function XBe(t,e){let i=e-t;return i>cie&&(i-=j8),i<-cie&&(i+=j8),i}function ZBe(t,e){return EDe(t+e,j8)}const H8=lt.ofType(YBe);let jD=class extends Me{constructor(e){super(e),this.slides=new H8}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",dm(e,this._get("slides"),H8))}clone(){return new this.constructor({slides:this.slides.clone()})}};d([m({type:H8,nonNullable:!0,json:{write:!0}}),cr(cX)],jD.prototype,"slides",null),jD=d([U("esri.webscene.Presentation")],jD);const d_e=jD;var q8;let KT=q8=class extends Me{constructor(t){super(t)}clone(){return new q8({name:this.name,path:this.path,title:this.title})}};d([m({type:String,json:{write:!0}})],KT.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],KT.prototype,"path",void 0),d([m({type:String,json:{write:!0}})],KT.prototype,"title",void 0),KT=q8=d([U("esri.webscene.TransportationNetwork")],KT);const JBe=KT;let s$=class W8{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new W(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new W8(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r?.match||!n.test(r))throw new W((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s?.match||!n.test(s))throw new W((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new W8(o,a,i)}},l4=class extends s${constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},QBe=null;function KBe(){return QBe}var p_e;const aw=new l4(1,34),eVe=()=>{const e=[],i=aw.major;for(let r=8;r<=aw.minor;r++)e.push(`${i}.${r}`);return e},yB="Web Scene";let dr=class extends pm.LoadableMixin(e$(bye(gye))){constructor(e){super(e),this[p_e]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new d_e,this.initialViewProperties=new o4,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=Mpe(async(i,r,s)=>{switch(i){case RS.SAVE:return this._saveImpl(r);case RS.SAVE_AS:return this._saveAsImpl(s,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{le.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(yo(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Oe(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,s){i[r]=this._layersToJSON(e,"operational-layers",s)}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new l4(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${aw.major}.${aw.minor}`}writeTables(e,i,r,s){const n=this._layersToJSON(e,"tables",s);n.length&&(i[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=ofe}writeGround(e,i,r,s){i[r]=e?e.write({},s):{transparency:0,layers:[]}}readInitialViewProperties(e,i){const r={};i.initialState?.environment&&(r.environment=uC.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?We.fromJSON(i.spatialReference):We.WebMercator,r.viewingMode=i.viewingMode??"global",i.initialState?.viewpoint&&(r.viewpoint=mp.fromJSON(i.initialState.viewpoint));const s=i.initialState?.timeExtent;return s!=null&&(r.timeExtent=rp.fromArray(s)),new o4(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??We.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return bX(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if(Y3e(this,e,n=>super.read(e,n),i),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const n=e.baseMap.elevationLayers.map(c=>({id:c.id})),o=this.presentation.slides,a=(c,u)=>c.visibleLayers.some(h=>h.id===u),l=n.filter(c=>!o.some(u=>a(u,c.id)));o.forEach(c=>{c.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ge(i))}_layersToJSON(e,i,r){const s={...r,layerContainerType:i};return e.map(n=>this._verifyWritableLayer(n,r)?n.write({},s):null).filter(n=>!!n).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages&&i.messages.push(new W("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const n=new W("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw le.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),n}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const s=super.write(e,i);if(r){const n=i.messages?.filter(o=>o.name==="web-document-write:property-required")??[];if(n.length){const o=new W("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:n});throw le.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",n),o}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(RS.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new W("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(Kte(this.portalItem),this.portalItem?.type!==yB)throw new W("webscene:portal-item-wrong-type",`Portal item needs to have type "${yB}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(Zte(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,e),this._updateTypeKeywords(this.portalItem),await fBe(this.portalItem,s,this._resourceReferences,r),Hte(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(RS.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=kk.from(e);if(!r)throw new W("webscene:portal-item-required","saveAs requires a portal item to save to");Kte(r),r.id&&(r=r.clone(),r.id=null);const s=r.portal||Ea.getDefault();await this._ensureLoadBeforeSave(),r.type=yB,r.portal=s;const n=this._enableVerifyItemRelativeUrls(Zte(r,"web-scene",!0)),o=this.write({},n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(o,n,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await s.signIn(),!s.user)throw new W("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await s.user.addItem({item:r,folder:i?.folder,data:o}),await pBe(this._resourceReferences,n),this.portalItem=r,l8.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?Hs(r.itemUrl):void 0}),Hte(n),a&&(this.thumbnailUrl=l?ife(a,"w","8192"):a),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,s=!1){if(!Sw(this.spatialReference))throw new W("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:n,requiredPropertyChecksDisabled:o,strictSchemaValidationEnabled:a}=r||{};gBe(i,{errorName:"webscene:save"},{ignoreUnsupported:n,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:o});const l=KBe();if(a&&l){const c=(await l()).validate(e);if(!c.length)return;const u=`webscene did not validate:
${c.join(`
`)}`;le.getLogger(this).error(`${s?"saveAs":"save"}(): ${u}`);const h=c.map(p=>new W("webscene:schema-validation",p));throw tBe(h)}}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(eBe()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(e.verifyItemRelativeUrls?.writtenUrls?.length??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=uC.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const s="visible";s in r&&s in r.layer&&r._isOverridden(s)&&(r.layer[s]=r[s])}if(!i.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=_Be(e,i),s=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=s.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)i.push(n);const r=[],s=n=>(n.layers&&(n.layers=n.layers.filter(s)),n.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(n),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){const r=new lt;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:s}=await ue(()=>import("./layersCreator-235289ec.js"),["./layersCreator-235289ec.js","./portalLayers-74558c37.js","./associatedFeatureServiceUtils-379c9e31.js","./fetchService-e12ac4b2.js","./styleUtils-f3879cce.js"],import.meta.url),{operationalLayers:n,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||Ea.getDefault()),a.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(this.ground.layers,a,u))}if(o.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(r,o,u))}n&&n.length>0&&l.push(s(this.layers,n,c)),e.tables?.length&&l.push(s(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter(u=>u.type==="base-elevation"||u.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const s=r.beforeSave();s&&e.push(s)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(s=>{throw new W("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new W("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:Hs(e.itemUrl),portal:e.portal||Ea.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!YO(i,Ne.Global))return Promise.reject(new W("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Vl(l,i)}else{if(!YO(i,Ne.Local))return Promise.reject(new W("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const s=l=>l?.camera?.position.spatialReference??l?.targetGeometry?.spatialReference,n=e.viewpoint,o=s(n);if(o&&!r(o))return Promise.reject(new W("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(s(l.viewpoint)));if(a){const l=s(a.viewpoint);return Promise.reject(new W("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=Uze(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=l4.parse(e.version||"","webscene");return aw.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=We.WebMercator.toJSON()),e}_updateTypeKeywords(e){Jte(e,g8.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),Jte(e,g8.DEVELOPER_BASEMAP,Nte(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&Nte(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||We.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?Hs(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=s=>this.allLayers.some(n=>n.id===s&&n.persistenceEnabled);e?.layers&&(e.layers=e.layers.filter(s=>i(s.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(s=>{s.visibleLayers&&(s.visibleLayers=s.visibleLayers.filter(n=>i(n.id)))})}static fromJSON(e){if(!e)throw new W("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};p_e=Jze,dr.version=`${aw.major}.${aw.minor}`,d([m({type:CBe,json:{write:!0}})],dr.prototype,"applicationProperties",void 0),d([m({type:Qi,json:{read:{source:"clippingArea.geometry",reader:$w},write:{target:"clippingArea.geometry"}}})],dr.prototype,"clippingArea",void 0),d([Ut("clippingArea")],dr.prototype,"writeClippingArea",null),d([m({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],dr.prototype,"clippingEnabled",void 0),d([_i("clippingEnabled",["clippingArea"])],dr.prototype,"readClippingEnabled",null),d([Ut("clippingEnabled")],dr.prototype,"writeClippingEnabled",null),d([m({type:Zze,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],dr.prototype,"floorInfo",void 0),d([m({type:hx,json:{write:!0}})],dr.prototype,"heightModelInfo",void 0),d([m({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],dr.prototype,"layers",void 0),d([Ut("layers")],dr.prototype,"writeLayers",null),d([m({readOnly:!0,type:l4,json:{type:eVe(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],dr.prototype,"sourceVersion",void 0),d([_i("sourceVersion",["version"])],dr.prototype,"readSourceVersion",null),d([Ut("sourceVersion")],dr.prototype,"writeSourceVersion",null),d([m({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],dr.prototype,"tables",void 0),d([Ut("tables")],dr.prototype,"writeTables",null),d([m()],dr.prototype,"thumbnailUrl",null),d([m({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],dr.prototype,"authoringApp",null),d([Ut("authoringApp")],dr.prototype,"writeAuthoringApp",null),d([m({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],dr.prototype,"authoringAppVersion",null),d([Ut("authoringAppVersion")],dr.prototype,"writeAuthoringAppVersion",null),d([m({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],dr.prototype,"ground",void 0),d([Ut("ground")],dr.prototype,"writeGround",null),d([m({type:lt.ofType(JBe),json:{write:!0}})],dr.prototype,"transportationNetworks",void 0),d([m({type:d_e,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],dr.prototype,"presentation",void 0),d([m({type:o4,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new o4({viewingMode:"global",spatialReference:We.WebMercator})}})],dr.prototype,"initialViewProperties",void 0),d([_i("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],dr.prototype,"readInitialViewProperties",null),d([m({type:We,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],dr.prototype,"spatialReference",null),d([m({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],dr.prototype,"viewingMode",null),d([m({type:kk})],dr.prototype,"portalItem",void 0),d([m()],dr.prototype,"resourceInfo",void 0),d([m({type:nBe,json:{write:!0}})],dr.prototype,"widgets",void 0),dr=d([U("esri.WebScene")],dr);const tVe=dr;function yr(){return[1,0,0,0,1,0,0,0,1]}function f_e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function YP(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function iVe(t,e){return new Float64Array(t,e,9)}const dx=yr();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:dx,clone:f_e,create:yr,createView:iVe,fromValues:YP},Symbol.toStringTag,{value:"Module"}));function Gl(){return[0,0,0,1]}function rVe(t){return[t[0],t[1],t[2],t[3]]}function sVe(t,e,i,r){return[t,e,i,r]}function nVe(t,e){return new Float64Array(t,e,4)}const Jk=Gl();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Jk,clone:rVe,create:Gl,createView:nVe,fromValues:sVe},Symbol.toStringTag,{value:"Module"}));function Ch(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function oVe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Zr(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function DX(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function m_e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function g_e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function y_e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function aVe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function lVe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function cVe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function uVe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function hVe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function kw(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function dVe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function __e(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function c4(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function NX(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function FX(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function pVe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function fVe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function v_e(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function b_e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function kX(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function mVe(t,e){const i=WR;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function Cc(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function gVe(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*s,h=c*s+l*r-o*n,p=c*n+o*s-a*r,f=-o*r-a*s-l*n;return t[0]=u*c+f*-o+h*-l-p*-a,t[1]=h*c+f*-a+p*-o-u*-l,t[2]=p*c+f*-l+u*-a-h*-o,t[3]=e[3],t}function yVe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function y2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Uw(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=go();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const _Ve=m_e,vVe=g_e,bVe=y_e,wVe=__e,xVe=c4,TVe=NX,SVe=FX,w_e=Object.freeze(Object.defineProperty({__proto__:null,add:DX,ceil:aVe,copy:Ch,copyVec3:oVe,dist:wVe,distance:__e,div:bVe,divide:y_e,dot:b_e,equals:Uw,exactEquals:y2,floor:lVe,inverse:fVe,len:TVe,length:NX,lerp:kX,max:uVe,min:cVe,mul:vVe,multiply:g_e,negate:pVe,normalize:v_e,random:mVe,round:hVe,scale:kw,scaleAndAdd:dVe,set:Zr,sqrDist:xVe,sqrLen:SVe,squaredDistance:c4,squaredLength:FX,str:yVe,sub:_Ve,subtract:m_e,transformMat4:Cc,transformQuat:gVe},Symbol.toStringTag,{value:"Module"}));function CVe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function dC(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Qk(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>go()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function Kk(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-r*c,t[2]=n*u+o*c+r*l-s*a,t[3]=o*u-r*a-s*l-n*c,t}function EVe(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function AVe(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function MVe(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function PVe(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function HD(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,h,p,f=i[0],g=i[1],_=i[2],v=i[3];return c=s*f+n*g+o*_+a*v,c<0&&(c=-c,f=-f,g=-g,_=-_,v=-v),1-c>go()?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-r)*l)/u,p=Math.sin(r*l)/u):(h=1-r,p=r),t[0]=h*s+p*f,t[1]=h*n+p*g,t[2]=h*o+p*_,t[3]=h*a+p*v,t}function OVe(t){const e=WR,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function RVe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function $_(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function x_e(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function $Ve(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function IVe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const LVe=Ch,T_e=Zr,DVe=DX,NVe=Kk,FVe=kw,kVe=b_e,UVe=kX,S_e=NX,zVe=S_e,C_e=FX,BVe=C_e,UX=v_e,VVe=y2,GVe=Uw;function jVe(t,e,i){const r=pe(e,i);return r<-.999999?(Ke(Op,HVe,e),ja(Op)<1e-6&&Ke(Op,qVe,e),fe(Op,Op),dC(t,Op,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ke(Op,e,i),t[0]=Op[0],t[1]=Op[1],t[2]=Op[2],t[3]=1+r,UX(t,t))}const Op=C(),HVe=Ce(1,0,0),qVe=Ce(0,1,0);function WVe(t,e,i,r,s,n){return HD(uie,e,s,n),HD(hie,i,r,n),HD(t,uie,hie,2*n*(1-n)),t}const uie=Gl(),hie=Gl();function YVe(t,e,i,r){const s=XVe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],UX(t,x_e(t,s))}const XVe=yr();Object.freeze(Object.defineProperty({__proto__:null,add:DVe,calculateW:PVe,conjugate:$_,copy:LVe,dot:kVe,equals:GVe,exactEquals:VVe,fromEuler:$Ve,fromMat3:x_e,getAxisAngle:Qk,identity:CVe,invert:RVe,len:zVe,length:S_e,lerp:UVe,mul:NVe,multiply:Kk,normalize:UX,random:OVe,rotateX:EVe,rotateY:AVe,rotateZ:MVe,rotationTo:jVe,scale:FVe,set:T_e,setAxes:YVe,setAxisAngle:dC,slerp:HD,sqlerp:WVe,sqrLen:BVe,squaredLength:C_e,str:IVe},Symbol.toStringTag,{value:"Module"}));function Yt(){return[0,0,0,0]}function n$(t){return[t[0],t[1],t[2],t[3]]}function kt(t,e,i,r){return[t,e,i,r]}function XO(t,e=Yt()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function ZVe(t,e){return new Float64Array(t,e,4)}function E_e(){return Yt()}function A_e(){return kt(1,1,1,1)}function M_e(){return kt(1,0,0,0)}function P_e(){return kt(0,1,0,0)}function O_e(){return kt(0,0,1,0)}function R_e(){return kt(0,0,0,1)}const Cu=E_e(),wh=A_e(),JVe=M_e(),QVe=P_e(),KVe=O_e(),eGe=R_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:wh,UNIT_W:eGe,UNIT_X:JVe,UNIT_Y:QVe,UNIT_Z:KVe,ZEROS:Cu,clone:n$,create:Yt,createView:ZVe,fromArray:XO,fromValues:kt,ones:A_e,unitW:R_e,unitX:M_e,unitY:P_e,unitZ:O_e,zeros:E_e},Symbol.toStringTag,{value:"Module"}));function Sp(t=L_e){return[t[0],t[1],t[2],t[3]]}function qD(t,e,i=Sp()){return ae(i,t),i[3]=e,i}function die(t,e,i=Yt()){return Ke(i,t,e),fe(i,i),i[3]=-Zfe(t,e),i}function $_e(t,e=Sp()){const i=J0e(bM,t);return I_e(e,ea(Qk(e,i))),e}function pie(t,e,i=Sp()){return dC(bM,t,ZO(t)),dC(fie,e,ZO(e)),Kk(bM,fie,bM),I_e(i,ea(Qk(i,bM)))}function tGe(t,e,i,r=Sp()){return qD(xY,t,v3),qD(TY,e,mie),qD(Y2,i,gie),pie(v3,mie,v3),pie(v3,gie,r),r}function f$t(t){return t}function iGe(t){return t[3]}function ZO(t){return xt(t[3])}function I_e(t,e){return t[3]=e,t}const L_e=[0,0,1,0],bM=Gl(),fie=Gl();Sp();const v3=Sp(),mie=Sp(),gie=Sp();let kE=null,u4=!0;function _B(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(u4)try{return new ImageData(t,e)}catch{u4=!1}return D_e(t,e,i)}function rGe(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(u4)try{return new ImageData(t,e,i)}catch{u4=!1}const s=D_e(e,i,r);return s.data.set(t,0),s}function sGe(){return kE||(kE=document.createElement("canvas"),kE.width=1,kE.height=1),kE}function D_e(t,e,i){return i||(i=sGe()),i.getContext("2d").createImageData(t,e)}async function nGe(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Yi(i,{...e,responseType:"image"});return r}catch(r){throw sn(r)?r:new W("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function m$t(t,e){const{arrayBuffer:i,mediaType:r}=await oGe(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await ue(()=>import("./gif-32ab8aa5.js"),[],import.meta.url);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await ue(()=>import("./apng-3bdb8e83.js"),[],import.meta.url);if(n(i))return o(i,e)}return nGe(new Blob([i],{type:r}),e)}async function oGe(t,e){const i=j_(t);if(i?.isBase64)return{arrayBuffer:Ype(i.data),mediaType:i.mediaType};const r=await Yi(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}var eS;const vB=new WeakMap;let aGe=0,df=eS=class extends Me{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:tC(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s={type:"canvas-element",imageData:yie(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[i]=s}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:tC(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:yie(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=_ie(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return _ie(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return vie(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return vie(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(vB.has(this.data)||vB.set(this.data,++aGe),e(vB.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new eS(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new eS({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new eS({data:t}):_w(eS,t)}};function yie(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}function _ie(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return rGe(i,t.width,t.height)}function vie(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}d([m({type:String,json:{write:Dw}})],df.prototype,"url",null),d([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],df.prototype,"data",null),d([Ut("data")],df.prototype,"writeData",null),d([_i("data")],df.prototype,"readData",null),d([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],df.prototype,"transparent",null),d([m({json:{write:!0}})],df.prototype,"wrap",void 0),d([m({readOnly:!0})],df.prototype,"contentHash",null),df=eS=d([U("esri.geometry.support.MeshTexture")],df);const XP=df;let tS=class extends Ic(Me){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],tS.prototype,"offset",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],tS.prototype,"rotation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],tS.prototype,"scale",void 0),tS=d([U("esri.geometry.support.MeshTextureTransform")],tS);const _2=tS;var Y8;let md=Y8=class extends Me{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new Y8(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([m({type:et,json:{write:!0}})],md.prototype,"color",void 0),d([m({type:XP,json:{write:!0}})],md.prototype,"colorTexture",void 0),d([m({type:_2,json:{write:!0}})],md.prototype,"colorTextureTransform",void 0),d([m({type:XP,json:{write:!0}})],md.prototype,"normalTexture",void 0),d([m({type:_2,json:{write:!0}})],md.prototype,"normalTextureTransform",void 0),d([m({nonNullable:!0,json:{write:!0}})],md.prototype,"alphaMode",void 0),d([m({nonNullable:!0,json:{write:!0}})],md.prototype,"alphaCutoff",void 0),d([m({nonNullable:!0,json:{write:!0}})],md.prototype,"doubleSided",void 0),md=Y8=d([U("esri.geometry.support.MeshMaterial")],md);const zX=md;var X8;let Zu=X8=class extends zX{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new X8(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};d([m({type:et,json:{write:!0}})],Zu.prototype,"emissiveColor",void 0),d([m({type:XP,json:{write:!0}})],Zu.prototype,"emissiveTexture",void 0),d([m({type:_2,json:{write:!0}})],Zu.prototype,"emissiveTextureTransform",void 0),d([m({type:XP,json:{write:!0}})],Zu.prototype,"occlusionTexture",void 0),d([m({type:_2,json:{write:!0}})],Zu.prototype,"occlusionTextureTransform",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Zu.prototype,"metallic",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Zu.prototype,"roughness",void 0),d([m({type:XP,json:{write:!0}})],Zu.prototype,"metallicRoughnessTexture",void 0),d([m({type:_2,json:{write:!0}})],Zu.prototype,"metallicRoughnessTextureTransform",void 0),Zu=X8=d([U("esri.geometry.support.MeshMaterialMetallicRoughness")],Zu);const N_e=Zu;var WD;let Ga=WD=class extends Me{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return iS(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},le.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&le.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),iS(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},le.getLogger(this))}castUv(t){return iS(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},le.getLogger(this))}castNormal(t){return iS(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},le.getLogger(this))}castTangent(t){return iS(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},le.getLogger(this))}clone(){const t={position:ge(this.position),uv:ge(this.uv),normal:ge(this.normal),tangent:ge(this.tangent),color:ge(this.color)};return new WD(t)}clonePositional(){const t={position:ge(this.position),normal:ge(this.normal),tangent:ge(this.tangent),uv:this.uv,color:this.color};return new WD(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function bB(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function iS(t,e,i,r,s){if(!t)return t;if(t instanceof e)return bB(t,r,e,s);for(const n of i)if(t instanceof n)return bB(new e(t),r,e,s);if(Array.isArray(t))return bB(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function UE(t,e,i){e[i]=lGe(t)}function lGe(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}d([m({json:{write:UE}})],Ga.prototype,"color",void 0),d([cr("color")],Ga.prototype,"castColor",null),d([m({nonNullable:!0,json:{write:UE}})],Ga.prototype,"position",void 0),d([cr("position")],Ga.prototype,"castPosition",null),d([m({json:{write:UE}})],Ga.prototype,"uv",void 0),d([cr("uv")],Ga.prototype,"castUv",null),d([m({json:{write:UE}})],Ga.prototype,"normal",void 0),d([cr("normal")],Ga.prototype,"castNormal",null),d([m({json:{write:UE}})],Ga.prototype,"tangent",void 0),d([cr("tangent")],Ga.prototype,"castTangent",null),Ga=WD=d([U("esri.geometry.support.MeshVertexAttributes")],Ga);var wM;let pf=wM=class extends Me{static from(t){return _w(wM,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return iS(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},le.getLogger(this))}castMaterial(t){return _w(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?N_e:zX,t)}clone(){return new wM({faces:ge(this.faces),shading:this.shading,material:ge(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:ge(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new wM(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([m({json:{write:!0}})],pf.prototype,"faces",void 0),d([cr("faces")],pf.prototype,"castFaces",null),d([m({type:zX,json:{write:!0}})],pf.prototype,"material",void 0),d([cr("material")],pf.prototype,"castMaterial",null),d([m()],pf.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],pf.prototype,"shading",void 0),d([m({type:Boolean})],pf.prototype,"trustSourceNormals",void 0),pf=wM=d([U("esri.geometry.support.MeshComponent")],pf);const zw=pf,cGe="Mesh must be loaded before applying operations",uGe="Provided component is not part of the list of components",hGe="Expected polygon to be a Polygon instance",xM="Expected location to be a Point instance";let bie=class extends W{constructor(){super("invalid-input:location",xM)}},TM=class extends Ic(Me){constructor(e){super(e),this.type="georeferenced",this.origin=null}};d([At({georeferenced:"georeferenced"},{readOnly:!0})],TM.prototype,"type",void 0),d([m({type:[Number],nonNullable:!1,json:{write:!0}})],TM.prototype,"origin",void 0),TM=d([U("esri.geometry.support.MeshGeoreferencedVertexSpace")],TM);const JO=TM;let SM=class extends Ic(Me){constructor(e){super(e),this.type="local",this.origin=C()}};d([At({local:"local"},{readOnly:!0})],SM.prototype,"type",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],SM.prototype,"origin",void 0),SM=d([U("esri.geometry.support.MeshLocalVertexSpace")],SM);const h4=SM;function xe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pC(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function BX(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,_){return[t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,_]}function dGe(t,e){return new Float64Array(t,e,16)}const Cr=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Cr,clone:pC,create:xe,createView:dGe,fromValues:BX},Symbol.toStringTag,{value:"Module"}));var Z8;let ff=Z8=class extends Me{constructor(t){super(t),this.translation=C(),this.rotationAxis=ya(L_e),this.rotationAngle=0,this.scale=Ce(1,1,1)}get rotation(){return qD(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=Kr(t),this.rotationAngle=iGe(t)}get localMatrix(){const t=xe();return dC(wie,this.rotation,ZO(this.rotation)),Q0e(t,wie,this.translation,this.scale),t}get localMatrixInverse(){return Is(xe(),this.localMatrix)}equals(t){return this===t||t!=null&&jk(this.localMatrix,t.localMatrix)}clone(){const t={translation:Kr(this.translation),rotationAxis:Kr(this.rotationAxis),rotationAngle:this.rotationAngle,scale:Kr(this.scale)};return new Z8(t)}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"translation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"rotationAxis",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],ff.prototype,"rotationAngle",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"scale",void 0),d([m()],ff.prototype,"rotation",null),d([m()],ff.prototype,"localMatrix",null),d([m()],ff.prototype,"localMatrixInverse",null),ff=Z8=d([U("esri.geometry.support.MeshTransform")],ff);const wie=Gl(),QO=ff;function xie(){return le.getLogger("esri.geometry.Mesh")}function pGe(t){return!h0(t)}function h0(t){return t.origin!=null}function F_e(t){return h0(t.vertexSpace)}function Tie(t,e){if(!h0(t))return null;const[i,r,s]=t.origin;return new Xe({x:i,y:r,z:s,spatialReference:e})}function d4(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return e?.geographic!==void 0&&(o0(xie(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&xie().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),(e?.vertexSpace??mGe(e?.geographic)??fGe(n))==="local"?new h4({origin:o}):new JO({origin:o})}function fGe(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function mGe(t){return t==null?void 0:t?"local":"georeferenced"}function gGe(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&ho(t.origin,e.origin))}var b$t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function o$(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Sie,Cie,Eie,k_e={exports:{}};Sie=k_e,Cie=function(){function t(I,D,G){G=G||2;var H,J,Q,ee,de,we,Re,tt=D&&D.length,Ye=tt?D[0]*G:I.length,qe=e(I,0,Ye,G,!0),He=[];if(!qe||qe.next===qe.prev)return He;if(tt&&(qe=l(I,D,qe,G)),I.length>80*G){H=Q=I[0],J=ee=I[1];for(var je=G;je<Ye;je+=G)(de=I[je])<H&&(H=de),(we=I[je+1])<J&&(J=we),de>Q&&(Q=de),we>ee&&(ee=we);Re=(Re=Math.max(Q-H,ee-J))!==0?1/Re:0}return r(qe,He,G,H,J,Re),He}function e(I,D,G,H,J){var Q,ee;if(J===ce(I,D,G,H)>0)for(Q=D;Q<G;Q+=H)ee=X(Q,I[Q],I[Q+1],ee);else for(Q=G-H;Q>=D;Q-=H)ee=X(Q,I[Q],I[Q+1],ee);if(ee&&A(ee,ee.next)){var de=ee.next;q(ee),ee=de}return ee}function i(I,D){if(!I)return I;D||(D=I);var G,H=I;do if(G=!1,H.steiner||!A(H,H.next)&&S(H.prev,H,H.next)!==0)H=H.next;else{var J=H.prev;if(q(H),(H=D=J)===H.next)break;G=!0}while(G||H!==D);return D}function r(I,D,G,H,J,Q,ee){if(I){!ee&&Q&&g(I,H,J,Q);for(var de,we,Re=I;I.prev!==I.next;)if(de=I.prev,we=I.next,Q?n(I,H,J,Q):s(I))D.push(de.i/G),D.push(I.i/G),D.push(we.i/G),q(I),I=we.next,Re=we.next;else if((I=we)===Re){ee?ee===1?r(I=o(i(I),D,G),D,G,H,J,Q,2):ee===2&&a(I,D,G,H,J,Q):r(i(I),D,G,H,J,Q,1);break}}}function s(I){var D=I.prev,G=I,H=I.next;if(S(D,G,H)>=0)return!1;for(var J=I.next.next;J!==I.prev;){if(w(D.x,D.y,G.x,G.y,H.x,H.y,J.x,J.y)&&S(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function n(I,D,G,H){var J=I.prev,Q=I,ee=I.next;if(S(J,Q,ee)>=0)return!1;for(var de=J.x<Q.x?J.x<ee.x?J.x:ee.x:Q.x<ee.x?Q.x:ee.x,we=J.y<Q.y?J.y<ee.y?J.y:ee.y:Q.y<ee.y?Q.y:ee.y,Re=J.x>Q.x?J.x>ee.x?J.x:ee.x:Q.x>ee.x?Q.x:ee.x,tt=J.y>Q.y?J.y>ee.y?J.y:ee.y:Q.y>ee.y?Q.y:ee.y,Ye=v(de,we,D,G,H),qe=v(Re,tt,D,G,H),He=I.prevZ,je=I.nextZ;He&&He.z>=Ye&&je&&je.z<=qe;){if(He!==I.prev&&He!==I.next&&w(J.x,J.y,Q.x,Q.y,ee.x,ee.y,He.x,He.y)&&S(He.prev,He,He.next)>=0||(He=He.prevZ,je!==I.prev&&je!==I.next&&w(J.x,J.y,Q.x,Q.y,ee.x,ee.y,je.x,je.y)&&S(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;He&&He.z>=Ye;){if(He!==I.prev&&He!==I.next&&w(J.x,J.y,Q.x,Q.y,ee.x,ee.y,He.x,He.y)&&S(He.prev,He,He.next)>=0)return!1;He=He.prevZ}for(;je&&je.z<=qe;){if(je!==I.prev&&je!==I.next&&w(J.x,J.y,Q.x,Q.y,ee.x,ee.y,je.x,je.y)&&S(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function o(I,D,G){var H=I;do{var J=H.prev,Q=H.next.next;!A(J,Q)&&P(J,H,H.next,Q)&&N(J,Q)&&N(Q,J)&&(D.push(J.i/G),D.push(H.i/G),D.push(Q.i/G),q(H),q(H.next),H=I=Q),H=H.next}while(H!==I);return i(H)}function a(I,D,G,H,J,Q){var ee=I;do{for(var de=ee.next.next;de!==ee.prev;){if(ee.i!==de.i&&T(ee,de)){var we=z(ee,de);return ee=i(ee,ee.next),we=i(we,we.next),r(ee,D,G,H,J,Q),void r(we,D,G,H,J,Q)}de=de.next}ee=ee.next}while(ee!==I)}function l(I,D,G,H){var J,Q,ee,de=[];for(J=0,Q=D.length;J<Q;J++)(ee=e(I,D[J]*H,J<Q-1?D[J+1]*H:I.length,H,!1))===ee.next&&(ee.steiner=!0),de.push(b(ee));for(de.sort(c),J=0;J<de.length;J++)G=i(G=h(de[J],G),G.next);return G}function c(I,D){return I.x-D.x}function u(I){if(I.next.prev===I)return I;let D=I;for(;;){const G=D.next;if(G.prev===D||G===D||G===I)break;D=G}return D}function h(I,D){var G=p(I,D);if(!G)return D;var H=z(G,I),J=i(G,G.next);let Q=u(H);return i(Q,Q.next),J=u(J),u(D===G?J:D)}function p(I,D){var G,H=D,J=I.x,Q=I.y,ee=-1/0;do{if(Q<=H.y&&Q>=H.next.y&&H.next.y!==H.y){var de=H.x+(Q-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(de<=J&&de>ee){if(ee=de,de===J){if(Q===H.y)return H;if(Q===H.next.y)return H.next}G=H.x<H.next.x?H:H.next}}H=H.next}while(H!==D);if(!G)return null;if(J===ee)return G;var we,Re=G,tt=G.x,Ye=G.y,qe=1/0;H=G;do J>=H.x&&H.x>=tt&&J!==H.x&&w(Q<Ye?J:ee,Q,tt,Ye,Q<Ye?ee:J,Q,H.x,H.y)&&(we=Math.abs(Q-H.y)/(J-H.x),N(H,I)&&(we<qe||we===qe&&(H.x>G.x||H.x===G.x&&f(G,H)))&&(G=H,qe=we)),H=H.next;while(H!==Re);return G}function f(I,D){return S(I.prev,I,D.prev)<0&&S(D.next,I,I.next)<0}function g(I,D,G,H){var J=I;do J.z===null&&(J.z=v(J.x,J.y,D,G,H)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==I);J.prevZ.nextZ=null,J.prevZ=null,_(J)}function _(I){var D,G,H,J,Q,ee,de,we,Re=1;do{for(G=I,I=null,Q=null,ee=0;G;){for(ee++,H=G,de=0,D=0;D<Re&&(de++,H=H.nextZ);D++);for(we=Re;de>0||we>0&&H;)de!==0&&(we===0||!H||G.z<=H.z)?(J=G,G=G.nextZ,de--):(J=H,H=H.nextZ,we--),Q?Q.nextZ=J:I=J,J.prevZ=Q,Q=J;G=H}Q.nextZ=null,Re*=2}while(ee>1);return I}function v(I,D,G,H,J){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-G)*J)|I<<8))|I<<4))|I<<2))|I<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-H)*J)|D<<8))|D<<4))|D<<2))|D<<1))<<1}function b(I){var D=I,G=I;do(D.x<G.x||D.x===G.x&&D.y<G.y)&&(G=D),D=D.next;while(D!==I);return G}function w(I,D,G,H,J,Q,ee,de){return(J-ee)*(D-de)-(I-ee)*(Q-de)>=0&&(I-ee)*(H-de)-(G-ee)*(D-de)>=0&&(G-ee)*(Q-de)-(J-ee)*(H-de)>=0}function T(I,D){return I.next.i!==D.i&&I.prev.i!==D.i&&!k(I,D)&&(N(I,D)&&N(D,I)&&j(I,D)&&(S(I.prev,I,D.prev)||S(I,D.prev,D))||A(I,D)&&S(I.prev,I,I.next)>0&&S(D.prev,D,D.next)>0)}function S(I,D,G){return(D.y-I.y)*(G.x-D.x)-(D.x-I.x)*(G.y-D.y)}function A(I,D){return I.x===D.x&&I.y===D.y}function P(I,D,G,H){var J=F(S(I,D,G)),Q=F(S(I,D,H)),ee=F(S(G,H,I)),de=F(S(G,H,D));return J!==Q&&ee!==de||!(J!==0||!R(I,G,D))||!(Q!==0||!R(I,H,D))||!(ee!==0||!R(G,I,H))||!(de!==0||!R(G,D,H))}function R(I,D,G){return D.x<=Math.max(I.x,G.x)&&D.x>=Math.min(I.x,G.x)&&D.y<=Math.max(I.y,G.y)&&D.y>=Math.min(I.y,G.y)}function F(I){return I>0?1:I<0?-1:0}function k(I,D){var G=I;do{if(G.i!==I.i&&G.next.i!==I.i&&G.i!==D.i&&G.next.i!==D.i&&P(G,G.next,I,D))return!0;G=G.next}while(G!==I);return!1}function N(I,D){return S(I.prev,I,I.next)<0?S(I,D,I.next)>=0&&S(I,I.prev,D)>=0:S(I,D,I.prev)<0||S(I,I.next,D)<0}function j(I,D){var G=I,H=!1,J=(I.x+D.x)/2,Q=(I.y+D.y)/2;do G.y>Q!=G.next.y>Q&&G.next.y!==G.y&&J<(G.next.x-G.x)*(Q-G.y)/(G.next.y-G.y)+G.x&&(H=!H),G=G.next;while(G!==I);return H}function z(I,D){var G=new Z(I.i,I.x,I.y),H=new Z(D.i,D.x,D.y),J=I.next,Q=D.prev;return I.next=D,D.prev=I,G.next=J,J.prev=G,H.next=G,G.prev=H,Q.next=H,H.prev=Q,H}function X(I,D,G,H){var J=new Z(I,D,G);return H?(J.next=H.next,J.prev=H,H.next.prev=J,H.next=J):(J.prev=J,J.next=J),J}function q(I){I.next.prev=I.prev,I.prev.next=I.next,I.prevZ&&(I.prevZ.nextZ=I.nextZ),I.nextZ&&(I.nextZ.prevZ=I.prevZ)}function Z(I,D,G){this.i=I,this.x=D,this.y=G,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ce(I,D,G,H){for(var J=0,Q=D,ee=G-H;Q<G;Q+=H)J+=(I[ee]-I[Q])*(I[Q+1]+I[ee+1]),ee=Q;return J}return t.deviation=function(I,D,G,H){var J=D&&D.length,Q=J?D[0]*G:I.length,ee=Math.abs(ce(I,0,Q,G));if(J)for(var de=0,we=D.length;de<we;de++){var Re=D[de]*G,tt=de<we-1?D[de+1]*G:I.length;ee-=Math.abs(ce(I,Re,tt,G))}var Ye=0;for(de=0;de<H.length;de+=3){var qe=H[de]*G,He=H[de+1]*G,je=H[de+2]*G;Ye+=Math.abs((I[qe]-I[je])*(I[He+1]-I[qe+1])-(I[qe]-I[He])*(I[je+1]-I[qe+1]))}return ee===0&&Ye===0?0:Math.abs((Ye-ee)/ee)},t.flatten=function(I){for(var D=I[0][0].length,G={vertices:[],holes:[],dimensions:D},H=0,J=0;J<I.length;J++){for(var Q=0;Q<I[J].length;Q++)for(var ee=0;ee<D;ee++)G.vertices.push(I[J][Q][ee]);J>0&&(H+=I[J-1].length,G.holes.push(H))}return G},t},(Eie=Cie())!==void 0&&(Sie.exports=Eie);const fC=o$(k_e.exports);function jn(t,e=!1){return t<=Au?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function U_e(t){return(am(t)?t.length:t.byteLength/8)<=Au?Array.from(t):new Float64Array(t)}function Ph(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function yGe(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function w$t(t){return Array.isArray(t)?new Float64Array(t):t}function Qf(t){if(am(t)){if(t.length<Au)return t}else if(t.length<Au)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?wv(t.length):i?px(t.length):am(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?_Ge(t):t}function _Ge(t){let e=!0;for(const i of t){if(i>=65536)return am(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function p4(t){return t<=Au?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function vGe(t){return t<=Au?new Array(t):new Uint32Array(t)}let Ax=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const z_e=[0],wB=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function px(t){if(t===1)return z_e;if(t<Au)return Array.from(new Uint16Array(wB.buffer,0,t));if(t<wB.length)return new Uint16Array(wB.buffer,0,t);if(t>Ax.length){const e=Math.max(2*Ax.length,t);Ax=new Uint32Array(e);for(let i=0;i<Ax.length;i++)Ax[i]=i}return new Uint32Array(Ax.buffer,0,t)}let b3=new Uint8Array(65536);function wv(t){if(t===1)return z_e;if(t<Au)return new Array(t).fill(0);if(t>b3.length){const e=Math.max(2*b3.length,t);b3=new Uint8Array(e)}return new Uint8Array(b3.buffer,0,t)}function x$t(t,e,i){const r=pe(t,e)/pe(t,t);return ie(i,t,r)}function I_(t,e){return pe(t,e)/Se(t)}function VX(t,e){const i=pe(t,e)/(Se(t)*Se(e));return-Zn(i)}function B_e(t,e,i){fe(w3,t),fe(xB,e);const r=pe(w3,xB),s=Zn(r),n=Ke(w3,w3,xB);return pe(n,i)<0?2*Math.PI-s:s}const w3=C(),xB=C();function it(){return[0,0]}function CM(t){return[t[0],t[1]]}function ci(t,e){return[t,e]}function V_e(t,e=it()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function bGe(t,e){return new Float64Array(t,e,2)}function G_e(){return it()}function j_e(){return ci(1,1)}function H_e(){return ci(1,0)}function q_e(){return ci(0,1)}const Bw=G_e(),eU=j_e(),W_e=H_e(),wGe=q_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:eU,UNIT_X:W_e,UNIT_Y:wGe,ZEROS:Bw,clone:CM,create:it,createView:bGe,fromArray:V_e,fromValues:ci,ones:j_e,unitX:H_e,unitY:q_e,zeros:G_e},Symbol.toStringTag,{value:"Module"}));let cE=class H1{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&B2(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new H1(it)}static createVec3f64(){return new H1(C)}static createVec4f64(){return new H1(Yt)}static createMat3f64(){return new H1(yr)}static createMat4f64(){return new H1(xe)}static createQuatf64(){return new H1(Gl)}get test(){}};const T$t=cE.createVec2f64(),ze=cE.createVec3f64(),GX=cE.createVec4f64();cE.createMat3f64();const jX=cE.createMat4f64(),xGe=cE.createQuatf64();function mC(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function TGe(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return te(t,i,r,s),t}function S$t(t,e,i){i=i||t;const r=pe(t,e);te(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),fe(i,i)}function SGe(t,e,i){Math.abs(t[0])>Math.abs(t[1])?te(e,0,1,0):te(e,1,0,0),Ke(i,t,e),Ke(e,i,t),fe(i,i),fe(e,e)}function x3(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function CGe(t,e,i,r=C()){const s=Se(t),n=Se(e),o=pe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),u=l/n*Math.sin(i*a);return ie(Nb,t,c),ie(Fb,e,u),me(r,Nb,Fb)}return or(r,t,e,i)}function C$t(t,e,i,r=C(),s=C()){const n=Se(t),o=Se(e),a=pe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),h=Math.sin((1-i)*l),p=(1-i)*n+i*o;{const f=p/c,g=f/o*u;ie(Nb,t,f/n*h),ie(Fb,e,g),me(r,Nb,Fb)}{const f=1/n*(-Math.cos((1-i)*l)*l*p+h*(-n+o));ie(Nb,t,f);const g=1/o*(Math.cos(i*l)*l*p+u*(-n+o));ie(Fb,e,g),me(s,Nb,Fb),ie(s,s,1/c)}return s}return or(r,t,e,i),_e(s,e,t),fe(s,s),s}function f4(t,e,i){t=fe(Nb,t),e=fe(Fb,e);const r=Zn(pe(t,e));if(i){const s=Ke(EGe,t,e);if(pe(s,i)<0)return-r}return r}function YD(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function E$t(t,e,i,r){_e(Aie,e,t),_e(Mie,i,t),Ke(r,Aie,Mie),fe(r,r),r[3]=-pe(t,r)}function A$t(t,e){if(te(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)me(e,e,t[i]);ie(e,e,1/t.length)}}const Aie=C(),Mie=C(),EGe=C(),Nb=C(),Fb=C();function Ui(t=EM){return[t[0],t[1],t[2],t[3]]}function AGe(t=EM[0],e=EM[1],i=EM[2],r=EM[3]){return HX(t,e,i,r,GX.get())}function tU(t,e){return HX(e[0],e[1],e[2],e[3],t)}function M$t(t){return t}function HX(t,e,i,r,s=Ui()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Y_e(t,e,i){return ae(i,t),i[3]=e,i}function a$(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function ba(t,e,i,r=Ui()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,h=o*a-s*c,p=s*l-n*a,f=u*u+h*h+p*p,g=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return r[0]=u*g,r[1]=h*g,r[2]=p*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function qX(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(zE,r);let o=s,a=!1;for(;o<i-1&&!a;)e(Mx,o),o++,a=!ho(zE,Mx);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(wb,o),o++,_e(T3,zE,Mx),fe(T3,T3),_e(S3,Mx,wb),fe(S3,S3),a=!ho(zE,wb)&&!ho(Mx,wb)&&Math.abs(pe(T3,S3))<PGe;return a?(ba(zE,Mx,wb,t),!0):(r!==0||s!==1||n!==2)&&qX(t,e,i,0,1,2)}function MGe(t,e,i=!0){const r=e.length/3;return qX(t,(s,n)=>te(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const PGe=.99619469809,zE=C(),Mx=C(),wb=C(),T3=C(),S3=C();function J8(t,e,i){return e!==t&&tU(t,e),t[3]=-pe(t,i),t}function Q8(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function KO(t,e,i,r){return Ke(wb,e,t),a$(i,wb,r)}function P$t(t,e,i,r){return iU(t,e,_e(ze.get(),i,e),DGe,r)}function fx(t,e,i){return e!=null&&iU(t,e.origin,e.direction,NGe,i)}function OGe(t,e,i){return iU(t,e.origin,e.vector,Kf.NONE,i)}function RGe(t,e,i){return iU(t,e.origin,e.vector,Kf.CLAMP,i)}function X_e(t,e){return fr(t,e)>=0}function $Ge(t,e){const i=pe(t,e.ray.direction),r=-fr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function IGe(t,e){const i=pe(t,e.ray.direction),r=-fr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function LGe(t,e,i){const r=ie(ze.get(),t,-t[3]),s=K8(t,_e(ze.get(),e,r),ze.get());return me(i,s,r),i}function O$t(t,e,i,r){const s=t,n=ze.get(),o=ze.get();SGe(s,n,o);const a=_e(ze.get(),i,e),l=I_(n,a),c=I_(o,a),u=I_(s,a);return te(r,l,c,u)}function K8(t,e,i){const r=ie(ze.get(),t,pe(t,e));return _e(i,e,r),i}function R$t(t,e){return Math.abs(fr(t,e))}function fr(t,e){return pe(t,e)+t[3]}function iU(t,e,i,r,s){const n=pe(t,i);if(n===0)return!1;let o=-(pe(t,e)+t[3])/n;return r&Kf.CLAMP&&(o=Te(o,0,1)),!(!(r&Kf.INFINITE_MIN)&&o<0||!(r&Kf.INFINITE_MAX)&&o>1)&&(me(s,e,ie(s,i,o)),!0)}const EM=[0,0,1,0];var Kf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Kf||(Kf={}));const DGe=Kf.INFINITE_MIN|Kf.INFINITE_MAX,NGe=Kf.INFINITE_MAX;function Z_e(t,e,i){const r=FGe(Pie,t,e,i)?Pie:[0,0,1];return Math.abs(r[2])>Math.cos(xt(80))?Xr.Z:Math.abs(r[1])>Math.abs(r[0])?Xr.Y:Xr.X}function FGe(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?sl(r)/LO(r):1;return qX(t,(o,a)=>te(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const Pie=Ui();function eq(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=i?.minReduction??0,a=i?.originalIndices||null,l=a?a.length:0,c=i?.componentOffsets||null;let u=0;if(c)for(let P=0;P<c.length-1;P++){const R=c[P+1]-c[P];R>u&&(u=R)}else u=s;const h=Math.floor(1.1*u)+1;(Rp==null||Rp.length<2*h)&&(Rp=new Uint32Array(Jfe(2*h)));for(let P=0;P<2*h;P++)Rp[P]=0;let p=0;const f=!!c&&!!a,g=f?l:s;let _=p4(s);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,T=1,S=c?c[1]:g;for(let P=0;P<g;P++){if(P===w){const z=1-p/P;if(z+b*Math.sqrt(z*(1-z)/P)<o)return null;w*=2}if(P===S){for(let z=0;z<2*h;z++)Rp[z]=0;if(a)for(let z=c[T-1];z<c[T];z++)v[z]=_[a[z]];S=c[++T]}const R=f?a[P]:P,F=R*e,k=zGe(n,F,e);let N=k%h,j=p;for(;Rp[2*N+1]!==0;){if(Rp[2*N]===k){const z=Rp[2*N+1]-1;if(kGe(n,F,z*e,e)){j=_[z];break}}N++,N>=h&&(N-=h)}j===p&&(Rp[2*N]=k,Rp[2*N+1]=R+1,p++),_[R]=j}if(o!==0&&1-p/s<o)return null;if(f){for(let P=c[T-1];P<v.length;P++)v[P]=_[a[P]];_=Qf(v)}const A=r?new Array(p):new Uint32Array(p*e);p=0;for(let P=0;P<g;P++)_[P]===p&&(UGe(n,(f?a[P]:P)*e,A,p*e,e),p++);if(a&&!f){const P=new Uint32Array(l);for(let R=0;R<P.length;R++)P[R]=_[a[R]];_=Qf(P)}return{buffer:Array.isArray(A)?A:A.buffer,indices:_,uniqueCount:p}}function kGe(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function UGe(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function zGe(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Rp=null;function BGe(t){const e=l$(t.rings,t.hasZ,fm.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Ph(e.position,3*c,3*l),h=a.holeIndices.map(f=>f-c),p=Qf(fC(u,h,3));i.push({position:u,faces:p}),r+=u.length,s+=p.length}const n=VGe(i,r,s),o=Array.isArray(n.position)?eq(n.position,3,{originalIndices:n.faces}):eq(n.position.buffer,6,{originalIndices:n.faces});return n.position=U_e(new Float64Array(o.buffer)),n.faces=o.indices,n}function VGe(t,e,i){if(t.length===1)return t[0];const r=jn(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:Qf(s)}}function l$(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let g=0;g<s;++g)l+=t[g].length;let c=0,u=0,h=0;const p=jn(3*l);let f=0;for(let g=s-1;g>=0;g--){const _=t[g],v=i===fm.CCW_IS_HOLE&&GGe(_,e,r);if(v&&s!==1)n[c++]=_;else{let b=_.length;for(let T=0;T<c;++T)b+=n[T].length;const w={index:f,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=_.length,_.length>0&&(a[h++]={index:f,count:_.length}),f=v?C3(_,_.length-1,-1,p,f,_.length,e):C3(_,0,1,p,f,_.length,e);for(let T=0;T<c;++T){const S=n[T];w.holeIndices[T]=f,w.pathLengths[T+1]=S.length,S.length>0&&(a[h++]={index:f,count:S.length}),f=C3(S,0,1,p,f,S.length,e)}c=0,w.count>0&&(o[u++]=w)}}for(let g=0;g<c;++g){const _=n[g];_.length>0&&(a[h++]={index:f,count:_.length}),f=C3(_,0,1,p,f,_.length,e)}return o.length=u,a.length=h,{position:p,polygons:o,outlines:a}}function C3(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function GGe(t,e,i){if(!e)return!kA(t);const r=t.length-1;switch(Z_e(t,r,i)){case Xr.X:return!kA(t,Xr.Y,Xr.Z);case Xr.Y:return!kA(t,Xr.X,Xr.Z);case Xr.Z:return!kA(t,Xr.X,Xr.Y)}}var fm;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(fm||(fm={}));function $u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function jGe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function WX(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function rU(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function mx(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function c$(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=-u*n+a*l,f=c*n-o*l;let g=i*h+r*p+s*f;return g?(g=1/g,t[0]=h*g,t[1]=(-u*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=p*g,t[4]=(u*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=f*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function HGe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-r*u,t[2]=r*a-s*o,t[3]=a*l-n*u,t[4]=i*u-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function qGe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function gC(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],f=i[1],g=i[2],_=i[3],v=i[4],b=i[5],w=i[6],T=i[7],S=i[8];return t[0]=p*r+f*o+g*c,t[1]=p*s+f*a+g*u,t[2]=p*n+f*l+g*h,t[3]=_*r+v*o+b*c,t[4]=_*s+v*a+b*u,t[5]=_*n+v*l+b*h,t[6]=w*r+T*o+S*c,t[7]=w*s+T*a+S*u,t[8]=w*n+T*l+S*h,t}function yC(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],f=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=p*r+f*o+c,t[7]=p*s+f*a+u,t[8]=p*n+f*l+h,t}function sU(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=Math.sin(i),f=Math.cos(i);return t[0]=f*r+p*o,t[1]=f*s+p*a,t[2]=f*n+p*l,t[3]=f*o-p*r,t[4]=f*a-p*s,t[5]=f*l-p*n,t[6]=c,t[7]=u,t[8]=h,t}function u$(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function WGe(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function YGe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function XGe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ZGe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function JGe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function eR(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,h=r*a,p=s*o,f=s*a,g=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-h-g,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-g,t[7]=f-_,t[2]=p-v,t[5]=f+_,t[8]=1-c-h,t}function J_e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*o-a*c,p=-u*n+a*l,f=c*n-o*l,g=i*h+r*p+s*f;if(!g)return null;const _=1/g;return t[0]=h*_,t[1]=(-u*r+s*c)*_,t[2]=(a*r-s*o)*_,t[3]=p*_,t[4]=(u*i-s*l)*_,t[5]=(-a*i+s*n)*_,t[6]=f*_,t[7]=(-c*i+r*l)*_,t[8]=(o*i-r*n)*_,t}function d0(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15],w=i*a-r*o,T=i*l-s*o,S=i*c-n*o,A=r*l-s*a,P=r*c-n*a,R=s*c-n*l,F=u*_-h*g,k=u*v-p*g,N=u*b-f*g,j=h*v-p*_,z=h*b-f*_,X=p*b-f*v;let q=w*X-T*z+S*j+A*N-P*k+R*F;return q?(q=1/q,t[0]=(a*X-l*z+c*j)*q,t[1]=(l*N-o*X-c*k)*q,t[2]=(o*z-a*N+c*F)*q,t[3]=(s*z-r*X-n*j)*q,t[4]=(i*X-s*N+n*k)*q,t[5]=(r*N-i*z-n*F)*q,t[6]=(_*R-v*P+b*A)*q,t[7]=(v*S-g*R-b*T)*q,t[8]=(g*P-_*S+b*w)*q,t):null}function QGe(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function KGe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function e6e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function t6e(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function Q_e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function i6e(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function r6e(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function s6e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function n6e(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],p=e[1],f=e[2],g=e[3],_=e[4],v=e[5],b=e[6],w=e[7],T=e[8],S=go();return Math.abs(i-h)<=S*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-p)<=S*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-f)<=S*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-T)<=S*Math.max(1,Math.abs(u),Math.abs(T))}function o6e(t){const e=go(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const a6e=gC,l6e=Q_e;Object.freeze(Object.defineProperty({__proto__:null,add:t6e,adjoint:HGe,copy:jGe,determinant:qGe,equals:n6e,exactEquals:s6e,frob:e6e,fromMat2d:JGe,fromMat4:$u,fromQuat:eR,fromRotation:XGe,fromScaling:ZGe,fromTranslation:YGe,identity:rU,invert:c$,isOrthoNormal:o6e,mul:a6e,multiply:gC,multiplyScalar:i6e,multiplyScalarAndAdd:r6e,normalFromMat4:d0,normalFromMat4Legacy:J_e,projection:QGe,rotate:sU,scale:u$,scaleByVec2:WGe,set:WX,str:KGe,sub:l6e,subtract:Q_e,translate:yC,transpose:mx},Symbol.toStringTag,{value:"Module"}));const c6e=new We(vfe),DS=new We(hk),NS=new We(dk),u6e=new We(bfe);function qs(t){const e=Oie.get(t);if(e)return e;let i=c6e;if(t)if(t===DS)i=DS;else if(t===NS)i=NS;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)j2(r)||j2(s)?i=DS:(H2(r)||H2(s))&&(i=NS);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===h6e?i=DS:o===d6e&&(i=NS)}}}return Oie.set(t,i),i}const Oie=new Map,h6e=DS.wkt.toUpperCase(),d6e=NS.wkt.toUpperCase();function K_e(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function p6e(t,e,i){return K_e(t,e,i),Pc(i,i),i}function Io(t,e,i,r){if(t==null||r==null)return!1;const s=r4(t,vze),n=r4(r,bze);if(s===n&&!Rie(n)&&(s!==re.UNKNOWN||ls(t,r)))return ux(i,e),!0;if(Rie(n)){const o=uM[s][re.LON_LAT],a=uM[re.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,X0,0),a(X0,0,Z0,0),K_e(E3*X0[0],E3*X0[1],i),i[12]=Z0[0],i[13]=Z0[1],i[14]=Z0[2],!0)}if(!(n!==re.WEB_MERCATOR&&n!==re.PLATE_CARREE&&n!==re.WGS84&&n!==re.CGCS2000||s!==re.WGS84&&s!==re.SPHERICAL_ECEF&&s!==re.WEB_MERCATOR&&s!==re.CGCS2000)){const o=uM[s][re.LON_LAT],a=uM[re.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,X0,0),a(X0,0,Z0,0),s===re.SPHERICAL_ECEF?p6e(E3*X0[0],E3*X0[1],i):Ih(i),i[12]=Z0[0],i[13]=Z0[1],i[14]=Z0[2],!0)}return!1}function Rie(t){return t===re.SPHERICAL_ECEF||t===re.SPHERICAL_MARS_PCPF||t===re.SPHERICAL_MOON_PCPF}const E3=xt(1),X0=C(),Z0=C();let YX=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};YX.ElementCount=9;let XX=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};XX.ElementCount=16;let A0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};A0.ElementCount=1;function ta(t,e){return t[0]=e[0],t[1]=e[1],t}function bi(t,e,i){return t[0]=e,t[1]=i,t}function Cd(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Rf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function eve(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function tve(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function f6e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function m6e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function g6e(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function y6e(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function _6e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function mu(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function v6e(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function iv(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function m4(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function ZX(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function ive(t){const e=t[0],i=t[1];return e*e+i*i}function rve(t,e){return t[0]=-e[0],t[1]=-e[1],t}function b6e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function tR(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function wn(t,e){return t[0]*e[0]+t[1]*e[1]}function w6e(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function gh(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function x6e(t,e){e=e||1;const i=2*WR()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function sve(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function T6e(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function S6e(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function C6e(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function E6e(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function A6e(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function M6e(t){return"vec2("+t[0]+", "+t[1]+")"}function nve(t,e){return t[0]===e[0]&&t[1]===e[1]}function ove(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=go();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function P6e(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const O6e=ZX,R6e=Rf,$6e=eve,I6e=tve,ave=iv,L6e=m4,D6e=ive;Object.freeze(Object.defineProperty({__proto__:null,add:Cd,angle:A6e,ceil:f6e,copy:ta,cross:w6e,dist:ave,distance:iv,div:I6e,divide:tve,dot:wn,equals:ove,exactEquals:nve,floor:m6e,inverse:b6e,len:O6e,length:ZX,lerp:gh,max:y6e,min:g6e,mul:$6e,multiply:eve,negate:rve,normalize:tR,projectAndScale:P6e,random:x6e,rotate:E6e,round:_6e,scale:mu,scaleAndAdd:v6e,set:bi,sqrDist:L6e,sqrLen:D6e,squaredDistance:m4,squaredLength:ive,str:M6e,sub:R6e,subtract:Rf,transformMat2:sve,transformMat2d:T6e,transformMat3:S6e,transformMat4:C6e},Symbol.toStringTag,{value:"Module"}));let M0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,bi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};M0.ElementCount=2;let P0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,te(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};P0.ElementCount=3;let O0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Zr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};O0.ElementCount=4;let nU=class lve extends A0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new lve(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};nU.ElementType="f32";let gx=class tq extends M0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(tq,e,i)}static fromTypedArray(e,i){return new tq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gx.ElementType="f32";let Xn=class iq extends P0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(iq,e,i)}static fromTypedArray(e,i){return new iq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Xn.ElementType="f32";let gp=class rq extends O0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(rq,e,i)}static fromTypedArray(e,i){return new rq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gp.ElementType="f32";let rv=class sq extends YX{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(sq,e,i)}static fromTypedArray(e,i){return new sq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rv.ElementType="f32";let JX=class nq extends YX{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(nq,e,i)}static fromTypedArray(e,i){return new nq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};JX.ElementType="f64";let QX=class oq extends XX{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(oq,e,i)}static fromTypedArray(e,i){return new oq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};QX.ElementType="f32";let iR=class aq extends XX{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(aq,e,i)}static fromTypedArray(e,i){return new aq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iR.ElementType="f64";let KX=class lq extends A0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(lq,e,i)}static fromTypedArray(e,i){return new lq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KX.ElementType="f64";let eZ=class cq extends M0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(cq,e,i)}static fromTypedArray(e,i){return new cq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};eZ.ElementType="f64";let Lh=class uq extends P0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(uq,e,i)}static fromTypedArray(e,i){return new uq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Lh.ElementType="f64";let oU=class hq extends O0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(hq,e,i)}static fromTypedArray(e,i){return new hq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};oU.ElementType="f64";let _C=class dq extends A0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(dq,e,i)}static fromTypedArray(e,i){return new dq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_C.ElementType="u8";let aU=class pq extends M0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(pq,e,i)}static fromTypedArray(e,i){return new pq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};aU.ElementType="u8";let lU=class fq extends P0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(fq,e,i)}static fromTypedArray(e,i){return new fq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lU.ElementType="u8";let Ma=class mq extends O0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(mq,e,i)}static fromTypedArray(e,i){return new mq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ma.ElementType="u8";let cU=class gq extends A0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(gq,e,i)}static fromTypedArray(e,i){return new gq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cU.ElementType="u16";let tZ=class yq extends M0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(yq,e,i)}static fromTypedArray(e,i){return new yq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tZ.ElementType="u16";let uU=class _q extends P0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(_q,e,i)}static fromTypedArray(e,i){return new _q(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uU.ElementType="u16";let h$=class vq extends O0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(vq,e,i)}static fromTypedArray(e,i){return new vq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h$.ElementType="u16";let hU=class bq extends A0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(bq,e,i)}static fromTypedArray(e,i){return new bq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hU.ElementType="u32";let iZ=class wq extends M0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(wq,e,i)}static fromTypedArray(e,i){return new wq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iZ.ElementType="u32";let cve=class xq extends P0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(xq,e,i)}static fromTypedArray(e,i){return new xq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cve.ElementType="u32";let uve=class Tq extends O0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(Tq,e,i)}static fromTypedArray(e,i){return new Tq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uve.ElementType="u32";let rZ=class Sq extends A0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Sq,e,i)}static fromTypedArray(e,i){return new Sq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rZ.ElementType="i8";let dU=class Cq extends M0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Cq,e,i)}static fromTypedArray(e,i){return new Cq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dU.ElementType="i8";let hve=class Eq extends P0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Eq,e,i)}static fromTypedArray(e,i){return new Eq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hve.ElementType="i8";let dve=class Aq extends O0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Aq,e,i)}static fromTypedArray(e,i){return new Aq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dve.ElementType="i8";let pve=class Mq extends A0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Mq,e,i)}static fromTypedArray(e,i){return new Mq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};pve.ElementType="i16";let d$=class Pq extends M0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Pq,e,i)}static fromTypedArray(e,i){return new Pq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};d$.ElementType="i16";let fve=class Oq extends P0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Oq,e,i)}static fromTypedArray(e,i){return new Oq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fve.ElementType="i16";let mve=class Rq extends O0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Rq,e,i)}static fromTypedArray(e,i){return new Rq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mve.ElementType="i16";let gve=class $q extends A0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer($q,e,i)}static fromTypedArray(e,i){return new $q(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gve.ElementType="i32";let yve=class Iq extends M0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Iq,e,i)}static fromTypedArray(e,i){return new Iq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yve.ElementType="i32";let _ve=class Lq extends P0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Lq,e,i)}static fromTypedArray(e,i){return new Lq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_ve.ElementType="i32";let vve=class Dq extends O0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Dq,e,i)}static fromTypedArray(e,i){return new Dq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vve.ElementType="i32";function N6e(t,e,i){yp(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function yp(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],h=i[6],p=i[8],f=i[9],g=i[10],_=i[12],v=i[13],b=i[14];let w=0,T=0;for(let S=0;S<n;S++){const A=e[w],P=e[w+1],R=e[w+2];t[T]=o*A+c*P+p*R+_,t[T+1]=a*A+u*P+f*R+v,t[T+2]=l*A+h*P+g*R+b,w+=s,T+=r}return t}function bve(t,e,i){uE(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function uE(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],p=i[6],f=i[7],g=i[8];let _=0,v=0;for(let b=0;b<n;b++){const w=e[_],T=e[_+1],S=e[_+2];t[v]=o*w+c*T+p*S,t[v+1]=a*w+u*T+f*S,t[v+2]=l*w+h*T+g*S,_+=s,v+=r}}function F6e(t,e,i){g4(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function g4(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function vC(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function k6e(t,e){bC(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function bC(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],h=l*l+c*c+u*u;if(h>0){const p=1/Math.sqrt(h);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}n+=r,o+=i}}function U6e(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:bC,normalizeView:k6e,scale:g4,scaleView:F6e,shiftRight:U6e,transformMat3:uE,transformMat3View:bve,transformMat4:yp,transformMat4View:N6e,translate:vC},Symbol.toStringTag,{value:"Module"}));const z6e=()=>le.getLogger("esri.views.3d.support.buffer.math");function B6e(t,e,i){if(t.count!==e.count)return;const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],f=i[9],g=i[10],_=i[11],v=i[12],b=i[13],w=i[14],T=i[15],S=t.typedBuffer,A=t.typedBufferStride,P=e.typedBuffer,R=e.typedBufferStride;for(let F=0;F<r;F++){const k=F*A,N=F*R,j=P[N],z=P[N+1],X=P[N+2],q=P[N+3];S[k]=s*j+l*z+p*X+v*q,S[k+1]=n*j+c*z+f*X+b*q,S[k+2]=o*j+u*z+g*X+w*q,S[k+3]=a*j+h*z+_*X+T*q}}function V6e(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return void z6e().error("source and destination buffers need to have the same number of elements");const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],p=i[6],f=i[7],g=i[8],_=i[9],v=i[10],b=i[11],w=i[12],T=i[13],S=i[14],A=i[15];let P=0,R=0;for(let F=0;F<n;F++){const k=e[P],N=e[P+1],j=e[P+2],z=e[P+3];t[R]=o*k+u*N+g*j+w*z,t[R+1]=a*k+h*N+_*j+T*z,t[R+2]=l*k+p*N+v*j+S*z,t[R+3]=c*k+f*N+b*j+A*z,P+=s,R+=r}}function G6e(t,e,i){pU(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function pU(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],p=i[6],f=i[7],g=i[8];let _=0,v=0;for(let b=0;b<n;b++){const w=e[_],T=e[_+1],S=e[_+2],A=e[_+3];t[v]=o*w+c*T+p*S,t[v+1]=a*w+u*T+f*S,t[v+2]=l*w+h*T+g*S,t[v+3]=A,_+=s,v+=r}}function j6e(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,u=n[c],h=n[c+1],p=n[c+2],f=u*u+h*h+p*p;if(f>0){const g=1/Math.sqrt(f);r[l]=g*u,r[l+1]=g*h,r[l+2]=g*p}}}function H6e(t,e,i){y4(t.typedBuffer,e,i,t.typedBufferStride)}function y4(t,e,i,r=4){const s=Math.min(t.length/r,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=i*n[a],t[l+1]=i*n[a+1],t[l+2]=i*n[a+2],t[l+3]=i*n[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:j6e,scale:y4,scaleView:H6e,transformMat3:pU,transformMat3View:G6e,transformMat4:V6e,transformMat4View:B6e},Symbol.toStringTag,{value:"Module"}));const p0="Projection may be possible after calling projection.load().";function bs(t,e,i,r){t.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${i.wkid}).${r?" ":""}${r}`)}function p$(t,e,i,r,s){return _U(f0.TO_PCPF,Xn.fromTypedArray(t),Ca.NORMAL,Lh.fromTypedArray(e),Lh.fromTypedArray(i),r,Xn.fromTypedArray(s))?s:null}function fU(t,e,i,r,s){return _U(f0.FROM_PCPF,Xn.fromTypedArray(t),Ca.NORMAL,Lh.fromTypedArray(e),Lh.fromTypedArray(i),r,Xn.fromTypedArray(s))?s:null}function mU(t,e,i){return jr(t,e,0,i,qs(e),0,t.length/3)?i:null}function gU(t,e,i){return jr(t,qs(i),0,e,i,0,t.length/3)?e:null}function rR(t,e,i){return d0(Fn,i),uE(e,t,Fn),zF(Fn)&&bC(e,e),e}function sR(t,e,i){return $u(Fn,i),pU(e,t,Fn),zF(Fn)&&bC(e,e,4),e}function Nq(t,e,i,r){const s=e===Ca.NORMAL;return wve(t,e,i,(n,o)=>{const a=Math.cos(xt(n));o[0]=s?a:1/a,o[1]=1},r)}function Fq(t,e,i,r){const s=e===Ca.NORMAL;return wve(t,e,i,(n,o)=>{const a=Math.cosh(-n/ji.radius);o[0]=1,o[1]=s?a:1/a},r)}function wve(t,e,i,r,s){const n=e===Ca.NORMAL?3:4,o=[0,0];for(let a=0,l=1;a<t.length;a+=n,l+=3){r(i[l],o);const c=t[a]*o[0],u=t[a+1]*o[1],h=t[a+2],p=1/Math.sqrt(c*c+u*u+h*h);s[a]=c*p,s[a+1]=u*p,s[a+2]=h*p,n===4&&(s[a+3]=t[a+3])}return s}function f$(t,e,i,r,s){if(!_U(f0.TO_PCPF,Xn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Ca.TANGENT,Lh.fromTypedArray(e),Lh.fromTypedArray(i),r,Xn.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function yU(t,e,i,r,s){if(!_U(f0.FROM_PCPF,Xn.fromTypedArray(t,16),Ca.TANGENT,Lh.fromTypedArray(e),Lh.fromTypedArray(i),r,Xn.fromTypedArray(s,16)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}var Ca,f0;function $ie(t,e,i,r,s){switch(Io(r,i,Fg,r),t===f0.FROM_PCPF&&Is(Fg,Fg),e){case Ca.NORMAL:return d0(s,Fg);case Ca.TANGENT:return $u(s,Fg)}}function _U(t,e,i,r,s,n,o){if(!e)return;const a=r.count,l=qs(n);if(Y6e(n))for(let c=0;c<a;c++)s.getVec(c,A3),e.getVec(c,$p),On($p,$p,$ie(t,i,A3,l,Fn)),o.setVec(c,$p);else for(let c=0;c<a;c++){s.getVec(c,A3),e.getVec(c,$p);const u=LF(r.get(c,1));let h=Math.cos(u);i===Ca.TANGENT!=(t===f0.TO_PCPF)&&(h=1/h),$ie(t,i,A3,l,Fn),t===f0.TO_PCPF?(Fn[0]*=h,Fn[1]*=h,Fn[2]*=h,Fn[3]*=h,Fn[4]*=h,Fn[5]*=h):(Fn[0]*=h,Fn[3]*=h,Fn[6]*=h,Fn[1]*=h,Fn[4]*=h,Fn[7]*=h),On($p,$p,Fn),fe($p,$p),o.setVec(c,$p)}return o}function sZ(t){return t.vertexSpace.type==="local"?q6e(t):W6e(t)}function q6e({vertexSpace:t,transform:e,inSpatialReference:i,outSpatialReference:r,localMode:s,outPositions:n,positions:o}){const a=t.origin??xs,l=t.origin!=null?e?.localMatrix??Cr:Cr,c=qs(i),u=r.isWebMercator&&s||!Vl(i,c)?i:c;Io(i,a,Fg,u),Ai(Fg,Fg,l);const h=n??jn(o.length);return yp(h,o,Fg),jr(h,u,0,h,r,0,h.length/3),h}function W6e({vertexSpace:t,transform:e,outPositions:i,positions:r,inSpatialReference:s,outSpatialReference:n}){const o=t.origin!=null?e?.localMatrix??Cr:Cr,a=i??jn(r.length);Hk(o,Cr)?yGe(a,r):yp(a,r,o);const l=t.origin??xs;if(!ho(l,xs)){const[c,u,h]=l;for(let p=0;p<a.length;p+=3)a[p]+=c,a[p+1]+=u,a[p+2]+=h}return jr(a,s,0,a,n,0,a.length/3)?a:null}function Y6e(t){return t.isWGS84||G2(t)||ex(t)||tx(t)}(function(t){t[t.NORMAL=0]="NORMAL",t[t.TANGENT=1]="TANGENT"})(Ca||(Ca={})),function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}(f0||(f0={}));const A3=C(),$p=C(),Fg=xe(),Fn=yr(),k$t=Object.freeze(Object.defineProperty({__proto__:null,get VectorType(){return Ca},loadProjectErrorMessage:p0,logProjectionError:bs,project:sZ,projectFromPCPF:gU,projectNormalFromPCPF:fU,projectNormalToPCPF:p$,projectTangentFromPCPF:yU,projectTangentToPCPF:f$,projectToPCPF:mU,transformNormal:rR,transformTangent:sR,transformVectorENUPlateCarree:Nq,transformVectorWMPlateCarree:Fq},Symbol.toStringTag,{value:"Module"}));function X6e([t,e,i,r,s,n],o,a,l){Iie??(Iie=new Float64Array(24));const c=Iie;return c[0]=t,c[1]=e,c[2]=i,c[3]=t,c[4]=s,c[5]=i,c[6]=r,c[7]=s,c[8]=i,c[9]=r,c[10]=e,c[11]=i,c[12]=t,c[13]=e,c[14]=n,c[15]=t,c[16]=s,c[17]=n,c[18]=r,c[19]=s,c[20]=n,c[21]=r,c[22]=e,c[23]=n,sZ({positions:c,transform:o,vertexSpace:a,inSpatialReference:l,outSpatialReference:l,outPositions:c}),Tve(c,l)}let Iie=null;function xve(t){if(t.length===0)return nX;const e=pn([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY]);return Tc(e,t),e}function Tve(t,e){const[i,r,s,n,o,a]=xve(t);return new Qi({xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a,spatialReference:e})}function ts(t,e,i,r){if(Vl(t.spatialReference,i)){M3[0]=t.x,M3[1]=t.y;const n=t.z;return M3[2]=n??r??0,jr(M3,t.spatialReference,0,e,i,0,1)}const s=ev(t,i);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??r??0,!0)}async function _4(t,e,i,r,s){return await i$(t.spatialReference,i,null,s),ts(t,e,i,r)}const M3=C();function nZ(t,e,i,r){if(r!==void 0){o0(t(),"option: geographic",{replacement:"Use mesh `vertexSpace` and spatial reference to control how operations are performed instead.",version:"4.30",warnOnce:!0});const s=e.type==="local";if(!h0(e)||r===s)return i.isGeographic||i.isWebMercator&&r;t().warnOnce(`Specifying the 'geographic' parameter (${r}) for a Mesh vertex space of type "${e.type}" is not supported. This parameter will be ignored.`)}switch(e.type){case"georeferenced":return i.isGeographic;case"local":return i.isGeographic||i.isWebMercator}}const Dh=()=>le.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function Sve(t,e,{vertexSpace:i,spatialReference:r}){if(i.type==="georeferenced"){const c=t;if(!ts(e,c,r))return!1;const{origin:u}=i;return _e(t,c,u),!0}const s=qs(r),n=t;if(!ts(e,n,s))return!1;const{origin:o}=i,a=Lie;if(!Io(r,o,a,s))return!1;const l=Is(Lie,a);return l!=null&&(Ve(t,n,l),!0)}function kq(t,e,i){const{vertexSpace:r,transform:s,vertexAttributes:n}=t,o=vU(t.spatialReference,i,_p.SOURCE|_p.TARGET);if(gGe(r,e)&&(!s||jk(s.localMatrix,Cr))&&TDe(o,1)){const{position:a,normal:l,tangent:c}=n,u=i?.allowBufferReuse;return{position:u?a:a.slice(),normal:u?l:l?.slice(),tangent:u?c:c?.slice()}}switch(t.vertexSpace.type){case"local":return e.type==="local"?eje(t,t.vertexSpace,e.origin,i):J6e(t,t.vertexSpace,e.origin,i);case"georeferenced":return e.type==="local"?Q6e(t,t.vertexSpace,e.origin,i):Z6e(t,t.vertexSpace,e.origin,i)}}function Z6e({vertexAttributes:t,transform:e,spatialReference:i},{origin:r},s,n){const{position:o,normal:a,tangent:l}=e?oZ(t,e.localMatrix):t,c=new Float64Array(o.length);let u=o;if(r&&(u=vC(c,u,r)),s){const p=Yn(Eve,s);u=vC(c,u,p)}vU(i,n,_p.NONE);const h=n?.allowBufferReuse;return{position:u!==t.position||h?u:u.slice(),normal:a!==t.normal||h?a:a?.slice(),tangent:l!==t.tangent||h?l:l?.slice()}}function J6e({spatialReference:t,vertexAttributes:e,transform:i},{origin:r},s,n){const o=qs(t);if(!Io(t,r,Wa,o))return bs(Dh(),t,o),null;i&&Ai(Wa,Wa,i.localMatrix),Cve(Wa,t,n,_p.SOURCE);const a=new Float64Array(e.position.length),l=tje(e.position,Wa,t,a);if(!l)return null;const c=ije(l,a,e.normal,Wa,t);if(e.normal&&!c)return null;const u=rje(l,a,e.tangent,Wa,t);if(e.tangent&&!u)return null;if(s){const h=Yn(Eve,s);vC(l,l,h)}return{position:l,normal:c,tangent:u}}function Q6e({vertexAttributes:t,spatialReference:e,transform:i},{origin:r},s,n){const o=qs(e);if(!Io(e,s,Wa,o))return bs(Dh(),e,o),null;const a=1/vU(e,n,_p.TARGET);E0(Wa,Wa,[a,a,a]);const l=Is(AM,Wa),{position:c,normal:u,tangent:h}=K6e(t,r,i),p=new Float64Array(c.length),f=sje(c,e,l,p);if(!f)return null;const g=d0(aje,l),_=nje(u,c,p,e,g,u!==t.normal?u:void 0);if(!_&&u)return null;const v=oje(h,c,p,e,g,h!==t.tangent?h:void 0);return!v&&h?null:{position:f,normal:_,tangent:v}}function K6e(t,e,i){if(!e)return t;if(!i){const{position:s,normal:n,tangent:o}=t;return{position:vC(new Float64Array(s.length),s,e),tangent:o,normal:n}}const r=oZ(t,i.localMatrix);return vC(r.position,r.position,e),r}function eje({vertexAttributes:t,spatialReference:e,transform:i},{origin:r},s,n){const o=qs(e);if(!Io(e,r,Wa,o))return bs(Dh(),e,o),null;if(i&&Ai(Wa,Wa,i.localMatrix),!Io(e,s,AM,o))return bs(Dh(),o,e),null;Is(AM,AM);const a=Ai(Wa,AM,Wa);return Cve(a,e,n,_p.SOURCE|_p.TARGET),oZ(t,a)}function oZ(t,e){const i=new Float64Array(t.position.length);yp(i,t.position,e);const r=t.normal?new Float32Array(t.normal.length):null,s=t.tangent?new Float32Array(t.tangent.length):null;return r&&t.normal&&rR(t.normal,r,e),s&&t.tangent&&sR(t.tangent,s,e),{position:i,normal:r,tangent:s}}function tje(t,e,i,r){yp(r,t,e);const s=new Float64Array(t.length);return gU(r,s,i)?s:(bs(Dh(),qs(i),i),null)}function ije(t,e,i,r,s){if(i==null)return null;const n=new Float32Array(i.length);return rR(i,n,r),fU(n,t,e,s,n)?n:(bs(Dh(),qs(s),s),null)}function rje(t,e,i,r,s){if(i==null)return null;const n=new Float32Array(i.length);return sR(i,n,r),yU(n,t,e,s,n)?n:(bs(Dh(),qs(s),s),null)}function Cve(t,e,i,r){const s=vU(e,i,r);s!==1&&E0(t,t,[s,s,s])}function vU(t,e,i){const r=!!(i&_p.SOURCE),s=!!(i&_p.TARGET),n=e?.sourceUnit,o=e?.targetUnit;if(!n&&!o)return 1;let a=Uq(n,t);!r&&n&&a!==1&&(Dh().warn("source unit conversion not supported"),a=1);let l=1/Uq(o,t);return!s&&o&&l!==1&&(Dh().warn("target unit conversion not supported"),l=1),a*l}function sje(t,e,i,r){const s=mU(t,e,r);if(!s)return bs(Dh(),e,qs(e)),null;const n=new Float64Array(s.length);return yp(n,s,i),n}function nje(t,e,i,r,s,n){if(t==null)return null;const o=n??new Float32Array(t.length);return p$(t,e,i,r,o)?(uE(o,o,s),o):(bs(Dh(),r,qs(r)),null)}function oje(t,e,i,r,s,n){if(t==null)return null;const o=n??new Float32Array(t.length);return f$(t,e,i,r,o)?(uE(o,o,s,4),o):(bs(Dh(),r,qs(r)),null)}function Uq(t,e){if(t==null)return 1;const i=Cj(e);return 1/Cn(i,"meters",t)}const Wa=xe(),AM=xe(),aje=yr(),Eve=C(),Lie=xe();var _p;(function(t){t[t.NONE=0]="NONE",t[t.SOURCE=1]="SOURCE",t[t.TARGET=2]="TARGET"})(_p||(_p={}));const nR=()=>le.getLogger("esri.geometry.support.meshUtils.centerAt");function lje(t,e,i){if(!t.vertexAttributes?.position)return;const{vertexSpace:r}=t,s=i?.origin??t.anchor,n=nZ(nR,r,s.spatialReference,i?.geographic);h0(r)?cje(t,e,s):n?uje(t,e,s):hje(t,e,s)}function cje(t,e,i){const{vertexSpace:r}=t;if(!h0(r))return;const s=Mve,n=Ave;if(!ts(e,n,t.spatialReference))return void bs(nR(),e.spatialReference,t.spatialReference,p0);if(!ts(i,s,t.spatialReference)){const a=t.origin;return s[0]=a.x,s[1]=a.y,s[2]=a.z,void bs(nR(),i.spatialReference,t.spatialReference,p0)}const o=_e(pje,n,s);r.origin=me(C(),r.origin,o)}function uje(t,e,i){const r=Ce(i.x,i.y,i.z??0),s=kq(t,new h4({origin:r}));if(!s)return;const n=Ce(e.x,e.y,e.z??0),o=kq({vertexAttributes:s,spatialReference:t.spatialReference,vertexSpace:new h4({origin:n})},new JO);if(!o)return;const{position:a,normal:l,tangent:c}=o;t.vertexAttributes.position=a,t.vertexAttributes.normal=l,t.vertexAttributes.tangent=c,t.vertexAttributesChanged()}function hje(t,e,i){const r=Mve,s=Ave;if(ts(e,s,t.spatialReference)){if(!ts(i,r,t.spatialReference)){const n=t.origin;return r[0]=n.x,r[1]=n.y,r[2]=n.z,void bs(nR(),i.spatialReference,t.spatialReference,p0)}dje(t.vertexAttributes.position,s,r),t.vertexAttributesChanged()}else bs(nR(),e.spatialReference,t.spatialReference,p0)}function dje(t,e,i){if(t)for(let r=0;r<t.length;r+=3)for(let s=0;s<3;s++)t[r+s]+=e[s]-i[s]}const Ave=C(),Mve=C(),pje=C();async function fje(t,e,i){const{source:r}=e,{loadGLTFMesh:s}=await sY(ue(()=>import("./loadGLTFMesh-54c5794f.js"),[],import.meta.url),i),n=await gje(r,i);yt(i);const o=s(new Xe({x:0,y:0,z:0,spatialReference:t.spatialReference}),n.url,{resolveFile:mje(n),signal:i?.signal,expectedType:n.type});o.then(()=>n.dispose(),()=>n.dispose());const{vertexAttributes:a,components:l}=await o;t.vertexAttributes=a,t.components=l}function mje(t){const e=ck(t.url);return i=>{const r=lk(i,e,e),s=r?r.replace(/^ *\.\//,""):null;return(s?t.files.get(s):null)??i}}async function gje(t,e){if(Array.isArray(t)){if(!t.length)throw new W("mesh-load-external:missing-assets","There must be at least one file to load");return t[0]instanceof File?_je(t):vje(t,e)}return Pve(t)}async function yje(t,e){const{parts:i,assetMimeType:r,assetName:s}=t;if(i.length===1)return new v4(i[0].partUrl);const n=await t.toBlob(e);return yt(e),v4.fromBlob(n,Lve(s,r))}function Pve(t){return v4.fromBlob(t,Lve(t.name,t.type))}function _je(t){return $ve(t.map(e=>({name:e.name,mimeType:e.type,source:Pve(e)})))}async function vje(t,e){const i=await bF(t.map(async r=>{const s=await yje(r);return yt(e),{name:r.assetName,mimeType:r.assetMimeType,source:s}}));if(qn(e))throw i.forEach(r=>r.source.dispose()),vi();return $ve(i)}const Ove=/^model\/gltf\+json$/,Rve=/^model\/gltf-binary$/,zq=/\.gltf$/i,bje=/\.glb$/i;function $ve(t){const e=new Map;let i,r=null;for(const{name:s,mimeType:n,source:o}of t)r===null&&(Ove.test(n)||zq.test(s)?(r=o.url,i="gltf"):(Rve.test(n)||bje.test(s))&&(r=o.url,i="glb")),e.set(s,o.url),o.files.forEach((a,l)=>e.set(l,a));if(r==null)throw new W("mesh-load-external:missing-files","Missing files to load external mesh source");return new v4(r,()=>t.forEach(({source:s})=>s.dispose()),e,i)}let v4=class Ive{constructor(e,i=()=>{},r=new Map,s){this.url=e,this.dispose=i,this.files=r,this.type=s}static fromBlob(e,i){const r=URL.createObjectURL(e);return new Ive(r,()=>URL.revokeObjectURL(r),void 0,i)}};function Lve(t,e){return Ove.test(e)||zq.test(t)?"gltf":Rve.test(e)||zq.test(t)?"glb":void 0}const wje=[["binary","application/octet-stream","bin",""]];function U$t(t,e){return kve(e.name,t?.supportedFormats??[])!=null}function z$t(t,e){if(!t)return!1;const i=Fve(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function Dve(t,e){return lZ(Tje(t,e))}function Nve(t,e){return lZ(kve(t,e))}function B$t(t,e){return Uve(xje(t,e))}function Fve(t,e){return Nve(t.name,e)??Dve(t.type,e)}function aZ(t){return[...wje,...t]}function xje(t,e){return aZ(e).find(i=>lZ(i)===t)}function Tje(t,e){const i=t.toLowerCase();return aZ(e).find(r=>Uve(r)===i)}function kve(t,e){const i=t.toLowerCase();return aZ(e).find(r=>Sje(r).some(s=>i.endsWith(s)))}function lZ(t){return t?.[0]}function Uve(t){return t?.[1].toLowerCase()}function Sje(t){return t?.[2].split(",").map(e=>e.toLowerCase())??[]}function V$t(t){return t.tables?.find(e=>e.role==="assetMaps")}let zve=class{constructor(e,i,r){this.assetName=e,this.assetMimeType=i,this.parts=r}equals(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&s0(this.parts,e.parts,(i,r)=>i.equals(r))}isOnService(e){return this.parts.every(i=>i.isOnService(e))}makeHash(){let e="";for(const i of this.parts)e+=i.partHash;return e}async toBlob(e){const{parts:i}=this;if(i.length===1)return i[0].toBlob(e);const r=await Promise.all(i.map(s=>s.toBlob(e)));return yt(e),new Blob(r)}},j$t=class{constructor(e,i){this.partUrl=e,this.partHash=i}equals(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}isOnService(e){return this.partUrl.startsWith(`${e.path}/assets/`)}async toBlob(e){const{data:i}=await Yi(this.partUrl,{responseType:"blob"});return yt(e),i}};function Die(t){return Cje(t?.source)}function Nie(t){return Array.isArray(t)?t.every(e=>e instanceof zve):!1}const Fie=/^(model\/gltf\+json)|(model\/gltf-binary)$/,kie=/\.(gltf|glb)/i;function Cje(t){return t?Array.isArray(t)?t.some(Uie):Uie(t):!1}function Uie(t){if(t instanceof File){const{type:e,name:i}=t;return Fie.test(e)||kie.test(i)}return Fie.test(t.assetMimeType)||kie.test(t.assetName)}function Eje(t,e){if(!t)return!1;const{source:i}=t;return Mje(i,e)}function Aje(t,e){if(t===e)return!0;const{source:i}=t,{source:r}=e;if(i===r)return!0;if(Nie(i)&&Nie(r)){if(i.length!==r.length)return!1;const s=(a,l)=>a.assetName<l.assetName?-1:a.assetName>l.assetName?1:0,n=[...i].sort(s),o=[...r].sort(s);for(let a=0;a<n.length;++a)if(!n[a].equals(o[a]))return!1;return!0}return!1}function Mje(t,e){if(Array.isArray(t)){const i=t;return i.length>0&&i.every(r=>zie(r,e))}return zie(t,e)}function zie(t,e){return t instanceof zve&&t.isOnService(e)}function q$t(t,e){return t instanceof File?Fve(t,e):Dve(t.assetMimeType,e)??Nve(t.assetName,e)}function W$t(t){return Array.isArray(t)?t:[t]}function Y$t(t){return!!t.original}let i_=class extends q_{constructor(e){super(e),this.externalSources=new lt,this._explicitDisplaySource=null,this.addHandles(yo(()=>this.externalSources,"after-remove",({item:i})=>{i===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!Die(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(i=>!Aje(i,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(i=>Eje(i,e))}get _implicitDisplaySource(){return this.externalSources.find(Die)}};d([m()],i_.prototype,"externalSources",void 0),d([m()],i_.prototype,"displaySource",null),d([m()],i_.prototype,"_implicitDisplaySource",null),d([m()],i_.prototype,"_explicitDisplaySource",void 0),i_=d([U("esri.geometry.support.meshUtils.Metadata")],i_);function Pje(){const{faceDescriptions:t,faceVertexOffsets:e,uvScales:i}=kje,r=4*t.length,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(2*t.length*3);let l=0,c=0,u=0,h=0;for(let p=0;p<t.length;p++){const f=t[p],g=l/3;for(const v of e)a[h++]=g+v;const _=f.corners;for(let v=0;v<4;v++){const b=_[v];let w=0;o[u++]=.25*i[v][0]+f.uvOrigin[0],o[u++]=f.uvOrigin[1]-.25*i[v][1];for(let T=0;T<3;T++)f.axis[T]!==0?(s[l++]=.5*f.axis[T],n[c++]=f.axis[T]):(s[l++]=.5*b[w++],n[c++]=0)}}return{position:s,normal:n,uv:o,faces:a}}function Oje(t,e){const i=t.components[0],r=i.faces,s=Uje[e],n=6*s,o=new Array(6),a=new Array(r.length-6);let l=0,c=0;for(let u=0;u<r.length;u++)u>=n&&u<n+6?o[l++]=r[u]:a[c++]=r[u];if(t.vertexAttributes.uv!=null){const u=new Float32Array(t.vertexAttributes.uv),h=4*s*2,p=[0,1,1,1,1,0,0,0];for(let f=0;f<p.length;f++)u[h+f]=p[f];t.vertexAttributes.uv=u}return t.components=[new zw({faces:o,material:i.material}),new zw({faces:a})],t}function Rje(t=0){const e=Math.round(8*2**t),i=2*e,r=(e-1)*(i+1)+2*i,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(3*((e-1)*i*2));let l=0,c=0,u=0,h=0;for(let p=0;p<=e;p++){const f=p/e*Math.PI+.5*Math.PI,g=Math.cos(f),_=Math.sin(f);oo[2]=_;const v=p===0||p===e,b=v?i-1:i;for(let w=0;w<=b;w++){const T=w/b*2*Math.PI;oo[0]=-Math.sin(T)*g,oo[1]=Math.cos(T)*g;for(let S=0;S<3;S++)s[l]=.5*oo[S],n[l]=oo[S],++l;o[c++]=(w+(v?.5:0))/i,o[c++]=p/e,p!==0&&w!==i&&(p!==e&&(a[u++]=h,a[u++]=h+1,a[u++]=h-i),p!==1&&(a[u++]=h,a[u++]=h-i,a[u++]=h-i-1)),h++}}return{position:s,normal:n,uv:o,faces:a}}function $je(t=0){const i=Math.round(16*2**t),r=(5-1)*(i+1)+2*i,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(3*(4*i));let l=0,c=0,u=0,h=0,p=0;for(let f=0;f<=5;f++){const g=f===0||f===5,_=f<=1||f>=5-1,v=f===2||f===4,b=g?i-1:i;for(let w=0;w<=b;w++){const T=w/b*2*Math.PI,S=g?0:.5;oo[0]=S*Math.sin(T),oo[1]=S*-Math.cos(T),oo[2]=f<=2?.5:-.5;for(let A=0;A<3;A++)s[l++]=oo[A],n[c++]=_?A===2?f<=1?1:-1:0:A===2?0:oo[A]/S;o[u++]=(w+(g?.5:0))/i,o[u++]=f<=1?1*f/3:f<=3?1*(f-2)/3+1/3:1*(f-4)/3+2/3,v||f===0||w===i||(f!==5&&(a[h++]=p,a[h++]=p+1,a[h++]=p-i),f!==1&&(a[h++]=p,a[h++]=p-i,a[h++]=p-i-1)),p++}}return{position:s,normal:n,uv:o,faces:a}}function Ije(t,e){const i=typeof e=="number"?e:e!=null?e.width:1,r=typeof e=="number"?e:e!=null?e.height:1;switch(t){case"up":case"down":return{width:i,depth:r};case"north":case"south":return{width:i,height:r};case"east":case"west":return{depth:i,height:r}}}function Lje(t){const e=BE.facingAxisOrderSwap[t],i=BE.position,r=BE.normal,s=new Float64Array(i.length),n=new Float32Array(r.length);let o=0;for(let a=0;a<4;a++){const l=o;for(let c=0;c<3;c++){const u=e[c],h=Math.abs(u)-1,p=u>=0?1:-1;s[o]=i[l+h]*p,n[o]=r[l+h]*p,o++}}return{position:s,normal:n,uv:new Float32Array(BE.uv),faces:new Uint32Array(BE.faces),isPlane:!0}}const Px=1,Ox=2,Rx=3,BE={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[Rx,Px,Ox],west:[-Rx,-Px,Ox],north:[-Px,Rx,Ox],south:[Px,-Rx,Ox],up:[Px,Ox,Rx],down:[Px,-Ox,-Rx]}};function P3(t,e,i){t.isPlane||Dje(t),Fje(t,Nje(i?.size,i?.unit,e.spatialReference));const r=d4(e,i),s=e.spatialReference.isGeographic?d4(e):r,n=kq({vertexAttributes:t,vertexSpace:s,spatialReference:e.spatialReference},r,{allowBufferReuse:!0});return{vertexAttributes:new Ga({...n,uv:t.uv}),vertexSpace:r,components:[new zw({faces:t.faces,material:i?.material||null})],spatialReference:e.spatialReference}}function Dje(t){for(let e=0;e<t.position.length;e+=3)t.position[e+2]+=.5}function Nje(t,e,i){const r=Uq(e,i);if(t==null&&r===1)return null;if(t==null)return[r,r,r];if(typeof t=="number"){const s=t*r;return[s,s,s]}return[t.width!=null?t.width*r:r,t.depth!=null?t.depth*r:r,t.height!=null?t.height*r:r]}function Fje(t,e){if(e!=null){J0[0]=e[0],J0[4]=e[1],J0[8]=e[2];for(let i=0;i<t.position.length;i+=3){for(let r=0;r<3;r++)oo[r]=t.position[i+r];On(oo,oo,J0);for(let r=0;r<3;r++)t.position[i+r]=oo[r]}if(e[0]!==e[1]||e[1]!==e[2]){J0[0]=1/e[0],J0[4]=1/e[1],J0[8]=1/e[2];for(let i=0;i<t.normal.length;i+=3){for(let r=0;r<3;r++)oo[r]=t.normal[i+r];On(oo,oo,J0),fe(oo,oo);for(let r=0;r<3;r++)t.normal[i+r]=oo[r]}}}}const kje={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Uje={south:0,east:1,north:2,west:3,up:4,down:5},oo=C(),J0=yr(),kb=()=>le.getLogger("esri.geometry.support.meshUtils.rotate");function zje(t,e,i){if(!t.vertexAttributes?.position||e[3]===0)return;const{spatialReference:r,vertexSpace:s}=t,n=i?.origin??t.anchor,o=i?.geographic,a=nZ(kb,s,r,o);F_e(t)?Bje(t,e,n):a?Vje(t,e,n):Gje(t,e,n)}function Bje(t,e,i){t.transform??(t.transform=new QO);const{vertexSpace:r,transform:s,spatialReference:n}=t,[o,a,l]=r.origin,c=new Xe({x:o,y:a,z:l,spatialReference:n}),u=FS;if(c.equals(i))te(u,0,0,0);else if(!Sve(u,i,t))return void bs(kb(),i.spatialReference,n,p0);dC(jie,e,ZO(e));const h=wX(Bie,jie,xs,Uf,u),{localMatrix:p}=s,f=Ai(Bie,h,p);s.scale=Vk(C(),f),E0(f,f,CY(FS,s.scale));const g=s.rotationAxis;s.rotation=$_e(f),s.rotationAngle===0&&(s.rotationAxis=g),s.translation=oC(C(),f)}function Vje(t,e,i){const r=t.spatialReference,s=qs(r),n=Bve;if(!ts(i,n,s)&&(bs(kb(),i.spatialReference,s,"Falling back to mesh origin"),!ts(t.origin,n,s)))return void bs(kb(),t.origin.spatialReference,s);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,h=l!=null?new Float32Array(l.length):null;Io(s,n,b4,s),$u(Gie,b4);const p=Vie;On(Vie,e,Gie),p[3]=e[3],mU(o,r,c)&&(a==null||u==null||p$(a,o,c,r,u))&&(l==null||h==null||f$(l,o,c,r,h))?(v2(c,p,3,n),gU(c,o,r)&&(a==null||u==null||(v2(u,p,3),fU(u,o,c,r,a)))&&(l==null||h==null||(v2(h,p,4),yU(h,o,c,r,l)))?t.vertexAttributesChanged():bs(kb(),s,r)):bs(kb(),r,s)}function Gje(t,e,i){const r=Bve;if(!ts(i,r,t.spatialReference)){const s=t.origin;return r[0]=s.x,r[1]=s.y,r[2]=s.z,void bs(kb(),i.spatialReference,t.spatialReference,p0)}v2(t.vertexAttributes.position,e,3,r),v2(t.vertexAttributes.normal,e,3),v2(t.vertexAttributes.tangent,e,4),t.vertexAttributesChanged()}function v2(t,e,i,r=xs){if(t!=null){Bl(b4,ZO(e),e);for(let s=0;s<t.length;s+=i){for(let n=0;n<3;n++)FS[n]=t[s+n]-r[n];Ve(FS,FS,b4);for(let n=0;n<3;n++)t[s+n]=FS[n]+r[n]}}}const FS=C(),Bie=xe(),Vie=Sp(),b4=xe(),Gie=yr(),Bve=C(),jie=Gl(),Ub=()=>le.getLogger("esri.geometry.support.meshUtils.scale");function jje(t,e,i){if(!t.vertexAttributes?.position)return;const{vertexSpace:r,spatialReference:s}=t,n=i?.origin??t.anchor,o=i?.geographic,a=nZ(Ub,r,s,o);F_e(t)?Hje(t,e,n):a?qje(t,e,n):Wje(t,e,n)}function Hje(t,e,i){t.transform??(t.transform=new QO);const{vertexSpace:r,transform:s,spatialReference:n}=t,[o,a,l]=r.origin,c=new Xe({x:o,y:a,z:l,spatialReference:n}),u=kS;if(c.equals(i))te(u,0,0,0);else if(!Sve(u,i,t))return void bs(Ub(),i.spatialReference,n,p0);const h=te(Yje,e,e,e),p=wX(Hie,Jk,xs,h,u),{localMatrix:f}=s,g=Ai(Hie,p,f);s.scale=Vk(C(),g),E0(g,g,CY(kS,s.scale));const _=s.rotationAxis;s.rotation=$_e(g),s.rotationAngle===0&&(s.rotationAxis=_),s.translation=oC(C(),g)}function qje(t,e,i){const r=t.spatialReference,s=qs(r),n=Gve;if(!ts(i,n,s)&&(bs(Ub(),i.spatialReference,s,"Falling back to mesh origin"),!ts(t.origin,n,s)))return void bs(Ub(),t.origin.spatialReference,s);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,h=l!=null?new Float32Array(l.length):null;mU(o,r,c)&&(a==null||u==null||p$(a,o,c,r,u))&&(l==null||h==null||f$(l,o,c,r,h))?(Vve(c,e,n),gU(c,o,r)&&(a==null||u==null||fU(u,o,c,r,a))&&(l==null||h==null||yU(h,o,c,r,l))?t.vertexAttributesChanged():bs(Ub(),s,r)):bs(Ub(),r,s)}function Wje(t,e,i){const r=Gve;if(!ts(i,r,t.spatialReference)){const s=t.origin;return r[0]=s.x,r[1]=s.y,r[2]=s.z,void bs(Ub(),i.spatialReference,t.spatialReference,p0)}Vve(t.vertexAttributes.position,e,r),t.vertexAttributesChanged()}function Vve(t,e,i=xs){if(t)for(let r=0;r<t.length;r+=3){for(let s=0;s<3;s++)kS[s]=t[r+s]-i[s];ie(kS,kS,e);for(let s=0;s<3;s++)t[r+s]=kS[s]+i[s]}}const kS=C(),Yje=C(),Hie=xe(),Gve=C();var Ju;const jve="esri.geometry.Mesh";function Ip(){return le.getLogger(jve)}const Xje={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:JO,local:h4}};let Na=Ju=class extends pm.LoadableMixin(e$(T0)){constructor(t){super(t),this.components=null,this.vertexSpace=new JO,this.transform=null,this.metadata=new i_,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new Ga,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(he(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(t=>t.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):this.metadata.displaySource?.extent!=null}get _transformedExtent(){const{components:t,spatialReference:e,vertexAttributes:i,vertexSpace:r}=this,s=i.position;if(s.length===0||t&&t.length===0)return new Qi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e});if(h0(r)){const{_untransformedBounds:n,transform:o}=this;return X6e(n,o,r,e)}return Tve(s,e)}get _untransformedBounds(){return xve(this.vertexAttributes.position)}get anchor(){const t=Tie(this.vertexSpace,this.spatialReference);if(t!=null)return t;const{center:e,zmin:i}=this._transformedExtent;return new Xe({x:e.x,y:e.y,z:i,spatialReference:this.spatialReference})}get origin(){const t=Tie(this.vertexSpace,this.spatialReference);return t??this._transformedExtent.center}get extent(){return this.loaded||this.metadata?.displaySource?.extent==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(t){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(zw.from(t)),this.notifyChange("components"))}removeComponent(t){if(this._checkIfLoaded("removeComponent()")){if(this.components){const e=this.components.indexOf(t);if(e!==-1)return this.components.splice(e,1),void this.notifyChange("components")}Ip().error("removeComponent()",uGe)}}rotate(t,e,i,r){return tGe(t,e,i,qie),zje(this,qie,r),this}offset(t,e,i){if(!this._checkIfLoaded("offset()"))return this;const{vertexSpace:r,vertexAttributes:s}=this,n=s?.position;if(!n)return this;if(h0(r)){const[o,a,l]=r.origin;r.origin=Ce(o+t,a+e,l+i)}else{for(let o=0;o<n.length;o+=3)n[o]+=t,n[o+1]+=e,n[o+2]+=i;this.vertexAttributesChanged()}return this}scale(t,e){return this._checkIfLoaded("scale()")?(jje(this,t,e),this):this}centerAt(t,e){return this._checkIfLoaded("centerAt()")?(lje(this,t,e),this):this}load(t){const{metadata:{displaySource:e}}=this;return e&&this.addResolvingPromise(fje(this,e,t)),Promise.resolve(this)}addExternalSources(t){this.metadata.externalSources.addMany(t)}updateDisplaySource(t){this.metadata.displaySource=t}clone(){return this.cloneAndModifyVertexAttributes(this.vertexAttributes.clone(),this.vertexSpace.clone())}cloneAndModifyVertexAttributes(t,e){let i=null;if(this.components){const s=new Map,n=new Map;i=this.components.map(o=>o.cloneWithDeduplication(s,n))}const r={components:i,spatialReference:this.spatialReference,vertexAttributes:t,vertexSpace:e,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new Ju(r)}cloneShallow(){return new Ju({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const[{toBinaryGLTF:e}]=await Promise.all([ue(()=>import("./gltfexport-30b17c61.js"),[],import.meta.url),this.load(t)]);return yt(t),await e(this,t)}get memoryUsage(){let t=0;if(t+=this.vertexAttributes.memoryUsage,this.components!=null)for(const e of this.components)t+=e.memoryUsage;return t}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(t){return!!this.loaded||(Ip().error(t,cGe),!1)}static createBox(t,e){if(!(t instanceof Xe))return Ip().error(".createBox()",xM),null;const i=new Ju(P3(Pje(),t,e));return e?.imageFace&&e.imageFace!=="all"?Oje(i,e.imageFace):i}static createSphere(t,e){return t instanceof Xe?new Ju(P3(Rje(e?.densificationFactor||0),t,e)):(Ip().error(".createSphere()",xM),null)}static createCylinder(t,e){return t instanceof Xe?new Ju(P3($je(e?.densificationFactor||0),t,e)):(Ip().error(".createCylinder()",xM),null)}static createPlane(t,e){if(!(t instanceof Xe))return Ip().error(".createPlane()",xM),null;const i=e?.facing??"up",r=Ije(i,e?.size);return new Ju(P3(Lje(i),t,{...e,size:r}))}static createFromPolygon(t,e){if(!(t instanceof mv))return Ip().error(".createFromPolygon()",hGe),null;const i=BGe(t);return new Ju({vertexAttributes:new Ga({position:i.position}),components:[new zw({faces:i.faces,shading:"flat",material:e?.material??null})],spatialReference:t.spatialReference,vertexSpace:new JO})}static async createFromGLTF(t,e,i){if(!(t instanceof Xe)){const s=new bie;throw Ip().error(".createfromGLTF()",s.message),s}const{loadGLTFMesh:r}=await sY(ue(()=>import("./loadGLTFMesh-54c5794f.js"),[],import.meta.url),i);return new Ju(await r(t,e,i))}static async createFromFiles(t,e,i){rY(Ip(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});const r=s=>Ip().error(".createFromFiles()",s.message);if(!(t instanceof Xe)){const s=new bie;throw r(s),s}if(!i?.layer)throw new W("invalid:no-layer","SceneLayer required for file to mesh conversion.");return i.layer.convertMesh(e,{location:t,...i})}static createWithExternalSource(t,e,i){const r=i?.extent??null,{spatialReference:s}=t,n=i?.transform?.clone()??new QO,o=d4(t,i),a={source:e,extent:r},l=new i_;return l.externalSources.push(a),new Ju({metadata:l,transform:n,vertexSpace:o,spatialReference:s})}static createIncomplete(t,e){const{spatialReference:i}=t,r=e?.transform?.clone()??new QO,s=d4(t,e),n=new Ju({transform:r,vertexSpace:s,spatialReference:i});return n.addResolvingPromise(Promise.reject(new W("mesh-incomplete","Mesh resources are not complete"))),n}};d([m({type:[zw],json:{write:!0}})],Na.prototype,"components",void 0),d([m({nonNullable:!0,types:Xje,constructOnly:!0,json:{write:!0}})],Na.prototype,"vertexSpace",void 0),d([m({type:QO,json:{write:!0}})],Na.prototype,"transform",void 0),d([m({constructOnly:!0})],Na.prototype,"metadata",void 0),d([m()],Na.prototype,"hasExtent",null),d([m()],Na.prototype,"_transformedExtent",null),d([m()],Na.prototype,"_untransformedBounds",null),d([m()],Na.prototype,"anchor",null),d([m()],Na.prototype,"origin",null),d([m({readOnly:!0,json:{read:!1}})],Na.prototype,"extent",null),d([m({readOnly:!0,json:{read:!1,write:!0,default:!0}})],Na.prototype,"hasZ",void 0),d([m({readOnly:!0,json:{read:!1,write:!0,default:!1}})],Na.prototype,"hasM",void 0),d([m({type:Ga,nonNullable:!0,json:{write:!0}})],Na.prototype,"vertexAttributes",void 0),Na=Ju=d([U(jve)],Na);const qie=Sp(),Zje=Na;let ZP=class extends lt{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(lt.ofType(this.itemType.Type))(e):new lt(e)}};function w4(t,e){return{type:t,cast:cX,set(i){const r=dm(i,this._get(e),t);r.owner=this,this._set(e,r)}}}d([m()],ZP.prototype,"owner",null),ZP=d([U("esri.core.support.OwningCollection")],ZP);var Wie,Yie,Hve={exports:{}};Yie=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Fm},u=Fm,h="none",p=")",f=",",g="(",_="%",v="px",b="cm",w="mm",T="in",S="pt",A="pc",P="deg",R="rad",F="grad",k="turn",N="#",j=".",z="e",X=/^[ \t\n\r]/,q=/^[a-z\-]/,Z=/^[0-9a-fA-F]/,ce=/^[+\-]/,I=/^[0-9]/,D=ll("none"),G=Kn("none",!1),H=Kn(")",!1),J=Kn(",",!1),Q=ll("whitespace"),ee=$v([" ","	",`
`,"\r"],!1,!1),de=ll("function"),we=Kn("(",!1),Re=ll("identifier"),tt=$v([["a","z"],"-"],!1,!1),Ye=ll("percentage"),qe=Kn("%",!1),He=ll("length"),je=Kn("px",!1),Jt=Kn("cm",!1),Wt=Kn("mm",!1),Le=Kn("in",!1),Dt=Kn("pt",!1),De=Kn("pc",!1),$e=ll("angle"),_t=Kn("deg",!1),bt=Kn("rad",!1),$t=Kn("grad",!1),st=Kn("turn",!1),Be=ll("number"),Ge=ll("color"),St=Kn("#",!1),jt=$v([["0","9"],["a","f"],["A","F"]],!1,!1),Wi=$v(["+","-"],!1,!1),ai=$v([["0","9"]],!1,!1),pi=Kn(".",!1),Xi=Kn("e",!1),ir=function(){return[]},Ri=function(Y,ve){return{type:"function",name:Y,parameters:ve||[]}},$i=function(Y,ve){return ve.length>0?AE(Y,ve,3):[Y]},wi=function(Y){return{type:"quantity",value:Y.value,unit:Y.unit}},Ht=function(Y){return{type:"color",colorType:Y.type,value:Y.value}},ri=function(Y){return Y},Ii=function(){return jl()},Bi=function(Y){return{value:Y,unit:"%"}},zr=function(Y){return{value:Y,unit:"px"}},Zi=function(Y){return{value:Y,unit:"cm"}},rr=function(Y){return{value:Y,unit:"mm"}},us=function(Y){return{value:Y,unit:"in"}},Ds=function(Y){return{value:Y,unit:"pt"}},vo=function(Y){return{value:Y,unit:"pc"}},al=function(Y){return{value:Y,unit:"deg"}},$n=function(Y){return{value:Y,unit:"rad"}},Jn=function(Y){return{value:Y,unit:"grad"}},fn=function(Y){return{value:Y,unit:"turn"}},hs=function(Y){return{value:Y,unit:null}},li=function(){return{type:"hex",value:jl()}},Ys=function(Y){return{type:"function",value:Y}},mn=function(){return{type:"named",value:jl()}},on=function(){return parseFloat(jl())},oe=0,Ir=0,jh=[{line:1,column:1}],Qn=0,Hh=[],pt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function jl(){return s.substring(Ir,oe)}function Kn(Y,ve){return{type:"literal",text:Y,ignoreCase:ve}}function $v(Y,ve,Ae){return{type:"class",parts:Y,inverted:ve,ignoreCase:Ae}}function Iv(){return{type:"end"}}function ll(Y){return{type:"other",description:Y}}function Nm(Y){var ve,Ae=jh[Y];if(Ae)return Ae;for(ve=Y-1;!jh[ve];)ve--;for(Ae={line:(Ae=jh[ve]).line,column:Ae.column};ve<Y;)s.charCodeAt(ve)===10?(Ae.line++,Ae.column=1):Ae.column++,ve++;return jh[Y]=Ae,Ae}function Lv(Y,ve,Ae){var fi=Nm(Y),an=Nm(ve);return{source:l,start:{offset:Y,line:fi.line,column:fi.column},end:{offset:ve,line:an.line,column:an.column}}}function Qt(Y){oe<Qn||(oe>Qn&&(Qn=oe,Hh=[]),Hh.push(Y))}function F0(Y,ve,Ae){return new e(e.buildMessage(Y,ve),Y,ve,Ae)}function Fm(){var Y;return(Y=k0())===a&&(Y=Ra()),Y}function k0(){var Y,ve;return pt++,Y=oe,ds(),s.substr(oe,4)===h?(ve=h,oe+=4):(ve=a,pt===0&&Qt(G)),ve!==a?(ds(),Ir=Y,Y=ir()):(oe=Y,Y=a),pt--,Y===a&&pt===0&&Qt(D),Y}function Ra(){var Y,ve;if(Y=[],(ve=Hl())!==a)for(;ve!==a;)Y.push(ve),ve=Hl();else Y=a;return Y}function Hl(){var Y,ve,Ae,fi;return Y=oe,ds(),(ve=U0())!==a?(ds(),(Ae=Ap())===a&&(Ae=null),ds(),s.charCodeAt(oe)===41?(fi=p,oe++):(fi=a,pt===0&&Qt(H)),fi!==a?(ds(),Ir=Y,Y=Ri(ve,Ae)):(oe=Y,Y=a)):(oe=Y,Y=a),Y}function Ap(){var Y,ve,Ae,fi,an,Cs,$a,kv;if(Y=oe,(ve=eo())!==a){for(Ae=[],fi=oe,an=ds(),s.charCodeAt(oe)===44?(Cs=f,oe++):(Cs=a,pt===0&&Qt(J)),Cs===a&&(Cs=null),$a=ds(),(kv=eo())!==a?fi=an=[an,Cs,$a,kv]:(oe=fi,fi=a);fi!==a;)Ae.push(fi),fi=oe,an=ds(),s.charCodeAt(oe)===44?(Cs=f,oe++):(Cs=a,pt===0&&Qt(J)),Cs===a&&(Cs=null),$a=ds(),(kv=eo())!==a?fi=an=[an,Cs,$a,kv]:(oe=fi,fi=a);Ir=Y,Y=$i(ve,Ae)}else oe=Y,Y=a;return Y}function eo(){var Y,ve;return Y=oe,(ve=Nv())===a&&(ve=Sx())===a&&(ve=Fv())===a&&(ve=z0()),ve!==a&&(Ir=Y,ve=wi(ve)),(Y=ve)===a&&(Y=oe,(ve=W$())!==a&&(Ir=Y,ve=Ht(ve)),Y=ve),Y}function ds(){var Y,ve;for(pt++,Y=[],X.test(s.charAt(oe))?(ve=s.charAt(oe),oe++):(ve=a,pt===0&&Qt(ee));ve!==a;)Y.push(ve),X.test(s.charAt(oe))?(ve=s.charAt(oe),oe++):(ve=a,pt===0&&Qt(ee));return pt--,ve=a,pt===0&&Qt(Q),Y}function U0(){var Y,ve,Ae;return pt++,Y=oe,(ve=Dv())!==a?(s.charCodeAt(oe)===40?(Ae=g,oe++):(Ae=a,pt===0&&Qt(we)),Ae!==a?(Ir=Y,Y=ri(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),pt--,Y===a&&(ve=a,pt===0&&Qt(de)),Y}function Dv(){var Y,ve,Ae;if(pt++,Y=oe,ve=[],q.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,pt===0&&Qt(tt)),Ae!==a)for(;Ae!==a;)ve.push(Ae),q.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,pt===0&&Qt(tt));else ve=a;return ve!==a&&(Ir=Y,ve=Ii()),pt--,(Y=ve)===a&&(ve=a,pt===0&&Qt(Re)),Y}function Nv(){var Y,ve,Ae;return pt++,Y=oe,ds(),(ve=cl())!==a?(s.charCodeAt(oe)===37?(Ae=_,oe++):(Ae=a,pt===0&&Qt(qe)),Ae!==a?(Ir=Y,Y=Bi(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),pt--,Y===a&&pt===0&&Qt(Ye),Y}function Sx(){var Y,ve,Ae;return pt++,Y=oe,ds(),(ve=cl())!==a?(s.substr(oe,2)===v?(Ae=v,oe+=2):(Ae=a,pt===0&&Qt(je)),Ae!==a?(Ir=Y,Y=zr(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,ds(),(ve=cl())!==a?(s.substr(oe,2)===b?(Ae=b,oe+=2):(Ae=a,pt===0&&Qt(Jt)),Ae!==a?(Ir=Y,Y=Zi(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,ds(),(ve=cl())!==a?(s.substr(oe,2)===w?(Ae=w,oe+=2):(Ae=a,pt===0&&Qt(Wt)),Ae!==a?(Ir=Y,Y=rr(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,ds(),(ve=cl())!==a?(s.substr(oe,2)===T?(Ae=T,oe+=2):(Ae=a,pt===0&&Qt(Le)),Ae!==a?(Ir=Y,Y=us(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,ds(),(ve=cl())!==a?(s.substr(oe,2)===S?(Ae=S,oe+=2):(Ae=a,pt===0&&Qt(Dt)),Ae!==a?(Ir=Y,Y=Ds(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,ds(),(ve=cl())!==a?(s.substr(oe,2)===A?(Ae=A,oe+=2):(Ae=a,pt===0&&Qt(De)),Ae!==a?(Ir=Y,Y=vo(ve)):(oe=Y,Y=a)):(oe=Y,Y=a)))))),pt--,Y===a&&pt===0&&Qt(He),Y}function Fv(){var Y,ve,Ae;return pt++,Y=oe,(ve=cl())!==a?(s.substr(oe,3)===P?(Ae=P,oe+=3):(Ae=a,pt===0&&Qt(_t)),Ae!==a?(Ir=Y,Y=al(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,(ve=cl())!==a?(s.substr(oe,3)===R?(Ae=R,oe+=3):(Ae=a,pt===0&&Qt(bt)),Ae!==a?(Ir=Y,Y=$n(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,(ve=cl())!==a?(s.substr(oe,4)===F?(Ae=F,oe+=4):(Ae=a,pt===0&&Qt($t)),Ae!==a?(Ir=Y,Y=Jn(ve)):(oe=Y,Y=a)):(oe=Y,Y=a),Y===a&&(Y=oe,(ve=cl())!==a?(s.substr(oe,4)===k?(Ae=k,oe+=4):(Ae=a,pt===0&&Qt(st)),Ae!==a?(Ir=Y,Y=fn(ve)):(oe=Y,Y=a)):(oe=Y,Y=a)))),pt--,Y===a&&(ve=a,pt===0&&Qt($e)),Y}function z0(){var Y,ve;return pt++,Y=oe,ds(),(ve=cl())!==a?(Ir=Y,Y=hs(ve)):(oe=Y,Y=a),pt--,Y===a&&pt===0&&Qt(Be),Y}function W$(){var Y,ve,Ae,fi;if(pt++,Y=oe,s.charCodeAt(oe)===35?(ve=N,oe++):(ve=a,pt===0&&Qt(St)),ve!==a){if(Ae=[],Z.test(s.charAt(oe))?(fi=s.charAt(oe),oe++):(fi=a,pt===0&&Qt(jt)),fi!==a)for(;fi!==a;)Ae.push(fi),Z.test(s.charAt(oe))?(fi=s.charAt(oe),oe++):(fi=a,pt===0&&Qt(jt));else Ae=a;Ae!==a?(Ir=Y,Y=li()):(oe=Y,Y=a)}else oe=Y,Y=a;return Y===a&&(Y=oe,(ve=Hl())!==a&&(Ir=Y,ve=Ys(ve)),(Y=ve)===a&&(Y=oe,(ve=Dv())!==a&&(Ir=Y,ve=mn()),Y=ve)),pt--,Y===a&&(ve=a,pt===0&&Qt(Ge)),Y}function cl(){var Y,ve,Ae,fi,an,Cs,$a;for(Y=oe,ce.test(s.charAt(oe))?(s.charAt(oe),oe++):pt===0&&Qt(Wi),ve=oe,Ae=[],I.test(s.charAt(oe))?(fi=s.charAt(oe),oe++):(fi=a,pt===0&&Qt(ai));fi!==a;)Ae.push(fi),I.test(s.charAt(oe))?(fi=s.charAt(oe),oe++):(fi=a,pt===0&&Qt(ai));if(s.charCodeAt(oe)===46?(fi=j,oe++):(fi=a,pt===0&&Qt(pi)),fi!==a){if(an=[],I.test(s.charAt(oe))?(Cs=s.charAt(oe),oe++):(Cs=a,pt===0&&Qt(ai)),Cs!==a)for(;Cs!==a;)an.push(Cs),I.test(s.charAt(oe))?(Cs=s.charAt(oe),oe++):(Cs=a,pt===0&&Qt(ai));else an=a;an!==a?ve=Ae=[Ae,fi,an]:(oe=ve,ve=a)}else oe=ve,ve=a;if(ve===a)if(ve=[],I.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,pt===0&&Qt(ai)),Ae!==a)for(;Ae!==a;)ve.push(Ae),I.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,pt===0&&Qt(ai));else ve=a;if(ve!==a){if(Ae=oe,s.charCodeAt(oe)===101?(fi=z,oe++):(fi=a,pt===0&&Qt(Xi)),fi!==a){if(ce.test(s.charAt(oe))?(an=s.charAt(oe),oe++):(an=a,pt===0&&Qt(Wi)),an===a&&(an=null),Cs=[],I.test(s.charAt(oe))?($a=s.charAt(oe),oe++):($a=a,pt===0&&Qt(ai)),$a!==a)for(;$a!==a;)Cs.push($a),I.test(s.charAt(oe))?($a=s.charAt(oe),oe++):($a=a,pt===0&&Qt(ai));else Cs=a;Cs!==a?Ae=fi=[fi,an,Cs]:(oe=Ae,Ae=a)}else oe=Ae,Ae=a;Ae===a&&(Ae=null),Ir=Y,Y=on()}else oe=Y,Y=a;return Y}function EE(Y,ve){return Y.map(function(Ae){return Ae[ve]})}function AE(Y,ve,Ae){return[Y].concat(EE(ve,Ae))}if((o=u())!==a&&oe===s.length)return o;throw o!==a&&oe<s.length&&Qt(Iv()),F0(Hh,Qn<s.length?s.charAt(Qn):null,Qn<s.length?Lv(Qn,Qn+1):Lv(Qn,Qn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var h=this.location.end,p=i("",c.line.toString().length," "),f=a[l.line-1],g=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+f+`
`+p+" | "+i("",l.column-1," ")+i("",g,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(f){return'"'+l(f.text)+'"'},class:function(f){var g=f.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(f.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function l(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(f){return o[f.type](f)}function h(f){var g,_,v=f.map(u);if(v.sort(),v.length>0){for(g=1,_=1;g<v.length;g++)v[g-1]!==v[g]&&(v[_]=v[g],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+l(f)+'"':"end of input"}return"Expected "+h(s)+" but "+p(n)+" found."},{SyntaxError:e,parse:r}},(Wie=Hve).exports&&(Wie.exports=Yie());var Jje=Hve.exports;function qve(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Xie(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new W("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Xie(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!VUe(e[i].effects,e[i+1].effects))throw new W("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});GUe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Xie(t){let e;if(!t)return[];try{e=Jje.parse(t)}catch(i){throw new W("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>Qje(i))}function Qje(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Kje(t);case"opacity":return eHe(t);case"hue-rotate":return tHe(t);case"blur":return iHe(t);case"drop-shadow":return rHe(t);case"bloom":return sHe(t)}}catch(e){throw e.details.filter=t,e}throw new W("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Kje(t){let e=1;return hE(t.parameters,1),t.parameters.length===1&&(e=Ed(t.parameters[0])),new r8(t.name,e)}function eHe(t){let e=1;return hE(t.parameters,1),t.parameters.length===1&&(e=Ed(t.parameters[0])),new dye(e)}function tHe(t){let e=0;return hE(t.parameters,1),t.parameters.length===1&&(e=uHe(t.parameters[0])),new uye(e)}function iHe(t){let e=0;return hE(t.parameters,1),t.parameters.length===1&&(e=hZ(t.parameters[0]),m$(e,t.parameters[0])),new nye(e)}function rHe(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new W("effect:type-error","Accepts only one color",{});i=hHe(r)}else{const s=hZ(r);if(Object.isFrozen(e))throw new W("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&m$(s,r)}if(e.length<2||e.length>3)throw new W("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new lye(e[0],e[1],e[2]||0,i||Wve("black"))}function sHe(t){let e=1,i=0,r=0;return hE(t.parameters,3),t.parameters[0]&&(e=Ed(t.parameters[0])),t.parameters[1]&&(i=hZ(t.parameters[1]),m$(i,t.parameters[1])),t.parameters[2]&&(r=Ed(t.parameters[2])),new rye(e,i,r)}function hE(t,e){if(t.length>e)throw new W("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function bU(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in uZ)return"<length>";if(t.unit in cZ)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function m$(t,e){if(t<0)throw new W("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function nHe(t){if(t.type!=="quantity"||t.unit!==null)throw new W("effect:type-error",`Expected <double>, Actual: ${bU(t)}`,{term:t})}function oHe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new W("effect:type-error",`Expected <double> or <percentage>, Actual: ${bU(t)}`,{term:t})}const cZ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function aHe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&cZ[t.unit]!=null))throw new W("effect:type-error",`Expected <angle>, Actual: ${bU(t)}`,{term:t})}const uZ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function lHe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&uZ[t.unit]!=null))throw new W("effect:type-error",`Expected <length>, Actual: ${bU(t)}`,{term:t})}function Ed(t){oHe(t);const e=t.value;return m$(e,t),t.unit==="%"?.01*e:e}function cHe(t){return nHe(t),m$(t.value,t),t.value}function uHe(t){return aHe(t),t.value*cZ[t.unit]||0}function hZ(t){return lHe(t),t.value*uZ[t.unit]||0}function hHe(t){switch(t.colorType){case"hex":return m5e(t.value);case"named":return Wve(t.value);case"function":return fHe(t.value)}}function Wve(t){if(!qge(t))throw new W("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return f5e(t)}const dHe=/^rgba?/i,pHe=/^hsla?/i;function fHe(t){if(hE(t.parameters,4),dHe.test(t.name))return[Ed(t.parameters[0]),Ed(t.parameters[1]),Ed(t.parameters[2]),t.parameters[3]?Ed(t.parameters[3]):1];if(pHe.test(t.name))return Wge(cHe(t.parameters[0]),Ed(t.parameters[1]),Ed(t.parameters[2]),t.parameters[3]?Ed(t.parameters[3]):1);throw new W("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function mHe(t,e,i){try{return _He(t)}catch(r){i?.messages?.push(r)}return null}function gHe(t,e,i,r){try{const s=yHe(t);Xf(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function yHe(t){const e=qve(t);return e?jUe(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function _He(t){if(!t||t.length===0)return null;if(vHe(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Zie(i.value)});return e}return Zie(t)}function vHe(t){const e=t[0];return!!e&&"scale"in e}function Zie(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Um(i,"amount")];break;case"blur":r=[Um(i,"radius","pt")];break;case"hue-rotate":r=[Um(i,"angle","deg")];break;case"drop-shadow":r=[Um(i,"xoffset","pt"),Um(i,"yoffset","pt"),Um(i,"blurRadius","pt"),bHe(i,"color")];break;case"bloom":r=[Um(i,"strength"),Um(i,"radius","pt"),Um(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;qve(s),e.push(s)}return e.join(" ")}function Um(t,e,i){if(t[e]==null)throw new W("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function bHe(t,e){if(t[e]==null)throw new W("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const wHe={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},Jie={read:{reader:mHe},write:{allowNull:!0,writer:gHe}},xHe={json:{read:!1,write:!1,origins:{"web-map":Jie,"portal-item":Jie}}},THe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([m(wHe)],e.prototype,"blendMode",void 0),d([m(xHe)],e.prototype,"effect",void 0),e=d([U("esri.layers.mixins.BlendLayer")],e),e},SHe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&CHe(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),d([m({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=d([U("esri.layers.mixins.ScaleRangeLayer")],e),e};function CHe(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}let lw=class extends ZP{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([_me({Type:X_,ensureType:mo(X_)})],lw.prototype,"itemType",void 0),lw=d([U("esri.support.GraphicsCollection")],lw);var Bq;let MM=Bq=class extends Me{constructor(t){super(t)}async collectRequiredFields(t,e){return Y_(t,e,this.expression)}clone(){return new Bq({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([m({type:String,json:{write:!0}})],MM.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],MM.prototype,"title",void 0),MM=Bq=d([U("esri.symbols.support.FeatureExpressionInfo")],MM);const Qie=MM,wC={unknown:1,inches:Cn(1,"meters","inches"),feet:Cn(1,"meters","feet"),"us-feet":Cn(1,"meters","us-feet"),yards:Cn(1,"meters","yards"),miles:Cn(1,"meters","miles"),"nautical-miles":Cn(1,"meters","nautical-miles"),millimeters:Cn(1,"meters","millimeters"),centimeters:Cn(1,"meters","centimeters"),decimeters:Cn(1,"meters","decimeters"),meters:Cn(1,"meters","meters"),kilometers:Cn(1,"meters","kilometers"),"decimal-degrees":1/pLe(1,"meters",ji.radius)};function EHe(t){return!!t&&wC[t]!=null}function Yve(t){return 1/(wC[t]||1)}function AHe(){const t=Object.keys(wC);return t.sort(),t}const MHe=AHe();var Vq;const O3=rl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Kie=new Do({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let dg=Vq=class extends Me{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new Vq({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&q$e(this.featureExpressionInfo,t.featureExpressionInfo)}};d([m({type:Qie,json:{write:!0}})],dg.prototype,"featureExpressionInfo",void 0),d([_i("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],dg.prototype,"readFeatureExpressionInfo",null),d([Ut("featureExpressionInfo",{featureExpressionInfo:{type:Qie},"featureExpression.value":{type:[0]}})],dg.prototype,"writeFeatureExpressionInfo",null),d([m({type:O3.apiValues,nonNullable:!0,json:{type:O3.jsonValues,read:O3.read,write:{writer:O3.write,isRequired:!0}}})],dg.prototype,"mode",null),d([m({type:Number,json:{write:!0}})],dg.prototype,"offset",void 0),d([m({type:MHe,json:{type:String,read:Kie.read,write:Kie.write}})],dg.prototype,"unit",null),dg=Vq=d([U("esri.symbols.support.ElevationInfo")],dg);const PHe=dg;let pg=class extends THe(SHe(SX)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new lw,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,i){return super.on(e,i)}graphicChanged(e){this.emit("graphic-update",e)}};d([m({type:PHe})],pg.prototype,"elevationInfo",void 0),d([m(w4(lw,"graphics"))],pg.prototype,"graphics",void 0),d([m({type:["show","hide"]})],pg.prototype,"listMode",void 0),d([m()],pg.prototype,"screenSizePerspectiveEnabled",void 0),d([m({readOnly:!0})],pg.prototype,"type",void 0),d([m({constructOnly:!0})],pg.prototype,"internal",void 0),pg=d([U("esri.layers.GraphicsLayer")],pg);const OHe=pg;function wU(t){return typeof t=="string"?document.getElementById(t):t??null}function Xve(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function ere(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function tre(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let x4=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new YR,this._items=new Set}get length(){return Ot(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ot(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ot(this._observable),yield*this._items}};const Zve=new FinalizationRegistry(t=>{t.close()});function RHe(t,e){Zve.register(t,e,e)}function $He(t){Zve.unregister(t)}function Jve(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return IHe(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function IHe(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const LHe={statsWorker:()=>ue(()=>import("./statsWorker-eb762f6b.js"),["./statsWorker-eb762f6b.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js"],import.meta.url),geometryEngineWorker:()=>ue(()=>import("./geometryEngineWorker-b2897ad3.js"),["./geometryEngineWorker-b2897ad3.js","./geometryEngineJSON-d5c44941.js","./geometryEngineBase-1fd17bb5.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ue(()=>import("./CSVSourceWorker-4eda16cf.js"),["./CSVSourceWorker-4eda16cf.js","./date-430969b3.js","./json-48e3ea08.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FieldsIndex-e68ff75c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./number-6c4d71c9.js","./clientSideDefaults-0a851d22.js"],import.meta.url),EdgeProcessingWorker:()=>ue(()=>import("./EdgeProcessingWorker-9d28a30c.js"),["./EdgeProcessingWorker-9d28a30c.js","./workerHelper-a9182cf3.js"],import.meta.url),ElevationSamplerWorker:()=>ue(()=>import("./ElevationSamplerWorker-f59236e0.js"),["./ElevationSamplerWorker-f59236e0.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ue(()=>import("./FeatureServiceSnappingSourceWorker-528dad86.js"),["./FeatureServiceSnappingSourceWorker-528dad86.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FieldsIndex-e68ff75c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./symbologySnappingCandidates-ee7c07e0.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./query-dd3a3bae.js","./queryZScale-2c7fab80.js"],import.meta.url),GeoJSONSourceWorker:()=>ue(()=>import("./GeoJSONSourceWorker-f32bea1f.js"),["./GeoJSONSourceWorker-f32bea1f.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FieldsIndex-e68ff75c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./geojson-a0c1a886.js","./date-430969b3.js","./clientSideDefaults-0a851d22.js","./sourceUtils-51733682.js"],import.meta.url),LercWorker:()=>ue(()=>import("./LercWorker-1236b96d.js"),[],import.meta.url),MemorySourceWorker:()=>ue(()=>import("./MemorySourceWorker-1cdf2feb.js"),["./MemorySourceWorker-1cdf2feb.js","./objectIdUtils-967fafff.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FieldsIndex-e68ff75c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./clientSideDefaults-0a851d22.js","./sourceUtils-51733682.js","./date-430969b3.js"],import.meta.url),PBFDecoderWorker:()=>ue(()=>import("./PBFDecoderWorker-3d4253bd.js"),["./PBFDecoderWorker-3d4253bd.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js"],import.meta.url),FeaturePipelineWorker:()=>ue(()=>import("./FeaturePipelineWorker-7c29aaf5.js"),["./FeaturePipelineWorker-7c29aaf5.js","./diffUtils-0e3a2a24.js","./TurboLine-2a93d766.js","./constants-991354c8.js","./Rect-98da58d6.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FieldsIndex-e68ff75c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./quickselect-0cb10df8.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./ogcFeatureUtils-1e220dd4.js","./geojson-a0c1a886.js","./date-430969b3.js","./clientSideDefaults-0a851d22.js","./sourceUtils-51733682.js","./StreamFeatureManager-9aa9270f.js","./createConnection-e8c0a969.js"],import.meta.url),PointCloudWorker:()=>ue(()=>import("./PointCloudWorker-e1446645.js"),["./PointCloudWorker-e1446645.js","./PointCloudWorkerUtil-06c24da8.js","./PointCloudUniqueValueRenderer-9ef50fd1.js","./ColorStop-6a565283.js","./I3SBinaryReader-af544542.js"],import.meta.url),RasterWorker:()=>ue(()=>import("./RasterWorker-6fedc729.js"),["./RasterWorker-6fedc729.js","./dataUtils-87bf6375.js","./PolynomialTransform-5ecfad38.js","./colorRamps-aa93f22c.js","./rasterProjectionHelper-617ba3fc.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ue(()=>import("./SceneLayerSnappingSourceWorker-2291794e.js"),[],import.meta.url),SceneLayerWorker:()=>ue(()=>import("./SceneLayerWorker-69404a9a.js").then(t=>t.S),["./SceneLayerWorker-69404a9a.js","./I3SNode-0b3faaff.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js"],import.meta.url),WFSSourceWorker:()=>ue(()=>import("./WFSSourceWorker-9d15c4f7.js"),["./WFSSourceWorker-9d15c4f7.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./heatmapUtils-b63f4199.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FieldsIndex-e68ff75c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./geojson-a0c1a886.js","./date-430969b3.js","./sourceUtils-51733682.js","./wfsUtils-220dabe6.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ue(()=>import("./WorkerTileHandler-0e3bef30.js"),["./WorkerTileHandler-0e3bef30.js","./Rect-98da58d6.js","./pbf-19f7cae1.js","./TurboLine-2a93d766.js","./StyleRepository-17f7ffbb.js"],import.meta.url),Lyr3DWorker:()=>ue(()=>import("./Lyr3DWorker-8ea0be48.js"),["./Lyr3DWorker-8ea0be48.js","./ILyr3DWasmPerSceneView-b1ab6e1f.js","./Lyr3DModule-8a2f3baf.js"],import.meta.url)},Qve="worker:port-closed";var Yo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Yo||(Yo={}));let DHe=0;function Kve(){return DHe++}function NHe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function oR(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function dZ(t,e,i,r){if(e.type===Yo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Yo.INVOKE&&e.type!==Yo.RESPONSE)return void t.postMessage(e);let s;if(NHe(i)?(s=ire(i.transferList),e.data=i.result):(s=ire(r),e.data=i),s){if(se("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Yo.INVOKE:throw o;case Yo.RESPONSE:return void dZ(t,{type:Yo.RESPONSE,jobId:e.jobId,error:oR(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function aR(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function ire(t){if(!t?.length)return null;if(se("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!FHe(i));return e.length?e:null}function FHe(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}async function e3t(t){try{return await t}catch(e){const i=e?.name===Qve;if(!(sn(e)||i))throw e;return}}const{CLOSE:rre,ABORT:sre,INVOKE:nre,RESPONSE:VE,OPEN_PORT:ore,ON:kHe}=Yo,UHe=2;let zHe=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Yo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},sv=class rS{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new rS(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),rS.clients.set(n,s),r.port2}static loadWorker(e){const i=LHe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new zHe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:rre}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r?.signal,n=r?.transferList;if(!this._port)return Promise.reject(new W(Qve,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=Kve();return new Promise((a,l)=>{if(qn(s))return this._processWork(),void l(vi());const c=un(s,()=>{const h=this._outJobs.get(o);h&&(this._outJobs.delete(o),this._processWork(),gr(h.abortHandle),this._post({type:sre,jobId:o}),l(vi()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:nre,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return Jve(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Yo.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),Mi(()=>{r.port1.postMessage({type:Yo.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:ore,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=UHe)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{gr(e.abortHandle),e.reject(vi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=aR(e);if(r)switch(r.type){case VE:this._onResponseMessage(r);break;case nre:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case sre:this._onAbortMessage(r);break;case rre:this._onCloseMessage();break;case ore:this._onOpenPortMessage(r);break;case kHe:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&rS.clients.get(this)===e&&e.destroy(),rS.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const h=i.split(".");for(let p=0;p<h.length-1;p++)c=c[h[p]],u=c[h[p+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=u.apply(c,s)}catch(h){return void this._post({type:VE,jobId:r,error:oR(h)})}$c(l)?(a.set(r,{controller:o,promise:l}),l.then(h=>{a.has(r)&&(a.delete(r),this._post({type:VE,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),sn(h)||this._post({type:VE,jobId:r,error:oR(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:VE,jobId:r},l)}_onOpenPortMessage(e){new rS(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=qg(e.port,"message",n=>{aR(n)?.type===Yo.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),gr(o.abortHandle),r?o.reject(W.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return dZ(this._port,e,i,r)}};sv.kernelInfo={buildDate:sfe,fullVersion:uk,revision:nfe},sv.clients=new Map;let BHe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new x4}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{yt(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];$c(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new sv(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new sv(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(vi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,$He(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=Pn();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a?.jobAdded())}return s.promise}createInvokeProxy(e){return Jve(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>vw(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const VHe={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&pj(t.url)?.after?r:"array-buffer";const s=await Yi(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch(s.requestOptions?.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},are={};function GHe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.concat()||[],paths:{...are.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=are.baseUrl),e}let jHe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},XD=class{constructor(){this._dispatcher=new jHe,this._workerPostMessage({type:Yo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){B2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){B2(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=aR(e);if(i&&i.type===Yo.OPEN){const{modulePath:r,jobId:s}=i;let n=await sv.loadWorker(r);n||(n=await ue(()=>import(r),[],import.meta.url));const o=sv.connect(n);this._workerPostMessage({type:Yo.OPENED,jobId:s,data:o})}}};const Gq=()=>le.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:HHe}=Yo,qHe='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let R3,$3;const lre="Failed to create Worker. Fallback to execute module in main thread";async function WHe(){if(!se("esri-workers"))return cre(new XD);if(!R3&&!$3)try{const e=qHe.split("{CONFIGURATION}").join(YHe());R3=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){$3=e||{}}let t;if(R3)try{t=new Worker(R3,{name:"esri-worker-"+XHe++})}catch{Gq().warn(lre,$3),t=new XD}else Gq().warn(lre,$3),t=new XD;return cre(t)}async function cre(t){return new Promise(e=>{function i(s){const n=aR(s);n&&n.type===HHe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),Gq().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new XD).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function YHe(){let t;if(Gi.default!=null){const s={...Gi};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Gi));t.assetsPath=Ja(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Ja(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Ec(),t.has={"esri-csp-restrictions":se("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":se("esri-2d-update-debug"),"esri-2d-log-updating":se("esri-2d-log-updating"),"featurelayer-pbf":se("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":se("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":se("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":se("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":se("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":se("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":se("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":se("featurelayer-snapshot-enabled"),"esri-atomics":se("esri-atomics"),"esri-shared-array-buffer":se("esri-shared-array-buffer"),"esri-tiles-debug":se("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":se("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":se("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Ja(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Ja(t.workers.workerPath):t.workers.workerPath=Ja(sr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Gi.workers.loaderConfig,i=GHe({baseUrl:e?.baseUrl,locale:Ec(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:sfe,fullVersion:uk,revision:nfe}})}let XHe=0;const{ABORT:ure,INVOKE:ZHe,OPEN:JHe,OPENED:QHe,RESPONSE:GE}=Yo;let KHe=class e1e{static async create(e){const i=await WHe();return new e1e(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),le.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=Kve();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:zR(r,()=>{this._outJobs.delete(s),this._post({type:ure,jobId:s})})};this._outJobs.set(s,a),this._post({type:JHe,jobId:s,modulePath:e})})}_onMessage(e){const i=aR(e);if(i)switch(i.type){case QHe:this._onOpenedMessage(i);break;case GE:this._onResponseMessage(i);break;case ure:this._onAbortMessage(i);break;case ZHe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=VHe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:GE,jobId:r,error:oR(u)})}$c(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:GE,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),sn(u)||this._post({type:GE,jobId:r,error:oR(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:GE,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),gr(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),gr(n.abortHandle),r?n.reject(W.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return dZ(this.worker,e,i,r)}};const hre=se("host-browser")?Math.min(navigator.hardwareConcurrency-1,se("workers-pool-size")):0;let zb=se("esri-mobile")?Math.min(hre,3):hre;zb||(zb=se("safari")&&se("mac")?7:2);let dre=0;const ZD=[];function e8e(){t1e()}async function I3(t,e){const i=new BHe,{registryTarget:r,...s}=e;return await i.open(t,s),r&&RHe(r,i),i}async function n3t(t,e={}){if(typeof t!="string")throw new W("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(se("host-webworker")&&!se("esri-workers")&&(i="local"),i==="local"){let r=await sv.loadWorker(t);r||(r=await ue(()=>import(t),[],import.meta.url)),yt(e.signal);const s=e.client||r;return I3([sv.connect(r,e.schedule)],{...e,client:s})}if(await t1e(),yt(e.signal),i==="dedicated"){const r=dre++%zb;return I3([await ZD[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,zb);if(r<zb){const s=new Array(r);for(let n=0;n<r;++n){const o=dre++%zb;s[n]=ZD[o].open(t,e)}return I3(s,e)}}return I3(ZD.map(r=>r.open(t,e)),e)}let L3=null;async function t1e(){if(L3)return L3;new AbortController;const t=[];for(let e=0;e<zb;e++){const i=KHe.create(e).then(r=>(ZD[e]=r,r));t.push(i)}return L3=Promise.all(t),L3}function i1e(t,e){const i=Ul(t),r=Ul(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==Ti.DEFAULTS)if(c===Ti.DEFAULTS)t.set(a,n.get(a));else{const h=s.get(a),p=n.get(a);h&&p&&p instanceof Pe&&h instanceof Pe&&h instanceof p.constructor&&i1e(h,p)}}}function xU(t,e,i,r){return t!=null&&(ls(e,r)?(u0(i,t),!0):(ql[0]=t[0],ql[1]=t[1],ql[2]=0,!!jr(ql,e,0,ql,r,0,1)&&(i[0]=ql[0],i[1]=ql[1],ql[0]=t[2],ql[1]=t[3],ql[2]=0,!!jr(ql,e,0,ql,r,0,1)&&(i[2]=ql[0],i[3]=ql[1],!0))))}const ql=C();let R0=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&B2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*pre);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,pre));e++)this._items.push(this._allocator())}};const pre=1024;function Cp(t){return t?{origin:Kr(t.origin),vector:Kr(t.vector)}:{origin:C(),vector:C()}}function t8e(t,e){const i=r8e.get();return i.origin=t,i.vector=e,i}function a3t(t,e=Cp()){return i8e(t.origin,t.vector,e)}function i8e(t,e,i=Cp()){return ae(i.origin,t),ae(i.vector,e),i}function cw(t,e,i=Cp()){return ae(i.origin,t),_e(i.vector,e,t),i}function pZ(t,e){const i=_e(ze.get(),e,t.origin),r=pe(t.vector,i),s=pe(t.vector,t.vector),n=Te(r/s,0,1),o=_e(ze.get(),ie(ze.get(),t.vector,n),i);return pe(o,o)}function l3t(t,e,i){return jq(t,e,0,1,i)}function c3t(t,e,i){return me(i,t.origin,ie(i,t.vector,e))}function jq(t,e,i,r,s){const{vector:n,origin:o}=t,a=_e(ze.get(),e,o),l=pe(n,a)/xa(n);return ie(s,n,Te(l,i,r)),me(s,s,t.origin)}function u3t(t,e){if(s1e(t,t8e(e.origin,e.direction),!1,T4)){const{tA:i,pB:r,distance2:s}=T4;if(i>=0&&i<=1)return s;if(i<0)return Wn(t.origin,r);if(i>1)return Wn(me(ze.get(),t.origin,t.vector),r)}return null}function r1e(t,e,i){return!!s1e(t,e,!0,T4)&&(ae(i,T4.pA),!0)}function s1e(t,e,i,r){const n=t.origin,o=me(ze.get(),n,t.vector),a=e.origin,l=me(ze.get(),a,e.vector),c=ze.get(),u=ze.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=ze.get();if(h[0]=o[0]-n[0],h[1]=o[1]-n[1],h[2]=o[2]-n[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*_-f*f;if(Math.abs(v)<1e-6)return!1;let b=(p*f-g*_)/v,w=(p+f*b)/_;i&&(b=Te(b,0,1),w=Te(w,0,1));const T=ze.get(),S=ze.get();return T[0]=n[0]+b*h[0],T[1]=n[1]+b*h[1],T[2]=n[2]+b*h[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],r.tA=b,r.tB=w,r.pA=T,r.pB=S,r.distance2=Wn(T,S),!0}const T4={tA:0,tB:0,pA:C(),pB:C(),distance2:0},r8e=new R0(()=>Cp());function Gn(t){return t?fre(Kr(t.origin),Kr(t.direction)):fre(C(),C())}function fre(t,e){return{origin:t,direction:e}}function h3t(t,e){return s0(t.origin,e.origin)&&s0(t.direction,e.direction)}function Ou(t,e){const i=o8e.get();return i.origin=t,i.direction=e,i}function S4(t,e=Gn()){return o1e(t.origin,t.direction,e)}function n1e(t,e,i=Gn()){return ae(i.origin,t),_e(i.direction,e,t),i}function o1e(t,e,i=Gn()){return ae(i.origin,t),ae(i.direction,e),i}function s8e(t,e){const i=Ke(ze.get(),fe(ze.get(),t.direction),_e(ze.get(),e,t.origin));return pe(i,i)}function n8e(t,e,i){const r=pe(t.direction,_e(i,e,t.origin));return me(i,t.origin,ie(i,t.direction,r)),i}function d3t(t,e,i,r){const s=t.direction,n=e.direction,o=yi(TB,e.origin,t.origin),a=pe(s,n),l=pe(n,o),c=pe(s,o),u=pe(s,s),h=pe(n,n),p=(a*l+c*h)/(u*h-a*a),f=(a*c-l*u)/(u*h-a*a);return me(i,t.origin,ie(TB,s,p)),me(r,e.origin,ie(TB,n,f)),[i,r]}const o8e=new R0(()=>Gn()),TB=C(),SB=()=>le.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let a8e=class{constructor(){this.plane=Ui(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const a1e=a8e;function $0(t=_1e){return{plane:Ui(t.plane),origin:Kr(t.origin),basis1:Kr(t.basis1),basis2:Kr(t.basis2)}}function l8e(t,e,i){const r=b8e.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=AGe(0,0,0,0),TU(r),r}function yx(t,e=$0()){return fZ(t.origin,t.basis1,t.basis2,e)}function c8e(t,e){ae(e.origin,t.origin),ae(e.basis1,t.basis1),ae(e.basis2,t.basis2),tU(e.plane,t.plane)}function fZ(t,e,i,r=$0()){return ae(r.origin,t),ae(r.basis1,e),ae(r.basis2,i),TU(r),_8e(r,"fromValues()"),r}function TU(t){KO(t.basis2,t.basis1,t.origin,t.plane)}function l1e(t,e,i){t!==i&&yx(t,i);const r=ie(ze.get(),m0(t),e);return me(i.origin,i.origin,r),i.plane[3]-=e,i}function u8e(t,e,i){return c1e(e,i),l1e(i,_Z(t,t.origin),i),i}function c1e(t,e=$0()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return te(e.origin,t[0]+i,t[1]+r,0),te(e.basis1,i,0,0),te(e.basis2,0,r,0),HX(0,0,1,0,e.plane),e}function mZ(t,e,i){return!!fx(t.plane,e,i)&&g1e(t,i)}function h8e(t,e,i){if(mZ(t,e,i))return i;const r=u1e(t,e,ze.get());return me(i,e.origin,ie(ze.get(),e.direction,hr(e.origin,r)/Se(e.direction))),i}function u1e(t,e,i){const r=C4.get();y1e(t,e,r,C4.get());let s=Number.POSITIVE_INFINITY;for(const n of bZ){const o=vZ(t,n,SU.get()),a=ze.get();if(OGe(r,o,a)){const l=S0(ze.get(),e.origin,a),c=Math.abs(Zn(pe(e.direction,l)));c<s&&(s=c,ae(i,a))}}return s===Number.POSITIVE_INFINITY?h1e(t,e,i):i}function h1e(t,e,i){if(mZ(t,e,i))return i;const r=C4.get(),s=C4.get();y1e(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of bZ){const a=vZ(t,o,SU.get()),l=ze.get();if(RGe(r,a,l)){const c=s8e(e,l);if(!X_e(s,l))continue;c<n&&(n=c,ae(i,l))}}return gZ(t,e.origin)<n&&d1e(t,e.origin,i),i}function d1e(t,e,i){const r=LGe(t.plane,e,ze.get()),s=jq(mre(t,t.basis1),r,-1,1,ze.get()),n=jq(mre(t,t.basis2),r,-1,1,ze.get());return _e(i,me(ze.get(),s,n),t.origin),i}function p1e(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=_e(ze.get(),e,r),a=I_(s,o),l=I_(n,o),c=I_(m0(t),o);return te(i,a,l,c)}function gZ(t,e){const i=p1e(t,e,ze.get()),{basis1:r,basis2:s}=t,n=Se(r),o=Se(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function d8e(t,e){return Math.sqrt(gZ(t,e))}function p8e(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of bZ){const s=vZ(t,r,SU.get()),n=pZ(s,e);n>i&&(i=n)}return Math.sqrt(i)}function yZ(t,e){return X_e(t.plane,e)&&g1e(t,e)}function f8e(t,e,i,r){return y8e(t,i,r)}function _Z(t,e){const i=-t.plane[3];return I_(m0(t),e)-i}function m8e(t,e,i,r){const s=_Z(t,e),n=ie(v8e,m0(t),i-s);return me(r,e,n),r}function f1e(t,e){return ho(t.basis1,e.basis1)&&ho(t.basis2,e.basis2)&&ho(t.origin,e.origin)}function m1e(t,e,i){return t!==i&&yx(t,i),Is($x,e),Pc($x,$x),Ve(i.basis1,t.basis1,$x),Ve(i.basis2,t.basis2,$x),Ve(i.plane,t.plane,$x),Ve(i.origin,t.origin,e),J8(i.plane,i.plane,i.origin),i}function g8e(t,e,i,r){return t!==r&&yx(t,r),Bl(CB,e,i),Ve(r.basis1,t.basis1,CB),Ve(r.basis2,t.basis2,CB),TU(r),r}function m0(t){return t.plane}function y8e(t,e,i){switch(e){case Xr.X:ae(i,t.basis1),fe(i,i);break;case Xr.Y:ae(i,t.basis2),fe(i,i);break;case Xr.Z:ae(i,m0(t))}return i}function g1e(t,e){const i=_e(ze.get(),e,t.origin),r=xa(t.basis1),s=xa(t.basis2),n=pe(t.basis1,i),o=pe(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function mre(t,e){const i=SU.get();return ae(i.origin,t.origin),ae(i.vector,e),i}function vZ(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=ie(ze.get(),r,e.origin[0]),a=ie(ze.get(),s,e.origin[1]);me(i.origin,o,a),me(i.origin,i.origin,n);const l=ie(ze.get(),r,e.direction[0]),c=ie(ze.get(),s,e.direction[1]);return ie(i.vector,me(l,l,c),2),i}function _8e(t,e){Math.abs(pe(t.basis1,t.basis2)/(Se(t.basis1)*Se(t.basis2)))>1e-6&&SB().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(pe(t.basis1,m0(t)))>1e-6&&SB().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-pe(m0(t),t.origin)-t.plane[3])>1e-6&&SB().warn(e,"Plane offset is not consistent with plane origin")}function y1e(t,e,i,r){const s=m0(t);KO(s,e.direction,e.origin,i),KO(i,s,e.origin,r)}const _1e={plane:Ui(),origin:Ce(0,0,0),basis1:Ce(1,0,0),basis2:Ce(0,1,0)},C4=new R0(Ui),SU=new R0(Cp),v8e=C(),b8e=new R0(()=>$0()),bZ=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],$x=xe(),CB=xe(),w8e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:a1e,altitudeAt:_Z,axisAt:f8e,closestPoint:h1e,closestPointOnSilhouette:u1e,copy:yx,copyWithoutVerify:c8e,create:$0,distance:d8e,distance2:gZ,distanceToSilhouette:p8e,elevate:l1e,equals:f1e,extrusionContainsPoint:yZ,fromAABoundingRect:c1e,fromValues:fZ,intersectRay:mZ,intersectRayClosestSilhouette:h8e,normal:m0,projectPoint:d1e,projectPointLocal:p1e,rotate:g8e,setAltitudeAt:m8e,setExtent:u8e,transform:m1e,up:_1e,updateUnboundedPlane:TU,wrap:l8e},Symbol.toStringTag,{value:"Module"})),v1e=Ws();function Ws(){return Yt()}const x8e=Uw,T8e=Uw;function Vw(t,e){return Ch(e,t)}function b1e(t,e){return kt(t[0],t[1],t[2],e)}function S8e(t){return t}function C8e(t){t[0]=t[1]=t[2]=t[3]=0}function CU(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function L_(t){return t[3]}function E8e(t){return t}function w1e(t,e,i,r){return kt(t,e,i,r)}function A8e(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function M8e(t,e,i){return t!==i&&Vw(t,i),i}function xv(t,e,i){if(e==null||!x1e(t,e,E4))return!1;let{t0:r,t1:s}=E4;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function P8e(t,e,i){const r=n1e(e,i);if(!x1e(t,r,E4))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=E4,l=c=>{const u=C();return hn(u,s,n,c),wZ(t,u,u)};return Math.abs(o-a)<go()?[l(o)]:[l(o),l(a)]}const E4={t0:0,t1:0};function x1e(t,e,i){const{origin:r,direction:s}=e,n=O8e;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const O8e=C();function Hq(t,e){return xv(t,e,null)}function R8e(t,e,i){if(xv(t,e,i))return i;const r=dE(t,e,ze.get());return me(i,e.origin,ie(ze.get(),e.direction,hr(e.origin,r)/Se(e.direction))),i}function dE(t,e,i){const r=ze.get(),s=jX.get();Ke(r,e.origin,e.direction);const n=L_(t);Ke(i,r,e.origin),ie(i,i,1/Se(i)*n);const o=S1e(t,e.origin),a=VX(e.origin,i);return Bl(s,a+o,r),Ve(i,i,s),i}function $8e(t,e,i){return xv(t,e,i)?i:(n8e(e,t,i),wZ(t,i,i))}function wZ(t,e,i){const r=_e(ze.get(),e,t),s=ie(ze.get(),r,t[3]/Se(r));return me(i,s,t)}function T1e(t,e){const i=_e(ze.get(),e,t),r=xa(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function S1e(t,e){const i=_e(ze.get(),e,t),r=Se(i),s=L_(t),n=s+Math.abs(s-r);return Zn(s/n)}const EB=C();function C1e(t,e,i,r){const s=_e(EB,e,t);switch(i){case Xr.X:{const n=Aee(s,EB)[2];return te(r,-Math.sin(n),Math.cos(n),0)}case Xr.Y:{const n=Aee(s,EB),o=n[1],a=n[2],l=Math.sin(o);return te(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Xr.Z:return fe(r,s);default:return}}function E1e(t,e){const i=_e(qq,e,t);return Se(i)-t[3]}function I8e(t,e,i,r){const s=E1e(t,e),n=C1e(t,e,Xr.Z,qq),o=ie(qq,n,i-s);return me(r,e,o)}function L8e(t,e){const i=Wn(t,e),r=L_(t);return i<=r*r}function D8e(t,e,i=Yt()){const r=hr(t,e),s=t[3],n=e[3];return r+n<s?(Ch(i,t),i):r+s<n?(Ch(i,e),i):(or(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const qq=C(),EU=Ws(),N8e=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:v1e,altitudeAt:E1e,angleToSilhouette:S1e,axisAt:C1e,clear:C8e,closestPoint:$8e,closestPointOnSilhouette:dE,containsPoint:L8e,copy:Vw,create:Ws,distanceToSilhouette:T1e,elevate:A8e,equals:T8e,exactEquals:x8e,fromCenterAndRadius:b1e,fromRadius:CU,fromValues:w1e,getCenter:E8e,getRadius:L_,intersectLine:P8e,intersectRay:xv,intersectRayClosestSilhouette:R8e,intersectsRay:Hq,projectPoint:wZ,setAltitudeAt:I8e,setExtent:M8e,tmpSphere:EU,union:D8e,wrap:S8e},Symbol.toStringTag,{value:"Module"}));function F8e(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function k8e(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function U8e(t){return{operations:t,value:t.create()}}function A1e(t,e,i=U8e(t)){return i.operations=t,t.copy(e,i.value),i}function z8e(t){return A1e(N8e,w1e(0,0,0,er(t).radius))}const gre=2**50;function B8e(){return A1e(w8e,fZ([0,0,0],[gre,0,0],[0,gre,0]))}function V8e(t,e,i){return t.operations.axisAt(t.value,e,Xr.Z,i)}function G8e(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function j8e(t,e,i){return t.operations.intersectRay(t.value,e,i)}function H8e(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function q8e(t,e){return t.operations.altitudeAt(t.value,e)}function M1e(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function W8e(t,e,i,r){return e!==r&&tn(r,e),te(Ix,r[12],r[13],r[14]),M1e(t,Ix,i,Ix),r[12]=Ix[0],r[13]=Ix[1],r[14]=Ix[2],r}function AB(t,e,i){return t.operations.elevate(t.value,e,i.value)}const Ix=C();function yre(t,e,i,r,s){return s[0]=pe(t,e),s[1]=pe(t,i),s[2]=pe(t,r),s}function Wq(t,e,i,r,s){ae(i,t),ae(D3,e),fe(D3,D3),Ke(r,D3,i),Ke(s,r,i)}function Y8e(t,e){return t?qs(e):e.isGeographic?We.PlateCarree:e}const D3=C(),xZ=96;function f3t(t,e){const i=e||t.extent,r=t.width,s=sl(i?.spatialReference);return i&&r?i.width/r*s*yY*xZ:0}function X8e(t,e){return t/(sl(e)*yY*xZ)}function Z8e(t){return t/(yY*xZ)}function m3t(t,e,i){return J8e(t,e)&&Q8e(t,i)}function J8e(t,e){return e===0||O_(t,e)||t<e}function Q8e(t,e){return e===0||O_(t,e)||t>e}let xC=class extends ZP{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(le.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};xC=d([U("esri.support.AnalysesCollection")],xC);const JD={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},MB={xsmall:544,small:768,medium:992,large:1200};function K8e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function PB(t,e){return e?JD[t].valueToClassName[e].split(" "):[]}const eqe=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=MB}initialize(){this.addHandles(he(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ki))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!K8e(i)){const r=JSON.stringify(MB,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=MB}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=fc.acquire(),r=fc.acquire();let s,n=!1;for(s in JD){const o=this[s],a=JD[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,PB(s,o).forEach(l=>r.push(l)),PB(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),fc.release(i),fc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in JD)PB(r,this[r]).forEach(s=>i.classList.remove(s))}};return d([m()],e.prototype,"breakpoints",null),d([m()],e.prototype,"orientation",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),d([m()],e.prototype,"heightBreakpoint",void 0),e=d([U("esri.views.BreakpointsOwner")],e),e};let Xg=class extends Pe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,he)}addWhen(e,i,r={}){return this._installWatch(e,i,r,zl)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([yo(e,"after-changes",this._createSyncUpdatingCallback(),Ji),yo(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),Mi(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Mi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(N3)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),Mi(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=he(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(N3),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(XC(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(N3))}),N3)}}};d([m({readOnly:!0})],Xg.prototype,"updating",void 0),Xg=d([U("esri.core.support.UpdatingHandles")],Xg);const N3=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.0.1 - Thu May 30 2024 10:12:55 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var A4=function(){return A4=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},A4.apply(this,arguments)},Yq={exports:{}},nn={},Xq={exports:{}},_x={};function P1e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function tqe(t,e,i){}function iqe(t,e,i){}var rqe=/javascript\s*\:/img;function sqe(t,e){return rqe.test(e)?"":e}_x.whiteList=P1e();_x.getDefaultWhiteList=P1e;_x.onAttr=tqe;_x.onIgnoreAttr=iqe;_x.safeAttrValue=sqe;var nqe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},jE=nqe;function oqe(t,e){t=jE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var u=jE.trim(t.slice(s,n)),h=u.indexOf(":");if(h!==-1){var p=jE.trim(u.slice(0,h)),f=jE.trim(u.slice(h+1));if(p){var g=e(s,o.length,p,f,u);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return jE.trim(o)}var aqe=oqe,F3=_x,lqe=aqe;function _re(t){return t==null}function cqe(t){var e={};for(var i in t)e[i]=t[i];return e}function O1e(t){t=cqe(t||{}),t.whiteList=t.whiteList||F3.whiteList,t.onAttr=t.onAttr||F3.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||F3.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||F3.safeAttrValue,this.options=t}O1e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=lqe(t,function(l,c,u,h,p){var f=r[u],g=!1;if(f===!0?g=f:typeof f=="function"?g=f(h):f instanceof RegExp&&(g=f.test(h)),g!==!0&&(g=!1),h=o(u,h),!!h){var _={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var v=s(u,h,_);return _re(v)?u+":"+h:v}else{var v=n(u,h,_);if(!_re(v))return v}}});return a};var uqe=O1e;(function(t,e){var i=_x,r=uqe;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(Xq,Xq.exports);var TZ=Xq.exports,SZ={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},hqe=TZ.FilterCSS,dqe=TZ.getDefaultWhiteList,M4=SZ;function R1e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var $1e=new hqe;function pqe(t,e,i){}function fqe(t,e,i){}function mqe(t,e,i){}function gqe(t,e,i){}function I1e(t){return t.replace(_qe,"&lt;").replace(vqe,"&gt;")}function yqe(t,e,i,r){if(i=U1e(i),e==="href"||e==="src"){if(i=M4.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(k3.lastIndex=0,k3.test(i))return""}else if(e==="style"){if(vre.lastIndex=0,vre.test(i)||(bre.lastIndex=0,bre.test(i)&&(k3.lastIndex=0,k3.test(i))))return"";r!==!1&&(r=r||$1e,i=r.process(i))}return i=z1e(i),i}var _qe=/</g,vqe=/>/g,bqe=/"/g,wqe=/&quot;/g,xqe=/&#([a-zA-Z0-9]*);?/gim,Tqe=/&colon;?/gim,Sqe=/&newline;?/gim,k3=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,vre=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,bre=/u\s*r\s*l\s*\(.*/gi;function L1e(t){return t.replace(bqe,"&quot;")}function D1e(t){return t.replace(wqe,'"')}function N1e(t){return t.replace(xqe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function F1e(t){return t.replace(Tqe,":").replace(Sqe," ")}function k1e(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return M4.trim(e)}function U1e(t){return t=D1e(t),t=N1e(t),t=F1e(t),t=k1e(t),t}function z1e(t){return t=L1e(t),t=I1e(t),t}function Cqe(){return""}function Eqe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:M4.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return M4.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Aqe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function Mqe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}nn.whiteList=R1e();nn.getDefaultWhiteList=R1e;nn.onTag=pqe;nn.onIgnoreTag=fqe;nn.onTagAttr=mqe;nn.onIgnoreTagAttr=gqe;nn.safeAttrValue=yqe;nn.escapeHtml=I1e;nn.escapeQuote=L1e;nn.unescapeQuote=D1e;nn.escapeHtmlEntities=N1e;nn.escapeDangerHtml5Entities=F1e;nn.clearNonPrintableCharacter=k1e;nn.friendlyAttrValue=U1e;nn.escapeAttrValue=z1e;nn.onIgnoreTagStripAll=Cqe;nn.StripTagBody=Eqe;nn.stripCommentTag=Aqe;nn.stripBlankChar=Mqe;nn.attributeWrapSign='"';nn.cssFilter=$1e;nn.getDefaultCSSWhiteList=dqe;var AU={},r_=SZ;function Pqe(t){var e=r_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=r_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function Oqe(t){return t.slice(0,2)==="</"}function Rqe(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var h=t.charAt(a);if(n===!1){if(h==="<"){n=a;continue}}else if(o===!1){if(h==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(h===">"||a===l-1){r+=i(t.slice(s,n)),u=t.slice(n,a+1),c=Pqe(u),r+=e(n,r.length,c,u,Oqe(u)),s=a+1,n=!1;continue}if(h==='"'||h==="'")for(var p=1,f=t.charAt(a-p);f.trim()===""||f==="=";){if(f==="="){o=h;continue e}f=t.charAt(a-++p)}}else if(h===o){o=!1;continue}}return s<l&&(r+=i(t.substr(s))),r}var $qe=/[^a-zA-Z0-9\\_:.-]/gim;function Iqe(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(p,f){if(p=r_.trim(p),p=p.replace($qe,"").toLowerCase(),!(p.length<1)){var g=e(p,f||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,h;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:Dqe(t,l+1);continue}if(n!==!1&&l===r){if(h=t.indexOf(c,l+1),h===-1)break;u=r_.trim(t.slice(r+1,h)),a(n,u),n=!1,l=h,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(h=Lqe(t,l),h===-1){u=r_.trim(t.slice(i,l)),a(u),n=!1,i=l+1;continue}else{l=h-1;continue}else if(h=Nqe(t,l-1),h===-1){u=r_.trim(t.slice(i,l)),u=wre(u),a(n,u),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,wre(r_.trim(t.slice(i))))),r_.trim(s.join(" "))}function Lqe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Dqe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function Nqe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Fqe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function wre(t){return Fqe(t)?t.substr(1,t.length-2):t}AU.parseTag=Rqe;AU.parseAttr=Iqe;var kqe=TZ.FilterCSS,oh=nn,B1e=AU,Uqe=B1e.parseTag,zqe=B1e.parseAttr,QD=SZ;function U3(t){return t==null}function Bqe(t){var e=QD.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=QD.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=QD.trim(t.slice(0,-1))),{html:t,closing:i}}function Vqe(t){var e={};for(var i in t)e[i]=t[i];return e}function Gqe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function V1e(t){t=Vqe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=oh.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=Gqe(t.whiteList||t.allowList):t.whiteList=oh.whiteList,this.attributeWrapSign=t.singleQuotedAttributeValue===!0?"'":oh.attributeWrapSign,t.onTag=t.onTag||oh.onTag,t.onTagAttr=t.onTagAttr||oh.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||oh.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||oh.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||oh.safeAttrValue,t.escapeHtml=t.escapeHtml||oh.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new kqe(t.css))}V1e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.attributeWrapSign,h=e.cssFilter;i.stripBlankChar&&(t=oh.stripBlankChar(t)),i.allowCommentTag||(t=oh.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=oh.StripTagBody(i.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=Uqe(t,function(g,_,v,b,w){var T={sourcePosition:g,position:_,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,v)},S=s(v,b,T);if(!U3(S))return S;if(T.isWhite){if(T.isClosing)return"</"+v+">";var A=Bqe(b),P=r[v],R=zqe(A.html,function(F,k){var N=QD.indexOf(P,F)!==-1,j=o(v,F,k,N);return U3(j)?N?(k=l(v,F,k,h),k?F+"="+u+k+u:F):(j=a(v,F,k,N),U3(j)?void 0:j):j});return b="<"+v,R&&(b+=" "+R),A.closing&&(b+=" /"),b+=">",b}else return S=n(v,b,T),U3(S)?c(b):S},c);return p&&(f=p.remove(f)),f};var jqe=V1e;(function(t,e){var i=nn,r=AU,s=jqe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(Yq,Yq.exports);var Lx=Yq.exports,Hqe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},qqe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=A4(A4({},Lx.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):Lx.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new Lx.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Lx.escapeAttrValue(e):!n&&!s?Lx.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):Lx.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(Hqe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const MU=new Map;function G1e(){MU.clear()}function Wqe(t){return MU.get(t)}function Yqe(t,e){MU.set(t,e)}function OB(t){MU.delete(t)}function Xqe(...t){const e=fc.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return fc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{G1e();for(const s of r)t.get(s.target)?.(s)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),Mi(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return vw([he(()=>typeof r=="function"?r():r,a=>{o?.remove(),a&&(o=i(a,s,n))},qi),Mi(()=>o?.remove())])}})();function Zqe(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function _3t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function v3t(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const Jqe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],Qqe=Jqe.reduce((t,e)=>(t[e]=[],t),{}),Kqe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],j1e=new qqe({whiteList:Qqe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(Kqe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function e9e(t){return t==="Enter"||t===" "}const H1e="http://www.w3.org/",PU=`${H1e}2000/svg`,q1e=`${H1e}1999/xlink`;let xre=[],CZ=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},EZ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),W1e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},t9e=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(EZ(t[r],e))return r}return-1},RB=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(EZ(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},i9e=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Zq=[],Jq=!1,Y1e=t=>{(t.children||[]).forEach(Y1e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Tre=()=>{Jq=!1,Zq.forEach(Y1e),Zq.length=0},Sre=t=>{Zq.push(t),Jq||(Jq=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Tre,{timeout:16}):setTimeout(Tre,16))},Cre=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Sre(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Sre(t))},r9e=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")Kq(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h],f=l[p];f&&(W1e(f),i.styleApplyer(t,p,f))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),t[a]=l):i.namespace===PU?a==="href"?t.setAttributeNS(q1e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=j1e.sanitize(l):Qq(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Qq(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let P4,s9e=(t,e,i)=>{if(e)for(let r of e)US(r,t,void 0,i)},X1e=(t,e,i)=>{s9e(t,e.children,i),e.text&&(t.textContent=e.text),r9e(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},US=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),h=o.slice(n,l);u==="."?s.classList.add(h):u==="#"?s.id=h:(h==="svg"&&(r=CZ(r,{namespace:PU})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,h):(s=t.domNode=t.domNode||a.createElement(h),h==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}X1e(s,t,r)}},Kq=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},n9e=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],u=e[l];if(l==="class")u!==c&&(Kq(t,u,!1),Kq(t,c,!0));else if(l==="classes"){let h=t.classList,p=Object.keys(c),f=p.length;for(let g=0;g<f;g++){let _=p[g],v=!!c[_];v!==!!u[_]&&(s=!0,v?h.add(_):h.remove(_))}}else if(l==="styles"){let h=Object.keys(c),p=h.length;for(let f=0;f<p;f++){let g=h[f],_=c[g];_!==u[g]&&(s=!0,_?(W1e(_),r.styleApplyer(t,g,_)):r.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||Qq(t)){if(c!==u){let h=typeof c;h==="function"&&r.eventHandlerInterceptor||(r.namespace===PU?l==="href"?t.setAttributeNS(q1e,l,c):t.setAttribute(l,c):h==="string"?l==="innerHTML"?t[l]=j1e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Qq(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let h=t[l];h!==c&&(t["oninput-value"]?h===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},o9e=(t,e,i,r,s)=>{if(i===r)return!1;r=r||xre;let n,o=(i=i||xre).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let h=l<o?i[l]:void 0,p=r[c];if(h!==void 0&&EZ(h,p))u=P4(h,p,s)||u,l++;else{let f=t9e(i,p,l+1);if(f>=0){for(n=l;n<f;n++)Cre(i[n]),RB(i,n,t,"removed");u=P4(i[f],p,s)||u,l=f+1}else US(p,e,l<o?i[l].domNode:void 0,s),i9e(p),RB(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)Cre(i[n]),RB(i,n,t,"removed");return u};P4=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=CZ(i,{namespace:PU})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=o9e(e,r,t.children,e.children,i)||n,n=n9e(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let HE=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,P4(r,i,e)},domNode:t.domNode});const a9e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let sS=t=>CZ(a9e,t),S_={create:(t,e)=>(e=sS(e),US(t,document.createElement("div"),void 0,e),HE(t,e)),append:(t,e,i)=>(i=sS(i),US(e,t,void 0,i),HE(e,i)),insertBefore:(t,e,i)=>(i=sS(i),US(e,t.parentNode,t,i),HE(e,i)),merge:(t,e,i)=>(i=sS(i),e.domNode=t,X1e(t,e,i),HE(e,i)),replace:(t,e,i)=>(i=sS(i),US(e,t.parentNode,t,i),t.parentNode.removeChild(t),HE(e,i))},Z1e,l9e=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};Z1e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let c9e=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?Z1e(i.children,s=>s.domNode===r):void 0}),i},u9e=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=l9e(s.currentTarget,n.domNode);o.reverse();let a,l=c9e(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},Ere=t=>{let e,i,r=sS(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(h,p,f)=>{let g,_=()=>g;r.eventHandlerInterceptor=u9e(e,_,s),g=h(p,f(),r),a.push(g),l.push(f)},u=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let h=0;h<a.length;h++){let p=l[h]();s("rendered",void 0),a[h].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(h,p)=>{c(S_.append,h,p)},insertBefore:(h,p)=>{c(S_.insertBefore,h,p)},merge:(h,p)=>{c(S_.merge,h,p)},replace:(h,p)=>{c(S_.replace,h,p)},detach:h=>{for(let p=0;p<l.length;p++)if(l[p]===h)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},ky=class extends Pe{constructor(){super(...arguments),this.items=new lt,this._watchUpdatingTracking=new Xg,this._callbacks=new Map,this._projector=Ere(),this._hiddenProjector=Ere()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s?.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],ky.prototype,"surface",void 0),d([m({readOnly:!0})],ky.prototype,"items",void 0),d([m({readOnly:!0})],ky.prototype,"needsRender",null),d([m({readOnly:!0})],ky.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],ky.prototype,"updating",null),ky=d([U("esri.views.overlay.ViewOverlay")],ky);const Are=ky,$B=[0,0];function h9e(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return $B[0]=i.left+(e?.pageXOffset??0),$B[1]=i.top+(e?.pageYOffset??0),$B}function Mre(t){t&&(Xve(t),t.parentNode&&t.parentNode.removeChild(t))}function d9e(t){const e=document.createElement("div");return t.appendChild(e),e}const qE=16,z3=750,p9e=512,f9e=2,m9e=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:qE,time:z3},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([he(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),he(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([he(()=>this.ui,(i,r)=>this._handleUIChange(i,r),Ki),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Oe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=wU(i);if(s||typeof i!="string"||le.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Mre(this.root),this._set("root",null)),this.userContent&&(tre(this.userContent,r),Mre(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",tre(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Are;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(he(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=xw({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=gr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(he(()=>this.root,s=>{i.container=s?d9e(s):null},Ki),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=qE,i.time=z3,this.addHandles([qg(window,"resize",()=>{i.freq=qE,i.time=z3}),xw({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=qE,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?qE:Math.min(z3,n.freq*f9e),!s&&n.freq>=p9e&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&h9e(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],e.prototype,"container",null),d([m({readOnly:!0})],e.prototype,"focused",null),d([m({readOnly:!0})],e.prototype,"height",void 0),d([m()],e.prototype,"messagesCommon",void 0),d([m({type:Are})],e.prototype,"overlay",void 0),d([m({readOnly:!0})],e.prototype,"position",void 0),d([m({readOnly:!0})],e.prototype,"resizing",void 0),d([m({readOnly:!0})],e.prototype,"root",void 0),d([m({value:null,readOnly:!0})],e.prototype,"size",null),d([m({readOnly:!0})],e.prototype,"surface",void 0),d([m({readOnly:!0})],e.prototype,"suspended",void 0),d([m()],e.prototype,"ui",void 0),d([m({readOnly:!0})],e.prototype,"userContent",void 0),d([m({readOnly:!0})],e.prototype,"width",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),e=d([U("esri.views.DOMContainer")],e),e};function Tv(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function w3t(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function _o(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(WE.x=t[0],WE.y=t[1],WE.z=t[2],WE.spatialReference=e,ts(WE,i,r,s))}const WE=Tv(0,0,0,We.WGS84);function Sv(t,e,i){return!!_o(t,e,B3,i.spatialReference)&&(i.x=B3[0],i.y=B3[1],i.z=B3[2],!0)}async function J1e(t,e,i,r){return await i$(e,i.spatialReference,null,r),Sv(t,e,i)}const B3=C();function g9e(t){return ls(t,DS)||ex(t)?{wkid:bc.GCSMARS2000}:ls(t,NS)||tx(t)?{wkid:bc.GCSMOON2000}:We.WGS84}var Fr,Lo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(Fr||(Fr={}));let y9e=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Lo.ALL,this.normalRequired=!0}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Lo||(Lo={}));let _9e=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},v9e=class extends _9e{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?Kr(s):null}},Q1e=class{constructor(e){this.layerUid=e}},g$=class extends Q1e{constructor(e,i){super(e),this.graphicUid=i}};function Uh(t){return t?.dist!=null}function Pre(t){return(e,i,r)=>(or(Ore,e,i,r),!yZ(t,Ore))}function OU(t){return Uh(t)&&t.intersector===Fr.OBJECT&&!!t.target}function RU(t){return Uh(t)&&t.intersector===Fr.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const Ore=C();let y$=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Ze=class extends y${constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const TC=1e-6,YE=C(),V3=C();function b9e(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new O9e(t);t9(YE,n.minProj,n.maxProj),PM(YE,YE,.5),yh(V3,n.maxProj,n.minProj);const o=e9(V3),a=new R9e;a.quality=o,s<14&&(t=new y$(new Float64Array(n.buffer,112,42),3));const l=C(),c=C(),u=C(),h=C(),p=C(),f=C(),g=C();switch(w9e(n,t,g,l,c,u,h,p,f,a)){case 1:return void Lre(YE,V3,e);case 2:return void M9e(t,h,e)}x9e(t,g,l,c,u,h,p,f,a),K1e(t,a.b0,a.b1,a.b2,w2,x2);const _=C();yh(_,x2,w2),a.quality=e9(_),a.quality<o?ebe(a.b0,a.b1,a.b2,w2,x2,_,e):Lre(YE,V3,e)}function w9e(t,e,i,r,s,n,o,a,l,c){return T9e(t,r,s),i9(r,s)<TC?1:(yh(o,r,s),Ho(o,o),S9e(e,r,o,n)<TC?2:(yh(a,s,n),Ho(a,a),yh(l,n,r),Ho(l,l),_h(i,a,o),Ho(i,i),q1(e,i,o,a,l,c),0))}const XE=C(),ZE=C(),Du=C(),Nu=C(),Fu=C(),Q0=C(),K0=C(),ey=C();function x9e(t,e,i,r,s,n,o,a,l){C9e(t,e,i,XE,ZE),XE[0]!==void 0&&(yh(Du,XE,i),Ho(Du,Du),yh(Nu,XE,r),Ho(Nu,Nu),yh(Fu,XE,s),Ho(Fu,Fu),_h(Q0,Nu,n),Ho(Q0,Q0),_h(K0,Fu,o),Ho(K0,K0),_h(ey,Du,a),Ho(ey,ey),q1(t,Q0,n,Nu,Du,l),q1(t,K0,o,Fu,Nu,l),q1(t,ey,a,Du,Fu,l)),ZE[0]!==void 0&&(yh(Du,ZE,i),Ho(Du,Du),yh(Nu,ZE,r),Ho(Nu,Nu),yh(Fu,ZE,s),Ho(Fu,Fu),_h(Q0,Nu,n),Ho(Q0,Q0),_h(K0,Fu,o),Ho(K0,K0),_h(ey,Du,a),Ho(ey,ey),q1(t,Q0,n,Nu,Du,l),q1(t,K0,o,Fu,Nu,l),q1(t,ey,a,Du,Fu,l))}function T9e(t,e,i){let r=i9(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=i9(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}bu(e,t.minVert[s]),bu(i,t.maxVert[s])}const ku=[0,0,0];function S9e(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){ku[0]=s[l]-e[0],ku[1]=s[l+1]-e[1],ku[2]=s[l+2]-e[2];const c=i[0]*ku[0]+i[1]*ku[1]+i[2]*ku[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],h=ku[0]*ku[0]+ku[1]*ku[1]+ku[2]*ku[2]-c*c/u;h>o&&(o=h,a=l)}return bu(r,s,a),o}const Un=it();function C9e(t,e,i,r,s){A9e(t,e,Un,s,r);const n=ibe(i,e);Un[1]-TC<=n&&(r[0]=void 0),Un[0]+TC>=n&&(s[0]=void 0)}const Rre=C(),$re=C(),Ire=C(),Dx=C(),Nx=C(),G3=C();function q1(t,e,i,r,s,n){if(tbe(e)<TC)return;_h(Rre,i,e),_h($re,r,e),_h(Ire,s,e),b2(t,e,Un),Nx[1]=Un[0],Dx[1]=Un[1],G3[1]=Dx[1]-Nx[1];const o=[i,r,s],a=[Rre,$re,Ire];for(let l=0;l<3;++l){b2(t,o[l],Un),Nx[0]=Un[0],Dx[0]=Un[1],b2(t,a[l],Un),Nx[2]=Un[0],Dx[2]=Un[1],G3[0]=Dx[0]-Nx[0],G3[2]=Dx[2]-Nx[2];const c=e9(G3);c<n.quality&&(bu(n.b0,o[l]),bu(n.b1,e),bu(n.b2,a[l]),n.quality=c)}}const E9e=C();function b2(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function A9e(t,e,i,r,s){const{data:n,size:o}=t;bu(r,n),bu(s,r),i[0]=ibe(E9e,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,bu(r,n,a)),l>i[1]&&(i[1]=l,bu(s,n,a))}}function Lre(t,e,i){i.center=t,i.halfSize=ie(e,e,.5),i.quaternion=Jk}const zm=C(),Fx=C(),JE=C(),w2=C(),x2=C(),Dre=C();function M9e(t,e,i){bu(zm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?zm[0]=0:Math.abs(e[1])>Math.abs(e[2])?zm[1]=0:zm[2]=0,tbe(zm)<TC&&(zm[0]=zm[1]=zm[2]=1),_h(Fx,e,zm),Ho(Fx,Fx),_h(JE,e,Fx),Ho(JE,JE),K1e(t,e,Fx,JE,w2,x2),yh(Dre,x2,w2),ebe(e,Fx,JE,w2,x2,Dre,i)}function K1e(t,e,i,r,s,n){b2(t,e,Un),s[0]=Un[0],n[0]=Un[1],b2(t,i,Un),s[1]=Un[0],n[1]=Un[1],b2(t,r,Un),s[2]=Un[0],n[2]=Un[1]}const Vv=C(),QE=C(),j3=C(),Lp=YP(1,0,0,0,1,0,0,0,1),P9e=Gl();function ebe(t,e,i,r,s,n,o){Lp[0]=t[0],Lp[1]=t[1],Lp[2]=t[2],Lp[3]=e[0],Lp[4]=e[1],Lp[5]=e[2],Lp[6]=i[0],Lp[7]=i[1],Lp[8]=i[2],o.quaternion=$9e(P9e,Lp),t9(Vv,r,s),PM(Vv,Vv,.5),PM(QE,t,Vv[0]),PM(j3,e,Vv[1]),t9(QE,QE,j3),PM(j3,i,Vv[2]),o.center=me(QE,QE,j3),o.halfSize=ie(Vv,n,.5)}const Dc=7;let O9e=class{constructor(e){this.minVert=new Array(Dc),this.maxVert=new Array(Dc);const i=64*Dc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Dc),r+=8*Dc,this.maxProj=new Float64Array(this.buffer,r,Dc),r+=8*Dc;for(let l=0;l<Dc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Dc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Dc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Dc),n=new Array(Dc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Dc;++l){let c=s[l];bu(this.minVert[l],o,c),c=n[l],bu(this.maxVert[l],o,c)}}},R9e=class{constructor(){this.b0=Ce(1,0,0),this.b1=Ce(0,1,0),this.b2=Ce(0,0,1),this.quality=0}};function e9(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function t9(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function yh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function PM(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function bu(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function _h(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function Ho(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function tbe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function i9(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function ibe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $9e(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let rbe=class KD{constructor(e=xs,i=V9e,r=Jk){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new KD;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new KD;return i._data=e.slice(),i}static fromJSON(e){return new KD(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return te(ze.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return te(ze.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return T_e(xGe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=Wr,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],uc(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){si[0]=this._data[0]-e[0],si[1]=this._data[1]-e[1],si[2]=this._data[2]-e[2];const i=this.getQuaternion(kg);return $_(Wr,i),uc(si,si,Wr),X2(si,si),Bm[0]=Math.min(si[0],this._data[3]),Bm[1]=Math.min(si[1],this._data[4]),Bm[2]=Math.min(si[2],this._data[5]),DO(Bm,si)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;si[0]=r[0]-e[0],si[1]=r[1]-e[1],si[2]=r[2]-e[2];const s=e[3],n=s+i;return!(kF(si)>n*n)&&(Wr[0]=-r[6],Wr[1]=-r[7],Wr[2]=-r[8],Wr[3]=r[9],uc(si,si,Wr),X2(si,si),Bm[0]=Math.min(si[0],r[3]),Bm[1]=Math.min(si[1],r[4]),Bm[2]=Math.min(si[2],r[5]),DO(Bm,si)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=Wr;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],si[0]=e[0]-s[0],si[1]=e[1]-s[1],si[2]=e[2]-s[2];const o=uc(si,si,Wr),a=uc(Bm,i,Wr);let l=-1/0,c=1/0;const u=this.getHalfSize(T2);for(let h=0;h<3;h++){const p=o[h],f=a[h],g=u[h]+r;if(Math.abs(f)>1e-6){const _=(g-p)/f,v=(-g-p)/f;l=Math.max(l,Math.min(_,v)),c=Math.min(c,Math.max(_,v))}else if(p>g||p<-g)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(kg);$_(Wr,n),si[0]=e[0]-this._data[0],si[1]=e[1]-this._data[1],si[2]=e[2]-this._data[2],uc(si,si,Wr);const o=this.getHalfSize(T2),a=si[0]<-o[0]?-1:si[0]>o[0]?1:0,l=si[1]<-o[1]?-1:si[1]>o[1]?1:0,c=si[2]<-o[2]?-1:si[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const h=u===1?4:6,p=6*(a+3*l+9*c+13);eR(nS,n),u$(nS,nS,o);const f=this.getCenter(Vd);for(let v=0;v<h;v++){const b=D9e[p+v];te(si,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),On(si,si,nS),me(Gv,f,si),Gv[3]=1,Cc(Gv,Gv,i);const w=1/Math.max(1e-6,Gv[3]);Zh[2*v]=Gv[0]*w,Zh[2*v+1]=Gv[1]*w}const g=2*h-2;let _=Zh[0]*(Zh[3]-Zh[g+1])+Zh[g]*(Zh[1]-Zh[g-1]);for(let v=2;v<g;v+=2)_+=Zh[v]*(Zh[v+3]-Zh[v-1]);return Math.abs(_)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(kg);return $_(Wr,i),uc(si,e,Wr),Math.abs(si[0]*this._data[3])+Math.abs(si[1]*this._data[4])+Math.abs(si[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(kg),r=eR(nS,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=qs(r),o=qs(i),a=Q_(i,o)){if(r===n)i.isGeographic?U9e(this,e,i,s,o):k9e(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||Cw(r)))N9e(i,this,r,e,s);else if(i.isWebMercator&&Cw(r))F9e(i,this,r,e,s);else{const l=this.getCenter(Vd);l[2]+=s,jr(l,i,0,l,r,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(kg),e.halfSize=this.getHalfSize(T2))}}};const Wr=Gl(),kg=Gl(),I9e=Gl(),si=C(),Bm=C(),Gv=Yt();function L9e(t,e=new rbe){return b9e(t,e),e}const Zh=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],D9e=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function sbe(t,e,i,r,s){const n=t.getQuaternion(kg);s.quaternion=n,$_(Wr,n);const o=t.getCenter(Vd),a=t.getHalfSize(T2);if(r===Ne.Global){uc(Pr,o,Wr),X2(Ad,Pr),Yfe(Fc,Ad,a),yi(Fc,Ad,Fc);const l=Se(Fc);me(Fc,Ad,a);const c=Se(Fc);if(l<i)s.center=o,te(Pr,i,i,i),s.halfSize=me(Pr,a,Pr);else{const u=c>0?1+e/c:1,h=l>0?1+i/l:1,p=(h+u)/2,f=(h-u)/2;ie(Fc,Ad,f),s.halfSize=hn(Fc,Fc,a,p),ie(Fc,Ad,p),hn(Fc,Fc,a,f),Wfe(Pr,Pr),gk(Pr,Fc,Pr);const g=t.getQuaternion(I9e);s.center=uc(Pr,Pr,g)}}else{s.center=hn(Pr,o,Y2,(i+e)/2);const l=uc(Pr,Y2,Wr);X2(l,l),s.halfSize=hn(Ad,a,l,(i-e)/2)}return s}function N9e(t,e,i,r,s){e.getCenter(Vd),Vd[2]+=s;const n=qs(i);jr(Vd,t,0,Vd,n,0,1),nbe(n,e,Vd,i,r)}function F9e(t,e,i,r,s){e.getCenter(Vd),Vd[2]+=s,nbe(t,e,Vd,i,r)}function nbe(t,e,i,r,s){const n=e.getQuaternion(kg),o=eR(nS,n),a=e.getHalfSize(T2);for(let l=0;l<8;++l){for(let c=0;c<3;++c)$f[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=i[c];for(let h=0;h<3;++h)u+=$f[h]*o[3*h+c];eN[3*l+c]=u}}jr(eN,t,0,eN,r,0,8),L9e(z9e,s)}function k9e(t,e,i,r,s=qs(i),n=Q_(i,s)){t.getCorners(Nre),t.getCenter($f),$f[2]+=r,Io(i,$f,Nc,s),e.setCenter(Nc[12],Nc[13],Nc[14]);const o=2*Math.sqrt(1+Nc[0]+Nc[5]+Nc[10]);Wr[0]=(Nc[6]-Nc[9])/o,Wr[1]=(Nc[8]-Nc[2])/o,Wr[2]=(Nc[1]-Nc[4])/o,Wr[3]=.25*o;const a=t.getQuaternion(kg);e.quaternion=Kk(Wr,Wr,a),$_(Wr,Wr),te(Ad,0,0,0);const l=e.getCenter(B9e);for(const c of Nre)c[2]+=r,n(c,0,c,0),yi(Pr,c,l),uc(Pr,Pr,Wr),X2(Pr,Pr),Xfe(Ad,Ad,Pr);e.halfSize=Ad}function U9e(t,e,i,r,s=qs(i)){const n=er(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter($f),$f[2]+=r,jr($f,i,0,$f,s,0,1),e.center=$f;const a=t.getQuaternion(kg);e.quaternion=a,$_(Wr,a),te(Pr,0,0,1),uc(Pr,Pr,Wr);const l=t.getHalfSize(T2);te(Pr,l[0]*Math.abs(Pr[0]),l[1]*Math.abs(Pr[1]),l[2]*Math.abs(Pr[2])),ie(Pr,Pr,n.inverseFlattening),me(Pr,l,Pr),e.halfSize=ie(Pr,Pr,o)}const eN=new Array(24),z9e=new y$(eN,3),$f=C(),Vd=C(),B9e=C(),T2=C(),nS=yr(),Nc=xe(),Nre=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Pr=C(),Ad=C(),Fc=C(),V9e=Ce(-1,-1,-1);let G9e=class{constructor(){this._transform=xe(),this._transformInverse=new H3({value:this._transform},Is,xe),this._transformInverseTranspose=new H3(this._transformInverse,Pc,xe),this._transformTranspose=new H3({value:this._transform},Pc,xe),this._transformInverseRotation=new H3({value:this._transform},J_e,yr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){tn(this._transform,e)}multiplyTransform(e){Ai(this._transform,this._transform,e)}set(e){tn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},H3=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},j9e=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,i,r){const s=te(AZ,e,i,r),n=me(obe,s,this.localOrigin),o=this.offset/Se(n);return hn(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=Y9e,r=X9e,s=Z9e;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},H9e=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=C(),this._tmpMbs=Ws(),this._tmpObb=new rbe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Se(e)}applyToVertex(e,i,r){const s=te(AZ,e,i,r),n=te(obe,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Se(n);return hn(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),u=Math.abs(s),h=Math.abs(n),p=Math.abs(o),f=Math.abs(a),g=Math.abs(l),_=.5*(1+Math.sign(r*o))*Math.min(c,p),v=.5*(1+Math.sign(s*a))*Math.min(u,f),b=.5*(1+Math.sign(n*l))*Math.min(h,g),w=Math.max(c,p),T=Math.max(u,f),S=Math.max(h,g),A=Math.sqrt(_*_+v*v+b*b),P=Math.sign(c+r),R=Math.sign(u+s),F=Math.sign(h+n),k=Math.sign(p+o),N=Math.sign(f+a),j=Math.sign(g+l),z=this._totalOffset;if(A<z)return e[0]-=(1-P)*z,e[1]-=(1-R)*z,e[2]-=(1-F)*z,e[3]+=k*z,e[4]+=N*z,e[5]+=j*z,e;const X=z/Math.sqrt(w*w+T*T+S*S),q=z/A,Z=q-X,ce=-Z;return e[0]+=r*(P*ce+q),e[1]+=s*(R*ce+q),e[2]+=n*(F*ce+q),e[3]+=o*(k*Z+X),e[4]+=a*(N*Z+X),e[5]+=l*(j*Z+X),e}applyToMbs(e){const i=Se(e),r=this._totalOffset/i;return hn(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return sbe(e,this._totalOffset,this._totalOffset,Ne.Global,this._tmpObb),this._tmpObb}},q9e=class{constructor(e=0){this.offset=e,this.sphere=Ws(),this.tmpVertex=C()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=te(AZ,e,i,r),o=Ve(n,n,s),a=this.offset/Se(o);hn(o,o,o,a);const l=this.objectTransform.inverse;return Ve(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Se(e);hn(e,e,e,r);const s=this.offset/Se(i);hn(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Se(e),r=this.offset/i;return hn(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Fre=new q9e;function r9(t){return t!=null?(Fre.offset=t,Fre):null}const kre=new H9e;function Ure(t){return t!=null?(kre.offset=t,kre):null}const zre=new j9e;function W9e(t){return t!=null?(zre.offset=t,zre):null}const nv="terrain",AZ=C(),obe=C(),Y9e=C(),X9e=C(),Z9e=C(),SC=1e-5;let J9e=class{constructor(e){this.options=new y9e,this._results=new Q9e,this.transform=new G9e,this.tolerance=SC,this.verticalOffset=null,this._ray=Gn(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??Ne.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(n1e(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&S4(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ne.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,me(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??SC;const o=r9(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator?.();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=r9(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),Ve(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ve(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,h,p,f,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?b=>{const w=new v9e(e,a,h,g);b.set(Fr.HUD,w,c,u,Cr,f)}:b=>b.set(Fr.OBJECT,{object:e,geometryId:a,triangleNr:h},c,u,l,f);if((_.min.drapedLayerOrder==null||f>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==Lo.MIN&&(_.max.drapedLayerOrder==null||f<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===Lo.ALL)if(p){const b=new s9(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new S2(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?Bre(i.drapedLayerOrder,r.drapedLayerOrder):Bre(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function Bre(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function Nh(t){return new J9e(t)}let Q9e=class{constructor(){this.min=new S2(Gn()),this.max=new S2(Gn()),this.hud={min:new s9(Gn()),max:new s9(Gn()),all:new Array},this.ground=new S2(Gn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},S2=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ie(q3,this.ray.direction,this.dist),Se(q3)):null}getIntersectionPoint(e){return!!Uh(this)&&(ie(q3,this.ray.direction,this.dist),me(e,this.ray.origin,q3),!0)}getTransformedNormal(e){return ae(KE,this.normal),KE[3]=0,Cc(KE,KE,this.transformation),ae(e,KE),fe(e,e)}constructor(e){this.intersector=Fr.OBJECT,this.normal=C(),this.transformation=xe(),this._ray=Gn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Fr.OBJECT,S4(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ae(this.normal,s??Y2),tn(this.transformation,n??Cr),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){S4(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ae(this.normal,e.normal),tn(this.transformation,e.transformation)}},s9=class extends S2{constructor(){super(...arguments),this.intersector=Fr.HUD}};function MZ(t){return new S2(t)}const q3=C(),KE=Yt();function abe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,O4,r)!=null&&tme(i,O4)}function $U(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function vx(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),K9e(t,s.ray,ty)||ae(ty,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Wn(s.eye,ty)<o){const a=n.collision.enabled;ae(jv,s.viewForward),ie(jv,jv,o),a?s.eye=_e(O4,ty,jv):me(ty,s.eye,jv);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(_e(jv,ty,s.eye),s.eye=l.setAltitude(O4,u,s.eye),me(ty,s.eye,jv))}return s.center=ty,s}function Vre(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=$U(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,t7e),o=n*n;return Wn(e,i)>o}function K9e(t,e,i){let r=Gre[t.viewingMode];r||(r=Nh(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,Gre[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Vre(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Vre(t,e.origin,i))||!!s&&e7e(e,i,er(t.spatialReference).radius)}function e7e(t,e,i){const r=pe(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return ie(e,t.direction,s/Se(t.direction)),me(e,e,t.origin),!0}const Gre={},O4=C(),ty=C(),jv=C(),t7e={near:0,far:0},i7e=C(),W3=C();function PZ(){return{direction:C(),up:C()}}function lbe(t,e,i,r,s){let n=fe(i7e,t),o=pe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(pe(e,r)),o<.99?(ae(n,e),a&&ie(n,n,-1)):n=null);let l=0;if(n){ie(W3,r,pe(r,n)),_e(n,n,W3);const u=pe(n,s)/(Se(n)*Se(s));Ke(W3,n,s),l=(pe(W3,r)>0?1:-1)*ea(Zn(u))}const c=ea(Zn(-pe(r,t)/Se(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const cbe=Ce(0,1,0),ube=Ce(0,0,1),eA=xe(),Vm=C(),Gm=C();function hbe(t,e,i,r=PZ()){const{direction:s,up:n}=r;return X0e(eA,-xt(e)),sC(eA,eA,xt(i)),Ve(s,ube,eA),ie(s,s,-1),Ve(n,cbe,eA),r}function r7e(t,e,i,r){return lbe(e,i,r,ube,cbe)}function s7e(t,e,i,r){const s=hbe(t,i,r),n=C();return ie(n,s.direction,-e),me(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function n7e(t){return ea(t)}function o7e(t){return xt(t)}function dbe(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return ts(e,Vm,n),ts(e,Gm,n),Vm[0]-=i/2,Gm[0]+=i/2,Vm[1]-=r/2,Gm[1]+=r/2,_o(Vm,n,Vm,o),_o(Gm,n,Gm,o),s?(s.xmin=Vm[0],s.ymin=Vm[1],s.xmax=Gm[0],s.ymax=Gm[1],s.spatialReference=o):s=new Qi(Vm[0],Vm[1],Gm[0],Gm[1],o),s}const a7e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:r7e,eyeForCenterWithHeadingTilt:s7e,eyeTiltToLookAtTilt:o7e,headingTiltToDirectionUp:hbe,lookAtTiltToEyeTilt:n7e,toExtent:dbe},Symbol.toStringTag,{value:"Module"}));function jre(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return l7e(t,e.longitude,e.latitude,i.longitude,i.latitude)}function l7e(t,e,i,r,s){const n=xt(i),o=xt(s),a=n-o,l=xt(e)-xt(r),c=Math.sin(a/2),u=Math.sin(l/2),h=2*up(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*h)/1e4}function c7e(t,e,i){const r=e.spatialReference,s=er(r),n=new Xe(e.x,t.y,r),o=new Xe(i.x,t.y,r),a=new Xe(t.x,e.y,r),l=new Xe(t.x,i.y,r);return{lon:jre(s.radius,n,o),lat:jre(s.radius,a,l)}}function u7e(t,e,i){const r=e/i,s=xt(t),n=Math.sin(r/2),o=Math.cos(s),a=2*up(Math.sqrt(n*n/(o*o)));return ea(a)}function h7e(t,e){let i=t/15;return e||(i=Math.round(i)),i}function Hre(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=h7e(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const pbe=Ce(0,0,1),fbe=fe(C(),Ce(1,1,1)),d7e=new Z_(-180,180),tA=xe(),s_=C(),kx=C();function mbe(t,e,i,r=PZ()){Ke(s_,t,pbe),pe(s_,s_)===0&&Ke(s_,t,fbe),Bl(tA,-xt(e),t),Sc(tA,tA,-xt(i),s_);const{up:s,direction:n}=r;return Ke(s,s_,t),fe(s,s),Ve(s,s,tA),fe(n,t),Yn(n,n),Ve(n,n,tA),r}function p7e(t,e,i,r){const s=s_,n=kx;return fe(s,t),Ke(kx,s,pbe),pe(kx,kx)===0&&Ke(kx,s,fbe),Ke(n,kx,s),lbe(e,i,r,s,n)}function f7e(t,e,i,r){const s={eye:C(),up:null,tilt:r,heading:i},n=s_;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=xt(i),l=xt(r),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),p=Math.cos(l),f=Se(n);let g;if(Math.abs(l)<1e-8)g=o+f;else{const ce=f/h,I=up(o/ce),D=Math.PI-l-I;g=ce*Math.sin(D)}const _=p*o,v=o*o*(h*h),b=u*u*v,w=g-_,T=w*w,S=b*(b+T-n[1]*n[1]);if(S<0)return ie(s.eye,n,g/f),s.tilt=0,Y3(s,t);const A=Math.sqrt(S),P=n[1]*w,R=b+T;let F;if(F=u>0?-A+P:A+P,Math.abs(R)<1e-8)return f<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ie(s.eye,n,g/f),s.tilt=0,IB(s.eye),Y3(s,t);s.eye[1]=F/R;const k=c*c*v,N=h*o,j=u*N*s.eye[1],z=s.eye[1]*s.eye[1],X=1-z,q=Math.sqrt(X),Z=b*z+k-2*j*q*w+X*T;return Math.abs(Z)<1e-8?(ie(s.eye,n,g/f),s.tilt=0,IB(s.eye),Y3(s,t)):(s.eye[0]=(X*(g*n[0]-_*n[0])-N*q*(n[0]*s.eye[1]*u+n[2]*c))/Z,s.eye[2]=(X*(g*n[2]-_*n[2])-N*q*(n[2]*s.eye[1]*u-n[0]*c))/Z,ie(s.eye,s.eye,g),IB(s.eye),Y3(s,t))}function IB(t){const e=t[1];t[1]=-t[2],t[2]=e}function Y3(t,e){const i=mbe(e,t.heading,t.tilt);return t.up=i.up,t}function m7e(t,e,i){const r=Se(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=up(i/(s/Math.sin(t)));return ea(t-n)}function g7e(t,e,i){const r=xt(t),s=Se(e);return up(i/(s/Math.sin(r)))+r}function gbe(t,e,i,r,s){let n,o,a,l;const c=e.latitude,u=er(t.spatialReference).radius,h=e.longitude,p=u7e(c,i,u)/2;n=h-p,o=h+p;const f=xt(c),g=(1+Math.sin(f))/(1-Math.sin(f)),_=(g+1)*Math.tan(r/u/2),v=_*_;function b(T){const S=Math.PI/2;return(T=oze.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+v))),l=a+r/u,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(ea(a),-90),l=Math.min(ea(l),90),o=d7e.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:We.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new Qi(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&DP(s,!1,s),s}const y7e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:p7e,eyeForCenterWithHeadingTilt:f7e,eyeTiltToLookAtTilt:g7e,headingTiltToDirectionUp:mbe,lookAtTiltToEyeTilt:m7e,toExtent:gbe},Symbol.toStringTag,{value:"Module"}));function R4(t){return t.type==="point"}let OZ=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function ybe(t){return"array"in t}function Bf(t,e,i="ground"){if(R4(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(ybe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const _be=()=>le.getLogger("esri.views.3d.support.cameraUtils"),vbe=39.37,bbe=96,n9=1,_7e=8,v7e=5,wbe=1,qre=C(),b7e={heading:0,tilt:0},JP=C(),w7e=new Z_(-20037508342788905e-9,20037508342788905e-9),x7e=new Z_(-180,180);var Qo;function Cv(t){return t.spatialReference??We.WGS84}function pE(t){return t.viewingMode==="global"?y7e:a7e}function T7e(t,e,i,r,s){return pE(t).headingTiltToDirectionUp(e,i,r,s)}function Ag(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=pE(t).headingTiltToDirectionUp,s=C();if(!ts(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);ie(n.direction,n.direction,t.state.camera.distance),me(n.direction,n.direction,s);const o=vx(t,s,n.direction,n.up);return o.fov=xt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Qo||(Qo={}));const Ux=C();function CC(t,e,i){const r=t.renderSpatialReference,s=LU(t,e.eye,e.viewForward,e.up,b7e);let n=Cv(t);return _o(e.eye,r,Ux,n)||(n=We.WGS84,_o(e.eye,r,Ux,n)),i==null?i=new Pu(new Xe(Ux,n),s.heading,s.tilt,ea(e.fov)):(i.position.x=Ux[0],i.position.y=Ux[1],i.position.z=Ux[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=ea(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function IU(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Ne.Global&&i!=null&&(e*=Math.cos(xt(i))),e/=t.renderCoordsHelper.unitInMeters,s/(bbe*vbe/e)/Math.tan(r.fovX/2)}function ov(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=bbe*vbe/(n/s);return t.renderCoordsHelper.viewingMode===Ne.Global&&i!=null&&(o/=Math.cos(xt(i))),o*t.renderCoordsHelper.unitInMeters}async function xbe(t,e,i,r,s,n){return Tbe(t,e,IU(t,i,e.latitude),r,s,n)}function S7e(t,e,i,r,s,n){return Fbe(t,RZ(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function Tbe(t,e,i,r,s,n){const o=await Cbe(t,r.heading,r.tilt,e,i,s,n);return yt(n),kbe(t,o,r.fov,n)}function LU(t,e,i,r,s){return pE(t).directionToHeadingTilt(e,i,r,s)}function Sbe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,JP,t.spatialReference)&&t.elevationProvider&&(Bf(t.elevationProvider,JP)??0)>JP[2]-wbe)}async function C7e(t,e,i){if(Sbe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,JP,s))return!1;const[o,a,l]=JP,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return yt(i),c>l-wbe}async function E7e(t,e,i){const r=C();if(e==null)return ae(r,t.state.camera.center);if(e instanceof Xe){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await _4(e,r,s,0,{signal:i}),yt(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);yt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ae(r,e)}function A7e(t,e){const i=C();if(e==null)return ae(i,t.state.camera.center);if(e instanceof Xe){if(!ts(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Bf(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ae(i,e)}function RZ(t,e,i,r,s,n){return Ebe(t,e,i,r instanceof Xe?r:null,A7e(t,r),s,n)}async function Cbe(t,e,i,r,s,n,o){const a=r instanceof Xe?r:null,l=await E7e(t,r,o);return yt(o),Abe(t,e,i,a,l,s,n,o)}function Ebe(t,e,i,r,s,n,o){if(s==null||!r&&(r=new Xe({spatialReference:Cv(t)}),!Sv(s,t.renderSpatialReference,r)))return null;const a=Mbe(t,e,i,s,n,o);if(Pbe(t,i,o)&&Sbe(t,a.eye)){const{tilt:l,mode:c}=Obe(t,i,s,n);return Ebe(t,e,l,r,s,n,c)}return Rbe(a,s)}async function Abe(t,e,i,r,s,n,o,a){r||(r=new Xe({spatialReference:Cv(t)}),await J1e(s,t.renderSpatialReference,r,{signal:a})||(r=null)),yt(a);const l=Mbe(t,e,i,s,n,o);if(Pbe(t,i,o)&&await C7e(t,l.eye,a)){yt(a);const{tilt:c,mode:u}=Obe(t,i,s,n);return Abe(t,e,c,r,s,n,u,a)}return Rbe(l,s)}function Mbe(t,e,i,r,s,n){const o=P7e(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,pE(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function Pbe(t,e,i){const r=t.map.ground.navigationConstraint;return i===Qo.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function Obe(t,e,i,r){const s=Nbe(t,i,r,R7e(t,r,e,i));return{tilt:s,mode:e-s<1?Qo.LOCKED:Qo.ADJUST}}function Rbe(t,e){return{...t,center:Kr(e)}}function $be(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&YO(s,Ne.Global)||i.isLocal&&r.equals(s)}function Ibe(t,e){let i,r,s;if(t.state.isGlobal){const u=new Xe(e.xmin,e.ymin,e.spatialReference),h=new Xe(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?x7e:w7e;i=new Xe({x:p.center(u.x,h.x),y:(h.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const f=er(e.spatialReference),g=c7e(i,u,h);r=g.lon,s=g.lat,p.diff(u.x,h.x)>p.range/2&&(r+=f.halfCircumference),r=Math.min(r,f.halfCircumference),s=Math.min(s,f.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=bv(e,u)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const h=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new Xe({x:e.xmin+.5*r,y:e.ymin+.5*s,z:h,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/n9}}async function Lbe(t,e,i,r,s,n){const o=$be(t,e)?e:await tv(e,t.spatialReference,{signal:n});yt(n);const{center:a,distance:l}=Ibe(t,o),c=await Cbe(t,i,r,a,l,s,n);return yt(n),kbe(t,c,t.camera.fov,n)}function tN(t,e,i,r,s,n){let o;try{o=$be(t,e)?e:bv(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=Ibe(t,o),c=RZ(t,i,r,a,l,s);return c==null?null:Fbe(t,c,t.camera.fov,n)}function Dbe(t,e,i){const r=t.renderSpatialReference,s=new Xe({spatialReference:Cv(t)});if(!Sv(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=P_(e.eye,i),l=2*a*n*n9,c=2*a*o*n9;return t.viewingMode==="global"?gbe(t,s,l,c):dbe(t,s,l,c)}function M7e(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>_7e)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return hr(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>v7e}function P7e(t,e,i,r,s,n){let o=0;return n===Qo.ADJUST&&M7e(t,r,s)?(e=0,o=O7e(t,s,i,r)):o=$Z(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=Nbe(t,r,s,o)}}const $4=.7;function O7e(t,e,i,r){const s=$Z(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-$4)+n.max*$4;return Math.min(s,o)}function R7e(t,e,i,r){let s=$Z(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-$4)+s*$4}function Nbe(t,e,i,r){return pE(t).lookAtTiltToEyeTilt(r,e,i)}function $Z(t,e,i,r){return pE(t).eyeTiltToLookAtTilt(r,e,i)}function Fbe(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new Xe({spatialReference:Cv(t)});return Sv(e.eye,s,n)?(r??(r=new Pu),r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function kbe(t,e,i,r){const s=t.renderSpatialReference,n=new Xe({spatialReference:Cv(t)});return await J1e(e.eye,s,n,{signal:r}),yt(r),new Pu(n,e.heading,e.tilt,i)}function $7e(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);_be().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Ube(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);_be().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function zbe(t,e){const{renderSpatialReference:i}=t,r=g9e(i);let s=null;try{_o(e.center,i,qre,r)&&(s=qre[1])}catch{}return ov(t,e.distance,s)}const IZ=()=>le.getLogger("esri.layers.support.ElevationSampler");let Bbe=class{queryElevation(e){return Vbe(e.clone(),this)}on(){return Mi()}projectIfRequired(e,i){return Gbe(e,i)}},I7e=class extends Bbe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=_k(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=sl(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return vk(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return IZ().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},G3t=class extends Bbe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new I7e(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=_k(Vt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||IZ().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function Vbe(t,e){const i=Gbe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":L7e(t,i,e);break;case"polyline":D7e(t,i,e);break;case"multipoint":N7e(t,i,e)}return t}function Gbe(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=HR(t,e);return r||IZ().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function L7e(t,e,i){t.z=i.elevationAt(e.x,e.y)}function D7e(t,e,i){If.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];If.x=c[0],If.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(If.x,If.y)}}t.hasZ=!0}function N7e(t,e,i){If.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];If.x=o[0],If.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(If.x,If.y)}t.hasZ=!0}const If=new Xe;var o9;let mf=o9=class extends Me{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new o9({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mf.prototype,"cols",void 0),d([m({type:Rr,json:{write:!0}})],mf.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],mf.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mf.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],mf.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mf.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],mf.prototype,"scale",void 0),mf=o9=d([U("esri.layers.support.LOD")],mf);const Id=mf;let F7e=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var Uy;const Wre=new Do({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let la=Uy=class extends Me{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=We.WebMercator,numLODs:n=24}=t;if(!jd(s)){const h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p];h.push(new Id({level:p,scale:f,resolution:f}))}else{let p=5e-4;for(let f=n-1;f>=0;f--)h.unshift(new Id({level:f,scale:p,resolution:p})),p*=2}return new Uy({dpi:96,lods:h,origin:new Xe(0,0,s),size:[r,r],spatialReference:s})}const o=Yg(s),a=t.origin?new Xe({x:t.origin.x,y:t.origin.y,spatialReference:s}):new Xe(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(sl(s)*39.37*l),u=[];if(i)for(let h=0;h<i.length;h++){const p=i[h],f=p*c;u.push(new Id({level:h,scale:p,resolution:f}))}else{let h=GR(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const p=Math.ceil(n/e);u.push(new Id({level:0,scale:h,resolution:h*c}));for(let f=1;f<p;f++){const g=h/2**e,_=g*c;u.push(new Id({level:f,scale:g,resolution:_})),h=g}}return new Uy({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Yg(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return Xe.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(ls(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=HR(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new F7e(null,0,0,0,Vt())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=Uy.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===Uy.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Vt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return Uy.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new Id({level:s,scale:o,resolution:a}))}return new Uy({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};d([m({type:Number,json:{write:!0}})],la.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],la.prototype,"dpi",void 0),d([m({type:String,json:{read:Wre.read,write:Wre.write,origins:{"web-scene":{read:!1,write:!1}}}})],la.prototype,"format",void 0),d([m({readOnly:!0})],la.prototype,"isWrappable",null),d([m({type:Xe,json:{write:!0}})],la.prototype,"origin",void 0),d([_i("origin")],la.prototype,"readOrigin",null),d([m({type:[Id],value:null,json:{write:!0}})],la.prototype,"lods",null),d([m({readOnly:!0})],la.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],la.prototype,"size",void 0),d([_i("size",["rows","cols"])],la.prototype,"readSize",null),d([Ut("size",{cols:{type:Rr},rows:{type:Rr}})],la.prototype,"writeSize",null),d([m({type:We,json:{write:!0}})],la.prototype,"spatialReference",void 0),la=Uy=d([U("esri.layers.support.TileInfo")],la),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(la||(la={}));const iN=la,k7e=12;let gc=class tc{constructor(e){const i=tc.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=GR(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,u)=>(u.level<c.minLod.level&&(c.minLod=u),c.max=Math.max(c.max,u.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new tc(this.toTileInfo())}toTileInfo(){return new iN({dpi:this.dpi,origin:new Xe({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Id({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=vee(e[0]),i[1]=LF(e[1]),i[2]=vee(e[2]),i[3]=LF(e[3])):this._isGCS&&(i[0]=xt(e[0]),i[1]=xt(e[1]),i[2]=xt(e[2]),i[3]=xt(e[3]))}getExtentGeometry(e,i,r,s=new Qi){return this.getExtent(e,i,r,Dp),s.spatialReference=this.spatialReference,s.xmin=Dp[0],s.ymin=Dp[1],s.xmax=Dp[2],s.ymax=Dp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(tc.checkUnsupported(e))return!1;const r=new tc(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!O_(r.origin[0],this.origin[0],o)||!O_(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*k7e,O_(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;tc.computeRowColExtent(e,n,this.origin,Dp);let o=Dp[1],a=Dp[3],l=Dp[0],c=Dp[2];const u=c-l,h=a-o;if(u*h>r){const p=Math.floor(Math.sqrt(r));h>p&&(o=o+Math.floor(.5*h)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let f=l;f<c;f++)s.push([0,p,f]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!SDe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?LZ():e.lods.length<1?new W("tilingscheme:generic","Tiling scheme must have at least one level"):tc.isPowerOfTwo(e)?tc.hasGapInLevels(e)?new W("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):tc.tileSizeSupported(e)?tc.hasOriginPerLODs(e)?new W("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new W("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new W("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=sl(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),u=new tc(new iN({size:[a,a],origin:new Xe({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Id({level:0,resolution:l,scale:c})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new tc(tc.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new tc(new iN({size:[i,i],origin:new Xe({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Id({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function LZ(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}gc.WebMercatorAuxiliarySphereTileInfo=new iN({size:[256,256],origin:new Xe({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:We.WebMercator}),spatialReference:We.WebMercator,lods:[new Id({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),gc.WebMercatorAuxiliarySphere=gc.makeWebMercatorAuxiliarySphere(19);const Dp=Vt(),zS=64,OM=512,U7e=2.5,DZ=CDe(Oj/10),jbe=2,Hbe=Vt();gc.WebMercatorAuxiliarySphere.getExtent(0,0,0,Hbe);const z7e=Vt([-180,-90,180,90]),B7e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",V7e="Surface extent is too large for tile resolution at level 0.",xn=4;let zy=class extends Ls.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=DZ}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=_k(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??We.WGS84}elevationAt(e,i){if(this.extent==null||!Va(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return le.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return Vbe(e.clone(),this)}};d([m({readOnly:!0})],zy.prototype,"demResolution",void 0),d([m({readOnly:!0})],zy.prototype,"extent",null),d([m({readOnly:!0})],zy.prototype,"noDataValue",void 0),d([m()],zy.prototype,"spatialReference",null),d([m({constructOnly:!0})],zy.prototype,"view",void 0),zy=d([U("esri.views.support.GroundViewElevationSampler")],zy);const G7e=zy;let fg=class extends Pe{constructor(e){super(e),this.view=null,this.layerViews=new lt}initialize(){this.addHandles(zl(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new G7e({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?Dbe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>he(()=>e.updating,()=>this._updateUpdating(),Ji)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([m({readOnly:!0})],fg.prototype,"elevationSampler",null),d([m({readOnly:!0})],fg.prototype,"extent",null),d([m({type:Boolean,readOnly:!0})],fg.prototype,"updating",null),d([m({constructOnly:!0})],fg.prototype,"view",void 0),d([m({type:lt,readOnly:!0})],fg.prototype,"layerViews",void 0),d([m({readOnly:!0})],fg.prototype,"suspended",null),fg=d([U("esri.views.GroundView")],fg);const j7e=fg;let g0=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new Cpe(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=Fpe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)iee(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)iee(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const H7e=se("mac")?"Meta":"Control",q7e=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),W7e=t=>q7e.has(t);let Y7e=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},ko=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new Y7e(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const h=this._incoming[u.match.eventType];if(h){const p=h.indexOf(u);h.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new X7e(n,r,{onPause:a,onRemove:a,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new Z7e(e,{onEmit:(r,s,n,o)=>{this._manager?.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},X7e=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Z7e=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},J7e=class extends ko{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},Q7e=class extends ko{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Jf(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Qu=class extends Pe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=H7e,this._latestPointerType="mouse",this._propertiesPool=new g0({latestPointerLocation:tWe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=D_.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,h)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,h,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):le.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)W7e(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Control",!(!o||!o.ctrlKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new J7e((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Q7e,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],D_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,D_.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new K7e(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new x4,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),s=i.data?.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new x4;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};d([m({readOnly:!0})],Qu.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],Qu.prototype,"eventSource",void 0),d([m({constructOnly:!0})],Qu.prototype,"recognizers",void 0),d([m()],Qu.prototype,"_latestPointerType",void 0),d([m()],Qu.prototype,"latestPointerType",null),d([m()],Qu.prototype,"multiTouchActive",null),d([m({readOnly:!0})],Qu.prototype,"latestPointerLocation",void 0),d([m()],Qu.prototype,"_paused",void 0),d([m({readOnly:!0})],Qu.prototype,"updating",null),Qu=d([U("esri.views.input.InputManager")],Qu);let K7e=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=n_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=n_.STOPPED}shouldStopPropagation(){return!!(this._propagationState&n_.STOPPED)}async(e){this._propagationState|=n_.PAUSED;const i=(r,s)=>{this._propagationState&=~n_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&n_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var n_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(n_||(n_={}));const D_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let eWe=class{};const tWe=eWe;function jm(t){return t!=null&&"open"in t&&"declaredClass"in t}function Yre(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const iWe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([he(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&jm(l)&&(l.view=null,Yre(l)&&a.remove(l,n))}i&&jm(r)&&(r.view=this,Yre(r)&&i.add(r,{key:n,position:o,internal:!0}))},Ki),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(jm(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),jm(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},D_.WIDGET)]),iC(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ue(()=>import("./Popup-fb3fb0b5.js"),["./Popup-fb3fb0b5.js","./unitFormatUtils-ad485d8a.js","./AttachmentInfo-3b01e65c.js","./RelationshipQuery-fd495a9f.js","./utils-319bcf9e.js","./ColorStop-6a565283.js","./jsonUtils-e39cab6d.js","./UniqueValueRenderer-e5955946.js","./diffUtils-0e3a2a24.js","./colorRamps-aa93f22c.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./executeQueryJSON-63562981.js","./query-dd3a3bae.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./FeatureSet-285ce5c1.js","./TopFeaturesQuery-ddd1e8da.js","./FeatureLayer-326b1176.js","./layerContainerType-e1118fe6.js","./FeatureLayerBase-d5ed4315.js","./commonProperties-97bbff58.js","./labelingInfo-6875761c.js","./featureQueryAll-8963e799.js","./LayerFloorInfo-9ce38ca0.js","./Relationship-8c123d3c.js","./serviceCapabilitiesUtils-33da8a9b.js","./editsZScale-6832178a.js","./APIKeyMixin-83f77fe3.js","./ArcGISService-d812484b.js","./CustomParametersMixin-8721f5b8.js","./EditBusLayer-0d63c689.js","./FeatureEffectLayer-bc968aef.js","./FeatureEffect-9c3784e1.js","./FeatureFilter-9d3ae08e.js","./FeatureReductionLayer-22d2a189.js","./FeatureReductionSelection-c427965c.js","./MD5-715f37cd.js","./OperationalLayer-4cc379ff.js","./OrderedLayer-0c8aa1d7.js","./PortalLayer-995215c8.js","./RefreshableLayer-fb6b2fc5.js","./TemporalLayer-0399f521.js","./TimeInfo-448b5524.js","./FeatureTemplate-a8080318.js","./FeatureType-01c856b1.js","./fieldProperties-e0b01c7d.js","./versionUtils-dda94076.js","./styleUtils-f3879cce.js","./popupUtils-7d91b48e.js","./ReactiveSet-a739e6ad.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(jm(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void le.getLogger(this).error(new W("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),jm(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!jm(this.popup))return this._popupSetupTask=Tm(async i=>{const{default:r}=await ue(()=>import("./Popup-fb3fb0b5.js"),["./Popup-fb3fb0b5.js","./unitFormatUtils-ad485d8a.js","./AttachmentInfo-3b01e65c.js","./RelationshipQuery-fd495a9f.js","./utils-319bcf9e.js","./ColorStop-6a565283.js","./jsonUtils-e39cab6d.js","./UniqueValueRenderer-e5955946.js","./diffUtils-0e3a2a24.js","./colorRamps-aa93f22c.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./executeQueryJSON-63562981.js","./query-dd3a3bae.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./FeatureSet-285ce5c1.js","./TopFeaturesQuery-ddd1e8da.js","./FeatureLayer-326b1176.js","./layerContainerType-e1118fe6.js","./FeatureLayerBase-d5ed4315.js","./commonProperties-97bbff58.js","./labelingInfo-6875761c.js","./featureQueryAll-8963e799.js","./LayerFloorInfo-9ce38ca0.js","./Relationship-8c123d3c.js","./serviceCapabilitiesUtils-33da8a9b.js","./editsZScale-6832178a.js","./APIKeyMixin-83f77fe3.js","./ArcGISService-d812484b.js","./CustomParametersMixin-8721f5b8.js","./EditBusLayer-0d63c689.js","./FeatureEffectLayer-bc968aef.js","./FeatureEffect-9c3784e1.js","./FeatureFilter-9d3ae08e.js","./FeatureReductionLayer-22d2a189.js","./FeatureReductionSelection-c427965c.js","./MD5-715f37cd.js","./OperationalLayer-4cc379ff.js","./OrderedLayer-0c8aa1d7.js","./PortalLayer-995215c8.js","./RefreshableLayer-fb6b2fc5.js","./TemporalLayer-0399f521.js","./TimeInfo-448b5524.js","./FeatureTemplate-a8080318.js","./FeatureType-01c856b1.js","./fieldProperties-e0b01c7d.js","./versionUtils-dda94076.js","./styleUtils-f3879cce.js","./popupUtils-7d91b48e.js","./ReactiveSet-a739e6ad.js"],import.meta.url);if(yt(i),!this.popup||jm(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new r(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=h3e(s,se("popup-view-fetch-timeout")??sWe),c=p=>{const f=new rWe(p);return o.push(f),n.push(f.promise),f},u=p=>{const f=o.at(-1);return f&&f.layerView===p&&!a?f:c(p)};for(const p of r)"graphic"in p?(u(p.layerView).graphics.push(p.graphic),a=!1):(n.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,l)),a=!0);o.map(p=>p.resolve(l));const h=bF(n).then(p=>p.filter(f=>!!f).flat());return{pendingFeatures:n,allGraphicsPromise:h,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);yt(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return d([m({cast(i){return!i||jm(i)||typeof i=="object"&&(i.open=r=>(o0(le.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(o0(le.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),d([m()],e.prototype,"popupEnabled",void 0),e=d([U("esri.views.PopupView")],e),e};let rWe=class{constructor(e){this.layerView=e,this._resolver=Pn(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const sWe=5e3;let By=class extends Pe{constructor(e){super(e),this.view=null,this.baseLayerViews=new lt,this.referenceLayerViews=new lt,this._loadingHandle=he(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Ki)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view?.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};d([m({constructOnly:!0})],By.prototype,"view",void 0),d([m({readOnly:!0})],By.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],By.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],By.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],By.prototype,"updating",null),By=d([U("esri.views.BasemapView")],By);function nWe(t){return"tryRecycleWith"in t}function oWe(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let aWe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Pn(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,un(this._controller.signal,()=>{const s=new W("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!nWe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(yt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>un(this._controller.signal,()=>u(vi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let s,n;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),cWe(i))s=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new W("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(i);yt(e),s="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}const o=()=>{n=gr(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=un(e,o),yt(e);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new W("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=s,i.emit("layerview-create",{view:r,layerView:s}),r.emit("layerview-create",{layer:i,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){i.emit("layerview-create-error",{view:r,error:s}),r.emit("layerview-create-error",{layer:i,error:s}),this.done=!0,this._deferred.reject(new W("layerview:create-error","layerview creation failed",{layer:i,error:s}))}}},Ku=class extends Pe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Xg,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Pn(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(XC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){r.add(c);const u=this._layerLayerViewInfoMap.get(c);u&&n?u.start():u||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(ep(this,l));for(const[l,c]of this._layerLayerViewInfoMap)if(!r.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const u=c.tryRecycle(s);u?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),u.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)r.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of s)this._createLayerView(l);this._refreshCollections();const a=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.referenceLayers,i?.layers].filter(l=>!!l);r.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([yo(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),he(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),qi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),uB(this._recyclingInfoMap),uB(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(vi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||vu(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(uB(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new W("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!r?.done)return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&e.layers?.length)&&e.layers.some(n=>this.isCreatingLayerViewsForLayer(n,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(ep(this,e),ep(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o?.layerView)continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&oWe(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new aWe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(sn(r)||r.name==="cancelled:layerview-create")||le.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],Ku.prototype,"_workPromise",void 0),d([m({readOnly:!0})],Ku.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],Ku.prototype,"_layersToLayerViews",null),d([m({readOnly:!0})],Ku.prototype,"_rootCollectionNames",null),d([m()],Ku.prototype,"layerViewImporter",void 0),d([m()],Ku.prototype,"supportsGround",void 0),d([m({readOnly:!0})],Ku.prototype,"updating",null),d([m({readOnly:!0})],Ku.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],Ku.prototype,"view",void 0),Ku=d([U("esri.views.LayerViewManager")],Ku);const lWe=Ku;function cWe(t){return"createLayerView"in t&&t.createLayerView!=null}let Wc=class extends Pe{constructor(e){super(e),this.factor=1.5,this.offset=$h(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],Wc.prototype,"factor",void 0),d([m({nonNullable:!0})],Wc.prototype,"offset",void 0),d([m()],Wc.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],Wc.prototype,"size",void 0),d([m()],Wc.prototype,"maskUrl",void 0),d([m()],Wc.prototype,"maskEnabled",void 0),d([m()],Wc.prototype,"overlayUrl",void 0),d([m()],Wc.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],Wc.prototype,"version",null),d([m({type:Boolean})],Wc.prototype,"visible",void 0),Wc=d([U("esri.views.Magnifier")],Wc);const qbe=Wc;let rN=class{constructor(e){this._observable=new YR,this._map=new Map(e)}get size(){return Ot(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Ot(this._observable),this._map.entries()}forEach(e,i){Ot(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return Ot(this._observable),this._map.get(e)}has(e){return Ot(this._observable),this._map.has(e)}keys(){return Ot(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Ot(this._observable),this._map.values()}[Symbol.iterator](){return Ot(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var a9;let RM=a9=class extends Me{constructor(t){super(t),this.name=null,this.code=null}clone(){return new a9({name:this.name,code:this.code})}};d([m({type:String,json:{write:!0}})],RM.prototype,"name",void 0),d([m({type:[String,Number],json:{write:!0}})],RM.prototype,"code",void 0),RM=a9=d([U("esri.layers.support.CodedValue")],RM);const uWe=new Do({inherited:"inherited",codedValue:"coded-value",range:"range"});let $M=class extends Me{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],$M.prototype,"name",void 0),d([At(uWe)],$M.prototype,"type",void 0),$M=d([U("esri.layers.support.Domain")],$M);const DU=$M;var l9;let IM=l9=class extends DU{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new l9({codedValues:ge(this.codedValues),name:this.name})}};d([m({type:[RM],json:{write:!0}})],IM.prototype,"codedValues",void 0),d([At({codedValue:"coded-value"})],IM.prototype,"type",void 0),IM=l9=d([U("esri.layers.support.CodedValueDomain")],IM);const Wbe=IM;var c9;let sN=c9=class extends DU{constructor(t){super(t),this.type="inherited"}clone(){return new c9}};d([At({inherited:"inherited"})],sN.prototype,"type",void 0),sN=c9=d([U("esri.layers.support.InheritedDomain")],sN);const Ybe=sN;var u9;let oS=u9=class extends DU{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new u9({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],oS.prototype,"maxValue",void 0),d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],oS.prototype,"minValue",void 0),d([At({range:"range"})],oS.prototype,"type",void 0),oS=u9=d([U("esri.layers.support.RangeDomain")],oS);const Xbe=oS,hWe={key:"type",base:DU,typeMap:{range:Xbe,"coded-value":Wbe,inherited:Ybe}};function dWe(t){if(!t?.type)return null;switch(t.type){case"range":return Xbe.fromJSON(t);case"codedValue":return Wbe.fromJSON(t);case"inherited":return Ybe.fromJSON(t)}return null}var h9;const pWe=new Do({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Fa=h9=class extends Me{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?.value??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?pWe.fromJSON(i.fieldValueType):null}clone(){return new h9({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([m({type:String,json:{write:!0}})],Fa.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],Fa.prototype,"defaultValue",void 0),d([m()],Fa.prototype,"description",void 0),d([_i("description")],Fa.prototype,"readDescription",null),d([m({types:hWe,json:{read:{reader:dWe},write:!0}})],Fa.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],Fa.prototype,"editable",void 0),d([m({type:Rr,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Fa.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],Fa.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],Fa.prototype,"nullable",void 0),d([At(IX)],Fa.prototype,"type",void 0),d([m()],Fa.prototype,"valueType",void 0),d([_i("valueType",["description"])],Fa.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],Fa.prototype,"visible",void 0),Fa=h9=d([U("esri.layers.support.Field")],Fa);const Zbe=Fa;var d9;let aS=d9=class extends Me{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new d9({mapLayerId:t,gdbVersion:e})}};d([At({mapLayer:"map-layer"})],aS.prototype,"type",void 0),d([m({type:Rr,json:{write:!0}})],aS.prototype,"mapLayerId",void 0),d([m({type:String,json:{write:!0}})],aS.prototype,"gdbVersion",void 0),aS=d9=d([U("esri.layers.support.source.MapLayerSource")],aS);var p9;let mg=p9=class extends Me{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:s};return new p9(n)}};d([At({queryTable:"query-table"})],mg.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],mg.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],mg.prototype,"query",void 0),d([m({type:String,json:{write:!0}})],mg.prototype,"oidFields",void 0),d([m({type:We,json:{write:!0}})],mg.prototype,"spatialReference",void 0),d([At(gme)],mg.prototype,"geometryType",void 0),mg=p9=d([U("esri.layers.support.source.QueryTableDataSource")],mg);var f9;let lS=f9=class extends Me{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new f9({workspaceId:t,dataSourceName:e})}};d([At({raster:"raster"})],lS.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],lS.prototype,"dataSourceName",void 0),d([m({type:String,json:{write:!0}})],lS.prototype,"workspaceId",void 0),lS=f9=d([U("esri.layers.support.source.RasterDataSource")],lS);var m9;let W1=m9=class extends Me{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new m9({workspaceId:t,gdbVersion:e,dataSourceName:i})}};d([At({table:"table"})],W1.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],W1.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],W1.prototype,"gdbVersion",void 0),d([m({type:String,json:{write:!0}})],W1.prototype,"dataSourceName",void 0),W1=m9=d([U("esri.layers.support.source.TableDataSource")],W1);var g9,y9;const fWe=rl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Yc=g9=class extends Me{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Xre()(t,e,i)}castLeftTableSource(t){return lm(_9(),t)}readRightTableSource(t,e,i){return Xre()(t,e,i)}castRightTableSource(t){return lm(_9(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:s};return new g9(n)}};d([At({joinTable:"join-table"})],Yc.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Yc.prototype,"leftTableKey",void 0),d([m({type:String,json:{write:!0}})],Yc.prototype,"rightTableKey",void 0),d([m({json:{write:!0}})],Yc.prototype,"leftTableSource",void 0),d([_i("leftTableSource")],Yc.prototype,"readLeftTableSource",null),d([cr("leftTableSource")],Yc.prototype,"castLeftTableSource",null),d([m({json:{write:!0}})],Yc.prototype,"rightTableSource",void 0),d([_i("rightTableSource")],Yc.prototype,"readRightTableSource",null),d([cr("rightTableSource")],Yc.prototype,"castRightTableSource",null),d([At(fWe)],Yc.prototype,"joinType",void 0),Yc=g9=d([U("esri.layers.support.source.JoinTableDataSource")],Yc);let LB=null;function Xre(){return LB||(LB=KW({types:_9()})),LB}let DB=null;function _9(){return DB||(DB={key:"type",base:null,typeMap:{"data-layer":Mg,"map-layer":aS}}),DB}const mWe={key:"type",base:null,typeMap:{"join-table":Yc,"query-table":mg,raster:lS,table:W1}};let Mg=y9=class extends Me{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new y9({fields:t,dataSource:e})}};d([At({dataLayer:"data-layer"})],Mg.prototype,"type",void 0),d([m({type:[Zbe],json:{write:!0}})],Mg.prototype,"fields",void 0),d([m({types:mWe,json:{write:!0}})],Mg.prototype,"dataSource",void 0),Mg=y9=d([U("esri.layers.support.source.DataLayerSource")],Mg),Mg.from=mo(Mg);let Y1=class extends Ic(Me){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([m({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],Y1.prototype,"onFields",void 0),d([m({type:String,json:{write:!0}})],Y1.prototype,"operator",void 0),d([m({type:String,json:{write:!0}})],Y1.prototype,"searchTerm",void 0),d([m({type:String,json:{write:!0}})],Y1.prototype,"searchType",void 0),Y1=d([U("esri.rest.support.FullTextSearch")],Y1);const gWe=Y1;var v9;const Zre=new Do({upperLeft:"upper-left",lowerLeft:"lower-left"});let X1=v9=class extends Me{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new v9(ge({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([m({type:Qi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],X1.prototype,"extent",void 0),d([m({type:["view","edit"],json:{write:!0}})],X1.prototype,"mode",void 0),d([m({type:String,json:{read:Zre.read,write:Zre.write}})],X1.prototype,"originPosition",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],X1.prototype,"tolerance",void 0),X1=v9=d([U("esri.rest.support.QuantizationParameters")],X1);const yWe=X1,_We=new Do({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var b9;const Jre=new Do({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let gd=b9=class extends Me{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ge(t))}clone(){return new b9({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ge(this.statisticParameters)})}};d([m({type:Number,json:{write:!0}})],gd.prototype,"maxPointCount",void 0),d([m({type:Number,json:{write:!0}})],gd.prototype,"maxRecordCount",void 0),d([m({type:Number,json:{write:!0}})],gd.prototype,"maxVertexCount",void 0),d([m({type:String,json:{write:!0}})],gd.prototype,"onStatisticField",void 0),d([m({type:String,json:{write:!0}})],gd.prototype,"outStatisticFieldName",void 0),d([m({type:String,json:{read:{source:"statisticType",reader:Jre.read},write:{target:"statisticType",writer:Jre.write}}})],gd.prototype,"statisticType",void 0),d([m({type:Object})],gd.prototype,"statisticParameters",void 0),d([Ut("statisticParameters")],gd.prototype,"writeStatisticParameters",null),gd=b9=d([U("esri.rest.support.StatisticDefinition")],gd);const vWe=gd;var nN;const bWe=new Do({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let It=nN=class extends Me{static from(t){return _w(nN,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new nN(ge({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};It.MAX_MAX_RECORD_COUNT_FACTOR=5,d([m({json:{write:!0}})],It.prototype,"aggregateIds",void 0),d([m({type:Boolean,json:{write:!0}})],It.prototype,"cacheHint",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"compactGeometryEnabled",void 0),d([m({json:{write:!0}})],It.prototype,"datumTransformation",void 0),d([cr("datumTransformation")],It.prototype,"castDatumTransformation",null),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"defaultSpatialReferenceEnabled",void 0),d([m({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],It.prototype,"distance",void 0),d([m({type:Mg,json:{write:!0}})],It.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],It.prototype,"formatOf3DObjects",void 0),d([m({type:[gWe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],It.prototype,"fullText",void 0),d([m({type:String,json:{write:!0}})],It.prototype,"gdbVersion",void 0),d([m({types:Tk,json:{read:$w,write:!0}})],It.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],It.prototype,"geometryPrecision",void 0),d([m({type:[String],json:{write:!0}})],It.prototype,"groupByFieldsForStatistics",void 0),d([m({type:String,json:{write:!0}})],It.prototype,"having",void 0),d([m({type:Date})],It.prototype,"historicMoment",void 0),d([Ut("historicMoment")],It.prototype,"writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],It.prototype,"maxAllowableOffset",void 0),d([m({type:Number,cast:t=>t<1?1:t>It.MAX_MAX_RECORD_COUNT_FACTOR?It.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],It.prototype,"maxRecordCountFactor",void 0),d([m({type:["xyFootprint"],json:{write:!0}})],It.prototype,"multipatchOption",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],It.prototype,"num",void 0),d([m({json:{write:!0}})],It.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],It.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],It.prototype,"outFields",void 0),d([m({type:We,json:{name:"outSR",write:!0}})],It.prototype,"outSpatialReference",void 0),d([m({type:[vWe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],It.prototype,"outStatistics",void 0),d([m({json:{write:!0}})],It.prototype,"parameterValues",void 0),d([Ut("parameterValues")],It.prototype,"writeParameterValues",null),d([m({type:Xe,json:{write:!0}})],It.prototype,"pixelSize",void 0),d([m({type:yWe,json:{write:!0}})],It.prototype,"quantizationParameters",void 0),d([m({type:[Object],json:{write:!0}})],It.prototype,"rangeValues",void 0),d([m({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],It.prototype,"relationParameter",void 0),d([m({type:String,json:{write:!0}})],It.prototype,"resultType",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnCentroid",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnDistinctValues",void 0),d([m({type:Boolean,json:{default:!0,write:!0}})],It.prototype,"returnExceededLimitFeatures",void 0),d([m({type:Boolean,json:{write:!0}})],It.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnQueryGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],It.prototype,"returnZ",void 0),d([m({type:We,json:{write:!0}})],It.prototype,"sourceSpatialReference",void 0),d([At(_We,{ignoreUnknown:!1,name:"spatialRel"})],It.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],It.prototype,"start",void 0),d([Ut("start"),Ut("num")],It.prototype,"writeStart",null),d([m({type:String,json:{write:!0}})],It.prototype,"sqlFormat",void 0),d([m({type:String,json:{write:!0}})],It.prototype,"text",void 0),d([m({type:rp,json:{write:!0}})],It.prototype,"timeExtent",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"timeReferenceUnknownClient",void 0),d([At(bWe,{ignoreUnknown:!1}),m({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],It.prototype,"units",void 0),d([m({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],It.prototype,"where",void 0),d([Ut("where")],It.prototype,"writeWhere",null),It=nN=d([U("esri.rest.support.Query")],It);const Qre=It;function X3(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let gg=class extends Ls.EventedAccessor{constructor(e){super(e),this._selectionMap=new rN,this._sources=new lt,this._trashCan=[],this._layerEditHandles=new lt,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([he(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),yo(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new lt;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(X3(i)&&!Yke(i)||B1(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(gr)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){dm(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=B1(l)?l.parent:l;if(u==null||!ese(u))return null;if(r==="layer")return tse(u,c,i);if(Kre(u))return null;const h=await s.whenLayerView(u).catch(()=>null);return h?tse(h,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(X3(o)||B1(o))&&a!==null){const l=ZW(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(X3(o)||B1(o))&&a!==null){const l=i.get(o),c=l?.indexOf(a);c!==void 0&&c>=0&&(l?.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const u=n.get(l);u!==void 0&&o.push(u),n.set(l,{selection:c}),a.push({layer:l,selection:c,...H6(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=C3e(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const o of e){const a=r.get(o),l=B1(o)?o.parent:o;if(l!=null&&ese(l)){if(Kre(l))continue;i.whenLayerView(l).then(c=>{a?.highlightHandle?.remove(),a!=null&&s&&n===this._vizTaskId&&"highlight"in c&&typeof c.highlight=="function"&&a.selection.length>0&&(a.highlightHandle=c.highlight(a.selection,"selection"))}).catch(()=>{a?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(gr);for(const e of this.sources){const i=B1(e)?e.parent:e;if(i!=null&&X3(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(YC);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!xWe(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...H6(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};d([m({readOnly:!0,nonNullable:!0})],gg.prototype,"selections",null),d([m({readOnly:!0,nonNullable:!0})],gg.prototype,"count",null),d([m({constructOnly:!0,nonNullable:!0})],gg.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],gg.prototype,"hasSelection",null),d([m()],gg.prototype,"showHighlight",void 0),d([m()],gg.prototype,"sources",null),gg=d([U("esri.views.SelectionManager")],gg);const Kre=t=>B1(t)?t.parent?.isTable===!0:t.isTable,wWe=t=>t.layer!==void 0,ese=t=>t?.when!==void 0,xWe=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},tse=async(t,e,i={})=>{let r;if(wWe(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new Qre({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new Qre({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},TWe=gg;let LM=class extends Ic(Pe){constructor(e){super(e),this.accentColor=new et([255,127,0]),this.textColor=new et([255,255,255])}};d([m({type:et,nonNullable:!0})],LM.prototype,"accentColor",void 0),d([m({type:et,nonNullable:!0})],LM.prototype,"textColor",void 0),LM=d([U("esri.views.Theme")],LM);const w9=LM;var ise;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(ise||(ise={}));const Jbe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Qbe={};function Kbe(t){return!!Qbe[t]}function SWe(t){for(const e of t)if(!Kbe(e))return!1;return!0}Jbe.forEach(t=>{Qbe[t]=!0});let CWe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>this.inputManager?.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!SWe(n))return n.some(Kbe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??D_.DEFAULT;const l=this._createUniqueGroupName(),c=new EWe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const h=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Mi(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},EWe=class extends ko{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(PWe(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(OWe(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(RWe(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s($We(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(IWe(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(LWe(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(DWe(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(iA(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(iA(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(iA(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(NWe(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(FWe(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(iA(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(iA(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(kWe(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(AWe(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(MWe(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:h}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:i.radius,angle:ea(i.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}};function AWe(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function MWe(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function PWe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:$h(n,o),mapPoint:_$(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function OWe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:_$(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function RWe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:_$(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function $We(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:_$(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function IWe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:_$(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function _$(t,e,i){return t.toMap($h(e,i),{exclude:[]})}function LWe(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function DWe(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function iA(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:h}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:h,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}function NWe(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:h,timestamp:p}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:s,timestamp:p,eventId:n,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function FWe(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function kWe(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var lR,rse,sse;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(lR||(lR={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(rse||(rse={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(sse||(sse={}));function UWe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return le.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function x9(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(lR.USER)&&t.getEditableFlag(lR.MANAGER)}function gf(t){return $h(t.x,t.y)}function gIt(t){return ns(t.x,t.y)}function ewe(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?$h(e.clientX-i.left,e.clientY-i.top):$h(0,0)}function nse(t,e){return e instanceof Event?ewe(t,e):gf(e)}function ose(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let zWe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":lse(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!cse(e))break;const s=gf(e),n=zx(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!cse(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s?.manipulator,o=s?.tool;if(n==null||o==null)break;const a=gf(e);a.x=Te(a.x,0,i.view.width),a.y=Te(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=gf(e),n=zx(s,e.pointerType,i.forEachTool);if(BWe(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:h})=>{h.selected&&(h.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),NB(o,r);break}case"click":{const s=gf(e),n=zx(s,e.pointerType,i.forEachTool),o=n?.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=gf(e),n=zx(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),NB(o,r);break}case"immediate-double-click":{const s=gf(e),n=zx(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),NB(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:gf(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:gf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=ase(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=ase(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=H$e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition($h(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!lse(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(gf(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=zx(e,r,s);const o=this._hoveredManipulators.get(i)?.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function ase(t){let e=null;return vu(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(e=i.grabCursor,!0):!!i.cursor&&(e=i.cursor,!0))),e}function zx(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!x9(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function lse(t){return t==="mouse"}function cse(t){return t.pointerType!=="mouse"||t.button===0}function BWe(t){return!!t.native.shiftKey}function NB(t,e){t?.consumesClicks&&e()}const use="attached",FB="tools",VWe=1e3;let yf=class extends Pe{constructor(e){super(e),this._updatingHandles=new Xg,this._clock=UR,this._manipulatorState=new zWe,this.tools=new lt,this.cursor=null,this._interacting=!1,this._interactingTimeout=VWe,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(Jbe,e=>{this._handleInputEvent(e)},D_.TOOL),...UWe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void le.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=x9(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=gr(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([he(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],use):this.addHandles(he(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(use),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(FB),this._forEachTool(e=>{if(e instanceof Pe){const i=he(()=>[e.cursor,e.visible,e.editable],()=>{x9(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,FB)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],FB)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(lR.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};d([m({constructOnly:!0,nonNullable:!0})],yf.prototype,"view",void 0),d([m({value:null})],yf.prototype,"activeTool",null),d([m({readOnly:!0,type:lt})],yf.prototype,"tools",void 0),d([m({readOnly:!0})],yf.prototype,"cursor",void 0),d([m({readOnly:!0})],yf.prototype,"updating",null),d([m()],yf.prototype,"_interacting",void 0),d([m({readOnly:!0})],yf.prototype,"interacting",null),yf=d([U("esri.views.ToolViewManager")],yf);let cS=class extends Pe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":GWe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return jWe[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],cS.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],cS.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],cS.prototype,"axisThreshold",null),cS=d([U("esri.views.input.gamepad.GamepadInputDevice")],cS);const NZ=cS,GWe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),jWe={standard:.15,spacemouse:.025,unknown:0};let DM=class extends Pe{constructor(...e){super(...e),this.devices=new lt,this.enabledFocusMode="document"}};d([m({type:lt.ofType(NZ),readOnly:!0})],DM.prototype,"devices",void 0),d([m({type:["document","view","none"]})],DM.prototype,"enabledFocusMode",void 0),DM=d([U("esri.views.input.gamepad.GamepadSettings")],DM);const HWe=DM;let oN=class extends Pe{constructor(){super(...arguments),this.gamepad=new HWe}};d([m({readOnly:!0})],oN.prototype,"gamepad",void 0),oN=d([U("esri.views.input.Input")],oN);const qWe=oN,WWe=()=>Gi.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let Vy=class extends Pe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],Vy.prototype,"enabled",void 0),d([m({type:NZ})],Vy.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],Vy.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],Vy.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],Vy.prototype,"velocityFactor",void 0),Vy=d([U("esri.views.navigation.gamepad.GamepadSettings")],Vy);const twe=Vy;let Z1=class extends Pe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new twe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!WWe()}};d([m({type:Boolean})],Z1.prototype,"browserTouchPanEnabled",void 0),d([m({type:twe,nonNullable:!0})],Z1.prototype,"gamepad",void 0),d([m({type:Boolean})],Z1.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],Z1.prototype,"mouseWheelZoomEnabled",void 0),Z1=d([U("esri.views.navigation.Navigation")],Z1);const iwe=Z1;let T9,kB=null;async function YWe(t){kB||(kB=ue(()=>Promise.resolve().then(()=>svt),void 0,import.meta.url).then(e=>T9=e)),await kB,yt(t)}async function rwe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return lE()||Vl(s,e)?bv(t,e):T9?T9.projectGeometry(t,e,i,r):(await Promise.race([YWe(r),cC(r)]),rwe(t,e,i,r))}let Hr=class extends Pe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=il(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:s?.spatialReference??null,viewingMode:s?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const r=e[0].tileInfo;return{tileInfo:r?.spatialReference.equals(this.spatialReference)?r:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const r of e)if(Vze(r)){const s=Hye(r);if(s)return{heightModelInfo:s,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=il(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:Tm(async n=>{try{const o=await rwe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(qn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=ZWe(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Ne.Local)&&(e=e.filter(({viewingMode:r})=>r!==Ne.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const i=new XWe;for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{sn(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};d([m()],Hr.prototype,"required",void 0),d([m({constructOnly:!0})],Hr.prototype,"map",void 0),d([m({constructOnly:!0})],Hr.prototype,"getSpatialReferenceSupport",void 0),d([m()],Hr.prototype,"defaultSpatialReference",void 0),d([m()],Hr.prototype,"userSpatialReference",void 0),d([m()],Hr.prototype,"sourcePreloadCount",void 0),d([m()],Hr.prototype,"priorityCollection",void 0),d([m()],Hr.prototype,"requiresExtentInSpatialReference",void 0),d([m()],Hr.prototype,"suspended",void 0),d([m({readOnly:!0})],Hr.prototype,"ready",null),d([m({readOnly:!0})],Hr.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],Hr.prototype,"spatialReference",null),d([m({readOnly:!0})],Hr.prototype,"extent",null),d([m({readOnly:!0})],Hr.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Hr.prototype,"vcsWkid",null),d([m({readOnly:!0})],Hr.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],Hr.prototype,"viewingMode",null),d([m({readOnly:!0})],Hr.prototype,"tileInfo",null),d([m({readOnly:!0})],Hr.prototype,"mapCollections",null),d([m({readOnly:!0})],Hr.prototype,"_allLayers",null),d([m({readOnly:!0})],Hr.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],Hr.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],Hr.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],Hr.prototype,"_extentCandidatesTask",null),d([m()],Hr.prototype,"_extentTask",null),d([m()],Hr.prototype,"_projectExtentTask",void 0),Hr=d([U("esri.views.support.DefaultsFromMap")],Hr);let XWe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function ZWe(t,e){return t!=null?e!=null?t===e&&t:t:e}var NM;let Ct=NM=class extends Ls.EventedMixin(e$(Pe)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new _m,this.updatingHandles=new Xg,this.allLayerViews=new qO({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:QWe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new lw,this.analyses=new xC,this.typeSpecificPreconditionsReady=!0,this.layerViews=new lt,this.magnifier=new qbe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new qWe,this.navigation=new iwe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new CWe(this),this.persistableViewModels=new lt,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(he(()=>this.preconditionsReady,e=>{const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,NM.views.add(this)):(this._lockedSpatialReference=null,NM.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(r){return void queueMicrotask(()=>{this.fatalError=new W("startup-error",null,r)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Ji))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,iC(()=>this.ready)))),this.basemapView=new By({view:this}),this.layerViewManager=new lWe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new yf({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new TWe({view:this}),this.addHandles([he(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},qi),he(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},Ji),he(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},qi)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([he(()=>this.defaultsFromMap?.ready,e=>{const i=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const r=Mi(()=>t=il(t));t=Tm(async s=>{try{await PO(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}le.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(r,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(NM.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Oe(this.graphics),this.analyses=Oe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Oe(this.analysisViewManager),this.toolViewManager=Oe(this.toolViewManager),this.layerViewManager=Oe(this.layerViewManager),this.selectionManager=Oe(this.selectionManager),this.basemapView=Oe(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Oe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return le.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Hr({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||pm.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(le.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),pm.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&this.defaultsFromMap?.required?.heightModelInfo){const e=t.clone();return e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,e}return t}set spatialReference(t){const e=!ls(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??um}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===um||t===BY||e.has(t.toLowerCase())||i.has(t.toLowerCase())||le.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new w9}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(t){throw new W("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&le.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(zl(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Ct.views=new lt,d([m()],Ct.prototype,"_userSpatialReference",void 0),d([m()],Ct.prototype,"activeTool",null),d([m({readOnly:!0})],Ct.prototype,"allLayerViews",void 0),d([m()],Ct.prototype,"groundView",void 0),d([m()],Ct.prototype,"animation",null),d([m()],Ct.prototype,"basemapView",void 0),d([m()],Ct.prototype,"center",null),d([m({readOnly:!0})],Ct.prototype,"_defaultsFromMapSettings",null),d([m()],Ct.prototype,"defaultsFromMap",null),d([m()],Ct.prototype,"fatalError",void 0),d([m({type:Qi})],Ct.prototype,"extent",null),d([m(w4(lw,"graphics"))],Ct.prototype,"graphics",void 0),d([m(w4(xC,"analyses"))],Ct.prototype,"analyses",void 0),d([m({readOnly:!0,type:hx})],Ct.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Ct.prototype,"interacting",null),d([m({readOnly:!0})],Ct.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Ct.prototype,"preconditionsReady",null),d([m({readOnly:!0})],Ct.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:lt,readOnly:!0})],Ct.prototype,"layerViews",void 0),d([m()],Ct.prototype,"resolution",null),d([m({type:qbe})],Ct.prototype,"magnifier",void 0),d([m({value:null,type:gye})],Ct.prototype,"map",null),d([m()],Ct.prototype,"padding",void 0),d([m({readOnly:!0})],Ct.prototype,"ready",void 0),d([m({type:We})],Ct.prototype,"spatialReference",null),d([m()],Ct.prototype,"spatialReferenceWarningDelay",void 0),d([m()],Ct.prototype,"stationary",null),d([m({readOnly:!0})],Ct.prototype,"supportsGround",void 0),d([m({type:rp})],Ct.prototype,"timeExtent",void 0),d([m({type:String,nonNullable:!0})],Ct.prototype,"timeZone",null),d([m()],Ct.prototype,"tools",null),d([m()],Ct.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],Ct.prototype,"type",void 0),d([m({type:Number})],Ct.prototype,"scale",void 0),d([m({readOnly:!0})],Ct.prototype,"updating",void 0),d([m({readOnly:!0})],Ct.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],Ct.prototype,"initialExtent",null),d([m()],Ct.prototype,"cursor",null),d([m({readOnly:!0})],Ct.prototype,"input",void 0),d([m({type:iwe,nonNullable:!0})],Ct.prototype,"navigation",void 0),d([m()],Ct.prototype,"layerViewManager",void 0),d([m()],Ct.prototype,"analysisViewManager",void 0),d([m()],Ct.prototype,"selectionManager",void 0),d([m()],Ct.prototype,"width",void 0),d([m()],Ct.prototype,"height",void 0),d([m({readOnly:!0})],Ct.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],Ct.prototype,"size",null),d([m({readOnly:!0})],Ct.prototype,"suspended",void 0),d([m({readOnly:!0})],Ct.prototype,"viewEvents",void 0),d([m({readOnly:!0})],Ct.prototype,"persistableViewModels",void 0),d([m()],Ct.prototype,"_isValid",void 0),d([m()],Ct.prototype,"_readyCycleForced",void 0),d([m()],Ct.prototype,"_lockedSpatialReference",void 0),d([m()],Ct.prototype,"_userTimeZone",void 0),d([m()],Ct.prototype,"_lockedTimeZone",void 0),d([m({type:w9})],Ct.prototype,"theme",void 0),d([m({readOnly:!0,type:w9})],Ct.prototype,"effectiveTheme",null),Ct=NM=d([U("esri.views.View")],Ct);const JWe=Ct;function QWe(t){return t.layerViews}let Gy=class extends t4{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Pn(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new W("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=$c(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};d([m({readOnly:!0})],Gy.prototype,"done",null),d([m({readOnly:!0,type:String})],Gy.prototype,"state",void 0),d([m()],Gy.prototype,"target",void 0),Gy=d([U("esri.views.ViewAnimation")],Gy),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Gy||(Gy={}));const EC=Gy,rA=()=>ue(()=>import("./TileLayerView3D-d58fc706.js"),["./TileLayerView3D-d58fc706.js","./LayerView3D-77681ce3.js","./TiledLayerView3D-77131e93.js","./fetchTile-5d655851.js","./RefreshableLayer-fb6b2fc5.js","./layerContainerType-e1118fe6.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./MapServiceLayerViewHelper-4e22890e.js","./floorFilterUtils-73949d2d.js","./drapedUtils-7f968a53.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./sublayerUtils-91ec9f35.js","./popupUtils-0412893d.js"],import.meta.url),hse=()=>ue(()=>import("./ElevationLayerView3D-fa2bd00c.js"),["./ElevationLayerView3D-fa2bd00c.js","./LercDecoder-1bf5560e.js","./WorkerHandle-becb41d0.js","./LayerView3D-77681ce3.js","./TiledLayerView3D-77131e93.js","./LayerView-7059f1fc.js"],import.meta.url),dse={"base-dynamic":()=>ue(()=>import("./BaseDynamicLayerView3D-1bbf9567.js"),["./BaseDynamicLayerView3D-1bbf9567.js","./DynamicLayerView3D-bedc5568.js","./LayerView3D-77681ce3.js","./projectExtentUtils-9d38f719.js","./ImageMaterial-9da60cfc.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),"base-elevation":hse,"base-tile":rA,"bing-maps":rA,"building-scene":()=>ue(()=>import("./BuildingSceneLayerView3D-4ada5eff.js"),["./BuildingSceneLayerView3D-4ada5eff.js","./BuildingGroupSublayer-bffdb417.js","./BuildingComponentSublayer-d4e62531.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./diffUtils-0e3a2a24.js","./colorRamps-aa93f22c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./FeatureLayer-326b1176.js","./layerContainerType-e1118fe6.js","./FeatureLayerBase-d5ed4315.js","./commonProperties-97bbff58.js","./labelingInfo-6875761c.js","./featureQueryAll-8963e799.js","./RelationshipQuery-fd495a9f.js","./LayerFloorInfo-9ce38ca0.js","./Relationship-8c123d3c.js","./serviceCapabilitiesUtils-33da8a9b.js","./editsZScale-6832178a.js","./queryZScale-2c7fab80.js","./FeatureSet-285ce5c1.js","./APIKeyMixin-83f77fe3.js","./ArcGISService-d812484b.js","./CustomParametersMixin-8721f5b8.js","./EditBusLayer-0d63c689.js","./FeatureEffectLayer-bc968aef.js","./FeatureEffect-9c3784e1.js","./FeatureFilter-9d3ae08e.js","./FeatureReductionLayer-22d2a189.js","./FeatureReductionSelection-c427965c.js","./MD5-715f37cd.js","./OperationalLayer-4cc379ff.js","./OrderedLayer-0c8aa1d7.js","./PortalLayer-995215c8.js","./RefreshableLayer-fb6b2fc5.js","./TemporalLayer-0399f521.js","./TimeInfo-448b5524.js","./FeatureTemplate-a8080318.js","./FeatureType-01c856b1.js","./fieldProperties-e0b01c7d.js","./versionUtils-dda94076.js","./styleUtils-f3879cce.js","./TopFeaturesQuery-ddd1e8da.js","./popupUtils-7d91b48e.js","./capabilities-c607cf72.js","./I3SIndexInfo-7c65c66d.js","./I3SLayerDefinitions-d7ed2162.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js","./popupUtils-0412893d.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./I3SMeshView3D-61f59237.js","./Transform-912c5e4c.js","./RenderTexture-81201e70.js","./I3SOverrides-1e66895a.js","./I3SNode-0b3faaff.js","./ReactiveSet-a739e6ad.js","./meshFeatureSet-bff6fc68.js","./FeatureLayerView3D-12ed5c2a.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./Graphics3DObjectStates-d0fd362c.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./SceneModification-c366c18c.js","./persistable-32839550.js","./resourceExtension-4c53d4ca.js","./SceneLayerWorker-69404a9a.js","./makeScheduleFunction-e2d1207a.js","./I3SQueryFeatureStore-10302a89.js","./TemporalSceneLayerView-6fe19ceb.js"],import.meta.url),catalog:()=>ue(()=>import("./CatalogLayerView3D-979df172.js"),["./CatalogLayerView3D-979df172.js","./LayerView3D-77681ce3.js","./LayerView-7059f1fc.js"],import.meta.url),"catalog-dynamic-group":()=>ue(()=>import("./CatalogDynamicGroupLayerView3D-4d437ae7.js"),["./CatalogDynamicGroupLayerView3D-4d437ae7.js","./LayerView3D-77681ce3.js","./LayerView-7059f1fc.js"],import.meta.url),"catalog-footprint":()=>ue(()=>import("./CatalogFootprintLayerView3D-06e79d78.js"),["./CatalogFootprintLayerView3D-06e79d78.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),csv:()=>ue(()=>import("./CSVLayerView3D-62048325.js"),["./CSVLayerView3D-62048325.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),dimension:()=>ue(()=>import("./DimensionLayerView3D-6728e605.js"),["./DimensionLayerView3D-6728e605.js","./LayerView3D-77681ce3.js","./LayerView-7059f1fc.js"],import.meta.url),elevation:hse,feature:()=>ue(()=>import("./FeatureLayerView3D-12ed5c2a.js"),["./FeatureLayerView3D-12ed5c2a.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),geojson:()=>ue(()=>import("./GeoJSONLayerView3D-4748305b.js"),["./GeoJSONLayerView3D-4748305b.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),graphics:()=>ue(()=>import("./GraphicsLayerView3D-b906db10.js"),["./GraphicsLayerView3D-b906db10.js","./LayerView3D-77681ce3.js","./queryForSymbologySnapping-05ee48aa.js","./GraphicsProcessor-032fe6c3.js","./diffUtils-0e3a2a24.js","./Graphics3DObjectStates-d0fd362c.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./projectExtentUtils-9d38f719.js","./LayerView-7059f1fc.js"],import.meta.url),group:()=>ue(()=>import("./GroupLayerView-ca5f0fed.js"),["./GroupLayerView-ca5f0fed.js","./LayerView-7059f1fc.js"],import.meta.url),imagery:()=>ue(()=>import("./ImageryLayerView3D-e45078f5.js"),["./ImageryLayerView3D-e45078f5.js","./DynamicLayerView3D-bedc5568.js","./LayerView3D-77681ce3.js","./projectExtentUtils-9d38f719.js","./ImageMaterial-9da60cfc.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./timeSupport-88508996.js","./popupUtils-0412893d.js"],import.meta.url),"integrated-mesh":()=>ue(()=>import("./IntegratedMeshLayerView3D-12818b11.js"),["./IntegratedMeshLayerView3D-12818b11.js","./I3SMeshView3D-61f59237.js","./Transform-912c5e4c.js","./RenderTexture-81201e70.js","./I3SOverrides-1e66895a.js","./I3SNode-0b3faaff.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js","./ReactiveSet-a739e6ad.js","./featureQueryAll-8963e799.js","./meshFeatureSet-bff6fc68.js","./FeatureSet-285ce5c1.js","./FeatureLayerView3D-12ed5c2a.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./SceneModification-c366c18c.js","./persistable-32839550.js","./MD5-715f37cd.js","./resourceExtension-4c53d4ca.js","./SceneLayerWorker-69404a9a.js","./makeScheduleFunction-e2d1207a.js"],import.meta.url),"integrated-mesh-3dtiles":()=>ue(()=>import("./IntegratedMesh3DTilesLayerView3D-a6756f3f.js"),["./IntegratedMesh3DTilesLayerView3D-a6756f3f.js","./Transform-912c5e4c.js","./RenderTexture-81201e70.js","./ILyr3DWasmPerSceneView-b1ab6e1f.js","./LayerView3D-77681ce3.js","./LayerView-7059f1fc.js"],import.meta.url),"line-of-sight":()=>ue(()=>import("./LineOfSightLayerView3D-8feff691.js"),["./LineOfSightLayerView3D-8feff691.js","./LayerView3D-77681ce3.js","./LayerView-7059f1fc.js"],import.meta.url),"map-image":()=>ue(()=>import("./MapImageLayerView3D-c696703d.js"),["./MapImageLayerView3D-c696703d.js","./DynamicLayerView3D-bedc5568.js","./LayerView3D-77681ce3.js","./projectExtentUtils-9d38f719.js","./ImageMaterial-9da60cfc.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./ExportImageParameters-c9d9e113.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-91ec9f35.js","./timeSupport-88508996.js","./MapServiceLayerViewHelper-4e22890e.js","./drapedUtils-7f968a53.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./popupUtils-0412893d.js"],import.meta.url),media:()=>ue(()=>import("./MediaLayerView3D-d185691f.js").then(t=>t.M),["./MediaLayerView3D-d185691f.js","./MediaElementView-f3c01ed4.js","./normalizeUtilsSync-b173de9a.js","./normalizeUtilsCommon-eecee6b6.js","./LayerView3D-77681ce3.js","./keybindings-7c7d5818.js","./SnappingManagerPool-04d35fa6.js","./geodesicLengthMeasurementUtils-d6665296.js","./geometryEngine-e08263d2.js","./geometryEngineBase-1fd17bb5.js","./hydrated-109b30e2.js","./geometry2dUtils-8e7f7801.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./ImageMaterial-9da60cfc.js","./LayerView-7059f1fc.js"],import.meta.url),"ogc-feature":()=>ue(()=>import("./OGCFeatureLayerView3D-06b67ad2.js"),["./OGCFeatureLayerView3D-06b67ad2.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),"open-street-map":rA,"oriented-imagery":()=>ue(()=>import("./FeatureLayerView3D-12ed5c2a.js"),["./FeatureLayerView3D-12ed5c2a.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),"point-cloud":()=>ue(()=>import("./PointCloudLayerView3D-aef026de.js").then(t=>t.a),["./PointCloudLayerView3D-aef026de.js","./LayerView3D-77681ce3.js","./WorkerHandle-becb41d0.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js","./PointCloudWorkerUtil-06c24da8.js","./PointCloudUniqueValueRenderer-9ef50fd1.js","./ColorStop-6a565283.js","./PopupSceneLayerView-08041ac5.js","./popupUtils-0412893d.js","./LayerView-7059f1fc.js"],import.meta.url),voxel:()=>ue(()=>import("./VoxelLayerView3D-4313c0b2.js"),["./VoxelLayerView3D-4313c0b2.js","./LayerView3D-77681ce3.js","./PopupSceneLayerView-08041ac5.js","./popupUtils-0412893d.js","./LayerView-7059f1fc.js"],import.meta.url),route:()=>ue(()=>import("./RouteLayerView3D-5ac5945b.js"),["./RouteLayerView3D-5ac5945b.js","./Stop-b5a81d1f.js","./LayerView3D-77681ce3.js","./GraphicsProcessor-032fe6c3.js","./diffUtils-0e3a2a24.js","./Graphics3DObjectStates-d0fd362c.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./projectExtentUtils-9d38f719.js","./EventedSet-c2bd6307.js","./LayerView-7059f1fc.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ue(()=>import("./SceneLayerView3D-5253a2de.js"),["./SceneLayerView3D-5253a2de.js","./ReactiveSet-a739e6ad.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./UnknownTimeZone-bc39bc88.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./I3SMeshView3D-61f59237.js","./Transform-912c5e4c.js","./RenderTexture-81201e70.js","./I3SOverrides-1e66895a.js","./I3SNode-0b3faaff.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js","./featureQueryAll-8963e799.js","./meshFeatureSet-bff6fc68.js","./FeatureSet-285ce5c1.js","./FeatureLayerView3D-12ed5c2a.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./SceneModification-c366c18c.js","./persistable-32839550.js","./MD5-715f37cd.js","./resourceExtension-4c53d4ca.js","./SceneLayerWorker-69404a9a.js","./makeScheduleFunction-e2d1207a.js","./SceneLayerView-3f962698.js","./TemporalSceneLayerView-6fe19ceb.js","./I3SQueryFeatureStore-10302a89.js","./PopupSceneLayerView-08041ac5.js"],import.meta.url):ue(()=>import("./SceneLayerGraphicsView3D-73456cb0.js"),["./SceneLayerGraphicsView3D-73456cb0.js","./I3SOverrides-1e66895a.js","./RenderTexture-81201e70.js","./I3SNode-0b3faaff.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js","./ReactiveSet-a739e6ad.js","./featureQueryAll-8963e799.js","./meshFeatureSet-bff6fc68.js","./FeatureSet-285ce5c1.js","./FeatureLayerView3D-12ed5c2a.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./SceneLayerView-3f962698.js","./TemporalSceneLayerView-6fe19ceb.js","./PopupSceneLayerView-08041ac5.js"],import.meta.url),stream:()=>ue(()=>import("./StreamLayerView3D-c8a6d976.js"),["./StreamLayerView3D-c8a6d976.js","./StreamFeatureManager-9aa9270f.js","./createConnection-e8c0a969.js","./query-dd3a3bae.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./EventedSet-c2bd6307.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./LayerView-7059f1fc.js"],import.meta.url),tile:rA,"imagery-tile":()=>ue(()=>import("./ImageryTileLayerView3D-cc85afb1.js"),["./ImageryTileLayerView3D-cc85afb1.js","./rasterProjectionHelper-617ba3fc.js","./LayerView3D-77681ce3.js","./TiledLayerView3D-77131e93.js","./timeSupport-88508996.js","./popupUtils-0412893d.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./drapedUtils-7f968a53.js"],import.meta.url),"vector-tile":()=>ue(()=>import("./VectorTileLayerView3D-c10dbfdd.js"),["./VectorTileLayerView3D-c10dbfdd.js","./Rect-98da58d6.js","./pbf-19f7cae1.js","./constants-991354c8.js","./vec4f32-0d1b2306.js","./StyleRepository-17f7ffbb.js","./LayerView3D-77681ce3.js","./TiledLayerView3D-77131e93.js","./LayerView-7059f1fc.js"],import.meta.url),wcs:()=>ue(()=>import("./ImageryTileLayerView3D-cc85afb1.js"),["./ImageryTileLayerView3D-cc85afb1.js","./rasterProjectionHelper-617ba3fc.js","./LayerView3D-77681ce3.js","./TiledLayerView3D-77131e93.js","./timeSupport-88508996.js","./popupUtils-0412893d.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./drapedUtils-7f968a53.js"],import.meta.url),"web-tile":rA,wfs:()=>ue(()=>import("./WFSLayerView3D-0838e85e.js"),["./WFSLayerView3D-0838e85e.js","./FeatureLayerViewBase3D-6304acf1.js","./Graphics3DGraphicsPipeline-af85b47f.js","./timeSupport-88508996.js","./projectExtentUtils-9d38f719.js","./dehydratedFeatureComparison-8bd8c536.js","./queryForSymbologySnapping-05ee48aa.js","./hash-6f442295.js","./diffUtils-0e3a2a24.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./Graphics3DObjectStates-d0fd362c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./QueryEngine-d004ff2d.js","./normalizeUtils-14f09049.js","./normalizeUtilsCommon-eecee6b6.js","./WhereClause-2da3dfba.js","./TimeOnly-1edcbdf2.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-fc6bc652.js","./utils-319bcf9e.js","./utils-78c11d9b.js","./ClassBreaksDefinition-077b81d9.js","./FeatureSet-285ce5c1.js","./FeatureStore-383f5c94.js","./BoundsStore-fd582c6d.js","./LayerView3D-77681ce3.js","./query-dd3a3bae.js","./pbfQueryUtils-335efe71.js","./pbf-19f7cae1.js","./queryZScale-2c7fab80.js","./WorkerHandle-becb41d0.js","./EventedSet-c2bd6307.js","./FeatureEffect-9c3784e1.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),wms:()=>ue(()=>import("./WMSLayerView3D-8322d389.js"),["./WMSLayerView3D-8322d389.js","./DynamicLayerView3D-bedc5568.js","./LayerView3D-77681ce3.js","./projectExtentUtils-9d38f719.js","./ImageMaterial-9da60cfc.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js","./ExportWMSImageParameters-010bef33.js","./timeSupport-88508996.js"],import.meta.url),wmts:()=>ue(()=>import("./WMTSLayerView3D-7b95896b.js"),["./WMTSLayerView3D-7b95896b.js","./LayerView3D-77681ce3.js","./TiledLayerView3D-77131e93.js","./fetchTile-5d655851.js","./RefreshableLayer-fb6b2fc5.js","./layerContainerType-e1118fe6.js","./LayerView-7059f1fc.js","./RefreshableLayerView-710745d7.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function KWe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new W(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const pse={hasLayerViewModule:t=>dse[t.type]!=null,importLayerView:t=>{const e=dse[t.type];if(e==null)throw KWe(t);return e(t)}},fse="analyses-owner-handles";var BS,xb;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(BS||(BS={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(xb||(xb={}));let J1=class extends Pe{constructor(e){super(e),this._allAnalysisViews=new lt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=mse(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(vi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(vi()),this._attachedToViewResolver=mse()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===xb.REMOVED)throw new W("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),fse)}_disconnectOwners(){this.removeHandles(fse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return Mi(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:BS.PENDING,list:xb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=Tm(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=xb.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=xb.REMOVED,this._scheduleUpdate()):le.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=XC(()=>this._update()))}_update(){this._scheduledUpdateHandle=gr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===xb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case BS.PENDING:e.createAnalysisViewTask=il(e.createAnalysisViewTask);break;case BS.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Oe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(qn(i))throw this._creatingViewCount-=1,vi("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(qn(i))throw this._creatingViewCount-=1,o.destroy(),vi("AnalysisView creation aborted");return e.view=o,e.state.view=BS.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ue(()=>import("./AreaMeasurementAnalysisView3D-006e99c4.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-006e99c4.js","./interfaces-003b411d.js","./TextOverlayItem-89673e2e.js","./unitFormatUtils-ad485d8a.js","./AnalysisView3D-a195aa2a.js","./euclideanAreaMeasurementUtils-a4acbcc5.js","./geometryEngine-e08263d2.js","./geometryEngineBase-1fd17bb5.js","./hydrated-109b30e2.js","./geodesicLengthMeasurementUtils-d6665296.js","./projectionUtils-32d32720.js","./EditGeometryOperations-c063f873.js","./geometry2dUtils-8e7f7801.js","./Segment-76a231fa.js","./LineVisualElement-f4ad12ae.js"],import.meta.url);case"dimension":return ue(()=>import("./DimensionAnalysisView3D-85747136.js"),["./DimensionAnalysisView3D-85747136.js","./AnalysisView3D-a195aa2a.js","./LengthDimension-7365d734.js","./TextOverlayItem-89673e2e.js","./unitFormatUtils-ad485d8a.js","./Segment-76a231fa.js","./LineVisualElement-f4ad12ae.js","./geodesicLengthMeasurementUtils-d6665296.js","./geometryEngine-e08263d2.js","./geometryEngineBase-1fd17bb5.js","./hydrated-109b30e2.js","./SnappingOperation-871f3371.js","./ExtendedLineVisualElement-7eb791da.js","./vec4f32-0d1b2306.js","./EngineVisualElement-051ec221.js","./LaserlineVisualElement-b63b1b55.js","./PointVisualElement-e6ea5696.js","./RightAngleQuadVisualElement-b8120525.js","./SnappingManagerPool-04d35fa6.js","./geometry2dUtils-8e7f7801.js","./FeatureFilter-9d3ae08e.js","./floorFilterUtils-73949d2d.js","./keybindings-7c7d5818.js","./PointSnappingHint-d297cb04.js","./InteractiveToolBase-926682ab.js","./EditGeometryOperations-c063f873.js","./dehydratedFeatureComparison-8bd8c536.js","./dragEventPipeline3D-82a26c1c.js","./ImageMaterial-9da60cfc.js","./memoize-3e55df82.js","./Factory-1daeea7b.js","./analysisViewUtils-c16d04a9.js","./ToolIntersector-8e196cfb.js","./projectionUtils-32d32720.js"],import.meta.url);case"direct-line-measurement":return ue(()=>import("./DirectLineMeasurementAnalysisView3D-10ff377a.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-10ff377a.js","./interfaces-003b411d.js","./TextOverlayItem-89673e2e.js","./unitFormatUtils-ad485d8a.js","./AnalysisView3D-a195aa2a.js","./projectionUtils-32d32720.js","./geodesicLengthMeasurementUtils-d6665296.js","./geometryEngine-e08263d2.js","./geometryEngineBase-1fd17bb5.js","./hydrated-109b30e2.js","./Segment-76a231fa.js","./LineVisualElement-f4ad12ae.js","./RightAngleQuadVisualElement-b8120525.js","./EngineVisualElement-051ec221.js"],import.meta.url);case"line-of-sight":return ue(()=>import("./LineOfSightAnalysisView3D-7eac9b86.js"),["./LineOfSightAnalysisView3D-7eac9b86.js","./AnalysisView3D-a195aa2a.js","./LineOfSightAnalysisTarget-c79fc22f.js","./persistable-32839550.js","./MD5-715f37cd.js","./resourceExtension-4c53d4ca.js","./projectionUtils-32d32720.js","./InteractiveToolBase-926682ab.js","./EditGeometryOperations-c063f873.js","./geometry2dUtils-8e7f7801.js","./manipulatorUtils-81dd7dcb.js","./LaserlineVisualElement-b63b1b55.js","./LineVisualElement-f4ad12ae.js","./analysisViewUtils-c16d04a9.js","./PointVisualElement-e6ea5696.js"],import.meta.url);case"slice":return ue(()=>import("./SliceAnalysisView3D-5a290f0b.js"),["./SliceAnalysisView3D-5a290f0b.js","./AnalysisView3D-a195aa2a.js","./ShiftManipulator-41a52e98.js","./sliceToolConfig-a3623b3c.js","./InteractiveToolBase-926682ab.js","./EditGeometryOperations-c063f873.js","./geometry2dUtils-8e7f7801.js","./ImageMaterial-9da60cfc.js","./persistable-32839550.js","./MD5-715f37cd.js","./resourceExtension-4c53d4ca.js","./projectionUtils-32d32720.js","./LineVisualElement-f4ad12ae.js","./BuildingComponentSublayer-d4e62531.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./diffUtils-0e3a2a24.js","./colorRamps-aa93f22c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./FeatureLayer-326b1176.js","./layerContainerType-e1118fe6.js","./FeatureLayerBase-d5ed4315.js","./commonProperties-97bbff58.js","./labelingInfo-6875761c.js","./featureQueryAll-8963e799.js","./RelationshipQuery-fd495a9f.js","./LayerFloorInfo-9ce38ca0.js","./Relationship-8c123d3c.js","./serviceCapabilitiesUtils-33da8a9b.js","./editsZScale-6832178a.js","./queryZScale-2c7fab80.js","./FeatureSet-285ce5c1.js","./APIKeyMixin-83f77fe3.js","./ArcGISService-d812484b.js","./CustomParametersMixin-8721f5b8.js","./EditBusLayer-0d63c689.js","./FeatureEffectLayer-bc968aef.js","./FeatureEffect-9c3784e1.js","./FeatureFilter-9d3ae08e.js","./FeatureReductionLayer-22d2a189.js","./FeatureReductionSelection-c427965c.js","./OperationalLayer-4cc379ff.js","./OrderedLayer-0c8aa1d7.js","./PortalLayer-995215c8.js","./RefreshableLayer-fb6b2fc5.js","./TemporalLayer-0399f521.js","./TimeInfo-448b5524.js","./FeatureTemplate-a8080318.js","./FeatureType-01c856b1.js","./fieldProperties-e0b01c7d.js","./versionUtils-dda94076.js","./styleUtils-f3879cce.js","./TopFeaturesQuery-ddd1e8da.js","./popupUtils-7d91b48e.js","./capabilities-c607cf72.js","./I3SIndexInfo-7c65c66d.js","./I3SLayerDefinitions-d7ed2162.js","./I3SUtil-919d76c6.js","./I3SBinaryReader-af544542.js","./popupUtils-0412893d.js","./Factory-1daeea7b.js","./dragEventPipeline3D-82a26c1c.js","./analysisViewUtils-c16d04a9.js","./ToolIntersector-8e196cfb.js"],import.meta.url);case"viewshed":return ue(()=>import("./ViewshedAnalysisView3D-d5cc303a.js"),["./ViewshedAnalysisView3D-d5cc303a.js","./AnalysisView3D-a195aa2a.js","./geometryEngine-e08263d2.js","./geometryEngineBase-1fd17bb5.js","./hydrated-109b30e2.js","./InteractiveToolBase-926682ab.js","./EditGeometryOperations-c063f873.js","./geometry2dUtils-8e7f7801.js","./dragEventPipeline3D-82a26c1c.js","./LineVisualElement-f4ad12ae.js","./sliceToolConfig-a3623b3c.js","./MoveManipulation-075ce04e.js","./ExtendedLineVisualElement-7eb791da.js","./vec4f32-0d1b2306.js","./EngineVisualElement-051ec221.js","./LaserlineVisualElement-b63b1b55.js","./analysisViewUtils-c16d04a9.js","./keybindings-7c7d5818.js","./ToolIntersector-8e196cfb.js"],import.meta.url)}}};function mse(){const t=Pn();return t.promise.catch(()=>{}),t}d([m()],J1.prototype,"updating",null),d([m({constructOnly:!0})],J1.prototype,"view",void 0),d([m()],J1.prototype,"_allAnalysisViews",void 0),d([m()],J1.prototype,"_creatingViewCount",void 0),J1=d([U("esri.views.3d.analysis.AnalysisViewManager3D")],J1);const eYe=J1;let yg=class extends Pe{constructor(e){super(e),this.collision=new FM,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ne.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ne.Local?this._set("altitude",e):le.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Te(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Te(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ne.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=UB)=>(r.min=qo.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?YD([[4e3,qo.max],[1e4,xt(88)],[6e6,xt(88)]]):()=>qo.max;return(i,r=UB)=>(r.min=qo.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?YD([[4e3,qo.max],[5e4,xt(88)],[6e6,xt(88)],[2e7,qo.min]]):YD([[3e5,qo.max],[3e6,xt(88)],[6e6,xt(88)],[2e7,qo.min]]);return(i,r=UB)=>(r.min=qo.min,r.max=e(i),r)}};function tYe(t){return{min:-2e5,max:4*t.radius}}d([m()],yg.prototype,"altitude",null),d([m({readOnly:!0})],yg.prototype,"collision",void 0),d([m()],yg.prototype,"distance",void 0),d([m({readOnly:!0})],yg.prototype,"minimumPoiDistance",void 0),d([m()],yg.prototype,"tilt",void 0),d([m({constructOnly:!0})],yg.prototype,"mode",void 0),yg=d([U("esri.views.3d.state.Constraints")],yg);const gse=tYe(ji),qo={min:xt(.5),max:xt(179.5)},UB={min:0,max:0};let FM=class extends Pe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],FM.prototype,"enabled",void 0),d([m({type:Number})],FM.prototype,"elevationMargin",void 0),FM=d([U("esri.views.3d.state.Constraints.CollisionConstraint")],FM);let VS=class extends q_{constructor(){super(...arguments),this.min=gse.min,this.max=gse.max}};d([m({type:Number})],VS.prototype,"min",void 0),d([m({type:Number})],VS.prototype,"max",void 0),VS=d([U("esri.views.3d.constraints.AltitudeConstraint")],VS);let Pg=class extends q_{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};d([m({type:Number,value:1e-8})],Pg.prototype,"near",null),d([cr("near")],Pg.prototype,"castNear",null),d([m({type:Number,value:1e-8})],Pg.prototype,"far",null),d([cr("far")],Pg.prototype,"castFar",null),d([m({type:["auto","manual"]})],Pg.prototype,"mode",void 0),Pg=d([U("esri.views.3d.constraints.ClipDistanceConstraint")],Pg);const S9={min:ea(qo.min),max:ea(qo.max)};let Tb=class extends q_{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Te(e,S9.min,S9.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],Tb.prototype,"mode",void 0),d([m({type:Number,value:S9.max})],Tb.prototype,"max",null),d([cr("max")],Tb.prototype,"castMax",null),Tb=d([U("esri.views.3d.constraints.TiltConstraint")],Tb);let Sb=class extends q_{constructor(){super(...arguments),this.tilt=new Tb,this.altitude=new VS,this.clipDistance=new Pg}};d([m({type:Tb})],Sb.prototype,"tilt",void 0),d([m({type:VS})],Sb.prototype,"altitude",void 0),d([m({type:Pg})],Sb.prototype,"clipDistance",void 0),Sb=d([U("esri.views.3d.constraints.Constraints")],Sb);var uS;let jy=uS=class extends Ls.EventedMixin(Fw){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new uS(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=uS.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=uS.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(Z3.target=this,Z3.timezoneOffset=s,this.emit("timezone-will-change",Z3),Z3.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new uS({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],jy.prototype,"cameraTrackingEnabled",void 0),d([m({type:Date})],jy.prototype,"defaultDate",null),d([m({type:Date})],jy.prototype,"date",null),jy=uS=d([U("esri.views.3d.environment.SunLighting")],jy),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(jy||(jy={}));const Z3={target:null,timezoneOffset:0},Q1=jy;var aN;let lN=aN=class extends Ls.EventedMixin(r$){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new aN({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new aN(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],lN.prototype,"cameraTrackingEnabled",void 0),lN=aN=d([U("esri.views.3d.environment.VirtualLighting")],lN);const kM=lN,iYe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Q1,virtual:kM}};var C9;let QP=C9=class extends Pe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new C9({quality:this.quality})}};d([m({type:["low","high"],value:"low"})],QP.prototype,"quality",null),QP=C9=d([U("esri.views.3d.environment.SceneViewAtmosphere")],QP);var UM;let hS=UM=class extends uC{constructor(t){super(t),this.atmosphere=new QP,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new UM({...e,lighting:e.lighting?e.lighting.type==="virtual"?kM.fromWebsceneLighting(e.lighting):Q1.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(ipe(e)),e}_convertLighting(t){return t?t instanceof Q1||t instanceof kM?t:t instanceof Fw?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Q1({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof r$?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new kM({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):lm(iYe,t):new Q1}clone(){return new UM({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ge(this.background)})}cloneWithWebsceneEnvironment(t){return new UM({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ge(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Q1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):kM.fromWebsceneLighting(t.lighting);default:return t.lighting,Q1.fromWebsceneLighting(t.lighting)}}};d([m({type:QP,json:{read:!1},nonNullable:!0})],hS.prototype,"atmosphere",void 0),d([m({nonNullable:!0})],hS.prototype,"lighting",void 0),d([cr("lighting")],hS.prototype,"castLighting",null),hS=UM=d([U("esri.views.3d.environment.SceneViewEnvironment")],hS);const dS=hS;function rYe(t,e){return{type:Ew(e),value:t,unit:e}}function LIt(t){return{value:t}}function Zg(t,e){return{type:Ew(e),value:t,unit:e}}function sYe(t,e){return{type:Ew(e),value:t,unit:e}}function NU(t,e,i="arithmetic"){return{type:Ew(e),value:t,unit:e,rotationType:i}}function nYe(t,e){const i=oYe(t,e);return t.type==="angle"?NU(i,e,t.rotationType):rYe(i,e)}function oYe(t,e){return Cn(t.value,t.unit,e)}function DIt(t,e){return t==null?e:e==null||t.value>Cn(e.value,e.unit,t.unit)?t:e}function NIt(t,e){return t==null?null:{...t,value:t.value*e}}function FIt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const kIt=Zg(0,"meters"),UIt=sYe(0,"square-meters");NU(0,"radians");const zIt=NU(0,"degrees"),BIt=NU(0,"degrees","geographic");var ha;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(ha||(ha={}));function swe(t){return"r"in t&&"g"in t&&"b"in t}function nwe(t){return"h"in t&&"s"in t&&"v"in t}function owe(t){return"l"in t&&"a"in t&&"b"in t}function awe(t){return"l"in t&&"c"in t&&"h"in t}function aYe(t){return"x"in t&&"y"in t&&"z"in t}const lYe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],cYe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function lwe(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function cwe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=lwe(lYe,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function FZ(t){const e=lwe(cYe,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function uwe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function hwe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function uYe(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function hYe(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function dYe(t){return uwe(cwe(t))}function pYe(t){return FZ(hwe(t))}function fYe(t){return uYe(uwe(cwe(t)))}function mYe(t){return FZ(hwe(hYe(t)))}function gYe(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function yYe(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function v$(t){return swe(t)?t:awe(t)?mYe(t):owe(t)?pYe(t):aYe(t)?FZ(t):nwe(t)?yYe(t):t}function _Ye(t){return nwe(t)?t:gYe(v$(t))}function vYe(t){return owe(t)?t:dYe(v$(t))}function VIt(t){return awe(t)?t:fYe(v$(t))}function bYe(t){let{r:e,g:i,b:r,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s))),new et({r:e,g:i,b:r})}function wYe(t,e){const{r:i,g:r,b:s}=e?.ignoreAlpha?t:bYe(t);return .2126*i+.7152*r+.0722*s}var E9;function GIt(t,e=E9.High){return wYe(t,{ignoreAlpha:!0})>e?new et([0,0,0,t.a]):new et([255,255,255,t.a])}function jIt(t,e){const i=vYe(t);i.l*=1-e;const r=v$(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function HIt(t,e){const i=t.clone();return i.a*=e,i}function qIt(t,e){const i=_Ye(t);i.s*=e;const r=v$(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function cR(t){return et.toUnitRGBA(t)}function WIt(t,e){return t===e||t!=null&&e!=null&&Uw(t,e)}function YIt(t){return kt(t[0],t[1],t[2],t.length>3?t[3]:1)}function XIt(t,e){const i=et.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(E9||(E9={}));function kZ(t){return Te((t-1e5)/(1e6-1e5),0,1)}const A9=1e4,xYe=.085,o_=1e5;let TYe=class{};const xr=TYe;function x(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(x||(x={}));var O;function SYe(t){return t===O.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(O||(O={}));var Qr;function Yd(t,e){switch(e.textureCoordinateType){case Qr.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Qr.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(x`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Qr.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Qr.None:return void t.vertex.code.add(x`void forwardTextureCoordinates() {}`);case Qr.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Qr||(Qr={}));function Ep(t){t.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}var Di;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Di||(Di={}));let Ss=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[Di.Pass]:null,[Di.Draw]:null},s)switch(r){case Di.Pass:this.bind[Di.Pass]=s;break;case Di.Draw:this.bind[Di.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Ar=class extends Ss{constructor(e,i){super(e,"vec2",Di.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function UZ(t){t.include(Ep),t.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function Cm(t){t.uniforms.add(new Ar("zProjectionMap",(e,i)=>CYe(i.camera))),t.code.add(x`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(x`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(x`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function CYe(t){const e=t.projectionMatrix;return bi(EYe,e[14],e[10])}const EYe=it();function FU(t){t.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}let Rt=class extends Ss{constructor(e,i){super(e,"vec3",Di.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}};function I0(t){t.uniforms.add(new Rt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Em(t){t.uniforms.add(new Rt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function I4(t){I0(t.fragment),Em(t.fragment),t.fragment.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Ei=class extends Ss{constructor(e,i){super(e,"vec4",Di.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},Ue=class extends Ss{constructor(e,i){super(e,"float",Di.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},Gr=class extends Ss{constructor(e,i){super(e,"mat4",Di.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const Ia=Yt();let AYe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function at(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new AYe(`${e} at ${i}`)}}function Bx(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function dwe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function J3(t,e,i,r,s,n=it()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function yse(t,e,i,r,s){Ia[0]=t[0],Ia[1]=t[1],Ia[2]=t[2],Ia[3]=1,Cc(Ia,Ia,e),s.length>2&&(s[2]=-Ia[2]),Cc(Ia,Ia,i),at(Ia[3]!==0),s[0]=Ia[0]/Ia[3],s[1]=Ia[1]/Ia[3],s[2]=Ia[2]/Ia[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function MYe(t,e){return Math.log(t)/Math.log(e)}function PYe(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function pwe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const OYe=()=>le.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let fwe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Pi=class extends fwe{constructor(){super(...arguments),this.vertex=new _se,this.fragment=new _se,this.attributes=new IYe,this.varyings=new LYe,this.extensions=new M9,this.constants=new mwe,this.outputs=new O9}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?NYe:DYe,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Di.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Di.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Di.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Di.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,n,o,a)}}},RYe=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new W(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else OYe().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},$Ye=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},_se=class extends fwe{constructor(){super(...arguments),this.uniforms=new RYe(this),this.code=new $Ye(this),this.constants=new mwe}get builder(){return this}},IYe=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},LYe=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&at(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},M9=class P9{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?P9.ALLOWLIST_VERTEX:P9.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};M9.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],M9.ALLOWLIST_VERTEX=[];let O9=class R9{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?at(s.name===e&&s.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:R9.DEFAULT_NAME,type:R9.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};O9.DEFAULT_TYPE="vec4",O9.DEFAULT_NAME="fragColor";let mwe=class gn{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=gn._numberToFloatStr(r);break;case"int":s=gn._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${gn._numberToFloatStr(r[0])},                            ${gn._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${gn._numberToFloatStr(r[0])},                            ${gn._numberToFloatStr(r[1])},                            ${gn._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${gn._numberToFloatStr(r[0])},                            ${gn._numberToFloatStr(r[1])},                            ${gn._numberToFloatStr(r[2])},                            ${gn._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${gn._numberToIntStr(r[0])},                             ${gn._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${gn._numberToIntStr(r[0])},                             ${gn._numberToIntStr(r[1])},                             ${gn._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${gn._numberToIntStr(r[0])},                             ${gn._numberToIntStr(r[1])},                             ${gn._numberToIntStr(r[2])},                             ${gn._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>gn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const DYe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,NYe=`precision highp float;
precision highp sampler2D;`;let ct=class extends Ss{constructor(e,i){super(e,"sampler2D",Di.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};const KP=Ce(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),zB=3,BB=Ce(zB*parseFloat(65e-8.toFixed(6)),zB*parseFloat(1881e-9.toFixed(6)),zB*parseFloat(85e-9.toFixed(6))),FYe=3996e-9,kYe=Ce(parseFloat(Number(KP[0]+BB[0]).toFixed(6)),parseFloat(Number(KP[1]+BB[1]).toFixed(6)),parseFloat(Number(KP[2]+BB[2]).toFixed(6)));function UYe(t){const e=new Pi;e.attributes.add(O.POSITION,"vec2"),e.include(Yd,{textureCoordinateType:Qr.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new Gr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Gr("inverseViewMatrix",(s,n)=>vv(zYe,n.camera.viewMatrix))),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Rt("backgroundColor",s=>s.backgroundColor),new Ar("radii",s=>s.radii),new Rt("cameraPosition",(s,n)=>n.camera.eye),new Ei("heightParameters",s=>s.heightParameters),new Ue("innerFadeDistance",s=>s.innerFadeDistance),new Ue("altitudeFade",s=>s.altitudeFade),new ct("depthTexture",s=>s.depthTexture),new Ue("hazeStrength",s=>s.hazeStrength)),r.constants.add("betaRayleigh","vec3",KP),r.constants.add("betaCombined","vec3",kYe),r.constants.add("betaMie","float",FYe),r.constants.add("scaleHeight","float",xYe*o_),I0(r),e.include(FU),t.haze&&r.include(Cm),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":x`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":x`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?x`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?x`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?x`cameraSpaceRay *= -textureBilinear(vuv0);`:x`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:x`${t.reduced?"":x`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:x`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":x`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const zYe=xe(),BYe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:KP,build:UYe},Symbol.toStringTag,{value:"Module"}));let Oi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Sr,ui,Ee,y0,vt,Xd,AC,dt,tr,es,Zt,hi,vs,Pt,ut,Pa,Wo,Hi,du,fa;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Sr||(Sr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ui||(ui={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ee||(Ee={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(y0||(y0={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(vt||(vt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Xd||(Xd={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(AC||(AC={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(dt||(dt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(tr||(tr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(es||(es={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Zt||(Zt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(hi||(hi={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(vs||(vs={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Pt||(Pt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(ut||(ut={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Pa||(Pa={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Wo||(Wo={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Hi||(Hi={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(du||(du={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(fa||(fa={}));const VB=33984;var Vs,En,zn;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(Vs||(Vs={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(En||(En={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(zn||(zn={}));const MC=33306;var Ps,vse,bse,wse,L4,$9,xse;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Ps||(Ps={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(vse||(vse={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(bse||(bse={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(wse||(wse={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(L4||(L4={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}($9||($9={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(xse||(xse={}));let Ni=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=Tt(this._program),this._pipeline=this._configuration=null}reload(e){Tt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return ui.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const di=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.UV0,2],[O.COLOR,3],[O.COLORFEATUREATTRIBUTE,3],[O.SIZE,4],[O.TANGENT,4],[O.CENTEROFFSETANDDISTANCE,5],[O.SYMBOLCOLOR,5],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.INSTANCEOBJECTANDLAYERIDCOLOR,7],[O.INSTANCEMODEL,8],[O.INSTANCEMODELNORMAL,12],[O.INSTANCEMODELORIGINHI,11],[O.INSTANCEMODELORIGINLO,15]]),VYe=()=>le.getLogger("esri.views.webgl.checkWebGLError");function GYe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const D4=!!se("enable-feature:webgl-debug");function Md(){return D4}function I9(){return D4}function Lf(t){if(Md()){const e=t.getError();if(e){const i=GYe(t,e),r=new Error().stack;VYe().error(new W("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let Fi=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Gt({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=Md()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i?.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms?.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Er,Gw,Vi,av,Nl,_0,mr,Ka,Jg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Er||(Er={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(Gw||(Gw={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Vi||(Vi={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(av||(av={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Nl||(Nl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(_0||(_0={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(mr||(mr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Ka||(Ka={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(Jg||(Jg={}));function Ru(t,e,i=y0.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Fo(t,e,i,r,s=y0.ADD,n=y0.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const zZ={face:Xd.BACK,mode:AC.CCW},gwe={face:Xd.FRONT,mode:AC.CCW},kU=t=>t===Er.Back?zZ:t===Er.Front?gwe:null,Oc={zNear:0,zFar:1},qt={r:!0,g:!0,b:!0,a:!0};function jYe(t){return KYe.intern(t)}function HYe(t){return eXe.intern(t)}function qYe(t){return tXe.intern(t)}function WYe(t){return iXe.intern(t)}function YYe(t){return rXe.intern(t)}function XYe(t){return sXe.intern(t)}function ZYe(t){return nXe.intern(t)}function JYe(t){return oXe.intern(t)}function QYe(t){return aXe.intern(t)}function Lt(t){return lXe.intern(t)}let Am=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Mm(t){return"["+t.join(",")+"]"}const KYe=new Am(ywe,t=>({__tag:"Blending",...t}));function ywe(t){return t?Mm([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const eXe=new Am(_we,t=>({__tag:"Culling",...t}));function _we(t){return t?Mm([t.face,t.mode]):null}const tXe=new Am(vwe,t=>({__tag:"PolygonOffset",...t}));function vwe(t){return t?Mm([t.factor,t.units]):null}const iXe=new Am(bwe,t=>({__tag:"DepthTest",...t}));function bwe(t){return t?Mm([t.func]):null}const rXe=new Am(wwe,t=>({__tag:"StencilTest",...t}));function wwe(t){return t?Mm([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const sXe=new Am(xwe,t=>({__tag:"DepthWrite",...t}));function xwe(t){return t?Mm([t.zNear,t.zFar]):null}const nXe=new Am(Twe,t=>({__tag:"ColorWrite",...t}));function Twe(t){return t?Mm([t.r,t.g,t.b,t.a]):null}const oXe=new Am(Swe,t=>({__tag:"StencilWrite",...t}));function Swe(t){return t?Mm([t.mask]):null}const aXe=new Am(Cwe,t=>({__tag:"DrawBuffers",...t}));function Cwe(t){return t?Mm(t.buffers):null}const lXe=new Am(cXe,t=>({blending:jYe(t.blending),culling:HYe(t.culling),polygonOffset:qYe(t.polygonOffset),depthTest:WYe(t.depthTest),stencilTest:YYe(t.stencilTest),depthWrite:XYe(t.depthWrite),colorWrite:ZYe(t.colorWrite),stencilWrite:JYe(t.stencilWrite),drawBuffers:QYe(t.drawBuffers)}));function cXe(t){return t?Mm([ywe(t.blending),_we(t.culling),vwe(t.polygonOffset),bwe(t.depthTest),wwe(t.stencilTest),xwe(t.depthWrite),Twe(t.colorWrite),Swe(t.stencilWrite),Cwe(t.drawBuffers)]):null}let uXe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},hXe=class extends xr{constructor(){super(...arguments),this.heightParameters=Yt(),this.radii=it(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=it(),this.backgroundColor=C()}},zM=class Ewe extends Ni{initializeProgram(e){return new Fi(e.rctx,Ewe.shader.get().build(this.configuration),di)}initializePipeline(){return this.configuration.reduced?Lt({blending:Ru(Ee.ONE,Ee.ZERO),depthTest:{func:tr.ALWAYS},colorWrite:qt}):this.configuration.haze?Lt({blending:Fo(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),colorWrite:qt}):Lt({blending:Ru(Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:tr.LEQUAL},colorWrite:qt})}};zM.shader=new Oi(BYe,()=>ue(()=>import("./ChapmanAtmosphere.glsl-3168ed63.js"),[],import.meta.url));let ol=class extends xr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function B(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let Awe=class extends ol{constructor(){super(...arguments),this.haze=!1}};d([B()],Awe.prototype,"haze",void 0);let Mwe=class extends Awe{constructor(){super(...arguments),this.reduced=!1}};d([B()],Mwe.prototype,"reduced",void 0);var kr,co;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(kr||(kr={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(co||(co={}));let vp=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new vp(O.POSITION,3,dt.FLOAT,0,12);const BZ=[new vp(O.POSITION,2,dt.FLOAT,0,8)],b$=[new vp(O.POSITION,2,dt.FLOAT,0,16),new vp(O.UV0,2,dt.FLOAT,8,16)];function dXe(t){switch(t){case dt.BYTE:case dt.UNSIGNED_BYTE:return 1;case dt.SHORT:case dt.UNSIGNED_SHORT:case dt.HALF_FLOAT:return 2;case dt.FLOAT:case dt.INT:case dt.UNSIGNED_INT:return 4}}function Pwe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Qg(t,e){return t.vertexBuffers[e].usedMemory/pXe(t.layout[e])}function pXe(t){return t[0].stride}function VZ(t,e,i,r,s=0){const n=t.gl;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(a===void 0){console.warn(`There is no location for vertex attribute '${o.name}' defined.`);continue}const l=s*o.stride;if(o.count<=4)n.vertexAttribPointer(a,o.count,o.type,o.normalized,o.stride,o.offset+l),n.enableVertexAttribArray(a),o.divisor>0&&t.gl.vertexAttribDivisor(a,o.divisor);else if(o.count===9)for(let c=0;c<3;c++)n.vertexAttribPointer(a+c,3,o.type,o.normalized,o.stride,o.offset+12*c+l),n.enableVertexAttribArray(a+c),o.divisor>0&&t.gl.vertexAttribDivisor(a+c,o.divisor);else if(o.count===16)for(let c=0;c<4;c++)n.vertexAttribPointer(a+c,4,o.type,o.normalized,o.stride,o.offset+16*c+l),n.enableVertexAttribArray(a+c),o.divisor>0&&t.gl?.vertexAttribDivisor(a+c,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count);if(Md()){const c=Pwe(t),u=dXe(o.type),h=o.offset,p=Math.round(u/h)!==u/h?`. Offset not a multiple of stride. DataType requires ${u} bytes, but descriptor has an offset of ${h}`:"";c&&console.error(`Unable to bind vertex attribute "${o.name}" with baseInstanceOffset ${l}${p}:`,c,o)}}}function Owe(t,e,i,r){const s=t.gl;t.bindBuffer(i);for(const n of r){const o=e.get(n.name);if(n.count<=4)s.disableVertexAttribArray(o),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o,0);else if(n.count===9)for(let a=0;a<3;a++)s.disableVertexAttribArray(o+a),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o+a,0);else if(n.count===16)for(let a=0;a<4;a++)s.disableVertexAttribArray(o+a),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o+a,0);else console.error("Unsupported vertex attribute element count: "+n.count)}t.unbindBuffer(vt.ARRAY_BUFFER)}function GZ(t){switch(t){case Pt.ALPHA:case Pt.LUMINANCE:case Pt.RED:case Pt.RED_INTEGER:case ut.R8:case ut.R8I:case ut.R8UI:case ut.R8_SNORM:case Wo.STENCIL_INDEX8:return 1;case Pt.LUMINANCE_ALPHA:case Pt.RG:case Pt.RG_INTEGER:case ut.RGBA4:case ut.R16F:case ut.R16I:case ut.R16UI:case ut.RG8:case ut.RG8I:case ut.RG8UI:case ut.RG8_SNORM:case ut.RGB565:case ut.RGB5_A1:case Wo.DEPTH_COMPONENT16:return 2;case Pt.DEPTH_COMPONENT:case Pt.RGB:case Pt.RGB_INTEGER:case ut.RGB8:case ut.RGB8I:case ut.RGB8UI:case ut.RGB8_SNORM:case ut.SRGB8:case Wo.DEPTH_COMPONENT24:return 3;case Pt.DEPTH_STENCIL:case Pt.DEPTH24_STENCIL8:case Pt.RGBA:case Pt.RGBA_INTEGER:case ut.RGBA8:case ut.R32F:case ut.R11F_G11F_B10F:case ut.RG16F:case ut.R32I:case ut.R32UI:case ut.RG16I:case ut.RG16UI:case ut.RGBA8I:case ut.RGBA8UI:case ut.RGBA8_SNORM:case ut.SRGB8_ALPHA8:case ut.RGB9_E5:case ut.RGB10_A2UI:case ut.RGB10_A2:case Wo.DEPTH_STENCIL:case Wo.DEPTH_COMPONENT32F:case Wo.DEPTH24_STENCIL8:return 4;case Wo.DEPTH32F_STENCIL8:return 5;case ut.RGB16F:case ut.RGB16I:case ut.RGB16UI:return 6;case ut.RG32F:case ut.RG32I:case ut.RG32UI:case ut.RGBA16F:case ut.RGBA16I:case ut.RGBA16UI:return 8;case ut.RGB32F:case ut.RGB32I:case ut.RGB32UI:return 12;case ut.RGBA32F:case ut.RGBA32I:case ut.RGBA32UI:return 16;case Ps.COMPRESSED_RGB_S3TC_DXT1_EXT:case Ps.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Ps.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Ps.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Ps.COMPRESSED_R11_EAC:case Ps.COMPRESSED_SIGNED_R11_EAC:case Ps.COMPRESSED_RGB8_ETC2:case Ps.COMPRESSED_SRGB8_ETC2:case Ps.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Ps.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Ps.COMPRESSED_RG11_EAC:case Ps.COMPRESSED_SIGNED_RG11_EAC:case Ps.COMPRESSED_RGBA8_ETC2_EAC:case Ps.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const Q3=()=>le.getLogger("esri.views.webgl.VertexArrayObject");let bp=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*jde}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=Tt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Q3().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Vs.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Vs.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||Q3().error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Q3().error("Vertex buffer is uninitialized!");const a=i[n];a||Q3().error("Vertex element descriptor is empty!"),VZ(this._context,this._locations,o,a)}r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},Pm=class extends bp{};const Tse=()=>le.getLogger("esri.views.webgl.BufferObject");let lr=class K1{static createIndex(e,i,r){return new K1(e,vt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new K1(e,vt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new K1(e,vt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=Hi.STREAM_READ,r){const s=new K1(e,vt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=Hi.STREAM_DRAW,r){return new K1(e,vt.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=Hi.STATIC_DRAW,r){const s=new K1(e,vt.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Vs.BufferObject,this),this._glName=this._context.gl.createBuffer(),Lf(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===vt.ELEMENT_ARRAY_BUFFER?this._indexType===dt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===vt.ELEMENT_ARRAY_BUFFER||this.bufferType===vt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Vs.BufferObject,this),this._context=null):this._glName&&Tse().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===vt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case dt.UNSIGNED_SHORT:e*=2;break;case dt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===vt.ELEMENT_ARRAY_BUFFER&&(Q5(e)&&(i/=2,this._indexType=dt.UNSIGNED_SHORT),WW(e)&&(i/=4,this._indexType=dt.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),Lf(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),Lf(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=fXe(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&Tse().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===vt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,vt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(vt.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(vt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,vt.COPY_READ_BUFFER),o.getBufferSubData(vt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(vt.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function fXe(t){return DRe(t)}var v0;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(v0||(v0={}));let $r=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=vs.TEXTURE_2D,this.pixelFormat=Pt.RGBA,this.dataType=Pa.UNSIGNED_BYTE,this.samplingMode=Zt.LINEAR,this.wrapMode=hi.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function mXe(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:GZ(t.internalFormat)))}let gXe=class Rwe extends $r{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case ut.R16F:case ut.R16I:case ut.R16UI:case ut.R32F:case ut.R32I:case ut.R32UI:case ut.R8_SNORM:case ut.R8:case ut.R8I:case ut.R8UI:this.pixelFormat=Pt.RED}}static validate(e,i){return new Rwe(e,i)}};const Sse=4;let ur=class eh{constructor(e,i=null,r=null){if(this.type=v0.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=gXe.validate(e,i);if(!s)throw new W("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===vs.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return mXe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(Vs.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new W("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===vs.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=vs.TEXTURE_CUBE_MAP_POSITIVE_X;i<=vs.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._descriptor.context?.gl)return;const r=this._descriptor.context.gl;Lf(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(Vs.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=sA(n);e===null&&(s.width=s.width||Sse,s.height=s.height||Sse,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,eh.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(eh.TEXTURE_UNIT_FOR_UPDATES),K3(s),this._configurePixelStorage(),Lf(r);const l=this._deriveInternalFormat();if(Ase(e)){let c="width"in e?e.width:e.codedWidth,u="height"in e?e.height:e.codedHeight;const h=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,u=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,u,h),this._texImage(n,0,l,c,u,h,e),Lf(r),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=u),o&&!s.depth&&(s.depth=h)}else{const{width:c,height:u,depth:h}=s;if(c==null||u==null)throw new W("Width and height must be specified!");if(o&&h==null)throw new W("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,u,h),cN(e)){const p=e.levels,f=Mse(n,c,u,h),g=Math.min(f-1,p.length-1);r.texParameteri(s.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,g);const _=l;if(!vXe(_))throw new W("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,b,w,T)=>{const S=p[Math.min(v,p.length-1)];this._compressedTexImage(n,v,_,b,w,T,S)},g)}else this._texImage(n,0,l,c,u,h,e),Lf(r),s.hasMipmap&&this.generateMipmap()}Cse(r,this._descriptor),Ese(r,this._descriptor),yXe(this._descriptor.context,this._descriptor),Lf(r),this._descriptor.context.bindTexture(a,eh.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:h,dataType:p,target:f,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new W("Cannot update immutable texture before allocation!");const _=u.bindTexture(this,eh.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),Ase(o)?v.texSubImage2D(f,e,i,r,s,n,h,p,o):cN(o)?v.compressedTexSubImage2D(f,e,i,r,s,n,c,o.levels[e]):v.texSubImage2D(f,e,i,r,s,n,h,p,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(_,eh.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:f,isImmutable:g,target:_}=c;if(g&&!this._wasImmutablyAllocated)throw new W("Cannot update immutable texture before allocation!");sA(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,eh.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(eh.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=h;if(cN(l))l=l.levels[e],b.compressedTexSubImage3D(_,e,i,r,s,n,o,a,u,l);else{const w=l;b.texSubImage3D(_,e,i,r,s,n,o,a,p,f,w)}h.bindTexture(v,eh.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new W("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,K3(e)}e.samplingMode===Zt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Zt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Zt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Zt.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,eh.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(eh.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,eh.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new W("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,K3(e)}e.samplingMode===Zt.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=Zt.LINEAR):e.samplingMode===Zt.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Zt.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,K3(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,i=e.context.gl;this._samplingModeDirty&&(Cse(i,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(Ese(i,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Pt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Pt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Pa.FLOAT:switch(this._descriptor.pixelFormat){case Pt.RGBA:return this._descriptor.internalFormat=ut.RGBA32F;case Pt.RGB:return this._descriptor.internalFormat=ut.RGB32F;default:throw new W("Unable to derive format")}case Pa.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Pt.RGBA:return this._descriptor.internalFormat=ut.RGBA8;case Pt.RGB:return this._descriptor.internalFormat=ut.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Pt.DEPTH_STENCIL?Pt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!_Xe(i))throw new W("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Mse(e,s,n,o):1;if(sA(e)){if(o==null)throw new W("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=sA(e),{isImmutable:u,pixelFormat:h,dataType:p}=this._descriptor;if(u){if(a!=null){const f=a;if(c){if(o==null)throw new W("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,h,p,f)}else l.texSubImage2D(e,i,0,0,s,n,h,p,f)}}else{const f=a;if(c){if(o==null)throw new W("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,h,p,f)}else l.texImage2D(e,i,r,s,n,0,h,p,f)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=sA(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new W("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new W("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===vs.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new W("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function K3(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function Cse(t,e){let i=e.samplingMode,r=e.samplingMode;i===Zt.LINEAR_MIPMAP_NEAREST||i===Zt.LINEAR_MIPMAP_LINEAR?(i=Zt.LINEAR,e.hasMipmap||(r=Zt.LINEAR)):i!==Zt.NEAREST_MIPMAP_NEAREST&&i!==Zt.NEAREST_MIPMAP_LINEAR||(i=Zt.NEAREST,e.hasMipmap||(r=Zt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function Ese(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function yXe(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function _Xe(t){return t in ut}function vXe(t){return t in Ps}function cN(t){return t!=null&&"type"in t&&t.type==="compressed"}function bXe(t){return t!=null&&"byteLength"in t}function Ase(t){return t!=null&&!cN(t)&&!bXe(t)}function sA(t){return t===vs.TEXTURE_3D||t===vs.TEXTURE_2D_ARRAY}function Mse(t,e,i,r=1){let s=Math.max(e,i);return t===vs.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}ur.TEXTURE_UNIT_FOR_UPDATES=0;function Om(t,e=BZ,i=di,r=-1,s=1){let n=null;return e===b$?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Pm(t,i,{geometry:e},{geometry:lr.createVertex(t,Hi.STATIC_DRAW,n)})}const wXe=4;function $we(t){const e=new $r(wXe);return e.samplingMode=Zt.NEAREST,new ur(t,e)}const N4=16;function N_(t){return Math.ceil(t/N4)*N4}function Iwe(t){return Math.floor(t/N4)*N4}function xXe(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?Lwe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return jZ(t,o,a)}function TXe(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return jZ(t,Math.round(t.width*r),Math.round(t.height*r))}function jZ(t,e,i){if(t instanceof ImageData)return jZ(Lwe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function Lwe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new W("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function ra(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let Dwe=class extends xr{};function SXe(t){const e=new Pi;e.include(ra),e.fragment.uniforms.add(new ct("colorTexture",r=>r.color),new ct("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(x`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${i?x`== 1.0`:x`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const CXe=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Dwe,build:SXe},Symbol.toStringTag,{value:"Module"}));let L9=class Nwe extends Ni{initializeProgram(e){return new Fi(e.rctx,Nwe.shader.get().build(this.configuration),di)}initializePipeline(){return this.configuration.haze?Lt({blending:Fo(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),depthTest:{func:tr.ALWAYS},colorWrite:qt}):Lt({blending:Ru(Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:tr.ALWAYS},colorWrite:qt})}};L9.shader=new Oi(CXe,()=>ue(()=>import("./AtmosphereCompositing.glsl-33a9c406.js"),[],import.meta.url));let EXe=class{constructor(e,i){this._view=e,this._context=i,this.type=ha.Realistic,this._handles=new _m,this._compositingPassParameters=new Dwe,this._passParameters=new hXe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ji.radius,this._fadeHaze=0,this._updateRadius(ji.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([he(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),he(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),he(()=>this._view?.environment.background,n=>{const o=n instanceof l_e?cR(n.color):Cu;te(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},qi)]);const s=new Mwe;s.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(zM,s),this._compositingTechnique=this._context.techniques.acquire(L9,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(zM,s),this._compositingHazeTechnique=this._context.techniques.acquire(L9,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(zM,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(zM,s),this._vao=Om(r,b$)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,r,!0)}_render(e,i,r,s){const n=e.bindParameters.mainDepth;if(!n)return;this._update(e.bindParameters.camera),this._passParameters.depthTexture=n;const o=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters),a=e.offscreenRenderingHelper;if(r)a.renderDepthDetached(()=>this._renderCommon(o,e));else{const l=e.rctx.getViewport(),c=Se(e.bindParameters.camera.eye)-ji.radius;let u;if(c<o_){const _=Math.min(1,Math.max(0,c/o_));u=s?Et(.4,.5,_):Et(.2,.3,_)}else{const _=Math.min(1,Math.max(0,(c-o_)/(15*o_)));u=s?Et(.5,1,_):Et(.3,.6,_)}const h=N_(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=N_(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,h,p);const f=a.renderToCachedFBO(null,s?"chapman haze":"chapman",()=>this._renderCommon(o,e),[0,0,0,1],kr.RGBA,null,h,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=f.getTexture(),this._compositingPassParameters.depth=n;const g=s?this._compositingHazeTechnique:this._compositingTechnique;e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),a.renderDepthDetached(()=>e.rctx.screen.draw()),f.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(ui.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ji.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=AXe(ji.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,bi(this._passParameters.radii,e,e+o_),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-A9)*A9)}_update(e){if(!e)return;const i=xa(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Te((r-this._passParameters.radii[0])/o_,0,1);Zr(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=kZ(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Et(Et(.6,1,FO(9500,10500,r-ji.radius)),1,this._fadeHaze)}};function AXe(t){return t*Math.cos(Math.PI/16/16)}function HZ(t){t.fragment.code.add(x`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function qZ(t,e){switch(t.include(Yd,e),e.textureCoordinateType){case Qr.Default:case Qr.Compressed:return void t.fragment.code.add(x`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Qr.Atlas:return t.include(HZ),void t.fragment.code.add(x`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Qr.None:case Qr.COUNT:return}}let Eu=class extends Ss{constructor(e,i){super(e,"vec3",Di.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},em=class extends Ss{constructor(e,i){super(e,"sampler2D",Di.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}},Ev=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,i){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return av.LOADED}},WZ=class extends Ev{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Xt(this._texture),this._textureNormal=Xt(this._textureNormal),this._textureEmissive=Xt(this._textureEmissive),this._textureOcclusion=Xt(this._textureOcclusion),this._textureMetallicRoughness=Xt(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?av.LOADED:av.LOADING}get textureBindParameters(){return new Fwe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Xt(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if($c(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Xt(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},Fwe=class extends xr{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var mt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(mt||(mt={}));function YZ(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===mt.Normal&&r&&t.include(qZ,e),e.pbrMode!==mt.Schematic)if(e.pbrMode!==mt.Disabled){if(e.pbrMode===mt.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(s===Di.Pass?new ct("texMetallicRoughness",n=>n.textureMetallicRoughness):new em("texMetallicRoughness",n=>n.textureMetallicRoughness)),i.code.add(x`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(s===Di.Pass?new ct("texEmission",n=>n.textureEmissive):new em("texEmission",n=>n.textureEmissive)),i.code.add(x`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(s===Di.Pass?new ct("texOcclusion",n=>n.textureOcclusion):new em("texOcclusion",n=>n.textureOcclusion)),i.code.add(x`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),s===Di.Pass?i.uniforms.add(new Rt("emissionFactor",n=>n.emissiveFactor),new Rt("mrrFactors",n=>n.mrrFactors)):i.uniforms.add(new Eu("emissionFactor",n=>n.emissiveFactor),new Eu("mrrFactors",n=>n.mrrFactors)),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?x`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?x`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?x`applyEmission(${e.hasEmissiveTextureTransform?x`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?x`applyOcclusion(${e.hasOcclusionTextureTransform?x`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function XZ(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Rt("lightingAmbientSH0",(s,n)=>te(Pse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new Ei("lightingAmbientSH_R",(s,n)=>Zr(Hm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Ei("lightingAmbientSH_G",(s,n)=>Zr(Hm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Ei("lightingAmbientSH_B",(s,n)=>Zr(Hm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Rt("lightingAmbientSH0",(s,n)=>te(Pse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Ei("lightingAmbientSH_R1",(s,n)=>Zr(Hm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Ei("lightingAmbientSH_G1",(s,n)=>Zr(Hm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Ei("lightingAmbientSH_B1",(s,n)=>Zr(Hm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Ei("lightingAmbientSH_R2",(s,n)=>Zr(Hm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Ei("lightingAmbientSH_G2",(s,n)=>Zr(Hm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Ei("lightingAmbientSH_B2",(s,n)=>Zr(Hm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==mt.Normal&&e.pbrMode!==mt.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Pse=C(),Hm=Yt();function w$(t){t.vertex.code.add(x`const float PI = 3.141592653589793;`),t.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Vf,jw;function MXe(t){return t?.cubeMap!=null}function PXe(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(Vf||(Vf={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(jw||(jw={}));let OXe=class{constructor(){this.readChannels=jw.RG,this.renderingStage=Vf.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.parallax=new Ose,this.parallaxNew=new Ose,this.pointOnGround=C(),this.fadeMode=Mr.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=Se(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-ji.radius*ji.radius,0))/r,die(Rse,i.anchorPointClouds,Vx),Sc(i.transform,Cr,Vx[3],Vx),this.fadeMode===Mr.CROSS_FADE){const s=this.parallaxNew;die(Rse,s.anchorPointClouds,Vx),Sc(s.transform,Cr,Vx[3],Vx)}}updateFading(e,i,r,s){this.isFading&&this._advanceFading(r,s),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*Lg||s<-Lg||n>DXe)&&this.opacity>0)this._setFade(Mr.HIDE,r);else if(!this.isFading){if((s>Lg||s<-.35*Lg||n>LXe)&&this.opacity>0)this._setFade(Mr.FADE_OUT,r);else if(s<=Lg&&s>=-.35*Lg&&i===gi.IDLE&&PXe(this.data)){if(this.opacity===0)return void this._setFade(Mr.FADE_IN,r);(n>IXe||this.renderingStage===Vf.FADING)&&this._setFade(Mr.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?Te((e-this.startTime)/($Xe*i),0,1):1,this.fadeMode===Mr.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===Mr.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===Mr.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===Mr.FADE_OUT&&(this.opacity=0),this.fadeMode===Mr.FADE_IN&&(this.opacity=1),this.fadeMode===Mr.CROSS_FADE&&(this.opacity=1),this.fadeMode=Mr.NONE}_switchReadChannels(){const e=this.fadeMode===Mr.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===Mr.FADE_IN&&this.fadeFactor===0;this.renderingStage===Vf.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=Vf.FINISHED)}_calculateDistanceToAnchorPoint(e){return fe(this.pointOnGround,e.eye),ie(this.pointOnGround,this.pointOnGround,ji.radius),Se(_e(RXe,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===Mr.CROSS_FADE&&(this.fadeFactor===0&&ae(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ae(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===Mr.FADE_IN&&this.fadeFactor===0&&ae(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case Mr.HIDE:this.opacity=0;break;case Mr.FADE_OUT:this.opacity=1;break;case Mr.FADE_IN:this.opacity=0;break;case Mr.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===Mr.FADE_OUT||this.fadeMode===Mr.FADE_IN||this.fadeMode===Mr.CROSS_FADE}};var Mr;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(Mr||(Mr={}));let Ose=class{constructor(){this.anchorPointClouds=C(),this.radiusCurvatureCorrectionFactor=0,this.transform=xe()}};const Rse=Ce(0,0,1),Vx=Sp(),RXe=C(),$Xe=1.25,IXe=34e3,LXe=64e3,DXe=2e5;let tm=class extends Ss{constructor(e,i){super(e,"bool",Di.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},NXe=class extends Ss{constructor(e,i){super(e,"samplerCube",Di.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function kwe(t){const e=t.fragment;e.uniforms.add(new Gr("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new Gr("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Rt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Rt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new Ue("cloudsHeight",()=>$Be),new Ue("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ue("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new Ue("crossFadeAnchorFactor",(i,r)=>Te(r.cloudsFade.fadeFactor,0,1)),new NXe("cubeMap",(i,r)=>r.cloudsFade.data?.cubeMap?.colorTexture??null),new tm("crossFade",(i,r)=>r.cloudsFade.fadeMode===Mr.CROSS_FADE),new tm("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===jw.RG),new tm("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===Vf.FADING)),e.constants.add("planetRadius","float",ji.radius),e.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),I0(e),Em(e),e.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(x`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Rm(t){t.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function FXe(){const t=new Pi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(O.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new Gr("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new Gr("inverseViewMatrix",(n,o)=>vv(kXe,o.camera.viewMatrix))),r.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(Rm),s.include(Ep),t.include(XZ,{pbrMode:mt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(w$),t.include(FU),t.include(I4),t.include(kwe),s.uniforms.add(new Rt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const kXe=xe(),UXe=Object.freeze(Object.defineProperty({__proto__:null,build:FXe},Symbol.toStringTag,{value:"Module"}));let Uwe=class zwe extends Ni{constructor(e){super(e,new ol,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,zwe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Fo(Ee.ONE,Ee.ZERO,Ee.SRC_ALPHA,Ee.ONE),depthTest:{func:tr.LEQUAL},colorWrite:qt})}};Uwe.shader=new Oi(UXe,()=>ue(()=>import("./CloudsComposition.glsl-b0d7d107.js"),[],import.meta.url));let eb=class extends Pe{constructor(e){super(e),this._technique=new Uwe(e),this._vao=Om(e.rctx)}destroy(){this._technique=Xt(this._technique),this._vao=Tt(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,e.bindParameters,zXe);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(ui.TRIANGLE_STRIP,0,4)}};d([m({constructOnly:!0})],eb.prototype,"rctx",void 0),d([m({constructOnly:!0})],eb.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],eb.prototype,"planetRadius",void 0),d([m({constructOnly:!0})],eb.prototype,"requestRender",void 0),eb=d([U("esri.views.3d.environment.CloudsComposition")],eb);const zXe=new xr;function yc(){return new Float32Array(3)}function D9(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function BXe(t,e){return new Float32Array(t,e,3)}function ZZ(){return yc()}function Bwe(){return pr(1,1,1)}function Vwe(){return pr(1,0,0)}function Gwe(){return pr(0,1,0)}function jwe(){return pr(0,0,1)}const VXe=ZZ(),GXe=Bwe(),jXe=Vwe(),HXe=Gwe(),qXe=jwe();Object.freeze(Object.defineProperty({__proto__:null,ONES:GXe,UNIT_X:jXe,UNIT_Y:HXe,UNIT_Z:qXe,ZEROS:VXe,clone:D9,create:yc,createView:BXe,fromValues:pr,ones:Bwe,unitX:Vwe,unitY:Gwe,unitZ:jwe,zeros:ZZ},Symbol.toStringTag,{value:"Module"}));var Ll;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Ll||(Ll={}));let uN=class extends ol{constructor(){super(...arguments),this.steps=Ll.SIXTEEN,this.writeTextureChannels=jw.RG}};d([B({count:Ll.COUNT})],uN.prototype,"steps",void 0),d([B({constValue:se("esri-mobile")?1024:2048})],uN.prototype,"cubeMapSize",void 0),d([B()],uN.prototype,"writeTextureChannels",void 0);let BM=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const $se=new BM([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Ll.SIXTEEN),ua={sunny:$se,cloudy:new BM([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Ll.TWOHUNDRED,.6),rainy:new BM([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Ll.TWOHUNDRED,.4),snowy:new BM([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Ll.HUNDRED,.65),foggy:new BM([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Ll.SIXTEEN),default:$se},fh=se("esri-mobile")?64:128,WXe=fh/128,Td=Math.ceil(Math.sqrt(fh)),F_=(fh+2)*Td,YXe=1e5,GB=128,XXe=F_/1560;let zh=class extends Ss{constructor(e,i){super(e,"mat3",Di.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},Hwe=class extends xr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ua.default.raymarchingSteps,this.weatherTile=it(),this.viewMatrix=yr()}};function ZXe(t){const e=new Pi;e.include(ra,!1);const i=e.fragment;return i.uniforms.add(new Ue("cloudRadius",r=>r.cloudRadius),new Ue("power",r=>Et(35,120,r.absorption)),new Ue("sigmaE",r=>1+r.absorption),new Ue("density",r=>Et(0,.3,r.density)),new Ue("cloudSize",r=>Et(0,.02,Math.max(.01,1-r.cloudSize))),new Ue("detailSize",r=>Et(0,.2,Math.max(.01,1-r.detailSize))),new Ue("smoothness",r=>Et(0,.5,1-r.smoothness)),new Ue("cloudHeight",r=>Et(0,1500,r.cloudHeight)),new Ue("coverage",r=>r.coverage),new zh("view",r=>r.viewMatrix),new ct("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Ar("cloudVariables",r=>bi(JXe,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(x`
    const int STEPS = ${t.steps===Ll.SIXTEEN?x`16`:t.steps===Ll.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(F_)};
      const float dataWidth = ${x.float(F_)};
      const float tileRows = ${x.float(Td)};
      const vec3 atlasDimensions = vec3(${x.float(fh)}, ${x.float(fh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(WXe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${x.float(XXe)} * p) / ${x.float(F_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(x`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(x`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(x`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const JXe=it(),QXe=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Hwe,build:ZXe},Symbol.toStringTag,{value:"Module"}));let qwe=class Wwe extends Ni{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,Wwe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:Ru(Ee.CONSTANT_COLOR,Ee.ONE_MINUS_CONSTANT_COLOR,y0.ADD,this.configuration.writeTextureChannels===jw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:tr.LEQUAL},colorWrite:qt})}};qwe.shader=new Oi(QXe,()=>ue(()=>import("./Clouds.glsl-09b78d06.js"),[],import.meta.url));var gu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(gu||(gu={}));let N9=class extends ol{constructor(){super(...arguments),this.mode=gu.Full}};d([B({count:gu.COUNT})],N9.prototype,"mode",void 0);let Ywe=class extends xr{constructor(){super(...arguments),this.weatherTile=ci(0,0)}};function KXe(t){const e=new Pi;return e.include(ra,!1),e.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===gu.Full&&e.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(Td)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Ar("weatherTile",i=>i.weatherTile)),e.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(GB)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(GB)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(YXe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(x`void main() {`),t.mode===gu.Full&&e.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(fh)} + 2.0 * padWidth;
        float tileCount = ${x.float(Td)} * ${x.float(Td)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(fh)};
          }

          if (startPadY) {
            pixel.y += ${x.float(fh)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(fh)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(fh)};
          }

          uv = vec2(pixel.xy / ${x.float(fh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(fh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(Td)} * ${x.float(Td)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(Td)} * ${x.float(Td)});
        p = p_;
        p.z /= (${x.float(Td)} * ${x.float(Td)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(x`
      vec2 mapUV = ${x.float(GB)} * (gl_FragCoord.xy / ${x.float(F_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===gu.Full?x`fragColor.ba = vec2(0.0, map);`:x`fragColor = vec4(map);`};
    }
  `),e}const eZe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Ywe,build:KXe},Symbol.toStringTag,{value:"Module"}));let F9=class Xwe extends Ni{initializeProgram(e){return new Fi(e.rctx,Xwe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:this.configuration.mode===gu.Full?Ru(Ee.ONE,Ee.ZERO):Fo(Ee.ZERO,Ee.ONE,Ee.ONE,Ee.ZERO),depthTest:{func:tr.ALWAYS},colorWrite:qt})}};F9.shader=new Oi(eZe,()=>ue(()=>import("./NoiseTextureAtlas.glsl-46301e11.js"),[],import.meta.url));let Zwe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function tZe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*GZ(t.internalFormat)}let Jwe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=v0.RenderBuffer,this._context.instanceCounter.increment(Vs.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return tZe(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Vs.Renderbuffer,this),this._context=null)}};const iZe=()=>le.getLogger("esri.views.webgl.FramebufferObject");let $m=class VM{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Vs.FramebufferObject,this);const s=hN(i)?i:new ur(this._context,i);if(this._colorAttachments.set(En.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(En.COLOR_ATTACHMENT0),r!=null)if(sZe(r))this._depthStencilTexture=hN(r)?r:new ur(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=rZe(r)?r:new Jwe(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((i,r)=>this.detachColorTexture(r)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Vs.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(En.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(En.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(En.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&hN(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=En.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=En.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=En.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case v0.Texture:return this._attachDepthStencilTexture(e);case v0.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const i=e.descriptor;i.pixelFormat!==Pt.DEPTH_STENCIL&&i.pixelFormat!==Pt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Pa.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,MC)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,MC),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(fa.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(fa.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==vs.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,ur.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(ur.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(vs.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(u,ur.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=lr.createPixelPack(this._context,Hi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(vt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};Bb(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(Bb(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=fa.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,Ise(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Ise(this._depthStencilTexture),e);Md()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=En.COLOR_ATTACHMENT0,r=vs.TEXTURE_2D,s=fa.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(fa.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Tt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Tt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==vs.TEXTURE_2D&&e.target!==vs.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),Bb(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){Bb(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Wo.DEPTH_COMPONENT16:case Wo.DEPTH_COMPONENT24:case Wo.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Wo.DEPTH24_STENCIL8:case Wo.DEPTH32F_STENCIL8:case Wo.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Wo.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(VM._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;VM._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-En.COLOR_ATTACHMENT0;i+1>VM._MAX_COLOR_ATTACHMENTS&&le.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${VM._MAX_COLOR_ATTACHMENTS} color attachments`)}};function hN(t){return t!=null&&"type"in t&&t.type===v0.Texture}function rZe(t){return t!=null&&"type"in t&&t.type===v0.RenderBuffer}function sZe(t){return hN(t)||t!=null&&"pixelFormat"in t}function Bb(t,e){const i=Math.max(t.width,t.height);if(i>e){iZe().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function Ise(t){return t.descriptor.target===vs.TEXTURE_CUBE_MAP?vs.TEXTURE_CUBE_MAP_POSITIVE_X:vs.TEXTURE_2D}$m._MAX_COLOR_ATTACHMENTS=-1;let GM=class extends Pe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Ywe,this._fbo=new $m(e.context.renderContext.rctx,new $r(F_)),this._vao=Om(e.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(gu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(gu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(ta(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Xt(this._fullTechniqueCached),this._weatherMapTechniqueCached=Xt(this._weatherMapTechniqueCached),this._fbo=Tt(this._fbo),this._vao=Tt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new N9;e.mode=gu.Full,this._fullTechniqueCached=this._techniques.acquire(F9,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new N9;e.mode=gu.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(F9,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const i=e===gu.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,F_,F_),r.bindFramebuffer(this._fbo);const n=r.bindTechnique(i,null,this._passParameters);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._fbo.colorTexture}};d([m({constructOnly:!0})],GM.prototype,"context",void 0),d([m({readOnly:!0})],GM.prototype,"_techniques",null),GM=d([U("esri.views.3d.environment.NoiseTextureAtlas")],GM);function UU(t){return t?{ray:Gn(t.ray),c0:t.c0,c1:t.c1}:{ray:Gn(),c0:0,c1:Number.MAX_VALUE}}function nZe(t,e=UU()){return S4(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function oZe(t,e,i=UU()){const r=Se(t.vector);return o1e(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function qLt(t,e){return Qwe(t,t.c0,e)}function WLt(t,e){return Qwe(t,t.c1,e)}function Qwe(t,e,i){return me(i,t.ray.origin,ie(i,t.ray.direction,e))}new R0(()=>UU());function uR(t){return t?[Ui(t[0]),Ui(t[1]),Ui(t[2]),Ui(t[3]),Ui(t[4]),Ui(t[5])]:[Ui(),Ui(),Ui(),Ui(),Ui(),Ui()]}function Kwe(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function F4(t,e){for(let i=0;i<fE;i++)tU(t[i],e[i]);return t}function exe(t,e,i,r=dZe){const s=Ai(jX.get(),e,t);Is(s,s);for(let n=0;n<uZe;++n){const o=Cc(GX.get(),hZe[n],s);te(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}txe(i,r)}function txe(t,e){ba(e[ot.FAR_BOTTOM_LEFT],e[ot.NEAR_BOTTOM_LEFT],e[ot.NEAR_TOP_LEFT],t[ar.LEFT]),ba(e[ot.NEAR_BOTTOM_RIGHT],e[ot.FAR_BOTTOM_RIGHT],e[ot.FAR_TOP_RIGHT],t[ar.RIGHT]),ba(e[ot.FAR_BOTTOM_LEFT],e[ot.FAR_BOTTOM_RIGHT],e[ot.NEAR_BOTTOM_RIGHT],t[ar.BOTTOM]),ba(e[ot.NEAR_TOP_LEFT],e[ot.NEAR_TOP_RIGHT],e[ot.FAR_TOP_RIGHT],t[ar.TOP]),ba(e[ot.NEAR_BOTTOM_LEFT],e[ot.NEAR_BOTTOM_RIGHT],e[ot.NEAR_TOP_RIGHT],t[ar.NEAR]),ba(e[ot.FAR_BOTTOM_RIGHT],e[ot.FAR_BOTTOM_LEFT],e[ot.FAR_TOP_LEFT],t[ar.FAR])}function C_(t,e){for(let i=0;i<fE;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function aZe(t,e){return rxe(t,nZe(e,sxe.get()))}function YLt(t,e){for(let i=0;i<fE;i++){const r=t[i];if(!IGe(r,e))return!1}return!0}function lZe(t,e,i){return rxe(t,oZe(e,i,sxe.get()))}function ixe(t,e){for(let i=0;i<fE;i++)if(fr(t[i],e)>0)return!1;return!0}function rxe(t,e){for(let i=0;i<fE;i++)if(!$Ge(t[i],e))return!1;return!0}var ar,ot;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(ar||(ar={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(ot||(ot={}));const cZe={bottom:[ot.FAR_BOTTOM_RIGHT,ot.NEAR_BOTTOM_RIGHT,ot.NEAR_BOTTOM_LEFT,ot.FAR_BOTTOM_LEFT],near:[ot.NEAR_BOTTOM_LEFT,ot.NEAR_BOTTOM_RIGHT,ot.NEAR_TOP_RIGHT,ot.NEAR_TOP_LEFT],far:[ot.FAR_BOTTOM_RIGHT,ot.FAR_BOTTOM_LEFT,ot.FAR_TOP_LEFT,ot.FAR_TOP_RIGHT],right:[ot.NEAR_BOTTOM_RIGHT,ot.FAR_BOTTOM_RIGHT,ot.FAR_TOP_RIGHT,ot.NEAR_TOP_RIGHT],left:[ot.FAR_BOTTOM_LEFT,ot.NEAR_BOTTOM_LEFT,ot.NEAR_TOP_LEFT,ot.FAR_TOP_LEFT],top:[ot.FAR_TOP_LEFT,ot.NEAR_TOP_LEFT,ot.NEAR_TOP_RIGHT,ot.FAR_TOP_RIGHT]},fE=6,uZe=8,hZe=[kt(-1,-1,-1,1),kt(1,-1,-1,1),kt(1,1,-1,1),kt(-1,1,-1,1),kt(-1,-1,1,1),kt(1,-1,1,1),kt(1,1,1,1),kt(-1,1,1,1)],sxe=new R0(UU),dZe=Kwe();function pZe(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function fZe(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function mZe(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function gZe(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let k9=class{constructor(){this.adds=new Gt,this.removes=new Gt,this.updates=new Gt({allocator:e=>e||new yZe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},yZe=class{},_Ze=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Ld,ei;function nxe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new _Ze,e.set(r,s)),s};return t.removes.forAll(r=>{jB(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{jB(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{jB(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function jB(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Ld||(Ld={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(ei||(ei={}));var U9;let Kt=U9=class extends Pe{constructor(t){super(t),this._ray=Gn(),this._viewport=kt(0,0,1,1),this._padding=kt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ci(1,1e3),this._viewDirty=!0,this._viewMatrix=xe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=xe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=xe(),this._frustumDirty=!0,this._frustum=uR(),this._fullViewport=Yt(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=C(),this._up=C(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return _e(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){tn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),te(C(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),te(C(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),te(C(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=kw(Yt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Uw(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=kw(Yt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&Uw(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[ei.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[ei.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[ei.RIGHT]+this._padding[ei.LEFT]}set fullWidth(t){this.width=t-(this._padding[ei.RIGHT]+this._padding[ei.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ei.TOP]+this._padding[ei.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[ei.TOP]+this._padding[ei.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ei.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ei.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){y2(this._padding,t)||(this._viewport[0]+=t[ei.LEFT]-this._padding[ei.LEFT],this._viewport[1]+=t[ei.BOTTOM]-this._padding[ei.BOTTOM],this._viewport[2]-=t[ei.RIGHT]+t[ei.LEFT]-(this._padding[ei.RIGHT]+this._padding[ei.LEFT]),this._viewport[3]-=t[ei.TOP]+t[ei.BOTTOM]-(this._padding[ei.TOP]+this._padding[ei.BOTTOM]),Ch(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Ai(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return Is(xe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||xe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return mZe(this._fov,this.width,this.height)}set fovX(t){this._fov=pZe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return gZe(this._fov,this.width,this.height)}set fovY(t){this._fov=fZe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return hr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Is(this._viewInverseTransposeMatrix,this.viewMatrix),Pc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,u=K0e(xe(),o*(1+2*this._padding[ei.LEFT]/t),a*(1+2*this._padding[ei.RIGHT]/t),l*(1+2*this._padding[ei.BOTTOM]/e),c*(1+2*this._padding[ei.TOP]/e),this.near,this.far),h=this._get("projectionMatrix");return h&&Hk(h,u)?h:u}copyFrom(t){ae(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Ch(this._viewport,t.viewport),this.notifyChange("_viewport"),Ch(this._padding,t.padding),this.notifyChange("_padding"),ta(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(tn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(F4(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(tn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Ch(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new U9().copyFrom(this)}equals(t){return ho(this.eye,t.eye)&&ho(this.center,t.center)&&ho(this.up,t.up)&&y2(this._viewport,t.viewport)&&y2(this._padding,t.padding)&&nve(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||c4(t.screenPadding,this.screenPadding)>=e||c4(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;yi(sa,t.eye,t.center),yi(HB,this.eye,this.center);const i=pe(sa,HB),r=kF(sa),s=kF(HB),n=5e-4;return i*i>=(1-1e-10)*r*s&&DO(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(I_(this.viewForward,_e(sa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=ns()){return t[0]=(this.padding[ei.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[ei.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[ei.LEFT]+this.width*e,t[1]=this.padding[ei.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Si&&ae(Si,t),Si[3]=1,Cc(Si,Si,this.projectionMatrix);const i=Math.abs(Si[3]);ie(Si,Si,1/i);const r=this.fullViewport;e[0]=Et(0,r[0]+r[2],.5+.5*Si[0]),e[1]=Et(0,r[1]+r[3],.5+.5*Si[1]),e[2]=.5*(Si[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Si[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Si[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Si[2]=(2*t[2]-1)*t[3],Si[3]=t[3],this.inverseProjectionMatrix!=null&&(Cc(Si,Si,this.inverseProjectionMatrix),e[0]=Si[0],e[1]=Si[1],e[2]=Si[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,qB),this.renderToScreen(qB,e),e}projectToRenderScreen(t,e){if(Si[0]=t[0],Si[1]=t[1],Si[2]=t[2],Si[3]=1,Cc(Si,Si,this.viewProjectionMatrix),Si[3]===0)return null;const i=Si;ie(i,i,1/Math.abs(Si[3]));const r=this.fullViewport,s=Et(0,r[0]+r[2],.5+.5*i[0]),n=Et(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,qB),e)}unprojectFromRenderScreen(t,e){if(Ai(eI,this.projectionMatrix,this.viewMatrix),!Is(eI,eI))return null;const i=this.fullViewport;return Si[0]=2*(t[0]-i[0])/i[2]-1,Si[1]=2*(t[1]-i[1])/i[3]-1,Si[2]=2*t[2]-1,Si[3]=1,Cc(Si,Si,eI),Si[3]===0?null:(e[0]=Si[0]/Si[3],e[1]=Si[1]/Si[3],e[2]=Si[2]/Si[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),u=i-l- -Math.min(this.fullWidth-s-i/2,0),h=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(t){t===Ne.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){_e(sa,this.center,this.eye);const t=Se(this.center);t<1?(te(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(pe(sa,this.center))>.9999*Se(sa)*t||(Ke(this._up,sa,this.center),Ke(this._up,this._up,sa),fe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){S0(sa,this.eye,this.center),Math.abs(sa[2])<=.9999&&(ie(sa,sa,sa[2]),te(this._up,-sa[0],-sa[1],1-sa[2]),fe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ho(t,e)||(ae(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):le.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(exe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Gk(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],Kt.prototype,"_viewport",void 0),d([m()],Kt.prototype,"_padding",void 0),d([m()],Kt.prototype,"_fov",void 0),d([m()],Kt.prototype,"_nearFar",void 0),d([m()],Kt.prototype,"_viewDirty",void 0),d([m()],Kt.prototype,"_viewMatrix",void 0),d([m()],Kt.prototype,"_pixelRatio",void 0),d([m()],Kt.prototype,"pixelRatio",null),d([m()],Kt.prototype,"row",void 0),d([m()],Kt.prototype,"column",void 0),d([m()],Kt.prototype,"_rows",void 0),d([m()],Kt.prototype,"rows",null),d([m()],Kt.prototype,"_columns",void 0),d([m()],Kt.prototype,"columns",null),d([m()],Kt.prototype,"eye",null),d([m()],Kt.prototype,"center",null),d([m()],Kt.prototype,"_center",void 0),d([m()],Kt.prototype,"up",null),d([m()],Kt.prototype,"_up",void 0),d([m()],Kt.prototype,"viewMatrix",null),d([m({readOnly:!0})],Kt.prototype,"viewForward",null),d([m({readOnly:!0})],Kt.prototype,"viewUp",null),d([m({readOnly:!0})],Kt.prototype,"viewRight",null),d([m({readOnly:!0})],Kt.prototype,"nearFar",null),d([m()],Kt.prototype,"near",null),d([m()],Kt.prototype,"far",null),d([m()],Kt.prototype,"viewport",null),d([m({readOnly:!0})],Kt.prototype,"screenViewport",null),d([m({readOnly:!0})],Kt.prototype,"screenPadding",null),d([m()],Kt.prototype,"x",null),d([m()],Kt.prototype,"y",null),d([m()],Kt.prototype,"width",null),d([m()],Kt.prototype,"height",null),d([m()],Kt.prototype,"fullWidth",null),d([m()],Kt.prototype,"fullHeight",null),d([m({readOnly:!0})],Kt.prototype,"_aspect",null),d([m()],Kt.prototype,"padding",null),d([m({readOnly:!0})],Kt.prototype,"projectionMatrix",null),d([m({readOnly:!0})],Kt.prototype,"inverseProjectionMatrix",null),d([m()],Kt.prototype,"fov",null),d([m()],Kt.prototype,"fovX",null),d([m()],Kt.prototype,"fovY",null),d([m()],Kt.prototype,"viewInverseTransposeMatrix",null),d([m({readOnly:!0})],Kt.prototype,"_projectionMatrixInternal",null),d([m()],Kt.prototype,"relativeElevation",void 0),Kt=U9=d([U("esri.views.3d.webgl.RenderCamera")],Kt);const br=Kt,Si=Yt(),eI=xe(),sa=C(),HB=C(),qB=Jo();var Pl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Pl||(Pl={}));function vZe(t){t.include(Cm),t.uniforms.add(new ct("geometryDepthTexture",(e,i)=>i.multipassGeometry.depth?.attachment)),t.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}let bZe=class{};function Im(t,e){if(!e.multipassEnabled)return;t.fragment.include(Cm),t.fragment.uniforms.add(new ct("terrainDepthTexture",(r,s)=>s.multipassTerrain.depth?.attachment));const i=e.occlusionPass;t.fragment.code.add(x`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${i?x`return fragmentDepth < linearDepth && depth < 1.0;`:x`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let wZe=class{constructor(){this.cullAboveGround=!1}};var ye;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",t[t.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",t[t.LASERLINES=14]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=16]="HUD_MATERIAL",t[t.LABEL_MATERIAL=17]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=18]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",t[t.DRAPED_WATER=21]="DRAPED_WATER",t[t.VIEWSHED=22]="VIEWSHED",t[t.VOXEL=23]="VOXEL",t[t.MAX_SLOTS=24]="MAX_SLOTS"})(ye||(ye={}));var Qe;(function(t){t[t.ColorAlpha=0]="ColorAlpha",t[t.FrontFace=1]="FrontFace",t[t.NONE=2]="NONE",t[t.COUNT=3]="COUNT"})(Qe||(Qe={}));let JZ=class{constructor(e=C()){this.intensity=e}},oxe=class{constructor(e=C(),i=Ce(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},k4=class{constructor(e=C(),i=Ce(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},axe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function xZe(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function WB(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function C2(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function lxe(t){return(t+1)*(t+1)}function TZe(t){return Te(Math.floor(Math.sqrt(t)-1),0,2)}function cxe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=lxe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function SZe(t,e){const i=lxe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function CZe(t,e){const i=TZe(e.r.length);for(const r of t)Yn(z9,r.direction),cxe(z9,i,Ug),xZe(Ug,dN),WB(Ug,r.intensity[0],Gx),C2(e.r,Gx),WB(Ug,r.intensity[1],Gx),C2(e.g,Gx),WB(Ug,r.intensity[2],Gx),C2(e.b,Gx);return e}function EZe(t,e){cxe(z9,0,Ug);for(const i of t)e.r[0]+=Ug[0]*dN[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Ug[0]*dN[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Ug[0]*dN[0]*i.intensity[2]*4*Math.PI;return e}function AZe(t,e,i,r){SZe(e,r),te(i.intensity,0,0,0);let s=!1;const n=MZe,o=PZe,a=OZe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof k4&&!s?(ae(i.direction,l.direction),ae(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof k4||l instanceof oxe?n.push(l):l instanceof JZ?o.push(l):l instanceof axe&&a.push(l);CZe(n,r),EZe(o,r);for(const l of a)C2(r.r,l.r),C2(r.g,l.g),C2(r.b,l.b)}const MZe=[],PZe=[],OZe=[],Ug=[0],Gx=[0],z9=C(),dN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Lse=class{constructor(){this.color=C(),this.intensity=1}},RZe=class{constructor(){this.direction=C(),this.ambient=new Lse,this.diffuse=new Lse}};const uxe=.4;let YB=class{constructor(){this._shOrder=2,this._legacy=new RZe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new axe,this._mainLight=new k4(C(),Ce(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){AZe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ae(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ie(this._legacy.diffuse.color,this._mainLight.intensity,i),ae(tI,this._legacy.diffuse.color),ie(tI,tI,uxe*this.globalFactor),me(this._legacy.ambient.color,this._legacy.ambient.color,tI)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ae(this._mainLight.direction,e.mainLight.direction),ae(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(or(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Et(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Et(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ae(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Et(e.globalFactor,i.globalFactor,r),this.noonFactor=Et(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=Et(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=Et(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=Et(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const tI=C();let zU=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=ye.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Qe.NONE,this.alignPixelEnabled=!1,this.decorations=Ka.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new br,this._inverseViewport=it(),this.oldLighting=new YB,this.newLighting=new YB,this._fadedLighting=new YB,this._lighting=this.newLighting,this.ssr=new $Ze,this.multipassEnabled=!1,this.multipassTerrain=new wZe,this.multipassGeometry=new bZe,this.hudRenderStyle=Pl.Occluded,this.cloudsFade=new OXe,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},$Ze=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=xe()}},xl=class extends Pe{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new uN,this._bindParameters=new zU(null,null),this._passParameters=new Hwe,this._weatherTile=it(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Et(ua.default.coverage[0],ua.default.coverage[1],.5),this.density=Et(ua.default.density[0],ua.default.density[1],.5),this.absorption=Et(ua.default.absorption[0],ua.default.absorption[1],.5),this.cloudSize=Et(ua.default.cloudSize[0],ua.default.cloudSize[1],.5),this.detailSize=Et(ua.default.detailSize[0],ua.default.detailSize[1],.5),this.smoothness=Et(ua.default.smoothness[0],ua.default.smoothness[1],.5),this.cloudHeight=Et(ua.default.cloudHeight[0],ua.default.cloudHeight[1],.5),this.raymarchingSteps=ua.default.raymarchingSteps,this._viewMatrix=xe(),this._dirty=!1,this.running=!1,this._vao=Om(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===jw.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new qwe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;bi(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),ove(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=er(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(wt.CLOUDS_GENERATOR,this),he(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Ki)])}destroy(){this._techniques.forEach(e=>Xt(e)),this._frameBufferCube=Tt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Oe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Ll.SIXTEEN:return 1;case Ll.HUNDRED:return 4;case Ll.COUNT:case Ll.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){var e;return(e=this._passParameters).noiseTexture??(e.noiseTexture=new GM({context:this.context})),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new $r(e);i.target=vs.TEXTURE_CUBE_MAP,i.wrapMode=hi.CLAMP_TO_EDGE,this._frameBufferCube=new $m(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Tt(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=Et(n[0],n[1],r);return i<.5?Et(n[0],o,2*i):Et(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),ta(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===Mr.CROSS_FADE||!this._ensureNoiseTexture())return $o;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Vf.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=IZe[this._faceIndex],s=LZe[this._faceIndex];tye(this._viewMatrix,DZe,r,s),$u(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.bindTechnique(i,this._bindParameters,this._passParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=n.getViewport(),l=i.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;n.setViewport(0,u,l,c);const h=this._ensureFrameBufferCube(l);n.bindFramebuffer(h);const p=vs.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return h.setColorTextureTarget(p),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Vf.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),$o}};d([m({constructOnly:!0})],xl.prototype,"context",void 0),d([m({constructOnly:!0})],xl.prototype,"view",void 0),d([m({constructOnly:!0})],xl.prototype,"requestRender",void 0),d([m()],xl.prototype,"coverage",void 0),d([m()],xl.prototype,"density",void 0),d([m()],xl.prototype,"absorption",void 0),d([m()],xl.prototype,"cloudSize",void 0),d([m()],xl.prototype,"detailSize",void 0),d([m()],xl.prototype,"smoothness",void 0),d([m()],xl.prototype,"cloudHeight",void 0),d([m()],xl.prototype,"raymarchingSteps",void 0),d([m()],xl.prototype,"running",void 0),xl=d([U("esri.views.3d.environment.CloudsGenerator")],xl);const IZe=[pr(1,0,0),pr(-1,0,0),pr(0,1,0),pr(0,-1,0),pr(0,0,1)],LZe=[pr(0,1,0),pr(0,1,0),pr(0,0,-1),pr(0,0,1),pr(0,1,0)],DZe=ZZ();let hxe=class extends xr{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function NZe(){const t=new Pi;t.attributes.add(O.POSITION,"vec2"),t.include(Yd,{textureCoordinateType:Qr.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new Gr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Gr("inverseViewMatrix",(r,s)=>vv(FZe,s.camera.viewMatrix))),e.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Ue("atmosphereC",r=>r.atmosphereC),new Rt("cameraPosition",(r,s)=>s.camera.eye),new Ar("nearFar",(r,s)=>s.camera.nearFar),new ct("depthTexture",r=>r.depthTexture),new Ue("fogStrength",r=>r.fogStrength),new Ue("fogAmount",r=>r.fogAmount),new Rt("fogColor",r=>r.fogColor)),t.include(FU),i.include(UZ),i.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(x`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const FZe=xe(),kZe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:hxe,build:NZe},Symbol.toStringTag,{value:"Module"}));let dxe=class pxe extends Ni{constructor(e){super(e,new ol,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,pxe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE),colorWrite:qt})}};dxe.shader=new Oi(kZe,()=>ue(()=>import("./Fog.glsl-7861d58f.js"),[],import.meta.url));const UZe=.95,zZe=1;let tb=class extends Pe{constructor(e){super(e),this._passParameters=new hxe;const i=e.context.renderContext.rctx;this._vao=Om(i,b$),this._technique=new dxe(e);const r=er(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+o_}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(ui.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;fe(Dse,r.eye);const s=Math.max(0,pe(Dse,e.bindParameters.lighting.mainLight.direction)),n=i.color;ie(Nse,n,.1),or(this._passParameters.fogColor,Nse,n,s);const o=Se(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-FO(UZe*Lg,zZe*Lg,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}};d([m({constructOnly:!0})],tb.prototype,"context",void 0),d([m({constructOnly:!0})],tb.prototype,"view",void 0),d([m({constructOnly:!0})],tb.prototype,"rctx",void 0),d([m({constructOnly:!0})],tb.prototype,"viewingMode",void 0),tb=d([U("esri.views.3d.environment.Fog")],tb);let BZe=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const Dse=C(),Nse=C();var V;function VZe(t){return E2(t)||t===V.Depth||t===V.Normal||t===V.ObjectAndLayerIdColor}function E2(t){return t===V.Shadow||t===V.ShadowHighlight||t===V.ShadowExcludeHighlight||t===V.ViewshedShadow}function eO(t){return B9(t)||t===V.Normal}function uw(t){return t===V.Highlight||t===V.ObjectAndLayerIdColor}function fxe(t){return t===V.Color||uw(t)}function Kg(t){return t===V.Color}function XB(t){return Kg(t)||t===V.ObjectAndLayerIdColor}function GZe(t){return Kg(t)||t===V.Highlight}function Fse(t){return GZe(t)||k_(t)}function pN(t){return Kg(t)||uw(t)}function B9(t){return pN(t)||k_(t)}function k_(t){return t===V.Depth}(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.ViewshedShadow=6]="ViewshedShadow",t[t.Highlight=7]="Highlight",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(V||(V={}));function QZ({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let mxe=class extends Ss{constructor(e,i){super(e,"mat4",Di.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function wp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",xs):t.uniforms.add(new Eu("cameraPosition",(i,r)=>te(gxe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Dl(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Gr("proj",(r,s)=>s.camera.projectionMatrix),new mxe("view",(r,s)=>Aa(kse,s.camera.viewMatrix,r.origin)),new Eu("localOrigin",r=>r.origin));const i=r=>te(gxe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Gr("proj",(r,s)=>s.camera.projectionMatrix),new Gr("view",(r,s)=>Aa(kse,s.camera.viewMatrix,i(s))),new Rt("localOrigin",(r,s)=>i(s)))}const kse=xe(),gxe=C();function PC(t){t.uniforms.add(new Gr("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function mE(t){t.uniforms.add(new Ue("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}function V9(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function jZe(t,e){const i=t.length;for(let r=0;r<i;++r)GS[0]=t[r],e[r]=GS[0];return e}function HZe(t,e){const i=t.length;for(let r=0;r<i;++r)GS[0]=t[r],GS[1]=t[r]-GS[0],e[r]=GS[1];return e}const GS=new Float32Array(2);let G9=class extends ol{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};d([B()],G9.prototype,"instancedDoublePrecision",void 0),d([B()],G9.prototype,"hasModelTransformation",void 0);const Use=yr();function yxe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new Gr("model",n=>n.modelTransformation??Cr)),t.vertex.uniforms.add(new zh("normalLocalOriginFromModel",n=>(d0(Use,n.modelTransformation??Cr),Use)))),e.instanced&&r&&(t.attributes.add(O.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(O.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(O.INSTANCEMODEL,"mat3"),t.attributes.add(O.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(QZ,e),s.uniforms.add(new Eu("viewOriginHi",(n,o)=>jZe(te(iI,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),iI)),new Eu("viewOriginLo",(n,o)=>HZe(te(iI,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),iI)))),s.code.add(x`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?x`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===V.Normal&&(PC(s),s.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const iI=C();let Fl=class extends G9{};d([B({constValue:!0})],Fl.prototype,"hasSliceHighlight",void 0),d([B({constValue:!1})],Fl.prototype,"hasSliceInVertexProgram",void 0),d([B({constValue:Di.Pass})],Fl.prototype,"pbrTextureBindType",void 0);var mm;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(mm||(mm={}));let KZ=class extends Fl{constructor(){super(...arguments),this.geometry=mm.Cone}};d([B({count:mm.COUNT})],KZ.prototype,"geometry",void 0);function x$(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(x`vec3 positionModel() { return position; }`)}let U4=class extends Ss{constructor(e,i){super(e,"mat3",Di.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function A2(t,e){t.include(x$);const i=t.vertex;i.include(QZ,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new Rt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Rt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new zh("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Gr("transformProjFromView",r=>r.transformProjFromView),new U4("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Eu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Eu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Rt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let qZe=class extends xr{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=yr(),this.transformProjFromView=xe()}},WZe=class extends xr{constructor(){super(...arguments),this.transformWorldFromModelRS=yr(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function j9(t){t.varyings.add("linearDepth","float")}function BU(t){t.vertex.uniforms.add(new Ar("nearFar",(e,i)=>i.camera.nearFar))}function _xe(t){t.vertex.code.add(x`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function gE(t,e){const{vertex:i}=t;switch(e.output){case V.Color:if(e.receiveShadows)return j9(t),void i.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:case V.ViewshedShadow:return t.include(A2,e),j9(t),BU(t),_xe(t),void i.code.add(x`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(x`void forwardLinearDepth() {}`)}function Sa(t){_xe(t),t.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let eJ=class extends xr{constructor(){super(...arguments),this.texV=it(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new vxe}},vxe=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function YZe(t){const e=new Pi,{vertex:i,fragment:r}=e;if(I0(i),t.geometry===mm.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Rt("cameraPosition",(s,n)=>n.camera.eye),new Ue("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
fragColor = color;
}`);else{e.include(Sa,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===mm.Cylinder;i.uniforms.add(new Gr("proj",(a,l)=>l.camera.projectionMatrix),new Gr("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Rt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Rt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Rt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new Ar("texV",a=>a.texV)),i.uniforms.add(new Ue("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new ct("tex",a=>a.texture)),s||r.uniforms.add(new Ue("altitudeFade",a=>a.altitudeFade)),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?x`fragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const XZe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:vxe,SimpleAtmospherePassParameters:eJ,build:YZe},Symbol.toStringTag,{value:"Module"}));let z4=class bxe extends Ni{initializeProgram(e){return new Fi(e.rctx,bxe.shader.get().build(this.configuration),di)}initializePipeline(){return this.configuration.geometry===mm.Cylinder?Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),culling:zZ,depthTest:{func:tr.LEQUAL},colorWrite:qt}):Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:tr.LEQUAL},colorWrite:qt})}};z4.shader=new Oi(XZe,()=>ue(()=>import("./SimpleAtmosphere.glsl-60193297.js"),[],import.meta.url));const ZZe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Lc(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,o=JZe(s.constructor.ElementType),a=s.offset,l=s.optional?.glNormalized??!1;return new vp(r,n,o,a,i,l,e)})}function JZe(t){const e=QZe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const QZe={u8:dt.UNSIGNED_BYTE,u16:dt.UNSIGNED_SHORT,u32:dt.UNSIGNED_INT,i8:dt.BYTE,i16:dt.SHORT,i32:dt.INT,f32:dt.FLOAT};function zse(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Bse=class wxe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new wxe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},KZe=class xxe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:tJe(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,gx,i),this}vec2f64(e,i){return this._appendField(e,eZ,i),this}vec3f(e,i){return this._appendField(e,Xn,i),this}vec3f64(e,i){return this._appendField(e,Lh,i),this}vec4f(e,i){return this._appendField(e,gp,i),this}vec4f64(e,i){return this._appendField(e,oU,i),this}mat3f(e,i){return this._appendField(e,rv,i),this}mat3f64(e,i){return this._appendField(e,JX,i),this}mat4f(e,i){return this._appendField(e,QX,i),this}mat4f64(e,i){return this._appendField(e,iR,i),this}vec4u8(e,i){return this._appendField(e,Ma,i),this}f32(e,i){return this._appendField(e,nU,i),this}f64(e,i){return this._appendField(e,KX,i),this}u8(e,i){return this._appendField(e,_C,i),this}u16(e,i){return this._appendField(e,cU,i),this}i8(e,i){return this._appendField(e,rZ,i),this}vec2i8(e,i){return this._appendField(e,dU,i),this}vec2i16(e,i){return this._appendField(e,d$,i),this}vec2u8(e,i){return this._appendField(e,aU,i),this}vec4u16(e,i){return this._appendField(e,h$,i),this}u32(e,i){return this._appendField(e,hU,i),this}_appendField(e,i,r){if(this._fields.has(e))return void at(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*zse(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new Bse(this,e)}createView(e){return new Bse(this,e)}clone(){const e=new xxe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,zse(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function cs(){return new KZe}let xDt=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:Txe(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const eJe=[nU,gx,Xn,gp,rv,QX,KX,eZ,Lh,oU,JX,iR,_C,aU,lU,Ma,cU,tZ,uU,h$,hU,iZ,cve,uve,rZ,dU,hve,dve,pve,d$,fve,mve,gve,yve,_ve,vve];function Txe(t){return`${t.ElementType}_${t.ElementCount}`}function tJe(t){return Sxe.get(t)}const Sxe=new Map;eJe.forEach(t=>Sxe.set(Txe(t),t));function os(t,e=!1){return t<=Au?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function SDt(t){return am(t)?t.length<Au?t:new Float32Array(t):t.length<Au?Array.from(t):t}function Vse(t){return(am(t)?t.length:t.byteLength/8)<=Au?Array.from(t):new Float32Array(t)}function B4(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}var H9;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],h=1/Math.sqrt(l*l+c*c+u*u);o[a]*=h,o[a+1]*=h,o[a+2]*=h}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]+l[c],u[h+1]=o[a+1]+l[c+1],u[h+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]-l[c],u[h+1]=o[a+1]-l[c+1],u[h+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(H9||(H9={}));var ws;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(ws||(ws={}));function iJe(t){if(t.length<Au)return Array.from(t);if(am(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Q5(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let Cxe=class Exe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,at(e.length>=1),at(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;at(o.length%this._numIndexPerPrimitive==0),at(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];Hv.clear(),Hv.push(l);const c=Ce(s[l],s[l+1],s[l+2]),u=Kr(c);for(let f=0;f<a;++f){const g=this._numIndexPerPrimitive*e[f];for(let _=0;_<this._numIndexPerPrimitive;++_){l=n*o[g+_],Hv.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const h=or(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let f=0;f<Hv.length;++f){l=Hv.at(f);const g=s[l]-h[0],_=s[l+1]-h[1],v=s[l+2]-h[2],b=g*g+_*_+v*v;if(b<=p)continue;const w=Math.sqrt(b),T=.5*(w-this.radius);this.radius=this.radius+T,p=this.radius*this.radius;const S=T/w;h[0]+=g*S,h[1]+=_*S,h[2]+=v*S}this.center=h,Hv.clear()}getChildren(){if(this._children||Wn(this.bbMin,this.bbMax)<=1)return this._children;const e=or(C(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<i;++u){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let f=o*a[p],g=n[f],_=n[f+1],v=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*a[p+b];const w=n[f],T=n[f+1],S=n[f+2];w<g&&(g=w),T<_&&(_=T),S<v&&(v=S)}g<e[0]&&(h|=1),_<e[1]&&(h|=2),v<e[2]&&(h|=4),r[u]=h,++s[h]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<i;++u){const h=r[u];c[h][s[h]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new Exe(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Hv.prune()}};const Hv=new Gt({deallocator:null});let T$=class{constructor(){this.id=wu()}};function rJe(t){return t?{p0:Kr(t.p0),p1:Kr(t.p1),p2:Kr(t.p2)}:{p0:C(),p1:C(),p2:C()}}function sJe(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function nJe(t,e,i){return _e(ZB,e,t),_e(Gse,i,t),.5*Se(Ke(ZB,ZB,Gse))}new R0(Cp);new R0(()=>rJe());const ZB=C(),Gse=C();function oJe(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;te(e,0,0,0),te(ch,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,u=s[a+2]*i;te(ao,r[l],r[l+1],r[l+2]),te(zg,r[c],r[c+1],r[c+2]),te(rI,r[u],r[u+1],r[u+2]);const h=nJe(ao,zg,rI);h?(me(ao,ao,zg),me(ao,ao,rI),ie(ao,ao,1/3*h),me(e,e,ao),n+=h):(me(ch,ch,ao),me(ch,ch,zg),me(ch,ch,rI),o+=3)}return(o!==0||n!==0)&&(n!==0?(ie(e,e,1/n),!0):o!==0&&(ie(e,ch,1/o),!0))}function aJe(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;te(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&ie(e,e,1/o),o>0}function lJe(t,e,i){if(!t)return!1;te(i,0,0,0),te(ch,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const h=u<l?u+1:0,p=a[u<l?u:l]*n,f=a[h]*n;ao[0]=o[p],ao[1]=o[p+1],ao[2]=o[p+2],zg[0]=o[f],zg[1]=o[f+1],zg[2]=o[f+2],ie(ao,me(ao,ao,zg),.5);const g=P_(ao,zg);g>0?(me(i,i,ie(ao,ao,g)),r+=g):r===0&&(me(ch,ch,ao),s++)}return r!==0?(ie(i,i,1/r),!0):s!==0&&(ie(i,ch,1/s),!0)}const ao=C(),zg=C(),rI=C(),ch=C();let V4=class{constructor(e){this.channel=e,this.id=wu()}};function q9(t,e){return t==null&&(t=[]),t.push(e),t}function W9(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function cJe(t,e,i,r,s){sI[0]=t.get(e,0),sI[1]=t.get(e,1),sI[2]=t.get(e,2),V9(sI,qv,3),i.set(s,0,qv[0]),r.set(s,0,qv[1]),i.set(s,1,qv[2]),r.set(s,1,qv[3]),i.set(s,2,qv[4]),r.set(s,2,qv[5])}const sI=C(),qv=new Float32Array(6);let rn=class Axe extends T${constructor(e,i,r=null,s=ws.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:Qf(l.indices)}),a===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new Axe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:iJe(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===ws.Mesh?this._computeAttachmentOriginTriangles(e):this.type===ws.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Ve(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(O.POSITION);return oJe(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(O.POSITION);return lJe(i,uJe(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(O.POSITION);return aJe(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(O.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===ws.Mesh?3:1;at(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=px(e.indices.length/i);return new Cxe(r,i,e)}get transformation(){return this._transformation??Cr}set transformation(e){this._transformation=e&&e!==Cr?pC(e):null}addHighlight(){const e=new V4(_0.Highlight);return this.highlights=q9(this.highlights,e),e}removeHighlight(e){this.highlights=W9(this.highlights,e)}};function uJe(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const jx=H9,JB=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],hJe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],dJe=[0,0,1,0,1,1,0,1],pJe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],Mxe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)Mxe[6*t+e]=t;const ib=new Array(36);for(let t=0;t<6;t++)ib[6*t]=0,ib[6*t+1]=1,ib[6*t+2]=2,ib[6*t+3]=2,ib[6*t+4]=3,ib[6*t+5]=0;function fJe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=JB[r][0]*e[0],i[3*r+1]=JB[r][1]*e[1],i[3*r+2]=JB[r][2]*e[2];return new rn(t,[[O.POSITION,new Ze(i,pJe,3,!0)],[O.NORMAL,new Ze(hJe,Mxe,3)],[O.UV0,new Ze(dJe,ib,2)]])}const QB=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],mJe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],gJe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],yJe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function _Je(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=QB[r][0]*e[0],i[3*r+1]=QB[r][1]*e[1],i[3*r+2]=QB[r][2]*e[2];return new rn(t,[[O.POSITION,new Ze(i,gJe,3,!0)],[O.NORMAL,new Ze(mJe,yJe,3)]])}const fN=pr(-.5,0,-.5),mN=pr(.5,0,-.5),gN=pr(0,0,.5),yN=pr(0,.5,0),Hx=yc(),qx=yc(),M2=yc(),P2=yc(),O2=yc();_e(Hx,fN,yN),_e(qx,fN,mN),Ke(M2,Hx,qx),fe(M2,M2),_e(Hx,mN,yN),_e(qx,mN,gN),Ke(P2,Hx,qx),fe(P2,P2),_e(Hx,gN,yN),_e(qx,gN,fN),Ke(O2,Hx,qx),fe(O2,O2);const KB=[fN,mN,gN,yN],vJe=[0,-1,0,M2[0],M2[1],M2[2],P2[0],P2[1],P2[2],O2[0],O2[1],O2[2]],bJe=[0,1,2,3,1,0,3,2,1,3,0,2],wJe=[0,0,0,1,1,1,2,2,2,3,3,3];function xJe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=KB[r][0]*e[0],i[3*r+1]=KB[r][1]*e[1],i[3*r+2]=KB[r][2]*e[2];return new rn(t,[[O.POSITION,new Ze(i,bJe,3,!0)],[O.NORMAL,new Ze(vJe,wJe,3)]])}function ADt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),h=(c+1)*(u+1),p=os(3*h),f=os(3*h),g=os(2*h),_=[];let v=0;for(let T=0;T<=u;T++){const S=[],A=T/u,P=a+A*l,R=Math.cos(P);for(let F=0;F<=c;F++){const k=F/c,N=n+k*o,j=Math.cos(N)*R,z=Math.sin(P),X=-Math.sin(N)*R;p[3*v]=j*e,p[3*v+1]=z*e,p[3*v+2]=X*e,f[3*v]=j,f[3*v+1]=z,f[3*v+2]=X,g[2*v]=k,g[2*v+1]=A,S.push(v),++v}_.push(S)}const b=new Array;for(let T=0;T<u;T++)for(let S=0;S<c;S++){const A=_[T][S],P=_[T][S+1],R=_[T+1][S+1],F=_[T+1][S];T===0?(b.push(A),b.push(R),b.push(F)):T===u-1?(b.push(A),b.push(P),b.push(R)):(b.push(A),b.push(P),b.push(R),b.push(R),b.push(F),b.push(A))}const w=[[O.POSITION,new Ze(p,b,3,!0)],[O.NORMAL,new Ze(f,b,3,!0)]];return s.uv&&w.push([O.UV0,new Ze(g,b,2,!0)]),s.offset&&(w[0][0]=O.OFFSET,w.push([O.POSITION,new Ze(Float64Array.from(s.offset),wv(b.length),3,!0)])),new rn(t,w)}function TJe(t,e,i,r){const s=Pxe(e,i,r);return new rn(t,s)}function Pxe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)jx.scale(s,c,t/jx.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const h=c.toString()+"."+u.toString();if(o[h])return o[h];let p=s.length;return s.length+=3,jx.add(s,3*c,s,3*u,s,p),jx.scale(s,p,t/jx.length(s,p)),p/=3,o[h]=p,p}for(let c=0;c<e;c++){const u=n.length,h=new Array(4*u);for(let p=0;p<u;p+=3){const f=n[p],g=n[p+1],_=n[p+2],v=a(f,g),b=a(g,_),w=a(_,f),T=4*p;h[T]=f,h[T+1]=v,h[T+2]=w,h[T+3]=g,h[T+4]=b,h[T+5]=v,h[T+6]=_,h[T+7]=w,h[T+8]=b,h[T+9]=v,h[T+10]=b,h[T+11]=w}n=h,o={}}const l=Vse(s);for(let c=0;c<l.length;c+=3)jx.normalize(l,c);return[[O.POSITION,new Ze(Vse(s),n,3,!0)],[O.NORMAL,new Ze(l,n,3,!0)]]}function Y9(t,e,i,r,s,n,o,a,l=null){const c=i?Kr(i):C(),u=e?Kr(e):Ce(0,0,1);o??(o=it());const h=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],f=wv(1),g=[[O.POSITION,new Ze(c,f,3,!0)],[O.NORMAL,new Ze(u,f,3,!0)],[O.UV0,new Ze(o,f,o.length)],[O.COLOR,new Ze(h,f,4,!0)],[O.SIZE,new Ze(p,f,2)]];if(n!=null&&(n=[n[0],n[1],n[2],n[3]],g.push([O.CENTEROFFSETANDDISTANCE,new Ze(n,f,4)])),a){const _=[a[0],a[1],a[2],a[3]];g.push([O.FEATUREATTRIBUTE,new Ze(_,f,4)])}return new rn(t,g,null,ws.Point,l)}const SJe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function MDt(t,e=SJe){const i=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)i[3*c+u]=e[c][u];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,new Ze(i,r,3,!0)],[O.NORMAL,new Ze(s,n,3,!0)],[O.UV0,new Ze(o,r,2,!0)],[O.COLOR,new Ze(a,n,4,!0)]];return new rn(t,l)}function jse(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let u=pr(0,a,0),h=pr(0,a+c,0),p=pr(0,-1,0),f=pr(0,1,0);s&&(a=c,h=pr(0,0,0),u=pr(0,a,0),p=pr(0,1,0),f=pr(0,-1,0));const g=[h,u],_=[p,f],v=r+2,b=Math.sqrt(c*c+l*l);if(s)for(let R=r-1;R>=0;R--){const F=R*(2*Math.PI/r),k=pr(Math.cos(F)*l,a,Math.sin(F)*l);g.push(k);const N=pr(c*Math.cos(F)/b,-l/b,c*Math.sin(F)/b);_.push(N)}else for(let R=0;R<r;R++){const F=R*(2*Math.PI/r),k=pr(Math.cos(F)*l,a,Math.sin(F)*l);g.push(k);const N=pr(c*Math.cos(F)/b,l/b,c*Math.sin(F)/b);_.push(N)}const w=new Array,T=new Array;if(n){for(let R=3;R<g.length;R++)w.push(1),w.push(R-1),w.push(R),T.push(0),T.push(0),T.push(0);w.push(g.length-1),w.push(2),w.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let R=3;R<g.length;R++)w.push(R),w.push(R-1),w.push(0),T.push(R),T.push(R-1),T.push(1);w.push(0),w.push(2),w.push(g.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=os(3*v);for(let R=0;R<v;R++)S[3*R]=g[R][0],S[3*R+1]=g[R][1],S[3*R+2]=g[R][2];const A=os(3*v);for(let R=0;R<v;R++)A[3*R]=_[R][0],A[3*R+1]=_[R][1],A[3*R+2]=_[R][2];const P=[[O.POSITION,new Ze(S,w,3,!0)],[O.NORMAL,new Ze(A,T,3,!0)]];return new rn(t,P)}function CJe(t,e,i,r,s,n,o){const a=s?D9(s):pr(1,0,0),l=n?D9(n):pr(0,0,0);o??(o=!0);const c=yc();fe(c,a);const u=yc();ie(u,c,Math.abs(e));const h=yc();ie(h,u,-.5),me(h,h,l);const p=pr(0,1,0);Math.abs(1-pe(c,p))<.2&&te(p,0,0,1);const f=yc();Ke(f,c,p),fe(f,f),Ke(p,f,c);const g=2*r+(o?2:0),_=r+(o?2:0),v=os(3*g),b=os(3*_),w=os(2*g),T=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(v[3*(g-2)]=h[0],v[3*(g-2)+1]=h[1],v[3*(g-2)+2]=h[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(_-2)]=-c[0],b[3*(_-2)+1]=-c[1],b[3*(_-2)+2]=-c[2],b[3*(_-1)]=c[0],b[3*(_-1)+1]=c[1],b[3*(_-1)+2]=c[2]);const A=(N,j,z)=>{T[N]=j,S[N]=z};let P=0;const R=yc(),F=yc();for(let N=0;N<r;N++){const j=N*(2*Math.PI/r);ie(R,p,Math.sin(j)),ie(F,f,Math.cos(j)),me(R,R,F),b[3*N]=R[0],b[3*N+1]=R[1],b[3*N+2]=R[2],ie(R,R,i),me(R,R,h),v[3*N]=R[0],v[3*N+1]=R[1],v[3*N+2]=R[2],w[2*N]=N/r,w[2*N+1]=0,v[3*(N+r)]=v[3*N]+u[0],v[3*(N+r)+1]=v[3*N+1]+u[1],v[3*(N+r)+2]=v[3*N+2]+u[2],w[2*(N+r)]=N/r,w[2*N+1]=1;const z=(N+1)%r;A(P++,N,N),A(P++,N+r,N),A(P++,z,z),A(P++,z,z),A(P++,N+r,N),A(P++,z+r,z)}if(o){for(let N=0;N<r;N++){const j=(N+1)%r;A(P++,g-2,_-2),A(P++,N,_-2),A(P++,j,_-2)}for(let N=0;N<r;N++){const j=(N+1)%r;A(P++,N+r,_-1),A(P++,g-1,_-1),A(P++,j+r,_-1)}}const k=[[O.POSITION,new Ze(v,T,3,!0)],[O.NORMAL,new Ze(b,S,3,!0)],[O.UV0,new Ze(w,T,2,!0)]];return new rn(t,k)}function PDt(t,e,i,r,s,n){r=r||10,s=s==null||s,at(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const u=c/r*2*Math.PI;l.push([Math.cos(u)*i,Math.sin(u)*i])}return EJe(t,l,e,o,a,s,n)}function EJe(t,e,i,r,s,n,o=pr(0,0,0)){const a=e.length,l=os(i.length*a*3+(6*r.length||0)),c=os(i.length*a*3+(r?6:0)),u=new Array,h=new Array;let p=0,f=0;const g=C(),_=C(),v=C(),b=C(),w=C(),T=C(),S=C(),A=C(),P=C(),R=C(),F=C(),k=C(),N=C(),j=Ui();te(P,0,1,0),_e(_,i[1],i[0]),fe(_,_),n?(me(A,i[0],o),fe(v,A)):te(v,0,0,1),G4(_,v,P,P,w,v,Hse),ae(b,v),ae(k,w);for(let D=0;D<r.length;D++)ie(T,w,r[D][0]),ie(A,v,r[D][2]),me(T,T,A),me(T,T,i[0]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];c[f++]=-_[0],c[f++]=-_[1],c[f++]=-_[2];for(let D=0;D<s.length;D++)u.push(s[D][0]>0?s[D][0]:-s[D][0]-1+r.length),u.push(s[D][1]>0?s[D][1]:-s[D][1]-1+r.length),u.push(s[D][2]>0?s[D][2]:-s[D][2]-1+r.length),h.push(0),h.push(0),h.push(0);let z=r.length;const X=r.length-1;for(let D=0;D<i.length;D++){let G=!1;D>0&&(ae(g,_),D<i.length-1?(_e(_,i[D+1],i[D]),fe(_,_)):G=!0,me(R,g,_),fe(R,R),me(F,i[D-1],b),a$(i[D],R,j),fx(j,Ou(F,g),A)?(_e(A,A,i[D]),fe(v,A),Ke(w,R,v),fe(w,w)):G4(R,b,k,P,w,v,Hse),ae(b,v),ae(k,w)),n&&(me(A,i[D],o),fe(N,A));for(let H=0;H<a;H++)if(ie(T,w,e[H][0]),ie(A,v,e[H][1]),me(T,T,A),fe(S,T),c[f++]=S[0],c[f++]=S[1],c[f++]=S[2],me(T,T,i[D]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2],!G){const J=(H+1)%a;u.push(z+H),u.push(z+a+H),u.push(z+J),u.push(z+J),u.push(z+a+H),u.push(z+a+J);for(let Q=0;Q<6;Q++){const ee=u.length-6;h.push(u[ee+Q]-X)}}z+=a}const q=i[i.length-1];for(let D=0;D<r.length;D++)ie(T,w,r[D][0]),ie(A,v,r[D][1]),me(T,T,A),me(T,T,q),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];const Z=f/3;c[f++]=_[0],c[f++]=_[1],c[f++]=_[2];const ce=z-a;for(let D=0;D<s.length;D++)u.push(s[D][0]>=0?z+s[D][0]:-s[D][0]-1+ce),u.push(s[D][2]>=0?z+s[D][2]:-s[D][2]-1+ce),u.push(s[D][1]>=0?z+s[D][1]:-s[D][1]-1+ce),h.push(Z),h.push(Z),h.push(Z);const I=[[O.POSITION,new Ze(l,u,3,!0)],[O.NORMAL,new Ze(c,h,3,!0)]];return new rn(t,I)}function ODt(t,e,i,r){at(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),at(e[0].length===3,"createPolylineGeometry(): malformed vertex"),at(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),at(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=jn(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[O.POSITION,new Ze(s,n,3,!0)]];if(i){const c=os(3*i.length);let u=0;for(let h=0;h<e.length;h++)for(let p=0;p<3;p++)c[u++]=i[h][p];l.push([O.NORMAL,new Ze(c,n,3,!0)])}return r&&l.push([O.COLOR,new Ze(r,px(r.length/4),4)]),new rn(t,l,null,ws.Line)}function RDt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new rn(t,[[O.POSITION,new Ze(o,l,3,!0)]])}function $Dt(t,e){const i=t.getMutableAttribute(O.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];te(Wx,s,n,o),Ve(Wx,Wx,e),i[r]=Wx[0],i[r+1]=Wx[1],i[r+2]=Wx[2]}}function AJe(t,e=t){const i=t.attributes,r=i.get(O.POSITION).data,s=i.get(O.NORMAL).data;if(s){const n=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function eV(t,e,i,r,s){return!(Math.abs(pe(e,t))>s)&&(Ke(i,t,e),fe(i,i),Ke(r,i,t),fe(r,r),!0)}function G4(t,e,i,r,s,n,o){return eV(t,e,s,n,o)||eV(t,i,s,n,o)||eV(t,r,s,n,o)}const Hse=.99619469809,Wx=C();let MJe=class{constructor(e,i){this.type=ha.Local,this._configuration=new KZ,this._passParameters=new eJ,this._configuration.geometry=mm.Cylinder,this._technique=i.techniques.acquire(z4,this._configuration);const r=i.renderContext.rctx;this._vao=PJe(r),this._vaoCount=Qg(this._vao,"geometry");const s=new $r;s.wrapMode=hi.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new ur(r,s,ZZe)}destroy(){this._passParameters.texture=Tt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);OJe(qse,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",qse),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(ui.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}};function PJe(t){const e=Pxe(1,2,!1),{data:i,indices:r}=e[0][1],s=Wse.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Pm(t,di,{geometry:Lc(Wse)},{geometry:lr.createVertex(t,Hi.STATIC_DRAW,s.buffer)})}function OJe(t,e){tn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const qse=xe(),Wse=cs().vec3f(O.POSITION),RJe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),nI=128,Yse=-A9,Xse=0,tV=50,$Je=()=>1-511/512,IJe=YD([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let LJe=class{constructor(e,i){this.view=e,this.type=ha.Mars,this._passParameters=new eJ,this._vaoCount=0,this._texV1=1;const r=er(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Yse)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Xse)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Xse/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=i.techniques;const s=i.renderContext.rctx;this._cameraChangeHandle=he(()=>this.view.state?.camera,()=>i.requestRender(),qi),this._vao=this._createRibbon(s),this._vaoCount=Qg(this._vao,"geometry"),this._fadeVao=Om(s),this._fadeVaoCount=Qg(this._fadeVao,"geometry");const n=new $r;n.wrapMode=hi.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new ur(s,n,RJe);const o=new KZ;o.geometry=mm.Cone,this._coneTechnique=this._techniques.acquire(z4,o),o.geometry=mm.Underground,this._undergroundTechnique=this._techniques.acquire(z4,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Tt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(ui.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(ui.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=C(),r=this._planetRadius,s=Se(e.eye),n=s-r;if(n<0){const f=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=f}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(tV,n),a=r+Yse;this._passParameters.innerScale=DJe(r+o,r,a)-1,this._passParameters.altitudeFade=kZ(n),ie(i,e.eye,(r+tV)/s),Zse(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=$Je(),u=IJe(n);let h=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>tV){Zse(e.eye,e.center,e.up,r,this._passParameters.silhouette);const f=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=Te((f-1.5)/(l-1.5),0,1);h=this._texV0+g*c*this._texVScale,p=this._texV0+Et(this._texV1,l*u,g)*this._texVScale}bi(this._passParameters.texV,h,p)}_createRibbon(e){const i=os(3+3*nI*3),r=new Uint32Array(3*nI*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<nI;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===nI-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const s=Jse.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Pm(e,di,{geometry:Lc(Jse)},{geometry:lr.createVertex(e,Hi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return me(Yx,s.center,s.v2),ie(oI,Yx,this._outerRimFactor),Gk(iV,i,Yx,r),yse(Yx,iV,e.projectionMatrix,e.viewport,Yx),yse(oI,iV,e.projectionMatrix,e.viewport,oI),hr(Yx,oI)/e.height}};function Zse(t,e,i,r,s){const n=Se(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return ie(s.center,t,a/n),Ke(l,t,e),xa(l)<1&&Ke(l,t,i),ie(l,l,o/Se(l)),Ke(c,l,t),ie(c,c,o/Se(c)),o}const iV=xe(),Yx=C(),oI=C();function DJe(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const Jse=cs().vec3f(O.POSITION);var b0;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(b0||(b0={}));let X9=class extends ol{constructor(){super(...arguments),this.type=b0.Rain}};d([B({count:b0.COUNT})],X9.prototype,"type",void 0);function NJe(t){const e=new Pi;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Rt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new Rt("offset",(i,r)=>FJe(i,r))),e.vertex.uniforms.add(new Ue("width",i=>i.width)),e.vertex.uniforms.add(new Gr("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new Gr("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new Ue("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===b0.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ue("opacity",i=>i.opacity),new Rt("particleColor",(i,r)=>kJe(r,t))),e.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===b0.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function FJe(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=qfe(Z9,te(Z9,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return yi(n,i,ie(n,n,t.width))}function kJe(t,e){const i=e.type===b0.Rain?zJe:UJe,r=ie(Z9,i,BJe),s=t.camera.eye;fe(Qse,s);const n=Math.max(0,pe(Qse,t.lighting.mainLight.direction));return or(r,r,i,n)}const Z9=C(),Qse=C(),UJe=Ce(1,1,1),zJe=Ce(.85,.85,.85),BJe=.7,VJe=Object.freeze(Object.defineProperty({__proto__:null,build:NJe},Symbol.toStringTag,{value:"Module"}));let GJe=class extends xr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},J9=class Oxe extends Ni{initializeProgram(e){return new Fi(e.rctx,Oxe.shader.get().build(this.configuration),j4)}initializePipeline(){return Lt({blending:Fo(Ee.ONE,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:tr.LEQUAL},colorWrite:qt})}};J9.shader=new Oi(VJe,()=>ue(()=>import("./Precipitation.glsl-2414e9e8.js"),[],import.meta.url));const j4=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let Rxe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},jJe=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},jM=class extends Pe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new GJe,this._animation=new Rxe,this._passParameters.time=0,this._passParameters.radius=er(e.view.spatialReference).radius,this._techniques=e.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=Xt(this._snowTechniqueCached),this._rainTechniqueCached=Xt(this._rainTechniqueCached),this._vao=Tt(this._vao),this._instanceIdBuffer=Tt(this._instanceIdBuffer)}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new X9;e.type=b0.Rain,this._rainTechniqueCached=this._techniques.acquire(J9,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new X9;e.type=b0.Snow,this._snowTechniqueCached=this._techniques.acquire(J9,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Et(0,o,2*i):Et(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*nY(this._animation.time)%1e5;const a=n.bindTechnique(s,e.bindParameters,this._passParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),VZ(n,j4,this._instanceIdBuffer,Kse,0),n.drawArraysInstanced(ui.TRIANGLES,0,3,this._numParticles*i),Owe(n,j4,this._instanceIdBuffer,Kse)}_ensureResources(e){this._vao==null&&(this._vao=HJe(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return lr.createVertex(e,Hi.STATIC_DRAW,new Float32Array(i))}};function HJe(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Pm(t,j4,{geometry:Lc(qJe)},{geometry:lr.createVertex(t,Hi.STATIC_DRAW,e)})}d([m({constructOnly:!0})],jM.prototype,"context",void 0),d([m({constructOnly:!0})],jM.prototype,"view",void 0),jM=d([U("esri.views.3d.environment.Precipitation")],jM);const qJe=cs().vec3f(O.POSITION),Kse=Lc(cs().f32(O.INSTANCEFEATUREATTRIBUTE),1);function WJe(){const t=new Pi;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Gr("transform",(e,i)=>YJe(e,i)),new Ei("viewport",(e,i)=>i.camera.fullViewport),new Ue("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(x`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function YJe(t,e){return tn(iy,e.camera.projectionMatrix),iy[10]=24e-8-1,iy[11]=-1,iy[14]=(24e-8-2)*e.camera.near,Ai(iy,iy,e.camera.viewMatrix),Ai(iy,iy,t.modelMatrix)}const iy=xe(),XJe=Object.freeze(Object.defineProperty({__proto__:null,build:WJe},Symbol.toStringTag,{value:"Module"}));let ZJe=class extends xr{constructor(){super(...arguments),this.modelMatrix=xe()}},$xe=class Ixe extends Ni{constructor(e){super(e,new ol,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,Ixe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:tr.LEQUAL},colorWrite:qt})}};$xe.shader=new Oi(XJe,()=>ue(()=>import("./Stars.glsl-67fc43f5.js"),[],import.meta.url));let Hy=class extends Pe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new ZJe,this._updatingTracking=new Xg}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=il(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Xt(this._technique),this._vao=Tt(this._vao),Wv=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(ui.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Wv==null)return;this._technique=new $xe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Wv.byteLength/Lxe;const i=new Float32Array(Wv,0,2*this._numPoints),r=new Uint8Array(Wv,2*this._numPoints*4,this._numPoints);this._vao=JJe(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Ki)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*QJe(e),s=tn(this._passParameters.modelMatrix,sQe);nC(s,s,-r*Math.PI),Ai(s,rQe,s),nC(s,s,-i*Math.PI),this.requestRender()}_createLoadDataTask(){if(Wv!=null)return null;const e=Tm(async i=>{const{data:r}=await qIe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});KJe(r),Wv=r});return e.promise.catch(i=>{sn(i)||le.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}};function JJe(t,e,i,r){const s=ene.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],u=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(u)),n.set(l,1,-Math.sin(c)*Math.sin(u)),n.set(l,2,-Math.cos(u));const h=tQe(i[l]),p=eQe(iQe[h[1]]);o.set(l,0,255*p[0]),o.set(l,1,255*p[1]),o.set(l,2,255*p[2]),o.set(l,3,255),a.set(l,h[0])}return new Pm(t,di,{geometry:Lc(ene)},{geometry:lr.createVertex(t,Hi.STATIC_DRAW,s.buffer)})}function QJe(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function KJe(t){if(!t)throw new W("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/Lxe;if(e%1!=0||e>5e4||e<5e3)throw new W("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function eQe(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}function tQe(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}d([m({constructOnly:!0})],Hy.prototype,"view",void 0),d([m({constructOnly:!0})],Hy.prototype,"requestRender",void 0),d([m({readOnly:!0})],Hy.prototype,"updating",null),d([m()],Hy.prototype,"_loadDataTask",void 0),d([m()],Hy.prototype,"_updatingTracking",void 0),Hy=d([U("esri.views.3d.environment.Stars")],Hy);const iQe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],rQe=BX(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),sQe=BX(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Lxe=9,ene=cs().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let Wv=null;const VU={required:[]},tJ={required:[V.Depth]};let GU=class extends Pe{consumes(){return VU}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},iJ=class extends GU{},Dxe=class extends GU{constructor(){super(...arguments),this.drapedPriority=0}},nQe=class extends GU{},oQe=class extends GU{};function Q9(t){return"prepareTechnique"in t}function tne(t){return"prepareTechniques"in t}var R2;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(R2||(R2={}));let Bo=class extends iJ{constructor(e){super(e),this.produces=new Map([[ye.OPAQUE_ENVIRONMENT,()=>!(this._atmosphere===null&&this._stars===null)],[ye.TRANSPARENT_ENVIRONMENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new rV,this._newWeatherParameters=new rV,this._fadedWeatherParameters=new rV,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:ha.None}consumes(){return this._atmosphereType===ha.Realistic?tJ:VU}updateAnimation(e){return this._precipitation!=null&&this._precipitation.update(e)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Se(this.view.state.camera.eye)-er(this.view.spatialReference).radius<=Lg}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const e=this.view,i=e.environment?.starsEnabled??!1,r=this._get("_stars");return i&&this._context!=null?r??new Hy({view:e,requestRender:()=>this._setNeedsRender()}):(Oe(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Oe(e),null;const i=this.view,r=this._context;return e!=null&&e.context===r?e:(Oe(e),new jM({context:r,view:i}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Oe(e),null;if(e!=null)return e;const i=this.view,r=this._context;return Oe(e),new xl({context:r,view:i,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Oe(e),null;const i=this.view.state.viewingMode,r=this._context.renderContext.rctx,s=er(this.view.spatialReference).radius;return e!=null&&e.viewingMode===i&&e.planetRadius===s?e:(Oe(e),new eb({rctx:r,viewingMode:i,planetRadius:s,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Oe(e),null;if(e!=null)return e;const i=this.view,r=this._context,s=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new tb({context:r,view:i,rctx:s,viewingMode:n})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const i=()=>this._setNeedsRender();this.addHandles([he(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),qi),he(()=>this._stars,i),he(()=>this._precipitation,i),he(()=>this._clouds,()=>this._updateWeather(),Ki),he(()=>this._fog,()=>this._updateFogHaze(),Ki),he(()=>this.view.state.mode,()=>this._setNeedsRender(),Ji),he(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},qi)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Oe(this._atmosphere),this._set("_stars",Oe(this._stars)),this._set("_precipitation",Oe(this._precipitation)),this._set("_clouds",Oe(this._clouds)),this._set("_cloudsComposition",Oe(this._cloudsComposition)),this._set("_fog",Oe(this._fog))}prepareRender(e){e.bindParameters.cloudsFade.data=MXe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&e.bindParameters.cloudsFade.data?.cubeMap!=null&&(this._updateWeatherFading(e.bindParameters,e.time),e.bindParameters.cloudsFade.renderingStage===Vf.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}renderNode(e){switch(e.bindParameters.slot){case ye.OPAQUE_ENVIRONMENT:this._stars?.render(e),this.atmosphere!=null&&(this.atmosphere.render(e,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._cloudsComposition&&e.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),e.bindParameters.cloudsFade.isFading&&this._context&&e.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case ye.TRANSPARENT_ENVIRONMENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(e,this._weatherParameters.fog),this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}updateLightSources(e,i,r,s){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=i,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(e),s===R2.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return e==null?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e,i){e.cloudsFade.updateFading(e.camera,this.view.state.mode,i,this.view.qualitySettings.fadeDuration),e.cloudsFade.updateParallax(e.camera),e.weatherFading&&(aQe(e),this._updateFogAtmoshpere(e))}_updateFogAtmoshpere(e){e.cloudsFade.fadeMode!==Mr.CROSS_FADE&&e.cloudsFade.fadeMode!==Mr.FADE_IN?this._fadeWeather(0):this._fadeWeather(e.cloudsFade.fadeFactor)}_fadeWeather(e){const{_newWeatherParameters:i,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=i:(this._fadedWeatherParameters.lerp(r,i,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;e!=null&&this._clouds!=null&&(this._clouds.applyPreset(ua[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(this._fog==null||e==null||this._context==null)return;const i=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Et(3e-5,.005,e.weatherAdjustment**3),ae(this._newWeatherParameters.fog.color,ine),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Et(4e-6,2e-4,(e.effect??0)**3),ae(this._newWeatherParameters.fog.color,lQe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Et(4e-6,2e-4,(e.effect??0)**3),ae(this._newWeatherParameters.fog.color,ine),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}i.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const i=this._selectAtmosphereType(e);if(i!==ha.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==i){this._atmosphere=Oe(this._atmosphere);const r=this._getAtmosphereClass(i);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Oe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case ha.Realistic:return EXe;case ha.Local:return MJe;case ha.Mars:return LJe;default:case ha.None:return null}}_selectAtmosphereType(e){const{enabled:i,viewingMode:r}=e;return!i||tx(this.view.spatialReference)?ha.None:r===Ne.Local?ha.Local:this._context!=null&&Sw(this.view.spatialReference)?ha.Realistic:ex(this.view.spatialReference)?ha.Mars:ha.None}get test(){}};d([m({constructOnly:!0})],Bo.prototype,"view",void 0),d([m({readOnly:!0})],Bo.prototype,"atmosphere",null),d([m({readOnly:!0})],Bo.prototype,"_atmosphereType",null),d([m({type:Boolean,readOnly:!0})],Bo.prototype,"updating",null),d([m({readOnly:!0})],Bo.prototype,"weatherVisible",null),d([m()],Bo.prototype,"_context",void 0),d([m()],Bo.prototype,"_atmosphere",void 0),d([m({readOnly:!0})],Bo.prototype,"_stars",null),d([m({readOnly:!0})],Bo.prototype,"_precipitation",null),d([m({readOnly:!0})],Bo.prototype,"_clouds",null),d([m({readOnly:!0})],Bo.prototype,"_cloudsComposition",null),d([m({readOnly:!0})],Bo.prototype,"_fog",null),d([m({readOnly:!0})],Bo.prototype,"weatherEnabled",null),d([m({readOnly:!0})],Bo.prototype,"_precipitationEnabled",null),d([m({readOnly:!0})],Bo.prototype,"_weatherUpdateParameters",null),Bo=d([U("esri.views.3d.environment.EnvironmentRenderer")],Bo);let rV=class{constructor(){this.fog=new BZe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ae(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Et(e.fog.amount,i.fog.amount,r),this.hazeAmount=Et(e.hazeAmount,i.hazeAmount,r),this.fog.strength=Et(e.fog.strength,i.fog.strength,r),or(this.fog.color,e.fog.color,i.fog.color,r)}};function aQe(t){t.cloudsFade.fadeMode!==Mr.CROSS_FADE&&t.cloudsFade.fadeMode!==Mr.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}const lQe=Ce(.5,.5,.5),ine=Ce(1.5,1.5,1.5);var rne,sne,nne,Nxe={exports:{}};rne=Nxe,sne=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function p(I){return I.valueOf()/l-.5+c}function f(I){return new Date((I+.5-c)*l)}function g(I){return p(I)-u}var _=23.4397*a;function v(I,D){return n(e(I)*i(_)-r(D)*e(_),i(I))}function b(I,D){return s(e(D)*i(_)+i(D)*e(_)*e(I))}function w(I,D,G){return n(e(I),i(I)*e(D)-r(G)*i(D))}function T(I,D,G){return s(e(D)*e(G)+i(D)*i(G)*i(I))}function S(I,D){return a*(280.16+360.9856235*I)-D}function A(I){return a*(357.5291+.98560028*I)}function P(I){return a*(1.9148*e(I)+.02*e(2*I)+3e-4*e(3*I))}function R(I,D){return I+D+102.9372*a+t}function F(I,D){var G=A(I),H=R(G,P(G));return D||(D={dec:0,ra:0}),D.dec=b(H,0),D.ra=v(H,0),D}var k={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(I,D,G,H){var J=a*-G,Q=a*D,ee=g(I),de=F(ee,h),we=S(ee,J)-de.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=w(we,Q,de.dec),H.altitude=T(we,Q,de.dec),H}},N=[[-.83,"sunrise","sunset"]];k.addTime=function(I,D,G){N.push([I,D,G])};var j=9e-4;function z(I,D){return Math.round(I-j-D/(2*t))}function X(I,D,G){return j+(I+D)/(2*t)+G}function q(I,D,G){return u+I+.0053*e(D)-.0069*e(2*G)}function Z(I,D,G){return o((e(I)-e(D)*e(G))/(i(D)*i(G)))}function ce(I){var D=a*(134.963+13.064993*I),G=a*(93.272+13.22935*I),H=a*(218.316+13.176396*I)+6.289*a*e(D),J=5.128*a*e(G),Q=385001-20905*i(D);return{ra:v(H,J),dec:b(H,J),dist:Q}}return k.getTimes=function(I,D,G){var H=a*-G,J=a*D,Q=z(g(I),H),ee=X(0,H,Q),de=A(ee),we=P(de),Re=R(de,we),tt=b(Re,0),Ye=q(ee,de,Re);function qe($e){return q(X(Z($e,J,tt),H,Q),de,Re)}function He($e){var _t=(e($e)-e(J)*e(tt))/(i(J)*i(tt));return _t<-1?k.PolarException.MIDNIGHT_SUN:_t>1?k.PolarException.POLAR_NIGHT:k.PolarException.NORMAL}var je,Jt,Wt,Le,Dt,De={solarNoon:f(Ye),nadir:f(Ye-.5),polarException:k.PolarException.NORMAL};for(je=0,Jt=N.length;je<Jt;je+=1)Dt=Ye-((Le=qe((Wt=N[je])[0]*a))-Ye),De[Wt[1]]=f(Dt),De[Wt[2]]=f(Le);return De.polarException=He(N[0][0]*a),De},k.getMoonPosition=function(I,D,G){var H=a*-G,J=a*D,Q=g(I),ee=ce(Q),de=S(Q,H)-ee.ra,we=T(de,J,ee.dec);return we+=.017*a/r(we+10.26*a/(we+5.1*a)),{azimuth:w(de,J,ee.dec),altitude:we,distance:ee.dist}},k.getMoonFraction=function(I){var D=g(I),G=F(D),H=ce(D),J=149598e3,Q=o(e(G.dec)*e(H.dec)+i(G.dec)*i(H.dec)*i(G.ra-H.ra)),ee=n(J*e(Q),H.dist-J*i(Q));return(1+i(ee))/2},k},(nne=sne())!==void 0&&(rne.exports=nne);const Hw=o$(Nxe.exports),Ya={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let aI=class{constructor(e,i){this.direct=e,this.ambient=i}};function cQe(t,e,i,r,s,n){te(n.ambient.color,1,1,1),n.ambient.intensity=Ya.global.ambient,te(n.direct.color,1,1,1),n.direct.intensity=Ya.global.direct;const o=e[2],a=Te((Math.abs(o)-Ya.local.altitude)/(Ya.global.altitude-Ya.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Hw.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=gQe(t,l,r);else{const u=Uxe(r);c={direct:{intensity:Ya.local.directAtNoon*u.direct,color:Ce(1,1,1)},ambient:{intensity:Ya.local.ambientAtNoon*u.ambient,color:Ce(1,1,1)},timeOfDay:"early afternoon"}}or(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Et(c.ambient.intensity,n.ambient.intensity,a),or(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Et(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?mQe(t,l):1,t!=null?uQe(t,e,i,n.direct.directionToLightSource):Fxe(s,i,n.direct.directionToLightSource)}function Fxe(t,e,i){e===Ne.Global?fe(aV,t.eye):te(aV,0,0,1),ie(lV,t.viewForward,-1);const r=f4(lV,aV),s=Math.max(r-2*cV,0),n=.85*s/(s+1),o=Math.max(cV,r-cV-n);Bl(gne,-o,t.viewRight),Ve(i,lV,gne),me(i,i,ie(yQe,t.viewRight,_Qe)),fe(i,i)}function uQe(t,e,i,r){const s=fQe,n=Ih(pQe);if(i===Ne.Global)Hw.getPosition(t,0,0,s),te(r,0,0,-1),sC(n,n,-s.azimuth),Bk(n,n,-s.altitude),Ve(r,r,n);else{const o=Ya.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Te(c,0,1),c<1?(Hw.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),te(r,0,-1,0),nC(n,n,-s.azimuth),sC(n,n,-s.altitude),Ve(r,r,n)}}function hQe(t,e){if(e===Ne.Global)return!0;const i=Ya.planarDirection;return Math.abs(t)<i.localAltitude}const dQe=Ce(.5773502691896258,-.5773502691896258,.5773502691896258);let kxe=class{constructor(){this.ambient={color:Ce(1,1,1),intensity:.55},this.direct={color:Ce(1,1,1),intensity:.55,directionToLightSource:Kr(dQe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const pQe=xe(),fQe={azimuth:0,altitude:0};function mQe(t,e){const i=t.valueOf();let r,s;e.polarException===Hw.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===Hw.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Te(Math.abs(i-n)/432e5,0,1)}function Uxe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new aI(1,1);case"rainy":return new aI(.4,1.2);case"snowy":return new aI(.5,1.3);case"foggy":return new aI(.2,1.6)}}function one(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const sV=Ce(.01,.01,.01),K9=Ce(1,.6,.5),e7=Ce(1,.98,.98),ane=Ce(1,1,1),nV=Ce(.8,.8,1),t7=Ce(.8,.8,1),i7=Ce(.98,.98,1),lne=Ce(1,1,1),oV=ci(.01,Ya.local.ambientAtNight),r7=ci(Ya.local.directAtTwilight,Ya.local.ambientAtTwilight),s7=ci(.9*Ya.local.directAtNoon,Ya.local.ambientAtNoon),cne=ci(Ya.local.directAtNoon,Ya.local.ambientAtNoon),une=s7,hne=e7,dne=i7,pne=r7,fne=K9,mne=t7;function gQe(t,e,i){const r=t.valueOf();let s,n;e.polarException===Hw.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Hw.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,p=s-h/2,f=s+h/2,g=n-h/2,_=n+h/2,v=it(),b=C(),w=C();let T="";if(r<p||r>_)ta(v,oV),ae(b,sV),ae(w,nV),T="night";else if(r<f){const P=(r-p)/(f-p);gh(v,oV,r7,P),or(b,sV,K9,P),or(w,nV,t7,P),T="sun rising"}else if(r<c){const P=(r-f)/(c-f);gh(v,r7,s7,P),or(b,K9,e7,P),or(w,t7,i7,P),T="early morning"}else if(r<a){const P=(r-c)/(a-c);gh(v,s7,cne,P),or(b,e7,ane,P),or(w,i7,lne,P),T="late morning"}else if(r<u){const P=(r-a)/(u-a);gh(v,cne,une,P),or(b,ane,hne,P),or(w,lne,dne,P),T="early afternoon"}else if(r<g){const P=(r-u)/(g-u);gh(v,une,pne,P),or(b,hne,fne,P),or(w,dne,mne,P),T="late afternoon"}else if(r<_){const P=(r-g)/(_-g);gh(v,pne,oV,P),or(b,fne,sV,P),or(w,mne,nV,P),T="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(one(b,S),one(w,S));const A=Uxe(i);return{direct:{intensity:v[0]*A.direct,color:b},ambient:{intensity:v[1]*A.ambient,color:w},timeOfDay:T}}const gne=xe(),aV=C(),lV=C(),yQe=C(),cV=.25,_Qe=.2;function zxe(t){return Sw(t)?c0(t)||cp(t)||G2(t)||$O(t)?u6e:t:qs(t)}var im;function JDt(t){return vQe(t,im.Horizontal)}function vQe(t,e){const{hasZ:i,spatialReference:r}=t,s=zxe(r);let n=0;const o=Afe(s);if(o==null)return null;const a=e===im.Direct?Bxe:Vxe;for(const l of t.paths){if(l.length<2)continue;const c=l.length-1;for(let u=0;u<c;++u){const h=l[u];po[0]=h[0],po[1]=h[1],po[2]=i?h[2]:0;const p=l[u+1];fo[0]=p[0],fo[1]=p[1],fo[2]=i?p[2]:0;const f=a(po,fo,r);if(f==null)return null;n+=f.value}}return Zg(n,o)}function QDt(t,e){const{spatialReference:i}=t;return ls(i,e.spatialReference)?(po[0]=t.x,po[1]=t.y,po[2]=t.hasZ?t.z:0,fo[0]=e.x,fo[1]=e.y,fo[2]=e.hasZ?e.z:0,xQe(po,fo,i)):null}function bQe(t,e){const{spatialReference:i}=t;return ls(i,e.spatialReference)?(po[0]=t.x,po[1]=t.y,po[2]=t.hasZ?t.z:0,fo[0]=e.x,fo[1]=e.y,fo[2]=e.hasZ?e.z:0,Bxe(po,fo,i)):null}function KDt(t,e){const{spatialReference:i}=t;return ls(i,e.spatialReference)?(po[0]=t.x,po[1]=t.y,po[2]=t.hasZ?t.z:0,fo[0]=e.x,fo[1]=e.y,fo[2]=e.hasZ?e.z:0,Vxe(po,fo,i)):null}function eNt(t,e){const{spatialReference:i}=t;return ls(i,e.spatialReference)?(po[0]=t.x,po[1]=t.y,po[2]=t.hasZ?t.z:0,fo[0]=e.x,fo[1]=e.y,fo[2]=e.hasZ?e.z:0,TQe(po,fo,i)):null}function tNt(t){return t!=null?wQe(t.hasZ?t.z:0,t.spatialReference):null}function wQe(t,e){const i=Mfe(e);return i!=null?Zg(t??0,i):null}function xQe(t,e,i){const r=jU(t,e,i);return r!=null?{direct:Zg(r.direct,r.unit),horizontal:Zg(r.horizontal,r.unit),vertical:Zg(r.vertical,r.unit)}:null}function Bxe(t,e,i){const r=jU(t,e,i,im.Direct);return r!=null?Zg(r.direct,r.unit):null}function Vxe(t,e,i){const r=jU(t,e,i,im.Horizontal);return r!=null?Zg(r.horizontal,r.unit):null}function TQe(t,e,i){const r=jU(t,e,i,im.Vertical);return r!=null?Zg(r.verticalSigned,r.unit):null}function jU(t,e,i,r){const s=zxe(i),n=Afe(s);if(n==null)return null;const o=e[2]-t[2];if(r===im.Vertical)return{verticalSigned:o,unit:n};if(!_o(t,i,uV,s)||!_o(e,i,lI,s))return null;if(r===im.Direct)return{direct:hr(lI,uV),unit:n};if(te(cI,t[0],t[1],e[2]),!_o(cI,i,cI,s))return null;const a=hr(cI,lI);return r===im.Horizontal?{horizontal:a,unit:n}:{direct:hr(lI,uV),horizontal:a,vertical:Math.abs(o),unit:n}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(im||(im={}));const po=C(),fo=C(),uV=C(),lI=C(),cI=C();let yd=class extends Ls.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new k4,this._ambientLight=new JZ,this._moonLight=new oxe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Ne.Global&&Sw(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(e){if(this._renderer)return;this._renderer=new Bo({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([he(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Ji),he(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Ji),he(()=>e.stationary,()=>this._interactingStationaryHandler()),he(()=>e.environment.lighting.directShadowsEnabled,i,Ji),he(()=>e.qualitySettings.ambientOcclusion,i,Ji),he(()=>e.qualitySettings.reflections,i,Ji),he(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Ji),he(()=>e.environment.weather.type,()=>this._updateLighting(null,R2.Faded),Ji),he(()=>this.weatherEnabled,()=>this._updateLighting(null,R2.Faded),Ji),he(()=>e.viewingMode,()=>this._resetReferencePosition(!0),qi),he(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),qi),he(()=>e.state.camera,r,qi),he(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Oe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Vl(r,We.WGS84)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePositionGeographic!=null){const s=Hre(this._referencePositionGeographic,yne);s!=null&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=Sw(this._view.spatialReference);if(r&&!Vl(this._view.spatialReference,We.WGS84))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePositionGeographic??(this._referencePositionGeographic=C()),r?ts(s,this._referencePositionGeographic,We.WGS84):te(this._referencePositionGeographic,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=R2.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePositionGeographic,n=s?SQe:CQe,o=this.weatherVisible?r.environment.weather.type:"disabled";s!=null?cQe(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&Fxe(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ie(a.intensity,l.color,l.intensity*Math.PI),ae(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ie(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;or(u.intensity,AQe,MQe,n.globalFactor);const h=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ie(u.intensity,u.intensity,h),ae(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=EQe;r.setTime((i||this._view.environment.lighting.date).getTime());const s=Hre(e,yne);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||hQe(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=PO(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=PO(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?te(this._referencePositionGeographic,i[0],i[1],r):this._referencePositionGeographic=Ce(i[0],i[1],r),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(e){const i=this._referencePosMapCoords;if(i==null)return!0;const r=bQe(i,e);return r==null?!0:nYe(r,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){}};d([m({type:Boolean,readOnly:!0})],yd.prototype,"updating",null),d([m()],yd.prototype,"disableQueries",void 0),d([m()],yd.prototype,"_disableWeather",void 0),d([m()],yd.prototype,"weatherEnabled",null),d([m()],yd.prototype,"weatherVisible",null),d([m()],yd.prototype,"referencePositionGeographic",null),d([m()],yd.prototype,"_renderer",void 0),d([m()],yd.prototype,"_referencePositionGeographic",void 0),yd=d([U("esri.views.3d.environment.SceneViewEnvironmentManager")],yd);const SQe=new kxe,CQe=new kxe,EQe=new Date,yne={hours:0,minutes:0,seconds:0},AQe=Ce(.22,.22,.33),MQe=Ce(.22,.22,.22);var Ur;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ur||(Ur={}));var ii;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(ii||(ii={}));var gm;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(gm||(gm={}));let Bh=class{constructor(e=Ur.ALL,i=ii.NONE,r=0,s=null,n=null,o=gm.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function hR(t,e){return!!(t&e)}function H4(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const bx=new Bh(Ur.NONE);function Gxe(t,e,i,r){return e=e||t.viewForward,ae(r,e),ie(r,r,Math.sign(pe(e,i))),r}function PQe(t,e,i,r){return LQe(t,e,i,$Qe(r,e,i,!0))}function OQe(t,e,i,r){const s=pe(i,_e(t,r,e));return me(t,e,ie(t,i,s))}const RQe={dir:C(),len:0,clip:it()};function $Qe(t,e,i,r){const s=RQe;return t?(i&&r&&(s.len=hr(e,i)),ae(s.dir,t)):r?(s.len=hr(e,i),_e(s.dir,i,e),ie(s.dir,s.dir,1/s.len)):(_e(s.dir,i,e),fe(s.dir,s.dir)),s}function IQe(t,e,i){const r=pe(t,i.dir),s=-fr(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function LQe(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!IQe(t[s],e,r))return!1;return!0}function DQe(t,e,i=bx){const r=rJ(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=Gxe(e,i.interactionDirection,kQe(t,e,Math.sign(r),VQe),BQe),a=ae(GQe,e.viewForward),l=s.intersectInfiniteManifold(Ou(e.eye,o),n,hV);return e.eye=l??s.setAltitude(hV,n,e.eye),e.center=OQe(hV,e.eye,a,e.center),!0}function rJ(t,e,i=bx){if(!NQe(t,i)||!t.state.constraints.altitude)return 0;const r=UQe(t.state.constraints.altitude,zQe);FQe(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Te(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function NQe(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==ii.TUMBLE||!hR(e.selection,Ur.TILT))}function FQe(t,e,i){const r=e.interactionType;if(r===ii.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===ii.TUMBLE||r===ii.ZOOM,c=rJ(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,H4(c,u,l,a,.05*u,i)}function kQe(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),ie(r,r,i),r}function UQe(t,e){return e.min=t.min,e.max=t.max,e}const zQe={min:0,max:0},BQe=C(),VQe=C(),GQe=C(),hV=C();function sJ(t,e,i=bx){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;uI.min=0,uI.max=r,HQe(t,i,uI);const s=nJ(t,e),n=uI.max-s;return n>=-1e-6?0:n}function jQe(t,e,i=bx){const r=sJ(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=nJ(t,e)+r,o=ae(WQe,e.eye),a=Gxe(e,i.interactionDirection,qQe(e,s.renderLocation,ZQe),XQe);if(!xv(b1e(s.renderLocation,n),Ou(e.eye,a),hI))return!1;e.eye=hI;const l=_e(YQe,e.eye,o);e.center=me(hI,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,hI);return u!=null&&(e.center=u),!0}function HQe(t,e,i){const r=e.interactionType;if(r===ii.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===ii.ZOOM||r===ii.PAN,c=sJ(t,o),u=c===0?0:nJ(t,o);i.min=s,i.max=n,H4(c,u,l,a,.05*u,i)}function nJ(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?hr(e.eye,i.renderLocation):0}function qQe(t,e,i){return S0(i,t.eye,e)}const uI={min:0,max:0},WQe=C(),YQe=C(),XQe=C(),ZQe=C(),hI=C();function yE(t,e,i=Eh.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=$U(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Se(e.eye);if(_e(dI,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(JQe,o,e.eye),i===Eh.EYE_AND_CENTER)e.center=me(dI,e.eye,dI);else if(i===Eh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ie(dI,e.center,l)}return!0}var Eh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Eh||(Eh={}));const dI=C(),JQe=C();function lv(t,e,i){t.worldUpAtPosition(e,_ne),_e(dV,i,e);const r=Se(dV);return r===0?0:Zn(pe(dV,_ne)/r)}const _ne=C(),dV=C();function jxe(t,e,i,r=!0){nA.eyeCenterDistance=0,nA.requiresTwoSteps=!1;const s=oJ(t,e,i,bx,nA);if(s===0)return!1;switch(Bl(pI,-s,e.viewRight),i.tiltMode){case gm.LOOK_AROUND:Ve(ry,e.viewForward,pI),ie(ry,ry,nA.eyeCenterDistance),e.center=me(d_,e.eye,ry);break;case gm.TUMBLE:_e(ry,e.center,e.eye),Ve(ry,ry,pI),e.eye=_e(d_,e.center,ry);break;default:i.tiltMode}return e.up=Ve(d_,e.up,pI),!nA.requiresTwoSteps||!r||jxe(t,e,i,!1)}function oJ(t,e,i,r=bx,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,aKe);return oKe(t,i,o),r.interactionType===ii.TUMBLE&&hR(r.selection,Ur.ALTITUDE)&&Hxe(t,r.interactionStartCamera,o),i.tiltMode===gm.LOOK_AROUND||r.tiltMode===gm.LOOK_AROUND?KQe(t,e,o,s):QQe(t,e,o)}function QQe(t,e,i){const r=lv(t.renderCoordsHelper,e.center,e.eye),s=r-Te(r,i.min,i.max);return dR(s)?s:0}function KQe(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return tKe(t,e,i,r);case"local":return eKe(t,e,i,r)}}function eKe(t,e,i,r){const s=lv(t.renderCoordsHelper,e.center,e.eye),n=Te(s,i.min,i.max),o=s-n;if(!dR(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function tKe(t,e,i,r){const s=iKe(t,e,lKe),n=Te(s.tiltAtCenter,i.min,i.max);if(!dR(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=rKe(s),a=sKe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=nKe(s,o)),r&&(r.eyeCenterDistance=n7(s,o)),a}function iKe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+er(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,d_);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,n!=null?(i.eyeCenterDistance=hr(e.eye,n),i.tiltAtCenter=lv(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=lv(t.renderCoordsHelper,e.center,e.eye):(dE(CU(EU,s),e.ray,d_),i.eyeCenterDistance=hr(e.eye,d_),i.tiltAtCenter=Zn(-pe(e.viewForward,fe(d_,d_)))),i.radius=s,i.eyeRadius=Se(e.eye),i.constraints=t.state.constraints,i}function dR(t){return Math.abs(t)>1e-9}function rKe(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=n7(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&dR(n-s);){const l=(s+n)/2,c=n7(t,l);dR(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function n7(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Te(e,0,Math.PI),r=up(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function sKe(t,e){const i=up(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=up(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function nKe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function oKe(t,e,i){if(e.interactionType===ii.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=oJ(t,r,bx,e),l=a===0?0:lv(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===ii.TUMBLE?(hR(e.selection,Ur.ALTITUDE)&&Hxe(t,r,i),H4(a,l,!0,s,vne,i)):H4(a,l,!1,s,vne,i)}function Hxe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=xa(e.center),n=Math.sqrt(s),o=e.distance,a=er(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),h=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Zn(h),i.max)),i.max=Math.min(i.max,Math.PI-Zn(u))}const ry=C(),pI=xe(),d_=C(),vne=xt(5),aKe={min:0,max:0},lKe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},nA={eyeCenterDistance:0,requiresTwoSteps:!1},cKe=t=>t,HU=t=>t*t,aJ=t=>1-HU(1-t),uKe=t=>t<.5?HU(2*t)/2:(aJ(2*(t-.5))+1)/2,lJ=t=>t*t*t,qxe=t=>1-lJ(1-t),Wxe=t=>t<.5?lJ(2*t)/2:(qxe(2*(t-.5))+1)/2,cJ=t=>t*t*t*t,Yxe=t=>1-cJ(1-t),hKe=t=>t<.5?cJ(2*t)/2:(Yxe(2*(t-.5))+1)/2,uJ=t=>t*t*t*t*t,Xxe=t=>1-uJ(1-t),dKe=t=>t<.5?uJ(2*t)/2:(Xxe(2*(t-.5))+1)/2,hJ=t=>1-Math.cos(t*Math.PI/2),Zxe=t=>1-hJ(1-t),pKe=t=>t<.5?hJ(2*t)/2:(Zxe(2*(t-.5))+1)/2,dJ=t=>2**(10*(t-1)),S$=t=>1-dJ(1-t),fKe=t=>t<.5?dJ(2*t)/2:(S$(2*(t-.5))+1)/2,pJ=t=>-(Math.sqrt(1-t*t)-1),Jxe=t=>1-pJ(1-t),mKe=t=>t<.5?pJ(2*t)/2:(Jxe(2*(t-.5))+1)/2;function Vh(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Gh(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const gKe=Gh(Vh(1),1),yKe=Gh(Vh(1),0),o7=Gh(Vh(1),.5),_Ke=Gh(Vh(2),1),vKe=Gh(Vh(2),0),bKe=Gh(Vh(2),.5),wKe=Gh(Vh(3),1),xKe=Gh(Vh(3),0),TKe=Gh(Vh(3),.5),SKe=Gh(Vh(4),1),CKe=Gh(Vh(4),0),EKe=Gh(Vh(4),.5),AKe={linear:cKe,"in-quad":HU,"out-quad":aJ,"in-out-quad":uKe,"in-coast-quad":gKe,"out-coast-quad":yKe,"in-out-coast-quad":o7,"in-cubic":lJ,"out-cubic":qxe,"in-out-cubic":Wxe,"in-coast-cubic":_Ke,"out-coast-cubic":vKe,"in-out-coast-cubic":bKe,"in-quart":cJ,"out-quart":Yxe,"in-out-quart":hKe,"in-coast-quart":wKe,"out-coast-quart":xKe,"in-out-coast-quart":TKe,"in-quint":uJ,"out-quint":Xxe,"in-out-quint":dKe,"in-coast-quint":SKe,"out-coast-quint":CKe,"in-out-coast-quint":EKe,"in-sine":hJ,"out-sine":Zxe,"in-out-sine":pKe,"in-expo":dJ,"out-expo":S$,"in-out-expo":fKe,"in-circ":pJ,"out-circ":Jxe,"in-out-circ":mKe};function Gs(t,e,i=RKe,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<$Ke;a++){let l=0;for(const c of OKe)if(hR(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=u)}if(l===0)break}const n=hR(i.selection,Ur.COLLISION),o=MKe(i.interactionType,t);return n&&yE(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function MKe(t,e){switch(t){case ii.PAN:return Eh.EYE_AND_CENTER;case ii.ASCEND:return e.state.isGlobal?Eh.EYE_AND_CENTER_SCALE:Eh.EYE_AND_CENTER;default:return Eh.EYE}}function Dd(t){const e=Math.min(1,t/150);return Wxe(e)}function PKe(t,e,i){return oJ(t,e,i)*e.distance}const OKe=[{type:Ur.TILT,error:PKe,apply:jxe},{type:Ur.ALTITUDE,error:rJ,apply:DQe},{type:Ur.DISTANCE,error:sJ,apply:jQe}],RKe=new Bh,$Ke=5;let bne=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=C(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=Kr(wne),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===Ne.Global){const n=(Se(this.center)+Se(e.center))/2;i.pan=f4(this.center,e.center)*n}else i.pan=hr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===Ne.Global?CGe(e.center,i.center,r.pan,this.center):or(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?Et(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=Et(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=Et(s,n,r.rotate),this._fov=Et(e.fov,i.fov,r.fov)}copyFrom(e){ae(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ae(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,xne);ae(this.center,e.center),_e(zo,e.center,e.eye),On(zo,zo,i),On(ny,e.up,i),this._distance=Se(zo),this._distance!==0&&(zo[0]/=this._distance,zo[1]/=this._distance,zo[2]/=this._distance),this._pitch=this._eyeUpToPitch(zo),this._yaw=IKe(zo,ny),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,xne);mx(i,i),this._axisAngleVec3(_N,this._pitch-Math.PI/2,wne,zo),this._axisAngleVec3(Cb,this._yaw,zo,zo),this._axisAngleVec3(_N,this._pitch-Math.PI/2,Cb,ny),this._axisAngleVec3(Cb,this._yaw,ny,ny),ie(zo,zo,this._distance),On(zo,zo,i),On(ny,ny,i),e.center=this.center,e.eye=_e(zo,this.center,zo),e.up=ny,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return ie(kc,r,n),Ke(oc,e,r),ie(oc,oc,o),ie(sy,e,(1-n)*pe(e,r)),me(s,me(s,kc,oc),sy)}_lookAtOrientation(e,i=yr()){return this._upAtLookAt(e,sy),Ke(kc,this.direction,sy),fe(kc,kc),kc[0]===0&&kc[1]===0&&kc[2]===0&&ae(kc,_N),Ke(oc,sy,kc),fe(oc,oc),i[0]=kc[0],i[1]=oc[0],i[2]=sy[0],i[3]=kc[1],i[4]=oc[1],i[5]=sy[1],i[6]=kc[2],i[7]=oc[2],i[8]=sy[2],i}_upAtLookAt(e,i){return this.viewingMode===Ne.Local?ae(i,Cb):fe(i,e)}_eyeUpToPitch(e){return Math.PI-f4(Cb,e)}};function IKe(t,e){const i=LKe;return Math.abs(e[2])<.5?(ae(i,e),t[2]>0&&ie(i,i,-1)):ae(i,t),Ke(oc,i,Cb),fe(oc,oc),f4(_N,oc,Cb)}const kc=C(),oc=C(),sy=C(),zo=C(),ny=C(),LKe=C(),Cb=Y2,wne=TY,_N=xY,xne=yr();let DKe=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const q4={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let NKe=class Qxe{constructor(e){this._createCamera=e,this.compared=new DKe,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:q4.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Qxe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:q4.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>go()}get hasFov(){return Math.abs(this.compared.fov)>go()}get hasRotate(){return this.compared.rotate>go()}},FKe=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},kKe=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:u,targetZoom:h}=c.compared,p=i.zoom*(h-u)+u,f=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,_=Math.abs(h-f)>Math.abs(u-f)?h:u;i.zoomOffset=_-g,i.zoom=(p-f)/(_-f)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},pV=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/UKe:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const UKe=xt(90);function zKe(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function BKe(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function VKe(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function GKe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function jKe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function HKe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function qKe(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function WKe(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function YKe(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function XKe(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function ZKe(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function JKe(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function QKe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function KKe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function eet(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function tet(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function iet(t,e){let i=ret(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?GKe:zKe,a=s?jKe:BKe,l=s?HKe:VKe,c=n?QKe:XKe,u=n?KKe:ZKe,h=n?eet:JKe,p=S=>o(t,S,r)+qKe(t,S,r)+c(t,S,r),f=S=>a(t,S,r)+WKe(t,S,r)+u(t,S,r),g=S=>l(t,S,r)+YKe(t,S,r)+h(t,S,r);let _=p(i);const v=tet(t);let b;const w=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const S=e.desiredSlope??1e-6;let A=f(i);Math.abs(A)>S&&(A+=S);const P=A/g(i);if(isNaN(P)||i>=T&&P<0){if(!isFinite(T))return null;i=T,_=p(i);break}if(i-=P,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const R=p(i);if(Math.abs(R-_)/_<=.005)break;_=R}return _>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function ret(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let set=class extends kKe{constructor(e,i){super(),this._preallocSegments=[new pV,new pV,new pV],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i?.apex?iet(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=aJ(r.zoom):e===this._descensionSegment&&(r.zoom=HU(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const net=new FKe;let oet=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=o7,this.definition=new NKe(e),this.path=new set}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Ppe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?o7:S$)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,net);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??q4.minDuration/r,n=i.maxDuration??q4.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}},aet=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new oet(()=>new bne(e)),this._current=new bne(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=_e(cet,i.center,e.center),a=Se(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ae(s.direction,o),ae(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new br,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+Ppe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const cet=C();var Yr;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(Yr||(Yr={}));let Dg=class extends Pe{constructor(e){super(e),this.state=Yr.Ready}get active(){return this.state===Yr.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Yr.Stopped,!0)}finishController(){this.state=Yr.Finished}get steppingFinished(){return!1}};d([m({constructOnly:!0})],Dg.prototype,"view",void 0),d([m({readOnly:!0})],Dg.prototype,"active",null),d([m()],Dg.prototype,"state",void 0),d([m({readOnly:!0})],Dg.prototype,"isInteractive",null),Dg=d([U("esri.views.3d.state.controllers.CameraController")],Dg);let pR=class extends Dg{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(vi()),this._asyncResult=null),this.state===Yr.Finished||this.state===Yr.Stopped?(rk(e),this.state===Yr.Finished?e.resolve():e.reject(vi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Yr.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Yr.Ready&&this.state!==Yr.Running||(this.viewAnimation.state===EC.State.FINISHED?this.finish():this.viewAnimation.state===EC.State.STOPPED&&(this.state=Yr.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Yr.Finished?this.viewAnimation.finish():this.state===Yr.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Yr.Finished?this._asyncResult.resolve():this._asyncResult.reject(vi()))}finish(){this.finishController()}};pR=d([U("esri.views.3d.state.controllers.AnimationController")],pR);let jg=class extends pR{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new aet(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new EC}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);fI.copyFrom(this.view.state.camera);const s=Nh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(fI.ray,s,Tne)&&(fI.center=Tne),this.animation.update(fI,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?AKe[e.easing]:e.easing}}};d([m({constructOnly:!0})],jg.prototype,"mode",void 0),d([m({readOnly:!0})],jg.prototype,"isInteractive",null),jg=d([U("esri.views.3d.state.controllers.PointToPointAnimationController")],jg);const fI=new br,Tne=C();function qU(t=het){return[t[0],t[1],t[2],t[3]]}function fR(t,e){return uet(t[0],t[1],t[2],e,GX.get())}function uet(t,e,i,r,s=qU()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function fJ(t,e,i){return Ke(i,t,e),fe(i,i),i[3]=VX(t,e),i}const het=[0,0,1,0];function mNt(t,e,i=Gn()){return mJ(t,zd(e),i),fe(i.direction,i.direction),i}function mJ(t,e,i){return det(t,t.screenToRender(e,ze.get()),i)}function det(t,e,i){const r=ta(ze.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=ta(ze.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,ze.get());return n==null?null:(_e(i.direction,n,i.origin),i)}function _E(t,e,i){return gJ(t,t.screenToRender(e,ze.get()),i)}function gJ(t,e,i){ae(i.origin,t.eye);const r=te(ze.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,ze.get());return s==null?null:(_e(i.direction,s,i.origin),i)}function yJ(t,e,i,r){const s=_E(e,i,pet);return xv(t,s,r)}const pet=Gn();var OC;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(OC||(OC={}));const Kxe=30,W4=[1,3e8],WU=80,eTe=8,tTe=200,iTe=1508e5,rTe=5,sTe=50,fet=5,met=10,fV=90,wx={exclude:new Set([nv])};function hw(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function a7(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function cv(t,e,i){const r=Bl(jX.get(),i[3],i);r==null||jk(r,Cr)||(_e(nr,t.eye,e),Ve(nr,nr,r),t.eye=me(nr,nr,e),_e(nr,t.center,e),Ve(nr,nr,r),t.center=me(nr,nr,e),t.up=Ve(nr,t.up,r))}function get(t,e,i,r){return fx(t,mJ(e,i,bJ),r)}function l7(t,e,i,r){return fx(t,_E(e,i,bJ),r)}function _J(t,e,i,r){const s=ze.get();let n=1-i;_e(s,e,t.eye);const o=Se(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ie(s,s,n),t.eye=me(nr,t.eye,s),t.center=or(nr,t.center,e,n))}function nTe(t,e,i){e.getScreenCenter(Sne),yJ(t,e,Sne,nr)&&(e.center=nr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=ie(ze.get(),e.viewForward,s);e.eye=_e(nr,e.center,n)}const Sne=ns();function mV(t,e){te(e,0,0,0);for(const i of t)me(e,e,i);ie(e,e,1/t.length)}function vN(t,e,i,r){return Math.sin(t/Se(e))*(i+r.radius)}function Cne(t,e,i,r){return vN(Math.PI/2,e,i,r)+(t-Math.PI/2)}var Xo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Xo||(Xo={}));const Ene={Elevation:3e4,Angle:xt(16)},mI={Pole:.95,Angle:xt(18),Tilt:45},oTe=xt(80);function aTe(t,e,i,r,s,n){const o=C(),a=Ws();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=Se(o):(c=!1,e.aboveGround&&s!==OC.Ellipsoid?a[3]=Math.max(Se(e.center),.9*r.radius):a[3]=Se(e.eye)-e.relativeElevation,s===OC.Silhouette?mR(a,e,i,o):l=yJ(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function C$(t,e,i,r){const s=t.relativeElevation;if(s>Ene.Elevation&&r==="global")return Xo.Horizontal;_E(t,e,yV);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,nr);return-n*pe(o,yV.direction)<Math.sin(Ene.Angle)*Se(yV.direction)?Xo.Vertical:Xo.Horizontal}function lTe(t,e,i){_e(gV,i,e),t.eye=_e(nr,t.eye,gV),t.center=_e(nr,t.center,gV)}const gV=C();function mR(t,e,i,r){const s=_E(e,i,bJ);return s!=null&&(dE(t,s,gI),xv(t,s,r)?!(Wn(gI,s.origin)<Wn(r,s.origin))||(ae(r,gI),!1):(_e(Xx,e.eye,e.center),fe(Xx,Xx),Y_e(Xx,-pe(fe(Xx,Xx),gI),Ane),fx(Ane,s,r),!1))}const gI=C(),Xx=C(),Ane=Ui();function cTe(t,e,i,r,s,n){let o=0;if(Ke(Z4,t,e),_e(bI,t,e),Se(t)<=s||!r.aboveGround){Ke(i,bI,r.eye);const a=pe(t,e)/(Se(t)*Se(e));if(a<.9999)o=Zn(a);else{const c=Se(Ke(C(),t,e))/(Se(t)*Se(e));o=up(c)}const l=Math.cos(Te(J_.normalize(xt(n)),0,oTe));o=-o-Math.max(0,Se(e)-s)/(l*s)}else _e(Mne,r.eye,r.center),Ke(i,bI,Mne),o=-Se(bI)/s;return fe(i,i),ie(i,i,Se(Z4)),o}const Mne=C();function Pne(t,e,i,r){let s,n;const o=Math.cos(Te(J_.normalize(xt(r)),0,oTe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Zn(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Zn(t/i),(n-s)*i}function yet(t,e,i,r,s,n,o,a,l,c){const u=Pne(t[2],e[2],n[3],a),h=l?Pne(t[0],e[0],n[3],180):e[0]-t[0],p=Math.sin(o)*h-Math.cos(o)*u,f=Math.cos(o)*h+Math.sin(o)*u;fe(nr,s);const g=l?p/Math.sqrt(Math.abs(n[3]**2-pe(i,nr)**2)):p/n[3],_=f/Math.sqrt(Math.abs(n[3]**2-pe(i,r)**2));bi(c,g,_)}function uTe(t,e,i,r,s,n,o,a,l,c){Ke(Z4,t,e),Wq(n.up,n.eye,yI,_I,vI),Wq([0,0,1],n.eye,e0,U_,fTe),ae(i,U_),ae(r,e0),fe(i,i),ie(i,i,Se(Z4)),yre(t,fe(_I,_I),fe(vI,vI),fe(yI,yI),One),yre(e,_I,vI,yI,Rne),yet(One,Rne,t,e0,U_,o,a,l,c,s)}function _et(t,e,i,r,s,n,o){Bl(Y4,s,r),Bl(X4,o,n),Ai(jS,Y4,X4),_e(e,t,i),Ve(e,e,jS),me(e,e,i)}function hTe(t,e,i,r,s,n){Bl(Y4,r,i),Bl(X4,n,s),Ai(jS,Y4,X4),_e(nr,t.eye,e),Ve(nr,nr,jS),t.eye=me(nr,nr,e),_e(nr,t.center,e),Ve(nr,nr,jS),t.center=me(nr,nr,e),_e(nr,t.up,e),Ve(nr,nr,jS),t.up=me(nr,nr,e)}function vJ(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-mI.Angle||Math.abs(r)<mI.Angle)&&(Math.abs(t[2])<i*mI.Pole||Math.abs(e)>i)&&n.aboveGround&&s<mI.Tilt}function dTe(t,e,i,r,s,n){if(n)fJ(i,r,$ne),cv(e,t,$ne);else{const o=cTe(i,r,Ine,e,t[3],s);cv(e,t,fR(Ine,o))}}function pTe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,u;ae(Yv,r),wI.copyFrom(e);for(let h=0;h<a&&Wn(i,Yv)>l&&(c=Wn(i,Yv),uTe(i,Yv,U_,e0,oA,wI,t,s,n,o),hTe(wI,t,e0,oA[1],U_,oA[0]),_et(Yv,Yv,t,e0,oA[1],U_,oA[0]),u=Wn(i,Yv),u<c||h===0);h++)e.copyFrom(wI)}function vet(t,e,i,r,s,n,o){vJ(i,pe(e.up,i),t[3],-J_.normalize(xt(s)),n,e)?pTe(t,e,i,r,-J_.normalize(xt(s)),n,o):dTe(t,e,i,r,n,o)}function bet(t,e,i,r,s,n){const{eye:o}=t;Wq([0,0,1],o,e0,U_,fTe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-pe(t.center,e0)**2/Se(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,h=-Math.cos(n)*l+Math.sin(n)*a;switch(Sc(r.pan.matrix,r.pan.matrix,u,e0),r.pan.enabled=!0,s.mode){case"pan":Sc(r.pan.matrix,r.pan.matrix,h,U_),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function wet(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=Ke(ze.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(Sc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Sc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function xet(t,e,i,r,s,n,o,a,l){vJ(t.center,pe(t.up,t.center),Se(t.center),-J_.normalize(xt(n)),o,e)?bet(e,i,r,a,l,-J_.normalize(xt(s))):wet(e,i,r,a,l)}const e0=C(),U_=C(),fTe=C(),yI=C(),_I=C(),vI=C(),One=C(),Rne=C(),oA=it(),$ne=qU(),Y4=xe(),X4=xe(),jS=xe(),Yv=C(),nr=C(),bI=C(),wI=new br,Z4=C(),Ine=C(),bJ={origin:C(),direction:C()},yV={origin:C(),direction:C()},Lne=.6,_V=4,Tet=60;let J4=class extends jg{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new br,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._beginCamera=new br,this._constraintOptions=new Bh(Ur.ALL_EXCEPT_COLLISION,ii.ZOOM,null,this._beginCamera),this._sphere=Ws()}initialize(){this._intersector=Nh(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?wx:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ae(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:S$}}_updateCamera(e,i,r,s,n){const o=C$(e,s,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z);fe(TI,e.eye),ie(TI,TI,-1),_E(e,s,this._tmpRayDir),fe(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Te(Math.min(eTe,1/Math.abs(pe(TI,this._tmpRayDir.direction)))*a,tTe,iTe);if(o===Xo.Horizontal){let c=Lne**i;this._sphere[3]=Se(r),_e(this._tmpViewDir,e.center,e.eye);const u=Math.min(Se(this._tmpViewDir),l);let h=u*c;if(c<=1&&h<_V&&(h=_V,c=h/u),Math.abs(u-h)<1e-6)return;const p=Se(e.center);if(this._sphere[3]!==p){const f=this._sphere[3]+c*(p-this._sphere[3]);e.center=ie(xI,e.center,f/p)}ie(this._tmpViewDir,this._tmpViewDir,-c),e.eye=me(xI,e.center,this._tmpViewDir),Gs(this.view,e,this._constraintOptions),Wn(r,e.center)>1e-12&&yJ(this._sphere,e,s,this._targetOnSphere)&&vet(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Lne**Math.abs(i);const u=i>0?1:-1;_e(this._tmpViewDir,r,e.eye);const h=Se(this._tmpViewDir),p=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,Tet);let f=p??l;f=n&&i>0?Math.min(f,h):f,ie(this._tmpRayDir.direction,this._tmpRayDir.direction,f),me(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=f*c;const _=Math.max(_V,1.01*e.nearFar[0]);if(i>0&&g<_&&(g=_,c=g/f),Math.abs(f-g)<1e-6)return;ie(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-c)),e.eye=me(xI,e.eye,this._tmpRayDir.direction),e.center=me(xI,e.center,this._tmpRayDir.direction)}yE(this.view,e)}};J4=d([U("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],J4);const xI=C(),TI=C();let bN,wN=null;const $2=new Map;async function yNt(t){wN==null&&(bN==null&&(bN=ue(()=>import("./VoxelWasmPerSceneView-f49b6dd3.js"),[],import.meta.url)),wN=await bN);const e=t.view;let i=$2.get(e);return i||(i=new wN.default({view:e}),$2.set(e,i)),i.addVoxelLayer(t)}function gR(t){return $2.get(t)}function _Nt(t){const e=t.view,i=$2.get(e);i&&i.removeVoxelLayer(t)<1&&($2.delete(e),$2.size===0&&(bN=null,wN=null))}const Cet=.6,Eet=4,Aet=60;let Q4=class extends jg{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new br,this._tmpRayDir=C(),this._tmpCenter=C(),this._beginCamera=new br,this._constraintOptions=new Bh(Ur.ALL,ii.ZOOM,null,this._beginCamera)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=Nh(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?wx:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ae(this._zoomLocation,this._tmpCamera.center);const o=Cet**e;let a=this.view._stage.renderView.getMinimalDepthForArea(gR(this.view),i[0],i[1],this.view.state.camera,Aet);_e(SI,this._tmpCamera.eye,this._zoomLocation),fe(SI,SI);const l=Te(Math.min(eTe,1/Math.abs(pe(Met,SI)))*Math.abs(this.view.camera.position.z),tTe,iTe);if(a=a??l,a){const c=C();_e(c,this._zoomLocation,this._tmpCamera.eye),(a<Se(c)||!n)&&(fe(c,c),me(this._zoomLocation,this._tmpCamera.eye,ie(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:S$}}_updateCamera(e,i,r){_e(this._tmpRayDir,r,e.eye);const s=Se(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(Eet,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,i),e.eye=_e(Dne,r,this._tmpRayDir),e.center=or(Dne,e.center,r,1-i),Gs(this.view,e,this._constraintOptions)))}};Q4=d([U("esri.views.3d.state.controllers.ZoomStepControllerLocal")],Q4);const Dne=C(),Met=Ce(0,0,1),SI=C();function Pet(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function wJ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let Oet=class extends ko{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Pet(i,"primary")){const r=this._view.state.isGlobal?new J4({view:this._view,mode:"animation"}):new Q4({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),ns(i.x,i.y)),e.stopPropagation()}}};function Ret(t,e,i){return t===Ne.Global?new Iet(i):new $et(e,i)}let $et=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=er(i),this._unitInMeters=sl(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new Qi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},h=Math.max(u.x,u.y,u.z);_e(Xv,i,e),Zx[0]=Xv[0]>0?r.xmax:r.xmin,Zx[1]=Xv[1]>0?r.ymax:r.ymin,Zx[2]=Xv[2]>0?h/2:-h/2,_e(Zx,Zx,e),fe(Xv,Xv);const p=1.1*pe(Zx,Xv)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=g*Net*this._unitInMeters,v=g*Fet*this._unitInMeters,b=Te((o-v)/(_-v),0,1)**3,w=Math.min(Et(f,p,b),f)*Math.max(Math.log(Math.abs(l)),1);return mTe(Math.min(w,Math.max(34064e4,h))/this._unitInMeters,Let,this._unitInMeters,n)}},Iet=class{constructor(e){this._referenceEllipsoid=er(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=Se(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),h=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return mTe(1.2*Et(h,p,kZ(u)),Te(2e4-(Math.log(u)-7.983)/9.011*19900,100,2e4),1,n)}};function mTe(t,e,i,r){const s=Det/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const Let=2e4,Det=2,Net=.001,Fet=1e-4,Zx=C(),Xv=C();let xN=class extends Pe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&abe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>yE(this.view,e,Eh.EYE_AND_CENTER))}};d([m({constructOnly:!0})],xN.prototype,"view",void 0),xN=d([U("esri.views.3d.state.SurfaceCollisionConstraint")],xN);let HM=class extends Pe{constructor(e){super(e),this.nearFarHeuristic=Ret(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([he(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),he(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),he(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Ji),he(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Ji),he(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Ji),he(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Ji),he(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Ji),he(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Ji)]),this.view.state.isLocal&&this.addHandles(he(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Ki)),this._updateNearFar(),this.view.state.viewingMode!==Ne.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new xN({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>Nne(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Nne(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,$U(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Ur.COLLISION);const s=this.view.constraints&&this.view.constraints.tilt;s&&s.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ne.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(xt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(ea(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=Ur.ALL){this.view.state.updateCamera(i=>Gs(this.view,i,new Bh(e,ii.NONE,null)))}};function Nne(t,e){e&&(t.near=e.near,t.far=e.far)}d([m({constructOnly:!0})],HM.prototype,"view",void 0),d([m({readOnly:!0})],HM.prototype,"surfaceCollisionConstraint",void 0),HM=d([U("esri.views.3d.state.ConstraintsManager")],HM);let E_=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=uR(),this._points=Kwe(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:C(),endpoint:null}}update(e){exe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ae(this._origin,e.eye),ae(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ae(this._points[i],e[i]);txe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return C_(this.frustum,e)}intersectsRay(e){return aZe(this.frustum,e)}intersectsLineSegment(e,i){return lZe(this.frustum,e,i)}intersectsPoint(e){return ixe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;vV(this.lines[i],e[i],e[r]),vV(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),vV(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function vV(t,e,i){t.origin=e,t.endpoint=i,S0(t.direction,e,i)}E_.planePointIndices=cZe,E_.nearFarLineIndices=[[ot.NEAR_BOTTOM_LEFT,ot.FAR_BOTTOM_LEFT],[ot.NEAR_BOTTOM_RIGHT,ot.FAR_BOTTOM_RIGHT],[ot.NEAR_TOP_RIGHT,ot.FAR_TOP_RIGHT],[ot.NEAR_TOP_LEFT,ot.FAR_TOP_LEFT]];let tO=class extends Dg{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Yr.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||abe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),yE(this.view,e,Eh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Yr.Stopped)})}};d([m({constructOnly:!0})],tO.prototype,"desiredCamera",null),tO=d([U("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],tO);const ket=.66;function gTe(t){return 360-CX.normalize(t)}function YU(t){return CX.normalize(360-t)}function yTe(t,e,i){const r=e.camera;if(r!=null)return Uet(r,Cv(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=vTe(t,e.rotation,i);if(s.type==="point")return Bet(t,e,s,n,o);const a=s.extent;return a==null?null:tN(t,a,n.heading,n.tilt,o)}async function _Te(t,e,i,r){const s=e.camera;if(s!=null)return zet(s,Cv(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=vTe(t,e.rotation,i);if(n.type==="point")return Vet(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return Lbe(t,l,o.heading,o.tilt,a,r)}function Uet(t,e){const i=t.position;let r;try{r=ev(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function zet(t,e,i){const r=t.position,s=await tv(r,e,{signal:i});yt(i);const n=t.clone();return n.position=s.clone(),n}function vTe(t,e,i){const r=CC(t,t.state.camera);let s=Qo.ADJUST;return e!=null&&(r.heading=gTe(e),s=Qo.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function Bet(t,e,i,r,s){const n=t.spatialReference;let o;try{o=ev(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?IU(t,e.scale,o.latitude):t.state.camera.distance;return S7e(t,o,a,r,s)}async function Vet(t,e,i,r,s,n){const o=t.spatialReference,a=await tv(i.clone(),o,{signal:n});yt(n);const l=e.scale!=null?IU(t,e.scale,a.latitude):t.state.camera.distance;return Tbe(t,a,l,r,s,n)}function bTe(t,e,i=null){return i==null&&(i=new mp),TJ(t,null,e.clone(),i)}async function wTe(t,e,i){const r=Qet(t,e);if(!r)throw new W("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Pu({fov:t.camera.fov}),n=new mp({camera:s});if(r.target instanceof mp)return Zv(await Het(t,r.target,r,i,n));if(r.target instanceof Pu)return Zv(await TTe(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof Qi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Zv(o||c?await c7(t,r,r.target.center,s,i,n):await Xet(t,r,r.target,s,i,n))}const a=new ett,l=o?Get(t,r):void 0;if(await xTe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(qd(a.boundingBox,$s),ou.x=$s[0],ou.y=$s[1],ou.z=$s[2],ou.spatialReference=t.spatialReference,isFinite(ou.z)&&a.hasZ?c=sX(a.boundingBox):(ou.z=void 0,c=PDe(rX(a.boundingBox,ttt))),o||c)return Zv(await c7(t,r,ou,s,i,n));const u=Ket(t,a.screenSpaceObjects);return Zv(await Jet(t,r,ou,a.boundingBox,u,s,i,n))}return r.position?Zv(await Wet(t,r,s,n,i)):Zv(await Yet(t,r,s,i,n))}function xJ(t,e){return e.scale==null&&e.zoom!=null?Ube(t,e.zoom):e.scale}function Get(t,e){const i=xJ(t,e);return i?Z8e(i):void 0}function XU(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=gTe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function TJ(t,e,i,r){const s=t.spatialReference||We.WGS84;if(e??(e=Ag(t,i)),e==null)return r;const n=new Xe({spatialReference:s});if(!Sv(e.center,t.renderSpatialReference,n))return r;r.targetGeometry=n;const{latitude:o}=n;return r.scale=o!=null?ov(t,e.distance,o):zbe(t,e),r.rotation=YU(i.heading),r.camera=i,r}async function K4(t,e,i,r){const s=()=>new W("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let h;switch(e.type){case"point":h=e;break;case"multipoint":case"polyline":h=e.extent?.center;break;case"extent":h=e.center;break;case"polygon":h=e.centroid}h!=null&&n&&t.elevationProvider?(h=await tv(h,n,{signal:r}),$s[2]=Bf(t.elevationProvider,h)??0):$s[2]=0}const o=itt[e.type],a=new Array;if(o(e,e.hasZ?h=>{a.push([h[0],h[1],h[2]])}:h=>{a.push([h[0],h[1]])},$s),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,u=await tv(new JC({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[h,p,f]of u.points)$s[0]=h,$s[1]=p,$s[2]=f,pp(i.boundingBox,$s);else for(const[h,p]of u.points)$s[0]=h,$s[1]=p,pp(i.boundingBox,$s)}async function jet(t,e,i,r,s){const n=await fp(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await K4(t,e.geometry,r,s);const o=n.value,a=await fp(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await K4(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;eC(r.boundingBox,c),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(c[2])&&(r.hasZ=!0)}async function xTe(t,e,i,r,s){if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return ou.x=n,ou.y=o,ou.z=void 0,ou.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:We.WGS84,void await K4(t,ou,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(n=>xTe(t,n,i,r,s))):e instanceof T0?await K4(t,e,r,s):e instanceof X_&&await jet(t,e,i,r,s)}async function Het(t,e,i,r,s){if(e.camera)return TTe(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=YU(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=xJ(t,i);return n!=null&&(s.scale=n),s.camera=await _Te(t,s,i.tilt,r),s}async function TTe(t,e,i,r){const s=t.spatialReference,n=await tv(e.position,s,{signal:i}),o=e.clone();return o.position=n,TJ(t,null,o,r)}async function qet(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await _4(e,bV,a,0,{signal:o}),await _4(i,EI,a,0,{signal:o}),n.targetGeometry=new Xe(e),s.position=new Xe(i),_e(e5,bV,EI),LU(t,EI,e5,r.up,s),n.scale=ov(t,hr(EI,bV),n.targetGeometry.latitude),n.rotation=YU(s.heading),n.camera=s,n}async function c7(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=vx(t);if(e.position)return qet(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ie($s,o.viewForward,-l);o.eye=me($s,o.center,c),n.scale=ov(t,l,i.latitude)}CC(t,o,r);const a=XU(r,e)?Qo.LOCKED:Qo.ADJUST;if(!e.zoomFactor){const l=xJ(t,e);l==null?(await _4(i,$s,t.renderSpatialReference,0,{signal:s}),ixe(o.frustum,$s)?n.scale=ov(t,hr(o.eye,$s),i.latitude):n.scale=zbe(t,o)):n.scale=l,n.camera=await xbe(t,n.targetGeometry,n.scale,r,a,s)}return n}async function Wet(t,e,i,r,s){const n=vx(t);ae(e5,n.viewForward),LU(t,n.eye,e5,n.up,wV);const o=t.spatialReference,{position:a}=e;if(a){const l=await tv(a,o,{signal:s});i.position=l}else i.position=new Xe;return i.heading=e.heading!=null?e.heading:wV.heading,i.tilt=e.tilt!=null?e.tilt:wV.tilt,TJ(t,null,i,r)}async function Yet(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=vx(t),{spatialReference:o,renderSpatialReference:a}=t,l=new Xe({spatialReference:o});return Sv(n.center,a,l)?c7(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),XU(s.camera,e),s}async function Xet(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=vx(t);CC(t,o,r);const a=XU(r,e)?Qo.LOCKED:Qo.ADJUST;return n.camera=await Lbe(t,i,r.heading,r.tilt,a,s),n}function Zet(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Bf(t.elevationProvider,i)),te($s,i.x,i.y,n),Io(t.spatialReference,$s,Fne,t.renderSpatialReference),$u(CI,Fne),mx(CI,CI),Or(aA);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let v=r[_[2]];isFinite(v)||(v=n),te($s,r[_[0]],r[_[1]],v),_o($s,t.spatialReference,$s,t.renderSpatialReference),pp(aA,On($s,$s,CI))}const a=sx(aA),l=yv(aA),c=nx(aA),u=1/Math.tan(e.fovX/2),h=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,f=.5*l*h+.5*Math.max(a,c);return Math.max(p,f)/s}async function Jet(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=vx(t),c=Zet(t,l,i,r,s);CC(t,l,n);const u=XU(n,e)?Qo.LOCKED:Qo.ADJUST;return a.scale=ov(t,c,a.targetGeometry.latitude),a.camera=await xbe(t,a.targetGeometry,a.scale,n,u,o),a}function Qet(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function Zv(t){return t?.camera!=null&&(t.rotation=YU(t.camera.heading)),t}function Ket(t,e){const i=ket;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class ett{constructor(){this.hasZ=!1,this.boundingBox=Or(),this.screenSpaceObjects=new Array}}const $s=C(),Fne=xe(),CI=yr(),aA=pn(),ttt=Vt(),e5=C(),EI=C(),bV=C(),wV={heading:0,tilt:0},ou=new Xe,itt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(te(i,t.xmin,t.ymin,t.zmin)),e(te(i,t.xmax,t.ymin,t.zmin)),e(te(i,t.xmin,t.ymax,t.zmin)),e(te(i,t.xmax,t.ymax,t.zmin)),e(te(i,t.xmin,t.ymin,t.zmax)),e(te(i,t.xmax,t.ymin,t.zmax)),e(te(i,t.xmin,t.ymax,t.zmax)),e(te(i,t.xmax,t.ymax,t.zmax))):(e(te(i,t.xmin,t.ymin,i[2])),e(te(i,t.xmax,t.ymin,i[2])),e(te(i,t.xmin,t.ymax,i[2])),e(te(i,t.xmax,t.ymax,i[2])))}},rtt=Object.freeze(Object.defineProperty({__proto__:null,create:wTe,fromCamera:bTe,toCameraAsync:_Te,toCameraSync:yTe},Symbol.toStringTag,{value:"Module"}));let stt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&un(this._options.signal,()=>{this.abort()}),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject(vi())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await iC(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await wTe(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this._target instanceof mp&&this._target.camera||this._target instanceof Pu),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new W("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=Ag(this.view,r);return s==null?(this._reject(new W("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new W("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new tO({view:this.view,desiredCamera:e.camera}),yE(this.view,e.camera,Eh.EYE_AND_CENTER)):Gs(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof jg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===Yr.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case Yr.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Yr.Ready:case Yr.Rejected:case Yr.Running:case Yr.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof jg&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new jg({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i?.stop(),this._reject(new W("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},uv=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){return this._outer.get(e)?.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var Os;function kne(t=!se("disable-feature:high-quality-idle"),e=null){const i=new uv;return t?(i.set(gi.IDLE,Os.Antialiasing,e!=="low"),i.set(gi.IDLE,Os.HighResolutionAtmosphere,e!=="low"),i.set(gi.IDLE,Os.HighQualityTransparency,!0),i.set(gi.IDLE,Os.SSAO,!0),i.set(gi.IDLE,Os.WaterReflection,!0),i.set(gi.IDLE,Os.PhysicalPixelRendering,!0)):(i.set(gi.ANIMATING,Os.HighResolutionShadows,!0),i.set(gi.ANIMATING,Os.HighResolutionViewshed,!0),i.set(gi.INTERACTING,Os.HighResolutionShadows,!0),i.set(gi.INTERACTING,Os.HighResolutionViewshed,!0)),i.set(gi.IDLE,Os.HighResolutionShadows,!0),i.set(gi.IDLE,Os.HighResolutionViewshed,!0),i.set(gi.IDLE,Os.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(Os||(Os={}));let ks=class extends Pe{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Une,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Une:0}},this._propertiesPool=new g0({frustum:E_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new ntt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([yo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),he(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),Ji)]),zl(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([xw({prepare:()=>this._prepareFrame()}),he(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(MI)}),yo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Oe(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=CC(this.view,this.view.state.camera,xV);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(Ag(this.view,e),{applyConstraints:!1})||le.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=CC(this.view,this.view.state.contentCamera,xV);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Ag(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(TV),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=ya(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([he(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(TV),this.test.contentCameraResetState.clear())}),he(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),he(()=>this.view.state.camera,o=>{const a=Wn(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],TV),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():le.getLogger(this).error("#center=","Invalid center",e):le.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):le.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=Dbe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||le.getLogger(this).error("#extent=","Invalid extent",e):le.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):le.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return ov(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||le.getLogger(this).error("#scale=","Invalid scale",e)}get terrainScale(){if(!this.ready)return this._get("scale");const e=this.view,i=e.basemapTerrain.tilingScheme,r=e.pointsOfInterest.cameraOnSurface.scale;if(!i||!r)return this._get("scale");const s=e.state.contentCamera;let n=LU(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=i.levelAtScale(r)-o;return a<0?this._get("scale"):i.scaleAtLevel(a)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[ei.TOP]/r),o=Math.round(i[ei.RIGHT]/r),a=Math.round(i[ei.BOTTOM]/r),l=Math.round(i[ei.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,AI),this.view.state.updateCamera(i=>i.padding=AI))}_paddingToArray(e,i,r){e?Zr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Zr(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return $h((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?bTe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||le.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;le.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else le.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?$7e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||le.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return r&&Bb(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Os.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Os.PhysicalPixelRendering,gi.IDLE)||e.isFeatureEnabled(Os.PhysicalPixelRendering,gi.INTERACTING)||e.isFeatureEnabled(Os.PhysicalPixelRendering,gi.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!HT(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!HT(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!HT(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||HT(this.viewpoint.targetGeometry?.spatialReference,e)&&HT(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new HM({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Ne.Local&&this.addHandles(zl(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(MI),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),MI)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(MI),this._constraintsManager=Oe(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new stt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(vx(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i?.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of att){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Pu)return void this.setStateCamera(Ag(this.view,e),{applyConstraints:!1});if(e instanceof mp){if(e.targetGeometry instanceof Qi){const n=tN(this.view,e.targetGeometry,0,.5,Qo.LOCKED);return void(n!=null&&this.setStateCamera(Ag(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=tN(this.view,e,0,.5,Qo.LOCKED);i!=null&&this.setStateCamera(Ag(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&ott.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof mp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Pu?this.isCompatible(e.position):e.spatialReference&&!Rye(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=ltt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=oy){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=RZ(this.view,s,n,e,i,Qo.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=tN(this.view,e,i,r,Qo.ADJUST,xV);return s?Ag(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude,n=IU(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(Ube(this.view,e))}_viewpointToCamera(e){return Ag(this.view,yTe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&Gs(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new tO({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(oy.copyFrom(s),oy.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,AI),oy.padding=AI),oy.fullWidth=r.width,oy.fullHeight=r.height,oy.pixelRatio=r.pixelRatio,this.view.state.camera=oy),this._updateViewState()}}_updateElevation(e){const i=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,s=i?$U(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=gi.ANIMATING:this.view.interacting?this.view.state.mode=gi.INTERACTING:(this.view.state.mode===gi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=gi.INTERACTING:this.view.state.mode=gi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([m({type:Pu,dependsOn:["view.state.camera","ready"]})],ks.prototype,"camera",null),d([m({type:Pu,dependsOn:["view.state.contentCamera","ready"]})],ks.prototype,"contentCamera",null),d([m({type:Xe})],ks.prototype,"center",null),d([m({type:Qi})],ks.prototype,"extent",null),d([m({readOnly:!0})],ks.prototype,"frustum",null),d([m()],ks.prototype,"_constraintsManager",void 0),d([m({readOnly:!0})],ks.prototype,"constraintsManager",null),d([m()],ks.prototype,"_initialViewpoint",null),d([m({readOnly:!0})],ks.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],ks.prototype,"ready",void 0),d([m({type:Number})],ks.prototype,"scale",null),d([m({type:Number})],ks.prototype,"terrainScale",null),d([m()],ks.prototype,"padding",null),d([m({readOnly:!0})],ks.prototype,"screenCenter",null),d([m({constructOnly:!0})],ks.prototype,"view",void 0),d([m({type:mp})],ks.prototype,"viewpoint",null),d([m({type:Number})],ks.prototype,"zoom",null),d([m({readOnly:!0})],ks.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],ks.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],ks.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],ks.prototype,"_windowDevicePixelRatio",void 0),d([m()],ks.prototype,"_devicePixelRatioOverride",void 0),ks=d([U("esri.views.3d.state.ViewStateManager")],ks);let ntt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const ott=new Set(["camera","viewpoint","extent","scale","center","zoom"]),att=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],ltt={heading:0,tilt:0},xV=new Pu,oy=new br,AI=Yt(),MI="pending-initial-view",TV="content-camera-reset",Une=300,zne=100;let Gf=class extends Dg{constructor(){super(...arguments),this.startCamera=new br,this.currentCamera=new br,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<zne}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Yr.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),zne),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([m({readOnly:!0})],Gf.prototype,"isInteractive",null),d([m()],Gf.prototype,"_lastInteraction",void 0),Gf=d([U("esri.views.3d.state.controllers.InteractiveController")],Gf);var cc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(cc||(cc={}));let iO=class extends Gf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=cc.CENTER,this._rotScale=0,this._lastPoint=it(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=it(),this._tmpTransf=xe(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions=new Bh(Ur.ALL,ii.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===cc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case cc.EYE:ae(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=ii.LOOK_AROUND,this._constraintOptions.tiltMode=gm.LOOK_AROUND,this._constraintOptions.selection=Ur.NONE;break;case cc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?wx:{});i||ae(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=ii.TUMBLE,this._constraintOptions.tiltMode=gm.TUMBLE,this._constraintOptions.selection=Ur.ALL&~Ur.DISTANCE;break}}hw(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=C();_e(s,this._pivotPos,r.eye);const n=Se(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Bne);let a=Math.max(Math.min(fet,1/Math.abs(pe(Bne,r.viewForward)))*o,met);i&&(a=Math.min(n,a));const l=ns(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=C$(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let u=this.view._stage.renderView.getMinimalDepthForArea(gR(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*fV,fV),h=this.view._stage.renderView.getMinimalDepthForArea(gR(this.view),e[0],e[1],r,fV);u==null&&h==null||(u=u??h??0,h=h==null||c===Xo.Horizontal?u:h,a=u>h?h:u,a=i?Math.min(a,n):a),fe(s,s),ae(this._pivotPos,me(this._tmpPivotPoint,r.eye,ie(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case cc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case cc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Gs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),hw(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;_e(this._tmpViewDir,r,s);const a=Se(this._tmpViewDir),l=Zn(pe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===cc.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=Te(n+l,qo.min,qo.max)-l,Ke(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===cc.CENTER&&(o=-o),Bl(this._tmpTransf,o,this._tmpWorldUp),Sc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Ve(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ve(SV,e.up,this._tmpTransf),me(SV,s,this._tmpViewDir),ta(this._lastPoint,this._tmpRotCurPoint),SV}};d([m()],iO.prototype,"pivot",void 0),iO=d([U("esri.views.3d.state.controllers.RotateController")],iO);const SV=C(),Bne=C();let CV=class extends ko{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!wJ(e.data,this.pointerAction))return;const r=ns(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new iO({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},u7=class extends Gf{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=it(),this._panAxisAngle=qU(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Xo.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=ns(),this._normalizedAnchorPoint=it(),this._constraintOptions=new Bh(Ur.ALL_EXCEPT_COLLISION,ii.ZOOM,0,this.startCamera),this._sphere=Ws(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ta(this.dragBeginPoint,e),hw(this.startCamera,e,this._normalizedAnchorPoint);const i=er(this.view.spatialReference),r=aTe(this._intersectionHelper,this.startCamera,e,i,OC.Ellipsoid,this.view.map.ground.opacity===0?wx:{});if(this._navMode=C$(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Xo.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;_E(this.startCamera,e,this._tmpRay),fe(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(_e(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Se(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Vne);let o=Te(Math.min(Kxe,1/Math.abs(pe(Vne,this._tmpRay.direction)))*n,W4[0],W4[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,WU);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ie(this._tmpRay.direction,this._tmpRay.direction,o),me(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Xo.Horizontal){_e(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Se(this._tmpRayDir);hw(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/Se(this.currentCamera.center));this.currentCamera.center=ie(PI,this.currentCamera.center,o)}ie(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=me(PI,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Dd(iv(this.dragBeginPoint,e)),Gs(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(mR(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),fJ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),cv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Se(this._tmpRay.direction);hw(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;ie(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=me(PI,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=me(PI,this.currentCamera.center,this._tmpRayDir)}yE(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};u7=d([U("esri.views.3d.state.controllers.ZoomControllerGlobal")],u7);const PI=C(),Vne=C();let h7=class extends Gf{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=it(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=ns(),this._normalizedAnchorPoint=it(),this._constraintOptions=new Bh(Ur.ALL,ii.ZOOM,0,this.startCamera,C()),this._plane=Ui()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ta(this.dragBeginPoint,e),hw(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?wx:{});_e(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Se(this._tmpDir);fe(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=Te(Math.min(Kxe,1/Math.abs(pe(ctt,this._tmpDir)))*s,W4[0],W4[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(gR(this.view),e[0],e[1],this.view.state.camera,WU);n=o??n,n=i?Math.min(n,r):n,ie(this._tmpDir,this._tmpDir,n),me(this._tmpP,this.startCamera.eye,this._tmpDir),_e(this._tmpN,this.startCamera.eye,this.startCamera.center),fe(this._tmpN,this._tmpN),this._tmpN[1]<0&&Yn(this._tmpN,this._tmpN),a$(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;get(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ae(this._tmpPoi,this.currentCamera.center),hw(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);ta(this._normalizedAnchorPoint,this._tmpP0),_e(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Se(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ae(this._constraintOptions.interactionDirection,this._tmpRayDir),ie(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=me(Jv,this.currentCamera.eye,this._tmpRayDir),or(Jv,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Jv[2]=Math.max(this.startCamera.center[2],Jv[2]):Jv[2]=Math.min(this.startCamera.center[2],Jv[2]),this.currentCamera.center=Jv,this._constraintOptions.interactionFactor=Dd(iv(this.dragBeginPoint,e)),Gs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};h7=d([U("esri.views.3d.state.controllers.ZoomControllerLocal")],h7);const Jv=C(),ctt=Ce(0,0,1);let utt=class extends ko{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!wJ(e.data,this.pointerAction))return;const r=ns(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new u7({view:this._view}):this._cameraController=new h7({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Jh(t){let e=t*t;return t<0&&(e*=-1),e}function Gne(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Jh(s.axes[0]),r.translation[1]=Jh(s.axes[1]),r.translation[2]=Jh(s.buttons[7])-Jh(s.buttons[6]),r.heading=Jh(s.axes[2]),r.tilt=Jh(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Jh(s.axes[0]),r.translation[1]=1.2*Jh(s.axes[1]),r.translation[2]=2*-Jh(s.axes[2]),r.heading=1.2*Jh(s.axes[5]),r.tilt=1.2*Jh(s.axes[3])),r.tilt*=o,ie(r.translation,r.translation,a),r}function jne(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function EV(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Vb=class extends Gf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new br,this._headingStart=0,this._constraintOptions=new Bh(Ur.ALL,ii.NONE,0,new br,null,gm.LOOK_AROUND)}handleEventGamepad(e){const i=Gne(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||EV(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,jne(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=jne(this._keysButtonState,this._transformation);EV(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Qv),this._applyDisabledMovementTypes(Qv),this._applyPan(Qv.pan),this._applyRotate(Qv.rotate),this._applyZoom(Qv.zoom),this._applyAscend(Qv.ascend),this._constraintOptions.interactionType=ii.NONE,this._constraintOptions.selection=Ur.COLLISION,Gs(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;_e(ul,i.center,i.eye),Ve(ul,ul,e.matrix),i.center=me(ul,ul,i.eye),i.up=Ve(ul,i.up,e.matrix),this._constraintOptions.interactionType=ii.LOOK_AROUND,this._constraintOptions.selection=Ur.ALL_EXCEPT_COLLISION,Gs(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=Ve(ul,i.eye,e.matrix),i.center=Ve(ul,i.center,e.matrix),this.view.state.isGlobal&&(i.up=Ve(ul,i.up,e.matrix)),this._constraintOptions.interactionType=ii.PAN,this._constraintOptions.selection=Ur.ALL,Gs(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=me(ul,this.currentCamera.eye,ie(ze.get(),i,e)),ae(lA,i),Yn(lA,lA),this._constraintOptions.interactionDirection=lA,this._constraintOptions.interactionType=ii.ZOOM,this._constraintOptions.selection=Ur.ALL_EXCEPT_COLLISION,Gs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,ze.get());if(this._constraintOptions.interactionDirection=ae(lA,i),this.view.state.isGlobal){const r=Se(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=ie(ul,this.currentCamera.eye,s),this.currentCamera.center=ie(ul,this.currentCamera.center,s)}else{const r=ie(ze.get(),i,e);this.currentCamera.eye=me(ul,this.currentCamera.eye,r),this.currentCamera.center=me(ul,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=ii.ASCEND,this._constraintOptions.selection=Ur.COLLISION,Gs(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ur.ALL_EXCEPT_COLLISION,Gs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){ytt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,ul)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=te(ze.get(),n[0],n[1],0);fe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ie(ze.get(),s,c);Aa(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ie(ze.get(),l,_);Aa(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const h=-o.heading*e.rotate;h!==0&&(Sc(r.rotate.matrix,r.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,ze.get())),r.rotate.enabled=!0);const p=o.tilt*e.rotate,f=lv(this.view.renderCoordsHelper,i.center,i.eye),g=Te(f+p,qo.min,qo.max)-f;g&&(Sc(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=Ke(ze.get(),n,s);fe(l,l),Yn(l,l),xet(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Qv.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const h=-o.heading*e.rotate;h!==0&&(Sc(r.rotate.matrix,r.rotate.matrix,h,this._tmpCamera.eye),r.rotate.enabled=!0);const p=o.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,i.ray,c);f!==0&&(Sc(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=er(this.view.spatialReference),n=vN(qo.min,i.origin,r,s);let o=0,a=0;const l=ze.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=lv(this.view.renderCoordsHelper,l,i.origin);o=vN(c,i.origin,r,s),a=vN(qo.max,i.origin,r,s)}else{dE(CU(EU,r+s.radius),i,l);const c=Math.PI+VX(i.direction,l);o=Cne(c,i.origin,r,s),a=Cne(qo.max,i.origin,r,s)}return Te(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=T7e(this.view,i,0,STe,gtt),o=r.intersectManifoldClosestSilhouette(Ou(i,n),e,ze.get()),a=hr(i,o),l=r.intersectManifoldClosestSilhouette(Ou(i,S0(ze.get(),i,s.center)),e,ze.get()),c=hr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,ze.get());if(n){const a=_e(ze.get(),e,o),l=Se(a);ie(a,a,1/l);const c=fe(ze.get(),e),u=Zn(pe(c,a));return l*Math.sin(Math.min(dtt,u))}{const a=ae(ze.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),hr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:ptt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+er(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=ze.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,u=Hne*s.width,h=Hne*s.width,p=l*Math.tan(.5*s.fovX)/c,f=p/r,g=p/this._computeHeadingRotateRadius(o),_=a-i;return{pan:(n?f:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:Te(g*h,ftt,mtt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Ih(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Ih(e.rotate.matrix))}static activatesFor(e,i){const r=Gne(i,e.navigation.gamepad,htt);return!(i.action==="end"||EV(r))}};d([m({constructOnly:!0})],Vb.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],Vb.prototype,"disableMovements",void 0),Vb=d([U("esri.views.3d.state.controllers.GamepadKeyboardController")],Vb);const htt={translation:[0,0,0],heading:0,tilt:0,zoom:0},STe=80,dtt=xt(STe),Hne=.75,ptt=5,ftt=xt(30),mtt=xt(80),Qv={zoom:0,ascend:0,pan:{enabled:!1,matrix:xe()},rotate:{enabled:!1,matrix:xe()}},ul=C(),lA=C(),gtt=PZ();function ytt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Ih(t.pan.matrix),t.rotate.enabled=!1,Ih(t.rotate.matrix)}let _tt=class extends ko{constructor(e){super(!0),this._view=e,this._watchHandles=new _m,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([he(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Ki),he(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad?.active;if(r||Vb.activatesFor(this._view,e.data)){if(!r){const s=new Vb({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function vtt(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Mi(()=>document.removeEventListener("visibilitychange",e))}var ic;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ic||(ic={}));let btt=class extends ko{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ne.Local},this._keyToNumber={[i.left]:ic.LEFT,[i.right]:ic.RIGHT,[i.forward]:ic.FORWARD,[i.backward]:ic.BACKWARD,[i.up]:ic.UP,[i.down]:ic.DOWN,[i.headingLeft]:ic.HEADINGLEFT,[i.headingRight]:ic.HEADINGRIGHT,[i.tiltUp]:ic.TILTUP,[i.tiltDown]:ic.TILTDOWN,[i.zoomIn]:ic.ZOOMIN,[i.zoomOut]:ic.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=vtt(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Vb({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},wtt=class extends ko{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new J4({view:this._view,mode:"interaction"}):new Q4({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,ns(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},t5=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},qw=class extends pR{constructor(){super(...arguments),this._beginCamera=new br,this._elapsedTimeSec=0,this.constraintOptions=new Bh(Ur.ALL,ii.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new EC}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Gs(this.view,i,this.constraintOptions)}};qw=d([U("esri.views.3d.state.controllers.momentum.MomentumController")],qw);let rO=class extends qw{constructor(e){super(e),this.interactionType=ii.PAN,this._tmpPan=C()}momentumStep(e,i){const r=this.momentum.value(e);ie(this._tmpPan,this.momentum.direction,r),i.eye=_e(qne,i.eye,this._tmpPan),i.center=_e(qne,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],rO.prototype,"momentum",void 0),rO=d([U("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],rO);const qne=C(),xtt=C(),OI=C();let TN=class extends qw{constructor(e){super(e),this.interactionType=ii.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ae(OI,i.eye),fe(OI,OI),Ke(this.momentum.axis2,OI,this.momentum.axis1),hTe(i,xtt,this.momentum.axis1,r,this.momentum.axis2,s)}};d([m({constructOnly:!0})],TN.prototype,"momentum",void 0),TN=d([U("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],TN);let Eb=class extends qw{set center(e){this._set("center",Kr(e))}set axis(e){this._set("axis",Kr(e))}constructor(e){super(e),this.interactionType=ii.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);cv(i,this.center,fR(this.axis,r))}};d([m({constructOnly:!0})],Eb.prototype,"momentum",void 0),d([m({constructOnly:!0})],Eb.prototype,"center",null),d([m({constructOnly:!0})],Eb.prototype,"axis",null),Eb=d([U("esri.views.3d.state.controllers.momentum.RotationMomentumController")],Eb);let HS=class extends qw{set zoomCenter(e){this._set("zoomCenter",Kr(e))}constructor(e){super(e),this.interactionType=ii.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ae(r,i.eye);const s=this.momentum.valueDelta(0,e);_J(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),S0(r,i.eye,r)}};d([m({constructOnly:!0})],HS.prototype,"momentum",void 0),d([m({constructOnly:!0})],HS.prototype,"zoomCenter",null),HS=d([U("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],HS);let rb=class extends qw{set screenCenter(e){this._set("screenCenter",ns(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Kr(e))}constructor(e){super(e),this.interactionType=ii.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=qU(),this._sphere=Ws()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);nTe(this._sphere,i,r),this.constraintOptions.interactionType=ii.ZOOM,Gs(this.view,i,this.constraintOptions),mR(this._sphere,i,this.screenCenter,this._tmpSceneCenter),fJ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),cv(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=ii.PAN}};d([m({constructOnly:!0})],rb.prototype,"momentum",void 0),d([m({constructOnly:!0})],rb.prototype,"screenCenter",null),d([m({constructOnly:!0})],rb.prototype,"sceneCenter",null),d([m({constructOnly:!0})],rb.prototype,"radius",void 0),rb=d([U("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],rb);let Nd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},ZU=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Ttt=class extends ZU{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},CTe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Nd(.6),this._screen=[new Nd(.4),new Nd(.4)],this._scene=[new Nd(.6),new Nd(.6),new Nd(.6)],this._tmpDirection=C()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){te(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Se(this._tmpDirection);s>0&&ie(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Ttt(e,i,r,n==null?0:s/n,this._tmpDirection)}},Wne=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Yne=1e-5;let Stt=class extends ZU{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Ctt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=it(),this._time=new Nd(.3),this._screen=[new Nd(.4),new Nd(.4)],this._angle1=new Wne(.6),this._angle2=new Wne(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=cTe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),xa(this._tmpAxis2)<Yne?a=0:fe(this._axis1,this._tmpAxis2),this._angle1.update(a),ae(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;uTe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),xa(this._tmpAxis2)<Yne?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),fe(this._axis1,this._tmpAxis1),fe(this._axis2,this._tmpAxis2)),ae(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Stt(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},ETe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Nd(.8),this.time=new Nd(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Te(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new ZU(e,i,r)}},ATe=class extends ETe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},Ett=class extends ZU{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},MTe=class extends ETe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Ett(e,i,r)}},d7=class extends Gf{constructor(){super(...arguments),this._smoothRotation=new t5(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ui(),this._beginRadius=0,this._smoothScaling=new t5(.05),this._zoomCenterScreen=ns(),this._zoomMomentumEstimator=new MTe,this._rotationMomentumEstimator=new ATe,this._panSphericalMomentumEstimator=new Ctt,this._panPlanarMomentumEstimator=new CTe,this._adjustedSphere=Ws(),this._tmp3d=C(),this._tmpScreenPointArray=ns(),this._beginScreenPoint=ns(),this._beginScenePoint=C(),this._screenPickPoint=ns(),this._scenePickPoint=C(),this._navMode=Xo.Horizontal,this._sphere=Ws(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._beginCamera=new br,this._constraintOptions=new Bh(Ur.ALL,ii.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-J_.normalize(xt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),zd(e.center,this._screenPickPoint),ta(this._beginScreenPoint,this._screenPickPoint);const i=er(this.view.spatialReference),r=aTe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,OC.Silhouette,this.view.map.ground.opacity===0?wx:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ae(this._beginScenePoint,this._scenePickPoint),this._navMode=C$(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Xo.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===Xo.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===Xo.Horizontal?new rb({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new HS({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Eb({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===Xo.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new TN({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new rO({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=Yn(this._tmp3d,this.startCamera.viewForward);a$(this._scenePickPoint,r,this._panningPlane);const s=ns(this._screenPickPoint[0],0),n=C(),o=Se(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],mR(this._adjustedSphere,this.startCamera,s,n);const a=Jo();this.startCamera.projectToRenderScreen(n,a);const l=C(),c=C(),u=C();_e(l,this._scenePickPoint,this.currentCamera.eye);const h=Se(l);fe(l,l);const p=rTe*Math.max(Math.abs(this.view.camera.position.z),sTe),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,WU);let g=f??p;g=i?Math.min(g,h):g,ae(u,me(c,this.currentCamera.eye,ie(c,l,g))),this._panningPlane[3]=-pe(this._panningPlane,u),this.startCamera.center=me(c,this.startCamera.eye,ie(c,this.startCamera.viewForward,g));const _=zd(e.center,this._tmpScreenPointArray);l7(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),nTe(this._sphere,this.currentCamera,this._smoothScaling.value),zd(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=ii.ZOOM,this._constraintOptions.interactionFactor=Dd(e.radius-this._beginRadius),Gs(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=zd(e.center,this._tmpScreenPointArray);mR(this._sphere,this.currentCamera,i,this._tmp3d),vJ(this._beginScenePoint,pe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(pTe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(dTe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=ii.PAN,this._constraintOptions.interactionFactor=Dd(iv(this._screenPickPoint,i)),Gs(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){fe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Yn(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+a7(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),cv(this.currentCamera,this._sphere,fR(this._rotationAxis,n)),this._constraintOptions.interactionType=ii.TUMBLE,this._constraintOptions.interactionFactor=Dd(e.radius*r),Gs(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=zd(e.center,this._tmpScreenPointArray);l7(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(lTe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=ii.PAN,this._constraintOptions.interactionFactor=Dd(iv(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Gs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),_J(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=ii.ZOOM,this._constraintOptions.interactionFactor=Dd(e.radius-this._beginRadius),Gs(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ae(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Yn(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=a7(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),cv(this.currentCamera,this._sphere,fR(this._rotationAxis,o)),this._constraintOptions.interactionType=ii.TUMBLE,this._constraintOptions.interactionFactor=Dd(e.radius*o),Gs(this.view,this.currentCamera,this._constraintOptions)}};d7=d([U("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],d7);const Xne=Ce(0,0,1);let p7=class extends Gf{constructor(){super(...arguments),this._rotationValueSmooth=new t5(.05),this._scalingValueSmooth=new t5(.05),this._planeHorizontal=Ui(),this._planeVertical=Ui(),this._rotationMomentumEstimator=new ATe,this._panMomentumEstimator=new CTe(300,12,.9),this._zoomMomentumEstimator=new MTe,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._navMode=Xo.Horizontal,this._beginCenterScreen=ns(),this._tmpCentroid3d=C(),this._tmpCentroid2d=ns(),this._tmp2d=ns(),this._pointerCount=0,this._beginCamera=new br,this._constraintOptions=new Bh(Ur.ALL,ii.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),zd(e.center,this._beginCenterScreen),Y_e(Xne,0,this._planeHorizontal);const r=C(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?wx:{}),n=C();Yn(n,this.startCamera.viewForward);const o=C();ae(o,Xne);const a=pe(n,o);this._navMode=C$(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(rTe,1/Math.abs(pe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),sTe);J8(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||Q8(this._planeHorizontal,this._planeHorizontal);const c=C(),u=C(),h=C();_e(c,r,this.currentCamera.eye);const p=Se(c);if(fe(c,c),this._navMode===Xo.Vertical){ie(o,o,a),_e(this._planeVertical,n,o),fe(this._planeVertical,this._planeVertical),J8(this._planeVertical,this._planeVertical,r);const f=this.view._stage.renderView.getMinimalDepthForArea(gR(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,WU);let g=f??l;g=s?Math.min(g,p):g,ae(h,me(u,this.currentCamera.eye,ie(u,c,g))),this._planeVertical[3]=-pe(this._planeVertical,h),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),mV(this._tmpPoints,this._beginCenter)}else{const f=s?p:l;ae(h,me(u,this.currentCamera.eye,ie(u,c,f))),this._planeHorizontal[3]=-pe(this._planeHorizontal,h),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),mV(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===Xo.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),_J(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=ii.ZOOM,this._constraintOptions.interactionFactor=Dd(Math.abs(e.radius-this._beginRadius)),Gs(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),mV(this._tmpPoints,this._tmpCentroid3d),zd(e.center,this._tmpCentroid2d),lTe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=ii.PAN,this._constraintOptions.interactionFactor=Dd(iv(this._beginCenterScreen,this._tmpCentroid2d)),Gs(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+a7(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;cv(this.currentCamera,n,fR(u,c)),this._constraintOptions.interactionType=ii.TUMBLE,this._constraintOptions.interactionFactor=Dd(Math.abs(e.radius*c)),Gs(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new HS({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Eb({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new rO({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=C()),l7(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};p7=d([U("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],p7);let Zne=class extends ko{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!wJ(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller?.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new d7({view:this._view}):new p7({view:this._view})}},Att=class extends ko{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},PTe=class extends ko{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Mtt=class extends PTe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Ptt=class extends PTe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Ott=class extends ko{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=ns(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new iO({view:this._view,pivot:cc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function Jne(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>Itt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Rtt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function $tt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Itt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let Ltt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Jne(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(Qne(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new NZ(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=xw({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;Qne(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Jne(n),l=r||$tt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Rtt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function Dtt(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function Qne(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const r=e[i];Dtt(r)&&t(r)}}const Kne=se("edge"),Ntt=se("chrome"),Ftt=se("ff"),ktt=se("safari"),eoe="esri-view-surface",Jx={touchNone:`${eoe}--touch-none`,touchPan:`${eoe}--touch-pan`};let OTe=class RTe{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Ltt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Oe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(AV[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&AV[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(AV[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Jx.touchNone:Jx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Jx.touchPan:Jx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Jx.touchNone),this._element.classList.remove(Jx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=ewe(this._element,e);return RTe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:Kne&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Kne?r*=.7:Ntt||ktt?r*=.6:Ftt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};OTe.test={disableSubpixelCoordinates:!1};const AV={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Utt=class extends ko{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const yu={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function f7(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function ztt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Btt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:$h()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[A,P]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(A*A+P*P)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let i=0,r=0;for(let T=0;T<t.length;T++)i+=t[T].x,r+=t[T].y;i/=t.length,r/=t.length;const s=t.map(T=>T.x-i),n=t.map(T=>T.y-r);let o=0,a=0,l=0,c=0,u=0,h=0,p=0;for(let T=0;T<s.length;T++){const S=s[T],A=n[T],P=S*S,R=A*A;o+=P,a+=R,l+=S*A,c+=P*S,u+=R*A,h+=S*R,p+=A*P}const f=.5*(c+h),g=.5*(u+p),_=o*a-l*l,v=(f*a-g*l)/_,b=(o*g-l*f)/_,w=$h(v+i,b+r);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function sO(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let Vtt=class extends ko{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Gtt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=RI(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=SN(s,$Te(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=RI(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=RI(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=SN(r,i)-e,r.lastAngle=SN(r,i)-e})}_emitEvent(e,i,r){const s=RI(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function $Te(t){const e=[];return t.forEach(i=>{e.push($h(i.event.x,i.event.y))}),Btt(e)}function RI(t){const e=$Te(t);let i=0;return t.forEach(r=>{let s=SN(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Gtt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function SN(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var toe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(toe||(toe={}));let jtt=class extends ko{constructor(e=yu.maximumDoubleClickDelay,i=yu.maximumDoubleClickDistance,r=yu.maximumDoubleTouchDelay,s=yu.maximumDoubleTouchDistance,n=UR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=sO(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=sO(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),f7(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):f7(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=sO(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Htt=class extends ko{constructor(e=yu.maximumClickDelay,i=yu.movementUntilMouseDrag,r=yu.movementUntilPenDrag,s=yu.movementUntilTouchDrag,n=yu.holdDelay,o=UR){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=gr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit($I("update",s,i),void 0,s.modifiers):ztt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit($I("start",s,i)):this._pointerDrag.emit($I("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit($I("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function $I(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let qtt=class extends ko{constructor(e=yu.maximumDoubleClickDelay,i=yu.maximumDoubleClickDistance,r=yu.maximumDoubleTouchDelay,s=yu.maximumDoubleTouchDistance,n=UR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=gr(e.doubleClickTimer))}get hasPendingInputs(){return vu(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=gr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=Wtt(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;f7(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=sO(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=sO(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}};function Wtt(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let Ytt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Xtt=class extends ko{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Ytt({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of i.pointers.values())r=Math.max(r,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const h=r-s,p=n-o,f=a-l,g=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(f-h)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},_d=class extends Pe{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Oe(this._inputManager)}connect(){const e=this.view;this._source=new OTe(this.view.surface,e.input);const i=[new jtt,new Htt,new qtt,new Vtt(this.view.navigation),new Xtt],r=new Qu({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Utt],D_.INTERNAL),this._modeDragPan=new Zne(e,"primary"),this._modeDragRotate=new CV(e,"secondary",cc.CENTER),this._modeDragZoom=new utt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Att(e),new Oet(e),new _tt(e),new btt(e,s.pan),new wtt(e),new Ptt(e,s.resetTilt),new Mtt(e,s.resetHeading),new CV(e,"primary",cc.EYE,[s.lookAround]),new CV(e,"secondary",cc.CENTER,[s.lookAround]),new Zne(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Ott(e)],D_.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(he(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Ki))}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_updateMode(){const e=this.mode,i=this.primaryDragAction,r=m7.get(e)?.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};d([m()],_d.prototype,"view",void 0),d([m({value:"pan"})],_d.prototype,"primaryDragAction",null),d([m({value:"default"})],_d.prototype,"mode",null),d([m({readOnly:!0})],_d.prototype,"updating",null),d([m()],_d.prototype,"latestPointerType",null),d([m()],_d.prototype,"latestPointerLocation",null),d([m()],_d.prototype,"multiTouchActive",null),d([m()],_d.prototype,"_inputManager",void 0),_d=d([U("esri.views.3d.input.SceneInputManager")],_d);const m7=new Map,MV=new Map,PV=new Map;MV.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),MV.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),PV.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),PV.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),m7.set("default",MV),m7.set("pro",PV);const Ztt=_d;let Us=class extends Pe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],Us.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],Us.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],Us.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],Us.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],Us.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],Us.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],Us.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],Us.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],Us.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],Us.prototype,"SHOW_POI",void 0),d([m()],Us.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],Us.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],Us.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],Us.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],Us.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],Us.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],Us.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],Us.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],Us.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],Us.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],Us.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],Us.prototype,"LINE_WIREFRAMES",void 0),Us=d([U("esri.views.3d.support.debugFlags")],Us);const wr=new Us;let au,I2,g7=!1,y7=!1,_7=!1,v7=!1,nO=null;function Jtt(t,e){if(!y7||!I2)return;ITe();const i=I2;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),LTe(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function Qtt(t){_7=wr.DECONFLICTOR_SHOW_VISIBLE,v7=wr.DECONFLICTOR_SHOW_INVISIBLE,g7=_7||v7,y7=wr.DECONFLICTOR_SHOW_GRID,nO=null,g7||y7?nO=()=>Ktt(t):au&&(au.parentElement.removeChild(au),au=null)}function ITe(){nO&&(nO(),nO=null)}function Ktt(t){au==null&&(au=document.createElement("canvas"),au.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(au));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;au.setAttribute("width",`${o}px`),au.setAttribute("height",`${a}px`),au.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),I2=au.getContext("2d"),I2.clearRect(0,0,s,n),I2.font="12px Arial"}function LTe(t,e,i,r,s){ITe();const n=au.height,o=I2;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function eit(t,e){g7&&(e&&_7||!e&&v7)&&LTe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Zo,uo;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Zo||(Zo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(uo||(uo={}));function DTe(t,e){return new kTe(t,zTe,e)}function tit(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=zTe;return new kTe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:OV.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:OV.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:OV.minPixelSize},e)}function iit(t){return Math.abs(t*t*t)}function NTe(t,e,i){const r=i.parameters;return RV.scale=Math.min(r.divisor/(e-r.offset),1),RV.factor=iit(t),RV}function SJ(t,e){return Et(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function rit(t,e,i){const r=NTe(t,e,i);return r.minScaleFactor=0,SJ(1,r)}function ioe(t,e,i,r){r.scale=rit(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function FTe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function sit(t,e,i,r){return SJ(t,NTe(e,i,r))}let kTe=class UTe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=nit(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===Ne.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new UTe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:u,scaleFallOffFactor:h}=l,p=Math.sin(u)*a,f=.5*Math.PI-u-o*(.5-s*c),g=p/Math.cos(f),_=f+o*n*c,v=(g-h*(p/Math.cos(_)))/(1-h);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=g-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=roe){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=roe){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Te((o-a)/(l-a),0,1),[u,h]=[s.min,s.max];return r.tiltAngle=Et(u.tiltAngle,h.tiltAngle,c),r.scaleFallOffFactor=Et(u.scaleFallOffFactor,h.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const zTe={curvatureDependent:{min:{curvature:xt(10),tiltAngle:xt(12),scaleFallOffFactor:.5},max:{curvature:xt(70),tiltAngle:xt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},OV={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function nit(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const RV={scale:0,factor:0,minScaleFactor:0},roe={tiltAngle:0,scaleFallOffFactor:0};function oit(t){return t instanceof Float32Array&&t.length>=16}function ait(t){return Array.isArray(t)&&t.length>=16}function lit(t){return oit(t)||ait(t)}var wa,soe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(wa||(wa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(soe||(soe={}));let CJ=class{constructor(e){this.field=e}},cit=class extends CJ{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[wa.Undefined,wa.Undefined,wa.Undefined]}},uit=class extends CJ{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},hit=class extends CJ{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},dit=class{};function cA(t){return t!=null}function Qx(t){return typeof t=="number"}function JU(t){return typeof t=="string"}function pit(t){return t==null||JU(t)}function Hn(t,e){t&&t.push(e)}function fit(t,e,i,r=xe()){const s=t||0,n=e||0,o=i||0;return s!==0&&nC(r,r,-s/180*Math.PI),n!==0&&sC(r,r,n/180*Math.PI),o!==0&&Bk(r,r,o/180*Math.PI),r}function ay(t,e,i,r,s){const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=wa.DefinedSize,!0}if(cA(t.field))return cA(t.stops)?t.stops.length===2&&Qx(t.stops[0].size)&&Qx(t.stops[1].size)?(noe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=wa.DefinedSize,!0):(Hn(s,"Could not convert size info: stops only supported with 2 elements"),!1):Qx(n)&&Qx(o)&&cA(t.minDataValue)&&cA(t.maxDataValue)?(noe(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=wa.DefinedSize,!0):t.valueUnit==="unknown"?(Hn(s,"Could not convert size info: proportional size not supported"),!1):wC[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/wC[t.valueUnit],e.type[i]=wa.DefinedSize,!0):(Hn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!cA(t.field)){if(t.stops?.[0]&&Qx(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=wa.DefinedSize,!0;if(Qx(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=wa.DefinedSize,!0}return Hn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function noe(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function mit(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Hn(r,"Could not convert size info: unsupported property"),null;if(!pit(t.field))return Hn(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Hn(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new cit(t.field);let s;switch(t.axis){case"width":return s=ay(t,e.size,0,i,r),s?e:null;case"height":return s=ay(t,e.size,2,i,r),s?e:null;case"depth":return s=ay(t,e.size,1,i,r),s?e:null;case"width-and-depth":return s=ay(t,e.size,0,i,r),s&&ay(t,e.size,1,i,r),s?e:null;case null:case void 0:case"all":return s=ay(t,e.size,0,i,r),s=s&&ay(t,e.size,1,i,r),s=s&&ay(t,e.size,2,i,r),s?e:null;default:return Hn(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function git(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===wa.DefinedSize&&(n*=e.modelSize[s],t.type[s]=wa.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==wa.Undefined)r=0;else if(t.type[1]!==wa.Undefined)r=1;else{if(t.type[2]===wa.Undefined)return Hn(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)t.type[s]===wa.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function ooe(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function yit(t,e,i){if(t.normalizationField)return Hn(i,"Could not convert color info: unsupported property"),null;if(JU(t.field)){if(!t.stops)return Hn(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Hn(i,"Could not convert color info: too many color stops"),null;e.color=new uit(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,ooe(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Hn(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,ooe(e.color.colors,s,r)}}return e}function _it(t,e,i){if(t.normalizationField)return Hn(i,"Could not convert opacity info: unsupported property"),null;if(JU(t.field)){if(!t.stops)return Hn(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Hn(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new hit(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Hn(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function $V(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function vit(t,e,i){if(!JU(t.field))return Hn(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Hn(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return $V(t,e.rotation,0),e;case"roll":return $V(t,e.rotation,1),e;case null:case void 0:case"heading":return $V(t,e.rotation,2),e;default:return Hn(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let E$=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function BTe(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return Hn(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?mit(n,s,e,i):s;case"color":return e.supports.color?yit(n,s,i):s;case"opacity":return e.supports.opacity?_it(n,s,i):null;case"rotation":return e.supports.rotation?vit(n,s,i):s;default:return null}},new dit);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!git(r.size,e,i)?null:r:null}let bit=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function RC(t,e){if(!t||wr.TESTS_DISABLE_FAST_UPDATES)return null;const i=BTe(t.visualVariables,e);return i?new bit(i,GTe(i,e),!!i.size):null}function $C(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=BTe(e.visualVariables,i);return!!s&&!!(II(r.size,s.size,"size")&&II(r.color,s.color,"color")&&II(r.rotation,s.rotation,"rotation")&&II(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=GTe(s,i),t.requiresShaderTransformation=!!s.size,!0)}function II(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let VTe=class extends xr{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function GTe(t,e){const i=new VTe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,Ih(oO),fit(e.rotation[2],e.rotation[0],e.rotation[1],oO),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||yr(),$u(i.vvSymbolRotationMatrix,oO)),i}function wit(t,e,i){if(!t.vvSize)return i;tn(ly,i);const r=t.vvSymbolRotationMatrix;Sm(oO,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Ai(ly,ly,oO);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];aoe[s]=Te(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return E0(ly,ly,aoe),Aa(ly,ly,t.vvSymbolAnchor),ly}function EJ(t,e,i){if(!e.vvSize)return te(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Te(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function np(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const ly=xe(),aoe=C(),oO=xe();function AJ(t){t.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(x`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function xit(t){t.uniforms.add(new Rt("screenSizePerspective",e=>jTe(e.screenSizePerspective)))}function QU(t){t.uniforms.add(new Rt("screenSizePerspectiveAlignment",e=>jTe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function jTe(t){return te(Tit,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const Tit=C();function HTe(t,e){const i=t.vertex;e.hasVerticalOffset?(qTe(i),e.hasScreenSizePerspective&&(t.include(AJ),QU(i),wp(t.vertex,e)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Sit=Yt();function qTe(t){t.uniforms.add(new Ei("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Zr(Sit,n*a,o,r,s)}))}const WTe=.5;function YTe(t,e){t.include(AJ),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;Dl(i,e),wp(i,e),i.uniforms.add(new Ei("viewport",(r,s)=>s.camera.fullViewport),new Ue("polygonOffset",r=>r.shaderPolygonOffset),new Ue("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&qTe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?x.float(0):x`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||PC(i),e.draped||(i.uniforms.add(new Ue("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${x.float(WTe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&mE(i),e.hasScreenSizePerspective&&QU(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function XTe(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=sit(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Te(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function ZTe(t,e){const i=e?ZTe(e):{};for(const r in t){let s=t[r];s?.forEach&&(s=Eit(s)),s==null&&r in i||(i[r]=s)}return i}function Cit(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):Ide(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function Eit(t){const e=[];return t.forEach(i=>e.push(i)),e}const JTe={multiply:1,ignore:2,replace:3,tint:4};let Av=class extends T${constructor(e,i){super(),this.type=ws.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=di,this._pp0=Ce(0,0,1),this._pp1=Ce(0,0,0),this._parameters=ZTe(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Cit(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Ka.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},QTe=class extends jJe{constructor(e,i,r){super(i,r),this.camera=e}};var ki;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(ki||(ki={}));let MJ=class extends xr{constructor(){super(...arguments),this.renderOccluded=ki.Occlude,this.isDecoration=!1}},KTe=class{constructor(){this.factor=new loe,this.factorAlignment=new loe}},loe=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function NFt(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let h=0;h<r;h++)o[i]=u,i+=a}}function coe(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function eSe(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const u=3*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let h=0;h<r;++h)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}}function IC(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const u=4*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let h=0;h<r;++h)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}}function uoe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function PJ(t,e,i,r,s=1){if(!e)return void eSe(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,u=e[0],h=e[1],p=e[2],f=e[4],g=e[5],_=e[6],v=e[8],b=e[9],w=e[10],T=e[12],S=e[13],A=e[14];r*=l;let P=0,R=0,F=0;const k=qk(e)?N=>{P=n[N]+T,R=n[N+1]+S,F=n[N+2]+A}:N=>{const j=n[N],z=n[N+1],X=n[N+2];P=u*j+f*z+v*X+T,R=h*j+g*z+b*X+S,F=p*j+_*z+w*X+A};if(s===1)for(let N=0;N<c;++N)k(3*o[N]),a[r]=P,a[r+1]=R,a[r+2]=F,r+=l;else for(let N=0;N<c;++N){k(3*o[N]);for(let j=0;j<s;++j)a[r]=P,a[r+1]=R,a[r+2]=F,r+=l}}function OJ(t,e,i,r,s=1){if(!e)return void eSe(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],_=a[5],v=a[6],b=a[8],w=a[9],T=a[10],S=!xX(a),A=1e-6,P=1-A;r*=c;let R=0,F=0,k=0;const N=qk(a)?j=>{R=n[j],F=n[j+1],k=n[j+2]}:j=>{const z=n[j],X=n[j+1],q=n[j+2];R=h*z+g*X+b*q,F=p*z+_*X+w*q,k=f*z+v*X+T*q};if(s===1)if(S)for(let j=0;j<u;++j){N(3*o[j]);const z=R*R+F*F+k*k;if(z<P&&z>A){const X=1/Math.sqrt(z);l[r]=R*X,l[r+1]=F*X,l[r+2]=k*X}else l[r]=R,l[r+1]=F,l[r+2]=k;r+=c}else for(let j=0;j<u;++j)N(3*o[j]),l[r]=R,l[r+1]=F,l[r+2]=k,r+=c;else for(let j=0;j<u;++j){if(N(3*o[j]),S){const z=R*R+F*F+k*k;if(z<P&&z>A){const X=1/Math.sqrt(z);R*=X,F*=X,k*=X}}for(let z=0;z<s;++z)l[r]=R,l[r+1]=F,l[r+2]=k,r+=c}}function Ait(t,e,i,r,s=1){if(!e)return void IC(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],_=a[5],v=a[6],b=a[8],w=a[9],T=a[10],S=!xX(a),A=1e-6,P=1-A;if(r*=c,s===1)for(let R=0;R<u;++R){const F=4*o[R],k=n[F],N=n[F+1],j=n[F+2],z=n[F+3];let X=h*k+g*N+b*j,q=p*k+_*N+w*j,Z=f*k+v*N+T*j;if(S){const ce=X*X+q*q+Z*Z;if(ce<P&&ce>A){const I=1/Math.sqrt(ce);X*=I,q*=I,Z*=I}}l[r]=X,l[r+1]=q,l[r+2]=Z,l[r+3]=z,r+=c}else for(let R=0;R<u;++R){const F=4*o[R],k=n[F],N=n[F+1],j=n[F+2],z=n[F+3];let X=h*k+g*N+b*j,q=p*k+_*N+w*j,Z=f*k+v*N+T*j;if(S){const ce=X*X+q*q+Z*Z;if(ce<P&&ce>A){const I=1/Math.sqrt(ce);X*=I,q*=I,Z*=I}}for(let ce=0;ce<s;++ce)l[r]=X,l[r+1]=q,l[r+2]=Z,l[r+3]=z,r+=c}}function tSe(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const h=3*o[u];for(let p=0;p<s;++p)a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=255,r+=l}else for(let u=0;u<c;++u){const h=4*o[u];for(let p=0;p<s;++p)a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=n[h+3],r+=l}else{if(e===4){for(let u=0;u<c;++u){const h=4*o[u];a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=n[h+3],r+=l}return}for(let u=0;u<c;++u){const h=3*o[u];a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const u=new Uint32Array(i.typedBuffer.buffer,i.start),h=l/4,p=u[r/=4];r+=h;const f=c*s;for(let g=1;g<f;++g)u[r]=p,r+=h}}function Mit(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function iSe(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function rSe(t,e,i,r,s,n){for(const o of e.fields.keys()){const a=t.attributes.get(o),l=a?.indices;if(a&&l)Pit(o,a,i,r,s,n);else if(o===O.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.attributes.get(O.POSITION)?.indices;if(c){const u=c.length,h=s.getField(o,Ma);iSe(t.objectAndLayerIdColor,h,u,n)}}}}function Pit(t,e,i,r,s,n){switch(t){case O.POSITION:{at(e.size===3);const o=s.getField(t,Xn);at(!!o,`No buffer view for ${t}`),o&&PJ(e,i,o,n);break}case O.NORMAL:{at(e.size===3);const o=s.getField(t,Xn);at(!!o,`No buffer view for ${t}`),o&&OJ(e,r,o,n);break}case O.NORMALCOMPRESSED:{at(e.size===2);const o=s.getField(t,d$);at(!!o,`No buffer view for ${t}`),o&&coe(e,o,n);break}case O.UV0:{at(e.size===2);const o=s.getField(t,gx);at(!!o,`No buffer view for ${t}`),o&&coe(e,o,n);break}case O.COLOR:case O.SYMBOLCOLOR:{const o=s.getField(t,Ma);at(!!o,`No buffer view for ${t}`),at(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||tSe(e,e.size,o,n);break}case O.COLORFEATUREATTRIBUTE:{const o=s.getField(t,nU);at(!!o,`No buffer view for ${t}`),at(e.size===1),o&&e.size===1&&Mit(e,o,n);break}case O.TANGENT:{at(e.size===4);const o=s.getField(t,gp);at(!!o,`No buffer view for ${t}`),o&&Ait(e,i,o,n);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{at(e.size===4);const o=s.getField(t,gp);at(!!o,`No buffer view for ${t}`),o&&IC(e,o,n)}}}let FFt=class extends xr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Oit(t,e){sSe(t,e,new Rt("slicePlaneOrigin",(i,r)=>lSe(e,i,r)),new Rt("slicePlaneBasis1",(i,r)=>i5(e,i,r,r.slicePlane?.basis1)),new Rt("slicePlaneBasis2",(i,r)=>i5(e,i,r,r.slicePlane?.basis2)))}function Ks(t,e){sSe(t,e,new Eu("slicePlaneOrigin",(i,r)=>lSe(e,i,r)),new Eu("slicePlaneBasis1",(i,r)=>i5(e,i,r,r.slicePlane?.basis1)),new Eu("slicePlaneBasis2",(i,r)=>i5(e,i,r,r.slicePlane?.basis2)))}function sSe(t,e,...i){if(!e.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function nSe(t,e,i){return t.instancedDoublePrecision?te(Rit,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function oSe(t,e){return t!=null?_e(r5,e.origin,t):e.origin}function aSe(t,e,i){return t.hasSliceTranslatedView?e!=null?Aa($it,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function lSe(t,e,i){if(i.slicePlane==null)return xs;const r=nSe(t,e,i),s=oSe(r,i.slicePlane),n=aSe(t,r,i);return n!=null?Ve(r5,s,n):s}function i5(t,e,i,r){if(r==null||i.slicePlane==null)return xs;const s=nSe(t,e,i),n=oSe(s,i.slicePlane),o=aSe(t,s,i);return o!=null?(me(uA,r,n),Ve(r5,n,o),Ve(uA,uA,o),_e(uA,uA,r5)):r}const Rit=C(),r5=C(),uA=C(),$it=xe();function xx(t,e){const i=e.output===V.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(O.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(x`
     void forwardObjectAndLayerIdColor() {
      ${i?r?x`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:x`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:x``} }`),t.fragment.code.add(x`
      void outputObjectAndLayerIdColor() {
        ${i?x`fragColor = objectAndLayerIdColorVarying;`:x``} }`)}function KU(t){t.uniforms.add(new tm("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function Iit(t,e){const{vertex:i,fragment:r}=t;i.include(KU),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Im,e),r.code.add(x`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?x`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function cSe(t){t.vertex.uniforms.add(new Ue("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===Pl.Occluded?1:i.hudRenderStyle===Pl.NotOccluded?0:.75),new Ei("viewport",(e,i)=>i.camera.fullViewport),new ct("hudVisibilityTexture",(e,i)=>i.hudVisibility?.getTexture())),t.vertex.include(KU),t.vertex.code.add(x`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const uSe=kt(1,1,0,1),RJ=kt(1,0,1,1);function Mv(t){t.fragment.uniforms.add(new ct("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",uSe).add("unoccludedHighlightFlag","vec4",RJ),t.fragment.code.add(x`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let hSe=class extends Ss{constructor(e,i,r){super(e,"vec4",Di.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},el=class extends Ss{constructor(e,i,r){super(e,"float",Di.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},A$=class extends VTe{constructor(){super(...arguments),this.renderOccluded=ki.Occlude,this.isDecoration=!1}};const L2=8;function t0(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(O.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new Rt("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Rt("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Rt("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Rt("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new zh("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Rt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",L2),i.uniforms.add(new el("vvColorValues",s=>s.vvColor.values,L2),new hSe("vvColorColors",s=>s.vvColor.colors,L2)),i.code.add(x`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?x`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const s5=.1,Ro=.001;function Lit(t){const e=new Pi,i=t.signedDistanceFieldEnabled;if(e.include(YTe,t),e.include(Ks,t),t.occlusionPass)return e.include(Iit,t),e;const{vertex:r,fragment:s}=e;e.include(AJ),s.include(Ep),s.include(Rm),e.include(t0,t),e.include(xx,t),e.include(cSe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new Ei("viewport",(c,u)=>u.camera.fullViewport),new Ar("screenOffset",(c,u)=>bi(dSe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new Ar("anchorPosition",c=>n5(c)),new Ei("materialColor",c=>c.color)),mE(r),i&&(r.uniforms.add(new Ei("outlineColor",c=>c.outlineColor)),s.uniforms.add(new Ei("outlineColor",c=>hoe(c)?c.outlineColor:Cu),new Ue("outlineSize",c=>hoe(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(KU),t.hasScreenSizePerspective&&(xit(r),QU(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.FEATUREATTRIBUTE,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?x`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;r.code.add(x`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===V.ObjectAndLayerIdColor?x`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${x.float(Ro)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(Ro)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new ct("tex",c=>c.texture));const a=t.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(s5)})`:x.float(s5),l=x`
    ${t.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?x`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:x`
      vec2 samplePos = vtc;
      `}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(Ro)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?x`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case V.Color:t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(x`
        void main() {
          ${l}
          ${t.transparencyPassType===Qe.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${t.transparencyPassType===Qe.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case V.ObjectAndLayerIdColor:s.code.add(x`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case V.Highlight:s.constants.add("occludedHighlightFlag","vec4",uSe),s.constants.add("unoccludedHighlightFlag","vec4",RJ),s.code.add(x`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function hoe(t){return t.outlineColor[3]>0&&t.outlineSize>0}function n5(t,e=dSe){return t.textureIsSignedDistanceField?Dit(t.anchorPosition,t.distanceFieldBoundingBox,e):ta(e,t.anchorPosition),e}function Dit(t,e,i){e!=null?bi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):bi(i,0,0)}const dSe=it(),Nit=Object.freeze(Object.defineProperty({__proto__:null,build:Lit,calculateAnchorPosForRendering:n5},Symbol.toStringTag,{value:"Module"})),Ac=Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),Fit=Fo(Ee.ONE,Ee.ZERO,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA);function L0(t){return t===Qe.FrontFace?null:Fit}function ez(t){return t===Qe.FrontFace?Oc:null}const tz=5e5,iz={factor:-1,units:-2};function rz(t){return t?iz:null}function Pv(t,e=tr.LESS){return t===Qe.NONE||t===Qe.FrontFace?e:tr.LEQUAL}function D0(t){return t===Qe.ColorAlpha?{buffers:[En.COLOR_ATTACHMENT0,En.COLOR_ATTACHMENT1]}:null}let pSe=class fSe extends Ni{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Fi(e.rctx,fSe.shader.get().build(this.configuration),di)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===Qe.NONE,s=e===Qe.FrontFace,n=this.configuration.hasPolygonOffset?kit:null,o=i.draped?null:(r||s)&&i.output!==V.Highlight&&(i.depthEnabled||i.occlusionPass)?Oc:null;return Lt({blending:i.output===V.Color||i.output===V.Highlight?r?Uit:L0(e):null,depthTest:i.draped?null:{func:tr.LEQUAL},depthWrite:o,drawBuffers:D0(e),colorWrite:qt,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?ui.POINTS:ui.TRIANGLES}};pSe.shader=new Oi(Nit,()=>ue(()=>import("./HUDMaterial.glsl-ac9cad51.js"),[],import.meta.url));const kit={factor:0,units:-4},Uit=Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA);let Xs=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=Qe.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([B({count:V.COUNT})],Xs.prototype,"output",void 0),d([B({count:Qe.COUNT})],Xs.prototype,"transparencyPassType",void 0),d([B()],Xs.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([B()],Xs.prototype,"spherical",void 0),d([B()],Xs.prototype,"occlusionTestEnabled",void 0),d([B()],Xs.prototype,"signedDistanceFieldEnabled",void 0),d([B()],Xs.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),d([B()],Xs.prototype,"vvSize",void 0),d([B()],Xs.prototype,"vvColor",void 0),d([B()],Xs.prototype,"hasVerticalOffset",void 0),d([B()],Xs.prototype,"hasScreenSizePerspective",void 0),d([B()],Xs.prototype,"debugDrawLabelBorder",void 0),d([B()],Xs.prototype,"hasSlicePlane",void 0),d([B()],Xs.prototype,"hasPolygonOffset",void 0),d([B()],Xs.prototype,"depthEnabled",void 0),d([B()],Xs.prototype,"pixelSnappingEnabled",void 0),d([B()],Xs.prototype,"draped",void 0),d([B()],Xs.prototype,"multipassEnabled",void 0),d([B()],Xs.prototype,"cullAboveGround",void 0),d([B()],Xs.prototype,"occlusionPass",void 0),d([B()],Xs.prototype,"objectAndLayerIdColorInstanced",void 0),d([B({constValue:!0})],Xs.prototype,"hasSliceInVertexProgram",void 0),d([B({constValue:!1})],Xs.prototype,"hasVvInstancing",void 0);let LC=class extends Av{constructor(e){super(e,new Zit),this._configuration=new Xs,this.produces=new Map([[ye.HUD_MATERIAL,i=>pN(i)&&!this.parameters.drawInSecondSlot],[ye.LABEL_MATERIAL,i=>pN(i)&&this.parameters.drawInSecondSlot],[ye.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[ye.DRAPED_MATERIAL,i=>pN(i)]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===ye.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===V.Color&&(this._configuration.debugDrawLabelBorder=!!wr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=c.pixelRatio,h*=c.pixelRatio,$u(LV,i),e.attributes.has(O.FEATUREATTRIBUTE)&&Vit(LV);const p=e.attributes.get(O.POSITION),f=e.attributes.get(O.SIZE),g=e.attributes.get(O.NORMAL),_=e.attributes.get(O.CENTEROFFSETANDDISTANCE);at(p.size>=3);const v=n5(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<p.data.length/p.size;w++){const T=w*p.size;te(na,p.data[T],p.data[T+1],p.data[T+2]),Ve(na,na,i);const S=w*f.size;cy[0]=f.data[S]*u,cy[1]=f.data[S+1]*h,Ve(na,na,c.viewMatrix);const A=w*_.size;if(te(Uc,_.data[A],_.data[A+1],_.data[A+2]),!b&&(na[0]+=Uc[0],na[1]+=Uc[1],Uc[2]!==0)){const R=Uc[2];fe(Uc,na),_e(na,na,ie(Uc,Uc,R))}const P=w*g.size;if(te(hA,g.data[P],g.data[P+1],g.data[P+2]),doe(hA,LV,c,DV),this._applyVerticalOffsetTransformationView(na,DV,c,IV),c.applyProjection(na,La),La[0]>-1){b&&(Uc[0]||Uc[1])&&(La[0]+=Uc[0]*c.pixelRatio,Uc[1]!==0&&(La[1]+=SJ(Uc[1],IV.factorAlignment)*c.pixelRatio),c.unapplyProjection(La,na)),La[0]+=this.parameters.screenOffset[0]*c.pixelRatio,La[1]+=this.parameters.screenOffset[1]*c.pixelRatio,La[0]=Math.floor(La[0]),La[1]=Math.floor(La[1]),FTe(cy,IV.factor,cy);const R=Wit*c.pixelRatio;let F=0;if(a.textureIsSignedDistanceField&&(F=a.outlineSize*c.pixelRatio/2),poe(l,La[0],La[1],cy,R,F,a,v)){const k=r.ray;if(Ve(foe,na,Is(jit,c.viewMatrix)),La[0]=l[0],La[1]=l[1],c.unprojectFromRenderScreen(La,na)){const N=C();ae(N,k.direction);const j=1/Se(N);ie(N,N,j),o(hr(k.origin,na)*j,N,-1,!0,1,foe)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get(O.POSITION),l=e.attributes.get(O.SIZE),c=this.parameters,u=n5(c);let{scaleX:h,scaleY:p}=this._getScreenScale(e);h*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const f=Yit*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const _=g*a.size,v=a.data[_],b=a.data[_+1],w=g*l.size;cy[0]=l.data[w]*h,cy[1]=l.data[w+1]*p;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),poe(s,v,b,cy,f,T,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Qit(this)}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?ioe(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?ioe(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=doe(i,r,n,DV);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ae(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ae(n,e);const c=Te(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ie(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Se(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*WTe,l=ie(na,i.normal,o*a);return me(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Se(e);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Se(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=XTe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),ie(i.normal,i.normal,l),me(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ae(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(fe(hA,r),me(r,r,ie(hA,hA,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ae(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ae(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}createGLMaterial(e){return new zit(e)}calculateRelativeScreenBounds(e,i,r=Vt()){return Bit(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(O.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=XO(i.data,qit),[s,n]=EJ(Hit,this.parameters,r);return{scaleX:s,scaleY:n}}},zit=class extends WZ{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(pSe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Bit(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function doe(t,e,i,r){return lit(e)&&(e=$u(Git,e)),On(r.normal,t,e),Ve(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=pe(mSe,Xit),r}function Vit(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),h=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=s*h,t[4]=n*h,t[5]=o*h,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function poe(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,u=i-s-(a[1]>0?r[1]*a[1]:0),h=u+r[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=r[0]*p[0],u+=r[1]*p[1],c-=r[0]*(1-p[2]),h-=r[1]*(1-p[3]),l-=n,c+=n,u-=n,h+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<h}const IV=new KTe,na=C(),hA=C(),La=Yt(),mSe=C(),foe=C(),LV=yr(),Git=yr(),jit=xe(),Uc=C(),Hit=C(),qit=Yt(),DV={normal:mSe,cosAngle:0},Wit=1,Yit=2,cy=[0,0],Xit=Ce(0,0,1);class Zit extends Fwe{constructor(){super(...arguments),this.renderOccluded=ki.Occlude,this.isDecoration=!1,this.color=kt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ci(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=kt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const gSe=cs().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.CENTEROFFSETANDDISTANCE).vec4f(O.FEATUREATTRIBUTE),Jit=gSe.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let Qit=class{constructor(e){this._material=e,this.vertexBufferLayout=se("enable-feature:objectAndLayerId-rendering")?Jit:gSe}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,s,n){PJ(r.attributes.get(O.POSITION),e,s.position,n,6),OJ(r.attributes.get(O.NORMAL),i,s.normal,n,6);const o=r.attributes.get(O.UV0).data;let a,l,c,u;if(o==null||o.length<4){const b=this._material.parameters;a=0,l=0,c=b.texCoordScale[0],u=b.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=r.attributes.get(O.POSITION).indices.length,p=n;const f=s.uv0;for(let b=0;b<h;++b)f.set(p,0,a),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,l),p++;tSe(r.attributes.get(O.COLOR),4,s.color,n,6);const{data:g,indices:_}=r.attributes.get(O.SIZE);h=_.length;const v=s.size;p=n;for(let b=0;b<h;++b){const w=g[2*_[b]],T=g[2*_[b]+1];for(let S=0;S<6;++S)v.set(p,0,w),v.set(p,1,T),p++}if(r.attributes.get(O.CENTEROFFSETANDDISTANCE)?IC(r.attributes.get(O.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):uoe(s.centerOffsetAndDistance,n,6*h),r.attributes.get(O.FEATUREATTRIBUTE)?IC(r.attributes.get(O.FEATUREATTRIBUTE),s.featureAttribute,n,6):uoe(s.featureAttribute,n,6*h),r.objectAndLayerIdColor!=null){const b=r.attributes.get(O.POSITION)?.indices;if(b){const w=b.length,T=s.getField(O.OBJECTANDLAYERIDCOLOR,Ma);iSe(r.objectAndLayerIdColor,T,w,n,6)}}}};const Np=C(),Kx=Yt(),dA=Yt(),NV=C(),Kit=xe(),ert=Ws(),FV=Gn(),trt=C(),irt=Vt();class rrt{constructor(){this.aabr=Vt(),this.distance=0,this.culled=!1,this.visible=!1}}class srt{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var nc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(nc||(nc={}));class nrt{constructor(){this.camera=new br,this.slicePlane=$0(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),yx(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let qS=class extends Pe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new nrt,this._state=nc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new crt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==nc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/nc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case nc.Idle:this._startUpdate(),t.madeProgress();case nc.Process:if(this._state=nc.Process,!this._processActiveGraphics(t))return;case nc.Sort:if(this._state=nc.Sort,!this._sortVisibleGraphics(t))return;case nc.Deconflict:if(this._state=nc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Jtt(this,this._visible),this._state=nc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof LC}_startUpdate(){Qtt(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new rrt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),ort(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=vv(Kit,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?ert:null;let s=0;for(r!=null&&(Ve(r,xs,this._viewState.camera.viewMatrix),r[3]=er(this.view.spatialReference).radius,s=T1e(r,xs));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o?.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===uo.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),eit(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=moe(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=moe(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=art(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(uo.GRAPHIC,Zo.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Mu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=prt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Np)||i!=null&&drt(a,i,r)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Ve(Np,a,r.viewMatrix);const l=n.attributes,c=l.get(O.NORMAL).data,u=l.get(O.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Np,c,s.transformation,u,r,i.scaleInfo,Np),Zr(Kx,Np[0],Np[1],Np[2],1),Cc(dA,Kx,r.projectionMatrix),ie(i.positionNDC,dA,1/dA[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,NV),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(NV[2]),i.distance=NV[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Zr(dA,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Cc(Kx,dA,e),kw(Kx,Kx,1/Kx[3]),te(i.positionView,Np[0],Np[1],Np[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&yZ(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._viewState.camera,o=e.getScreenSize(urt);FTe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=VF(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,irt),Et(0,n.fullWidth,.5+.5*r[0]),Et(0,n.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Ta(a),Il(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}R_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,bk(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new Gt)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,Zo.DECONFLICTION,e),this.visibilityGroup===uo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function ort(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,Zo.DECONFLICTION,!0)}function*moe(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*art(t,e,i){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,Zo.DECONFLICTION);const a=s.info?.[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}d([m({constructOnly:!0})],qS.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],qS.prototype,"updating",null),qS=d([U("esri.views.3d.layers.graphics.Deconflictor")],qS);class lrt{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class crt{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new Gt({allocator:s=>s||new lrt})}}const urt=it();class hrt{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new KTe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}function drt(t,e,i){return ae(FV.direction,t.positionView),te(FV.origin,0,0,0),!!xv(e,FV,trt)&&t.distanceWithoutPolygonOffset>i}const prt=new hrt,frt=2e3;let CN=class extends qS{constructor(e){super(e),this.visibilityGroup=uo.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return $o;const i=performance.now();if(e.state!==gi.IDLE&&i-this._lastDeconfliction<frt)return $o;super.runTask(e),this.state===nc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([m({constructOnly:!0})],CN.prototype,"parent",void 0),CN=d([U("esri.views.3d.layers.graphics.LabelDeconflictor")],CN);let b7=class extends qS{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=uo.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([he(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),he(()=>this.view?.map?.ground?.opacity,(e,i)=>{e!==1&&i!==1||this.setDirty()}),he(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ki)]),this._frameTask=this.view.resourceController.scheduler.registerTask(wt.GRAPHICS_DECONFLICTOR,this),this._labels=new CN({view:this.view,parent:this})}destroy(){this._labels=Oe(this._labels),this._frameTask=gr(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&m1e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){vu(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new srt(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),kV(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!kV(e);r.setVisibilityFlag(uo.GRAPHIC,Zo.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=kV(e);r||mrt(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function kV(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function mrt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(uo.GRAPHIC,Zo.DECONFLICTION,!0))}b7=d([U("esri.views.3d.layers.graphics.GraphicsDeconflictor")],b7);function ySe(t){return"declaredClass"in t}function goe(t){return"declaredClass"in t}function grt(t){return"declaredClass"in t}function yrt(t,e){return t?grt(t)?t:new X_({layer:e,sourceLayer:e,visible:t.visible,symbol:ge(t.symbol),attributes:ge(t.attributes),geometry:_Se(t.geometry)}):null}function _Se(t){return t==null?null:ySe(t)?t:$w(_rt(t))}function _rt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:yoe(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:yoe(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:_}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:_,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:bSe(o)?vSe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function yoe(t){return vrt(t)?t.map(e=>vSe(e)):t}function vSe(t){return t.map(e=>Array.from(e))}function vrt(t){for(const e of t)if(e.length!==0)return bSe(e);return!1}function bSe(t){return t.length>0&&(LR(t[0])||DR(t[0]))}function brt(t,e){if(!t)return null;let i;if(goe(t)){if(e==null)return t.clone();if(goe(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Tv(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function YFt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return We.fromJSON(n)}const $J="__begin__",IJ="__end__",wrt=new RegExp($J,"ig"),xrt=new RegExp(IJ,"ig"),_oe=new RegExp("^"+$J,"i"),voe=new RegExp(IJ+"$","i"),o5='"',Trt=o5+" + ",Srt=" + "+o5;function Crt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function XFt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function LJ(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Crt(t.labelExpression),e.type="conventional"),e}function ZFt(t){const e=LJ(t);if(!e)return null;switch(e.type){case"conventional":return Ert(e.expression);case"arcade":return e.expression}return null}function JFt(t){const e=LJ(t);if(!e)return null;switch(e.type){case"conventional":return Mrt(e.expression);case"arcade":return wSe(e.expression)}return null}function Ert(t){let e;return t?(e=ek(t,i=>$J+'$feature["'+i+'"]'+IJ),e=_oe.test(e)?e.replace(_oe,""):o5+e,e=voe.test(e)?e.replace(voe,""):e+o5,e=e.replaceAll(wrt,Trt).replaceAll(xrt,Srt)):e='""',e}const Art=/^\s*\{([^}]+)\}\s*$/i;function Mrt(t){return t?.match(Art)?.[1].trim()||null}const Prt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,Ort=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Rrt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function wSe(t){if(!t)return null;let e=Prt.exec(t)||Ort.exec(t);return e?e[1]||e[3]:(e=Rrt.exec(t),e?e[2]:null)}const UV=()=>le.getLogger("esri.layers.support.labelFormatUtils"),zV={type:"simple",evaluate:()=>null},$rt={getAttribute:(t,e)=>t.field(e)};async function Irt(t,e,i){if(!t||!t.symbol||!e)return zV;const r=t.where,s=LJ(t);let n;if(s.type==="arcade"){const o=await M4e(s.expression,i,e);if(o==null)return zV;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){UV().error(new W("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>wSe(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":Lrt(u,c)})};if(r){let o;try{o=await bme(r,e)}catch(l){return UV().error(new W("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),zV}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:$rt;try{if(o.testFeature(l,u))return a(l,c)}catch(h){UV().error(new W("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:h}))}return null}}return n}function Lrt(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=Ige(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return t5e(e)?r=W_(r,o4e("short-date")):Gge(e)&&(r=zO(+r)),r||""}function xSe(t,e,i,r,s,n,o,a,l,c,u){const h=Brt[u.mode];let p,f,g=0;if(jr(t,e,i,r,l.spatialReference,s,a))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,u),p=n,f=o):(p=r,f=s),jr(p,l.spatialReference,f,n,c.spatialReference,o,a)?g:void 0}function hv(t,e,i,r,s){const n=(R4(t)?t.z:ybe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Bf(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Bf(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Bf(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Bf(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Drt(t,e,i,r){return hv(t,e,i,r,WS),WS.z}function M$(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:Ts.UPDATE:t.onTheGroundChanged}function Fh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function dv(t){return t!=="absolute-height"}function TSe(t,e,i,r,s){hv(e,i,s,r,WS),SSe(t,WS.verticalDistanceToGround);const n=WS.sampledElevation,o=tn(Vrt,t.transformation);return LI[0]=e.x,LI[1]=e.y,LI[2]=WS.z,Io(e.spatialReference,LI,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function SSe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(O.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],O.CENTEROFFSETANDDISTANCE))}}function Nrt(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],h=t[e+2],p=n.getElevation(c,u,h,a,"ground")??0;o+=p,i[r]=c,i[r+1]=u,i[r+2]=p,e+=3,r+=3}return o/s}function Frt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=n.spatialReference;e*=3,r*=3;for(let p=0;p<s;++p){const f=t[e],g=t[e+1],_=t[e+2],v=n.getElevation(f,g,_,h,"ground")??0;l+=v,i[r]=f,i[r+1]=g,i[r+2]=u==null?_+v+c:v+c,e+=3,r+=3}return l/s}function krt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=n.spatialReference;e*=3,r*=3;for(let p=0;p<s;++p){const f=t[e],g=t[e+1],_=t[e+2],v=n.getElevation(f,g,_,h,"scene")??0;l+=v,i[r]=f,i[r+1]=g,i[r+2]=u==null?_+v+c:v+c,e+=3,r+=3}return l/s}function Urt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function zrt(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<s;++u){const h=t[e],p=t[e+1],f=t[e+2];i[r]=h,i[r+1]=p,i[r+2]=c==null?f+l:l,e+=3,r+=3}return 0}let P$=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Ts;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Ts||(Ts={}));const Brt={"absolute-height":{applyElevationAlignmentBuffer:zrt,requiresAlignment:Urt},"on-the-ground":{applyElevationAlignmentBuffer:Nrt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Frt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:krt,requiresAlignment:()=>!0}},Vrt=xe(),WS=new P$,LI=C();function DJ(t){return t.mapPositions!=null}function CSe(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!DJ(l))continue;const{update:c,averageGeometrySampledElevation:u}=ASe(l,e,i,r,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}function dw(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,$l),SSe(o,$l.verticalDistanceToGround),l=$l.sampledElevation):(r(a,$l),e.mode!=="absolute-height"&&(l=$l.sampledElevation));const c=tn(Grt,n??o.transformation),u=te(ESe,c[12],c[13],c[14]);wr.TESTS_DISABLE_OPTIMIZATIONS?(Rl[0]=a.x,Rl[1]=a.y,Rl[2]=$l.z,Io(a.spatialReference,Rl,c,s.spatialReference)&&(n?tn(n,c):o.transformation=c)):s.setAltitudeOfTransformation($l.z,c);const h=NJ/s.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(n?tn(n,c):o.transformation=c),l}const Grt=xe();function jrt(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,$l);const a=e.mode!=="absolute-height"?$l.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=qrt;l.getGlobalTransform(c,u);const h=te(ESe,u[12],u[13],u[14]);wr.TESTS_DISABLE_OPTIMIZATIONS?(Rl[0]=o.x,Rl[1]=o.y,Rl[2]=$l.z,Io(o.spatialReference,Rl,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation($l.z,u);const p=NJ/s.unitInMeters;return(wr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=p||Math.abs(u[13]-h[1])>=p||Math.abs(u[14]-h[2])>=p)&&l.setGlobalTransform(c,u),a}function Hrt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!DJ(h))continue;const p=h.attributes.get(O.POSITION);if(p!==l){const{update:f,averageGeometrySampledElevation:g}=ASe(h,e,i,r,s);c=g,l=p,u=f}u&&n.geometryVertexAttributeUpdated(h,O.POSITION),a+=c}return a/o.length}const NJ=.01,Rl=C(),Uu=C(),eT=C(),qrt=xe(),ESe=C(),$l=new P$;function ASe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;Uu[0]=o[12],Uu[1]=o[13],Uu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,u=l.size,h=c.length/u,p=new OZ(t.mapPositions,i);let f=0,g=0;for(let _=0;_<h;_++){if(eT[0]=c[f],eT[1]=c[f+1],eT[2]=c[f+2],r(p,$l),a&&(g+=$l.sampledElevation),wr.TESTS_DISABLE_OPTIMIZATIONS)c[f]=p.array[p.offset],c[f+1]=p.array[p.offset+1],c[f+2]=$l.z,jr(c,i,f,c,s.spatialReference,f,1),c[f]-=Uu[0],c[f+1]-=Uu[1],c[f+2]-=Uu[2],n=!0;else{Rl[0]=c[f]+Uu[0],Rl[1]=c[f+1]+Uu[1],Rl[2]=c[f+2]+Uu[2],s.setAltitude(Rl,$l.z),c[f]=Rl[0]-Uu[0],c[f+1]=Rl[1]-Uu[1],c[f+2]=Rl[2]-Uu[2];const v=NJ/s.unitInMeters;(Math.abs(eT[0]-c[f])>=v||Math.abs(eT[1]-c[f+1])>=v||Math.abs(eT[2]-c[f+2])>=v)&&(n=!0)}f+=u,p.offset+=3}return g/=h,{update:n,averageGeometrySampledElevation:g}}const Wrt=()=>le.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Yrt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function KFt(t){const e=t?.expression;if(typeof e=="string"){const i=OSe(e);if(i!=null)return{cachedResult:i}}return null}async function e4t(t,e,i,r){const s=t?.expression;if(typeof s!="string")return null;const n=OSe(s);if(n!=null)return{cachedResult:n};const o=await HY();yt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function MSe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function sz(t,e){if(t!=null&&!PSe(t)){if(!e||!t.arcade)return void Wrt().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=_Se(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Xrt(t){if(t!=null){if(PSe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function t4t(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const Zrt={cachedResult:0};function PSe(t){return t.cachedResult!=null}function OSe(t){return t==="0"?0:null}let a5=class RSe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Yve(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Xrt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=EHe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e?.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=Yrt(e),sz(this._featureExpressionInfoContext,MSe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new RSe;return e!=null&&i.setFromElevationInfo(e),i}},Jrt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};function FJ(t,e){if(t.type==="point")return uy(t,e,!1);if(ySe(t))switch(t.type){case"extent":return uy(t.center,e,!1);case"polygon":return uy(t.centroid,e,!1);case"polyline":return uy(boe(t),e,!0);case"mesh":return uy(t.origin,e,!1)}else switch(t.type){case"extent":return uy(Qrt(t),e,!0);case"polygon":return uy(Krt(t),e,!0);case"polyline":return uy(boe(t),e,!0)}}function boe(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=kfe(e,vY(e)/2);return Tv(i[0],i[1],i[2],t.spatialReference)}function Qrt(t){return Tv(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Krt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=Bfe(t.rings,!!t.hasZ);return Tv(i[0],i[1],i[2],t.spatialReference)}function uy(t,e,i){const r=i?t:brt(t);return e&&t?Lye(t,r,e)?r:null:r}function r4t(t,e,i,r=0){if(t){e||(e=Vt());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Zr(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function aO(t,e,i=null){const r=n$(wh);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function s4t(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=t?.[o]!=null?t[o]:i?.[o]!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function woe(t=Uf,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,h=a===0&&!n&&!u,p=i[a];l==="symbol-value"||h?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return ya(s)}function est(t){return t.isPrimitive!=null}function nz(t){return w7(est(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function w7(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function tst(t,e,i,r=xe()){return t&&nC(r,r,-t/180*Math.PI),e&&sC(r,r,e/180*Math.PI),i&&Bk(r,r,i/180*Math.PI),r}function kJ(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=sl(e),s=sx(t)*r,n=nx(t)*r,o=yv(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var pu;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(pu||(pu={}));let ist=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Lm=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=xoe(s.baseMaterial);let a=!1;for(const l of s.edgeMaterials)l.objectTransparency!==o&&(l.objectTransparency=o,a=!0);a&&this.resetEdgeObject(i),n.stage.renderer.withEdgeView(l=>{l.updateAllComponentOpacities(r,[e])})}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterials,{hasSlicePlane:e},!i),s.properties.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&sz(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>hv(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=C()){return ae(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=pn()){const i=this.stageObject.boundingVolumeObjectSpace;return m0e(e,i.min),g0e(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(qm)&&(Ve(qm,qm,i),me(e.render.origin,e.render.origin,qm),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=rst,l=sX(o)?1:a.length;for(let u=0;u<l;u++){const h=a[u];hy[0]=o[h[0]],hy[1]=o[h[1]],hy[2]=o[h[2]],Ve(hy,hy,this.stageObject.transformation),Kv[3*u]=hy[0],Kv[3*u+1]=hy[1],Kv[3*u+2]=hy[2]}if(!e(Kv,0,l))return null;Or(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],Kv[u+h]),o[h+3]=Math.max(o[h+3],Kv[u+h]);c&&r.push({location:Kv.slice(u,u+3),screenSpaceBoundingRect:c})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){qd(o,qm);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(i.useViewElevation)h=i.service.getElevation(qm[0],qm[1],u)??0;else try{const p=kJ(o,i.service.spatialReference,i);h=await i.service.queryElevation(qm[0],qm[1],s,p,u)??0}catch{}f0e(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,i){e===_0.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===_0.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=xoe(e.baseMaterial);for(const n of e.edgeMaterials)n.objectTransparency=s;i.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then(()=>this._stageLayer?.sync())}};function xoe(t){return t.isVisible()?t.parameters.transparent?pu.TRANSPARENT:pu.OPAQUE:pu.INVISIBLE}const Kv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hy=C(),qm=C(),rst=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let $Se=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const ISe=3,x7=3,LSe=10;let DSe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},NSe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get(O.POSITION).indices.length,0)}get geometries(){return J5(this.components.map(e=>e.geometry))}},FSe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function DI(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),J5(e)}function Toe(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),J5(e)}function Soe(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),J5(e)}function sst(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function kSe(t,e){const i=(r,s,n=!1)=>new FSe(r.map(o=>{const a=s(o.tesselation);return n&&AJe(a),new NSe([new DSe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>TJe(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>fJe(e,1));case"cone":return i(BV,r=>jse(e,1,.5,r,!1),!0);case"inverted-cone":return i(BV,r=>jse(e,1,.5,r,!0),!0);case"cylinder":return i(BV,r=>CJe(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>xJe(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>_Je(e,1),!0);default:return}}const BV=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let mh=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new USe}},UJ=class extends mh{constructor(e){super(e),this.estimated=!0}},nst=class extends mh{constructor(e,i){super(i),this.numComplexities=e}},ost=class extends UJ{constructor(e,i){super(i),this.numComplexities=e}},USe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function ast(t){return t.type==="fill"}function lst(t){return t.type==="extrude"}function zJ(t,e,i=0){const r=Te(t,0,hst);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*dst(r*cst[s]))}function BJ(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*ust[r];return i}const cst=[1,256,65536,16777216],ust=[1/256,1/65536,1/16777216,1/4294967296],hst=BJ(new Uint8ClampedArray([255,255,255,255]));function dst(t){return t-Math.floor(t)}var Mn;function pst(t){switch(t){case"multiply":default:return Mn.Multiply;case"ignore":return Mn.Ignore;case"replace":return Mn.Replace;case"tint":return Mn.Tint}}function zSe(t,e,i){if(t==null||e===Mn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Te(Math.round(t[3]*l5),0,l5),s=r===0||e===Mn.Tint?0:e===Mn.Replace?fst:mst;i[0]=Te(Math.round(t[0]*tT),0,tT),i[1]=Te(Math.round(t[1]*tT),0,tT),i[2]=Te(Math.round(t[2]*tT),0,tT),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Mn||(Mn={}));const tT=255,l5=85,fst=l5,mst=2*l5;function BSe(t){t.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(Mn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(Mn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(Mn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(Mn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let c5=class extends Ss{constructor(e,i){super(e,"vec4",Di.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},gst=class extends Ss{constructor(e,i){super(e,"int",Di.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var rm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(rm||(rm={}));const VJ=429496.7296;function yst(t,e){zJ(t/VJ*.5+.5,e)}function _st(t,e){switch(e.componentData){case rm.Varying:return vst(t,e);case rm.Uniform:return bst(t,e);case rm.COUNT:return;default:e.componentData}}function vst(t,e){const{vertex:i,fragment:r}=t;i.include(Ep),i.uniforms.add(new em("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===V.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(BSe),i.constants.add("elevationScale","float",2*VJ),i.constants.add("stride","float",se("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(x`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(x`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?x`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:x`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(x`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?x`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function bst(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new c5("externalColor",n=>n.componentParameters.externalColor)),r.uniforms.add(new gst("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),i.code.add(x`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===V.ObjectAndLayerIdColor;r.code.add(x`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${s?x`fragColor = vec4(0,0,0,0);`:""}
 }
`)}function vE(t,e){switch(e.normalType){case zi.Compressed:t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(x`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case zi.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(x`vec3 normalModel() {
return normal;
}`);break;case zi.ScreenDerivative:t.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case zi.COUNT:case zi.Ground:}}var zi;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(zi||(zi={}));function _4t(t,e){const i=t.vertex;i.include(Ep),t.include(vE,e),i.uniforms.add(new Ue("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new em("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(O.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*VJ),i.code.add(x`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?x`decompressNormal(normal2Compressed)`:x`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new U4("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMAL2COMPRESSED,"vec2"),i.code.add(x`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(x`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(QZ,e),i.uniforms.add(new zh("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new U4("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Eu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Eu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Rt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Rt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Gr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function v4t(t){return t===DC.Sketch||t===DC.Mixed}var DC,Coe;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(DC||(DC={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Coe||(Coe={}));function wst(t){return t&&t.enabled&&(lst(t)||ast(t))&&t.edges!=null}function xst(t){return t&&t.enabled&&t.edges||null}function VSe(t,e){return Tst(xst(t),e)}function Tst(t,e){if(t==null)return null;const i=t.color!=null?XO(et.toUnitRGBA(t.color)):kt(0,0,0,0),r=dn(t.size),s=dn(t.extensionLength);switch(t.type){case"solid":return Sst({color:i,size:r,extensionLength:s,...e});case"sketch":return Cst({color:i,size:r,extensionLength:s,...e});default:return}}function Sst(t){return{...Est,...t,type:DC.Solid}}function Cst(t){return{...Ast,...t,type:DC.Sketch}}const Est={color:kt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:pu.OPAQUE,hasSlicePlane:!1},Ast={color:kt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:pu.OPAQUE,hasSlicePlane:!1};function GSe(t,e){const i=t.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case as.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case as.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case as.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case as.COUNT:}}var as;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(as||(as={}));let O$=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const NI=pn();function jSe(t,e,i,r,s,n){if(!t.visible)return;const o=yi(XSe,r,i),a=(c,u,h)=>{n(c,h,u,!1)},l=new O$(!1,e.options.normalRequired);if(t.boundingInfo){at(t.type===ws.Mesh);const c=e.tolerance;HSe(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get(O.POSITION),u=c.indices;YSe(i,o,0,u.length/3,u,c.data,c.stride,s,l,a)}}const Mst=C();function HSe(t,e,i,r,s,n,o){if(t==null)return;const a=Nst(i,Mst);if(m0e(NI,t.bbMin),g0e(NI,t.bbMax),s?.applyToAabb(NI),jJ(NI,e,a,r)){const{primitiveIndices:l,position:c}=t,u=l?l.length:c.indices.length/3;if(u>Fst){const h=t.getChildren();if(h!==void 0){for(const p of h)HSe(p,e,i,r,s,n,o);return}}Ost(e,i,0,u,c.indices,c.data,c.stride,l,s,n,o)}}const Gb=C();function qSe(t,e,i,r,s,n,o,a,l){const{data:c,stride:u}=n;YSe(t,yi(XSe,e,t),i,r,s,c,u,o,a,l)}function WSe(t,e,i,r,s,n,o,a,l,c=null,u=0){const h=t[0],p=t[1],f=t[2],g=e[0],_=e[1],v=e[2];for(let b=i;b<r;++b){const w=u+(c?c[b]:b),T=3*w,S=o*s[T],A=n[S],P=n[S+1],R=n[S+2],F=o*s[T+1],k=n[F],N=n[F+1],j=n[F+2],z=o*s[T+2],X=k-A,q=N-P,Z=j-R,ce=n[z]-A,I=n[z+1]-P,D=n[z+2]-R,G=_*D-I*v,H=v*ce-D*g,J=g*I-ce*_,Q=X*G+q*H+Z*J;if(Math.abs(Q)<=qJ)continue;const ee=h-A,de=p-P,we=f-R,Re=ee*G+de*H+we*J;if(Q>0){if(Re<0||Re>Q)continue}else if(Re>0||Re<Q)continue;const tt=de*Z-q*we,Ye=we*X-Z*ee,qe=ee*q-X*de,He=g*tt+_*Ye+v*qe;if(Q>0){if(He<0||Re+He>Q)continue}else if(He>0||Re+He<Q)continue;const je=(ce*tt+I*Ye+D*qe)/Q;je>=0&&l(je,w,a?GJ(X,q,Z,ce,I,D,Gb):null)}}function Pst(t,e,i,r,s,n,o,a,l,c,u,h=null,p=0){const f=t[0],g=t[1],_=t[2],v=e[0],b=e[1],w=e[2];for(let T=i;T<r;++T){const S=p+(h?h[T]:T),A=3*S,P=o*s[A],R=n[P],F=n[P+1],k=n[P+2],N=o*s[A+1],j=n[N],z=n[N+1],X=n[N+2],q=o*s[A+2],Z=n[q],ce=n[q+1],I=n[q+2],D=k-l,G=a/Math.sqrt(R*R+F*F+D*D),H=R+R*G,J=F+F*G,Q=k+D*G,ee=X-l,de=a/Math.sqrt(j*j+z*z+ee*ee),we=j+j*de,Re=z+z*de,tt=X+ee*de,Ye=I-l,qe=a/Math.sqrt(Z*Z+ce*ce+Ye*Ye),He=we-H,je=Re-J,Jt=tt-Q,Wt=Z+Z*qe-H,Le=ce+ce*qe-J,Dt=I+Ye*qe-Q,De=b*Dt-Le*w,$e=w*Wt-Dt*v,_t=v*Le-Wt*b,bt=He*De+je*$e+Jt*_t;if(Math.abs(bt)<=qJ)continue;const $t=f-H,st=g-J,Be=_-Q,Ge=$t*De+st*$e+Be*_t;if(bt>0){if(Ge<0||Ge>bt)continue}else if(Ge>0||Ge<bt)continue;const St=st*Jt-je*Be,jt=Be*He-Jt*$t,Wi=$t*je-He*st,ai=v*St+b*jt+w*Wi;if(bt>0){if(ai<0||Ge+ai>bt)continue}else if(ai>0||Ge+ai<bt)continue;const pi=(Wt*St+Le*jt+Dt*Wi)/bt;pi>=0&&u(pi,S,c?GJ(He,je,Jt,Wt,Le,Dt,Gb):null)}}function Ost(t,e,i,r,s,n,o,a,l,c,u){const h=t[0],p=t[1],f=t[2],g=e[0],_=e[1],v=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const T=a[w],S=3*T,A=o*s[S];let P=n[A],R=n[A+1],F=n[A+2];const k=o*s[S+1];let N=n[k],j=n[k+1],z=n[k+2];const X=o*s[S+2];let q=n[X],Z=n[X+1],ce=n[X+2];l!=null&&([P,R,F]=l.applyToVertex(P,R,F,w),[N,j,z]=l.applyToVertex(N,j,z,w),[q,Z,ce]=l.applyToVertex(q,Z,ce,w));const I=N-P,D=j-R,G=z-F,H=q-P,J=Z-R,Q=ce-F,ee=_*Q-J*v,de=v*H-Q*g,we=g*J-H*_,Re=I*ee+D*de+G*we;if(Math.abs(Re)<=qJ)continue;const tt=h-P,Ye=p-R,qe=f-F,He=tt*ee+Ye*de+qe*we;if(Re>0){if(He<0||He>Re)continue}else if(He>0||He<Re)continue;const je=Ye*G-D*qe,Jt=qe*I-G*tt,Wt=tt*D-I*Ye,Le=g*je+_*Jt+v*Wt;if(Re>0){if(Le<0||He+Le>Re)continue}else if(Le>0||He+Le<Re)continue;const Dt=(H*je+J*Jt+Q*Wt)/Re;Dt>=0&&u(Dt,T,b?GJ(I,D,G,H,J,Q,Gb):null)}}function YSe(t,e,i,r,s,n,o,a,l,c){const u=e,h=kst,p=Math.abs(u[0]),f=Math.abs(u[1]),g=Math.abs(u[2]),_=p>=f?p>=g?0:2:f>=g?1:2,v=_,b=u[v]<0?2:1,w=(_+b)%3,T=(_+(3-b))%3,S=u[w]/u[v],A=u[T]/u[v],P=1/u[v],R=Rst,F=$st,k=Ist,{normalRequired:N}=l;for(let j=i;j<r;++j){const z=3*j,X=o*s[z];te(h[0],n[X+0],n[X+1],n[X+2]);const q=o*s[z+1];te(h[1],n[q+0],n[q+1],n[q+2]);const Z=o*s[z+2];te(h[2],n[Z+0],n[Z+1],n[Z+2]),a&&(ae(h[0],a.applyToVertex(h[0][0],h[0][1],h[0][2],j)),ae(h[1],a.applyToVertex(h[1][0],h[1][1],h[1][2],j)),ae(h[2],a.applyToVertex(h[2][0],h[2][1],h[2][2],j))),yi(R,h[0],t),yi(F,h[1],t),yi(k,h[2],t);const ce=R[w]-S*R[v],I=R[T]-A*R[v],D=F[w]-S*F[v],G=F[T]-A*F[v],H=k[w]-S*k[v],J=k[T]-A*k[v],Q=H*G-J*D,ee=ce*J-I*H,de=D*I-G*ce;if((Q<0||ee<0||de<0)&&(Q>0||ee>0||de>0))continue;const we=Q+ee+de;if(we===0)continue;const Re=Q*(P*R[v])+ee*(P*F[v])+de*(P*k[v]);if(Re*Math.sign(we)<0)continue;const tt=Re/we;tt>=0&&c(tt,j,N?Lst(h):null)}}const Rst=C(),$st=C(),Ist=C();function GJ(t,e,i,r,s,n,o){return te(u5,t,e,i),te(h5,r,s,n),Ke(o,u5,h5),fe(o,o),o}function Lst(t){return yi(u5,t[1],t[0]),yi(h5,t[2],t[0]),Ke(Gb,u5,h5),fe(Gb,Gb),Gb}const u5=C(),h5=C();function Dst(t,e,i){return te(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Nst(t,e){return te(e,1/t[0],1/t[1],1/t[2])}function jJ(t,e,i,r){return HJ(t,e,i,r,1/0)}function HJ(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const h=(t[2]-r-e[2])*i[2],p=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(h,p)),!(l<0)&&(a=Math.max(a,Math.min(h,p)),!(a>l)&&a<s)}const Fst=1e3,qJ=1e-7,XSe=C(),kst=[C(),C(),C()];let bE=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(O.POSITION).indices.length}write(e,i,r,s,n){rSe(r,this.vertexBufferLayout,e,i,s,n)}};function oz(t,e){switch(e.normalType){case zi.Attribute:case zi.Compressed:t.include(vE,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new U4("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new zh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case zi.Ground:t.include(A2,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(x`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case zi.ScreenDerivative:t.vertex.code.add(x`void forwardNormal() {}`);break;default:e.normalType;case zi.COUNT:}}let ZSe=class extends qZe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=yr()}},JSe=class extends WZe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=yr(),this.toMapSpace=Yt()}};const WJ={func:tr.LESS},d5={func:tr.ALWAYS},ym={mask:255},QSe={mask:0},Ust=t=>({function:{func:tr.NOTEQUAL,ref:t,mask:t},operation:{fail:es.KEEP,zFail:es.KEEP,zPass:es.KEEP}}),zst=t=>({function:{func:tr.ALWAYS,ref:t,mask:t},operation:{fail:es.KEEP,zFail:es.KEEP,zPass:es.REPLACE}}),Ov={function:{func:tr.ALWAYS,ref:Nl.OutlineVisualElementMask,mask:Nl.OutlineVisualElementMask},operation:{fail:es.KEEP,zFail:es.KEEP,zPass:es.ZERO}},pv={function:{func:tr.ALWAYS,ref:Nl.OutlineVisualElementMask,mask:Nl.OutlineVisualElementMask},operation:{fail:es.KEEP,zFail:es.KEEP,zPass:es.REPLACE}},KSe={function:{func:tr.EQUAL,ref:Nl.OutlineVisualElementMask,mask:Nl.OutlineVisualElementMask},operation:{fail:es.KEEP,zFail:es.KEEP,zPass:es.KEEP}},e2e={function:{func:tr.NOTEQUAL,ref:Nl.OutlineVisualElementMask,mask:Nl.OutlineVisualElementMask},operation:{fail:es.KEEP,zFail:es.KEEP,zPass:es.KEEP}};function t2e({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ho(n,xs))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function S4t({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ho(n,xs))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const az=[1,1,.5],YJ=[0,.6,.2],Bst=[0,1,.2];function i2e(t){t.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let wE=class extends Ss{constructor(e,i){super(e,"int",Di.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function r2e(t,e){e.hasSymbolColors?(t.include(BSe),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new wE("colorMixMode",i=>JTe[i.colorMixMode])),t.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Tx(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function XJ(t){t.code.add(x`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function lz(t,e){switch(e.output){case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:case V.ViewshedShadow:t.fragment.include(XJ),t.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function Vst(t){t.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(Ro)}) { discard; } }
  `)}let s2e=class extends Ss{constructor(e,i){super(e,"float",Di.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function YS(t,e){n2e(t,e,new Ue("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Gst(t,e){n2e(t,e,new s2e("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function n2e(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==mr.Mask&&e.alphaDiscardMode!==mr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case mr.Blend:return t.include(Vst);case mr.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case mr.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case mr.MaskBlend:t.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function o2e(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==mr.Opaque;switch(e.output){case V.Depth:Dl(i,e),t.include(Sa,e),t.include(Ks,e),t.include(Yd,e),s&&r.uniforms.add(new ct("tex",n=>n.texture)),i.code.add(x`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(YS,e),r.code.add(x`
          void main(void) {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:case V.ViewshedShadow:case V.ObjectAndLayerIdColor:Dl(i,e),t.include(Sa,e),t.include(Yd,e),t.include(t0,e),t.include(lz,e),t.include(Ks,e),t.include(xx,e),BU(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new ct("tex",n=>n.texture)),i.code.add(x`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(YS,e),r.code.add(x`
          void main(void) {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===V.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:x`outputDepth(depth);`}
          }
        `);break;case V.Normal:{Dl(i,e),t.include(Sa,e),t.include(vE,e),t.include(oz,e),t.include(Yd,e),t.include(t0,e),s&&r.uniforms.add(new ct("tex",o=>o.texture)),e.normalType===zi.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===zi.Attribute||e.normalType===zi.Compressed;i.code.add(x`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?x`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:x`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Ks,e),t.include(YS,e),r.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===zi.ScreenDerivative?x`vec3 normal = screenDerivativeNormal(vPositionView);`:x`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case V.Highlight:Dl(i,e),t.include(Sa,e),t.include(Yd,e),t.include(t0,e),s&&r.uniforms.add(new ct("tex",n=>n.texture)),i.code.add(x`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Ks,e),t.include(YS,e),t.include(Mv,e),r.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function a2e(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===as.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Qr.None&&(t.include(qZ,e),i.uniforms.add(e.pbrTextureBindType===Di.Pass?new ct("normalTexture",r=>r.textureNormal):new em("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new Ar("scale",r=>r.scale??eU)),i.uniforms.add(new zh("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??dx))),i.code.add(x`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(x`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(x`return tangentSpace * rawNormal;
}`))}let pS=class extends Pe{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([he(()=>this.view.ready,e=>{e&&this.view._stage?.renderer.addRenderNode(this)},Ki)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}render(){throw new W("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,i=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return i.fbo?.initializeAndBind(),i}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===Vi.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,i){this._context=i,this._frameBuffer=e.find(({name:r})=>r===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};d([m({constructOnly:!0})],pS.prototype,"view",void 0),d([m({constructOnly:!0})],pS.prototype,"consumes",void 0),d([m()],pS.prototype,"produces",void 0),pS=d([U("esri.views.3d.webgl.RenderNode")],pS);const R$=pS,l2e=3e5,p5=5e5;let c2e=class extends Ss{constructor(e,i){super(e,"vec2",Di.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const VV=4;function jst(){const t=new Pi,e=t.fragment;t.include(ra);const i=(VV+1)/2,r=1/(2*i*i);return e.include(Cm),e.uniforms.add(new ct("depthMap",s=>s.depthTexture),new em("tex",s=>s.colorTexture),new c2e("blurSize",s=>s.blurSize),new Ue("projScale",(s,n)=>{const o=hr(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(x`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${x.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(x`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${x.int(VV)}; r <= ${x.int(VV)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const Hst=Object.freeze(Object.defineProperty({__proto__:null,build:jst},Symbol.toStringTag,{value:"Module"}));let u2e=class h2e extends Ni{initializeProgram(e){return new Fi(e.rctx,h2e.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};u2e.shader=new Oi(Hst,()=>ue(()=>import("./SSAOBlur.glsl-6f54ba96.js"),[],import.meta.url));const qst="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let Wst=class extends xr{constructor(){super(...arguments),this.projScale=1}},Yst=class extends Wst{constructor(){super(...arguments),this.intensity=1}},Xst=class extends xr{},Zst=class extends Xst{constructor(){super(...arguments),this.blurSize=it()}};function $$(t){t.fragment.uniforms.add(new Ei("projInfo",(e,i)=>Jst(i.camera))),t.fragment.uniforms.add(new Ar("zScale",(e,i)=>Qst(i.camera))),t.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Jst(t){const e=t.projectionMatrix;return e[11]===0?Zr(Eoe,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Zr(Eoe,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Eoe=Yt();function Qst(t){return t.projectionMatrix[11]===0?bi(Aoe,0,1):bi(Aoe,1,0)}const Aoe=it(),Moe=16;function Kst(){const t=new Pi,e=t.fragment;return t.include(ra),t.include($$),e.include(Cm),e.uniforms.add(new Ue("radius",(i,r)=>ZJ(r.camera))).code.add(x`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new ct("normalMap",i=>i.normalTexture),new ct("depthMap",i=>i.depthTexture),new Ue("projScale",i=>i.projScale),new ct("rnm",i=>i.noiseTexture),new Ar("rnmScale",(i,r)=>bi(Poe,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new Ue("intensity",i=>i.intensity),new Ar("screenSize",(i,r)=>bi(Poe,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(x`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${x.int(Moe)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${x.int(Moe)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function ZJ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Poe=it(),ent=Object.freeze(Object.defineProperty({__proto__:null,build:Kst,getRadius:ZJ},Symbol.toStringTag,{value:"Module"}));let d2e=class p2e extends Ni{initializeProgram(e){return new Fi(e.rctx,p2e.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};d2e.shader=new Oi(ent,()=>ue(()=>import("./SSAO.glsl-1d7c48f0.js"),[],import.meta.url));const qM=2;let sb=class extends R${constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new Yst,this._drawParameters=new Zst}initialize(){const e=Uint8Array.from(atob(qst),r=>r.charCodeAt(0)),i=new $r;i.wrapMode=hi.CLAMP_TO_EDGE,i.pixelFormat=Pt.RGB,i.wrapMode=hi.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new ur(this.renderingContext,i,e),this._ssaoTechnique=this.techniques.acquire(d2e),this._blurTechnique=this.techniques.acquire(u2e),this.addHandles(he(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Tt(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const i=this.bindParameters,r=e.find(({name:A})=>A==="normals"),s=r?.getTexture(),n=r?.getTexture(MC),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],u=Math.round(l/qM),h=Math.round(c/qM);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=performance.now(),this.requestRender(),o.acquire(u,h,"ssao",kr.RED);this._enableTime===0&&(this._enableTime=performance.now());const p=this.renderingContext,f=this.view.qualitySettings.fadeDuration,g=a.relativeElevation,_=Te((p5-g)/(p5-l2e),0,1),v=f>0?Math.min(f,performance.now()-this._enableTime)/f:1,b=v*_;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*tnt/ZJ(a)**6*b;const w=o.acquire(l,c,"ssao input",kr.RG);p.unbindTexture(w.fbo.colorTexture),p.bindFramebuffer(w.fbo),p.setViewport(0,0,l,c),p.bindTechnique(this._ssaoTechnique,i,this._passParameters,this._drawParameters),p.screen.draw();const T=o.acquire(u,h,"ssao blur",kr.RED);p.unbindTexture(T.fbo.colorTexture),p.bindFramebuffer(T.fbo),this._drawParameters.colorTexture=w.getTexture(),bi(this._drawParameters.blurSize,0,qM/c),p.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),p.setViewport(0,0,u,h),p.screen.draw(),w.release();const S=o.acquire(u,h,"ssao",kr.RED);return p.unbindTexture(S.fbo.colorTexture),p.bindFramebuffer(S.fbo),p.setViewport(0,0,l,c),p.setClearColor(1,1,1,0),p.clear(Sr.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=T.getTexture(),bi(this._drawParameters.blurSize,qM/l,0),p.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),p.setViewport(0,0,u,h),p.screen.draw(),p.setViewport4fv(a.fullViewport),T.release(),v<1&&this.requestRender(Vi.UPDATE),S}};d([m()],sb.prototype,"consumes",void 0),d([m()],sb.prototype,"produces",void 0),d([m({constructOnly:!0})],sb.prototype,"techniques",void 0),d([m({constructOnly:!0})],sb.prototype,"isEnabled",void 0),sb=d([U("esri.views.3d.webgl-engine.effects.ssao.SSAO")],sb);const tnt=.5;function I$(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new ct("ssaoTex",(r,s)=>s.ssao?.getTexture())),i.constants.add("blurSizePixelsInverse","float",1/qM),i.code.add(x`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(x`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function int(t){const e=t.fragment.code;e.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function JJ(t,e){const i=t.fragment.code;t.include(w$),e.pbrMode!==mt.Normal&&e.pbrMode!==mt.Schematic&&e.pbrMode!==mt.Simplified&&e.pbrMode!==mt.TerrainWithWater||(i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==mt.Normal&&e.pbrMode!==mt.Schematic||(t.include(int),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function rnt(t,e){const i=t.fragment.code;t.include(w$),i.add(x`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function L$(t){t.constants.add("ambientBoostFactor","float",uxe)}function xE(t){t.uniforms.add(new Ue("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function Ww(t,e){const i=t.fragment;switch(t.include(I$,e),e.pbrMode!==mt.Disabled&&t.include(JJ,e),t.include(XZ,e),t.include(w$),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===mt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),L$(i),xE(i),I0(i),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Em(i),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case mt.Disabled:case mt.WaterOnIntegratedMesh:case mt.Water:t.include(I4),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case mt.Normal:case mt.Schematic:i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new tm("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new Ue("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Ue("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==mt.Schematic||e.hasColorTexture?x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case mt.Simplified:case mt.TerrainWithWater:t.include(I4),i.code.add(x`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case mt.COUNT:}}let snt=class extends Ss{constructor(e,i,r){super(e,"mat4",Di.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},T7=class extends Ss{constructor(e,i,r){super(e,"mat4",Di.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},nnt=class extends xr{constructor(){super(...arguments),this.modelTransformation=Cr}},QJ=class extends nnt{constructor(){super(...arguments),this.origin=C()}};function D$(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new T7("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),f2e(t))}function NC(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new snt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),f2e(t))}function f2e(t){const e=t.fragment;e.include(XJ),e.uniforms.add(new ct("shadowMap",(i,r)=>r.shadowMap.depthTexture),new wE("numCascades",(i,r)=>r.shadowMap.numCascades),new Ei("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(x`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function ont(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new zh("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??dx)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(x`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardColorUV(){}`)}function ant(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==Qr.None?(t.vertex.uniforms.add(new zh("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??dx)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(x`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardNormalUV(){}`)}function lnt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==Qr.None?(t.vertex.uniforms.add(new zh("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??dx)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(x`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardEmissiveUV(){}`)}function cnt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==Qr.None?(t.vertex.uniforms.add(new zh("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??dx)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(x`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardOcclusionUV(){}`)}function unt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==Qr.None?(t.vertex.uniforms.add(new zh("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??dx)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(x`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardMetallicRoughnessUV(){}`)}function KJ(t){t.include(Rm),t.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(Mn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(Mn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Mn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(Mn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Mn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function hnt(t){const e=new Pi,{vertex:i,fragment:r,varyings:s}=e;if(Dl(i,t),e.include(x$),s.add("vpos","vec3"),e.include(t0,t),e.include(yxe,t),e.include(HTe,t),e.include(ont,t),t.output===V.Color){e.include(ant,t),e.include(lnt,t),e.include(cnt,t),e.include(unt,t),wp(i,t),e.include(vE,t),e.include(Sa,t);const n=t.normalType===zi.Attribute||t.normalType===zi.Compressed;n&&t.offsetBackfaces&&e.include(i2e),e.include(a2e,t),e.include(oz,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Yd,t),e.include(gE,t),e.include(r2e,t),e.include(Tx,t),i.uniforms.add(new Ei("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),i.code.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(Ro)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),e.include(Ks,t),e.include(Ww,t),e.include(I$,t),e.include(YS,t),e.include(t.instancedDoublePrecision?D$:NC,t),e.include(Im,t),wp(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new Rt("ambient",o=>o.ambient),new Rt("diffuse",o=>o.diffuse),new Ue("opacity",o=>o.opacity),new Ue("layerOpacity",o=>o.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new ct("tex",o=>o.texture)),e.include(YZ,t),e.include(JJ,t),r.include(KJ),e.include(GSe,t),L$(r),xE(r),Em(r),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===zi.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===mt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?x`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?x`normalUV`:"vuv0"});`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?x`normalize(posWorld);`:x`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===mt.Normal||t.pbrMode===mt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Qe.ColorAlpha?x`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return e.include(o2e,t),e}const dnt=Object.freeze(Object.defineProperty({__proto__:null,build:hnt},Symbol.toStringTag,{value:"Module"}));let pnt=class extends ZSe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=ya(az),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Er.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ce(0,0,0),this.instancedDoublePrecision=!1,this.normalType=zi.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.externalColor=kt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Gw.Less,this.textureAlphaMode=mr.Blend,this.textureAlphaCutoff=s5,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ki.Occlude,this.isDecoration=!1}},fnt=class extends JSe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},eQ=class m2e extends Ni{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Qr.Default:Qr.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,m2e.shader)}_initializeProgram(e,i){return new Fi(e.rctx,i.get().build(this.configuration),di)}_makePipeline(e,i){const r=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Lt({blending:r.output===V.Color&&r.transparent?s?Ac:L0(e):null,culling:gnt(r)?kU(r.cullFace):null,depthTest:{func:Pv(e,mnt(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?Oc:null,drawBuffers:r.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?pv:Ov:null,polygonOffset:s||n?null:rz(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function mnt(t){return t===Gw.Lequal?tr.LEQUAL:tr.LESS}function gnt(t){return t.cullFace!==Er.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}eQ.shader=new Oi(dnt,()=>ue(()=>import("./DefaultMaterial.glsl-863e6fb7.js"),[],import.meta.url));let zt=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.alphaDiscardMode=mr.Opaque,this.doubleSidedMode=as.None,this.pbrMode=mt.Disabled,this.cullFace=Er.None,this.transparencyPassType=Qe.NONE,this.normalType=zi.Attribute,this.textureCoordinateType=Qr.None,this.customDepthTest=Gw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([B({count:V.COUNT})],zt.prototype,"output",void 0),d([B({count:mr.COUNT})],zt.prototype,"alphaDiscardMode",void 0),d([B({count:as.COUNT})],zt.prototype,"doubleSidedMode",void 0),d([B({count:mt.COUNT})],zt.prototype,"pbrMode",void 0),d([B({count:Er.COUNT})],zt.prototype,"cullFace",void 0),d([B({count:Qe.COUNT})],zt.prototype,"transparencyPassType",void 0),d([B({count:zi.COUNT})],zt.prototype,"normalType",void 0),d([B({count:Qr.COUNT})],zt.prototype,"textureCoordinateType",void 0),d([B({count:Gw.COUNT})],zt.prototype,"customDepthTest",void 0),d([B()],zt.prototype,"spherical",void 0),d([B()],zt.prototype,"hasVertexColors",void 0),d([B()],zt.prototype,"hasSymbolColors",void 0),d([B()],zt.prototype,"hasVerticalOffset",void 0),d([B()],zt.prototype,"hasSlicePlane",void 0),d([B()],zt.prototype,"hasSliceHighlight",void 0),d([B()],zt.prototype,"hasColorTexture",void 0),d([B()],zt.prototype,"hasMetallicRoughnessTexture",void 0),d([B()],zt.prototype,"hasEmissionTexture",void 0),d([B()],zt.prototype,"hasOcclusionTexture",void 0),d([B()],zt.prototype,"hasNormalTexture",void 0),d([B()],zt.prototype,"hasScreenSizePerspective",void 0),d([B()],zt.prototype,"hasVertexTangents",void 0),d([B()],zt.prototype,"hasOccludees",void 0),d([B()],zt.prototype,"multipassEnabled",void 0),d([B()],zt.prototype,"hasModelTransformation",void 0),d([B()],zt.prototype,"offsetBackfaces",void 0),d([B()],zt.prototype,"vvSize",void 0),d([B()],zt.prototype,"vvColor",void 0),d([B()],zt.prototype,"receiveShadows",void 0),d([B()],zt.prototype,"receiveAmbientOcclusion",void 0),d([B()],zt.prototype,"textureAlphaPremultiplied",void 0),d([B()],zt.prototype,"instanced",void 0),d([B()],zt.prototype,"instancedColor",void 0),d([B()],zt.prototype,"objectAndLayerIdColorInstanced",void 0),d([B()],zt.prototype,"instancedDoublePrecision",void 0),d([B()],zt.prototype,"doublePrecisionRequiresObfuscation",void 0),d([B()],zt.prototype,"writeDepth",void 0),d([B()],zt.prototype,"transparent",void 0),d([B()],zt.prototype,"enableOffset",void 0),d([B()],zt.prototype,"cullAboveGround",void 0),d([B()],zt.prototype,"snowCover",void 0),d([B()],zt.prototype,"hasColorTextureTransform",void 0),d([B()],zt.prototype,"hasEmissionTextureTransform",void 0),d([B()],zt.prototype,"hasNormalTextureTransform",void 0),d([B()],zt.prototype,"hasOcclusionTextureTransform",void 0),d([B()],zt.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([B({constValue:!1})],zt.prototype,"occlusionPass",void 0),d([B({constValue:!0})],zt.prototype,"hasVvInstancing",void 0),d([B({constValue:!1})],zt.prototype,"useCustomDTRExponentForWater",void 0),d([B({constValue:!1})],zt.prototype,"supportsTextureAtlas",void 0),d([B({constValue:!0})],zt.prototype,"useFillLights",void 0);function ynt(t){const e=new Pi,{vertex:i,fragment:r,varyings:s}=e;return Dl(i,t),e.include(x$),s.add("vpos","vec3"),e.include(t0,t),e.include(yxe,t),e.include(HTe,t),t.output===V.Color&&(wp(e.vertex,t),e.include(vE,t),e.include(Sa,t),t.offsetBackfaces&&e.include(i2e),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(Yd,t),e.include(gE,t),e.include(r2e,t),e.include(Tx,t),i.uniforms.add(new Ei("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(Ro)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===V.Color&&(e.include(Ks,t),e.include(Ww,t),e.include(I$,t),e.include(YS,t),e.include(t.instancedDoublePrecision?D$:NC,t),e.include(Im,t),wp(e.fragment,t),I0(r),L$(r),xE(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Rt("ambient",n=>n.ambient),new Rt("diffuse",n=>n.diffuse),new Ue("opacity",n=>n.opacity),new Ue("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new ct("tex",n=>n.texture)),e.include(YZ,t),e.include(JJ,t),r.include(KJ),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),Em(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?x`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===mt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===mt.Normal||t.pbrMode===mt.Schematic?t.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${t.pbrMode===mt.Normal||t.pbrMode===mt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Qe.ColorAlpha?x`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),e.include(o2e,t),e}const _nt=Object.freeze(Object.defineProperty({__proto__:null,build:ynt},Symbol.toStringTag,{value:"Module"}));let g2e=class y2e extends eQ{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=zi.Attribute,i.doubleSidedMode=as.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,y2e.shader)}};g2e.shader=new Oi(_nt,()=>ue(()=>import("./RealisticTree.glsl-ecc19b78.js"),[],import.meta.url));let xp=class extends Av{constructor(e){super(e,wnt),this.supportsEdges=!0,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>(eO(i)||E2(i))&&!this.parameters.transparent],[ye.TRANSPARENT_MATERIAL,i=>(eO(i)||E2(i))&&this.parameters.transparent&&this.parameters.writeDepth],[ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(eO(i)||E2(i))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new zt,this._vertexBufferLayout=xnt(this.parameters)}isVisibleForOutput(e){return e!==V.Shadow&&e!==V.ShadowExcludeHighlight&&e!==V.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||n||s;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Er.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e===V.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=as.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?as.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?as.WindingOrder:as.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?mt.Schematic:mt.Normal:mt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tz,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;te(jV,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Ne.Global:l=fe(Ooe,jV);break;case Ne.Local:l=ae(Ooe,Cnt)}let c=0;const u=_e(Ent,jV,a.eye),h=Se(u),p=ie(u,u,1/h);let f=null;this.parameters.screenSizePerspective&&(f=pe(l,p)),c+=XTe(a,h,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective),ie(l,l,c),On(GV,l,r.transform.inverseRotation),s=_e(Tnt,s,GV),n=_e(Snt,n,GV)}jSe(e,r,s,n,r9(r.verticalOffset),o)}createGLMaterial(e){return new vnt(e)}createBufferWriter(){return new bE(this._vertexBufferLayout)}},vnt=class extends WZ{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===V.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return te(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?g2e:eQ,e)}},bnt=class extends pnt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const wnt=new bnt;function xnt(t){const e=cs().vec3f(O.POSITION);return t.normalType===zi.Compressed?e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(O.NORMAL),t.hasVertexTangents&&e.vec4f(O.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const Tnt=C(),Snt=C(),Cnt=Ce(0,0,1),Ooe=C(),GV=C(),jV=C(),Ent=C(),_2e=new UJ({});function j4t(t){return t.type==="web-style"?_2e:tQ(t.symbolLayers.toArray().map(e=>v2e(t,e)))}function tQ(t){let e=0,i=0,r=0,s=!1,n=0;const o=new USe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new ost(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new nst(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function H4t(t){const e=tQ(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const HV={};function v2e(t,e){const i=b2e(t,e),r=wst(e)?2:0;switch(e.type){case"extrude":return new mh({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new mh({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new mh({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new mh({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new mh({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new UJ({verticesPerFeature:100,memory:i}):{...Ant(e.resource?.primitive??E0e),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=LSe;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":n=ISe;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2,l=a+o;let c=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(x7-1)*2+s);break;default:return}return new mh({verticesPerFeature:c,verticesPerCoordinate:l,memory:i})}case"text":case"icon":return new mh({verticesPerFeature:6,memory:i});default:return}}function b2e(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?hl.EXTRUDE_EDGES:hl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?hl.FILL_OUTLINE:hl.FILL;case"water":return hl.FILL;case"line":return e.join==="round"?hl.LINE_ROUND:hl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return hl.PATH_ROUND_CIRCLE;case"quad":return hl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return hl.PATH_MITER_CIRCLE;case"quad":return hl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?hl.OBJECT_POINT:hl.OBJECT_POLYGON;case"icon":case"text":return i?hl.ICON_POINT:hl.ICON_POLYGON;default:return}}function Ant(t){const e=HV[t];if(e)return e;const i=w2e(kSe(t,new xp({})).levels);return HV[t]=new mh({verticesPerFeature:i}),HV[t]}function w2e(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const hl={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var js;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(js||(js={}));let iQ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=hu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===hu.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===hu.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=hu.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=hu.FAILED,!sn(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=il(this._abortController):this._loadStatus===hu.LOADING&&(this._loadStatus=hu.FAILED),this._loader=null}};var hu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(hu||(hu={}));const dy=()=>le.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Dm=class extends iQ{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=dy(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new a5,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Roe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Roe(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&dy().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):dy().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(dy().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(dy().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return dy().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":WLe(e)&&dy().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return Mnt}_defaultElevationInfoZ(){return Pnt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new a5){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?Zrt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=$oe){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=$oe){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return aO(null,r);const s=e!=null?et.toUnitRGB(e):Uf;return aO(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=aO(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return v2e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Ts.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=Ts.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Ts.RECREATE}),s}applyRendererDiff(e,i){return js.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?np(i.size.field,e):0,s=i.color?np(i.color.field,e):0,n=i.opacity?np(i.opacity.field,e):0;return kt(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&dy().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Roe(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Mnt={mode:"on-the-ground",offset:0,unit:"meters"},Pnt={mode:"absolute-height",offset:0,unit:"meters"},$oe={hasIntrinsicColor:!1};let Rv=class extends T${get geometries(){return this._geometries}get transformation(){return this._transformation??Cr}set transformation(e){this._transformation=tn(this._transformation??xe(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?tn(this._shaderTransformation??xe(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=ws.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new x2e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){at(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),SYe(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new V4(_0.MaskOccludee);for(const i of this._geometries)i.occludees=q9(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=W9(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new V4(_0.Highlight);for(const i of this._geometries)i.highlights=q9(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=W9(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return Ai(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=xe()){return Ai(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Ioe,this._validateBoundingVolume(this._bvWorldSpace,lO.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Ioe,this._validateBoundingVolume(this._bvObjectSpace,lO.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===lO.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&Ont(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}or(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=mC(o);Ve(Loe,n.center,o);const l=hr(Loe,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},x2e=class{constructor(){this.min=Ce(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ce(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ioe=class extends x2e{constructor(){super(...arguments),this.bounds=Ws()}};function Ont(t,e,i){const r=t.bbMin,s=t.bbMax;if(qk(i)){const n=te(Rnt,i[12],i[13],i[14]);me(zc,r,n),me(Qh,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],zc[o]),e.max[o]=Math.max(e.max[o],Qh[o])}else if(Ve(zc,r,i),ho(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],zc[n]),e.max[n]=Math.max(e.max[n],zc[n]);else{Ve(Qh,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],zc[n],Qh[n]),e.max[n]=Math.max(e.max[n],zc[n],Qh[n]);for(let n=0;n<3;++n){ae(zc,r),ae(Qh,s),zc[n]=s[n],Qh[n]=r[n],Ve(zc,zc,i),Ve(Qh,Qh,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],zc[o],Qh[o]),e.max[o]=Math.max(e.max[o],zc[o],Qh[o])}}}const Rnt=C(),zc=C(),Qh=C(),Loe=C();var lO;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(lO||(lO={}));function rQ(t,e,i,r,s){if(S2e(t,e))return null;i.localOrigin=sQ(t,e);const n=new Rv({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:TSe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function T2e(t,e,i,r){return S2e(e,i)?null:TSe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function S2e(t,e){const i=t.clippingExtent;return!!i&&(ts(e,A_,t.elevationProvider.spatialReference),!iX(i,A_))}function Yw(t,e,i){const r=t.elevationContext,s=i.spatialReference;ts(e,A_,s),r.centerPointInElevationSR=Tv(A_[0],A_[1],e.hasZ?A_[2]:0,s??null)}function pw(t){switch(t.type){case"point":return t;case"polygon":case"extent":return FJ(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=kfe(e,vY(e)/2);return Tv(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}function sQ(t,e){return ts(e,A_,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(A_)}const A_=C();function C2e(){return new Float32Array(2)}function $nt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Mf(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function Int(t,e){return new Float32Array(t,e,2)}function E2e(){return C2e()}function A2e(){return Mf(1,1)}function M2e(){return Mf(1,0)}function P2e(){return Mf(0,1)}const O2e=E2e(),R2e=A2e(),Lnt=M2e(),Dnt=P2e();Object.freeze(Object.defineProperty({__proto__:null,ONES:R2e,UNIT_X:Lnt,UNIT_Y:Dnt,ZEROS:O2e,clone:$nt,create:C2e,createView:Int,fromValues:Mf,ones:A2e,unitX:M2e,unitY:P2e,zeros:E2e},Symbol.toStringTag,{value:"Module"}));function Nnt(t){const e=new Pi,{vertex:i,fragment:r}=e;return i.include(KU),e.include(YTe,t),e.include(Ks,t),e.attributes.add(O.UV0,"vec2"),i.uniforms.add(new Ei("viewport",(s,n)=>n.camera.fullViewport),new Ue("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Ar("pixelToNDC",(s,n)=>bi(Noe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ue("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Ar("screenOffset",(s,n)=>bi(Noe,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(cSe),t.hasScreenSizePerspective&&QU(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?x`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?x`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new Ei("uColor",s=>Doe(s.color)),new Ei("borderColor",s=>Doe(s.borderColor))),t.multipassEnabled&&(r.include(vZe,t),r.uniforms.add(new Ar("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Doe(t){return t??Cu}const Noe=it(),Fnt=Object.freeze(Object.defineProperty({__proto__:null,build:Nnt},Symbol.toStringTag,{value:"Module"}));let $2e=class I2e extends Ni{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Fi(e.rctx,I2e.shader.get().build(this.configuration),di)}setPipelineState(e){const i=e?tr.ALWAYS:tr.LESS;return this.configuration.depthHudEnabled?Lt({depthTest:{func:i},depthWrite:Oc}):Lt({blending:Fo(Ee.ONE,Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:qt})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};$2e.shader=new Oi(Fnt,()=>ue(()=>import("./LineCallout.glsl-47c6eae1.js"),[],import.meta.url));let th=class extends Fl{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};d([B()],th.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([B()],th.prototype,"spherical",void 0),d([B()],th.prototype,"occlusionTestEnabled",void 0),d([B()],th.prototype,"hasVerticalOffset",void 0),d([B()],th.prototype,"hasScreenSizePerspective",void 0),d([B()],th.prototype,"depthHudEnabled",void 0),d([B()],th.prototype,"depthHudAlignStartEnabled",void 0),d([B()],th.prototype,"hasSlicePlane",void 0),d([B()],th.prototype,"multipassEnabled",void 0),d([B({constValue:!0})],th.prototype,"hasSliceInVertexProgram",void 0),d([B({constValue:!1})],th.prototype,"draped",void 0);let FI=class S7 extends Av{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new L2e),this.produces=new Map([[ye.LINE_CALLOUTS,i=>i===V.Color],[ye.LINE_CALLOUTS_HUD_DEPTH,i=>i===V.Color]]),this._configuration=new th,this._uniqueMaterialIdentifier=S7.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=i?.slot!==ye.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new knt(e)}createBufferWriter(){return new znt}validateParameters(e){const i=S7.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier({renderOccluded:e,isDecoration:i,horizontalScreenOffset:r,color:s,size:n,occlusionTest:o,shaderPolygonOffset:a,depthHUDAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:h,verticalOffset:p,borderColor:f}){return ZRe`${e}:${i}:${r}:[${s}]:${n}:${o}:${a}:${l}:${c}:${u}:${h!=null}:{${p.screenLength}:${p.minWorldLength}:${p.maxWorldLength}}:[${f}]`}},knt=class extends Ev{beginSlot(e){return this.ensureTechnique($2e,e)}},L2e=class extends MJ{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Unt=cs().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.CENTEROFFSETANDDISTANCE),Foe=[Mf(0,0),Mf(1,0),Mf(0,1),Mf(1,0),Mf(1,1),Mf(0,1)];let znt=class{constructor(){this.vertexBufferLayout=Unt}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,s,n){PJ(r.attributes.get(O.POSITION),e,s.position,n,6),OJ(r.attributes.get(O.NORMAL),i,s.normal,n,6),IC(r.attributes.get(O.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6);for(let o=0;o<Foe.length;++o)s.uv0.setVec(n+o,Foe[o])}},D2e=class N2e extends Dm{constructor(e,i){super(e,null,i,Gnt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new FI(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new L2e,i=this.symbol,r=i.callout;if(e.color=r.color!=null?et.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=dn(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:dn(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?et.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Vnt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new a5,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!$0e(l)))return null;const a=FJ(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=M$(N2e.elevationModeChangeTypes,r,s);return n!==Ts.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=Fh(i.elevationContext.mode)}computeComplexity(){return new mh({verticesPerFeature:6})}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=FI.uniqueMaterialIdentifier(i);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(r);return s==null&&(s=new FI(i),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new FI(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new rn(a.material,Bnt(r),null,ws.Point,o),c=rQ(this._context,e,l,i,s);if(c==null)return null;const u=new Lm(this,c.object,[l],a.isUnique?[a.material]:null,null,dw,i);return u.metadata=new $Se(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=Fh(i.mode),Yw(u,e,this._context.elevationProvider),u}};function Bnt(t){const{translation:e,centerOffset:i}=t,r=new Ze(e?[e[0],e[1],e[2]]:[0,0,0],qV,3,!0),s=new Ze(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],qV,4,!0);return[[O.POSITION,r],[O.NORMAL,new Ze([0,0,1],qV,3,!0)],[O.CENTEROFFSETANDDISTANCE,s]]}D2e.elevationModeChangeTypes={definedChanged:Ts.UPDATE,staysOnTheGround:Ts.UPDATE,onTheGroundChanged:Ts.RECREATE};const qV=[0],Vnt={mode:"relative-to-ground",offset:0},Gnt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let jnt=class{constructor(e,i,r=C(),s=Yt(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Hnt=class extends Jrt{};const koe=()=>le.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function qnt(t,e){if(!pX(t))return koe().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=Wnt[t.callout.type];return i?new i(t,e):(koe().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Wnt={line:D2e};function r5t(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function Ynt(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function N$(t){if(Ynt(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function Xnt({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Znt({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function Jnt({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function Qnt({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function F$({scale:t,translate:e},i){return i*t[0]+e[0]}function k$({scale:t,translate:e},i){return i*t[1]+e[1]}function yR({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function _R({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function nQ(t,e){return t&&e?iot:t&&!e?eot:!t&&e?tot:Knt}const Knt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=F$(t,r[0]),n=k$(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p]=e[u];s+=l*h,n+=c*p,i[u]=[s,n]}return i},eot=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=F$(t,r[0]),n=k$(t,r[1]);i[0]=[s,n,yR(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p,f]=e[u];s+=l*h,n+=c*p,i[u]=[s,n,yR(t,f)]}return i},tot=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=F$(t,r[0]),n=k$(t,r[1]);i[0]=[s,n,_R(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p,f]=e[u];s+=l*h,n+=c*p,i[u]=[s,n,_R(t,f)]}return i},iot=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=F$(t,r[0]),n=k$(t,r[1]);i[0]=[s,n,yR(t,r[2]),_R(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p,f,g]=e[u];s+=l*h,n+=c*p,i[u]=[s,n,yR(t,f),_R(t,g)]}return i};function F2e(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function s5t(t,e,i){const r=N$(t);return e.x=Xnt(r,i.x),e.y=Znt(r,i.y),i.z!=null&&(e.z=Jnt(r,i.z)),i.m!=null&&(e.m=Qnt(r,i.m)),e}function k2e(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=N$(t);e.points=nQ(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function U2e(t,e,i,r=i?.z!=null,s=i?.m!=null){if(i==null)return e;const n=N$(t);return e.x=F$(n,i.x),e.y=k$(n,i.y),r&&(e.z=yR(n,i.z)),s&&(e.m=_R(n,i.m)),e}function z2e(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=N$(t);e.rings=F2e(n,nQ(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function B2e(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=N$(t);e.paths=F2e(n,nQ(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}let n5t=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function a5t(t){return t.geometry!=null}let l5t=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function u5t(t,e){const i=gme.fromJSON(t.geometryType),r=We.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e?.maxStringAttributeLength,a=e?.maxStringAttributeFields;let l;const c=t.features.map(u=>{const h=rot(u,i,r,t.objectIdFieldName),p=h.geometry;if(lot(h.attributes,a,o,f=>{l??(l=[]);const g=aot(h,n);g!=null&&l.push({objectId:g,attribute:f})}),p!=null&&s)switch(p.type){case"point":h.geometry=U2e(s,p,p);break;case"multipoint":h.geometry=k2e(s,p,p);break;case"polygon":h.geometry=z2e(s,p,p);break;case"polyline":h.geometry=B2e(s,p,p);break;case"extent":case"mesh":h.geometry=p}return h});return{geometryType:i,features:c,spatialReference:r,fields:t.fields?.map(u=>Zbe.fromJSON(u))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function rot(t,e,i,r){return{uid:wu(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:sot(t.geometry,e,i),visible:!0}}function sot(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function not(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=G_(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function h5t(t){let e=32;return e+=kde(t.attributes),e+=3,e+=8+not(t.geometry),e}function d5t(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function p5t(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function f5t(t,e){switch(Or(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)nB(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)nB(e,t.rings[i],!!t.hasZ);break;case"multipoint":nB(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function oot(t,e){switch(Mu(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)Vz(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)Vz(e,t.rings[i]);break;case"multipoint":Vz(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function aot(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function lot(t,e,i,r){if(e?.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}const WV=2;let Rc=class fS{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new fS(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new fS([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[WV*(n+i)],this.coords[WV*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new fS([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*WV,r=this.coords.slice(0,i);return e?(e.set(r),new fS(this.lengths,e,this.hasIndeterminateRingOrder)):new fS(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}},FC=class EN{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,i){const r=e.geometry?Rc.fromJSON(e.geometry):null,s=e.centroid?Rc.fromJSON(e.centroid):null,n=e.attributes[i];return new EN(r,e.attributes,s,n)}weakClone(){const e=new EN(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),i=new EN(e,{...this.attributes},this.centroid?.clone(),this.objectId);return i.displayId=this.displayId,i.geohashX=this.geohashX,i.geohashY=this.geohashY,i}};function m5t(t){return!!t.geometry?.coords?.length}let cot=class V2e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new V2e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function Oa(t,e){return t?e?4:3:e?3:2}const U$=()=>le.getLogger("esri.layers.graphics.featureConversionUtils"),G2e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},uot=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Uoe=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},hot=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},dot=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function oQ(t,e,i,r){if(t){if(i)return e&&r?dot:Uoe;if(e&&r)return hot}else if(e&&r)return Uoe;return uot}function YV({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function XV({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function ZV({scale:t,translate:e},i,r){return i*t[r]+e[r]}function g5t(t,e,i){return t?e?i?cQ(t):aQ(t):i?lQ(t):cz(t):null}function cz(t){const e=t.coords;return{x:e[0],y:e[1]}}function j2e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function aQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function pot(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function lQ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function fot(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function cQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function mot(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function got(t,e,i,r){let s=cz;i&&r?s=cQ:i?s=aQ:r&&(s=lQ);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function uQ(t,e){return t&&e?mot:t?pot:e?fot:j2e}function yot(t,e,i,r,s){const n=uQ(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new Rc,o):null;t.push(new FC(l,a,null,s?a[s]:void 0))}return t}function _ot(t,e,i=uQ(e.z!=null,e.m!=null)){return i(t,e)}function vot(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?H2e(s,i,r):null});return t}function H2e(t,e,i){if(t==null)return null;const r=Oa(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function bot(t,e,i,r,s){const n=Oa(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?q2e(new Rc,o,n):null;t.push(new FC(l,a,null,s?a[s]:void 0))}return t}function q2e(t,e,i=Oa(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function wot(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?W2e(s,i,r):null});return t}function W2e(t,e,i){if(!t)return null;const r=Oa(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<r;p++)h.push(s[a++]);c.push(h)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function xot(t,e,i,r,s){const n=Oa(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?Y2e(new Rc,o,n):null,u=l!=null?_ot(new Rc,l):null;t.push(new FC(c,a,u,s?a[s]:void 0))}return t}function Y2e(t,e,i=Oa(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function Tot(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?X2e(s,i,r):null;if(o!=null){const l=cz(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function X2e(t,e,i){if(!t)return null;const r=Oa(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<r;p++)h.push(s[a++]);c.push(h)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function Sot(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?Z2e(new Rc,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new FC(l,a,j2e(new Rc,o),c)):t.push(new FC(l,a,null,c))}return t}function Z2e(t,e,i=e.hasZ,r=e.hasM){return Cot(t,e.rings,i,r)}function Cot(t,e,i,r){const s=Oa(i,r),{lengths:n,coords:o}=t;let a=0;i0(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const D2=[],cO=[];function y5t(t,e,i,r,s){D2[0]=t;const[n]=J2e(cO,D2,e,i,r,s);return Tp(D2),Tp(cO),n}function J2e(t,e,i,r,s,n){if(Tp(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new FC(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return yot(t,e,r,s,n);case"esriGeometryMultipoint":return bot(t,e,r,s,n);case"esriGeometryPolyline":return xot(t,e,r,s,n);case"esriGeometryPolygon":return Sot(t,e,r,s,n);default:U$().error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`)),Tp(t)}return t}function _5t(t,e,i,r){cO[0]=t,Q2e(D2,cO,e,i,r);const s=D2[0];return Tp(D2),Tp(cO),s}function Eot(t,e,i){if(t==null)return null;const r=new Rc;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),J2(t)?uQ(e??t.z!=null,i??t.m!=null)(r,t):fu(t)?Z2e(r,t,e,i):Ud(t)?Y2e(r,t,Oa(e,i)):Qb(t)?q2e(r,t,Oa(e,i)):void U$().error("convertFromGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${t}'`))}function Aot(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=cz;return i&&r?n=cQ:i?n=aQ:r&&(n=lQ),n(s)}case"esriGeometryMultipoint":return H2e(s,i,r);case"esriGeometryPolyline":return W2e(s,i,r);case"esriGeometryPolygon":return X2e(s,i,r);default:return U$().error("convertToGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${e}'`)),null}}function Mot(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function Q2e(t,e,i,r,s){if(Tp(t),i==null)return Mot(t,e);switch(i){case"esriGeometryPoint":return got(t,e,r,s);case"esriGeometryMultipoint":return vot(t,e,r,s);case"esriGeometryPolyline":return wot(t,e,r,s);case"esriGeometryPolygon":return Tot(t,e,r,s);default:U$().error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`))}return t}function v5t(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:p}=t,f={features:Q2e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:Aot(h,p,!1,!1)};return r&&(f.transform=r),c&&(f.exceededTransferLimit=c),n&&(f.hasM=n),o&&(f.hasZ=o),f}function b5t(t,e){const i=new cot,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=t;return h&&(i.fields=h),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&J2e(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),u&&(i.transform=u),i):(U$().error(new W("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function w5t(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&Boe(n.geometry,n.geometry,r,s,e),n.centroid!=null&&Boe(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function x5t(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Rc,zoe(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new Rc,zoe(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function zoe(t,e,i,r,s,n,o=i,a=r){if(i0(t),!e?.coords.length)return null;const l=G2e[s],{coords:c,lengths:u}=e,h=Oa(i,r),p=Oa(i&&o,r&&a),f=oQ(i,r,o,a);if(!u.length)return f(t.coords,c,0,0,YV(n,c[0]),XV(n,c[1])),i0(t,h,0),t;let g,_,v,b,w=0,T=0,S=T;for(const A of u){if(A<l)continue;let P=0;T=S,v=g=YV(n,c[w]),b=_=XV(n,c[w+1]),f(t.coords,c,T,w,v,b),P++,w+=h,T+=p;for(let R=1;R<A;R++,w+=h)v=YV(n,c[w]),b=XV(n,c[w+1]),v===g&&b===_||(f(t.coords,c,T,w,v-g,b-_),T+=p,P++,g=v,_=b);P>=l&&(t.lengths.push(P),S=T)}return Tp(t.coords,S),t.coords.length?t:null}function T5t(t,e,i,r,s,n,o=i,a=r){if(i0(t),!e?.coords.length)return null;const l=G2e[s],{coords:c,lengths:u}=e,h=Oa(i,r),p=Oa(i&&o,r&&a),f=oQ(i,r,o,a);if(!u.length)return f(t.coords,c,0,0,c[0],c[1]),i0(t,h,0),t;let g=0;const _=n*n;for(const v of u){if(v<l){g+=v*h;continue}const b=t.coords.length/p,w=g,T=g+(v-1)*h;f(t.coords,c,t.coords.length,w,c[w],c[w+1]),C7(t.coords,c,h,_,f,w,T),f(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/p-b;S>=l?t.lengths.push(S):Tp(t.coords,b*p),g+=v*h}return t.coords.length?t:null}function Pot(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,h=a,p=l-u,f=c-h;if(p!==0||f!==0){const g=((s-u)*p+(n-h)*f)/(p*p+f*f);g>1?(u=l,h=c):g>0&&(u+=p*g,h+=f*g)}return p=s-u,f=n-h,p*p+f*f}function C7(t,e,i,r,s,n,o){let a,l=r,c=0;for(let u=n+i;u<o;u+=i)a=Pot(e,u,n,o),a>l&&(c=u,l=a);l>r&&(c-n>i&&C7(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&C7(t,e,i,r,s,c,o))}function S5t(t,e,i,r){if(!e?.coords?.length)return null;const s=Oa(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=s){const h=c[u],p=c[u+1];n=Math.min(n,h),a=Math.max(a,h),o=Math.min(o,p),l=Math.max(l,p)}}return TH(t)?W5e(t,n,o,a,l):yk(n,o,a,l,t),t}function Boe(t,e,i,r,s){const{coords:n,lengths:o}=e,a=Oa(i,r);if(!n.length)return t!==e&&i0(t),t;rk(s);const{originPosition:l,scale:c,translate:u}=s,h=Rot;h.originPosition=l;const p=h.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const f=h.translate;if(f[0]=u[0]??0,f[1]=u[1]??0,f[2]=u[2]??0,f[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=ZV(h,n[_],_);return t!==e&&i0(t,a,0),t}let g=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[g+T]=ZV(h,n[g+T],T);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let T=1;T<v;T++,g+=a){b+=n[g]*p[0],w+=n[g+1]*p[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=ZV(h,n[g+S],S)}}return t!==e&&i0(t,n.length,o.length),t}function C5t(t,e,i,r,s,n){if(i0(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Oa(i,r),a=oQ(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Oot(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function E5t(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=Oot(i,s,a,e),s+=a}return Math.abs(n)}function i0(t,e=0,i=0){Tp(t.lengths,i),Tp(t.coords,e)}function Tp(t,e=0){t.length!==e&&(t.length=e)}const Rot={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Voe=new Ko(Array,t=>Ik(t,nX),null,10,5),$ot=Vt();let Iot=class{get labelLayers(){return this._labelLayers||URe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=Zo.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?MSe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(uo.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=uo.GRAPHIC,i){const r=i?this._visibleFlags|i|uo.LABEL*i:this._visibleFlags;return e===uo.GRAPHIC?(r&Zo.ALL_GRAPHIC)===Zo.ALL_GRAPHIC:(r&Zo.ALL_LABEL)===Zo.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===uo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(uo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Vt(),oot(i,this._extent);const r=i.spatialReference;if(!ls(r,e)&&!xU(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=mv.fromExtent(s.type==="mesh"?s.extent:s)),Eot(s,i,r)}get usedMemory(){let e=kde(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:it(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&ie(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&mu(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Or(n.boundingBox):n.boundingBox=Or(),n.requiresDrapedElevation=!1,await Nk(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Voe.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&eC(n.boundingBox,l),Voe.release(l)}),H5e(n.boundingBox)||Rj(rX(n.boundingBox,$ot))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},M5t=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},Lot=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};function Dot(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Goe(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}var r0,ga;function Not(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function vR(t){return t!=null&&!isNaN(t)&&isFinite(t)}function Fot(t){return t.valueExpression?r0.Expression:t.field&&typeof t.field=="string"?r0.Field:r0.Unknown}function R5t(t,e){const i=e||Fot(t),r=t.valueUnit||"unknown";return i===r0.Unknown?ga.Constant:t.stops?ga.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?ga.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?ga.Proportional:ga.Additive:ga.Identity:ga.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(r0||(r0={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(ga||(ga={}));const K2e=()=>le.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),uz=t=>K2e().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),hz=()=>K2e().error("Use of arcade expressions requires an arcade context"),joe=new X_,AN=Math.PI,kot=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function eCe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void uz("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n?.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let h=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if(i?.arcade==null)return void hz();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(n,v,i.timeZone);if(!h){const w=_.createSyntaxTree(r.valueExpression);h=_.createFunction(w),r.cache.compiledFunc=h}a=_.executeFunction(h,b)}else o&&(a=o[l]);const p=r.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(f)&&f!==0)){isNaN(f)||s||(a/=f);const g=dQ(a,c);if(g){const _=g[0],v=g[1],b=_===v?r.stops[_].color:et.blendColors(r.stops[_].color,r.stops[v].color,g[2],i?.color);return new et(b)}}}function tCe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void uz("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n?.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let h=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if(i?.arcade==null)return void hz();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(n,v,i.timeZone);if(!h){const w=_.createSyntaxTree(r.valueExpression);h=_.createFunction(w),r.cache.compiledFunc=h}a=_.executeFunction(h,b)}else o&&(a=o[l]);const p=r.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(f)&&f!==0)){isNaN(f)||s||(a/=f);const g=dQ(a,c);if(g){const _=g[0],v=g[1];if(_===v)return r.stops[_].opacity;{const b=r.stops[_].opacity;return b+(r.stops[v].opacity-b)*g[2]}}}}function iCe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(f=>f.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void uz("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a?.attributes,c=r.field,{hasExpression:u}=r.cache;let h=r.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(i?.arcade==null)return void hz();const f={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,_=g.getViewInfo(f),v=g.createExecContext(a,_,i.timeZone);if(!h){const b=g.createSyntaxTree(r.valueExpression);h=g.createFunction(b),r.cache.compiledFunc=h}p=g.executeFunction(h,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function Uot(t,e,i){const r=typeof e=="number",s=r?null:e,n=s?.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i?.scale,h=i?.view;o=u==null||h==="3d"?zot(t):u}else if(!r)switch(t.inputValueType){case r0.Expression:{if(i?.arcade==null)return void hz();const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},h=i.arcade.arcadeUtils,p=h.getViewInfo(u),f=h.createExecContext(s,p,i.timeZone);if(!l){const g=h.createSyntaxTree(t.valueExpression);l=h.createFunction(g),t.cache.compiledFunc=l}o=h.executeFunction(l,f);break}case r0.Field:n&&(o=n[t.field]);break;case r0.Unknown:o=null}if(!vR(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return vR(c)&&c!==0?o/c:null}function zot(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function dz(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void uz("SizeVariable");const s=sCe(Uot(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Mc(t,e,i){return t==null?null:Not(t)?dz(t,e,i):vR(t)?t:null}function rCe(t,e,i){return vR(i)&&t>i?i:vR(e)&&t<e?e:t}function Bot(t,e,i,r){return t+((Mc(e.minSize,i,r)||e.minDataValue)??0)}function Vot(t,e,i){const r=t.stops;let s=r?.length&&r[0].size;return s==null&&(s=t.minSize),Mc(s,e,i)}function Got(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Mc(e.minSize,i,r),o=Mc(e.maxSize,i,r),a=r?.shape;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?AN*(n/2)**2:n*n,u=c+s*((l?AN*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/AN):Math.sqrt(u)}return n+s*(o-n)}function jot(t,e,i,r){const s=r?.shape,n=t/e.minDataValue,o=Mc(e.minSize,i,r),a=Mc(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,rCe(l,o,a)}function Hot(t,e,i,r,s){const[n,o,a]=dQ(t,s);if(n===o)return Mc(e.stops?.[n].size,i,r);{const l=Mc(e.stops?.[n].size,i,r);return l+(Mc(e.stops?.[o].size,i,r)-l)*a}}function qot(t,e,i,r){const s=(r?.resolution??1)*wC[e.valueUnit],n=Mc(e.minSize,i,r),o=Mc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/AN)/s:a==="radius"||a==="distance"?2*t/s:t/s,rCe(l,n,o)}function sCe(t,e,i,r,s){switch(e.transformationType){case ga.Additive:return Bot(t,e,i,r);case ga.Constant:return Vot(e,i,r);case ga.ClampedLinear:return Got(t,e,i,r);case ga.Proportional:return jot(t,e,i,r);case ga.Stops:return Hot(t,e,i,r,s);case ga.RealWorldSize:return qot(t,e,i,r);case ga.Identity:return t;case ga.Unknown:return null}}function Wot(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=Mc(t.minSize,joe,s),o=Mc(t.maxSize,joe,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function hQ(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=eCe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=tCe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=iCe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=dz(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function dQ(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function Yot(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":dz(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const $5t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Yot,getColor:eCe,getOpacity:tCe,getRotationAngle:iCe,getSize:dz,getSizeForValue:sCe,getSizeFromNumberOrVariable:Mc,getSizeRangeAtScale:Wot,getVisualVariableValues:hQ,viewScaleRE:kot},Symbol.toStringTag,{value:"Module"}));function pz(t,e){if(!t||t.symbol)return null;const i=e?.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function Xot(t,e){if(t.symbol!=null)return t.symbol;const i=pz(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function I5t(t,e){const i=pz(t,e),r=Xot(t,e);if(r==null)return null;const s={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return s;const n=hQ(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Zot(t,e){if(t.symbol!=null)return t.symbol;const i=pz(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function L5t(t,e){const i=pz(t,e),r=await Zot(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=hQ(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=et.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Jot(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function Qot(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Kot(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=Z_e(t,r,i);if(s!==Xr.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return fC(t,e,3)}function Hoe(t){const e=[[O.POSITION,new Ze(t.attributeData.position,t.indices,3,!0)]],i=wv(t.indices.length);return t.attributeData.colorFeature!=null?e.push([O.COLORFEATUREATTRIBUTE,new Ze([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([O.COLOR,new Ze(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([O.UVMAPSPACE,new Ze(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([O.BOUNDINGRECT,new Ze(t.attributeData.boundingRect,t.indices,9,!0)]),new rn(t.material,e,t.mapPositions,ws.Mesh,t.attributeData.objectAndLayerIdColor)}function qoe(t,e=null){const i=[[O.POSITION,new Ze(t.attributeData.position,t.indices,3,!0)],[O.UV0,new Ze(t.attributeData.uv0,t.indices,2,!0)]];return new rn(t.material,i,t.mapPositions,ws.Mesh,e)}function bR(t){switch(t.type){case"extent":if(t instanceof Qi)return mv.fromExtent(t);break;case"polygon":return t}return null}let fz=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};var uO,f5,E7;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(uO||(uO={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(f5||(f5={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(E7||(E7={}));var ln,vh,hO,Qs;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(ln||(ln={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(vh||(vh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(hO||(hO={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Qs||(Qs={}));let eat=class{constructor(e,i){this.vec3=e,this.id=i}};function m5(t,e,i,r){return new eat(Ce(t,e,i),r)}let Woe=class{constructor(){this._extent=Vt(),this.resolution=0,this.renderLocalOrigin=m5(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new tat}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];VF(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];VF(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,u0(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},tat=class{constructor(){this.extents=[Vt(),Vt(),Vt()],this.numViews=0}};var Nr;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(Nr||(Nr={}));let iat=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){return this._handle?.getTexture()!=null}dispose(){this._handle=Xt(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,i,r){this._handle&&this._handle.fbo?.width===i&&this._handle.fbo?.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.unbindTexture(this._handle?.fbo?.colorTexture),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}},iT=class{constructor(e,i,r,s,n=kr.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new iat(e,n,i)}get valid(){return this.fbo.valid}},rat=class{constructor(e){this.targets=[new iT(e,"overlay color",V.Color,Nr.Color),new iT(e,"overlay IM color",V.Color,Nr.ColorNoRasterImage),new iT(e,"overlay highlight",V.Highlight,Nr.Highlight,kr.RGBA4),new iT(e,"overlay water",V.Normal,Nr.WaterNormal),new iT(e,"overlay occluded",V.Color,Nr.Occluded)],se("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new iT(e,"overlay oid",V.ObjectAndLayerIdColor,Nr.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},mz=class extends ZSe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Xa;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(Xa||(Xa={}));let sat=class extends mz{constructor(){super(...arguments),this.identifier=Xa.Material,this.output=V.Color,this.transparent=!1}},nat=class extends mz{constructor(){super(...arguments),this.identifier=Xa.ShadowMap}},oat=class extends mz{constructor(){super(...arguments),this.identifier=Xa.Highlight}},aat=class extends mz{constructor(){super(...arguments),this.identifier=Xa.ViewshedShadowMap}};function lat(t){t.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function cat(t){t.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function uat(t,e){const i=t.fragment;i.include(Cm),i.uniforms.add(new Ar("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new ct("depthMap",(r,s)=>s.depth?.attachment)),i.uniforms.add(new Gr("proj",(r,s)=>s.camera.projectionMatrix)),i.uniforms.add(new Ue("invResolutionHeight",(r,s)=>1/s.camera.height)),i.uniforms.add(new Gr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function nCe(t,e){t.include(rnt,e),t.include(FU),t.include(cat),e.hasCloudsReflections&&t.include(kwe,e),e.hasScreenSpaceReflections&&t.include(uat,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",l2e).add("ssrHeightFadeEnd","float",p5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new Ue("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Ue("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new Gr("view",(r,s)=>s.camera.viewMatrix),new ct("lastFrameColorTexture",(r,s)=>s.ssr.lastFrameColor?.getTexture()),new Ue("fadeFactorSSR",(r,s)=>s.ssr.fadeFactor)),i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}var jf;function hat(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new c5("overlayTexOffset",(s,n)=>dat(s,n)),new c5("overlayTexScale",(s,n)=>pat(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new ct("ovColorTex",(s,n)=>aCe(s,n))),oCe(t,e)}function pA(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Yoe("overlayTexOffset"),new Yoe("overlayTexScale")),r.uniforms.add(new Ue("overlayOpacity",s=>s.overlayOpacity),new ct("ovColorTex",(s,n)=>n.overlay?.getTexture(s.overlayContent))),oCe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(jf||(jf={}));let Yoe=class extends Ss{constructor(e){super(e,"vec4")}};function oCe(t,e){e.pbrMode!==mt.Water&&e.pbrMode!==mt.WaterOnIntegratedMesh&&e.pbrMode!==mt.TerrainWithWater||t.include(nCe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(x`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==mt.Water&&e.pbrMode!==mt.WaterOnIntegratedMesh&&e.pbrMode!==mt.TerrainWithWater||(I0(r),Em(r),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function aCe(t,e){return t.identifier===Xa.Material&&t.output===V.Color?e.overlay?.getTexture(Nr.ColorNoRasterImage):t.identifier===Xa.Material&&t.output===V.ObjectAndLayerIdColor?e.overlay?.getTexture(Nr.ObjectAndLayerIdColor):t.identifier===Xa.Highlight?e.overlay?.getTexture(Nr.Highlight):null}function dat(t,e){const i=e.overlay?.overlays[ln.INNER]?.extent;BF(i)&&(Df[0]=t.toMapSpace[0]/Ta(i)-i[0]/Ta(i),Df[1]=t.toMapSpace[1]/Il(i)-i[1]/Il(i));const r=e.overlay?.overlays[ln.OUTER]?.extent;return BF(r)&&(Df[2]=t.toMapSpace[0]/Ta(r)-r[0]/Ta(r),Df[3]=t.toMapSpace[1]/Il(r)-r[1]/Il(r)),Df}function pat(t,e){const i=e.overlay?.overlays[ln.INNER]?.extent;BF(i)&&(Df[0]=t.toMapSpace[2]/Ta(i),Df[1]=t.toMapSpace[3]/Il(i));const r=e.overlay?.overlays[ln.OUTER]?.extent;return BF(r)&&(Df[2]=t.toMapSpace[2]/Ta(r),Df[3]=t.toMapSpace[3]/Il(r)),Df}const Df=Yt();let lCe=class extends xr{constructor(){super(...arguments),this.color=Ce(1,1,1)}};function fat(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("tex",e=>e.texture),new Rt("uColor",e=>e.color)),t.fragment.code.add(x`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const mat=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:lCe,build:fat},Symbol.toStringTag,{value:"Module"}));let cCe=class{constructor(e){this._context=e,this._perConstructorInstances=new uv,this._frameCounter=0,this._keepAliveFrameCount=Xoe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=yat){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(s==null){const n=new e(this._context,i,()=>this.release(n));s=new gat(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Xoe&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},gat=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Xoe=-1,yat=new ol;let uCe=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new uv}dispose(){this._textures.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces.get(i)?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new _at(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Tt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&le.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},_at=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,at(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const vat=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let g5=class A7{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new no,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),no.clearPool(),M7[0]=null,nb.prune(),ob.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=no.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}no.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=no.acquire();for(const s of e){const n=i??Vw(this.objectToBoundingSphere(s),Mat);WM(n[3])?(r.init(this._root),bat(s,n,r)):this._degenerateObjects.delete(s)}no.release(r),this._shrink()}update(e,i){if(!WM(i[3])&&this._isDegenerate(e))return;const r=Aat(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=Ou(e,i);e1(this._root,n=>{if(!xat(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=Ou(e,i);e1(this._root,o=>{if(!Tat(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){e1(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=JV(e,i),u=h=>{if(--n,!s(h))return;const p=this.objectToBoundingSphere(h);if(!C_(r,p))return;const f=a_(e,i,p),g=f-p[3],_=f+p[3];g<o&&(o=g,a=_,l=h)};return Zoe(this._root,h=>{if(n<=0||!C_(r,h.bounds)||(ie(zu,c,h.halfSize),me(zu,zu,h.bounds),a_(e,i,zu)>a))return!1;const p=h.node;return p.terminals.forAll(f=>u(f)),p.residents!==null&&p.residents.forAll(f=>u(f)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{r===A7.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(s);const h=a_(i,r,e),p=JV(i,r),f=JV(i,-r),g=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),b=v,w=a_(i,r,b)-h,T=w-v[3],S=w+v[3];T>c||S<l||!C_(o,v)||n(_,u)};Zoe(this._root,_=>{if(!C_(o,_.bounds)||(ie(zu,p,_.halfSize),me(zu,zu,_.bounds),a_(i,r,zu)-h>c)||(ie(zu,f,_.halfSize),me(zu,zu,_.bounds),a_(i,r,zu)-h<l))return!1;const v=_.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(e){e1(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=L_(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),u=L_(c),h=r+u;return!(Wn(c,s)-h*h<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};e1(this._root,l=>{const c=L_(l.bounds),u=r+c;if(Wn(l.bounds,s)-u*u>0)return!1;const h=l.node;return h.terminals.forAll(a),o&&h.residents!==null&&h.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||Hq(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||Hq(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=no.acquire().init(e);this._add(i.at(r),s),no.release(s)}}_grow(e,i){if(i!==0&&(Joe(e,i,r=>this.objectToBoundingSphere(r),Wm),WM(Wm[3])&&!this._fitsInsideTree(Wm)))if(hCe(this._root.node))Vw(Wm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(Wm);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Wm,r):this._growRootAsSubNode(r),no.release(r)}}_rebuildTree(e,i){ae(KV,i.bounds),KV[3]=i.halfSize,Joe([e,KV],2,s=>s,eG);const r=no.acquire().init(this._root);this._root.initFrom(null,eG,eG[3]),this._root.increaseHalfSize(1.25),e1(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),no.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return e1(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),u=r[l]+i-(n[l]+o),h=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),kI[l].min=h,kI[l].max=p}for(let l=0;l<3;l++){let c=kI[l].min,u=kI[l].max;const h=(s-(c+u))/2;c+=Math.ceil(h),u+=Math.floor(h);const p=n[l]-o-c*o*2;QV[l]=p+(u+c)*o}const a=s*o;return QV[3]=a*pCe,no.acquire().initFrom(null,QV,a,0)}_growRootAsSubNode(e){const i=this._root.node;ae(Wm,this._root.bounds),Wm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Wm,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!WM(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const i=e.children.map(n=>n?this._nodeToJSON(n):null),r=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new A7(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},no=class mS{constructor(){this.bounds=Ws(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??mS.createEmptyNode(),i&&Vw(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*pCe}advance(e){let i=this.node.children[e];i||(i=mS.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=dCe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Gt({shrink:!0}),residents:new Gt({shrink:!0})}}static acquire(){return mS._pool.acquire()}static release(e){mS._pool.release(e)}static clearPool(){mS._pool.prune()}};function e1(t,e){let i=no.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(no.acquire().init(i).advance(s));no.release(i)}}function Zoe(t,e,i,r=g5.DepthOrder.FRONT_TO_BACK){let s=no.acquire().init(t);const n=[s];for(Eat(i,r,Koe);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=Koe[o];s.node.children[a]&&n.push(no.acquire().init(s).advance(a))}no.release(s)}}function bat(t,e,i){nb.clear();const r=i.advanceTo(e,(s,n)=>{nb.push(s.node),nb.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=nb.length-2;s>=0&&wat(nb.data[s],nb.data[s+1]);s-=2);}function wat(t,e){return e>=0&&(t.children[e]=null),!!hCe(t)&&(t.residents===null&&(t.residents=new Gt({shrink:!0})),!0)}function xat(t,e){return y5(e.bounds,2*-e.halfSize,lu),y5(e.bounds,2*e.halfSize,cu),dwe(t.origin,t.direction,lu,cu)}function Tat(t,e,i){return y5(e.bounds,2*-e.halfSize,lu),y5(e.bounds,2*e.halfSize,cu),i.applyToMinMax(lu,cu),dwe(t.origin,t.direction,lu,cu)}function hCe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function Sat(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Cat(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function y5(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Joe(t,e,i,r){if(e===1){const s=i(t[0]);Vw(s,r)}else{lu[0]=1/0,lu[1]=1/0,lu[2]=1/0,cu[0]=-1/0,cu[1]=-1/0,cu[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);WM(n[3])&&(Sat(lu,n),Cat(cu,n))}or(r,lu,cu,.5),r[3]=Math.max(cu[0]-lu[0],cu[1]-lu[1],cu[2]-lu[2])/2}}function Eat(t,e,i){if(!ob.length)for(let r=0;r<8;++r)ob.push({index:0,distance:0});for(let r=0;r<8;++r){const s=dCe[r];ob.data[r].index=r,ob.data[r].distance=a_(t,e,s)}ob.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=ob.data[r].index}function JV(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=a_(t,e,Qoe[s]);n<r&&(r=n,i=Qoe[s])}return i}function a_(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function WM(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}no._pool=new Ko(no),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(g5||(g5={}));const dCe=[Ce(-1,-1,-1),Ce(1,-1,-1),Ce(-1,1,-1),Ce(1,1,-1),Ce(-1,-1,1),Ce(1,-1,1),Ce(-1,1,1),Ce(1,1,1)],Qoe=[Ce(-1,-1,-1),Ce(-1,-1,1),Ce(-1,1,-1),Ce(-1,1,1),Ce(1,-1,-1),Ce(1,-1,1),Ce(1,1,-1),Ce(1,1,1)],pCe=Math.sqrt(3),M7=[null];function Aat(t){return M7[0]=t,M7}const QV=Ws(),zu=C(),lu=C(),cu=C(),nb=new Gt,Mat=Ws(),Wm=Ws(),KV=Ws(),eG=Ws(),kI=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ob=new Gt,Koe=[0,0,0,0,0,0,0,0],Zd=g5;var z_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(z_||(z_={}));let fCe=class extends T${get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=ws.Layer,this.events=new Ls,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new Gt,this._objectsAdded=new Gt,this._handles=new _m,this.apiLayerUid=r,this.visible=i?.visible??!0,this.pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??z_.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const s of vat)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==z_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Zd(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Oe(this._octree),this._objectsAdded.clear()}};function _5(t){return t!=null&&t.type===ws.Layer}var kl,Xw;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(kl||(kl={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Xw||(Xw={}));let io=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=Qe.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=kl.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Xw.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===kl.Draped}};d([B({count:V.COUNT})],io.prototype,"output",void 0),d([B({count:Qe.COUNT})],io.prototype,"transparencyPassType",void 0),d([B()],io.prototype,"occluder",void 0),d([B()],io.prototype,"hasSlicePlane",void 0),d([B()],io.prototype,"writeDepth",void 0),d([B({count:kl.COUNT})],io.prototype,"space",void 0),d([B()],io.prototype,"hideOnShortSegments",void 0),d([B()],io.prototype,"hasCap",void 0),d([B({count:Xw.COUNT})],io.prototype,"anchor",void 0),d([B()],io.prototype,"hasTip",void 0),d([B()],io.prototype,"vvSize",void 0),d([B()],io.prototype,"vvColor",void 0),d([B()],io.prototype,"vvOpacity",void 0),d([B()],io.prototype,"hasOccludees",void 0),d([B()],io.prototype,"multipassEnabled",void 0),d([B()],io.prototype,"cullAboveGround",void 0),d([B({constValue:!1})],io.prototype,"occlusionPass",void 0),d([B({constValue:!0})],io.prototype,"hasVvInstancing",void 0),d([B({constValue:!0})],io.prototype,"hasSliceTranslatedView",void 0);const eae=8;function mCe(t,e){const i=t.vertex;i.uniforms.add(new Ue("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Rt("vvSizeMinSize",r=>r.vvSize.minSize),new Rt("vvSizeMaxSize",r=>r.vvSize.maxSize),new Rt("vvSizeOffset",r=>r.vvSize.offset),new Rt("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new el("vvOpacityValues",r=>r.vvOpacity.values,eae),new el("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,eae)),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(t0,e),t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),i.code.add(x`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}let gCe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${wu()}`,s=>s.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r,n=s.usedMemory;this._orphanCache.put(i,s,n)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new Pat(s);return this._repository.set(i,n),s}},Pat=class{constructor(e){this.texture=e,this.refCount=1}};function Oat(t,e){return new gCe(i=>{const{encodedData:r,textureSize:s}=Rat(i),n=new $r;return n.internalFormat=Pt.RGBA,n.width=s,n.height=1,n.wrapMode=hi.REPEAT,new ur(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function Rat(t){const e=pQ(t),i=1/t.pixelRatio,r=yCe(t),s=_Ce(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const p of e){for(let f=0;f<p;f++){const g=a*(Math.min(f,p-1-f)+.5)*i/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*r);let h=0;for(const p of c)zJ(p,u,h),h+=4;return{encodedData:u,textureSize:r}}function pQ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function yCe(t){if(t==null)return 1;const e=pQ(t);return Math.floor(e.reduce((i,r)=>i+r))}function _Ce(t){return pQ(t).reduce((e,i)=>Math.max(e,i))}function $at(t){return t==null?Cu:t.length===4?t:Zr(Iat,t[0],t[1],t[2],1)}const Iat=Yt();function Lat(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Dat(t,e):Nat(t)}function Dat(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(Ep),e.draped||(wp(r,e),r.uniforms.add(new Ue("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${kat};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),mE(r),r.code.add(x`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new ct("stipplePatternTexture",n=>n.stippleTexture),new Ue("stipplePatternSDFNormalizer",n=>Fat(n.stipplePattern)),new Ue("stipplePatternPixelSizeInv",n=>1/vCe(n))),s.code.add(x`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new Ei("stippleOffColor",n=>$at(n.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Nat(t){t.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Fat(t){return t?(Math.floor(.5*(_Ce(t)-1))+.5)/t.pixelRatio:1}function vCe(t){const e=t.stipplePattern;return e?yCe(t.stipplePattern)/e.pixelRatio:1}const kat=x.float(.4);async function w0(t,e){const{data:i}=await Yi(t,{responseType:"image",...e});return i}function Uat(){return tae??(tae=(async()=>{const t=await ue(()=>import("./basis_transcoder-a96cc18e.js"),[],import.meta.url),e=await t.default({locateFile:i=>sr(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})()),tae}let tae;var Ab;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(Ab||(Ab={}));let op=null,UI=null;async function bCe(){return UI==null&&(UI=Uat(),op=await UI),UI}function zat(t,e){if(op==null)return t.byteLength;const i=new op.BasisFile(new Uint8Array(t)),r=xCe(i)?wCe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Bat(t,e){if(op==null)return t.byteLength;const i=new op.KTX2File(new Uint8Array(t)),r=TCe(i)?wCe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function wCe(t,e,i,r,s){const n=GZ(e?Ps.COMPRESSED_RGBA8_ETC2_EAC:Ps.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function xCe(t){return t.getNumImages()>=1&&!t.isUASTC()}function TCe(t){return t.getFaces()>=1&&t.isETC1S()}async function Vat(t,e,i){op==null&&(op=await bCe());const r=new op.BasisFile(new Uint8Array(i));if(!xCe(r))return null;r.startTranscoding();const s=SCe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function Gat(t,e,i){op==null&&(op=await bCe());const r=new op.KTX2File(new Uint8Array(i));if(!TCe(r))return null;r.startTranscoding();const s=SCe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function SCe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?r?[Ab.ETC2_RGBA,Ps.COMPRESSED_RGBA8_ETC2_EAC]:[Ab.ETC1_RGB,Ps.COMPRESSED_RGB8_ETC2]:c?r?[Ab.BC3_RGBA,Ps.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Ab.BC1_RGB,Ps.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Ab.RGBA32,Pt.RGBA],p=e.hasMipmap?i:Math.min(1,i),f=[];for(let g=0;g<p;g++)f.push(new Uint8Array(o(g,u))),a(g,u,f[g]);return e.internalFormat=h,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?Zt.LINEAR_MIPMAP_LINEAR:Zt.LINEAR,e.width=s,e.height=n,new ur(t,e,{type:"compressed",levels:f})}const zI=()=>le.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),jat=542327876,Hat=131072,qat=4;function fQ(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Wat(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Yat=fQ("DXT1"),Xat=fQ("DXT3"),Zat=fQ("DXT5"),Jat=31,Qat=0,Kat=1,elt=2,tlt=3,ilt=4,rlt=7,slt=20,nlt=21;function olt(t,e,i){const r=alt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?Zt.LINEAR_MIPMAP_LINEAR:Zt.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new ur(t,e,s)}function alt(t,e){const i=new Int32Array(t,0,Jat);if(i[Qat]!==jat)return zI().error("Invalid magic number in DDS header"),null;if(!(i[slt]&qat))return zI().error("Unsupported format, must contain a FourCC code"),null;const r=i[nlt];let s,n;switch(r){case Yat:s=8,n=Ps.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Xat:s=16,n=Ps.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Zat:s=16,n=Ps.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return zI().error("Unsupported FourCC code:",Wat(r)),null}let o=1,a=i[ilt],l=i[tlt];(3&a||3&l)&&(zI().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,p;i[elt]&Hat&&e!==!1&&(o=Math.max(1,i[rlt]));let f=i[Kat]+4;const g=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*s,h=new Uint8Array(t,f,p),g.push(h),f+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:u}}let fv=class extends T${get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=ws.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Ls,this._parameters={...clt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(RO(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){bm(e.src)||RO(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new $r;return i.wrapMode=this._parameters.wrap??hi.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?Zt.LINEAR_MIPMAP_LINEAR:Zt.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||llt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new ur(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(DA(i)||v_(i))&&this._parameters.encoding===Jg.DDS_ENCODING?this._loadFromDDSData(e,i):(DA(i)||v_(i))&&this._parameters.encoding===Jg.KTX2_ENCODING?this._loadFromKTX2(e,i):(DA(i)||v_(i))&&this._parameters.encoding===Jg.BASIS_ENCODING?this._loadFromBasis(e,i):v_(i)?this._loadFromPixelData(e,i):DA(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<dO.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=olt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>Gat(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>Vat(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){at(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?Pt.LUMINANCE:this._parameters.components===3?Pt.RGB:Pt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new ur(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await w0(i,{signal:r});return yt(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await afe(i,i.src,!1,r);return yt(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=dO.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),gr(c)},a=()=>{i.readyState>=dO.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=u=>{o(),n(u||new W("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=un(r,()=>l(vi()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?xXe(r,o):TXe(r,o)}const s=CCe(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?Pt.RGB:Pt.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new ur(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=Tt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function llt(t,e){if(t==null)return 0;if(DA(t)||v_(t))return e.encoding===Jg.KTX2_ENCODING?Bat(t,!!e.mipmap):e.encoding===Jg.BASIS_ENCODING?zat(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?CCe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function CCe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var dO;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(dO||(dO={}));const clt={wrap:{s:hi.REPEAT,t:hi.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},v5=128,mQ=.5;function ult(t){return t==="cross"||t==="x"}function hlt(t,e=v5,i=e*mQ,r=0){const s=ECe(t,e,i,r);return new fv(s,{mipmap:!1,wrap:{s:hi.CLAMP_TO_EDGE,t:hi.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function ECe(t,e=v5,i=e*mQ,r=0){switch(t){case"circle":default:return dlt(e,i);case"square":return plt(e,i);case"cross":return mlt(e,i,r);case"x":return glt(e,i,r);case"kite":return flt(e,i);case"triangle":return ylt(e,i);case"arrow":return _lt(e,i)}}function dlt(t,e){const i=t/2-.5;return z$(t,PCe(i,i,e/2))}function plt(t,e){return ACe(t,e,!1)}function flt(t,e){return ACe(t,e,!0)}function mlt(t,e,i=0){return MCe(t,e,!1,i)}function glt(t,e,i=0){return MCe(t,e,!0,i)}function ylt(t,e){return z$(t,OCe(t/2,e,e/2))}function _lt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=PCe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=OCe(s,i,r);return z$(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function ACe(t,e,i){return i&&(e/=Math.SQRT2),z$(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function MCe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return z$(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function PCe(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function OCe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function z$(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,zJ(o,i,4*n)}return i}const fw=64,gQ=fw/2,RCe=gQ/5,vlt=fw/RCe,blt=.25;function wlt(t,e){const i=ECe(t,fw,gQ,RCe),r=new $r;return r.internalFormat=Pt.RGBA,r.width=fw,r.height=fw,r.wrapMode=hi.CLAMP_TO_EDGE,new ur(e,r,i)}function $Ce(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",vlt),mE(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(x`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===kl.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Ue("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),i.code.add(x`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Oh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Oh||(Oh={}));let fs=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.capType=Oh.BUTT,this.transparencyPassType=Qe.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([B({count:V.COUNT})],fs.prototype,"output",void 0),d([B({count:Oh.COUNT})],fs.prototype,"capType",void 0),d([B({count:Qe.COUNT})],fs.prototype,"transparencyPassType",void 0),d([B()],fs.prototype,"occluder",void 0),d([B()],fs.prototype,"hasSlicePlane",void 0),d([B()],fs.prototype,"hasPolygonOffset",void 0),d([B()],fs.prototype,"writeDepth",void 0),d([B()],fs.prototype,"draped",void 0),d([B()],fs.prototype,"stippleEnabled",void 0),d([B()],fs.prototype,"stippleOffColorEnabled",void 0),d([B()],fs.prototype,"stipplePreferContinuous",void 0),d([B()],fs.prototype,"roundJoins",void 0),d([B()],fs.prototype,"applyMarkerOffset",void 0),d([B()],fs.prototype,"vvSize",void 0),d([B()],fs.prototype,"vvColor",void 0),d([B()],fs.prototype,"vvOpacity",void 0),d([B()],fs.prototype,"falloffEnabled",void 0),d([B()],fs.prototype,"innerColorEnabled",void 0),d([B()],fs.prototype,"hasOccludees",void 0),d([B()],fs.prototype,"multipassEnabled",void 0),d([B()],fs.prototype,"cullAboveGround",void 0),d([B()],fs.prototype,"wireframe",void 0),d([B()],fs.prototype,"objectAndLayerIdColorInstanced",void 0),d([B({constValue:!1})],fs.prototype,"occlusionPass",void 0),d([B({constValue:!0})],fs.prototype,"hasVvInstancing",void 0),d([B({constValue:!0})],fs.prototype,"hasSliceTranslatedView",void 0);const b5=1;function xlt(t){const e=new Pi,{attributes:i,varyings:r,constants:s,vertex:n,fragment:o}=e;e.include(w$),e.include(mCe,t),e.include(Lat,t);const a=t.applyMarkerOffset&&!t.draped;a&&(n.uniforms.add(new Ue("markerScale",g=>g.markerScale)),e.include($Ce,{space:kl.World,draped:!1})),e.include(xx,t),Dl(n,t),n.uniforms.add(new Gr("inverseProjectionMatrix",(g,_)=>_.camera.inverseProjectionMatrix),new Ar("nearFar",(g,_)=>_.camera.nearFar),new Ue("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new Ei("viewport",(g,_)=>_.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(O.POSITION,"vec3"),i.add(O.PREVPOSITION,"vec3"),i.add(O.NEXTPOSITION,"vec3"),i.add(O.SUBDIVISIONFACTOR,"float"),i.add(O.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const l=t.multipassEnabled&&t.output===V.Color;l&&r.add("depth","float");const c=t.stippleEnabled;c&&r.add("vLineSizeInv","float"),s.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===Oh.ROUND,h=t.stippleEnabled&&u,p=t.falloffEnabled||h;p&&r.add("vLineDistanceNorm","float"),u&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),n.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),mE(n),n.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?x`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&n.code.add(x`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.code.add(x`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&n.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?n.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((b5+2)/(b5+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Oh.BUTT;return n.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${p?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&n.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?n.uniforms.add(new Ue("worldToScreenRatio",(g,_)=>1/_.screenToPCSRatio)):n.code.add(x`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?n.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new Ue("stipplePatternPixelSize",g=>vCe(g))),n.code.add(x`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(Im,t),e.include(Ks,t),o.include(Rm),o.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(x`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${x.float(Ro)}) {
          discard;
        }
      `),h?o.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(Ro)}, stippleCoverage);
      `):o.code.add(x`float stippleAlpha = getStippleAlpha();`),t.output!==V.ObjectAndLayerIdColor&&o.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new Ei("intrinsicColor",g=>g.color)),o.code.add(x`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new Ei("innerColor",g=>g.innerColor??g.color),new Ue("innerWidth",(g,_)=>g.innerWidth*_.camera.pixelRatio)),o.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new Ue("falloff",g=>g.falloff)),o.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(x`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),o.code.add(x`
    ${t.output===V.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${x.float(Ro)}) {
      discard;
    }

    ${t.output===V.Color?x`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===V.Color&&t.transparencyPassType===Qe.ColorAlpha?x`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===V.Highlight?x`fragColor = vec4(1.0);`:""}
    ${t.output===V.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Tlt=Object.freeze(Object.defineProperty({__proto__:null,build:xlt,ribbonlineNumRoundJoinSubdivisions:b5},Symbol.toStringTag,{value:"Module"})),ICe=new Map([[O.POSITION,0],[O.PREVPOSITION,1],[O.NEXTPOSITION,2],[O.SUBDIVISIONFACTOR,3],[O.UV0,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let LCe=class DCe extends Ni{initializeProgram(e){return new Fi(e.rctx,DCe.shader.get().build(this.configuration),ICe)}_makePipelineState(e,i){const r=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace,o=VZe(r.output);return Lt({blending:r.output===V.Color?s?Ac:L0(e):null,depthTest:{func:Pv(e)},depthWrite:s?r.writeDepth||o?Oc:null:ez(e),drawBuffers:r.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?pv:Ov:null,polygonOffset:s||n?r.hasPolygonOffset?iae:null:iz})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?iae:null;this._occluderPipelineTransparent=Lt({blending:Ac,polygonOffset:i,depthTest:d5,depthWrite:null,colorWrite:qt,stencilWrite:null,stencilTest:e2e,drawBuffers:e.output===V.Depth?{buffers:[zn.NONE]}:null}),this._occluderPipelineOpaque=Lt({blending:Ac,polygonOffset:i,depthTest:d5,depthWrite:null,colorWrite:qt,stencilWrite:QSe,stencilTest:KSe,drawBuffers:e.output===V.Depth?{buffers:[zn.NONE]}:null}),this._occluderPipelineMaskWrite=Lt({blending:null,polygonOffset:i,depthTest:WJ,depthWrite:null,colorWrite:null,stencilWrite:ym,stencilTest:pv,drawBuffers:e.output===V.Depth?{buffers:[zn.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?ui.LINES:ui.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};LCe.shader=new Oi(Tlt,()=>ue(()=>import("./RibbonLine.glsl-94ceac4b.js"),[],import.meta.url));const iae={factor:0,units:-4};var rc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(rc||(rc={}));let XS=class extends Av{constructor(e){super(e,new Clt),this._configuration=new fs,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>i===V.Highlight||i===V.ObjectAndLayerIdColor||i===V.Color&&this.parameters.renderOccluded===ki.OccludeAndTransparentStencil],[ye.OPAQUE_NO_SSAO_DEPTH,i=>k_(i)],[ye.OCCLUDER_MATERIAL,i=>B9(i)&&this.parameters.renderOccluded===ki.OccludeAndTransparentStencil],[ye.TRANSPARENT_OCCLUDER_MATERIAL,i=>B9(i)&&this.parameters.renderOccluded===ki.OccludeAndTransparentStencil],[ye.TRANSPARENT_MATERIAL,i=>i===V.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==ki.OccludeAndTransparentStencil],[ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>i===V.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==ki.OccludeAndTransparentStencil],[ye.DRAPED_MATERIAL,i=>fxe(i)]]),this._vertexAttributeLocations=ICe}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===ye.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==V.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Alt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===ki.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=Te(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],h=s[1],p=(c/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],w=u-v,T=h-b,S=a[_+3]-v,A=a[_+4]-b,P=Te((S*w+A*T)/(S*S+A*A),0,1),R=S*P-w,F=A*P-T,k=R*R+F*F;k<f&&(f=k,g=_/3)}f<p*p&&n(o.dist,o.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!pwe(i))return void le.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=Te(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const u=r.camera,h=Mlt;ta(h,r.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;te(fA[0],h[0]-p,h[1]+p,0),te(fA[1],h[0]+p,h[1]+p,0),te(fA[2],h[0]+p,h[1]-p,0),te(fA[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(fA[w],Ym[w]))return;ba(u.eye,Ym[0],Ym[1],iG),ba(u.eye,Ym[1],Ym[2],rG),ba(u.eye,Ym[2],Ym[3],sG),ba(u.eye,Ym[3],Ym[0],nG);let f=Number.MAX_VALUE,g=0;const _=NCe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<_;w+=3){dl[0]=l[w]+i[12],dl[1]=l[w+1]+i[13],dl[2]=l[w+2]+i[14];const T=(w+3)%l.length;if(pl[0]=l[T]+i[12],pl[1]=l[T+1]+i[13],pl[2]=l[T+2]+i[14],fr(iG,dl)<0&&fr(iG,pl)<0||fr(rG,dl)<0&&fr(rG,pl)<0||fr(sG,dl)<0&&fr(sG,pl)<0||fr(nG,dl)<0&&fr(nG,pl)<0)continue;if(u.projectToRenderScreen(dl,i1),u.projectToRenderScreen(pl,r1),i1[2]<0&&r1[2]>0){_e(Fp,dl,pl);const A=u.frustum,P=-fr(A[ar.NEAR],dl)/pe(Fp,A[ar.NEAR]);ie(Fp,Fp,P),me(dl,dl,Fp),u.projectToRenderScreen(dl,i1)}else if(i1[2]>0&&r1[2]<0){_e(Fp,pl,dl);const A=u.frustum,P=-fr(A[ar.NEAR],pl)/pe(Fp,A[ar.NEAR]);ie(Fp,Fp,P),me(pl,pl,Fp),u.projectToRenderScreen(pl,r1)}else if(i1[2]<0&&r1[2]<0)continue;i1[2]=0,r1[2]=0;const S=pZ(cw(i1,r1,nae),h);S<f&&(f=S,ae(rae,dl),ae(sae,pl),g=w/3)}const v=r.rayBegin,b=r.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(r1e(cw(rae,sae,nae),cw(v,b,Plt),t1)){_e(t1,t1,v);const T=Se(t1);ie(t1,t1,1/T),w=T/hr(v,b)}o(w,t1,g,!1)}}get _layout(){const e=cs().vec3f(O.POSITION).vec3f(O.PREVPOSITION).vec3f(O.NEXTPOSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0);return this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Elt(this._layout,this.parameters)}createGLMaterial(e){return new Slt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Slt=class extends Ev{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===V.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(LCe,e)}},Clt=class extends A${constructor(){super(...arguments),this.width=0,this.color=wh,this.join="miter",this.cap=Oh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Elt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=b5+r}}_isClosed(e){return NCe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(O.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){const o=Olt,a=Rlt,l=$lt,c=r.attributes.get(O.POSITION),u=c.indices,h=c.data.length/3,p=r.attributes.get(O.DISTANCETOSTART)?.data;u&&u.length!==2*(h-1)&&console.warn("RibbonLineMaterial does not support indices");const f=r.attributes.get(O.SIZEFEATUREATTRIBUTE)?.data[0]??r.attributes.get(O.SIZE)?.data[0]??1;let g=[1,1,1,1],_=0;const v=this.vertexBufferLayout.fields.has(O.COLORFEATUREATTRIBUTE);v?_=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(g=r.attributes.get(O.COLOR).data);const b=se("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(O.OPACITYFEATUREATTRIBUTE),T=w?r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(s.buffer),A=se("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,P=this.vertexBufferLayout.stride/4;let R=n*P;const F=R;let k=0;const N=p?(ce,I,D)=>k=p[D]:(ce,I,D)=>k+=hr(ce,I),j=se("enable-feature:objectAndLayerId-rendering"),z=(ce,I,D,G,H,J,Q)=>{if(S[R++]=I[0],S[R++]=I[1],S[R++]=I[2],S[R++]=ce[0],S[R++]=ce[1],S[R++]=ce[2],S[R++]=D[0],S[R++]=D[1],S[R++]=D[2],S[R++]=G,S[R++]=Q,S[R++]=H,S[R++]=f,v)S[R++]=_;else{const ee=Math.min(4*J,g.length-4);S[R++]=g[ee],S[R++]=g[ee+1],S[R++]=g[ee+2],S[R++]=g[ee+3]}w&&(S[R++]=T),j&&(b!=null&&(A[4*R]=b[0],A[4*R+1]=b[1],A[4*R+2]=b[2],A[4*R+3]=b[3]),R++)};R+=P,te(a,c.data[0],c.data[1],c.data[2]),e&&Ve(a,a,e);const X=this._isClosed(r);if(X){const ce=c.data.length-3;te(o,c.data[ce],c.data[ce+1],c.data[ce+2]),e&&Ve(o,o,e)}else te(l,c.data[3],c.data[4],c.data[5]),e&&Ve(l,l,e),z(a,a,l,1,rc.LEFT_CAP_START,0,0),z(a,a,l,1,rc.RIGHT_CAP_START,0,0),ae(o,a),ae(a,l);const q=X?0:1,Z=X?h:h-1;for(let ce=q;ce<Z;ce++){const I=(ce+1)%h*3;te(l,c.data[I],c.data[I+1],c.data[I+2]),e&&Ve(l,l,e),N(o,a,ce),z(o,a,l,0,rc.LEFT_JOIN_END,ce,k),z(o,a,l,0,rc.RIGHT_JOIN_END,ce,k);const D=this.numJoinSubdivisions;for(let G=0;G<D;++G){const H=(G+1)/(D+1);z(o,a,l,H,rc.LEFT_JOIN_END,ce,k),z(o,a,l,H,rc.RIGHT_JOIN_END,ce,k)}z(o,a,l,1,rc.LEFT_JOIN_START,ce,k),z(o,a,l,1,rc.RIGHT_JOIN_START,ce,k),ae(o,a),ae(a,l)}X?(te(l,c.data[3],c.data[4],c.data[5]),e&&Ve(l,l,e),k=N(o,a,Z),z(o,a,l,0,rc.LEFT_JOIN_END,q,k),z(o,a,l,0,rc.RIGHT_JOIN_END,q,k)):(k=N(o,a,Z),z(o,a,a,0,rc.LEFT_CAP_END,Z,k),z(o,a,a,0,rc.RIGHT_CAP_END,Z,k)),tG(S,F+P,S,F,P),R=tG(S,R-P,S,R,P),this._parameters.wireframe&&this._addWireframeVertices(s,F,R,P)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=tG(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function tG(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function NCe(t,e){return t.isClosed?e.get(O.POSITION).indices.length>2:!1}function Alt(t){return t.anchor===Xw.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const dl=C(),pl=C(),Fp=C(),t1=C(),Mlt=C(),i1=Jo(),r1=Jo(),rae=C(),sae=C(),nae=Cp(),Plt=Cp(),Olt=C(),Rlt=C(),$lt=C(),fA=[Jo(),Jo(),Jo(),Jo()],Ym=[C(),C(),C(),C()],iG=Ui(),rG=Ui(),sG=Ui(),nG=Ui();let FCe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+wu(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=m5(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(_e(bo,e,i.vec3),bo[0]=Math.abs(bo[0]),bo[1]=Math.abs(bo[1]),bo[2]=Math.abs(bo[2]),bo[0]<c&&bo[1]<c&&bo[2]<c){if(l){const u=Math.max(...bo);if(_e(bo,e,l.vec3),bo[0]=Math.abs(bo[0]),bo[1]=Math.abs(bo[1]),bo[2]=Math.abs(bo[2]),Math.max(...bo)<u)return l}return i}return l||(l=m5(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=kt(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new XS({width:2,color:i}),s.add(this._material);const f=new fCe(s,{pickable:!1}),g=new Rv({castShadow:!1});s.add(g),f.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,h=.5*this._gridSize;for(let f=0;f<l;f++)c[3*f]=e[0]+(1&a[f]?h:-h),c[3*f+1]=e[1]+(2&a[f]?h:-h),c[3*f+2]=e[2]+(4&a[f]?h:-h),f>0&&u.push(f-1,f);jr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const p=new rn(this._material,[[O.POSITION,new Ze(c,u,3,!0)]],null,ws.Line);s.add(p),o.addGeometry(p)}get test(){}};const bo=C();let kCe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new br,this.output=V.Color,this.renderOccludedMask=w5,this.bindParameters=new zU(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}},Ilt=class extends kCe{constructor(e,i,r,s){super(e,r,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const w5=ki.Occlude|ki.OccludeAndTransparent|ki.OccludeAndTransparentStencil;let YM=class extends br{constructor(){super(...arguments),this._projectionMatrix=xe()}get projectionMatrix(){return this._projectionMatrix}};d([m()],YM.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],YM.prototype,"projectionMatrix",null),YM=d([U("esri.views.3d.webgl-engine.lib.CascadeCamera")],YM);var Zw;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(Zw||(Zw={}));let BI=class{constructor(){this.camera=new YM,this.lightMat=xe()}},Llt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},yQ=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Llt,this._projectionView=xe(),this._projectionViewInverse=xe(),this._modelViewLight=xe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Yt(),this._cascades=[new BI,new BI,new BI,new BI],this._lastOrigin=null,this._maxTextureWidth=Math.min(se("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Zr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Xt(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Te(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)aG[e]=this._cascades[e];return aG.length=this._numCascades,aG}start(e,i,r,s,n){at(this.enabled);const{near:o,far:a}=zlt(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(){at(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!ho(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),ae(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){Aa(hae,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)dae[16*i+r]=hae[r]}}return dae}moveSnapshot(e){at(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const i=this._handle?.getTexture()?.descriptor;if(!this.enabled||!i)return;this._snapshots[e]?.release();const{width:r,height:s}=i,n=e===Zw.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,kr.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture(this._snapshots[e]?.getTexture(),ur.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(vs.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,ur.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=N_(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return Iwe(a/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",kr.RGBA4)),this._handle?.acquireDepth(co.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Xt(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);at(l<c);for(let f=0;f<8;++f){Zr(oae,f%4==0||f%4==3?-1:1,f%4==0||f%4==1?-1:1,f<4?l:c,1);const g=uh[f];Cc(g,oae,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Yn(oG,uh[0]),n.camera.viewMatrix=Aa(Dlt,this._modelViewLight,oG);for(let f=0;f<8;++f)Ve(uh[f],uh[f],n.camera.viewMatrix);let u=uh[0][2],h=uh[0][2];for(let f=1;f<8;++f)u=Math.min(u,uh[f][2]),h=Math.max(h,uh[f][2]);u-=200,h+=200,n.camera.near=-h,n.camera.far=-u,Ult(r,s,u,h,n.camera),Ai(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureHeight;n.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,i){Ai(this._projectionView,e.projectionMatrix,e.viewMatrix),Is(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Ne.Global?e.eye:te(oG,0,0,1);Gk(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(MYe(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Et(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const Dlt=xe(),oae=Yt(),uh=[];for(let t=0;t<8;++t)uh.push(Yt());const aae=it(),lae=it(),Nlt=it(),cae=it(),uae=it(),oG=C(),aG=[],hae=xe(),dae=Cr.concat(Cr,Cr,Cr,Cr),Bc=it(),rT=it(),s1=[it(),it(),it(),it()],In=it(),lG=it(),py=it(),mA=it(),sT=it(),nT=it(),VI=it();function Flt(t,e,i,r,s,n,o,a){bi(Bc,0,0);for(let A=0;A<4;++A)Cd(Bc,Bc,t[A]);mu(Bc,Bc,.25),bi(rT,0,0);for(let A=4;A<8;++A)Cd(rT,rT,t[A]);mu(rT,rT,.25),gh(s1[0],t[4],t[5],.5),gh(s1[1],t[5],t[6],.5),gh(s1[2],t[6],t[7],.5),gh(s1[3],t[7],t[4],.5);let l=0,c=m4(s1[0],Bc);for(let A=1;A<4;++A){const P=m4(s1[A],Bc);P<c&&(c=P,l=A)}Rf(In,s1[l],t[l+4]);const u=In[0];let h,p;In[0]=-In[1],In[1]=u,Rf(lG,rT,Bc),wn(lG,In)<0&&rve(In,In),gh(In,In,lG,i),tR(In,In),h=p=wn(Rf(py,t[0],Bc),In);for(let A=1;A<8;++A){const P=wn(Rf(py,t[A],Bc),In);P<h?h=P:P>p&&(p=P)}ta(r,Bc),mu(py,In,h-e),Cd(r,r,py);let f=-1,g=1,_=0,v=0;for(let A=0;A<8;++A){Rf(mA,t[A],r),tR(mA,mA);const P=In[0]*mA[1]-In[1]*mA[0];P>0?P>f&&(f=P,_=A):P<g&&(g=P,v=A)}Bx(f>0,"leftArea"),Bx(g<0,"rightArea"),mu(sT,In,h),Cd(sT,sT,Bc),mu(nT,In,p),Cd(nT,nT,Bc),VI[0]=-In[1],VI[1]=In[0];const b=J3(r,t[v],nT,Cd(py,nT,VI),1,s),w=J3(r,t[_],nT,py,1,n),T=J3(r,t[_],sT,Cd(py,sT,VI),1,o),S=J3(r,t[v],sT,py,1,a);Bx(b,"rayRay"),Bx(w,"rayRay"),Bx(T,"rayRay"),Bx(S,"rayRay")}function Ci(t,e){return 3*e+t}const pae=it();function Wl(t,e){return bi(pae,t[e],t[e+3]),pae}const fl=it(),nt=yr();function klt(t,e,i,r,s){Rf(fl,i,r),mu(fl,fl,.5),nt[0]=fl[0],nt[1]=fl[1],nt[2]=0,nt[3]=fl[1],nt[4]=-fl[0],nt[5]=0,nt[6]=fl[0]*fl[0]+fl[1]*fl[1],nt[7]=fl[0]*fl[1]-fl[1]*fl[0],nt[8]=1,nt[Ci(0,2)]=-wn(Wl(nt,0),t),nt[Ci(1,2)]=-wn(Wl(nt,1),t);let n=wn(Wl(nt,0),i)+nt[Ci(0,2)],o=wn(Wl(nt,1),i)+nt[Ci(1,2)],a=wn(Wl(nt,0),r)+nt[Ci(0,2)],l=wn(Wl(nt,1),r)+nt[Ci(1,2)];n=-(n+a)/(o+l),nt[Ci(0,0)]+=nt[Ci(1,0)]*n,nt[Ci(0,1)]+=nt[Ci(1,1)]*n,nt[Ci(0,2)]+=nt[Ci(1,2)]*n,n=1/(wn(Wl(nt,0),i)+nt[Ci(0,2)]),o=1/(wn(Wl(nt,1),i)+nt[Ci(1,2)]),nt[Ci(0,0)]*=n,nt[Ci(0,1)]*=n,nt[Ci(0,2)]*=n,nt[Ci(1,0)]*=o,nt[Ci(1,1)]*=o,nt[Ci(1,2)]*=o,nt[Ci(2,0)]=nt[Ci(1,0)],nt[Ci(2,1)]=nt[Ci(1,1)],nt[Ci(2,2)]=nt[Ci(1,2)],nt[Ci(1,2)]+=1,n=wn(Wl(nt,1),e)+nt[Ci(1,2)],o=wn(Wl(nt,2),e)+nt[Ci(2,2)],a=wn(Wl(nt,1),i)+nt[Ci(1,2)],l=wn(Wl(nt,2),i)+nt[Ci(2,2)],n=-.5*(n/o+a/l),nt[Ci(1,0)]+=nt[Ci(2,0)]*n,nt[Ci(1,1)]+=nt[Ci(2,1)]*n,nt[Ci(1,2)]+=nt[Ci(2,2)]*n,n=wn(Wl(nt,1),e)+nt[Ci(1,2)],o=wn(Wl(nt,2),e)+nt[Ci(2,2)],a=-o/n,nt[Ci(1,0)]*=a,nt[Ci(1,1)]*=a,nt[Ci(1,2)]*=a,s[0]=nt[0],s[1]=nt[1],s[2]=0,s[3]=nt[2],s[4]=nt[3],s[5]=nt[4],s[6]=0,s[7]=nt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=nt[6],s[13]=nt[7],s[14]=0,s[15]=nt[8]}function Ult(t,e,i,r,s){const n=1/uh[0][3],o=1/uh[4][3];at(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Zn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Flt(uh,a,l,aae,lae,Nlt,cae,uae),klt(aae,lae,cae,uae,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function zlt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}function Blt(t){return Uh(t)&&t.intersector===Fr.TERRAIN&&!!t.target}let Vlt=class extends g${constructor(e,i,r){super(e,i),this.triangleNr=r}};function UCe(t){return Uh(t)&&t.intersector===Fr.OVERLAY&&!!t.target}var qr,An;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(qr||(qr={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(An||(An={}));let zCe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces.get(i)?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===av.LOADED)return n;this._repository.requestRender()}return null}},P7=class extends JSe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},_Q=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function fae(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0}}}let mae=class extends _Q{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},Glt=class{constructor(){this.first=0,this.count=0}},jlt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Gt({allocator:e=>e||new _Q,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=GI(),this.drawCommandsHighlight=GI(),this.drawCommandsOccludees=GI(),this.drawCommandsShadowHighlightRest=GI()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(gae(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),gae(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Hlt(t){return t.vao!=null}function GI(){return new Gt({allocator:t=>t||new Glt,deallocator:t=>t})}function gae(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(qlt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function qlt(t,e){return t.first+t.count>=e.from}let Wlt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const O7=-3,BCe=O7-1;var Pd;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Pd||(Pd={}));let Ylt=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=Xlt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this,e,i,r,s)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},VCe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Gt,this._users=new Gt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){return this._db.get(e.id+i)?.size??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,Pd.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,Pd.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,Pd.ALL);const a=1+Math.max(n,BCe)-O7;this._db.set(i,new Zlt(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,Pd.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:h}=c;if(a.startsWith(u)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+O7-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,Pd.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,Pd.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e?.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||(s=this._db.has(n))}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,Pd.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},Xlt=0,Zlt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}},B$=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case Pd.ALL:return r.forEach(o=>o.dispose()),0;case Pd.SOME:{const o=r.shift();return o&&(n-=Math.round(o.usedMemory),o.dispose()),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){if(r){const s=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,i,s)}}else this._cache.pop(e);return r}put(e,i,r=BCe){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[i],i.usedMemory,r);s.push(i);const n=this._cache.getSize(e)+Math.round(i.usedMemory);this._cache.updateSize(e,s,n)}},Jlt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new B$(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new Pm(this._rctx,this._locations,{geometry:this._layout},{geometry:lr.createVertex(this._rctx,Hi.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},pO=class extends Dxe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=Tt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=Tt(this._vaoCache)}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==V.Highlight&&r!==V.ShadowHighlight||this._hasHighlights))&&e(r))})}get produces(){return this._produces}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new zCe(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new Jlt(r,this.material.vertexAttributeLocations,Lc(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(An.GEOMETRY|An.TRANSFORMATION)){const c=qI(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(An.HIGHLIGHT|An.OCCLUDEE|An.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new uv;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new yae(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new yae(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let h=s.get(l);if(a.forEach((p,f)=>{if(o.delete(l,f),f==null)return void at(!1,"No VAO for removed geometries");if(f.instances.size===p.changes.length)return this._vaoCache.deleteVao(f.vao),EO(h.buffers,f),void(h.buffers.length===0&&u.length===0&&s.delete(l));const g=f.numElements,_=f.vao.byteSize/4,v=u.reduce((S,A)=>S+r.elementCount(A.geometry),0),b=p.changes.reduce((S,A)=>S+r.elementCount(A.geometry),0),w=Math.min((g+v-b)*n,HI),T=w>_;w>x5&&w<_/2?(p.changes.forEach(({id:S})=>f.deleteInstance(S)),f.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(f.vao),EO(h.buffers,f)):T?this._applyAndRebuild(f,u,p):this._applyRemoves(f,p)}),u.length>0)for(h==null&&(h=new Wlt(c.origin),s.set(l,h)),h.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)h.buffers.push(this._applyAndRebuild(new jlt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,vu(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(HI/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),_=s.elementCount(g.geometry);if(l+_>a&&l>0){i.push(g);break}l+=_;const v=new mae(g,0,0);at(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=qI(c),h=s.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,_)=>{this._writeGeometry(g.geometry,h,p);const v=p;p+=s.elementCount(g.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(bae(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const f=e.holes.pushNew();return f.from=p,f.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=kp.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const h=kp.pushNew();h.from=c.from,h.to=c.to}fae(kp);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=kp.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=qI(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;kp.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(kp.data,kp.length),kp.forAll((a,l)=>kp.data[l]=null),kp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!Hlt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry),0),a=Math.min((n+o)*s,HI),l=4*a;if(e.vao.byteSize<bae(HI-x5)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);fae(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry),T=Qlt(e.holes,w);c.push(T)}const u=e.vao.vertexBuffers.geometry;let h=0,p=0,f=0;const g=qI(a),_=r.vertexBufferLayout.createView(g.buffer);i.forEach((b,w)=>{const T=c[w];if(T==null)return;if(f!==T){const P=f-p;P>0&&u.setSubData(g,p*s,0,P*s),p=T,h=0}const S=r.elementCount(b.geometry);this._writeGeometry(b,_,h),h+=S,f=T+S;const A=new mae(b,T,T+S);at(e.instances.get(b.id)==null),e.addInstance(b.id,A),e.drawCommandsDirty=!0});const v=f-p;v>0&&u.setSubData(g,p*s,0,v*s),FRe(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;PYe(_ae,-s[0],-s[1],-s[2]);const n=Ai(Klt,_ae,e.transformation);Is(jI,n),Pc(jI,jI),this._bufferWriter.write(n,jI,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e;if(!this.material.produces.get(r.slot)?.(i))return null;const n=i===V.Highlight||i===V.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=i===V.ShadowExcludeHighlight,a=!(n||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(n&&!c.hasHighlights)continue;const u=(n?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,h=a&&c.drawCommandsOccludees||null;if(u?.length||h?.length){const p=this._glMaterials.load(e.rctx,r.slot,i),f=p!=null?p.beginSlot(r):null;if(f!=null)return f}}return null}renderNode(e,i){const{output:r,bindParameters:s}=e,n=r===V.Highlight||r===V.ShadowHighlight,o=r===V.ShadowExcludeHighlight,a=!(n||o),l=s.slot===ye.OCCLUDER_MATERIAL,c=s.slot===ye.TRANSPARENT_OCCLUDER_MATERIAL,u=e.rctx;u.runAppleAmdDriverHelper(),u.bindTechnique(i,s,this.material.parameters);for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(n&&!p.hasHighlights)continue;const f=(n?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,g=a&&p.drawCommandsOccludees||null;(f?.length||g?.length)&&(i.program.bindDraw(new P7(h.origin),s,this.material.parameters),i.ensureAttributeLocations(p.vao),u.bindVAO(p.vao),f?.length&&(u.setPipelineState(i.getPipeline(!1,l,c)),f.forAll(_=>u.drawArrays(i.primitiveType,_.first,_.count))),g?.length&&(u.setPipelineState(i.getPipeline(!0,l,c)),g.forAll(_=>u.drawArrays(i.primitiveType,_.first,_.count))))}}get test(){}};d([m({constructOnly:!0})],pO.prototype,"material",void 0),pO=d([U("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],pO);let yae=class{constructor(e){this.origin=e,this.changes=new Array}};function Qlt(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const _ae=xe(),Klt=xe(),jI=xe(),kp=new Gt({allocator:t=>t||new _Q,deallocator:null}),x5=65536,cG=4*x5,vae=1024,GCe=16777216,HI=GCe/4;let uG=new Float32Array(x5);function qI(t){return uG.length<t&&(uG=new Float32Array(t)),uG}function bae(t){const e=4*t;return e<=vae?vae:e<cG?Jfe(e):Math.max(Math.min(Math.ceil(1.5*e/cG)*cG,GCe),e)}let tu=class extends Pe{constructor(e){super(e),this._pending=new ect,this._changes=new k9,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Gt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return vu(this._materialRenderers,e=>e.numGeometries!==0&&!e.queryRenderOccludedState(ki.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=nxe(this._changes);let i=!1;return e.forEach((r,s)=>{let n=this.getMaterialRenderer(s);if(!n&&r.adds.length>0){const o=new pO({material:s});o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),n=o,this._materialRenderers.set(s,n),i=!0}n&&(n.modify(r),n.numGeometries===0&&(this._materialRenderers.delete(s),n.destroy(),i=!0))}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=vu(this._materialRenderers,r=>{const s=r.produces.get(ye.DRAPED_MATERIAL);return!!s&&s(V.Highlight)}),this._hasWater=vu(this._materialRenderers,r=>{const s=r.produces.get(ye.DRAPED_WATER);return!!s&&s(V.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===qr.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===qr.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case An.TRANSFORMATION:case An.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case An.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const i of this._materialRenderers.values())i.drapedPriority=e++,this._sortedMaterialRenderers.push(i);this._sortedMaterialRenderers.sort((i,r)=>r.materialReference?.renderPriority===i.materialReference?.renderPriority?i.drapedPriority-r.drapedPriority:(r.materialReference?.renderPriority||0)-(i.materialReference?.renderPriority||0))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],hG[0]=r[0]-s,hG[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,hG,(l,c,u)=>{tct(i,u,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};d([m()],tu.prototype,"drapeSource",void 0),d([m()],tu.prototype,"updating",null),d([m()],tu.prototype,"rctx",null),d([m({constructOnly:!0})],tu.prototype,"rendererContext",void 0),d([m()],tu.prototype,"_materials",null),d([m()],tu.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],tu.prototype,"isEmpty",null),d([m()],tu.prototype,"_materialRenderers",void 0),d([m()],tu.prototype,"_geometries",void 0),tu=d([U("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],tu);let ect=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function tct(t,e,i,r,s,n,o){const a=new Vlt(n,o,e),l=c=>{c.set(Fr.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Lo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Lo.ALL){const c=MZ(s.ray);l(c),s.results.all.push(c)}}const hG=it();let vQ=class jCe extends Ni{initializeProgram(e){return new Fi(e.rctx,jCe.shader.get().build(),di)}initializePipeline(){return this.configuration.hasAlpha?Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt}):Lt({colorWrite:qt})}};vQ.shader=new Oi(mat,()=>ue(()=>import("./TextureOnly.glsl-1dc7bfa9.js"),[],import.meta.url));let bQ=class extends ol{constructor(){super(...arguments),this.hasAlpha=!1}};d([B()],bQ.prototype,"hasAlpha",void 0);let HCe=class extends xr{constructor(){super(...arguments),this.overlayIndex=ln.INNER,this.opacity=1}};function ict(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("tex",e=>e.texture)),t.fragment.uniforms.add(new wE("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ue("opacity",e=>e.opacity)),t.fragment.code.add(x`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const rct=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:HCe,build:ict},Symbol.toStringTag,{value:"Module"}));let qCe=class WCe extends Ni{initializeProgram(e){return new Fi(e.rctx,WCe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};qCe.shader=new Oi(rct,()=>ue(()=>import("./OverlayCompositing.glsl-3694eadd.js"),[],import.meta.url));let ih=class extends iJ{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new HCe,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Gt,this._passParameters=new lCe,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new br,this.worldToPCSRatio=1,this.events=new Ls,this.longitudeCyclical=null,this.produces=new Map([[ye.DRAPED_MATERIAL,i=>i!==V.Highlight||this.hasHighlights],[ye.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextures:r,stippleTextures:s,markerTextures:n}=i;this._techniques=new cCe({rctx:this._rctx,viewingMode:Ne.Local,stippleTextures:s,markerTextures:n,waterTextures:r}),this._renderContext=new kCe(this._rctx,new yQ(e,this.view.state.viewingMode),null),this.addHandles([he(()=>r.updating,()=>this.events.emit("content-changed"),qi),he(()=>this.spatialReference,o=>this._localOriginFactory=new FCe(o),qi),yo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materials=new uCe(i.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ye.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Qe.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new JZ(Ce(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(wt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Xt(this._debugTextureTechnique),this._passParameters.texture=Tt(this._passParameters.texture),this._techniques=Oe(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||vu(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,tu)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s?.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(he(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&eD(e,i=>i.drapeTargetType===E7.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=eD(e,i=>i.drapeSourceType===uO.Features),this._hasDrapedRasterSource=eD(e,i=>i.drapeSourceType===uO.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new rat(this.view._stage.renderer.fboCache),this._overlays=[new Woe,new Woe]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Tt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===Nr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(Nr.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=vu(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(wc,e=>e.updatePolicy===z_.SYNC)}get isEmpty(){return!wr.OVERLAY_DRAW_DEBUG_TEXTURE&&!vu(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=T5;const i=this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,i}renders(e){return wr.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==Nr.Occluded||this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext))}get mode(){return this.isEmpty?jf.Disabled:this._renderTargets?.getTexture(Nr.WaterNormal)?jf.EnabledWithWater:this._renderTargets?.getTexture(Nr.Color)?jf.Enabled:jf.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets){if(i.content===Nr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(ln.INNER,i,e),s=this._drawTarget(ln.OUTER,i,e);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i,r){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===V.Highlight&&!this.hasHighlights||l===V.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===V.Normal?ye.DRAPED_WATER:ye.DRAPED_MATERIAL,i.content===Nr.Occluded&&(this._renderContext.renderOccludedMask=T5),!this.renders(i.content))return this._renderContext.renderOccludedMask=w5,!1;const u=s.resolution;this._rctx.setViewport(e===ln.INNER?0:u,0,u,u);const h=2*s.resolution,p=s.resolution,f=i.fbo;if(f.bind(c,h,p),e===ln.INNER&&(c.setClearColor(0,0,0,0),c.clear(Sr.COLOR_BUFFER_BIT)),wr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==Nr.Occluded)for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],s),this._ensureDebugPatternResources(s.resolution,nct[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:_})=>{if(i.content===Nr.ColorNoRasterImage&&g.drapeSourceType===uO.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===V.Color?this.bindTemporaryFramebuffer(h,p):null;for(let w=0;w<n.numViews;w++)this._setViewParameters(n.extents[w],s),_.render(this._renderContext);if(b){f.bind(c,h,p),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniques.acquire(qCe);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=w5,!0}bindTemporaryFramebuffer(e,i){const r=this.view._stage.renderer.fboCache,s=r.acquire(e,i,"overlay tmp");return r.rctx.unbindTexture(s.fbo?.colorTexture),r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(Sr.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:o}of this._sortedRenderers)n=o.intersect?.(e,i,r,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?f5.MapLayer:f5.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new sct(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],eye(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),ux(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=vu(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,i){if(te(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new $r(e);n.samplingMode=Zt.NEAREST,this._passParameters.texture=new ur(this._rctx,n,r);const o=new bQ;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(vQ,o)}get test(){}};d([m()],ih.prototype,"hasHighlights",void 0),d([m()],ih.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m()],ih.prototype,"_techniques",void 0),d([m({constructOnly:!0})],ih.prototype,"view",void 0),d([m()],ih.prototype,"worldToPCSRatio",void 0),d([m()],ih.prototype,"spatialReference",void 0),d([m({type:Boolean,readOnly:!0})],ih.prototype,"updating",null),d([m()],ih.prototype,"isEmpty",null),d([m({readOnly:!0})],ih.prototype,"rendersOccludedDraped",null),ih=d([U("esri.views.3d.terrain.OverlayRenderer")],ih);let sct=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const nct=[[1,.5,.5],[.5,.5,1]],wQ=-2,T5=ki.OccludeAndTransparent;function xQ(t,e,i,r){const s=l$(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",fm.CCW_IS_HOLE,t.spatialReference),n=jn(s.position.length),o=xSe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new lct(s.position,n,ZCe(s.polygons,s.position,n),XCe(s.outlines,s.position,n),a,o)}function YCe(t,e){const i=l$(t.rings,!1,fm.CCW_IS_HOLE),r=jr(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=wQ;return{position:i.position,polygons:ZCe(i.polygons,i.position),outlines:XCe(i.outlines,i.position),projectionSuccess:r}}function XCe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new JCe(r,s,Ph(e,n,o),Ph(i,n,o)):new TQ(r,s,Ph(e,n,o))})}function ZCe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),h=i!=null?new oct(s,n,Ph(e,3*s,3*n),Ph(i,l,c),u,a):new act(s,n,Ph(e,3*s,3*n),u,a);r.push(h)}return r}let TQ=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},JCe=class extends TQ{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},oct=class extends JCe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},act=class extends TQ{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},lct=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function kh(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,h=e*n;t[h]=wae(c),t[h+1]=wae(u)}function cct(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)kh(i,s,t[r++],t[r++],t[r++]);return i}function Vkt(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=C();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],On(n,n,e),kh(r,o,n[0],n[1],n[2]);return r}function uct(t,e,i,r=2){const s=i*r,n=xae(e[s]),o=xae(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),fe(t,t)}function wae(t){return Te(Math.round(32767*t),-32767,32767)}function xae(t){return Te(t/32767,-1,1)}const hct=["polygon","extent"];let dct=class extends Dm{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=nz(this._getSymbolSize());if(a)throw new W("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e),r=ya(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Er.None:Er.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:zi.Compressed};this._materials[iu.Main]=new xp(o),this._materials[iu.Bottom]=new xp({...o,cullFace:Er.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,hct,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){const r=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._materials[iu.Main]?.setParameters({opacity:s,transparent:n}),this._materials[iu.Bottom]?.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,dv)}slicePlaneEnabledChanged(e,i){return this._materials[iu.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[iu.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const s=i(r);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[iu.Main]?.setParameters(e),this._materials[iu.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?Jot(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?js.RecreateSymbol:js.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/LO(i),{objectId:o,target:a}=e,l=ge(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,h=ge(c),p=ge(u);return h.z=(h.z??0)+n,p.z=(p.z??0)+n,[Goe(o,l,1/0,h,p)]}case"vertex":return[Dot(o,l,1/0),Goe(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=bR(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(N=>N.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=xQ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=FJ(o);if(l==null)return null;const c=new Array,u=new Array,h=pn(),p=xe(),f=C(),g=this._context.renderCoordsHelper.viewingMode===Ne.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,f),Io(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=xe();Is(_,p);const v=yr();d0(v,_);const{polygons:b,mapPositions:w,position:T}=a,S=new Map,A=this._materials[iu.Main];for(const N of b){const j=N.count;if(this._context.clippingExtent&&(Or(h),Tc(h,N.mapPositions),!Wd(h,this._context.clippingExtent)))continue;const z=fC(N.mapPositions,N.holeIndices,3);if(z.length===0)continue;const X=z.length,q=6*j,Z=p4(q+X),ce=p4(X),I=jn(3*q),D=jn(3*q),G=jn(3*q),H=jn(q);pct(T,w,z,N,I,G,D,H,Z,ce,this._getExtrusionSize(i),f,g),yp(I,I,_);const J=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),Q=new xct(I,G,cct(D),H),ee=Tae(A,Z,Z.length-ce.length,Q,r,J),de=j,we=j,Re=2*N.count,tt=new Tct(de,we,Re,X/3);QCe(ee,tt,p),S.set(ee,tt),c.push(ee,Tae(this._materials[iu.Bottom],ce,0,Q,r,J)),u.push(Q.heights)}if(c.length===0)return null;const P=new Rv({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});P.transformation=p;const R=VSe(this.symbolLayer,{opacity:this._getLayerOpacity()}),F=R!=null?{baseMaterial:this._materials[iu.Main],edgeMaterials:[R],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,k=new Lm(this,P,c,null,null,(N,j,z,X,q)=>gct(N,j,z,X,q,u,S),s,F);return k.alignedSampledElevation=a.sampledElevation,k.needsElevationUpdates=dv(s.mode),k}};function Tae(t,e,i,r,s,n){const o=wv(e.length),a=[[O.POSITION,new Ze(r.positions,e,3,!0)],[O.NORMALCOMPRESSED,new Ze(r.normals,e,2,!0)],[O.COLOR,new Ze(s,o,4,!0)]];return new rn(t,a,r.elevation,ws.Mesh,n,i)}function pct(t,e,i,r,s,n,o,a,l,c,u,h,p){{const f=i.length/3,g=2*r.count;fct(t,e,r.index,r.count,i,0,f,s,n,o,a,l,c,g,u,h,p)}{let f=0,g=2*r.count,_=0;const v=r.pathLengths[0];Sae(s,n,a,o,f,v,r.count,g,l,_,u),g+=4*v,_+=2*v,f+=v;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];Sae(s,n,a,o,f,w,r.count,g,l,_,u),g+=4*w,_+=2*w,f+=w}}}function fct(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,_,v){ae(Xc,_);{const b=g>0?1:-1;let w=3*i,T=0,S=3*T,A=r,P=3*A;for(let R=0;R<r;++R){const F=t[w],k=t[w+1],N=t[w+2];v&&(Xc[0]=F,Xc[1]=k,Xc[2]=N,fe(Xc,Xc)),a[S+0]=F,a[S+1]=k,a[S+2]=N;const j=e[w+0],z=e[w+1],X=e[w+2];l[S+0]=j,l[S+1]=z,l[S+2]=X,c[S+0]=-b*Xc[0],c[S+1]=-b*Xc[1],c[S+2]=-b*Xc[2],u[T]=0,a[P+0]=F+g*Xc[0],a[P+1]=k+g*Xc[1],a[P+2]=N+g*Xc[2],l[P+0]=j,l[P+1]=z,l[P+2]=X,u[A]=g,S+=3,P+=3,w+=3,T+=1,A+=1}}{let b=3*n,w=0,T=3*f;const S=g<0?Oae:Pae,A=g<0?Pae:Oae;for(let P=0;P<o;++P)p[w]=s[b+S[0]],p[w+1]=s[b+S[1]],p[w+2]=s[b+S[2]],h[T]=s[b+A[0]]+r,h[T+1]=s[b+A[1]]+r,h[T+2]=s[b+A[2]]+r,w+=3,T+=3,b+=3}}function WI(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const gA=C();function Sae(t,e,i,r,s,n,o,a,l,c,u){let h=s,p=s+1,f=s+o,g=s+o+1,_=a,v=a+1,b=a+2*n,w=a+2*n+1;u<0&&(h=s+o+1,g=s);let T=3*c;for(let S=0;S<n;++S)S===n-1&&(p=s,u>0?g=s+o:h=s+o),mct(t,h,p,f,gA),WI(t,e,r,i,gA,_,h),WI(t,e,r,i,gA,v,p),WI(t,e,r,i,gA,b,f),WI(t,e,r,i,gA,w,g),l[T]=_,l[T+1]=b,l[T+2]=w,l[T+3]=_,l[T+4]=w,l[T+5]=v,T+=6,h++,p++,f++,g++,_+=2,v+=2,b+=2,w+=2}const dG=C(),Cae=C(),Eae=C(),Aae=C(),Mae=C();function mct(t,e,i,r,s){e*=3,i*=3,r*=3,te(dG,t[e++],t[e++],t[e++]),te(Cae,t[i++],t[i++],t[i++]),te(Eae,t[r++],t[r++],t[r++]),_e(Aae,Cae,dG),_e(Mae,Eae,dG),Ke(s,Mae,Aae),fe(s,s)}const oT=C();function gct(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,u=e.mode!=="absolute-height";let h=0;const p=a.transformation,f=vv(xe(),p);for(let g=0;g<c;g+=2){const _=l[g];if(!DJ(_))continue;const v=_.getMutableAttribute(O.POSITION).data,b=n[g/2],w=new OZ(_.mapPositions),T=v.length/3;let S=!1,A=0;{let P=0;for(let R=0;R<T;R++){oT[0]=v[P],oT[1]=v[P+1],oT[2]=v[P+2],r(w,YI),u&&(A+=YI.sampledElevation),wr.TESTS_DISABLE_OPTIMIZATIONS?(te(za,w.array[w.offset],w.array[w.offset+1],YI.z+b[P/3]),i!=null&&s.toRenderCoords(za,i,za),Ve(za,za,f)):(te(za,v[P],v[P+1],v[P+2]),Ve(za,za,p),s.setAltitude(za,YI.z+b[P/3]),Ve(za,za,f)),v[P]=za[0],v[P+1]=za[1],v[P+2]=za[2];const F=yct/s.unitInMeters;(Math.abs(oT[0]-v[P])>=F||Math.abs(oT[1]-v[P+1])>=F||Math.abs(oT[2]-v[P+2])>=F)&&(S=!0),w.offset+=3,P+=3}}if(S){const P=o.get(_);P&&QCe(_,P,p),a.geometryVertexAttributeUpdated(l[g],O.NORMALCOMPRESSED),_.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g],O.POSITION),l[g+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g+1],O.POSITION)}h+=A/T}return h/c}function QCe(t,e,i){const r=t.getMutableAttribute(O.POSITION),s=t.getMutableAttribute(O.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,u=o,h=t.attributes.get(O.POSITION).indices,p=a+l,f=n+o,g=jn(3*u);for(let S=0;S<u;++S){const A=3*S;g[A+0]=0,g[A+1]=0,g[A+2]=0}const _=_ct,v=vct,b=bct,w=wct,T=Xc;for(let S=a;S<p;++S){const A=3*S;for(let P=0;P<3;++P){const R=h[A+P];w[P]=R;const F=3*R;te(za,c[F+0],c[F+1],c[F+2]),Ve(_[P],za,i)}yi(v,_[1],_[0]),yi(b,_[2],_[0]),Ke(T,v,b),fe(T,T);for(let P=0;P<3;++P){const R=3*(w[P]-n);g[R+0]+=T[0],g[R+1]+=T[1],g[R+2]+=T[2]}}for(let S=n;S<f;++S){const A=3*(S-n),P=g[A+0],R=g[A+1],F=g[A+2],k=Math.sqrt(P*P+R*R+F*F);kh(s,S,P/k,R/k,F/k)}}const za=C(),Xc=C(),YI=new P$,Pae=[0,2,1],Oae=[0,1,2],yct=.01,_ct=[C(),C(),C()],vct=C(),bct=C(),wct=[0,0,0];var iu;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(iu||(iu={}));let xct=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},Tct=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}};const XI=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],kC=["آ","أ","إ","ا"],Sct=["ﻵ","ﻷ","ﻹ","ﻻ"],Cct=["ﻶ","ﻸ","ﻺ","ﻼ"],S5=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],Ect=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],Act=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],Mct=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],Pct=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],Rae=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],Oct=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],$ae=["ء","ف"],Rct=["غ","ي"],$ct=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],Ict=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,be=1,Mt=2,bn=3,E=4,Af=5,MN=6,M=7,ka=8,ml=9,Kh=10,Ft=11,K=12,Lct=13,Dct=14,Nct=15,Fct=16,kct=17,ft=18,Uct=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],xf=100,zct=[xf+0,$,$,$,$,xf+1,xf+2,xf+3,be,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,xf+4,E,E,E,$,E,$,E,$,E,E,E,$,$,E,E,$,$,$,$,$,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,$,$,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,$,$,E,E,$,$,E,E,$,$,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,$,$,$,xf+5,M,M,xf+6,xf+7],Bct=[[ft,ft,ft,ft,ft,ft,ft,ft,ft,MN,Af,MN,ka,Af,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,Af,Af,Af,MN,ka,E,E,Ft,Ft,Ft,E,E,E,E,E,Kh,ml,Kh,ml,ml,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,ml,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,E,ft,ft,ft,ft,ft,ft,Af,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ft,ml,E,Ft,Ft,Ft,Ft,E,E,E,E,$,E,E,ft,E,E,Ft,Ft,Mt,Mt,E,$,E,E,E,Mt,$,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,$,$,$,$,$,$,$,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,$,E,E,E,E,E,E,E,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,be,K,be,K,K,be,K,K,be,K,E,E,E,E,E,E,E,E,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,E,E,E,E,E,be,be,be,be,be,E,E,E,E,E,E,E,E,E,E,E],[bn,bn,bn,bn,E,E,E,E,M,Ft,Ft,M,ml,M,E,E,K,K,K,K,K,K,K,K,K,K,K,M,E,E,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,bn,bn,bn,bn,bn,bn,bn,bn,bn,bn,Ft,bn,bn,M,M,M,K,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,K,K,K,K,K,K,K,bn,E,K,K,K,K,K,K,M,M,K,K,E,K,K,K,K,M,M,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,M,M,M,M,M,M],[M,M,M,M,M,M,M,M,M,M,M,M,M,M,E,M,M,K,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,E,E,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,K,K,K,K,K,K,K,K,K,K,K,M,E,E,E,E,E,E,E,E,E,E,E,E,E,E,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,K,K,K,K,K,K,K,K,K,be,be,E,E,E,E,be,E,E,E,E,E],[ka,ka,ka,ka,ka,ka,ka,ka,ka,ka,ka,ft,ft,ft,$,be,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,ka,Af,Lct,Dct,Nct,Fct,kct,ml,Ft,Ft,Ft,Ft,Ft,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,ml,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,ka,ft,ft,ft,ft,ft,E,E,E,E,E,ft,ft,ft,ft,ft,ft,Mt,$,E,E,Mt,Mt,Mt,Mt,Mt,Mt,Kh,Kh,E,E,E,$,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Kh,Kh,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,Ft,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E],[$,$,$,$,$,$,$,E,E,E,E,E,E,E,E,E,E,E,E,$,$,$,$,$,E,E,E,E,E,be,K,be,be,be,be,be,be,be,be,be,be,Kh,be,be,be,be,be,be,be,be,be,be,be,be,be,E,be,be,be,be,be,E,be,E,be,be,E,be,be,E,be,be,be,be,be,be,be,be,be,be,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M],[K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,K,K,K,K,K,K,K,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,ml,E,ml,E,E,ml,E,E,E,E,E,E,E,E,E,Ft,E,E,Kh,Kh,E,E,E,E,E,Ft,Ft,E,E,E,E,E,M,M,M,M,M,E,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,E,E,ft],[E,E,E,Ft,Ft,Ft,E,E,E,E,E,Kh,ml,Kh,ml,ml,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,ml,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,E,E,E,E,E,E,E,E,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,E,E,E,$,$,$,$,$,$,E,E,$,$,$,$,$,$,E,E,$,$,$,$,$,$,E,E,$,$,$,E,E,E,Ft,Ft,E,E,E,Ft,Ft,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E]];let Vct=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,i,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(nut(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(i,r))return e;i=this.inputFormat,r=this.outputFormat;let s=e;const n=aut,o=Dae(i.charAt(1)),a=Dae(r.charAt(1)),l=(i.charAt(0)==="I"?"L":i.charAt(0))+o,c=(r.charAt(0)==="I"?"L":r.charAt(0))+a,u=i.charAt(2)+r.charAt(2);n.defInFormat=l,n.defOutFormat=c,n.defSwap=u;const h=XM(e,l,c,u,n);let p=!1;return r.charAt(1)==="R"?p=!0:r.charAt(1)!=="C"&&r.charAt(1)!=="D"||(p=this.checkContextual(h)==="rtl"),this.sourceToTarget=_u,this.targetToSource=out(this.sourceToTarget),E5=this.targetToSource,s=i.charAt(3)===r.charAt(3)?h:r.charAt(3)==="S"?jct(p,h):Wct(h,p,!0),this.sourceToTarget=_u,this.targetToSource=E5,this.levels=gz,s}_inputFormatSetter(e){if(!Nae.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!Nae.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,i){return e?this._inputFormatSetter(e):e=this.inputFormat,i?this._outputFormatSetter(i):i=this.outputFormat,e!==i}checkContextual(e){let i=C5(e);if(i!=="ltr"&&i!=="rtl"){try{i=document.dir.toLowerCase()}catch{}i!=="ltr"&&i!=="rtl"&&(i="ltr")}return i}hasBidiChar(e){return uut.test(e)}};function XM(t,e,i,r,s){const n=Gct(t,{inFormat:e,outFormat:i,swap:r},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,i=n.outFormat,r=n.swap;const o=e.substring(0,1),a=e.substring(1,4),l=i.substring(0,1),c=i.substring(1,4);if(s.inFormat=e,s.outFormat=i,s.swap=r,o==="L"&&i==="VLTR"){if(a==="LTR")return s.dir=aT,fy(t,s);if(a==="RTL")return s.dir=ZM,fy(t,s)}if(o==="V"&&l==="V")return s.dir=a==="RTL"?ZM:aT,pG(t,s);if(o==="L"&&i==="VRTL")return a==="LTR"?(s.dir=aT,t=fy(t,s)):(s.dir=ZM,t=fy(t,s)),pG(t);if(e==="VLTR"&&i==="LLTR")return s.dir=aT,fy(t,s);if(o==="V"&&l==="L"&&a!==c)return t=pG(t),a==="RTL"?XM(t,"LLTR","VLTR",r,s):XM(t,"LRTL","VRTL",r,s);if(e==="VRTL"&&i==="LRTL")return XM(t,"LRTL","VRTL",r,s);if(o==="L"&&l==="L"){const u=s.swap;return s.swap=u.substr(0,1)+"N",a==="RTL"?(s.dir=ZM,t=fy(t,s),s.swap="N"+u.substr(1,2),s.dir=aT,t=fy(t,s)):(s.dir=aT,t=fy(t,s),s.swap="N"+u.substr(1,2),t=XM(t,"VLTR","LRTL",s.swap,s)),t}return t}function Gct(t,e,i){if(e.inFormat===void 0&&(e.inFormat=i.defInFormat),e.outFormat===void 0&&(e.outFormat=i.defOutFormat),e.swap===void 0&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const r=e.inFormat.substring(0,1),s=e.outFormat.substring(0,1);let n,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(n=C5(t),o=n==="ltr"||n==="rtl"?n.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=r+o),a.charAt(0)==="C"&&(n=C5(t),n==="rtl"?a="RTL":n==="ltr"?(n=qct(t),a=n.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=s+a),e}function jct(t,e,i){if(e.length===0)return"";t===void 0&&(t=!0);const r=(e=String(e)).split("");let s=0,n=1,o=r.length;t||(s=r.length-1,n=-1,o=1);const a=Hct(r,s,n,o);let l="";for(let c=0;c<r.length;c++)Jct(a,a.length,c)>-1?(tEe(E5,c,!t,-1),_u.splice(c,1)):l+=r[c];return l}function Hct(t,e,i,r,s){let n=0;const o=[];let a=0;for(let l=e;l*i<r;l+=i)if(eEe(t[l])||wR(t[l])){if(t[l]==="ل"&&Qct(t,l+i,i,r)){t[l]=sut(t[l+i],n===0?Sct:Cct),l+=i,rut(t,l,i,r),o[a]=l,a++,n=0;continue}const c=t[l];n===1?t[l]=Iae(t,l+i,i,r)?iut(t[l]):fG(t[l],Act):Iae(t,l+i,i,r)===!0?t[l]=fG(t[l],Pct):t[l]=fG(t[l],Ect),wR(c)||(n=1),tut(c)===!0&&(n=0)}else n=0;return o}function C5(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function qct(t){const e=t.split("");return e.reverse(),C5(e.join(""))}function Wct(t,e,i){if(t.length===0)return"";e===void 0&&(e=!0);let r="";const s=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(s[n]>="ﹰ"&&s[n]<"\uFEFF"){const a=t.charCodeAt(n);s[n]>="ﻵ"&&s[n]<="ﻼ"?(e?(n>0&&i&&s[n-1]===" "?r=r.substring(0,r.length-1)+"ل":(r+="ل",o=!0),r+=kC[(a-65269)/2]):(r+=kC[(a-65269)/2],r+="ل",n+1<t.length&&i&&s[n+1]===" "?n++:o=!0),o&&(tEe(E5,n,!0,1),_u.splice(n,0,_u[n]))):r+=Oct[a-65136]}else r+=s[n]}return r}function fy(t,e){const i=t.split(""),r=[];return KCe(i,r,e),Xct(i,r,e),Lae(2,i,r,e),Lae(1,i,r,e),gz=r,i.join("")}function KCe(t,e,i){const r=t.length,s=i.dir?Ict:$ct;let n=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let c=0;c<r;c++)a[c]=Zct(t[c]);for(let c=0;c<r;c++){const u=n,h=Kct(t,a,l,c,i);l[c]=h,n=s[u][h];const p=240&n;n&=15;const f=s[n][lut];if(e[c]=f,p>0)if(p===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(s[n][cut])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=f;o=-1}a[c]===Af&&(e[c]=0),i.hiLevel|=f}i.hasUbatS&&Yct(a,e,r,i)}function Yct(t,e,i,r){for(let s=0;s<i;s++)if(t[s]===MN){e[s]=r.dir;for(let n=s-1;n>=0&&t[n]===ka;n--)e[n]=r.dir}}function Xct(t,e,i){if(i.hiLevel!==0&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let r=0;r<t.length;r++)e[r]===1&&(t[r]=eut(t[r]))}function Zct(t){const e=t.charCodeAt(0),i=zct[e>>8];return i<xf?i:Bct[i-xf][255&e]}function pG(t,e){const i=t.split("");if(e){const r=[];KCe(i,r,e),gz=r}return i.reverse(),_u.reverse(),i.join("")}function Jct(t,e,i){for(let r=0;r<e;r++)if(t[r]===i)return r;return-1}function eEe(t){for(let e=0;e<$ae.length;e++)if(t>=$ae[e]&&t<=Rct[e])return!0;return!1}function Iae(t,e,i,r){for(;e*i<r&&wR(t[e]);)e+=i;return!!(e*i<r&&eEe(t[e]))}function Qct(t,e,i,r){for(;e*i<r&&wR(t[e]);)e+=i;let s=" ";if(!(e*i<r))return!1;s=t[e];for(let n=0;n<kC.length;n++)if(kC[n]===s)return!0;return!1}function Lae(t,e,i,r){if(r.hiLevel<t)return;if(t===1&&r.dir===ZM&&!r.hasUbatB)return e.reverse(),void _u.reverse();const s=e.length;let n,o,a,l,c,u=0;for(;u<s;){if(i[u]>=t){for(n=u+1;n<s&&i[n]>=t;)n++;for(o=u,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=_u[o],_u[o]=_u[a],_u[a]=c;u=n}u++}}function Kct(t,e,i,r,s){const n=e[r];return{UBAT_L:()=>(s.lastArabic=!1,$),UBAT_R:()=>(s.lastArabic=!1,be),UBAT_ON:()=>E,UBAT_AN:()=>bn,UBAT_EN:()=>s.lastArabic?bn:Mt,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,be),UBAT_WS:()=>E,UBAT_CS:()=>{let o,a;return r<1||r+1>=e.length||(o=i[r-1])!==Mt&&o!==bn||(a=e[r+1])!==Mt&&a!==bn?E:(s.lastArabic&&(a=bn),a===o?a:E)},UBAT_ES:()=>(r>0?i[r-1]:Af)===Mt&&r+1<e.length&&e[r+1]===Mt?Mt:E,UBAT_ET:()=>{if(r>0&&i[r-1]===Mt)return Mt;if(s.lastArabic)return E;let o=r+1;const a=e.length;for(;o<a&&e[o]===Ft;)o++;return o<a&&e[o]===Mt?Mt:E},UBAT_NSM:()=>{if(s.inFormat==="VLTR"){const o=e.length;let a=r+1;for(;a<o&&e[a]===K;)a++;if(a<o){const l=t[r].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===be||u===M))return be}}return r<1||e[r-1]===Af?E:i[r-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,E),UBAT_LRE:()=>(s.lastArabic=!1,E),UBAT_RLE:()=>(s.lastArabic=!1,E),UBAT_LRO:()=>(s.lastArabic=!1,E),UBAT_RLO:()=>(s.lastArabic=!1,E),UBAT_PDF:()=>(s.lastArabic=!1,E),UBAT_BN:()=>E}[Uct[n]]()}function eut(t){let e,i=0,r=XI.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<XI[e][0])r=e-1;else{if(!(t>XI[e][0]))return XI[e][1];i=e+1}return t}function tut(t){for(let e=0;e<Rae.length;e++)if(Rae[e]===t)return!0;return!1}function iut(t){for(let e=0;e<S5.length;e++)if(t===S5[e])return Mct[e];return t}function fG(t,e){for(let i=0;i<S5.length;i++)if(t===S5[i])return e[i];return t}function wR(t){return t>="ً"&&t<="ٕ"}function Dae(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function rut(t,e,i,r){for(;e*i<r&&wR(t[e]);)e+=i;return e*i<r&&(t[e]=" ",!0)}function sut(t,e){for(let i=0;i<kC.length;i++)if(t===kC[i])return e[i];return t}function nut(t,e,i){_u=[],gz=[];for(let r=0;r<i;r++)t[r]=r,e[r]=r,_u[r]=r}function out(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}function tEe(t,e,i,r){for(let s=0;s<t.length;s++)(t[s]>e||!i&&t[s]===e)&&(t[s]+=r)}let _u=[],E5=[],gz=[];const aut={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},lut=5,cut=6,aT=0,ZM=1,Nae=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,uut=/[\u0591-\u06ff\ufb1d-\ufefc]/,mG=new Vct;function hut(t){if(t==null)return["",!1];if(!mG.hasBidiChar(t))return[t,!1];let e;return e=mG.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[mG.bidiTransform(t,e,"VLYSN"),!0]}let TE=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,i){this.tx=e,this.ty=i}setTranslateZ(e){this.tz=e}setRotateCS(e,i){this.rz=void 0,this.rzCos=e,this.rzSin=i}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const SQ="arial-unicode-ms",Fae="woff2",kae=new Map,iEe=new Set;let dut=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function put(t){const e=yut(t),i=gut(t),r=kae.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${Gi.fontsUrl}/woff2/${i}.${Fae}') format('${Fae}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return kae.set(e,new dut(s,o)),iEe.add(s),o}function fut(t){return iEe.has(t)}function mut(t){if(!t)return SQ;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function gut(t){const e=rEe(t)+sEe(t);return mut(t.family)+(e.length>0?e:"-regular")}function yut(t){const e=rEe(t)+sEe(t);return(t.family||SQ)+(e.length>0?e:"-regular")}function rEe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function sEe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Rn=class{static fromOptimized(e,i,r=!1,s=!1,n=1){return new R7().initialize(e,i,r,s,n)}static fromJSON(e,i=!1,r=!1){const[s,n]=Uae(e);return new $7().initialize(s,n,i,r,1)}static fromOptimizedCIM(e,i,r=!1,s=!1,n=1){return new zae().initialize(e,i,r,s,n)}static fromJSONCIM(e,i=!1,r=!1,s=1){const[n,o]=Uae(e);return new Bae().initialize(n,o,i,r,s)}static fromFeatureSetReader(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimized(i,r):null}static fromFeatureSetReaderCIM(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimizedCIM(i,r):null}static createEmptyOptimized(e,i=!1,r=!1,s=1){return new R7().initialize(new Rc,e,i,r,s)}static createEmptyJSON(e,i=!1,r=!1){return new $7().initialize([],e,i,r,1)}static createEmptyOptimizedCIM(e,i=!1,r=!1,s=1){return new zae().initialize(new Rc,e,i,r,s)}static createEmptyJSONCIM(e,i=!1,r=!1,s=1){return new Bae().initialize([],e,i,r,s)}asJSON(){const e=qR(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,i,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,i=this.y;const s=e,n=i;for(;this.nextPoint();)r+=(e-this.x)*(i+this.y),e=this.x,i=this.y;return r+=(e-s)*(i+n),-.5*r}invertY(){this.yFactor*=-1}},R7=class nEe extends Rn{constructor(){super(...arguments),this._end=-1}initialize(e,i,r,s,n){return this.hasZ=r,this.hasM=s,this.geometryType=i,this._stride=2+Number(r)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const i=this._pathOffset+e*this._stride;return i>=0&&i<this._end&&(this._pointOffset=i,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,i=this._stride,r=this._geometry.coords;let s=0;for(let n=this._pathOffset+i;n<e;n+=i){const o=r[n-i],a=r[n-i+1],l=r[n]-o,c=r[n+1]-a;s+=Math.sqrt(l*l+c*c)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let i=0;i<this._stride;++i)this._geometry.coords.push(e[i]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,i){this._geometry.coords.push(e,i),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const i of e)for(let r=0;r<this._stride;++r)this._geometry.coords.push(i[r]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const i=e.asOptimized();this._geometry.coords.push(...i.coords),this._geometry.lengths.push(...i.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let i=1;i<e.coords.length;i+=this._stride)e.coords[i]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,i=this._pathOffset,r=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[i+s]!==e[r+s])return!1;return!0}clone(){return new nEe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,i)=>e+i)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function _ut(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function Uae(t){return fu(t)?[t.rings,"esriGeometryPolygon"]:Ud(t)?[t.paths,"esriGeometryPolyline"]:Qb(t)?[[t.points],"esriGeometryMultipoint"]:kd(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:J2(t)?[[[_ut(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let $7=class oEe extends Rn{initialize(e,i,r,s,n){return this._paths=e,this.geometryType=i,this.hasZ=r,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,i=this._currentPath;let r=0;for(let s=1;s<e;s++){const n=i[s-1],o=i[s],a=n[0],l=n[1],c=o[0]-a,u=o[1]-l;r+=Math.sqrt(c*c+u*u)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,i){this._paths[this.totalSize-1].push([e,i])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const i=qR(e);for(const r of i)this.pushPath(r)}asOptimized(){const e=new Rc;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const i of this._paths){for(const r of i)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(i.length)}return e}isClosed(){const e=this._currentPath[0],i=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}clone(){return new oEe().initialize(ge(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,i)=>e+i)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const ZI=4,JI=1;let zae=class aEe extends R7{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new aEe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},Bae=class lEe extends $7{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n)}clone(){return new lEe().initialize(ge(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][ZI]=JI}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][ZI]===JI}setControlPointAt(e){this._paths[this.pathIndex][e][ZI]=JI}getControlPointAt(e){return this._paths[this.pathIndex][e][ZI]===JI}};const vut=512;var Od,jo;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Od||(Od={}));let ma=class PN{constructor(e,i){this.x=e,this.y=i}clone(){return new PN(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new PN(e.x+i.x,e.y+i.y)}static sub(e,i){return new PN(e.x-i.x,e.y-i.y)}},QI=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},but=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=vut*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new ma(e,i),this._firstPt=new ma(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new ma(e,i),n=ma.distance(this._prevPt,s);let o,a,l,c,u,h,p,f;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,_=s;if(g.x<=this._xmin&&_.x<=this._xmin||g.x>=this._xmax&&_.x>=this._xmax||g.y<=this._ymin&&_.y<=this._ymin||g.y>=this._ymax&&_.y>=this._ymax)this._lineTo(_.x,_.y,!1);else{const v=[];if((g.x<this._xmin&&_.x>this._xmin||g.x>this._xmin&&_.x<this._xmin)&&(c=(this._xmin-g.x)/(_.x-g.x),f=g.y+c*(_.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new QI(c,this._xmin,f))),(g.x<this._xmax&&_.x>this._xmax||g.x>this._xmax&&_.x<this._xmax)&&(c=(this._xmax-g.x)/(_.x-g.x),f=g.y+c*(_.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new QI(c,this._xmax,f))),(g.y<this._ymin&&_.y>this._ymin||g.y>this._ymin&&_.y<this._ymin)&&(c=(this._ymin-g.y)/(_.y-g.y),p=g.x+c*(_.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new QI(c,p,this._ymin))),(g.y<this._ymax&&_.y>this._ymax||g.y>this._ymax&&_.y<this._ymax)&&(c=(this._ymax-g.y)/(_.y-g.y),p=g.x+c*(_.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new QI(c,p,this._ymax))),v.length===0)u?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+n*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+n*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(_.x,_.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Od.Polygon&&e&&wut.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Od.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new ma(r,s)}_pushLine(){this._line&&(this._type===Od.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Od.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Od.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Od.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ma(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ma(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==Od.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new ma(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new ma(e,i)),this._isH=o,this._isV=a)}else this._line.push(new ma(e,i))}},Qkt=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new ma(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new ma(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(jo||(jo={}));let wut=class qy{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],u=r.length;for(let p=0;p<u;++p){const f=r[p];if(!f||f.length<2)continue;let g,_=f[0];const v=f.length;for(let b=1;b<v;++b)g=f[b],_.x===g.x&&(_.x<=s&&(_.y>g.y?(l.push(p),l.push(b),l.push(jo.sideLeft),l.push(-1)):(c.push(p),c.push(b),c.push(jo.sideLeft),c.push(-1))),_.x>=n&&(_.y<g.y?(l.push(p),l.push(b),l.push(jo.sideRight),l.push(-1)):(c.push(p),c.push(b),c.push(jo.sideRight),c.push(-1)))),_.y===g.y&&(_.y<=o&&(_.x<g.x?(l.push(p),l.push(b),l.push(jo.sideTop),l.push(-1)):(c.push(p),c.push(b),c.push(jo.sideTop),c.push(-1))),_.y>=a&&(_.x>g.x?(l.push(p),l.push(b),l.push(jo.sideBottom),l.push(-1)):(c.push(p),c.push(b),c.push(jo.sideBottom),c.push(-1)))),_=g}if(l.length===0||c.length===0)return;qy.fillParent(r,c,l),qy.fillParent(r,l,c);const h=[];qy.calcDeltas(h,c,l),qy.calcDeltas(h,l,c),qy.addDeltas(h,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],u=e[a][l-1],h=e[a][l];let p=8092,f=-1;for(let g=0;g<s;g+=4){if(r[g+2]!==c)continue;const _=r[g],v=r[g+1],b=e[_][v-1],w=e[_][v];switch(c){case jo.sideLeft:case jo.sideRight:if(KI(u.y,b.y,w.y)&&KI(h.y,b.y,w.y)){const T=Math.abs(w.y-b.y);T<p&&(p=T,f=g)}break;case jo.sideTop:case jo.sideBottom:if(KI(u.x,b.x,w.x)&&KI(h.x,b.x,w.x)){const T=Math.abs(w.x-b.x);T<p&&(p=T,f=g)}}}i[o+3]=f}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=qy.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),qy.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case jo.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case jo.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case jo.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case jo.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const KI=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,xut=512;let Xm,Tut=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function yz(t,e){Xm||(Xm=new but(0,0,0,1));const i=t.geometryType==="esriGeometryPolygon",r=i?Od.Polygon:Od.LineString,s=i?3:2;let n,o;for(Xm.reset(r),Xm.setPixelMargin(e+1),Xm.setExtent(xut);t.nextPath();)if(!(t.pathSize<s)){for(t.nextPoint(),n=t.x,o=-t.y,Xm.moveTo(n,o);t.nextPoint();)n=t.x,o=-t.y,Xm.lineTo(n,o);i&&Xm.close()}const a=Xm.result(!1);if(a){const l=Rn.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let Sut=class{applyColorSubstituition(e,i){if(!i)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s).data;if(i){for(const c of i)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,h,p,f]=c.oldColor,[g,_,v,b]=c.newColor;if(u===g&&h===_&&p===v&&f===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&h===a[w+1]&&p===a[w+2]&&f===a[w+3]&&(a[w]=g,a[w+1]=_,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,r,s);return o.putImageData(l,0,0),n}tintImageData(e,i){if(!i||i.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s),l=new Uint8Array(a.data),c=[i[0]/255,i[1]/255,i[2]/255,i[3]/255];for(let h=0;h<l.length;h+=4)l[h]*=c[0],l[h+1]*=c[1],l[h+2]*=c[2],l[h+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),r,s);return o.putImageData(u,0,0),n}},cEe=class JM{static local(){return JM.instance===null&&(JM.instance=new JM),JM.instance}execute(e,i,r,s,n){return new Cut(e,i,r)}};cEe.instance=null;let Cut=class{constructor(e,i,r){this._inputGeometries=e,this._angleTolerance=i.angleTolerance!==void 0?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const i=e.x,r=e.y;let s=i,n=r,o=e.pathSize,a=0,l=0,c=0,u=0,h=0,p=0;this._isClosed&&++o;for(let f=1;e.nextPoint()||f<o;++f){let g,_;this._isClosed&&f===o-1?(g=i,_=r):(g=e.x,_=e.y);const v=g-s,b=_-n,w=Math.sqrt(v*v+b*b);f>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(f-1),f===1&&(u=v,h=b,p=w),w>0&&(s=g,n=_,a=v,l=b,c=w)}this._isClosed&&c>0&&p>0&&(a*u+l*h)/p/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function gG(t,e){t[4]=e}let V$=class{constructor(e,i=!0,r=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!i&&e.geometryType==="esriGeometryPolygon"||!r&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=s,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new TE}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const i=this.processPath(e);if(i)return i}return this.iterateMultiPath=!1,null}},_z=class{constructor(e,i,r,s=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=i,this.acceptPolyline=r,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=yz(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}};var I7,L7,Vae,Gae,Hf,jae,D7,N7,F7,Hae,qae,Wae,Yae,Xae,Zae,k7,U7,Jae,Qae,N2,Li,Mb,Kae,ele,Hg,tle,ile,ZS,z7,rle,sle,nle,ole,ale,lle,Ah,da,cle,ule,qf,hle,dle,ple,fle,Sd,fO,Pb,JS,mle,gle,yle,_le,vle,ble,wle,A5,QS,xle,B7,Tle,Sle;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(I7||(I7={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(L7||(L7={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Vae||(Vae={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Gae||(Gae={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Hf||(Hf={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(jae||(jae={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(D7||(D7={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(N7||(N7={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(F7||(F7={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Hae||(Hae={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(qae||(qae={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Wae||(Wae={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Yae||(Yae={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Xae||(Xae={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Zae||(Zae={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(k7||(k7={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(U7||(U7={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Jae||(Jae={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Qae||(Qae={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(N2||(N2={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(Li||(Li={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Mb||(Mb={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Kae||(Kae={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(ele||(ele={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Hg||(Hg={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(tle||(tle={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(ile||(ile={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(ZS||(ZS={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(z7||(z7={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(rle||(rle={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(sle||(sle={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(nle||(nle={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(ole||(ole={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(ale||(ale={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(lle||(lle={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Ah||(Ah={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(da||(da={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(cle||(cle={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(ule||(ule={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(qf||(qf={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(hle||(hle={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(dle||(dle={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(ple||(ple={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(fle||(fle={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Sd||(Sd={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(fO||(fO={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Pb||(Pb={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(JS||(JS={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(mle||(mle={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(gle||(gle={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(yle||(yle={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(_le||(_le={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(vle||(vle={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(ble||(ble={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(wle||(wle={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(A5||(A5={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(QS||(QS={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(xle||(xle={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(B7||(B7={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Tle||(Tle={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Sle||(Sle={}));const xR=.03;let N0=class{constructor(e=0,i=!1){}isEmpty(e){if(!e.nextPoint())return!0;let i,r,s,n;for(i=e.x,r=e.y;e.nextPoint();i=r,r=n)if(s=e.x,n=e.y,s!==i||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);i!==0&&(e[0]/=i,e[1]/=i)}getLength(e,i,r,s){const n=r-e,o=s-i;return Math.sqrt(n*n+o*o)}getSegLength(e){const[[i,r],[s,n]]=e;return this.getLength(i,r,s,n)}getCoord2D(e,i,r,s,n){return[e+(r-e)*n,i+(s-i)*n]}getSegCoord2D(e,i){const[[r,s],[n,o]]=e;return this.getCoord2D(r,s,n,o,i)}getAngle(e,i,r,s,n){const o=r-e,a=s-i;return Math.atan2(a,o)}getAngleCS(e,i,r,s,n){const o=r-e,a=s-i,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,i){const[[r,s],[n,o]]=e;return this.getAngleCS(r,s,n,o,i)}cut(e,i,r,s,n,o){return[n<=0?[e,i]:this.getCoord2D(e,i,r,s,n),o>=1?[r,s]:this.getCoord2D(e,i,r,s,o)]}getSubCurve(e,i,r){const s=Rn.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,e,i,r)?s:null}appendSubCurve(e,i,r,s){e.startPath(),i.seekPathStart();let n=0,o=!0;if(!i.nextPoint())return!1;let a=i.x,l=i.y;for(;i.nextPoint();){const c=this.getLength(a,l,i.x,i.y);if(c!==0){if(o){if(n+c>r){const u=(r-n)/c;let h=1,p=!1;n+c>=s&&(h=(s-n)/c,p=!0);const f=this.cut(a,l,i.x,i.y,u,h);if(f&&e.pushPoints(f),p)break;o=!1}}else{if(n+c>s){const u=this.cut(a,l,i.x,i.y,0,(s-n)/c);u&&e.pushPoint(u[1]);break}e.pushXY(i.x,i.y)}n+=c,a=i.x,l=i.y}else a=i.x,l=i.y}return!0}getCIMPointAlong(e,i){if(!e.nextPoint())return null;let r,s,n,o,a=0;for(r=e.x,s=e.y;e.nextPoint();r=n,s=o){n=e.x,o=e.y;const l=this.getLength(r,s,n,o);if(l!==0){if(a+l>i){const c=(i-a)/l;return this.getCoord2D(r,s,n,o,c)}a+=l}}return null}offset(e,i,r,s,n){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const p=e[o];p[0]===a[0]&&p[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let p=0;p<l;p++){const f=p===l-1?c?e[0]:null:e[p+1];if(a)if(f){const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g);const _=[h[0]-a[0],h[1]-a[1]];this.normalize(_);const v=_[0]*g[1]-_[1]*g[0],b=_[0]*g[0]+_[1]*g[1];if(v===0&&b===1){h=f;continue}if(v>=0==i<=0){if(b<1){const w=[g[0]-_[0],g[1]-_[1]];this.normalize(w);const T=Math.sqrt((1+b)/2);if(T>1/s){const S=-Math.abs(i)/T;u.push([h[0]-w[0]*S,h[1]-w[1]*S])}}}else switch(r){case Hg.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<s){const T=[g[0]-_[0],g[1]-_[1]];this.normalize(T);const S=Math.abs(i)/w;u.push([h[0]-T[0]*S,h[1]-T[1]*S]);break}}case Hg.Bevelled:u.push([h[0]+_[1]*i,h[1]-_[0]*i]),u.push([h[0]+g[1]*i,h[1]-g[0]*i]);break;case Hg.Rounded:if(b<1){u.push([h[0]+_[1]*i,h[1]-_[0]*i]);const w=Math.floor(2.5*(1-b));if(w>0){const T=1/w;let S=T;for(let A=1;A<w;A++,S+=T){const P=[_[1]*(1-S)+g[1]*S,-_[0]*(1-S)-g[0]*S];this.normalize(P),u.push([h[0]+P[0]*i,h[1]+P[1]*i])}}u.push([h[0]+g[1]*i,h[1]-g[0]*i])}break;case Hg.Square:default:if(v<0)u.push([h[0]+(_[1]+_[0])*i,h[1]+(_[1]-_[0])*i]),u.push([h[0]+(g[1]-g[0])*i,h[1]-(g[0]+g[1])*i]);else{const w=Math.sqrt((1+Math.abs(b))/2),T=[g[0]-_[0],g[1]-_[1]];this.normalize(T);const S=i/w;u.push([h[0]-T[0]*S,h[1]-T[1]*S])}}}else{const g=[h[0]-a[0],h[1]-a[1]];this.normalize(g),u.push([h[0]+g[1]*i,h[1]-g[0]*i])}else{const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g),u.push([h[0]+g[1]*i,h[1]-g[0]*i])}a=h,h=f}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const yG=1.7320508075688772,Eut=5,Aut=N2.OpenEnded;let uEe=class QM{static local(){return QM.instance===null&&(QM.instance=new QM),QM.instance}execute(e,i,r,s,n){return new Mut(e,i,r)}};uEe.instance=null;let Mut=class extends _z{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new N0,this._width=(i.width!==void 0?i.width:Eut)*r,this._arrowType=i.geometricEffectArrowType!==void 0?i.geometricEffectArrowType:i.arrowType!==void 0?i.arrowType:Aut,this._offsetFlattenError=xR*r}processPath(e){const i=Rn.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case N2.OpenEnded:default:this._constructSimpleArrow(i,e,!0);break;case N2.Block:this._constructSimpleArrow(i,e,!1);break;case N2.Crossed:this._constructCrossedArrow(i,e)}return i}_constructSimpleArrow(e,i,r){const s=i.pathLength();let n=this._width;s<2*n&&(n=s/2);const o=this._curveHelper.getSubCurve(i,0,s-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=M_(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const p=this._constructArrowBasePoint(u,a/2);if(!p)return;i.seekInPath(i.pathSize-1);const f=[i.x,i.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,i){const r=i.pathLength();let s=this._width;r<s*(1+yG+1)&&(s=r/(1+yG+1)),i.seekPathStart();const n=this._curveHelper.getSubCurve(i,0,r-s*(1+yG));if(!n)return;n.nextPath();const o=s/2;if(this._curveHelper.isEmpty(n))return;const a=M_(n),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(i,0,r-s);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const h=M_(u),p=this._constructOffset(h,o);if(!p)return;const f=this._constructOffset(h,-o);if(!f)return;const g=p[p.length-1],_=this._constructArrowBasePoint(p,o/2);if(!_)return;const v=f[f.length-1],b=this._constructArrowBasePoint(f,-o/2);if(!b)return;i.seekInPath(i.pathSize-1);const w=[i.x,i.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,i){return this._curveHelper.offset(e,i,Hg.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,i){if(!e||e.length<2)return null;const r=e[e.length-2],s=e[e.length-1],n=[s[0]-r[0],s[1]-r[1]];return this._curveHelper.normalize(n),[s[0]+n[1]*i,s[1]-n[0]*i]}},hEe=class KM{static local(){return KM.instance===null&&(KM.instance=new KM),KM.instance}execute(e,i,r,s,n,o){return new Put(e,i,r,s,n,o)}};hEe.instance=null;let Put=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new N0,this._size=(i.size!==void 0?i.size:1)*r,this._maxInflateSize=o*r,this._offsetFlattenError=xR*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const n=Rn.createEmptyOptimizedCIM(e.geometryType),o=qR(e)[0],a=this._curveHelper.offset(o,this._size,Hg.Rounded,4,this._offsetFlattenError);if(a)return n.pushPath(a),n}else if(this._size<0){const n=e.asJSON();if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return Rn.fromJSONCIM({xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size})}}const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?yz(e,this._maxInflateSize):e;if(!r)continue;const s=i.buffer(We.WebMercator,r.asJSON(),this._size,1);return s?Rn.fromJSONCIM(s):null}return null}},dEe=class eP{static local(){return eP.instance===null&&(eP.instance=new eP),eP.instance}execute(e,i,r,s,n){return new Out(e,i,r)}};dEe.instance=null;let Out=class{constructor(e,i,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=i.rule??Li.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const i=this._processGeom(qR(e));if(i?.length)return Rn.fromJSONCIM({paths:i})}return null}_clone(e){return[e[0],e[1]]}_mid(e,i){return[(e[0]+i[0])/2,(e[1]+i[1])/2]}_mix(e,i,r,s){return[e[0]*i+r[0]*s,e[1]*i+r[1]*s]}_add(e,i){return[e[0]+i[0],e[1]+i[1]]}_add2(e,i,r){return[e[0]+i,e[1]+r]}_sub(e,i){return[e[0]-i[0],e[1]-i[1]]}_dist(e,i){return Math.sqrt((e[0]-i[0])*(e[0]-i[0])+(e[1]-i[1])*(e[1]-i[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,i=1){const r=i/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const i=-e[1],r=e[0];e[0]=i,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const i=e[1],r=-e[0];e[0]=i,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,i){return e[0]*i[0]+e[1]*i[1]}_crossProduct(e,i){return e[0]*i[1]-e[1]*i[0]}_rotateDirect(e,i,r){const s=e[0]*i-e[1]*r,n=e[0]*r+e[1]*i;e[0]=s,e[1]=n}_makeCtrlPt(e){const i=[e[0],e[1]];return gG(i,1),i}_addAngledTicks(e,i,r,s){const n=this._sub(r,i);this._normalize(n);const o=this._crossProduct(n,this._sub(s,i));let a;a=o>0?this._rightPerp(n):this._leftPerp(n);const l=Math.abs(o)/2,c=[];c.push([i[0]+(a[0]-n[0])*l,i[1]+(a[1]-n[1])*l]),c.push(i),c.push(r),c.push([r[0]+(a[0]+n[0])*l,r[1]+(a[1]+n[1])*l]),e.push(c)}_addBezier2(e,i,r,s,n){if(n--==0)return void e.push(s);const o=this._mid(i,r),a=this._mid(r,s),l=this._mid(o,a);this._addBezier2(e,i,o,l,n),this._addBezier2(e,l,a,s,n)}_addBezier3(e,i,r,s,n,o){if(o--==0)return void e.push(n);const a=this._mid(i,r),l=this._mid(r,s),c=this._mid(s,n),u=this._mid(a,l),h=this._mid(l,c),p=this._mid(u,h);this._addBezier3(e,i,a,u,p,o),this._addBezier3(e,p,h,c,n,o)}_add90DegArc(e,i,r,s,n){const o=n??this._crossProduct(this._sub(r,i),this._sub(s,i))>0,a=this._mid(i,r),l=this._sub(a,i);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,i,this._mix(i,.33333,a,.66667),this._mix(r,.33333,a,.66667),r,4)}_addArrow(e,i,r){const s=i[0],n=i[1],o=i[i.length-1],a=this._sub(s,n),l=this._norm(a);this._normalize(a);const c=Math.abs(this._crossProduct(a,this._sub(o,n)));let u=this._dotProduct(a,this._sub(o,n));u<.05*l?u=.05*l:u>.95*l&&(u=.95*l);const h=.5*c,p=this._leftPerp(a),f=[n[0]+a[0]*u,n[1]+a[1]*u],g=i.length-1,_=[];_.push(r?[-p[0],-p[1]]:p);let v=[-a[0],-a[1]];for(let b=1;b<g-1;b++){const w=this._sub(i[b+1],i[b]);this._normalize(w);const T=this._dotProduct(w,v),S=this._crossProduct(w,v),A=Math.sqrt((1+T)/2),P=this._sub(w,v);this._normalize(P),P[0]/=A,P[1]/=A,_.push(S<0?[-P[0],-P[1]]:P),v=w}_.push(this._rightPerp(v));for(let b=_.length-1;b>0;b--)e.push([i[b][0]+_[b][0]*h,i[b][1]+_[b][1]*h]);e.push([f[0]+_[0][0]*h,f[1]+_[0][1]*h]),e.push([f[0]+_[0][0]*c,f[1]+_[0][1]*c]),e.push(s),e.push([f[0]-_[0][0]*c,f[1]-_[0][1]*c]),e.push([f[0]-_[0][0]*h,f[1]-_[0][1]*h]);for(let b=1;b<_.length;b++)e.push([i[b][0]-_[b][0]*h,i[b][1]-_[b][1]*h])}_cp2(e,i,r){return e.length>=2?e[1]:this._add2(e[0],i*this._defaultSize,r*this._defaultSize)}_cp3(e,i,r,s){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,i,r),o=this._sub(i,e[0]);return this._normalize(o),this._rightPerpendicular(o),[n[0]+o[0]*s*this._defaultSize,n[1]+o[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const i=e[0],r=this._cp2(e,-4,0),s=this._sub(i,r);this._normalize(s);const n=this._rightPerp(s);return[i,r,[i[0]+(n[0]-s[0])*this._defaultSize,i[1]+(n[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const i=e[0],r=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const n=this._sub(i,r);this._normalize(n);const o=this._rightPerp(n);s=[i[0]+(o[0]-n[0])*this._defaultSize,i[1]+(o[1]-n[1])*this._defaultSize]}return[r,s]}_processGeom(e){if(!e)return null;const i=[];for(const r of e){if(!r||r.length===0)continue;const s=r.length;let n=r[0];switch(this._rule){case Li.PerpendicularFromFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=[];l.push(a),l.push(this._mid(n,o)),i.push(l);break}case Li.ReversedFirstSegment:{const o=this._cp2(r,0,-1);i.push([o,n]);break}case Li.PerpendicularToSecondSegment:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(n),i.push(l);break}case Li.SecondSegmentWithTicks:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(n,o))>0?this._rightPerp(l):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),i.push(u);break}case Li.DoublePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push(n),h.push([a[0]+c[0]*u,a[1]+c[1]*u]),i.push(h);const p=[];p.push([a[0]-c[0]*u,a[1]-c[1]*u]),p.push(o),i.push(p);break}case Li.OppositeToFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u,a[1]+c[1]*u]),h.push([a[0]-c[0]*u,a[1]-c[1]*u]),i.push(h);break}case Li.TriplePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),h.push([l[0]+.8*(n[0]-l[0]),l[1]+.8*(n[1]-l[1])]),i.push(h),i.push([a,l]);const p=[];p.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),p.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),i.push(p);break}case Li.HalfCircleFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o);let c=this._sub(o,n);const u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),p=Math.sqrt((1+u)/2),f=Math.sqrt((1-u)/2),g=[];let _;this._crossProduct(c,this._sub(a,n))>0?(g.push(n),c=this._sub(n,l),_=o):(g.push(o),c=this._sub(o,l),_=n),this._rotateDirect(c,p,f),c[0]/=p,c[1]/=p;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,h);g.push(_),i.push(g);break}case Li.HalfCircleSecondSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,1,-1);let l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const h=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);c>0&&(p=-p);const f=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,h,p),f.push(this._add(u,l));i.push(f);break}case Li.HalfCircleExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-1);let l;if(s>=4)l=r[3];else{const g=this._sub(n,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,n);this._normalize(u,c);const h=this._sub(a,l);this._normalize(h,c);const p=[l,a];i.push(p);const f=[this._clone(a)];this._addBezier3(f,a,this._add(a,h),this._add(o,u),o,4),f.push(n),i.push(f);break}case Li.OpenCircle:{const o=this._cp2(r,-2,0),a=this._sub(o,n),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let h=1;h<=33;h++)this._rotateDirect(a,l,c),u.push(this._add(n,a));i.push(u);break}case Li.CoverageEdgesWithTicks:{const o=this._cp2(r,0,-1);let a,l;if(s>=3)a=r[2];else{const p=this._sub(o,n),f=this._leftPerp(p);a=[n[0]+f[0]-.25*p[0],n[1]+f[1]-.25*p[1]]}if(s>=4)l=r[3];else{const p=this._mid(n,o),f=this._sub(n,o);this._normalize(f),this._leftPerpendicular(f);const g=this._crossProduct(f,this._sub(a,p));this._rightPerpendicular(f),l=[a[0]+f[0]*g*2,a[1]+f[1]*g*2]}const c=this._sub(o,n);let u,h;u=this._crossProduct(c,this._sub(a,n))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push(a),h.push(n),h.push([n[0]+(u[0]-c[0])/3,n[1]+(u[1]-c[1])/3]),i.push(h),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),h.push(o),h.push(l),i.push(h);break}case Li.GapExtentWithDoubleTicks:{const o=this._cp2(r,0,2),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const c=this._sub(o,n);l=this._add(a,c)}this._addAngledTicks(i,n,o,this._mid(a,l)),this._addAngledTicks(i,a,l,this._mid(n,o));break}case Li.GapExtentMidline:{const o=this._cp2(r,2,0),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const u=this._sub(o,n);l=this._add(a,u)}const c=[];c.push(this._mid(n,a)),c.push(this._mid(o,l)),i.push(c);break}case Li.Chevron:{const o=this._cp2(r,-1,-1);let a;if(s>=3)a=r[2];else{const l=this._sub(o,n);this._leftPerpendicular(l),a=this._add(n,l)}i.push([o,this._makeCtrlPt(n),a]);break}case Li.PerpendicularWithArc:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,.5,-1),l=this._sub(o,n),c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,n));let h=this._dotProduct(l,this._sub(a,n));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[n[0]+l[0]*h,n[1]+l[1]*h];let f=this._leftPerp(l),g=[];if(g.push([p[0]-f[0]*u,p[1]-f[1]*u]),g.push([p[0]+f[0]*u,p[1]+f[1]*u]),i.push(g),s>=4){const w=r[3];let T=this._dotProduct(l,this._sub(w,n));T<.1*c?T=.1*c:T>.9*c&&(T=.9*c);const S=[n[0]+l[0]*T,n[1]+l[1]*T],A=this._crossProduct(l,this._sub(w,n)),P=[];P.push([S[0]-f[0]*A,S[1]-f[1]*A]),P.push([S[0]+f[0]*A,S[1]+f[1]*A]),i.push(P)}const _=[o[0]+f[0]*u,o[1]+f[1]*u];f=this._sub(o,_);const v=Math.cos(Math.PI/18);let b=Math.sin(Math.PI/18);u<0&&(b=-b),g=[n,o];for(let w=1;w<=9;w++)this._rotateDirect(f,v,b),g.push(this._add(_,f));i.push(g);break}case Li.ClosedHalfCircle:{const o=this._cp2(r,2,0),a=this._mid(n,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),h=[n,o];for(let p=1;p<=18;p++)this._rotateDirect(l,c,u),h.push(this._add(a,l));i.push(h);break}case Li.TripleParallelExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-2),l=this._mid(n,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,h=this._dist(o,a),p=[o,n];p.push([n[0]+c[0]*h*.5,n[1]+c[1]*h*.5]),i.push(p);const f=[];f.push([l[0]-c[0]*u,l[1]-c[1]*u]),f.push([l[0]+c[0]*h*.375,l[1]+c[1]*h*.375]),gG(f[f.length-1],1),f.push([l[0]+c[0]*h*.75,l[1]+c[1]*h*.75]),i.push(f);const g=[o,a];i.push(g);break}case Li.ParallelWithTicks:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l),this._addAngledTicks(i,n,o,a),this._addAngledTicks(i,this._mix(n,1,l,c),this._mix(o,1,l,c),this._mid(n,o));break}case Li.Parallel:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,n));let h=[n,o];i.push(h),h=[],h.push([n[0]+c[0]*u,n[1]+c[1]*u]),h.push([o[0]+c[0]*u,o[1]+c[1]*u]),i.push(h);break}case Li.PerpendicularToFirstSegment:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._mid(n,o),c=this._sub(o,n);this._normalize(c);const u=this._crossProduct(c,this._sub(a,n));this._leftPerpendicular(c);const h=[];h.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),h.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),i.push(h);break}case Li.ParallelOffset:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);const h=[];h.push([n[0]+l[0]*c,n[1]+l[1]*c]),h.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(h);break}case Li.OffsetOpposite:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);break}case Li.OffsetSame:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]+l[0]*c,n[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(u);break}case Li.CircleWithArc:{let o=this._cp2(r,3,0);const a=this._cp3(r,o,.5,-1);let l,c;if(s>=4)l=r[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,n),this._sub(a,n))>0;const g=24*this._geomUnitsPerPoint,_=this._sub(l,n);this._normalize(_,g);const v=Math.sqrt(2)/2;this._rotateDirect(_,v,c?v:-v),o=this._add(n,_)}const u=this._sub(o,n),h=Math.cos(Math.PI/18),p=Math.sin(Math.PI/18),f=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,h,p),f.push(this._add(n,u));this._add90DegArc(f,o,l,a,c),gG(f[f.length-8],1),i.push(f);break}case Li.DoubleJog:{let o,a=this._cp2(r,-3,1),l=this._cp3(r,a,-1,-.5);if(s>=4)o=r[3];else{const b=n;n=a,o=l;const w=this._dist(n,b),T=this._dist(o,b);let S=30*this._geomUnitsPerPoint;.5*w<S&&(S=.5*w),.5*T<S&&(S=.5*T),a=this._mix(n,S/w,b,(w-S)/w),l=this._mix(o,S/T,b,(T-S)/T)}const c=this._mid(n,a),u=this._mid(o,l),h=this._dist(n,a),p=this._dist(l,o);let f=Math.min(h,p)/8;f=Math.min(f,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let _=this._sub(n,a);this._normalize(_,f),this._crossProduct(_,this._sub(o,a))>0?this._rotateDirect(_,g,-g):this._rotateDirect(_,g,g);let v=[];v.push(a),v.push(this._add(c,_)),v.push(this._sub(c,_)),v.push(n),i.push(v),_=this._sub(o,l),this._normalize(_,f),this._crossProduct(_,this._sub(n,l))<0?this._rotateDirect(_,g,g):this._rotateDirect(_,g,-g),v=[],v.push(l),v.push(this._add(u,_)),v.push(this._sub(u,_)),v.push(o),i.push(v);break}case Li.PerpendicularOffset:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);i.push([u,n]);break}case Li.LineExcludingLastSegment:{const o=this._arrowPath(r),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);i.push(a);break}case Li.MultivertexArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!1),i.push(a);break}case Li.CrossedArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!0),i.push(a);break}case Li.ChevronArrow:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);const h=this._crossProduct(c,this._sub(a,o));let p=this._dotProduct(c,this._sub(a,o));p<.05*u?p=.05*u:p>.95*u-l&&(p=.95*u-l);const f=[o[0]+c[0]*p,o[1]+c[1]*p],g=this._leftPerp(c),_=[];_.push([f[0]+g[0]*h+c[0]*l,f[1]+g[1]*h+c[1]*l]),_.push(n),_.push([f[0]-g[0]*h+c[0]*l,f[1]-g[1]*h+c[1]*l]),i.push(_);break}case Li.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);const u=this._crossProduct(l,this._sub(a,o));let h=this._dotProduct(l,this._sub(a,o));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[o[0]+l[0]*h,o[1]+l[1]*h];this._leftPerpendicular(l);const f=[];f.push([p[0]+l[0]*u*.5,p[1]+l[1]*u*.5]),f.push(this._mid(p,n)),f.push([p[0]-l[0]*u*.5,p[1]-l[1]*u*.5]),i.push(f);break}case Li.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);let u=this._dotProduct(l,this._sub(a,o));u<.05*c?u=.05*c:u>.95*c&&(u=.95*c);const h=[o[0]+l[0]*u,o[1]+l[1]*u];i.push([o,h]);break}case Li.Arch:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=this._sub(n,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),h=[n];this._addBezier2(h,n,c,a,4),this._addBezier2(h,a,u,o,4),i.push(h);break}case Li.CurvedParallelTicks:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),h=this._sub(this._mix(o,.75,a,.25),c),p=this._sub(this._mix(o,.25,a,.75),c),f=[o];this._addBezier2(f,o,h,u,3),this._addBezier2(f,u,p,a,3),i.push(f);for(let g=0;g<8;g++){const _=f[2*g+1],v=[this._clone(_)];v.push(this._add(_,[l[0]/4,l[1]/4])),i.push(v)}break}case Li.Arc90Degrees:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=[o];this._add90DegArc(l,o,n,a),i.push(l);break}case Li.TipWithPerpendicularAndTicks:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);let h=this._crossProduct(c,this._sub(a,o)),p=this._dotProduct(c,this._sub(a,o));p<.05*u?p=.05*u:p>.95*u-l&&(p=.95*u-l);const f=this._leftPerp(c),g=[n[0]-c[0]*l,n[1]-c[1]*l],_=.5*Math.max(u-p-l,l);h=Math.abs(h);const v=[];v.push([g[0]+f[0]*(h+_)-c[0]*_,g[1]+f[1]*(h+_)-c[1]*_]),v.push([g[0]+f[0]*h,g[1]+f[1]*h]),v.push([g[0]-f[0]*h,g[1]-f[1]*h]),v.push([g[0]-f[0]*(h+_)-c[0]*_,g[1]-f[1]*(h+_)-c[1]*_]),i.push(v),i.push([g,n]);break}case Li.FullGeometry:default:i.push(r)}}return i}},pEe=class tP{static local(){return tP.instance===null&&(tP.instance=new tP),tP.instance}execute(e,i,r,s,n){return new Rut(e,i,r)}};pEe.instance=null;let Rut=class extends _z{constructor(e,i,r){super(e,!0,!0),this._curveHelper=new N0,this._beginCut=(i.beginCut!==void 0?i.beginCut:1)*r,this._endCut=(i.endCut!==void 0?i.endCut:1)*r,this._middleCut=(i.middleCut!==void 0?i.middleCut:0)*r,this._invert=i.invert!==void 0&&i.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:i,_endCut:r,_middleCut:s}=this,n=e.pathLength(),o=Rn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(i!==0||r!==0||s!==0)if(i+r+s>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,i),this._curveHelper.appendSubCurve(o,e,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,e,n-r,r)}else if(i===0&&r===0&&s===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else i+r+s<n&&(s===0?this._curveHelper.appendSubCurve(o,e,i,n-r):(this._curveHelper.appendSubCurve(o,e,i,.5*(n-s)),this._curveHelper.appendSubCurve(o,e,.5*(n+s),n-r)));return o.totalSize===0?null:o}};const Cle=1e-7;let vz=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,i,r=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let s=0;s<e.length;s++){let n=Math.abs(e[s]);r&&n<Cle&&(n=Cle),this._values.push(n),this._length+=n}return i&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const i=this._values?this._values.length:0;for(let r=0;r<i;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},Og=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var p_;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(p_||(p_={}));let eL=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},bz=class extends N0{constructor(e=0,i=!1){super(e,i),this._tolerance=xR,this._currentPosition=new eL}updateTolerance(e){this._tolerance=xR*e}init(e,i,r=!0){return r?(this._patternLength=i.length(),this._partExtPtGap=i.extPtGap,this._partCtrlPtGap=i.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,i=p_.FAIL){const r=new eL;return!!this._nextPosition(e,r,null,i)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[i,r]=this._getAngleCS(this._currentPosition);e.ca=i,e.sa=r}nextPointAndAngle(e,i,r=p_.FAIL){const s=new eL;if(!this._nextPosition(e,s,null,r))return!1;s.copyTo(this._currentPosition),i.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return i.ca=n,i.sa=o,!0}nextCurve(e){if(e===0)return null;const i=Rn.createEmptyOptimizedCIM("esriGeometryPolyline");i.startPath(),i.nextPath();const r=new eL;return this._nextPosition(e,r,i,p_.END)?(r.copyTo(this._currentPosition),i):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,i,r,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(i);i.abscissa+e*this._partLengthRatio>i.segmentLength+this._tolerance;){if(r){if(r.pathSize===0)if(n===0){const a=i.segment[0];r.pushXY(a[0],a[1])}else r.pushPoint(this.getSegCoord2D(i.segment,n));const o=i.segment[1];r.pushXY(o[0],o[1])}if(n=0,e-=(i.segmentLength-i.abscissa)/this._partLengthRatio,this._partSegCount)i.segment=this._nextSegment(),i.segmentLength=this.getSegLength(i.segment),i.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==p_.FAIL&&(i.segmentLength=this.getSegLength(i.segment),i.isPartEnd=!0,s===p_.END?(i.abscissa=i.segmentLength,i.isPathEnd=!0):i.abscissa=i.segmentLength+e,!0);this._currentPosition.copyTo(i)}}if(i.abscissa+=e*this._partLengthRatio,r){r.pathSize===0&&(n===0?r.pushPoint(i.segment[0]):r.pushPoint(this.getSegCoord2D(i.segment,n)));const o=i.abscissa/i.segmentLength;o===1?r.pushPoint(i.segment[1]):r.pushPoint(this.getSegCoord2D(i.segment,o))}return this._partSegCount||Math.abs(i.abscissa-i.segmentLength)<this._tolerance&&(i.isPathEnd=this._partIsLast,i.isPartEnd=!0),!0}_getPoint(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,i)}_getAngleCS(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,i)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const i=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(i);let r=i+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const s=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(s+n))/this._patternLength);o<=0&&(o=s+n>0?0:1),this._partLengthRatio=this._partLength/(s+n+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const F2={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function $ut(t){return typeof t=="function"}function Iut(t,e,i,r){return $ut(t)?t(e,i,r):t}const Lut=` /-,
`;function Ele(t){let e=t.length;for(;e--;)if(!Lut.includes(t.charAt(e)))return!1;return!0}function Dut(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.substr(r,s-r);i.push([n,null,Ele(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.substr(r,s-r)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length-1){const n=t.substr(r);i.push([n,null,Ele(n)])}return i}function Nut(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let u=l;i!=null&&(u=Xut(l,i));const h=t.attributes[u];h&&(n&&(s+=n,n=null),s+=h)}}return Fut(s,r)}function Fut(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function kut(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function Uut(t){return t.data?.symbol??null}function zut(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function But(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function fEe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const xi=(t,e=0)=>t==null||isNaN(t)?e:t,Vut=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function Gut(){return ue(()=>import("./geometryEngineJSON-c9131672.js"),["./geometryEngineJSON-c9131672.js","./geometryEngineBase-1fd17bb5.js","./geometryEngineJSON-d5c44941.js","./json-48e3ea08.js"],import.meta.url)}function jut(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function Hut(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function mEe(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function gEe(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function mO(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=mO(e);if(i!=null)return i}break;case"CIMTextSymbol":return mO(t.symbol);case"CIMSolidFill":return t.color}return null}function V7(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=V7(i);if(r!=null)return r}break}case"CIMTextSymbol":return V7(t.symbol);case"CIMSolidStroke":return t.color}}function G7(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=G7(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return G7(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function qut(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function Wut(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Yut(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const lT=t=>t.includes("data:image/svg+xml");function fUt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function CQ(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function mUt(t,e,i,r,s,n){const{infos:o}=n;let a=1,l=0,c=0,u=0;for(const{offsetX:f,offsetY:g,rotation:_,size:v,frameHeight:b,rotateClockWise:w}of o)c=Ole(f,g,l,a,c),u=Ple(f,g,l,a,u),b&&(a*=v/b),l=Rle(_,w,l);const h=Ole(r,s,l,a,c),p=Ple(r,s,l,a,u);return{size:t*a,rotation:Rle(e,i,l),offsetX:h,offsetY:p}}function yEe(t){return t?.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function Ale(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return Ale(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return Ale(i.symbol)}}return"Normal"}function Xut(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function Zut(t){return t.map(e=>({...e,propertyName:CQ(e.propertyName)}))}function Mle(t){const e={};for(const i in t){const r=t[i];e[CQ(i)]=r}return e}function Ple(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function Ole(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function Rle(t,e,i){return e?i-t:i+t}const Jut=1e3,$le=1e-7;let _Ee=class iP{static local(){return iP.instance===null&&(iP.instance=new iP),iP.instance}execute(e,i,r,s,n){return new Qut(e,i,r,s)}};_Ee.instance=null;let Qut=class extends _z{constructor(e,i,r,s){super(e,!0,!0),this._firstCurve=null,this._walker=new bz,this._walker.updateTolerance(r),this._endings=i.lineDashEnding,this._customDashPos=-(i.offsetAlongLine??0)*r,this._offsetAtEnd=(i.customEndingOffset??0)*r,this._tileKey=s;let n=yEe(i).dashTemplate;n==null&&(n=[]),n.length%2&&(n=[...n,...n]);let o=0;for(let a=0;a<n.length;a++){let l=Math.abs(n[a]);l<$le&&(l=$le),o+=l}this._patternLength=o,this._numOfDashesPerPattern=n.length/2,this._pattern=new vz,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const s=M_(e);return Rn.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case da.HalfPattern:case da.HalfGap:default:this._pattern.extPtGap=0;break;case da.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case da.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case da.NoConstraint:this.isClosed||(s=!1);break;case da.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const o=M_(e);return Rn.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,s)){const o=M_(e);return Rn.fromJSONCIM({paths:[o]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let s;switch(this._endings){case da.HalfPattern:default:s=.5*this._pattern.firstValue();break;case da.HalfGap:s=.5*-this._pattern.lastValue();break;case da.FullGap:s=-this._pattern.lastValue();break;case da.FullPattern:s=0;break;case da.NoConstraint:case da.Custom:s=-this._customDashPos}let n=s/this._pattern.length();n-=Math.floor(n),s=n*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let o=!1;for(;s>=i;)s-=i,i=this._pattern.nextValue(),o=!o;i-=s,o?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let r=this._walker.nextCurve(i);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r?.reset(),r}isClippingRequired(e){const i=qR(e);let r=0;for(const s of i)r+=vY(s);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>Jut}},vEe=class rP{static local(){return rP.instance===null&&(rP.instance=new rP),rP.instance}execute(e,i,r,s,n,o){return new Kut(e,i,r,s,n,o)}};vEe.instance=null;let Kut=class{constructor(e,i,r,s,n,o){switch(this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(i.width!==void 0?i.width:2)*r,i.method){case Mb.Mitered:case Mb.Bevelled:case Mb.Rounded:case Mb.TrueBuffer:case Mb.Square:}this._option=i.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const i=e.asJSON();return Math.min(i.xmax-i.xmin,i.ymax-i.ymin)-2*this._width<0?e:Rn.fromJSONCIM({paths:[[[i.xmin+this._width,i.ymin+this._width],[i.xmax-this._width,i.ymin+this._width],[i.xmax-this._width,i.ymax-this._width],[i.xmin+this._width,i.ymax-this._width],[i.xmin+this._width,i.ymin+this._width]],[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?yz(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.buffer(We.WebMercator,r.asJSON(),-this._width,1);if(s){for(const n of s.rings)if(n){r.startPath();for(const o of n.reverse())r.pushXY(o[0],r.yFactor*o[1])}}return r}}return null}},bEe=class sP{static local(){return sP.instance===null&&(sP.instance=new sP),sP.instance}execute(e,i,r,s,n){return new eht(e,i,r)}};bEe.instance=null;let eht=class extends _z{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new N0,this._length=(i.length!==void 0?i.length:20)*r,this._angle=i.angle!==void 0?i.angle:225,this._position=i.position!==void 0?i.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const i=Rn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,s=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-r,o-s];this._curveHelper.normalize(a);const l=r+(n-r)*this._position/100,c=s+(o-s)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const p=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return i.pushPath([[r,s],p,f,[n,o]]),i}},wEe=class nP{static local(){return nP.instance===null&&(nP.instance=new nP),nP.instance}execute(e,i,r,s,n){return new tht(e,i,r)}};wEe.instance=null;let tht=class{constructor(e,i,r){this._inputGeometries=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+i,e.y=e.y+r;return e.reset(),e}};const iht=10;let xEe=class oP{static local(){return oP.instance===null&&(oP.instance=new oP),oP.instance}execute(e,i,r,s,n,o){return new rht(e,i,r,s,n,o)}};xEe.instance=null;let rht=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new N0,this._offset=(i.offset??1)*r,this._method=i.method,this._maxInflateSize=Math.max(Math.abs(o*r),iht),this._option=i.option,this._offsetFlattenError=xR*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===Hg.Rounded&&this._offset>0){const o=M_(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=Rn.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const n=e.asJSON();if(kd(n)&&Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._offset>0)return Rn.fromJSONCIM({xmin:n.xmin-this._offset,xmax:n.xmax+this._offset,ymin:n.ymin-this._offset,ymax:n.ymax+this._offset})}const i=this._geometryEngine;if(i==null)continue;const r=this._tileKey?yz(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.offset(We.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return s?Rn.fromJSONCIM(s):null}return null}},TEe=class aP{static local(){return aP.instance===null&&(aP.instance=new aP),aP.instance}execute(e,i,r,s,n){return new sht(e,i,r)}};TEe.instance=null;let sht=class{constructor(e,i,r){this._inputGeometries=e,this._reverse=i.reverse===void 0||i.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return nht(e.clone());e=this._inputGeometries.next()}return null}};function nht(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,r=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=i,t.y=r,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}let SEe=class lP{static local(){return lP.instance===null&&(lP.instance=new lP),lP.instance}execute(e,i,r,s,n){return new oht(e,i,r)}};SEe.instance=null;let oht=class{constructor(e,i,r){this._inputGeometries=e,this._rotateAngle=i.angle!==void 0?i.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=wk(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._rotate(e.clone(),r,s)}e=this._inputGeometries.next()}return null}_rotate(e,i,r){const s=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-i,a=e.y-r;e.x=i+o*s-a*n,e.y=r+o*n+a*s}return e.reset(),e}},CEe=class cP{static local(){return cP.instance===null&&(cP.instance=new cP),cP.instance}execute(e,i,r,s,n){return new aht(e,i,r)}};CEe.instance=null;let aht=class{constructor(e,i,r){this._inputGeometries=e,this._xFactor=i.xScaleFactor!==void 0?i.xScaleFactor:1.15,this._yFactor=i.yScaleFactor!==void 0?i.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=wk(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,s)}}return null}_scaleCursor(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=i+(e.x-i)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}},EEe=class uP{static local(){return uP.instance===null&&(uP.instance=new uP),uP.instance}execute(e,i,r,s,n){return new lht(e,i,r)}};EEe.instance=null;let lht=class{constructor(e,i,r){this._inputGeometries=e,this._height=(i.amplitude!==void 0?i.amplitude:2)*r,this._period=(i.period!==void 0?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new vz,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new bz,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const i=this._processGeom(e);if(i)return i;e=this._inputGeometries.next()}return null}_processGeom(e){const i=Rn.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){i.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case ZS.Sinus:default:this._constructCurve(i,r,!1);break;case ZS.Square:this._constructSquare(i,r);break;case ZS.Triangle:this._constructTriangle(i,r);break;case ZS.Random:this._constructCurve(i,r,!0)}else for(;e.nextPoint();)i.pushXY(e.x,e.y)}return i}_constructCurve(e,i,r){let s=Math.round(i/this._period);s===0&&(s=1);const n=s*16+1,o=i/s,a=this._period/16,l=1/n,c=2*Math.PI*i/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),f=.75-Math.random()/2,g=.75-Math.random()/2,_=new Og;this._walker.curPointAndAngle(_),e.pushPoint(_.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,_)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,r){const T=this._height/2*(1+.3*Math.sin(f*c*b+u));w=T*Math.sin(c*b+h),w+=T*Math.sin(g*c*b+p),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(_.pt[0]-w*_.sa,_.pt[1]+w*_.ca)}}}_constructSquare(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new Og;this._walker.curPointAndAngle(n);const o=new Og;if(this._walker.nextPointAndAngle(this._period,o)){const a=new Og;this._walker.nextPointAndAngle(this._period,a)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new Og;this._walker.curPointAndAngle(n);const o=new Og;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new Og;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}},AEe=class hP{static local(){return hP.instance===null&&(hP.instance=new hP),hP.instance}execute(e,i,r,s,n){return new cht(e,i,r)}};AEe.instance=null;let cht=class extends V${constructor(e,i,r){super(e),this._geometryWalker=new bz,this._geometryWalker.updateTolerance(r),this._angleToLine=i.angleToLine??!0,this._offset=(i.offset?i.offset:0)*r,this._originalEndings=i.endings,this._offsetAtEnd=(i.customEndingOffset?i.customEndingOffset:0)*r,this._position=-(i.offsetAlongLine?i.offsetAlongLine:0)*r,this._pattern=new vz,this._pattern.init(i.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath)i=this._pattern.nextValue();else{this._originalEndings===Sd.WithFullGap&&this.isClosed?this._endings=Sd.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case Sd.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case Sd.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case Sd.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case Sd.WithMarkers:s=0;break;case Sd.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let o=0;for(;s>o;)s-=o,o=this._pattern.nextValue();o-=s,i=o,this.iteratePath=!0}const r=new Og;return this._geometryWalker.nextPointAndAngle(i,r)?this._endings===Sd.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===Sd.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let i=e/this._pattern.length();return i-=Math.floor(i),i*this._pattern.length()}},MEe=class dP{static local(){return dP.instance===null&&(dP.instance=new dP),dP.instance}execute(e,i,r,s,n){return new uht(e,i,r)}};MEe.instance=null;let uht=class extends V${constructor(e,i,r){super(e,!1,!0),this._curveHelper=new N0,this._placePerPart=i.placePerPart??!1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._type=i.extremityPlacement,this._position=i.offsetAlongLine!==void 0?i.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let i;switch(this._type){case Hf.Both:default:this._beginProcessed?(i=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(i=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case Hf.JustBegin:i=this._atExtremities(e,this._position,!0);break;case Hf.JustEnd:i=this._atExtremities(e,this._position,!1);case Hf.None:}return i}_atExtremities(e,i,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let s=0,[n,o]=[0,0],[a,l]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(n,o,a,l);if(s+c>i){const u=(i-s)/c,[h,p]=this._curveHelper.getAngleCS(n,o,a,l,u),f=this._curveHelper.getCoord2D(n,o,a,l,u);return this.internalPlacement.setTranslate(f[0]-this._offset*p,f[1]+this._offset*h),this._angleToLine&&this.internalPlacement.setRotateCS(-h,-p),this.internalPlacement}s+=c}}return null}},PEe=class pP{static local(){return pP.instance===null&&(pP.instance=new pP),pP.instance}execute(e,i,r,s,n){return new hht(e,i,r)}};PEe.instance=null;let hht=class extends V${constructor(e,i,r){super(e),this._walker=new bz,this._walker.updateTolerance(r),this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._beginGap=i.beginPosition!==void 0?i.beginPosition*r:0,this._endGap=i.endPosition!==void 0?i.endPosition*r:0,this._flipFirst=i.flipFirst===void 0||i.flipFirst,this._pattern=new vz,this._pattern.init(i.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const r=new Og;if(!this._walker.nextPointAndAngle(i,r,p_.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const s=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=r.ca,o=r.sa):(n=1,o=0),s&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const my=512,dht=10,Up=24,M5=1e-6;let OEe=class fP{static local(){return fP.instance===null&&(fP.instance=new fP),fP.instance}execute(e,i,r,s,n){return new pht(e,i,r,s,n)}};OEe.instance=null;let pht=class ab{constructor(e,i,r,s,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*r,this._stepY=Math.abs(i.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=i.gridType??fO.Fixed,this._gridType===fO.Random){const o=i.seed??13,a=1;this._randomLCG=new Yb(o*a),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*r,this._offsetY=(i.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,s!=null){const[o,a,l,c]=s.split("/"),u=parseFloat(o),h=parseFloat(a),p=parseFloat(l),f=parseFloat(c);this._graphicOriginX=-(f*2**u+p)*my,this._graphicOriginY=h*my,this._testInsidePolygon=!0}this._internalPlacement=new TE,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!ab._randValues){ab._randValues=[];for(let e=0;e<Up;e++)for(let i=0;i<Up;i++)ab._randValues.push(this._randomLCG.getFloat()),ab._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let i,r,s,n,o,a,l,c,u,h,p,f,g,_;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=p=Number.MAX_VALUE,u=h=_=f=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,i=a-this._graphicOriginX-this._offsetX,r=o-this._graphicOriginY-this._offsetY,v?(s=this._cosAngle*i-this._sinAngle*r,n=this._sinAngle*i+this._cosAngle*r):(s=i,n=r),l=Math.min(l,s),u=Math.max(u,s),c=Math.min(c,n),h=Math.max(h,n),p=Math.min(p,o),f=Math.max(f,o),g=Math.min(g,a),_=Math.max(_,a);p=p!==Number.MAX_VALUE?p:-my-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,_=_!==-Number.MAX_VALUE?_:my+this._stepX;const b=f-p,w=_-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?p:g,this._testInsidePolygon){let T=0-this._graphicOriginX-this._offsetX-this._stepX,S=my-this._graphicOriginX-this._offsetX+this._stepX,A=-my-this._graphicOriginY-this._offsetY-this._stepY,P=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const R=[[T,A],[T,P],[S,A],[S,P]];T=A=Number.MAX_VALUE,S=P=-Number.MAX_VALUE;for(const F of R){const k=this._cosAngle*F[0]-this._sinAngle*F[1],N=this._sinAngle*F[0]+this._cosAngle*F[1];T=Math.min(T,k),S=Math.max(S,k),A=Math.min(A,N),P=Math.max(P,N)}}l=l!==Number.MAX_VALUE?Math.max(l,T):T,c=c!==Number.MAX_VALUE?Math.max(c,A):A,u=u!==-Number.MAX_VALUE?Math.min(u,S):S,h=h!==-Number.MAX_VALUE?Math.min(h,P):P}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,_,p,f)}_buildAccelerationMap(e,i,r,s,n){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?n-s:r-i;let c=Math.ceil(l/dht);if(c<=1)return;const u=Math.floor(l/c);let h,p,f,g,_,v,b,w,T,S,A;for(c++,this._delta=u,a?(T=-my-2*this._stepY,S=2*this._stepY,A=s):(T=-2*this._stepX,S=my+2*this._stepX,A=i);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(h=e.x,p=e.y;e.nextPoint();h=f,p=g){if(f=e.x,g=e.y,a){if(p===g||p<T&&g<T||p>S&&g>S)continue;_=Math.min(p,g),v=Math.max(p,g)}else{if(h===f||h<T&&f<T||h>S&&f>S)continue;_=Math.min(h,f),v=Math.max(h,f)}for(;_<v;)b=Math.floor((_-A)/u),Ile(b,h,p,f,g,o),_+=u;w=Math.floor((v-A)/u),w>b&&Ile(w,h,p,f,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const i=this._currentY*this._stepY+this._offsetY;let r,s;if(this._currentX++,this._gridType===fO.Random){const n=(this._currentX%Up+Up)%Up,o=(this._currentY%Up+Up)%Up;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-ab._randValues[o*Up+n])*2/3,s=this._graphicOriginY+i+this._stepY*this._randomness*(.5-ab._randValues[o*Up+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*i,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*i;if(!this._testInsidePolygon||this._isInsidePolygon(r,s,this._geometryCursor))return this._internalPlacement.setTranslate(r,s),this._internalPlacement}}_isInsidePolygon(e,i,r){if(this._accelerationMap==null)return fht(e,i,r);e+=M5,i+=M5;const s=this._verticalSubdivision,n=s?i:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const p of a){if(l=p[0],c=p[1],s){if(l[1]>i==c[1]>i)continue;u=(c[0]-l[0])*(i-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(i-l[1])}u>0?h++:h--}return h!==0}};function fht(t,e,i){let r,s,n,o,a=0;for(t+=M5,e+=M5,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,s=i.y;i.nextPoint();r=n,s=o)n=i.x,o=i.y,s>e!=o>e&&((n-r)*(e-s)-(o-s)*(t-r)>0?a++:a--);return a!==0}function Ile(t,e,i,r,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,i],[r,s]])}const mht=.001;let REe=class mP{static local(){return mP.instance===null&&(mP.instance=new mP),mP.instance}execute(e,i,r,s,n){return new ght(e,i,r)}};REe.instance=null;let ght=class extends V${constructor(e,i,r){super(e),this._curveHelper=new N0,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._relativeTo=i.relativeTo,this._position=i.startPointOffset!==void 0?i.startPointOffset*r:0,this._epsilon=mht*r}processPath(e){const i=this._position;if(this._relativeTo===Pb.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[s,n]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(s,n,o,a);if(l<this._epsilon){s=o,n=a;continue}const c=.5+this._position/l,[u,h]=this._curveHelper.getAngleCS(s,n,o,a,c),p=this._curveHelper.getCoord2D(s,n,o,a,c);return this.internalPlacement.setTranslate(p[0]-this._offset*h,p[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,h),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===Pb.LineEnd;return this.onLine(e,i,r)}onLine(e,i,r){let s,n=!1;switch(this._relativeTo){case Pb.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+i;break;case Pb.LineBeginning:s=i;break;case Pb.LineEnd:s=i,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;r?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const h=this._curveHelper.getLength(a,l,c,u);if(o+h>s){const p=(s-o)/h,[f,g]=this._curveHelper.getAngleCS(a,l,c,u,p),_=this._curveHelper.getCoord2D(a,l,c,u,p),v=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(_[0]-v*g,_[1]+v*f),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-f,-g):this.internalPlacement.setRotateCS(f,g)),this.internalPlacement}a=c,l=u,o+=h}}return null}};const yht=1e-15;let $Ee=class gP{static local(){return gP.instance===null&&(gP.instance=new gP),gP.instance}execute(e,i,r,s,n){return new _ht(e,i,r)}};$Ee.instance=null;let _ht=class extends V${constructor(e,i,r){super(e),this._curveHelper=new N0,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._endPoints=i.placeOnEndPoints===void 0||i.placeOnEndPoints,this._controlPoints=i.placeOnControlPoints===void 0||i.placeOnControlPoints,this._regularVertices=i.placeOnRegularVertices===void 0||i.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const i=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(i[2]);let r=i[0],s=i[1];if(this._offset!==0){const n=Math.cos(i[2]),o=Math.sin(i[2]);r-=this._offset*o,s+=this._offset*n}return this.internalPlacement.setTranslate(r,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const i=e.isClosed();let r=0,s=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const p=e.x,f=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(n=this._curveHelper.getAngle(a,l,p,f,0)),u?(u=!1,i?(r=n,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,tL(o,n)]):this._regularVertices&&this._tags.push([a,l,tL(o,n)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,p,f,1)),h=e.nextPoint(),h||(i?g||s?this._controlPoints&&this._tags.push([p,f,tL(o,r)]):this._regularVertices&&this._tags.push([p,f,tL(o,r)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([p,f,o])),a=p,l=f,c=g}}this._tagIterator=0}};function tL(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2*yht;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}const vht=100*222045e-21;function bht(t){if(t.totalSize===0)return null;const e=wk(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*vht;let r=0,s=0;t.reset();for(let k=0;t.nextPath();k++){const N=t.getCurrentRingArea();N>s&&(s=N,r=k)}if(t.seekPath(r),t.pathSize===0)return null;t.seekPathStart();const n=lme(t);if(Math.abs(s)<=2*i*i)return[(n[0]+n[2])/2,(n[1]+n[3])/2];t.seekPathStart();const o=ZLe(t,Vt());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,h=yA(o,t,!0);h.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],h=yA(o,t,!1)),l[0]=h.distance,c[0]=0;const p=[NaN,NaN];let f=!1,g=.25,_=-1,v=NaN;do if(v=NaN,a[1]=_G(t,vG(n[0],n[2],g),i,e),isNaN(a[1][0])||isNaN(a[1][1])||(h=yA(a[1],t,!1),v=h.distance),!isNaN(v)&&v>i&&ON(a[1],t))f=!0,l[1]=v,c[1]=lb(a[1],o);else if(!isNaN(v)&&v>_&&(_=v,p[0]=a[1][0],p[1]=a[1][1]),g-=.01,g<.1){if(!(_>=0))break;f=!0,l[1]=_,a[1][0]=p[0],a[1][1]=p[1],c[1]=lb(a[1],o)}while(!f);f=!1,g=.5,_=-1;let b=.01,w=1;do if(v=NaN,a[2]=_G(t,vG(n[0],n[2],g),i,e),isNaN(a[2][0])||isNaN(a[2][1])||(h=yA(a[2],t,!1),v=h.distance),!isNaN(v)&&v>i&&ON(a[2],t))f=!0,l[2]=v,c[2]=lb(a[2],o);else if(!isNaN(v)&&v>_)_=v,p[0]=a[2][0],p[1]=a[2][1];else if(v>_&&(_=v,p[0]=a[2][0],p[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(_>=0))break;f=!0,l[2]=_,a[2][0]=p[0],a[2][1]=p[1],c[2]=lb(a[2],o)}while(!f);f=!1,g=.75,_=-1;do if(v=NaN,a[3]=_G(t,vG(n[0],n[2],g),i,e),isNaN(a[3][0])||isNaN(a[3][1])||(h=yA(a[3],t,!1),v=h.distance),!isNaN(v)&&v>i&&ON(a[3],t))f=!0,l[3]=v,c[3]=lb(a[3],o);else if(v>_&&(_=v,p[0]=a[3][0],p[1]=a[3][1]),g+=.01,g>.9){if(!(_>=0))break;f=!0,l[3]=_,a[3][0]=p[0],a[3][1]=p[1],c[3]=lb(a[3],o)}while(!f);const T=[0,1,2,3],S=u?0:1;let A;for(let k=S;k<4;k++)for(let N=S;N<3;N++){const j=c[N],z=c[N+1];Tht(j,z)>0&&(A=T[N],T[N]=T[N+1],T[N+1]=A,c[N]=z,c[N+1]=j)}let P=S,R=0,F=0;for(let k=S;k<4;k++){switch(k){case 0:F=2*l[T[k]];break;case 1:F=1.66666666*l[T[k]];break;case 2:F=1.33333333*l[T[k]];break;case 3:F=l[T[k]]}F>R&&(R=F,P=T[k])}return a[P]}function ON(t,e){let i,r,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,r=e.y;e.nextPoint();i=s,r=n)s=e.x,n=e.y,r>t[1]!=n>t[1]&&((s-i)*(t[1]-r)-(n-r)*(t[0]-i)>0?o++:o--);return o!==0}function yA(t,e,i){if(i&&ON(t,e))return{coord:t,distance:0};let r=1/0,s=0,n=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],HLe(l,t,o,a);const c=lb(t,l);c<r&&(r=c,s=l[0],n=l[1])}return{coord:[s,n],distance:Math.sqrt(r)}}function _G(t,e,i,r){const s=[e,0];let n=1/0,o=1/0,a=!1,l=!1;const c=[[e,r[1]-1],[e,r[3]+1]],u=[0,0],h=[0,0],p=[0,0],f=[[0,0],[0,0]],g=Vt();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(f[0][0]=t.x,f[0][1]=t.y;t.nextPoint();f[0][0]=f[1][0],f[0][1]=f[1][1]){if(f[1][0]=t.x,f[1][1]=t.y,wht(g,f)===null||(h[0]=c[0][0],h[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],xht(g,h,p)===0)||!NF(c[0],c[1],f[0],f[1],u))continue;const _=u[1];n>o?_<n&&(n=_,a=!0):_<o&&(o=_,l=!0)}return a&&l?s[1]=(n+o)/2:s[0]=s[1]=NaN,s}function wht(t,e){if(e.length<2)return null;t||(t=Vt());const[i,r]=e[0],[s,n]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,n),t[2]=Math.max(i,s),t[3]=Math.max(r,n),t}const iL=1,rL=4,Lle=3,Dle=12;function xht(t,e,i){let r=zp(e,t),s=zp(i,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(r&s)return 0;if(!(r|s))return 4;const c=(r?1:0)|(s?2:0);do{const u=i[0]-e[0],h=i[1]-e[1];if(u>h)r&Lle?(r&iL?(e[1]+=h*(n-e[0])/u,e[0]=n):(e[1]+=h*(a-e[0])/u,e[0]=a),r=zp(e,t)):s&Lle?(s&iL?(i[1]+=h*(n-i[0])/u,i[0]=n):(i[1]+=h*(a-i[0])/u,i[0]=a),s=zp(i,t)):r?(r&rL?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),r=zp(e,t)):(s&rL?(i[0]+=u*(o-i[1])/h,i[1]=o):(i[0]+=u*(l-i[1])/h,i[1]=l),s=zp(i,t));else if(r&Dle?(r&rL?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),r=zp(e,t)):s&Dle?(s&rL?(i[0]+=u*(o-i[1])/h,i[1]=o):(i[0]+=u*(l-i[1])/h,i[1]=l),s=zp(i,t)):r?(r&iL?(e[1]+=h*(n-e[0])/u,e[0]=n):(e[1]+=h*(a-e[0])/u,e[0]=a),r=zp(e,t)):(s&iL?(i[1]+=h*(n-i[0])/u,i[0]=n):(i[1]+=h*(a-i[0])/u,i[0]=a),s=zp(i,t)),r&s)return 0}while(r|s);return c}function zp(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function vG(t,e,i){return t+(e-t)*i}function lb(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function Tht(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),r=isNaN(e);return i<r?-1:i>r?1:0}let IEe=class yP{static local(){return yP.instance===null&&(yP.instance=new yP),yP.instance}execute(e,i,r,s,n){return new Sht(e,i,r)}};IEe.instance=null;let Sht=class{constructor(e,i,r){this._geometryCursor=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0,this._method=i.method!==void 0?i.method:JS.OnPolygon,this._internalPlacement=new TE}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let i=!1;switch(this._method){case JS.CenterOfMass:{const r=tDe(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}break;case JS.BoundingBoxCenter:{const r=wk(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),i=!0)}break;case JS.OnPolygon:default:{const r=bht(e);r!==null&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}}return i?this._internalPlacement:null}};function Cht(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return cEe.local();case"CIMGeometricEffectArrow":return uEe.local();case"CIMGeometricEffectBuffer":return hEe.local();case"CIMGeometricEffectControlMeasureLine":return dEe.local();case"CIMGeometricEffectCut":return pEe.local();case"CIMGeometricEffectDashes":return _Ee.local();case"CIMGeometricEffectDonut":return vEe.local();case"CIMGeometricEffectJog":return bEe.local();case"CIMGeometricEffectMove":return wEe.local();case"CIMGeometricEffectOffset":return xEe.local();case"CIMGeometricEffectReverse":return TEe.local();case"CIMGeometricEffectRotate":return SEe.local();case"CIMGeometricEffectScale":return CEe.local();case"CIMGeometricEffectWave":return EEe.local()}return null}function Eht(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return AEe.local();case"CIMMarkerPlacementAtExtremities":return MEe.local();case"CIMMarkerPlacementAtRatioPositions":return PEe.local();case"CIMMarkerPlacementInsidePolygon":return OEe.local();case"CIMMarkerPlacementOnLine":return REe.local();case"CIMMarkerPlacementOnVertices":return $Ee.local();case"CIMMarkerPlacementPolygonCenter":return IEe.local()}return null}function bG(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");return e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0),i}let Aht=class LEe{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s}static fromExtent(e){return new LEe(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function Mht(t){return`rgb(${t.slice(0,3).toString()})`}function wG(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let DEe=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});sL(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:o}=i.font;this._lineThroughWidthOffset=n&&n==="line-through"?.1*this._lineHeight:0;const a=i.backgroundColor!=null||i.borderLine!=null,l=a?oke:0,c=this._computeTextWidth(s,i)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,r.width===0||r.height===0)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*i.pixelRatio),this._renderedHaloSize=dn(i.halo.size)*i.pixelRatio,this._renderedWidth=c*i.pixelRatio,this._renderedHeight=u*i.pixelRatio,this._lineThroughWidthOffset*=i.pixelRatio;const h=i.color??[0,0,0,0],p=i.halo&&i.halo.color?i.halo.color:[0,0,0,0];this._fillStyle=wG(h),this._haloStyle=Mht(p);const f=this._renderedLineHeight,g=this._renderedHaloSize;s.save(),s.clearRect(0,0,r.width,r.height),sL(s,i);const _=l*i.pixelRatio,v=Pht(s.textAlign,this._renderedWidth-2*_)+g+_,b=g+_,w=g>0;let T=this._lineThroughWidthOffset,S=0;if(a){s.save();const j=i.backgroundColor??[0,0,0,0],z=i.borderLine?.color??[0,0,0,0],X=2*dn(i.borderLine?.size??0);s.fillStyle=wG(j),s.strokeStyle=wG(z),s.lineWidth=X,s.fillRect(0,0,r.width,r.height),s.strokeRect(0,0,r.width,r.height),s.restore()}w&&this._renderHalo(s,v,b,T,S,i),S+=b,T+=v;for(const j of this._textLines)w?(s.globalCompositeOperation="destination-out",s.fillStyle="rgb(0, 0, 0)",s.fillText(j,T,S),s.globalCompositeOperation="source-over",s.fillStyle=this._fillStyle,s.fillText(j,T,S)):(s.fillStyle=this._fillStyle,s.fillText(j,T,S)),n&&n!=="none"&&this._renderDecoration(s,T,S,n,o),S+=f;s.restore();const A=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,R=s.getImageData(0,0,A,P),F=new Uint8Array(R.data);if(i.premultiplyColors){let j;for(let z=0;z<F.length;z+=4)j=F[z+3]/255,F[z]=F[z]*j,F[z+1]=F[z+1]*j,F[z+2]=F[z+2]*j}let k,N;switch(i.horizontalAlignment){case"left":k=-.5;break;case"right":k=.5;break;default:k=0}switch(i.verticalAlignment){case"bottom":N=-.5;break;case"top":N=.5;break;case"baseline":N=-1/6;break;default:N=0}return{size:[A,P],image:new Uint32Array(F.buffer),sdf:!1,simplePattern:!1,anchorX:k,anchorY:N,canvas:r}}_renderHalo(e,i,r,s,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),sL(u,o);const{decoration:h,weight:p}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,i,r,h,p),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,s,n,a,l),e.globalAlpha=1}_renderHaloNative(e,i,r,s,n){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,h=.1;for(let p=0;p<u;p++){const f=(1-(u-1)*h+p*h)*c;e.lineWidth=f,e.strokeText(l,i,r),s&&s!=="none"&&this._renderDecoration(e,i,r,s,n,f)}r+=o}}computeTextSize(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d");sL(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,i),o=this._lineHeight*this._textLines.length;return r.width=n,r.height=o,[n*i.pixelRatio,o*i.pixelRatio]}_computeTextWidth(e,i){let r=0;for(const n of this._textLines)r=Math.max(r,e.measureText(n).width);const s=i.font;return(s.style==="italic"||s.style==="oblique"||typeof s.weight=="string"&&(s.weight==="bold"||s.weight==="bolder")||typeof s.weight=="number"&&s.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*dn(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const i=this._parameters.font.decoration;return i&&i==="underline"&&(e*=1.3),Math.round(e+2*dn(this._parameters.halo.size))}_renderDecoration(e,i,r,s,n,o){const a=.9*this._lineHeight,l=n==="bold"?.06:n==="bolder"?.09:.04;switch(e.textAlign){case"center":i-=this._renderedWidth/2;break;case"right":i-=this._renderedWidth}const c=e.textBaseline;if(s==="underline")switch(c){case"top":r+=a;break;case"middle":r+=a/2}else if(s==="line-through")switch(c){case"top":r+=a/1.5;break;case"middle":r+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(i-this._lineThroughWidthOffset,r),e.lineTo(i+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}};function sL(t,e){const i=Math.max(e.size,.5),r=e.font,s=`${r.style} ${r.weight} ${dn(i*e.pixelRatio).toFixed(1)}px ${r.family}, sans-serif`;let n;switch(t.font=s,t.textBaseline="top",e.horizontalAlignment){case"left":default:n="left";break;case"right":n="right";break;case"center":n="center"}t.textAlign=n}function Pht(t,e){return t==="center"?.5*e:t==="right"?e:0}const $Ut=512,IUt=29,LUt=24;var Nle;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(Nle||(Nle={}));const DUt=1.05,NUt=5,FUt=6,kUt=1.15,UUt=2,zUt=10,Oht=1024,BUt=256,VUt=32,GUt=512;function Rht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function $ht(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Iht(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function Lht(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function Dht(t){return t[0]*t[3]-t[1]*t[2]}function NEe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],h=i[2],p=i[3],f=i[4],g=i[5];return t[0]=r*c+n*u,t[1]=s*c+o*u,t[2]=r*h+n*p,t[3]=s*h+o*p,t[4]=r*f+n*g+a,t[5]=s*f+o*g+l,t}function Nht(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*c,t[1]=s*u+o*c,t[2]=r*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function Fht(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function kht(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*u+a,t[5]=s*c+o*u+l,t}function Uht(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function zht(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Bht(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Vht(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Ght(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function jht(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function FEe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function Hht(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function qht(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function Wht(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Yht(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],f=e[5],g=go();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-u)<=g*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-h)<=g*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-p)<=g*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=g*Math.max(1,Math.abs(a),Math.abs(f))}const Xht=NEe,Zht=FEe;Object.freeze(Object.defineProperty({__proto__:null,add:jht,copy:Rht,determinant:Dht,equals:Yht,exactEquals:Wht,frob:Ght,fromRotation:Uht,fromScaling:zht,fromTranslation:Bht,identity:$ht,invert:Lht,mul:Xht,multiply:NEe,multiplyScalar:Hht,multiplyScalarAndAdd:qht,rotate:Nht,scale:Fht,set:Iht,str:Vht,sub:Zht,subtract:FEe,translate:kht},Symbol.toStringTag,{value:"Module"}));function Jht(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Qht(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Kht(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function edt(t,e){return new Float32Array(t,e,6)}function kEe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function tdt(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)kEe(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Qht,create:Jht,createView:edt,fromValues:Kht,transform:kEe,transformMany:tdt},Symbol.toStringTag,{value:"Module"}));const idt=()=>le.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Nf,Gd;function jUt(t){if(!t)return Nf.Center;switch(t){case"Left":case"left":return Nf.Left;case"Right":case"right":return Nf.Right;case"Justify":return idt().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Nf.Center;case"Center":case"center":return Nf.Center}}function HUt(t){if(!t)return Gd.Center;switch(t){case"Top":case"top":return Gd.Top;case"Center":case"middle":return Gd.Center;case"Baseline":case"baseline":return Gd.Baseline;case"Bottom":case"bottom":return Gd.Bottom}}function qUt(t){switch(t){case Nf.Right:case"right":return-1;case Nf.Center:case"center":return 0;case Nf.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function WUt(t){switch(t){case Gd.Top:case"top":return 1;case Gd.Center:case"middle":return 0;case Gd.Bottom:case Gd.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Nf||(Nf={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(Gd||(Gd={}));const Ob=Math.PI/180,UEe=.5,rdt=()=>le.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let cb=class _f{constructor(e){this._t=e}static createIdentity(){return new _f([1,0,0,0,1,0])}clone(){const e=this._t;return new _f(e.slice())}transform(e){const i=this._t;return[i[0]*e[0]+i[1]*e[1]+i[2],i[3]*e[0]+i[4]*e[1]+i[5]]}static createScale(e,i){return new _f([e,0,0,0,i,0])}scale(e,i){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=i,r[4]*=i,r[5]*=i,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,i){return new _f([0,0,e,0,0,i])}translate(e,i){const r=this._t;return r[2]+=e,r[5]+=i,this}static createRotate(e){const i=Math.cos(e),r=Math.sin(e);return new _f([i,-r,0,r,i,0])}rotate(e){return _f.multiply(this,_f.createRotate(e),this)}angle(){const e=this._t[0],i=this._t[3],r=Math.sqrt(e*e+i*i);return[e/r,i/r]}static multiply(e,i,r){const s=e._t,n=i._t,o=s[0]*n[0]+s[3]*n[1],a=s[1]*n[0]+s[4]*n[1],l=s[2]*n[0]+s[5]*n[1]+n[2],c=s[0]*n[3]+s[3]*n[4],u=s[1]*n[3]+s[4]*n[4],h=s[2]*n[3]+s[5]*n[4]+n[5],p=r._t;return p[0]=o,p[1]=a,p[2]=l,p[3]=c,p[4]=u,p[5]=h,r}invert(){const e=this._t;let i=e[0]*e[4]-e[1]*e[3];if(i===0)return new _f([0,0,0,0,0,0]);i=1/i;const r=(e[1]*e[5]-e[2]*e[4])*i,s=(e[2]*e[3]-e[0]*e[5])*i,n=e[4]*i,o=-e[1]*i,a=-e[3]*i,l=e[0]*i;return new _f([n,o,r,a,l,s])}},zEe=class{constructor(e,i){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new Ko(TE,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(i||cb.createIdentity()),this._sizeTransfos.push(i?i.scaleRatio():1)}setTransform(e,i){this._transfos=[e||cb.createIdentity()],this._sizeTransfos=[i||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,i){const r=i?e.scaleRatio():1;cb.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,i,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,i);break;case"CIMTextSymbol":this.drawTextSymbol(e,i,r)}}drawMultiLayerSymbol(e,i){if(!e||!i)return;const r=e.symbolLayers;if(!r)return;const s=e.effects;if(s&&s.length>0){const n=this.executeEffects(s,i);if(n){let o=n.next();for(;o;)this.drawSymbolLayers(r,o.asJSON()),o=n.next()}}else this.drawSymbolLayers(r,i)}executeEffects(e,i){const r=this._resourceManager.geometryEngine;let s=new Tut(Rn.fromJSONCIM(i));for(const n of e){const o=Cht(n);o&&(s=o.execute(s,n,this.geomUnitsPerPoint(),null,r))}return s}drawSymbolLayers(e,i){let r=e.length;for(;r--;){const s=e[r];if(!s||s.enable===!1)continue;const n=s.effects;if(n&&n.length>0){const o=this.executeEffects(n,i);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(s,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,i);if(this._earlyReturn)return}}drawSymbolLayer(e,i){switch(e.type){case"CIMSolidFill":this.drawSolidFill(i,e.color);break;case"CIMHatchFill":this.drawHatchFill(i,e);break;case"CIMPictureFill":this.drawPictureFill(i,e);break;case"CIMGradientFill":this.drawGradientFill(i,e);break;case"CIMSolidStroke":this.drawSolidStroke(i,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(i,e);break;case"CIMGradientStroke":this.drawGradientStroke(i,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,i)}}drawHatchFill(e,i){const r=odt(i,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(i.lineSymbol,r),this.popClipPath())}drawPictureFill(e,i){}drawGradientFill(e,i){}drawPictureStroke(e,i){}drawGradientStroke(e,i){}drawMarkerLayer(e,i){const r=e.markerPlacement;if(r){const s=Eht(r);if(s){const n=r.type==="CIMMarkerPlacementInsidePolygon"||r.type==="CIMMarkerPlacementPolygonCenter"&&r.clipAtBoundary;n&&this.pushClipPath(i);const o=s.execute(Rn.fromJSONCIM(i),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}n&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(J2(i))s.tx=i.x,s.ty=i.y,this.drawMarker(e,s);else if(fu(i)){const n=zfe(i);n&&([s.tx,s.ty]=n,this.drawMarker(e,s))}else for(const n of i.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,i){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,i);break;case"CIMVectorMarker":this.drawVectorMarker(e,i)}}drawPictureMarker(e,i){if(!e)return;const r=this._resourceManager.getResource(e.url),s=xi(e.size,F2.CIMPictureMarker.size);if(r==null||s<=0)return;const n=r.width,o=r.height;if(!n||!o)return;const a=n/o,l=xi(e.scaleX,1),c=cb.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=s*a*l,b*=s),c.translate(-v,-b)}let h=xi(e.rotation);e.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&c.rotate(h*Ob);let p=xi(e.offsetX),f=xi(e.offsetY);if(p||f){if(this._mapRotation){const v=Ob*this._mapRotation,b=Math.cos(v),w=Math.sin(v),T=p*w+f*b;p=p*b-f*w,f=T}c.translate(p,f)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const _=i.getAngle();_&&c.rotate(_),c.translate(i.tx,i.ty),this.push(c,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,i){if(!e)return;const r=e.markerGraphics;if(!r)return;const s=xi(e.size,F2.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=s&&o?s/o:1,l=cb.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let _=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?n&&(_*=n.xmax-n.xmin,v*=n.ymax-n.ymin):(_/=a,v/=a),l.translate(-_,-v)}a!==1&&l.scale(a,a);let u=xi(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*Ob);let h=xi(e.offsetX),p=xi(e.offsetY);if(h||p){if(this._mapRotation){const _=Ob*this._mapRotation,v=Math.cos(_),b=Math.sin(_),w=h*b+p*v;h=h*v-p*b,p=w}l.translate(h,p)}const f=this.geomUnitsPerPoint();f!==1&&l.scale(f,f);const g=i.getAngle();g&&l.rotate(g),l.translate(i.tx,i.ty),this.push(l,e.scaleSymbolsProportionally);for(const _ of r){_?.symbol&&_.geometry||rdt().error("Invalid marker graphic",_);let v=_.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(_.symbol,_.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,i,r){if(!e||!J2(i)||xi(e.height,F2.CIMTextSymbol.height)<=0)return;const s=cb.createIdentity();let n=xi(e.angle);n=-n,n&&s.rotate(n*Ob);const o=xi(e.offsetX),a=xi(e.offsetY);(o||a)&&s.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&s.scale(l,l),s.translate(i.x,i.y),this.push(s,!1),this.drawText(e,r),this.pop()}},sdt=class extends zEe{constructor(e,i){super(e,i),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new Aht(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return yk(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(fu(e))this._processPath(e.rings,0);else if(Ud(e))this._processPath(e.paths,0);else if(kd(e)){const i=Rb(e);i&&this._processPath(i.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,i,r){if(!e||this._clipCount>0||r==null||r<=0)return;const s=Math.max(.5*this.transformSize(xi(r,F2.CIMSolidStroke.width)),.5*UEe);if(fu(e))this._processPath(e.rings,s);else if(Ud(e))this._processPath(e.paths,s);else if(kd(e)){const n=Rb(e);n&&this._processPath(n.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,i){fu(i)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(i.rings,0):super.drawMarkerLayer(e,i)}drawHatchFill(e,i){this.drawSolidFill(e)}drawPictureFill(e,i){this.drawSolidFill(e)}drawGradientFill(e,i){this.drawSolidFill(e)}drawPictureStroke(e,i){this.drawSolidStroke(e,null,i.width)}drawGradientStroke(e,i){this.drawSolidStroke(e,null,i.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,i){const{url:r}=e,s=xi(e.scaleX,1);let n=s*i,o=i;const a=this._resourceManager.getResource(r);if(a!=null){const l=a.height/a.width;n=s*(i?l>1?i:i/l:a.width),o=i?l>1?i*l:i:a.height}this._merge(this.transformPt([-n/2,-o/2]),0),this._merge(this.transformPt([-n/2,o/2]),0),this._merge(this.transformPt([n/2,-o/2]),0),this._merge(this.transformPt([n/2,o/2]),0)}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new DEe);const r=BEe(e);let[s,n]=this._textRasterizer.computeTextSize(i,r);s=No(s),n=No(n);let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-s/2+o,-n/2+a]),0),this._merge(this.transformPt([-s/2+o,n/2+a]),0),this._merge(this.transformPt([s/2+o,-n/2+a]),0),this._merge(this.transformPt([s/2+o,n/2+a]),0)}_processPath(e,i){if(e)for(const r of e){const s=r?r.length:0;if(s>1){this._merge(this.transformPt(r[0]),i);for(let n=1;n<s;n++)this._merge(this.transformPt(r[n]),i)}}}_merge(e,i){e[0]-i<this._xmin&&(this._xmin=e[0]-i),e[0]+i>this._xmax&&(this._xmax=e[0]+i),e[1]-i<this._ymin&&(this._ymin=e[1]-i),e[1]+i>this._ymax&&(this._ymax=e[1]+i)}},ndt=class extends zEe{constructor(e,i,r,s){super(i,r),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new Sut,this._ctx=e}drawSolidFill(e,i){if(!e)return;if(fu(e))this._buildPath(e.rings,!0);else if(Ud(e))this._buildPath(e.paths,!0);else if(kd(e))this._buildPath(Rb(e).rings,!0);else{if(!Qb(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,i,r,s,n,o){if(!e||!i||r===0)return;if(fu(e))this._buildPath(e.rings,!0);else if(Ud(e))this._buildPath(e.paths,!1);else{if(!kd(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(Rb(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(r),UEe),this._setCapStyle(s),this._setJoinStyle(n),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),fu(e))this._buildPath(e.rings,!0);else if(Ud(e))this._buildPath(e.paths,!0);else{if(!kd(e))return;this._buildPath(Rb(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,i){const{colorSubstitutions:r,url:s,tintColor:n}=e,o=xi(e.scaleX,1),a=this._resourceManager.getResource(s);if(a==null)return;let l=i*(a.width/a.height),c=i;i||(l=a.width,c=a.height);const u=lT(s)||"src"in a&&lT(a.src);let h="getFrame"in a?bG(a):a;r&&(h=this._colorSubstitutionHelper.applyColorSubstituition(h,r)),this._applyAdditionalRenderProps&&!u&&n&&(h=this._colorSubstitutionHelper.tintImageData(h,n));const p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),_=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*_*f,m12:o*_*g,m21:-_*g,m22:_*f,m41:p[0],m42:p[1]}),v.drawImage(h,-l/2,-c/2,l,c),v.restore()}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new DEe);const r=BEe(e);r.size*=this.transformSize(No(1));const s=this._textRasterizer.rasterizeText(i,r);if(!s)return;const{size:n,anchorX:o,anchorY:a,canvas:l}=s,c=n[0]*(o+.5),u=n[1]*(a-.5),h=this._ctx,p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),_=1;h.save(),h.setTransform({m11:_*f,m12:_*g,m21:-_*g,m22:_*f,m41:p[0]-_*c,m42:p[1]+_*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,i){if(!e)return;let{colorSubstitutions:r,height:s,offsetX:n,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=i;const h=this._resourceManager.getResource(u);if(h==null)return;if(fu(e))this._buildPath(e.rings,!0);else if(Ud(e))this._buildPath(e.paths,!0);else if(kd(e))this._buildPath(Rb(e).rings,!0);else{if(!Qb(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const p=this._ctx,f=lT(u)||"src"in h&&lT(h.src);let g,_="getFrame"in h?bG(h):h;if(r&&(_=this._colorSubstitutionHelper.applyColorSubstituition(_,r)),this._applyAdditionalRenderProps){f||c&&(_=this._colorSubstitutionHelper.tintImageData(_,c)),g=p.createPattern(_,"repeat");const v=this.transformSize(1);a||(a=0),n?n*=v:n=0,o?o*=v:o=0,s&&(s*=v);const b=s?s/h.height:1,w=l&&s?l*s/h.width:1;if(a!==0||b!==1||w!==1||n!==0||o!==0){const T=new DOMMatrix;T.rotateSelf(0,0,-a).translateSelf(n,o).scaleSelf(w,b,1),g.setTransform(T)}}else g=p.createPattern(_,"repeat");p.save(),p.fillStyle=g,p.fill("evenodd"),p.restore()}drawPictureStroke(e,i){if(!e)return;let{colorSubstitutions:r,capStyle:s,joinStyle:n,miterLimit:o,tintColor:a,url:l,width:c}=i;const u=this._resourceManager.getResource(l);if(u==null)return;let h;if(fu(e))h=e.rings;else if(Ud(e))h=e.paths;else{if(!kd(e))return Qb(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;h=Rb(e).rings}c||(c=u.width);const p=lT(l)||"src"in u&&lT(u.src);let f="getFrame"in u?bG(u):u;r&&(f=this._colorSubstitutionHelper.applyColorSubstituition(f,r)),this._applyAdditionalRenderProps&&(p||a&&(f=this._colorSubstitutionHelper.tintImageData(f,a)));const g=Math.max(this.transformSize(dn(c)),.5),_=g/f.width,v=this._ctx,b=v.createPattern(f,"repeat-y");let w,T;v.save(),this._setCapStyle(s),this._setJoinStyle(n),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let S of h)if(S=ge(S),cdt(S),S&&!(S.length<=1)){w=this.transformPt(S[0]);for(let A=1;A<S.length;A++){T=this.transformPt(S[A]);const P=adt(w,T),R=new DOMMatrix;R.translateSelf(0,w[1]-g/2).scaleSelf(_,_,1).rotateSelf(0,0,90-P),b.setTransform(R),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(T[0],T[1]),v.stroke(),w=T}}v.restore()}_buildPath(e,i){const r=this._ctx;if(r.beginPath(),e)for(const s of e){const n=s?s.length:0;if(n>1){let o=this.transformPt(s[0]);r.moveTo(o[0],o[1]);for(let a=1;a<n;a++)o=this.transformPt(s[a]),r.lineTo(o[0],o[1]);i&&r.closePath()}}}_setCapStyle(e){switch(e){case Ah.Butt:this._ctx.lineCap="butt";break;case Ah.Round:this._ctx.lineCap="round";break;case Ah.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case qf.Bevel:this._ctx.lineJoin="bevel";break;case qf.Round:this._ctx.lineJoin="round";break;case qf.Miter:this._ctx.lineJoin="miter"}}};function odt(t,e,i){let r=xi(t.separation,F2.CIMHatchFill.separation)*i,s=xi(t.rotation);if(r===0)return null;r<0&&(r=-r);let n=0;const o=.5*r;for(;n>o;)n-=r;for(;n<-o;)n+=r;const a=Vt();RDe(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const c=Math.cos(s*Ob),u=Math.sin(s*Ob),h=-r*u,p=r*c;let f,g,_,v;n=xi(t.offsetX)*i*u-xi(t.offsetY)*i*c,f=_=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const R of l){const F=R[0],k=R[1],N=c*F+u*k,j=-u*F+c*k;f=Math.min(f,N),_=Math.min(_,j),g=Math.max(g,N),v=Math.max(v,j)}_=Math.floor(_/r)*r;let b=c*f-u*_-h*n/r,w=u*f+c*_-p*n/r,T=c*g-u*_-h*n/r,S=u*g+c*_-p*n/r;const A=1+Math.round((v-_)/r),P=[];for(let R=0;R<A;R++)b+=h,w+=p,T+=h,S+=p,P.push([[b,w],[T,S]]);return{paths:P}}function adt(t,e){const i=e[0]-t[0],r=e[1]-t[1];return 180/Math.PI*Math.atan2(r,i)}const Rb=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function BEe(t,e=1){const i=gEe(t),r=mEe(t.fontStyleName),s=t.fontFamilyName??SQ,{weight:n,style:o}=r,a=e*(t.height||5),l=qut(t.horizontalAlignment),c=Wut(t.verticalAlignment),u=mO(t),h=mO(t.haloSymbol),p=h!=null?e*(t.haloSize??0):0,f=t.callout?.type==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=mO(f),_=G7(f),v=V7(f);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:s,style:jut(o),weight:Hut(n),decoration:i},halo:{size:p||0,color:h,style:o},backgroundColor:g,borderLine:_!=null&&v!=null?{size:_,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const ldt=1e-4;function cdt(t){let e,i,r,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],s=e!==0?i/e:Math.PI/2,r!==void 0&&s-r<=ldt?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),r=s}const EQ=[252,146,31,255],udt=[153,153,153,255],hdt={type:"esriSMS",style:"esriSMSCircle",size:6,color:EQ,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},ddt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:EQ},pdt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},fdt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},mdt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},gdt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},ydt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},VEe=cx.fromJSON(hdt),AQ=xm.fromJSON(ddt),GEe=nE.fromJSON(pdt),JUt=oE.fromJSON(fdt);function QUt(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return VEe;case"polyline":return AQ;case"polygon":case"extent":return GEe}return null}cx.fromJSON(mdt);xm.fromJSON(gdt);nE.fromJSON(ydt);const KUt=Number.POSITIVE_INFINITY,MQ=Math.PI,ezt=2*MQ,_dt=128/MQ,vdt=256/360,tzt=MQ/180,bdt=1/Math.LN2;function jEe(t,e){return(t%=e)>=0?t:t+e}function izt(t){return jEe(t*_dt,256)}function rzt(t){return jEe(t*vdt,256)}function szt(t){return Math.log(t)*bdt}function nzt(t,e,i){return t*(1-i)+e*i}const wdt=8,xdt=14,Tdt=16;function ozt(t){return wdt+Math.max((t-xdt)*Tdt,0)}function azt(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function lzt(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const u=c.length;if(!(u<2)){s=c[0].x,n=c[0].y;for(let h=1;h<u;++h){if(o=c[h].x,a=c[h].y,qLe(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function Sdt(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function czt(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new ma(0,0),s=new ma(0,0),n=new ma(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],h=a[c],p=a[c+1];c===0?r.setCoords(0,0):r.assignSub(h,u).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(p,h).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const f=n.x*s.x+n.y*s.y;f!==0&&n.scale(1/f),l.push(ma.add(h,n.scale(e)))}i.push(l)}return i}function uzt(t,e,i,r){const s=new ma(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}const HEe=Math.PI,Cdt=HEe/2,Bp=96/72,Fle=4,P5=()=>le.getLogger("esri.symbols.cim.CIMSymbolHelper");function RN(t,e,i){switch(e.type){case"CIMSymbolReference":return RN(t,e.symbol,i);case"CIMPointSymbol":i==null&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":i==null&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":i==null&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const r={x:0,y:0};t.drawSymbol(e,r);break}case"CIMVectorMarker":{const r=new TE;t.drawMarker(e,r);break}}return t.envelope()}function Edt(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(xi(t.offsetX)),Math.abs(xi(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function hzt(t){if(!t)return 0;let e=0;for(const i of t)e+=Edt(i);return e}let xG=class $N{static getEnvelope(e,i,r){if(!e)return null;const s=new sdt(r);if(Array.isArray(e)){let n;for(const o of e)n?n.union(RN(s,o,i)):n=RN(s,o,i);return n}return RN(s,e,i)}static getTextureAnchor(e,i){const r=this.getEnvelope(e,null,i);if(!r)return[0,0,0];const s=(r.x+.5*r.width)*Bp,n=(r.y+.5*r.height)*Bp,o=r.width*Bp+2,a=r.height*Bp+2;return[-s/o,-n/a,a]}static rasterize(e,i,r,s,n=!0){const o=r||this.getEnvelope(i,null,s);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Bp,l=(o.y+.5*o.height)*Bp;e.width=o.width*Bp,e.height=o.height*Bp,r||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=cb.createScale(Bp,-Bp);u.translate(.5*e.width-a,.5*e.height+l);const h=new ndt(c,s,u);switch(i.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};h.drawSymbol(i,g);break}case"CIMVectorMarker":{const g=new TE;h.drawMarker(i,g);break}}const p=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(p.data);if(n){let g;for(let _=0;_<f.length;_+=4)g=f[_+3]/255,f[_]=f[_]*g,f[_+1]=f[_+1]*g,f[_+2]=f[_+2]*g}return[f,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:i}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:$N.createCIMTextSymbolfromTextSymbol(e),textString:i}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:i,outline:r,width:s,xoffset:n,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(r){const _=kle(r);_&&c.push(_)}let h=e.url;e.type==="esriPFS"&&e.imageData&&(h=e.imageData);const p="angle"in e?e.angle??0:0,f=(s??0)*(o||1),g=(i??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:QS.Picture,tintColor:null,url:h,height:g,width:f,offsetX:xi(n),offsetY:xi(a),rotation:xi(-p),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:i,style:r,outline:s}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(s){const a=kle(s);a&&n.push(a)}if(r&&r!=="solid"&&r!=="none"&&r!=="esriSFSSolid"&&r!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:Zc(i),capStyle:Ah.Butt,joinStyle:qf.Miter,width:.75}]};let l=0;const c=No($dt(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}n.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),r==="cross"||r==="esriSFSCross"?n.push({type:"CIMHatchFill",lineSymbol:ge(a),offsetX:0,offsetY:0,rotation:90,separation:c}):r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"||n.push({type:"CIMHatchFill",lineSymbol:ge(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!r||r!=="solid"&&r!=="esriSFSSolid"||n.push({type:"CIMSolidFill",enable:!0,color:Zc(i)});return o}static fromSimpleLineSymbol(e){const{cap:i,color:r,join:s,marker:n,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:j7(a,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(n){let h;switch(n.placement){case"begin-end":h=Hf.Both;break;case"begin":h=Hf.JustBegin;break;case"end":h=Hf.JustEnd;break;default:h=Hf.None}const p=$N.fromSimpleMarker(n,l,r).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:h,offsetAlongLine:0},u.push(p)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?Zc(r):[0,0,0,0],capStyle:WEe(i),joinStyle:YEe(s),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:QS.Picture,tintColor:null,url:a,size:r,width:s,offsetX:xi(n),offsetY:xi(o),rotation:xi(-i)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:i,color:r,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:p,yoffset:f,backgroundColor:g,borderLineColor:_,borderLineSize:v}=e;let b,w,T,S,A,P;s&&(b=s.family,w=s.style,T=s.weight,S=s.size,A=s.decoration);let R=!1;return u&&(R=hut(u)[1]),(g||v)&&(P={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:Zc(g)},{type:"CIMSolidStroke",color:Zc(_),width:v}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:i,blockProgression:k7.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:D7.Normal,fontEncoding:N7.Unicode,fontFamilyName:b||"Arial",fontStyleName:Pdt(w,T),fontType:F7.Unspecified,haloSize:o,height:S,hinting:z7.Default,horizontalAlignment:Adt(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:xi(p),offsetY:xi(f),strikethrough:A==="line-through",underline:A==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Zc(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Zc(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:R?A5.RTL:A5.LTR,verticalAlignment:Mdt(h??"baseline"),verticalGlyphOrientation:B7.Right,wordSpacing:100,billboardMode3D:U7.FaceNearPlane,callout:P}}static createPictureMarkerRasterizationParam(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e,a=e.url??e.source?.url??e.source?.imageData;return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:QS.Picture,tintColor:null,url:a,size:r,width:s,offsetX:xi(n),offsetY:xi(o),rotation:xi(-i)}}:null}static createPictureFillRasterizationParam(e){const{width:i,height:r,xoffset:s,yoffset:n,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:QS.Picture,tintColor:null,url:o,width:i,height:r,offsetX:xi(s),offsetY:xi(n),rotation:0}}:null}static fromSimpleMarker(e,i,r){const{style:s}=e,n=e.color??r;if(s==="path"||s==="esriSMSPath"){const h=[];if("outline"in e&&e.outline){const g=e.outline;h.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:Zc(g.color),path:e.path})}h.push({type:"CIMSolidFill",enable:!0,color:Zc(n),path:e.path});const[p,f]=_A("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-xi(e.angle),size:xi(e.size||6),offsetX:xi(e.xoffset),offsetY:xi(e.yoffset),scaleSymbolsProportionally:!1,frame:p,markerGraphics:[{type:"CIMMarkerGraphic",geometry:f,symbol:{type:"CIMPolygonSymbol",symbolLayers:h}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const h=e.outline,p=h.style!=="solid"&&h.style!=="esriSLSSolid";[a,l]=p?_A(s,e.size):_A(s);const f=h.width??AQ.width;if(p){const v=f/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=f)}const g=e.style!=="cross"&&e.style!=="x"||e?.outline.style==="dot"||e?.outline.style==="short-dot"?da.HalfGap:da.FullPattern,_=p?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:j7(h.style,null).map(v=>h.width&&h.width>0?v*h.width:v),lineDashEnding:g,controlPointEnding:da.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:p?Ah.Round:Ah.Butt,enable:!0,width:f,color:Zc(h.color),effects:_})}else!i||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=_A(s):([a,l]=_A(s),o.push({type:"CIMSolidStroke",enable:!0,width:i,color:Zc(n)}));o.push({type:"CIMSolidFill",enable:!0,color:Zc(n)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:xi(-e.angle),size:xi(c||6*i),offsetX:xi(e.xoffset),offsetY:xi(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,i){const r=i*(e.separation??F2.CIMHatchFill.separation),s=r/2,n=ge(e.lineSymbol);n.symbolLayers?.forEach(l=>{switch(l.type){case"CIMSolidStroke":l.width!=null&&(l.width*=i),l.effects?.forEach(c=>{if(c.type==="CIMGeometricEffectDashes"){const u=c.dashTemplate;c.dashTemplate=u?.map(h=>h*i)}});break;case"CIMVectorMarker":{l.size!=null&&(l.size*=i);const c=l.markerPlacement;c!=null&&"placementTemplate"in c&&(c.placementTemplate=c.placementTemplate.map(u=>u*i));break}}});let o=this._getLineSymbolPeriod(n)||Fle;for(;o<Fle;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-s,ymax:s},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,i,r,s=null){return e&&i&&qEe(e,n=>{Idt(n,i,r),"url"in n&&n.url&&r.push(i.fetchResource(n.url,{signal:s}))}),r}static fetchFonts(e,i,r){if(e&&i){if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if(s.type==="CIMVectorMarker"&&s.markerGraphics)for(const n of s.markerGraphics)n?.symbol&&$N.fetchFonts(n.symbol,i,r)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:s,fontStyleName:n}=e;if(!s||s.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=mEe(n),l=gEe(e),c=new KR({family:s,style:o,weight:a,decoration:l});r.push(i.loadFont(c).catch(()=>{P5().error(`Unsupported font ${s} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const i=this._getEffectsRepeat(e.effects);if(i)return i;if(e.symbolLayers){for(const r of e.symbolLayers)if(r){const s=this._getEffectsRepeat(r.effects);if(s)return s;switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const n=this._getPlacementRepeat(r.markerPlacement);if(n)return n}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const i of e)if(i)switch(i.type){case"CIMGeometricEffectDashes":{const r=i.dashTemplate;if(r&&r.length){let s=0;for(const n of r)s+=n;return 1&r.length&&(s*=2),s}break}case"CIMGeometricEffectWave":return i.period;default:P5().error(`unsupported geometric effect type ${i.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const i=e.placementTemplate;if(i&&i.length){let r=0;for(const s of i)r+=+s;return 1&i.length&&(r*=2),r}break}}return 0}static fromCIMInsidePolygon(e){const i=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const s=Math.abs(i.stepX),n=Math.abs(i.stepY),o=(i.randomness??100)/100;let a,l,c,u;if(i.gridType==="Random"){const h=No(Oht),p=Math.max(Math.floor(h/s),1),f=Math.max(Math.floor(h/n),1);a=p*s/2,l=f*n/2,c=2*l;const g=new Yb(i.seed),_=o*s/1.5,v=o*n/1.5;u=[];for(let b=0;b<p;b++)for(let w=0;w<f;w++){const T=b*s-a+_*(.5-g.getFloat()),S=w*n-l+v*(.5-g.getFloat());u.push({x:T,y:S}),b===0&&u.push({x:T+2*a,y:S}),w===0&&u.push({x:T,y:S+2*l})}}else i.shiftOddRows===!0?(a=s/2,l=n,c=2*n,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=s/2,l=n/2,c=n,u=[{x:-s,y:0},{x:0,y:-n},{x:-s,y:-n},{x:0,y:0},{x:s,y:0},{x:0,y:n},{x:s,y:n},{x:-s,y:n},{x:s,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(h=>({type:"CIMMarkerGraphic",geometry:h,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})),size:c}}};function qEe(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const r of i)if(e(r),r.type==="CIMVectorMarker"){const s=r.markerGraphics;if(!s)continue;for(const n of s)if(n){const o=n.symbol;o&&qEe(o,e)}}break}}}const WEe=t=>{if(!t)return Ah.Butt;switch(t){case"butt":return Ah.Butt;case"square":return Ah.Square;case"round":return Ah.Round}},YEe=t=>{if(!t)return qf.Miter;switch(t){case"miter":return qf.Miter;case"round":return qf.Round;case"bevel":return qf.Bevel}},Adt=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},Mdt=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},Zc=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]},Pdt=(t,e)=>{const i=Odt(e),r=Rdt(t);return i&&r?`${i}-${r}`:`${i}${r}`},Odt=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},Rdt=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},j7=(t,e)=>{const i=se("safari")?.001:0,r=e==="butt";switch(t){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return P5().error("Unexpected: style does not require rasterization"),[0,0];default:return P5().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},_A=(t,e=100)=>{const i=e/2;let r,s;const n=t;if(n==="circle"||n==="esriSMSCircle"){let a=Math.acos(1-.25/i),l=Math.ceil(HEe/a/4);l===0&&(l=1),a=Cdt/l,l*=4;const c=[];c.push([i,0]);for(let u=1;u<l;u++)c.push([i*Math.cos(u*a),-i*Math.sin(u*a)]);c.push([i,0]),r={rings:[c]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if(n==="cross"||n==="esriSMSCross")r={paths:[[[0,i],[0,-i]],[[i,0],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="diamond"||n==="esriSMSDiamond")r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="square"||n==="esriSMSSquare")r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="x"||n==="esriSMSX")r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="triangle"||n==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;r={rings:[[[a,c],[0,l],[o,c],[a,c]]]},s={xmin:a,ymin:c,xmax:o,ymax:l}}else n==="arrow"&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i});return[s,r]},$dt=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function Idt(t,e,i){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void i.push(e.geometryEnginePromise);Vut(t.effects)&&(e.geometryEnginePromise=Gut(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then(r=>e.geometryEngine=r))}}function kle(t){if(!t)return null;let e=null;const{cap:i,color:r,join:s,miterLimit:n,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:j7(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?Zc(r):[0,0,0,0],capStyle:WEe(i),joinStyle:YEe(s),miterLimit:n,width:a,effects:e}}function XEe(t,e,i,r,s){if(t==null)return null;const n=t.referencesGeometry()&&s?Ldt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return le.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const TG=new Map;function Ldt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;TG.has(e)||TG.set(e,Ddt(e));const o=TG.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function Ddt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>U2e(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>z2e(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>B2e(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>k2e(r,e,i,s,n);default:return le.getLogger("esri.views.2d.support.arcadeOnDemand").error(new W("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const Ndt=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]};let _P=class Zs{static findApplicableOverrides(e,i,r){if(e&&i){if(e.primitiveName){let s=!1;for(const n of r)if(n.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const n of i)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)Zs.findApplicableOverrides(s,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)Zs.findApplicableOverrides(s,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)Zs.findApplicableOverrides(s,i,r);if(e.markerPlacement&&Zs.findApplicableOverrides(e.markerPlacement,i,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const s of e.markerGraphics)Zs.findApplicableOverrides(s,i,r),Zs.findApplicableOverrides(s.symbol,i,r)}else e.type==="CIMCharacterMarker"?Zs.findApplicableOverrides(e.symbol,i,r):e.type==="CIMHatchFill"?Zs.findApplicableOverrides(e.lineSymbol,i,r):e.type==="CIMPictureMarker"&&Zs.findApplicableOverrides(e.animatedSymbolProperties,i,r)}}}static findEffectOverrides(e,i){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&yEe(e),!i||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=Mle(e),s=e.primitiveName,n=[];for(const o of i)o.primitiveName===s&&n.push(Mle(o));return{type:"cim-effect-param",effect:r,overrides:Zut(n)}}static async resolveSymbolOverrides(e,i,r,s,n,o,a){if(!e?.symbol)return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!s)return l;l=ge(l),c=ge(c);let h=!0;if(i||(i={attributes:{}},h=!1),u){if(h||(c=c.filter(p=>!p.valueExpressionInfo?.expression.includes("$feature"))),a||(c=c.filter(p=>!p.valueExpressionInfo?.expression.includes("$view"))),c.length>0){const p={spatialReference:r,fields:Yut(i.attributes),geometryType:n};await Zs.createRenderExpressions(c,p),Zs.evaluateOverrides(c,i,n??"esriGeometryPoint",o,a)}Zs.applyOverrides(l,c)}return s&&Zs.applyDictionaryTextOverrides(l,i,s,null),l}static async createRenderExpressions(e,i){const r=[];for(const s of e){const n=s.valueExpressionInfo;if(!n||Zs._expressionToRenderExpression.has(n.expression))continue;const o=Lge(n.expression,i.spatialReference,i.fields);r.push(o),o.then(a=>Zs._expressionToRenderExpression.set(n.expression,a))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,i,r,s,n){const o={$view:{scale:n?.scale}};for(const a of e){a.value&&typeof a.value=="object"&&swe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=Ndt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=Zs._expressionToRenderExpression.get(l.expression);c&&(a.value=XEe(c,i,o,r,s))}}static applyDictionaryTextOverrides(e,i,r,s,n="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&Zs.applyDictionaryTextOverrides(a,i,r,s,e.type==="CIMTextSymbol"?e.textCase:n)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&Zs.applyDictionaryTextOverrides(a,i,r,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=Dut(o,r);e.textString=Nut(i,a,s,n)}}}}static applyOverrides(e,i,r,s){if(e.primitiveName){for(const n of i)if(n.primitiveName===e.primitiveName){const o=CQ(n.propertyName);if(s&&s.push({cim:e,nocapPropertyName:o,value:e[o]}),r){let a=!1;for(const l of r)l.primitiveName===e.primitiveName&&(a=!0);a||r.push(n)}n.value!=null&&(e[o]=n.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)Zs.applyOverrides(n,i,r,s);if(e.symbolLayers)for(const n of e.symbolLayers)Zs.applyOverrides(n,i,r,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)Zs.applyOverrides(n,i,r,s);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const n of e.markerGraphics)Zs.applyOverrides(n,i,r,s),Zs.applyOverrides(n.symbol,i,r,s)}}static restoreOverrides(e){for(const i of e)i.cim[i.nocapPropertyName]=i.value}static buildOverrideKey(e){let i="";for(const r of e)r.value!==void 0&&(i+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return i}static toValue(e,i){if(e==="DashTemplate")return i.split(" ").map(r=>Number(r));if(e==="Color"){const r=new et(i).toRgba();return r[3]*=255,r}return i}};_P._expressionToRenderExpression=new Map;function PQ(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(i&&t.effects)for(const s of t.effects)Udt(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Fdt(s,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":PQ(s.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function Fdt(t,e,i){if(t&&(t.markerPlacement&&kdt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||PQ(r.symbol,e,!0,i)}function kdt(t,e){switch(fEe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function Udt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function zdt(t){const e=[];return H7(Uut(t),e),e.length?new et(kut(e[0])):null}function H7(t,e){if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i?.symbolLayers){for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(But(s)||zut(s)&&s.markerPlacement&&fEe(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Ule(e,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{H7(n.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Ule(e,s.color);break;case"CIMHatchFill":H7(s.lineSymbol,e)}}}function Ule(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}let Bdt=class{constructor(e,i){this._storage=new VCe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new Bdt(1e3);new et([128,128,128]);const Vdt=new et("white");function pzt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function Gdt(t){return t.resource?.href??""}function fzt(t,e){if(!t)return null;let i=null;return Nw(t)?i=jdt(t):Fk(t)&&(i=t.type==="cim"?zdt(t):t.color?new et(t.color):null),i?TR(i,e):null}function jdt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{r.type==="object"&&r.resource?.href||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new et(i):null}function TR(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new et(i)}function Hdt(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>TR(e=e??n??(i!=null?Vdt:null),i);r.forEach(n=>{if(n.type!=="object"||!n.resource?.href||e)if(n.type==="water")n.color=s(n.color);else{const o=n.material!=null?n.material.color:null,a=s(o);n.material==null?n.material=new Su({color:a}):n.material.color=a,i!=null&&"outline"in n&&n.outline?.color!=null&&(n.outline.color=TR(n.outline.color,i))}})}function qdt(t,e,i){(e=e??t.color)&&(t.color=TR(e,i)),i!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=TR(t.outline.color,i))}function mzt(t,e,i){t&&(e||i!=null)&&(e&&(e=new et(e)),Nw(t)?Hdt(t,e,i):Fk(t)&&qdt(t,e,i))}async function Wdt(t,e){const i=t.symbolLayers;i&&await Nk(i,async r=>Ydt(r,e))}async function Ydt(t,e){switch(t.type){case"extrude":Zdt(t,e);break;case"icon":case"line":case"text":Xdt(t,e);break;case"path":Qdt(t,e);break;case"object":await Jdt(t,e)}}function Xdt(t,e){const i=ZEe(e);i!=null&&(t.size=i)}function ZEe(t){for(const e of t)if(typeof e=="number")return e;return null}function Zdt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Jdt(t,e){const{resourceSize:i,symbolSize:r}=await Kdt(t),s=JEe(e,i,r);t.width=gO(e[0],r[0],i[0],s),t.depth=gO(e[1],r[1],i[1],s),t.height=gO(e[2],r[2],i[2],s)}function Qdt(t,e){const i=JEe(e,Uf,[t.width,void 0,t.height]);t.width=gO(e[0],t.width,1,i),t.height=gO(e[2],t.height,1,i)}function JEe(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function Kdt(t){const{computeObjectLayerResourceSize:e}=await ue(()=>import("./symbolLayerUtils-71246e05.js"),[],import.meta.url),i=await e(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function gO(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function ept(t,e){const i=ZEe(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function gzt(t,e){if(t&&e)return Nw(t)?Wdt(t,e):void(Fk(t)&&ept(t,e))}function yzt(t,e,i){if(t&&e!=null)if(Nw(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=(s.tilt??0)+e;break;case"roll":s.roll=(s.roll??0)+e;break;default:s.heading=(s.heading??0)+e}})}else Fk(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function _zt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function vzt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const bzt=1.2,tpt=Cu,ipt=4;let wz=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,qr.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,An.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,qr.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return te(e,0,0,0)}getBoundingBoxObjectSpace(e=pn()){return Or(e)}addObjectState(e,i){e===_0.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,An.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,An.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(cT)&&(e.draped.origin[0]+=cT[0],e.draped.origin[1]+=cT[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){Or(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,zle,r),j5e(n,zle)}if(i){let o;qd(n,cT);const a=kJ(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(cT[0],cT[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)Ik(Vp,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Vp[0]=n[0]-o,Vp[1]=n[1]-o,Vp[2]=n[2]-o,Vp[3]=n[0]+o,Vp[4]=n[1]+o,Vp[5]=n[2]+o}return i(Vp,0,2),this.calculateRelativeScreenBounds&&s.push({location:qd(Vp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),rX(Vp,r)}};const zle=Vt(),Vp=pn(),cT=C();function O5(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function QEe(t){const{size:e}=t.definition,i=t.fontString(e);let r=Ble.get(i);if(!r){const s=O5(spt,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(npt);r=new rpt(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),Ble.set(i,r)}return r}const Ble=new Map;let rpt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const spt={canvas:null},npt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),R5=1;let KEe=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=O5(Vle,nL,nL).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const T=e.measureText(b),S=T.width/i,A=S+s;this._textWidths.push(S),this._lineWidths.push(A),o=Math.max(o,A),c=Math.max(c,T.actualBoundingBoxAscent/i),u=Math.max(u,T.actualBoundingBoxDescent/i),w===0&&(a=T.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=T.actualBoundingBoxDescent/i)});const h=QEe(this._parameters),p=Math.max(c,h.maxAscent),f=Math.max(u,h.maxDescent),g=a,_=this._parameters.definition.font.decoration==="underline"?f:l,v=o;this._metricsCached=new apt(g,_,p,f,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*opt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,R5)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case B_.Left:return this._horizontalPadding;case B_.Center:return(this.displayWidth-this._lineWidths[e])/2;case B_.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+h,r),this._renderLineDecoration(e,i+h,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+h,r,this._textWidths[c]),r+=this._lineSpacing}if(wr.TEXT_SHOW_BASELINE){e.strokeStyle=Gle,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(wr.TEXT_SHOW_BORDER&&(e.strokeStyle=Gle,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Te(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=O5(Vle,Math.max(o,nL),Math.max(a,nL)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let h=n;for(let p=0;p<this._lines.length;++p){const f=this._getLineXOffset(p);this._renderLineDecoration(c,s+f,h,this._textWidths[p],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of eAe)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(h*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,h=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,h),e.lineTo(l,h),e.lineTo(l,u),e.stroke()}};const eAe=[];for(let e=0;e<360;e+=360/16)eAe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var B_;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(B_||(B_={}));const Vle={canvas:null},opt=.2,nL=512,Gle="rgb(255, 0, 255, 0.5)";let apt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const lpt=Object.freeze({left:0,center:.5,right:1}),IN=Object.freeze({"bottom-left":ci(0,0),bottom:ci(.5,0),"bottom-right":ci(1,0),left:ci(0,.5),center:ci(.5,.5),right:ci(1,.5),"top-left":ci(0,1),top:ci(.5,1),"top-right":ci(1,1)});function tAe(t){switch(t){case"left":return B_.Left;case"right":return B_.Right;default:return B_.Center}}function jle(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function cpt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function upt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function hpt(t){return t==="middle"?"center":t}function dpt(t,e){switch(t){case"top":return bi(e,0,R5);case"bottom":return bi(e,0,-R5);default:return ta(e,Bw)}}let UC=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=xe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=wu(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){tn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=xe()),Ai(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Ws()),Ve(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*mC(this.shaderTransformation)),this._boundingSphere):v1e}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Hle=Ce(0,0,1),ppt=16,fpt=1.5,jb=mQ,mpt=[jb/2,jb/2,1-jb/2,1-jb/2],gpt=[v5*jb,v5*jb];let q7=class iAe extends Dm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const s=Gdt(this.symbolLayer),n=qle(s);n!=null?await this._prepareResourcesCIM(i,JSON.parse(n),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=nz(this._getIconSize());if(e)throw new W("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?dn(e.size):ppt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){let i=this._cimData;if(i&&i.symbol||this.logger.error("Can't create texture, CIM data is undefined"),i.primitiveOverrides){i=ge(i);const c=i.primitiveOverrides;_P.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),_P.applyOverrides(i.symbol,c)}const r=XW(JSON.stringify(i));let s=this._cimSymbolTextures.get(r);if(s)return s;const n=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&_P.applyDictionaryTextOverrides(i.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?Iut(this._cimScaleFactorOrFunction,e):1;a!==1&&i.symbol&&PQ(i.symbol,a,!0);const l=xG.getEnvelope(i,null,n.resourceManager);if(l?.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,h=n.rasterize({type:"cim",data:i},l.width,l.height,c,u,1,"esriGeometryPoint"),p=new Db({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=Wle("relative",p),s=new fv(h,{width:h?.width??1,height:h?.height??1,reloadable:!0})}else s=new fv(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,s),this._context.stage.add(s),s}_prepareMaterialParameters(){const e={anchorPosition:Wle(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(ypt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:dn(r),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!se("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(SG(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>hlt(i));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=ult(i),e.distanceFieldBoundingBox=mpt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/jb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await fp(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw a0(o.error),new W("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture;this._size=Yle(a,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){if(this._cimData=i,!this._context.sharedResources.cimSymbolRasterizer){const u=(await ue(()=>import("./CIMSymbolRasterizer-23ed8a3c.js"),[],import.meta.url)).CIMSymbolRasterizer;yt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=i,a=o?.symbol;xG.fetchResources(a,s.resourceManager,n,r),xG.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o?.primitiveOverrides&&n.push(_P.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),yt(r)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const h=u.scaleExpression,p=await Lge(h,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(f,g,_)=>{const v=XEe(p,f,{$view:_},"esriGeometryPoint",g);return v!==null?v:1}}}yt(r),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource?.href?null:this.symbolLayer.resource?.primitive??hke}_getOutlineSize(){let e=0;const i=this.symbolLayer;return i.outline?.size!=null?Math.max(dn(i.outline.size),0):(e=SG(this._getPrimitive())?fpt:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=i?.outline?.color;if(r!=null){const s=et.toUnitRGB(r),n=r.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(SG(this._getPrimitive()))return tpt;const e=this._getPrimitive()==null,i=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,i){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new LC(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=RC(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new LC(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=il(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=Xt(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=dn(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const h=this._generateTextureCIM(i),p={textureId:h.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(p,this._context.stage);const f=window.devicePixelRatio||1;s=[h.parameters.width/f,h.parameters.height/f]}else s=this._size,r=this._materials[0];const n=pw(i.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const h=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,h)}l*=this._symbolTextureRatio;const c=ci(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=pw(i);if(!n)return!1;const o=T2e(s,this._context,n,r);if(o==null)return!1;const a=sQ(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,Yw(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=M$(iAe.elevationModeChangeTypes,r,s);if(n!==Ts.UPDATE)return n;const o=Fh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!$C(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return js.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return js.FastUpdate}prepareSymbolLayerPatch(e){if(this._patchTask?.abort(),e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchResource(e,i)}_preparePatchResource(e,i){if(!i.resource||i.resource.type!=="partial")return;const r=i.resource.diff;if(r?.href?.type!=="complete")return;const s=r.href.newValue,{textures:n}=this._context.sharedResources;if(s==null||n==null||qle(s)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=il(this._patchTask),this._patchTask=Tm(l=>this._context.schedule(async(c,u)=>{const h=await fp(n.fromUrl(s,a,{signal:u}));yt(u);const p=!h.ok;if(p&&a0(h.error),this._textureHandle=Xt(this._textureHandle),this._patchTask=null,p){this._forEachMaterial(_=>{_.visible=!1,_.setParameters({textureId:null})});const g=`Failed to load (Request for icon resource failed: ${s})`;return void this.logger.error(new W("graphics3diconsymbollayer:request-failed",g))}this._textureHandle=h.value;const f=h.value.texture;this._size=Yle(f,o),this._forEachMaterial(g=>{g.setParameters({textureId:f.id}),g.visible=!0})},l))}),delete r.href}_defaultElevationInfoNoZ(){return _pt}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),h=Y9(r,Hle,null,s,n,vpt,null,l,u),p=rQ(this._context,i,h,o,a);if(p==null)return null;const f=new Lm(this,p.object,[h],null,null,dw,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=Fh(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,l),f.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,g),Yw(f,i,this._context.elevationProvider),f}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=C();ts(i,a,this._context.overlaySR),a[2]=wQ;const l=this._context.clippingExtent;if(l!=null&&!iX(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),h=Y9(r,Hle,a,s,n,null,null,c,u),p=new UC(h,{layerUid:o,graphicUid:e.uid}),f=new wz(this,[p],null,this._context.drapeSourceRenderer);return f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,g),f}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=it())=>{const[c,u]=EJ(bpt,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=u*a+r,l}}const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=it())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=Ce(e,e,e),r=No(1),s=e*r,n=Ce(s,s,s);return new E$({size:!0,color:!0,rotation:!0,opacity:!1},i,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function ypt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function SG(t){return t!=null&&(t==="cross"||t==="x")}function qle(t){const e=j_(t);return e?.mediaType==="application/json"?e.data:void 0}function Wle(t,e){return t==="relative"?ci((e.x||0)+.5,.5-(e.y||0)):t in IN?IN[t]:IN.center}function Yle({parameters:t},e){const i=(t.width??1)/(t.height??1);return i>1?[e,Math.round(e/i)]:[Math.round(e*i),e]}q7.PRIMITIVE_SIZE=gpt,q7.elevationModeChangeTypes={definedChanged:Ts.UPDATE,staysOnTheGround:Ts.NONE,onTheGroundChanged:Ts.RECREATE};const _pt={mode:"relative-to-ground",offset:0},vpt=kt(0,0,0,1),bpt=C();function W7(t){switch(t){case"butt":return Oh.BUTT;case"square":return Oh.SQUARE;case"round":return Oh.ROUND;default:return null}}function Xle(t){return t==="diamond"?"kite":t}function Y7(t,e,i=null){const r=[],s=e.mapPositions;wpt(e,r);const n=r[0][1].data,o=r[0][1].indices.length,a=wv(o);return xpt(e,r,a),Cpt(e,r,a),Tpt(e,r,a),Spt(e,r,a),Ept(e,r,a),Apt(e,r,a),Mpt(e,r,n),new rn(t,r,s,ws.Line,i)}function wpt(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,s=Ppt(i)&&r,n=i.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?i.slice(0,-3):i;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([O.POSITION,new Ze(a,o,3,s)])}function xpt(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([O.COLOR,new Ze(r??wh,i,4)])}function Tpt(t,e,i){t.attributeData.normal&&e.push([O.NORMAL,new Ze(t.attributeData.normal,i,3)])}function Spt(t,e,i){t.attributeData.colorFeature!=null&&e.push([O.COLORFEATUREATTRIBUTE,new Ze([t.attributeData.colorFeature],i,1,!0)])}function Cpt(t,e,i){t.attributeData.sizeFeature==null&&e.push([O.SIZE,new Ze([t.attributeData.size??1],i,1,!0)])}function Ept(t,e,i){t.attributeData.sizeFeature!=null&&e.push([O.SIZEFEATUREATTRIBUTE,new Ze([t.attributeData.sizeFeature],i,1,!0)])}function Apt(t,e,i){t.attributeData.opacityFeature!=null&&e.push([O.OPACITYFEATUREATTRIBUTE,new Ze([t.attributeData.opacityFeature],i,1,!0)])}function Mpt(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ne.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=jn(i.length),s=er(t.overlayInfo.spatialReference);for(let h=0;h<r.length;h+=3)EX(i,h,r,h,s);const n=i.length/3,o=os(n+1);let a=Opt,l=Rpt,c=0,u=0;bi(a,r[u++],r[u++]),u++,o[0]=0;for(let h=1;h<n+1;++h)h===n&&(u=0),bi(l,r[u++],r[u++]),u++,c+=ave(a,l),o[h]=c,[a,l]=[l,a];e.push([O.DISTANCETOSTART,new Ze(o,e[0][1].indices,1,!0)])}function Ppt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Opt=it(),Rpt=it();function Ezt(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=jn(3*s);r.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function $pt(t,e,i,r){const s=t.type==="polygon"?fm.CCW_IS_HOLE:fm.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=l$(n,!!t.hasZ,s,t.spatialReference),l=jn(o.length),c=xSe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?rAe(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function Ipt(t,e){const i=t.type==="polygon"?fm.CCW_IS_HOLE:fm.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=l$(r,!1,i),o=jr(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=wQ;return{lines:o?rAe(n,s):[],projectionSuccess:o}}function rAe(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:Ph(e,3*s,3*n),mapPositions:i!=null?Ph(i,o,a):void 0})}return r}function Lpt(t){const e=new Pi,i=t.multipassEnabled&&t.output===V.Color,r=t.space===kl.World;e.include(mCe,t),e.include($Ce,t);const{vertex:s,fragment:n}=e;return n.include(Ep),Dl(s,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.PREVPOSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Ar("nearFar",(o,a)=>a.camera.nearFar),new Ei("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(O.NORMAL,"vec3"),PC(s),s.constants.add("tiltThreshold","float",.7),s.code.add(x`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(x`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(x`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Xw.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===kl.Screen&&(s.uniforms.add(new Gr("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Ue("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),mE(s),s.code.add(x`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(x`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(x`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(x`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===kl.Screen&&s.code.add(x`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(x`
        ${i?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Im,t),e.include(Ks,t),n.uniforms.add(new Ei("intrinsicColor",o=>o.color),new ct("tex",o=>o.markerTexture)),n.include(Rm),e.constants.add("texelSize","float",1/fw),n.code.add(x`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",gQ/fw),e.constants.add("relativeTipLineWidth","float",blt),n.code.add(x`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),e.constants.add("symbolAlphaCutoff","float",Ro),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===V.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===V.Color?x`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===V.Color&&t.transparencyPassType===Qe.ColorAlpha?x`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===V.Highlight?x`fragColor = vec4(1.0);`:""}
  }
  `),e}const Dpt=Object.freeze(Object.defineProperty({__proto__:null,build:Lpt},Symbol.toStringTag,{value:"Module"})),sAe=new Map([[O.POSITION,0],[O.PREVPOSITION,1],[O.UV0,2],[O.NORMAL,3],[O.COLOR,4],[O.COLORFEATUREATTRIBUTE,4],[O.SIZE,5],[O.SIZEFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,6]]);let nAe=class oAe extends Ni{initializeProgram(e){return new Fi(e.rctx,oAe.shader.get().build(this.configuration),sAe)}_makePipelineState(e,i){const r=this.configuration,s=e===Qe.NONE;return Lt({blending:r.output===V.Color?s?Ac:L0(e):null,depthTest:r.space===kl.Draped?null:{func:Pv(e)},depthWrite:r.space===kl.Draped?null:s?r.writeDepth?Oc:null:ez(e),drawBuffers:r.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?pv:Ov:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Lt({blending:Ac,depthTest:d5,depthWrite:null,colorWrite:qt,stencilWrite:null,stencilTest:e2e}),this._occluderPipelineOpaque=Lt({blending:Ac,depthTest:d5,depthWrite:null,colorWrite:qt,stencilWrite:QSe,stencilTest:KSe}),this._occluderPipelineMaskWrite=Lt({blending:null,depthTest:WJ,depthWrite:null,colorWrite:null,stencilWrite:ym,stencilTest:pv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};nAe.shader=new Oi(Dpt,()=>ue(()=>import("./LineMarker.glsl-c17cd6da.js"),[],import.meta.url));let Npt=class extends Av{constructor(e){super(e,new kpt),this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>i===V.Highlight||Kg(i)&&this.parameters.renderOccluded===ki.OccludeAndTransparentStencil],[ye.OPAQUE_NO_SSAO_DEPTH,i=>k_(i)],[ye.OCCLUDER_MATERIAL,i=>Fse(i)&&this.parameters.renderOccluded===ki.OccludeAndTransparentStencil],[ye.TRANSPARENT_OCCLUDER_MATERIAL,i=>Fse(i)&&this.parameters.renderOccluded===ki.OccludeAndTransparentStencil],[ye.TRANSPARENT_MATERIAL,i=>Kg(i)&&this.parameters.writeDepth],[ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>Kg(i)&&!this.parameters.writeDepth],[ye.DRAPED_MATERIAL,i=>i===V.Color||i===V.Highlight]]),this._vertexAttributeLocations=sAe,this._configuration=new io,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===ye.DRAPED_MATERIAL?kl.Draped:this.parameters.worldSpace?kl.World:kl.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Oh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===ki.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=cs().vec3f(O.POSITION).vec3f(O.PREVPOSITION).vec2f(O.UV0);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Upt(this._layout,this.parameters)}createGLMaterial(e){return new Fpt(e)}},Fpt=class extends WZ{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(nAe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},kpt=class extends A${constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Oh.BUTT,this.anchor=Xw.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Upt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.attributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(O.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,h=0;this._parameters.vvSize?h=r.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(O.SIZE)&&(u=r.attributes.get(O.SIZE).data[0]);let p=[1,1,1,1],f=0;this._parameters.vvColor?f=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(p=r.attributes.get(O.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(A,P,R,F)=>{if(_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],_[v++]=P[0],_[v++]=P[1],_[v++]=P[2],_[v++]=R[0],_[v++]=R[1],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=h:_[v++]=u,this._parameters.vvColor)_[v++]=f;else{const k=Math.min(4*F,p.length-4);_[v++]=p[k],_[v++]=p[k+1],_[v++]=p[k+2],_[v++]=p[k+3]}this._parameters.vvOpacity&&(_[v++]=g)};let w;(function(A){A[A.ASCENDING=1]="ASCENDING",A[A.DESCENDING=-1]="DESCENDING"})(w||(w={}));const T=(A,P)=>{const R=te(zpt,o[3*A],o[3*A+1],o[3*A+2]),F=Bpt;let k=A+P;do te(F,o[3*k],o[3*k+1],o[3*k+2]),k+=P;while(Rw(R,F)&&k>=0&&k<a);e&&(Ve(R,R,e),Ve(F,F,e)),b(R,F,[-1,-1],A),b(R,F,[1,-1],A),b(R,F,[1,1],A),b(R,F,[-1,-1],A),b(R,F,[1,1],A),b(R,F,[-1,1],A)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,w.DESCENDING)}};const zpt=C(),Bpt=C(),oa={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Vpt={dash:oa.dash,"dash-dot":[...oa.dash,...oa.dot],dot:oa.dot,"long-dash":oa["long-dash"],"long-dash-dot":[...oa["long-dash"],...oa.dot],"long-dash-dot-dot":[...oa["long-dash"],...oa.dot,...oa.dot],none:null,"short-dash":oa["short-dash"],"short-dash-dot":[...oa["short-dash"],...oa["short-dot"]],"short-dash-dot-dot":[...oa["short-dash"],...oa["short-dot"],...oa["short-dot"]],"short-dot":oa["short-dot"],solid:null},Gpt=8;function jpt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function Rzt(t){return{pattern:[t,t],pixelRatio:2}}function aAe(t){return t!=null&&t.type==="style"?Hpt(t.style):null}function Hpt(t){return t!=null?jpt(Vpt[t],Gpt):null}const qpt=["polyline","polygon","extent"],Zle=new E$({size:!0,color:!0,rotation:!1,opacity:!0});let lAe=class cAe extends Dm{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._fastUpdates=RC(this._context.renderer,Zle),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:No(1))<0)throw new W("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:W7(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:aAe(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._materials[As.Line]==null&&(this._materials[As.Line]=new XS(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[As.Line])),this._materials[As.Line]}get _ringMaterial(){return this._materials[As.Ring]==null&&(this._materials[As.Ring]=new XS(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[As.Ring])),this._materials[As.Ring]}get _wireframeLineMaterial(){return this._materials[As.LineWireframe]==null&&(this._materials[As.LineWireframe]=new XS({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[As.LineWireframe])),this._materials[As.LineWireframe]}get _wireframeRingMaterial(){return this._materials[As.RingWireframe]==null&&(this._materials[As.RingWireframe]=new XS({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[As.RingWireframe])),this._materials[As.RingWireframe]}get _markerMaterial(){return this._materials[As.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[As.Marker]=new Npt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Xle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[As.Marker])),this._materials[As.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?dn(Qot(e.size)):1}_getDrivenColor(e){const i=kt(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,qpt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return js.RecreateSymbol;{const s=this._fastUpdates;if(!$C(s,i,Zle))return js.RecreateSymbol;this._forEachMaterial(n=>n?.setParameters(s.materialParameters))}}return js.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};i.size?.type==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),i.cap?.type==="complete"&&(r.cap=W7(i.cap.newValue??"butt"),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(n=>n?.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===As.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){if(e==null)return;const r=e.parameters.color,s=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=kt(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=M$(cAe.elevationModeChangeTypes,r,s);if(n!==Ts.UPDATE)return n;const o=Fh(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i?.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=Jle(e.graphic.geometry),n=s.type==="polygon"?s.rings:s.paths,o=new Array,a=pn(),l=$pt(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),c=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(l,n,c,"LineSymbol3DLayer");for(let p=0;p<l.lines.length;p++){const f=l.lines[p],g=f.position,_=f.mapPositions;if(this._context.clippingExtent!=null&&(Or(a),Tc(a,_),!Wd(a,this._context.clippingExtent)))continue;const v=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,g,_,s.type,yO.ELEVATED,r);o.push(v),wr.LINE_WIREFRAMES&&o.push(v.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&o.push(v.instantiate({material:this._markerMaterial}))}if(o.length===0)return null;const u=new Rv({geometries:o,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),h=new Lm(this,u,o,null,null,Hrt,i);return h.alignedSampledElevation=l.sampledElevation,h.needsElevationUpdates=Fh(i.mode),h}_createGeometry(e,i,r,s,n,o,a){const l=o===yO.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=this._fastUpdates?.visualVariables.color,h=this._fastUpdates?.visualVariables.size,p=this._fastUpdates?.visualVariables.opacity,f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:r,size:h?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:h?np(h.field,i.graphic):null,colorFeature:u?np(u.field,i.graphic):null,opacityFeature:p?np(p.field,i.graphic):null};return Y7(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},f)}_createAsOverlay(e,i){const r=e.graphic,s=Jle(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=wr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=pn(),h=Or(),p=Ipt(s,this._context.overlaySR),f=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,f,"LineSymbol3DLayer");for(const g of p.lines){if(Or(u),Tc(u,g.position),!Wd(u,this._context.clippingExtent))continue;eC(h,u);const _=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,yO.DRAPED,r.uid),w=new UC(b,{layerUid:i,graphicUid:r.uid});c.push(w)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Tc(u,g.position,0,1),v!=="end"&&v!=="begin-end"||Tc(u,g.position,g.position.length-3,1)}_(o),wr.LINE_WIREFRAMES&&_(a)}return new wz(this,c,h,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??No(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?dn(1):1:dn(e)}_prepareMaterialPatch(e,i,r){const s=i.material;if(s==null)return void(r.changed&&r.useMaterialColor&&oL(this._getCombinedOpacityAndColor(this._materialColor),this._materials[As.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?s.newValue?.color:s.diff.color?.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&oL(n$(o),this._materials[As.Marker],e),this._patternHidesLine&&(o[3]=0),oL(o,this._materials[As.Line],e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker,s=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=r.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&oL(this._getCombinedOpacityAndColor(a),s,e);const c=r.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Xle(c)})),delete i.marker,{changed:o,useMaterialColor:l}}};function Jle(t){switch(t.type){case"extent":if(t instanceof Qi)return mv.fromExtent(t);break;case"polygon":case"polyline":return t}return null}function oL(t,e,i){e!=null&&i.symbolLayerStatePatches.push(()=>e.setParameters({color:t}))}var yO,As;lAe.elevationModeChangeTypes={definedChanged:Ts.RECREATE,staysOnTheGround:Ts.NONE,onTheGroundChanged:Ts.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(yO||(yO={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(As||(As={}));var Tf;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Tf||(Tf={}));let uAe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=Jg.KTX2_ENCODING}};function _O(t){return t?.type==="encoded-mesh-texture"}async function Wpt(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function Ypt(t,e){if(e===Jg.KTX2_ENCODING)return new uAe(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),s=new Image;if(se("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(r),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=r});try{s.src=r,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),s}function Ff(t){if(t==null)return null;const e=t.offset!=null?t.offset:O2e,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:R2e,s=YP(1,0,0,0,1,0,e[0],e[1],1),n=YP(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=YP(r[0],0,0,0,r[1],0,0,0,1),a=yr();return gC(a,n,o),gC(a,s,a),a}const Xpt={disableDelayMs:2e3};let Zpt=class extends Lm{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,i){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,s=r.geometries.slice();r.removeAllGeometries();const n=oC(CG,r.transformation),o=i.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=s}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout(()=>{this._autoDisableFastUpdatesTimeoutId=0,e()},Xpt.disableDelayMs)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(s=>e(s.material));i.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=r[s];o.setParameters({modelTransformation:null}),o===n.material?i.addGeometry(n):i.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=oC(CG,e),a=r.getOrigin(o);if(a===n)return;const l=i?.localMatrix??Cr;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:s}=this,n=i?.localMatrix??Cr;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(f=>f.transformation=n),void this._updateEdgeTransform(r);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=Ai(Qle,o,a),h=Ai(Kle,l,c),p=Ai(ece,h,Is(ece,a));s.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:h}),this._updateEdgeTransform(r)}alignWithElevation(e,i,r,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,s);r!=null&&sz(this.elevationContext.featureExpressionInfoContext,r);const n=(g,_)=>hv(g,e,this.elevationContext,i,_),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Ai(Qle,a,l),u=o.effectiveTransformation,h=tn(Jpt,u);this.alignedSampledElevation=dw(this,this.elevationContext,e.spatialReference,n,i,h),o.shaderTransformation=h;const p=o.geometries[0].transformation,f=Ai(Kle,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this._updateEdgeTransform(s)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const s=r.geometries[0].localOrigin,n=ux(Qpt,ie(CG,s.vec3,-1)),o=Ai(tce,n,e),a=Ai(ice,n,i),l=Is(tce,o),c=Ai(ice,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}_updateEdgeTransform(e){const{stageObject:i,_stageLayer:r}=this;r.stage.renderer.withEdgeView(s=>{s.fastUpdateObject3DEdgesTransform(i)||this.resetEdgeObject(e)})}};const CG=C(),Qle=xe(),Kle=xe(),Jpt=xe(),ece=xe(),tce=xe(),ice=xe(),Qpt=xe();let Kpt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=i.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),i.delete(s),s}const n=new xp(s.parameters);return r.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},r.localOriginFactory)}disable(e,i,r){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(s.add(c),i.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},eft=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){const i=this._byMaterial.get(e)?.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const tft=cs().vec3f(O.POSITION),ift=cs().vec3f(O.POSITION).vec2f(O.UV0),rft=cs().vec3f(O.POSITION).vec4u8(O.COLOR),sft=cs().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);function nft(t){const e=new Pi,{vertex:i,fragment:r}=e;return e.include(Sa,t),e.include(Tx,t),Dl(i,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===V.Highlight&&e.include(Mv,t),e.include(Ks,t),r.uniforms.add(new Ue("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new Ei("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===V.ObjectAndLayerIdColor?x`color.a = 1.0;`:""}

    if (color.a < ${x.float(Ro)}) {
      discard;
    }

    ${t.output===V.Color?x`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===V.Highlight?x`outputHighlight();`:""}
  }
  `),e}const oft=Object.freeze(Object.defineProperty({__proto__:null,build:nft},Symbol.toStringTag,{value:"Module"}));let hAe=class dAe extends Ni{initializeProgram(e){return new Fi(e.rctx,dAe.shader.get().build(this.configuration),di)}initializePipeline(){const e=this.configuration,i=Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Lt({blending:n,depthTest:WJ,depthWrite:o,colorWrite:qt,stencilWrite:e.hasOccludees?ym:null,stencilTest:e.hasOccludees?s?pv:Ov:null});return e.output===V.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,Oc),r(!1,e.transparent?i:null,Oc)):r(!1)}get primitiveType(){return ui.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};hAe.shader=new Oi(oft,()=>ue(()=>import("./NativeLine.glsl-006e0c63.js"),[],import.meta.url));let gS=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};d([B({count:V.COUNT})],gS.prototype,"output",void 0),d([B()],gS.prototype,"hasSlicePlane",void 0),d([B()],gS.prototype,"hasVertexColors",void 0),d([B()],gS.prototype,"transparent",void 0),d([B()],gS.prototype,"hasOccludees",void 0);let EG=class extends Av{constructor(e){super(e,new lft),this._configuration=new gS,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>i===V.Color||i===V.Highlight||i===V.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!pwe(i))return void le.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(O.POSITION).data,l=r.camera,c=uft;ta(c,r.point);const u=2;te(vA[0],c[0]-u,c[1]+u,0),te(vA[1],c[0]+u,c[1]+u,0),te(vA[2],c[0]+u,c[1]-u,0),te(vA[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(vA[_],Zm[_]))return;ba(l.eye,Zm[0],Zm[1],AG),ba(l.eye,Zm[1],Zm[2],MG),ba(l.eye,Zm[2],Zm[3],PG),ba(l.eye,Zm[3],Zm[0],OG);let h=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(gl[0]=a[_]+i[12],gl[1]=a[_+1]+i[13],gl[2]=a[_+2]+i[14],yl[0]=a[_+3]+i[12],yl[1]=a[_+4]+i[13],yl[2]=a[_+5]+i[14],fr(AG,gl)<0&&fr(AG,yl)<0||fr(MG,gl)<0&&fr(MG,yl)<0||fr(PG,gl)<0&&fr(PG,yl)<0||fr(OG,gl)<0&&fr(OG,yl)<0)continue;if(l.projectToRenderScreen(gl,o1),l.projectToRenderScreen(yl,a1),o1[2]<0&&a1[2]>0){_e(Gp,gl,yl);const b=l.frustum,w=-fr(b[ar.NEAR],gl)/pe(Gp,b[ar.NEAR]);ie(Gp,Gp,w),me(gl,gl,Gp),l.projectToRenderScreen(gl,o1)}else if(o1[2]>0&&a1[2]<0){_e(Gp,yl,gl);const b=l.frustum,w=-fr(b[ar.NEAR],yl)/pe(Gp,b[ar.NEAR]);ie(Gp,Gp,w),me(yl,yl,Gp),l.projectToRenderScreen(yl,a1)}else if(o1[2]<0&&a1[2]<0)continue;o1[2]=0,a1[2]=0;const v=pZ(cw(o1,a1,nce),c);v<h&&(h=v,ae(rce,gl),ae(sce,yl),p=_/3)}const f=r.rayBegin,g=r.rayEnd;if(h<u*u){let _=Number.MAX_VALUE;if(r1e(cw(rce,sce,nce),cw(f,g,cft),n1)){_e(n1,n1,f);const v=Se(n1);ie(n1,n1,1/v),_=v/hr(f,g)}o(_,n1,p,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE),c=l?l.data[0]:0,u=s[0],h=s[1],p=((c+1)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],w=u-v,T=h-b,S=a[_+3]-v,A=a[_+4]-b,P=Te((S*w+A*T)/(S*S+A*A),0,1),R=S*P-w,F=A*P-T,k=R*R+F*F;k<f&&(f=k,g=_/3)}f<p*p&&n(o.dist,o.normal,g,!1)}createGLMaterial(e){return new aft(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?rft:tft;return new bE(e)}},aft=class extends Ev{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===V.Color&&this._updateOccludeeState(e),this.ensureTechnique(hAe,e)}},lft=class extends MJ{constructor(){super(...arguments),this.color=wh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const gl=C(),yl=C(),Gp=C(),n1=C(),o1=Jo(),a1=Jo(),rce=C(),sce=C(),nce=Cp(),cft=Cp(),uft=C(),vA=[Jo(),Jo(),Jo(),Jo()],Zm=[C(),C(),C(),C()],AG=Ui(),MG=Ui(),PG=Ui(),OG=Ui(),hft=["mesh"];let dft=class extends Dm{constructor(e,i,r,s){super(e,i,r,s),this._materialInfoCache=new eft,this._fastUpdateProcessor=new Kpt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){wr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new EG({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new EG({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new EG({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,hft,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>i(s)?.layerOpacityChanged(r,this._context.isAsync))}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,dv)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>i(r)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,s){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(s){case Tf.EnableFastUpdates:if(n)return!0;break;case Tf.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,i,r,Tf.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,Tf.DisableFastUpdates)),!0)}const o=this._context.renderCoordsHelper.spatialReference,a=Sft,{origin:l,transform:c}=r;if(!Io(i,te(Dr,l.x,l.y,l.z??0),a,o))return!1;switch(s){case Tf.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case Tf.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case Tf.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(g,_)=>hv(g,h,u,p,_);return e.alignedSampledElevation=dw(e,u,h.spatialReference,f,p,a),e.updateTransform(a,c,this._context.isAsync),e.updateAutoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,Tf.DisableFastUpdates)),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:h,alphaMode:p}=i.material,f=l1(n),g=l1(o),_=wA(a),v=l1(l),b=wA(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${f},ctmuid:${g},cttuid:${_},ntmuid:${v},nttuid:${b},ds:${u},ac:${h},am:${p}`,i.material instanceof N_e){const{metallic:w,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:A,emissiveColor:P,emissiveTexture:R,emissiveTextureTransform:F,occlusionTexture:k,occlusionTextureTransform:N}=i.material,j=l1(S),z=wA(A),X=l1(P),q=l1(R),Z=wA(F),ce=l1(k),I=wA(N);s.metallic=w,s.roughness=T,s.metallicRoughnessTexture=S,s.emissiveColor=P,s.emissiveTexture=R,s.occlusionTexture=k,s.colorTextureTransform=bA(a),s.normalTextureTransform=bA(c),s.emissiveTextureTransform=bA(F),s.occlusionTextureTransform=bA(N),s.metallicRoughnessTextureTransform=bA(A),s.uid=`${s.uid},mrm:${w},mrr:${T},mrt:${j},mrtt:${z},emuid:${X},etmuid:${q},ett:${Z},otmuid:${ce},ott:${I}`}return s}_getInternalTextureId(e){return this._getInternalTexture(e,mr.Opaque)?.id}_getInternalTexture(e,i){const r=wft(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:_ft(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};_O(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==mr.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new fv(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,i){if(e.color!=null&&bft(e.color,i),e.colorTexture!=null){const s=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);s?(i.textureId=s.id,i.textureAlphaPremultiplied=!!s.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=et.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=Ff(e.colorTextureTransform),i.normalTextureTransformMatrix=Ff(e.normalTextureTransform);const r=e.normalTextureTransform?.scale!=null?e.normalTextureTransform?.scale:eU;i.scale=[r[0],r[1]],i.occlusionTextureTransformMatrix=Ff(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=Ff(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=Ff(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(i)e.externalColor=wh;else{const s=this.symbolLayer.material?.color??null;s?e.externalColor=et.toUnitRGBA(s):(r=null,e.externalColor=wh)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,i){const r=i.material?.color,s=i.material?.colorTexture,n=i.material?.alphaMode,o=n==="blend",a=n!=="opaque"&&(vft(e)||r!=null&&r.a<1||s?.transparent||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},h=t2e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:et.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:xs,diffuse:Uf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Er.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=h?[...YJ]:[l.metallic,l.roughness,az[2]],i.material&&(p.doubleSided=i.material.doubleSided,p.cullFace=i.material.doubleSided?Er.None:Er.Back,p.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const f=new xp(p);return u.material=f,this._materialInfoCache.set(l.uid,u),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?mr.MaskBlend:mr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?mr.Opaque:i.alphaMode==="mask"?mr.Mask:mr.Blend}_createFaceDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=i[0].transformation,c=d0(yr(),l);for(let u=0;u<r;u++){const h=i[u].attributes.get(O.POSITION);if(!h)continue;const p=h.data,f=h.indices;for(let g=0;g<f.length;g+=3)xz(p,f,g,Pf),fAe(p,f,g,Dr,hh,KS),me(Dr,Dr,hh),me(Dr,Dr,KS),ie(Dr,Dr,1/3),Ve(Dr,Dr,l),o.push(...Dr),On(Pf,Pf,c),fe(Pf,Pf),hn(Dr,Dr,Pf,n),o.push(...Dr),a.push(a.length),a.push(a.length)}return o.length?new rn(this._debugFaceNormalMaterial,[[O.POSITION,new Ze(o,a,3,!0)]],null,ws.Line):null}_createPerVertexDebugVectors(e,i,r,s,n){const o=i.length,a=e.spatialReference.isGeographic?20015077/180:1,l=.1*n*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),c=[],u=[],h=i[0].transformation,p=d0(yr(),h);r===O.TANGENT&&$u(p,h);for(let f=0;f<o;f++){const g=i[f],_=g.attributes.get(O.POSITION),v=g.attributes.get(r);if(!_||!v)continue;const b=_.data,w=_.indices,T=v.data,S=v.indices;for(let A=0;A<w.length;A++){const P=3*w[A],R=S[A]*v.stride;te(Dr,b[P+0],b[P+1],b[P+2]),Ve(Dr,Dr,h),c.push(...Dr),te(hh,T[R+0],T[R+1],T[R+2]),On(hh,hh,p),fe(hh,hh),hn(Dr,Dr,hh,l),c.push(...Dr),u.push(u.length),u.push(u.length)}}return c.length?new rn(s,[[O.POSITION,new Ze(c,u,3,!0)]],null,ws.Line):null}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;if(wr.DRAW_MESH_GEOMETRY_NORMALS){const v=this._createPerVertexDebugVectors(n,a,O.NORMAL,this._debugVertexNormalMaterial,1),b=this._createPerVertexDebugVectors(n,a,O.TANGENT,this._debugTangentNormalMaterial,.5),w=this._createFaceDebugNormals(n,a);v&&a.push(v),b&&a.push(b),w&&a.push(w)}const c=new Rv({geometries:a,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});c.transformation=l;const u=VSe(this.symbolLayer,{opacity:this._getLayerOpacity()}),h=u?new ist(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new Zpt(this,c,a,null,null,dw,r,h);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=dv(r.mode),p.useObjectOriginAsAttachmentOrigin=!0,p.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:f,renderCoordsHelper:g}=this._context,_=(v,b)=>hv(v,f,r,g,b);return p.alignedSampledElevation=dw(p,r,f.spatialReference,_,g),p}_fastTransformUpdatesAllowed(e){const{vertexSpace:i,spatialReference:r}=e;if(!h0(i))return!1;const{type:s}=i,{view:n}=this._context.graphicsCoreOwner,{viewingMode:o}=n.state,a=n.spatialReference;return o===Ne.Global&&s==="local"||o===Ne.Local&&ls(a,r)&&s==="georeferenced"&&!r.isGeographic}_getCenterPointInElevationSR(e){const i=Tv(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return Sv([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_passthroughReprojectionInfo(e){return e.reprojection===sc.NONE&&!!e.objectTransformation}_createPositionBuffer(e,i){const r=e.vertexAttributes.position;let s=r,n=null;if(i.reprojection===sc.NONE)return{position:s,georeferencedPositionBuffer:n};const o=i.reprojection===sc.RENDER?i.transformBeforeProject:null;o&&(s=yp(new Float64Array(s.length),s,o));const{normal:a,tangent:l}=e.vertexAttributes;this._passthroughReprojectionInfo(i)||!a&&!l||(n=s);const c=s===r||s===n?new Float64Array(s.length):s;return jr(s,e.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,s.length/3),{position:c,georeferencedPositionBuffer:n}}_createNormalBuffer(e,i,r,s){const n=e.vertexAttributes.normal;if(n==null)return null;let o=n;const a=s.reprojection===sc.RENDER?s.transformBeforeProject:null;a&&(o=rR(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===sc.NONE)return o;if(l==="local"){if(!Cw(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return Nq(o,Ca.NORMAL,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return Fq(o,Ca.NORMAL,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return p$(o,r,i,e.spatialReference,c)}_createTangentBuffer(e,i,r,s){const n=e.vertexAttributes.tangent;if(n==null)return null;let o=n;const a=s.reprojection===sc.RENDER?s.transformBeforeProject:null;a&&(o=sR(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===sc.NONE)return o;if(l==="local"){if(!Cw(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return Nq(o,Ca.TANGENT,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return Fq(o,Ca.TANGENT,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return f$(o,r,i,e.spatialReference,c)}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=pst(this.symbolLayer?.material?.colorMixMode),s=new Uint8Array(4);return zSe(i,r,s),s}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),{position:l,georeferencedPositionBuffer:c}=this._createPositionBuffer(e,a),u=xft(e),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(e,l,c,a),f=this._createTangentBuffer(e,l,c,a),g=n,{transformation:_,position:v,normal:b,tangent:w}=this._passthroughReprojectionInfo(a)?{transformation:a.objectTransformation,position:l,normal:p,tangent:f}:this._transformOriginLocal(e,l,p,f);return{positionBuffer:v,normalBuffer:b,tangentBuffer:w,uvBuffer:g,colorBuffer:u,symbolColorBuffer:h,objectTransformation:_,geometryTransformation:a.reprojection===sc.NONE&&a.geometryTransformation?a.geometryTransformation:xe()}}_computeReprojectionInfo(e){const{vertexSpace:i}=e,r=i.type==="georeferenced"?ls(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?sc.NONE:sc.RENDER:sc.NONE;if(pGe(i))return{reprojection:r};const s=i.origin,n=xe(),o=e.transform?.localMatrix??Cr;if(r===sc.NONE)return Io(e.spatialReference,s,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:pC(o)};const a=ux(xe(),s);return Ai(a,a,o),{reprojection:r,transformBeforeProject:a}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;aL[0]=o.x,aL[1]=o.y,aL[2]=o.z??0;const a=xe();Io(e.spatialReference,aL,a,n),Is(lL,a);const{position:l,normal:c,tangent:u}=e.vertexAttributes,h=i===l?new Float64Array(i.length):i;yp(h,i,lL);const p=r?r===c?new Float32Array(r.length):r:null,f=s?s===u?new Float32Array(s.length):s:null;return r&&p&&rR(r,p,lL),s&&f&&sR(s,f,lL),{transformation:a,position:h,normal:p,tangent:f}}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes?.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,s=sZ({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Ne.Local});if(!s)return!1;const n=s.length/3;return Or($G),Tc($G,s,0,n),!Wd($G,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Vl(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:h,geometryTransformation:p}=s,f=yft(e),g=new Array;let _=!1;const v=oC(Dr,h),b=this._context.localOriginFactory.getOrigin(v);for(const w of f){if(!this._validateFaces(e,w))return null;const T=pft(e,w);if(T.length===0)continue;const S=fft(n,c,w,T);S.didFlipNormals&&(_=!0);const A=[[O.POSITION,new Ze(n,T,3,!0)],[O.NORMAL,new Ze(S.normals,S.indices,3,!0)]];a&&A.push([O.COLOR,new Ze(a,T,4,!0)]),l&&A.push([O.SYMBOLCOLOR,new Ze(l,wv(T.length),4,!0)]),o&&A.push([O.UV0,new Ze(o,T,2,!0)]),u&&A.push([O.TANGENT,new Ze(u,T,4,!0)]);const P=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),R=this._getOrCreateMaterial(e,w),F=new rn(R,A,null,ws.Mesh,P);F.transformation=p,F.localOrigin=b,g.push(F)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:h}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:i}}}}}=this,{vertexSpace:r}=e;return i!==Ne.Local||r.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},OQ=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};function pft(t,e){return e.faces??px(t.vertexAttributes.position.length/3)}function fft(t,e,i,r){switch(i.shading||"flat"){default:case"source":return mft(t,e,i,r);case"flat":return pAe(t,r);case"smooth":return gft(t,r)}}function pAe(t,e){const i=os(e.length),r=new Array(3*e.length);for(let s=0;s<e.length;s+=3){const n=xz(t,e,s,Pf);for(let o=0;o<3;o++)i[s+o]=n[o],r[s+o]=s/3}return new OQ(i,r,!1)}function mft(t,e,i,r){if(e==null)return pAe(t,r);let s=!1;if(!i.trustSourceNormals)for(let n=0;n<r.length;n+=3){xz(t,r,n,Pf);for(let o=0;o<3;o++){const a=3*r[n+o];Dr[0]=e[a],Dr[1]=e[a+1],Dr[2]=e[a+2],pe(Pf,Dr)<0&&(e[a]=-e[a],e[a+1]=-e[a+1],e[a+2]=-e[a+2],s=!0)}}return new OQ(e,r,s)}function gft(t,e){const i={};for(let n=0;n<e.length;n+=3){const o=xz(t,e,n,Pf);for(let a=0;a<3;a++){const l=e[n+a];let c=i[l];c||(c={normal:C(),count:0},i[l]=c),me(c.normal,c.normal,o),c.count++}}const r=os(3*e.length),s=new Array(3*e.length);for(let n=0;n<e.length;n++){const o=i[e[n]];o.count!==1&&(fe(o.normal,o.normal),o.count=1);for(let a=0;a<3;a++)r[3*n+a]=o.normal[a];s[n]=n}return new OQ(r,s,!1)}function fAe(t,e,i,r,s,n){const o=3*e[i],a=3*e[i+1],l=3*e[i+2];r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2]}function xz(t,e,i,r){return fAe(t,e,i,Dr,hh,KS),_e(hh,hh,Dr),_e(KS,KS,Dr),Ke(Dr,hh,KS),fe(r,Dr),r}function yft(t){return t.components??Cft}function bA(t){if(!t)return null;const{scale:e,offset:i,rotation:r}=t;return{scale:e,offset:i,rotation:xt(r)}}function _ft(t="repeat"){if(typeof t=="string"){const e=RG(t);return{s:e,t:e}}return{s:RG(t.horizontal),t:RG(t.vertical)}}function RG(t){switch(t){case"clamp":return hi.CLAMP_TO_EDGE;case"mirror":return hi.MIRRORED_REPEAT;default:return hi.REPEAT}}function vft(t){const e=t.vertexAttributes.color;if(e==null)return!1;for(let i=3;i<e.length;i+=4)if(e[i]!==255)return!0;return!1}function bft(t,e){e.diffuse=et.toUnitRGB(t),e.opacity=t.a}function wft(t){return t.data??t.url}function l1(t){return t==null?"-":t instanceof et?t.toHex():t.contentHash}function wA(t){const{offset:e,scale:i,rotation:r}=t??Tft;return`${e[0]},${e[1]},${r},${i[0]},${i[1]}`}function xft(t){return t.vertexAttributes.color}const Tft=new _2,aL=C(),Dr=C(),hh=C(),KS=C(),Pf=C(),lL=xe(),Sft=xe(),$G=pn(),Cft=[new zw];var sc;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(sc||(sc={}));let Eft=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){sz(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>hv(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,jp),Ve(e,this._lodRenderer.baseBoundingSphere.center,jp)}getBoundingBoxObjectSpace(e=pn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,jp);const i=this._lodRenderer.baseBoundingBox;Or(e);for(let r=0;r<8;++r)te(Bu,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),Ve(Bu,Bu,jp),pp(e,Bu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,jp),e.render.origin[0]+=jp[12],e.render.origin[1]+=jp[13],e.render.origin[2]+=jp[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Aft,l=sX(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,jp);for(let u=0;u<l;u++){const h=a[u];Bu[0]=o[h[0]],Bu[1]=o[h[1]],Bu[2]=o[h[2]],Ve(Bu,Bu,jp),c1[3*u]=Bu[0],c1[3*u+1]=Bu[1],c1[3*u+2]=Bu[2]}if(!e(c1,0,l))return null;Or(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],c1[u+h]),o[h+3]=Math.max(o[h+3],c1[u+h]);c&&r.push({location:c1.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(qd(o,IG),this.elevationContext.mode!=="absolute-height")){let u;const h=kJ(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(IG[0],IG[1],s,h,"ground")}catch{}u!=null&&f0e(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===_0.Highlight){const r=new V4(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const c1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Bu=C(),IG=C(),Aft=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],jp=xe();function Mft(t,e){const i=t.stageResources.geometries.map(s=>new DSe(s,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?Oft(i):t.lodThreshold;return new NSe(i,r,t.pivotOffset)}function Pft(t){return new FSe(t.map((e,i)=>Mft(e,i)))}function Oft(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*Rft/Math.PI)}const Rft=20;function $ft(t){return t=t||globalThis.location.hostname,Ift.some(e=>t?.match(e)!=null)}function X7(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(mAe)!=null||e.match(yAe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(gAe)!=null||e.match(_Ae)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const mAe=/^devext\.arcgis\.com$/,gAe=/^qaext\.arcgis\.com$/,yAe=/^[\w-]*\.mapsdevext\.arcgis\.com$/,_Ae=/^[\w-]*\.mapsqa\.arcgis\.com$/,Ift=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,mAe,gAe,/^jsapps\.esri\.com$/,yAe,_Ae];function Lft(t,e){RQ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function RQ(t,e,i=2,r=i){const s=e.length/2;let n=0,o=0;if(am(e)||GRe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=i,o+=r;return}const a=jRe(e);if(VRe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=i,o+=r;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=i,o+=r}function Dft(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=r?.count??t.count;let a=(r?.dstIndex??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:Dft,normalizeIntegerBuffer:RQ,normalizeIntegerBufferView:Lft},Symbol.toStringTag,{value:"Module"}));function Nft(t,e){Tz(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Tz(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function Fft(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:Tz,copyView:Nft,fill:Fft},Symbol.toStringTag,{value:"Module"}));function kft(t,e){$Q(t.typedBuffer,e,t.typedBufferStride)}function $Q(t,e,i=4){const r=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=s}function Uft(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=n?.count??t.count;let c=(n?.dstIndex??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:$Q,copyView:kft,fill:Uft},Symbol.toStringTag,{value:"Module"}));let vAe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return bm(e)?(yt(i),dY(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Yi(i,{responseType:zft[e]})).data;const s=await fp(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw a0(s.error),new W("",`Request for resource failed: ${s.error}`)}};const zft={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Bft(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function Vft(t,e={}){return{data:t,parameters:{wrap:{s:hi.REPEAT,t:hi.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function LN(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:LN},Symbol.toStringTag,{value:"Module"}));let oce=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var vO,ace;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(vO||(vO={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(ace||(ace={}));const bAe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Gft={pbrMetallicRoughness:bAe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},jft={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},lce=(t={})=>{const e={...bAe,...t.pbrMetallicRoughness},i=Hft({...jft,...t.extras});return{...Gft,...t,pbrMetallicRoughness:e,extras:i}};function Hft(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const qft={magFilter:Zt.LINEAR,minFilter:Zt.LINEAR_MIPMAP_LINEAR,wrapS:hi.REPEAT,wrapT:hi.REPEAT},Wft=t=>({...qft,...t});function Yft(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const cL={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Xft=class Wy{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=Yft(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new W("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new W("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new W("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(bm(i)){const o=j_(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Wy(e,i,l)}catch{}const a=dY(i);if(Wy._isGLBData(a))return this._fromGLBData(e,i,a)}if(tmt.test(i)||r?.expectedType==="gltf"){const o=await e.loadJSON(i,r);return new Wy(e,i,o)}const s=await e.loadBinary(i,r);if(Wy._isGLBData(s))return this._fromGLBData(e,i,s);if(imt.test(i)||r?.expectedType==="glb")throw new W("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(i,r);return new Wy(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new oce(e);return i.remainingBytes()>=4&&i.readUint32()===cL.MAGIC}static async _fromGLBData(e,i,r){const s=await Wy._parseGLBData(r);return new Wy(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new oce(e);if(i.remainingBytes()<12)throw new W("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==cL.MAGIC)throw new W("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new W("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new W("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==cL.CHUNK_TYPE_JSON)throw new W("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new W("gltf-loader-error","No JSON data found.");o=await Wpt(i.readUint8Array(c))}else if(l===1){if(u!==cL.CHUNK_TYPE_BIN)throw new W("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else le.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new W("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new W("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new W("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new W("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(r?.bufferView==null)throw new W("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[vO.MAT2,vO.MAT3,vO.MAT4])throw new W("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=Qft[r.type],a=Kft[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case dt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case dt.UNSIGNED_BYTE:return LN(Vu(_C,r));case dt.UNSIGNED_SHORT:return LN(Vu(cU,r));case dt.UNSIGNED_INT:return LN(Vu(hU,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new W("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==dt.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+dt[r.componentType]);if(r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return Vu(Xn,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new W("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==dt.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+dt[r.componentType]);if(r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return Vu(Xn,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new W("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==dt.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+dt[r.componentType]);if(r.componentCount!==4)throw new W("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new gp(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new W("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new W("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===dt.FLOAT)return Vu(gx,r);if(!r.normalized)throw new W("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return emt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new W("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===dt.FLOAT)return Vu(gp,r);if(r.componentType===dt.UNSIGNED_BYTE)return Vu(Ma,r);if(r.componentType===dt.UNSIGNED_SHORT)return Vu(h$,r)}else if(r.componentCount===3){if(r.componentType===dt.FLOAT)return Vu(Xn,r);if(r.componentType===dt.UNSIGNED_BYTE)return Vu(lU,r);if(r.componentType===dt.UNSIGNED_SHORT)return Vu(uU,r)}throw new W("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+dt[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const n=e.material!=null?lce(this.json.materials[e.material]):lce(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),u=r?this.getTexture(n.occlusionTexture,i):void 0,h=r?this.getTexture(n.emissiveTexture,i):void 0,p=r?this.getTexture(o.metallicRoughnessTexture,i):void 0,f=e.material!=null?e.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:f,occlusionTexture:await u,emissiveTexture:await h,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await p,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:n.extras.ESRI_receiveAmbientOcclusion,receiveShadows:n.extras.ESRI_receiveShadows}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new W("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=Wft(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=cce(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return ZW(this._textureCache,r,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>{throw new W("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${h}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return Zft;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=Ai(xe(),r,s.matrix):s.translation||s.rotation||s.scale?(i=pC(r),s.translation&&Aa(i,i,s.translation),s.rotation&&(uL[3]=Qk(uL,s.rotation),Sc(i,i,uL[3],uL)),s.scale&&E0(i,i,s.scale)):i=pC(r),this._nodeTransformCache.set(e,i)}return i}_resolveUri(e){return Ja(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=s$.parse(this.json.asset.version,"glTF");Jft.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new W("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,i){const r=cce(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new uAe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new W("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new W("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new W("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return Ypt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await bF(Array.from(this._bufferLoaders.values())),i=await bF(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+(s?.byteLength??0),0)+i.reduce((r,s)=>r+(s?_O(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const Zft=Y0e(xe(),Math.PI/2),Jft=new s$(2,0,"glTF"),uL=Gl(),Qft={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kft={[dt.BYTE]:1,[dt.UNSIGNED_BYTE]:1,[dt.SHORT]:2,[dt.UNSIGNED_SHORT]:2,[dt.HALF_FLOAT]:2,[dt.FLOAT]:4,[dt.INT]:4,[dt.UNSIGNED_INT]:4};function emt(t){switch(t.componentType){case dt.BYTE:return new dU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case dt.UNSIGNED_BYTE:return new aU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case dt.SHORT:return new d$(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case dt.UNSIGNED_SHORT:return new tZ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case dt.UNSIGNED_INT:return new iZ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case dt.FLOAT:return new gx(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}function Vu(t,e){return new t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*(e.entryCount-1)+e.componentByteSize*e.componentCount)}function cce(t){if(t.extensions?.KHR_texture_basisu!=null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new W("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const tmt=/\.gltf$/i,imt=/\.glb$/i;let rmt=0;async function wAe(t,e,i={},r=!0){const s=await Xft.load(t,e,i),n="gltf_"+rmt++,o={lods:[],materials:new Map,textures:new Map,meta:smt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=s.json.asset.extras?.ESRI_webstyleSymbol?.webstyle,c=new Map;await nmt(s,async(h,p,f,g)=>{const _=c.get(f)??0;c.set(f,_+1);const v=h.mode!==void 0?h.mode:ui.TRIANGLES,b=v===ui.TRIANGLES||v===ui.TRIANGLE_STRIP||v===ui.TRIANGLE_FAN?v:null;if(b==null)return void le.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+ui[v]+"). Skipping primitive.");if(!s.hasPositions(h))return void le.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,i),T=s.getMaterial(h,i,r),S=s.hasNormals(h)?s.getNormalData(h,i):null,A=s.hasTangents(h)?s.getTangentData(h,i):null,P=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,i):null,R=s.hasVertexColors(h)?s.getVertexColors(h,i):null,F=s.getIndexData(h,i),k={name:g,transform:pC(p),attributes:{position:await w,normal:S?await S:null,texCoord0:P?await P:null,color:R?await R:null,tangent:A?await A:null},indices:await F,primitiveType:b,material:amt(o,await T,n)};let N=null;o.meta?.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(N=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:g,lodThreshold:N},o.lods[f].parts[_]=k});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const u=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri,ESRI_webstyle:l},customMeta:{},size:u}}function smt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function nmt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),omt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&le.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const h=i.meshes[c.mesh];for(const p of h.primitives)n.push(e(p,u,l,h.name))}for(const h of c.children||[])n.push(o(h,l))}await Promise.all(n)}function omt(t){return t.extensions?.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function amt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n?.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=Vft(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:lmt.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=Bft({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(s,n)}return s}const lmt=new Set([Zt.LINEAR_MIPMAP_LINEAR,Zt.LINEAR_MIPMAP_NEAREST]);function cmt(t,e){switch(e){case ui.TRIANGLES:return umt(t);case ui.TRIANGLE_STRIP:return hmt(t);case ui.TRIANGLE_FAN:return dmt(t)}}function umt(t){return typeof t=="number"?px(t):v_(t)?new Uint16Array(t):t}function hmt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=p4(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=t[n],r[s++]=t[n+1],r[s++]=t[n+2]):(r[s++]=t[n+1],r[s++]=t[n],r[s++]=t[n+2])}return r}function dmt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}let pmt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},fmt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new pmt,this.numberOfVertices=0}};const _g=()=>le.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function xAe(t,e){const i=await mmt(t,e),r=await bmt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o?.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+Ude(i)}}async function mmt(t,e){const i=e?.streamDataRequester;if(i)return gmt(t,i,e);const r=await fp(Yi(t,e));if(r.ok===!0)return r.value.data;a0(r.error),TAe(r.error)}async function gmt(t,e,i){const r=await fp(e.request(t,"json",i));if(r.ok===!0)return r.value;a0(r.error),TAe(r.error.details.url)}function TAe(t){throw new W("",`Request for object resource failed: ${t}`)}function ymt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(_g().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a?.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(_g().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(_g().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(_g().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else _g().warn("Indexed geometries must specify faces"),r=!1;break}default:_g().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(_g().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(_g().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function _mt(t,e){const i=new Array,r=new Array,s=new Array,n=new uv,o=t.resource,a=s$.parse(o.version||"1.0","wosr");xmt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},h=t.textures;let p=0;const f=new Map;for(let g=0;g<c.length;g++){const _=c[g];if(!ymt(_))continue;const v=wmt(_),b=_.params.vertexAttributes,w=[],T=X=>{if(_.params.topology==="PerAttributeArray")return null;const q=_.params.faces;for(const Z in q)if(Z===X)return q[Z].values;return null},S=b[O.POSITION],A=S.values.length/S.valuesPerElement;for(const X in b){const q=b[X],Z=q.values,ce=T(X)??px(A);w.push([X,new Ze(Z,ce,q.valuesPerElement,!0)])}const P=v.texture,R=h&&h[P];if(R&&!f.has(P)){const{image:X,parameters:q}=R,Z=new fv(X,q);r.push(Z),f.set(P,Z)}const F=f.get(P),k=F?F.id:void 0,N=v.material;let j=n.get(N,P);if(j==null){const X=u[N.substring(N.lastIndexOf("/")+1)].params;X.transparency===1&&(X.transparency=0);const q=R&&R.alphaChannelUsage,Z=X.transparency>0||q==="transparency"||q==="maskAndTransparency",ce=R?SAe(R.alphaChannelUsage):void 0,I={ambient:ya(X.diffuse),diffuse:ya(X.diffuse),opacity:1-(X.transparency||0),transparent:Z,textureAlphaMode:ce,textureAlphaCutoff:.33,textureId:k,initTextureTransparent:!0,doubleSided:!0,cullFace:Er.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:R?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(I,e.materialParameters),j=new xp(I),n.set(N,P,j)}s.push(j);const z=new rn(j,w);p+=w.find(X=>X[0]===O.POSITION)?.[1]?.indices.length??0,i.push(z)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:vmt(i)}}function vmt(t){const e=Or();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(pp(e,r.bbMin),pp(e,r.bbMax))}),e}async function bmt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){_g().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:hi.REPEAT,t:hi.REPEAT},preMultiplyAlpha:SAe(u)!==mr.Opaque},p=e?.disableTextures?Promise.resolve(null):w0(l,e);i.push(p.then(f=>({refId:c,image:f,parameters:h,alphaChannelUsage:u})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function SAe(t){switch(t){case"mask":return mr.Mask;case"maskAndTransparency":return mr.MaskBlend;case"none":return mr.Opaque;default:return mr.Blend}}function wmt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const xmt=new s$(1,2,"wosr"),uT=2.1;async function CAe(t,e){const i=EAe(X7(t));if(i.fileType==="wosr"){const h=await(e.cache?e.cache.loadWOSR(i.url,e):xAe(i.url,e)),{engineResources:p,referenceBoundingBox:f}=_mt(h,e);return{lods:p,referenceBoundingBox:f,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):wAe(new vAe(e.streamDataRequester),i.url,e,e.usePBR)),s=r.model.meta?.ESRI_proxyEllipsoid,n=r.meta.isEsriSymbolResource&&s!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Emt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Bst]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...az]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=AAe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function EAe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function AAe(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Or();return s.lods.forEach((u,h)=>{const p=r.skipHighLods===!0&&(l>1&&h===0||l>3&&h===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&h!==r.singleLodIndex;if(p&&h!==0)return;const f=new fmt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const _=p?new xp({}):Tmt(s,g,f,e,i,o,a),{geometry:v,vertexCount:b}=Smt(g,_??new xp({})),w=v.boundingInfo;w!=null&&h===0&&(pp(c,w.bbMin),pp(c,w.bbMax)),_!=null&&(f.stageResources.geometries.push(v),f.numberOfVertices+=b)}),p||n.push(f)}),{engineResources:n,referenceBoundingBox:c}}function Tmt(t,e,i,r,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const h=Cmt(l.alphaMode);if(!n.has(a)){if(c){const P=(R,F=!1)=>{if(R!=null&&!o.has(R)){const k=t.textures.get(R);if(k!=null){const N=k.data;o.set(R,new fv(_O(N)?N.data:N,{...k.parameters,preMultiplyAlpha:!_O(N)&&F,encoding:_O(N)&&N.encoding!=null?N.encoding:void 0}))}}};P(l.textureColor,h!==mr.Opaque),P(l.textureNormal),P(l.textureOcclusion),P(l.textureEmissive),P(l.textureMetallicRoughness)}const f=l.color[0]**(1/uT),g=l.color[1]**(1/uT),_=l.color[2]**(1/uT),v=l.emissiveFactor[0]**(1/uT),b=l.emissiveFactor[1]**(1/uT),w=l.emissiveFactor[2]**(1/uT),T=l.textureColor!=null&&c?o.get(l.textureColor):null,S=t2e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),A=l.normalTextureTransform?.scale!=null?l.normalTextureTransform?.scale:eU;n.set(a,new xp({...r,transparent:h===mr.Blend,customDepthTest:Gw.Lequal,textureAlphaMode:h,textureAlphaCutoff:l.alphaCutoff,diffuse:[f,g,_],ambient:[f,g,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Er.None:Er.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?zi.Attribute:zi.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:T?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:T!=null&&!!T.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,b,w],mrrFactors:S?[...YJ]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:Ff(l.colorTextureTransform),normalTextureTransformMatrix:Ff(l.normalTextureTransform),scale:[A[0],A[1]],occlusionTextureTransformMatrix:Ff(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Ff(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Ff(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(i.stageResources.materials.push(p),c){const f=g=>{g!=null&&i.stageResources.textures.push(o.get(g))};f(l.textureColor),f(l.textureNormal),f(l.textureOcclusion),f(l.textureEmissive),f(l.textureMetallicRoughness)}return p}function Smt(t,e){const i=t.attributes.position.count,r=cmt(t.indices||i,t.primitiveType),s=os(3*i),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;yp(s,n,t.transform,3,o);const a=[[O.POSITION,new Ze(s,r,3,!0)]];if(t.attributes.normal!=null){const c=os(3*i),{typedBuffer:u,typedBufferStride:h}=t.attributes.normal;d0(hT,t.transform),uE(c,u,hT,3,h),zF(hT)&&bC(c,c),a.push([O.NORMAL,new Ze(c,r,3,!0)])}if(t.attributes.tangent!=null){const c=os(4*i),{typedBuffer:u,typedBufferStride:h}=t.attributes.tangent;$u(hT,t.transform),pU(c,u,hT,4,h),zF(hT)&&bC(c,c,4),a.push([O.TANGENT,new Ze(c,r,4,!0)])}if(t.attributes.texCoord0!=null){const c=os(2*i),{typedBuffer:u,typedBufferStride:h}=t.attributes.texCoord0;RQ(c,u,2,h),a.push([O.UV0,new Ze(c,r,2,!0)])}const l=t.attributes.color;if(l!=null){const c=new Uint8Array(4*i);l.elementCount===4?l instanceof gp?y4(c,l,255):l instanceof Ma?$Q(c,l):l instanceof h$&&y4(c,l,1/256):(c.fill(255),l instanceof Xn?g4(c,l.typedBuffer,255,4,l.typedBufferStride):t.attributes.color instanceof lU?Tz(c,l.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof uU&&g4(c,l.typedBuffer,1/256,4,l.typedBufferStride)),a.push([O.COLOR,new Ze(c,r,4,!0)])}return{geometry:new rn(e,a),vertexCount:i}}const hT=yr();function Cmt(t){switch(t){case"BLEND":return mr.Blend;case"MASK":return mr.Mask;case"OPAQUE":case null:case void 0:return mr.Opaque}}function Emt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=C(),c=C(),u=C(),h=new Uint8Array(4*a),p=new Float64Array(3*a),f=Is(xe(),s.transform);let g=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),Ve(c,c,s.transform),_e(u,c,e.center),FF(u,u,e.radius);const b=u[2],w=Se(u),T=Math.min(.45+.55*w*w,1);FF(u,u,e.radius),f!==null&&Ve(u,u,f),fe(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&or(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],g+=3,h[_]=255*T,h[_+1]=255*T,h[_+2]=255*T,h[_+3]=255,_+=4}s.attributes.normal=new Xn(p),s.attributes.color=new Ma(h)}}}const Wzt=Object.freeze(Object.defineProperty({__proto__:null,fetch:CAe,gltfToEngineResources:AAe,parseUrl:EAe},Symbol.toStringTag,{value:"Module"})),Amt=()=>!!se("enable-feature:force-wosr"),Yzt=()=>!!se("enable-feature:direct-3d-object-feature-layer-display"),Mmt=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),Pmt=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),Xzt=()=>!!se("enable-i3s-patching"),Omt=()=>se.add("enable-i3s-patching",!0,!0,!0),Rmt=()=>se.add("enable-i3s-patching",!1,!0,!0),Zzt=()=>!!se("enable-feature:SceneLayer-editing"),$mt=(t="i3s-patching")=>{switch(Rmt(),Pmt(),se.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Mmt();break;case"i3s-patching":Omt()}};$mt("i3s-patching");let LG={};async function Imt(t,e){try{return{data:(await IQ(t,e)).data,baseUrl:ck(t),styleUrl:t}}catch(i){return a0(i),null}}function Lmt(t,e,i){const r=e.portal!=null?e.portal:Ea.getDefault();let s;const n=`${r.url} - ${r.user?.username} - ${t}`;return LG[n]||(LG[n]=Dmt(t,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),LG[n]}function Dmt(t,e,i){return e.load(i).then(()=>{const r=new Of({disableExtraQuery:!0,query:`owner:${uce} AND type:${hce} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===hce&&o.owner===uce){s=o;break}}if(!s)throw new W("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function MAe(t,e,i){return t?.styleUrl!=null?Imt(t.styleUrl,i):t?.styleName!=null?Lmt(t.styleName,e,i):Promise.reject(new W("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function PAe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function OAe(t,e,i=["gltf"]){if(e==="cimRef")return encodeURI(t.cimRef);if(t.formatInfos&&!Amt())for(const r of i){const s=t.formatInfos.find(n=>n.type===r);if(s)return s.href}return encodeURI(t.webRef)}function IQ(t,e){const i={responseType:"json",query:{f:"json"},...e};return Yi(ip(t),i)}const uce="esri_en",hce="Style",Nmt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",Fmt=zf.fromSimpleMarkerSymbol(VEe),kmt=ax.fromSimpleLineSymbol(AQ),Umt=lx.fromSimpleFillSymbol(GEe),zmt=new sE({symbolLayers:new lt([new _v({material:{color:EQ},edges:new s0e({size:No(1),color:new et(udt)})})])}),Bmt=new ax({symbolLayers:new lt([new iE({material:{color:new et([0,0,0])},size:No(1)})])}),Vmt=new lx({symbolLayers:new lt([new _v({outline:{color:new et([0,0,0]),size:No(1)}})])});function Jzt(t){if(t==null)return null;switch(t.type){case"mesh":return zmt;case"point":case"multipoint":return Fmt;case"polyline":return kmt;case"polygon":case"extent":return Umt}return null}const dT={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Gmt(t,e=dT){if(!t)return{symbol:null};const{retainId:i=dT.retainId,ignoreDrivers:r=dT.ignoreDrivers,hasLabelingContext:s=dT.hasLabelingContext,retainCIM:n=dT.retainCIM,cimFallbackEnabled:o=dT.cimFallbackEnabled}=e;let a=null;if(Nw(t)||t instanceof aE)a=t.clone();else if(t.type==="cim"){const l=t.data?.symbol?.type;switch(l){case"CIMPointSymbol":a=n?t.clone():zf.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=Bmt.clone(),e?.logWarning?.("Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=Vmt.clone(),e?.logWarning?.("Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new W("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${l||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof xm)a=ax.fromSimpleLineSymbol(t);else if(t instanceof cx)a=zf.fromSimpleMarkerSymbol(t);else if(t instanceof t$)a=zf.fromPictureMarkerSymbol(t);else if(t instanceof nE)a=e.geometryType&&e.geometryType==="mesh"?sE.fromSimpleFillSymbol(t):lx.fromSimpleFillSymbol(t);else{if(!(t instanceof oE))return{error:new W("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?Dk.fromTextSymbol(t):zf.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&Nw(a)&&a.symbolLayers.forEach(l=>l.ignoreDrivers=!0),{symbol:a}}function Qzt(t,e,i,r){const s=RAe(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function Kzt(t,e,i,r){const s=RAe(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function dce(t){return t instanceof rE||t instanceof aE}function RAe(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r?.origin,o=r?.messages;if(n==="web-scene"&&!dce(t)){const a=Gmt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,r):(o?.push(new W("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!Xke(r?.layer))&&dce(t)?(o?.push(new W("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function $Ae(t,e){return Fke(t,null,e)}function jmt(t,e,i,r){const s=t.name;return s==null?Promise.reject(new W("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Hmt(s,e,r):MAe(t,e,r).then(n=>DQ(n,s,e,i,OAe,r))}function LQ(t,e){return e.items.find(i=>i.name===t)}function DQ(t,e,i,r,s,n){const o=i?.portal!=null?i.portal:Ea.getDefault(),a={portal:o,url:Hs(t.baseUrl),origin:"portal-item"},l=LQ(e,t.data);if(!l){const f=`The symbol name '${e}' could not be found`;return Promise.reject(new W("symbolstyleutils:symbol-name-not-found",f,{symbolName:e}))}let c=Lw(s(l,r),a),u=l.thumbnail?.href??null;const h=l.thumbnail?.imageData;$ft()&&(c=X7(c)??"",u=X7(u));const p={portal:o,url:Hs(ck(c)),origin:"portal-item"};return IQ(c,n).then(f=>{const g=r==="cimRef"?PAe(f.data):f.data,_=$Ae(g,p);if(_&&Nw(_)){if(u){const v=Lw(u,a);_.thumbnail=new ew({url:v})}else h&&(_.thumbnail=new ew({url:`data:image/png;base64,${h}`}));t.styleUrl?_.styleOrigin=new GO({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new GO({portal:i.portal,styleName:t.styleName,name:e}))}return _})}function Hmt(t,e,i){const r=Nmt.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Ea.getDefault();return IQ(r,i).then(n=>{const o=PAe(n.data);return $Ae(o,{portal:s,url:Hs(ck(r)),origin:"portal-item"})})}const qmt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:DQ,getStyleItemFromStyle:LQ,resolveWebStyleSymbol:jmt},Symbol.toStringTag,{value:"Module"}));async function Wmt(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new W("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await MAe(t,i).catch(()=>null);if(r===null)return null;const s=LQ(e,r.data);if(s&&!s.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const n=await DQ(r,e,i,"webRef",(a,l)=>OAe(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Ymt=class{constructor(e,i,r){this._elementSize=i,this._buffer=lr.createVertex(e,Hi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},Xmt=class{constructor(e){this.modelOriginHi=e.getField(O.INSTANCEMODELORIGINHI,Xn),this.modelOriginLo=e.getField(O.INSTANCEMODELORIGINLO,Xn),this.model=e.getField(O.INSTANCEMODEL,rv),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,rv),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,gp),this.color=e.getField(O.INSTANCECOLOR,Ma),this.objectAndLayerIdColor=e.getField(O.INSTANCEOBJECTANDLAYERIDCOLOR,Ma)}},pce=class{constructor(e,i){this._rctx=e,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){at(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){at(this._updating,"not updating"),this.size<LRe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){at(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),at(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){at(this._updating,"not updating"),at(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max($5,Math.floor(this._capacity*Z5));this._resize(e)}_shrink(){const e=Math.max($5,Math.floor(this._capacity*IRe));this._resize(e)}_resize(e){if(at(this._updating,"not updating"),e===this._capacity)return;const i=new Ymt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);at(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new Xmt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const $5=64;var Br;function Zmt(t){let e=cs().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes(O.FEATUREATTRIBUTE)&&(e=e.vec4f(O.FEATUREATTRIBUTE)),t.includes(O.COLOR)&&(e=e.vec4u8(O.COLOR)),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e=e.u8(O.STATE).u8(O.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Br||(Br={}));let fce=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,iR),this.globalTransform=e.getField(O.GLOBALTRANSFORM,iR),this.modelOrigin=e.getField(O.MODELORIGIN,Lh),this.model=e.getField(O.INSTANCEMODEL,rv),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,rv),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,gx),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,oU),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,gp),this.color=e.getField(O.COLOR,Ma),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,Ma),this.state=e.getField(O.STATE,_C),this.lodLevel=e.getField(O.LODLEVEL,_C)}},yS=class extends Pe{constructor(e,i){super(e),this.events=new Ls,this._capacity=0,this._size=0,this._next=0,this._layout=Zmt(i),this._capacity=$5,this._buffer=this._layout.createBuffer(this._capacity),this._view=new fce(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Br.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;at(e>=0&&e<this._capacity&&!!(i.get(e)&Br.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,Br.ACTIVE)?this._setStateFlags(e,Br.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;at(e>=0&&e<this._capacity&&!!(i.get(e)&Br.ALLOCATED),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Yl,s=ed;i.localTransform.getMat(e,mce),i.globalTransform.getMat(e,DG);const n=Ai(DG,DG,mce);te(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),$u(s,n),i.model.setMat(e,s);const o=TGe(Yl,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),c$(s,s),mx(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,Br.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,ed),r.modelOrigin.getVec(e,Yl),i[0]=ed[0],i[1]=ed[1],i[2]=ed[2],i[3]=0,i[4]=ed[3],i[5]=ed[4],i[6]=ed[5],i[7]=0,i[8]=ed[6],i[9]=ed[7],i[10]=ed[8],i[11]=0,i[12]=Yl[0],i[13]=Yl[1],i[14]=Yl[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Yl,this,e),i*=Math.max(Yl[0],Yl[1],Yl[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Yl,this,e),i*=Jmt(Yl[0],Yl[1],Yl[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Br.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Br.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Br.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Br.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max($5,Math.floor(this._capacity*Z5)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new fce(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Br.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function Jmt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}d([m({constructOnly:!0})],yS.prototype,"shaderTransformation",void 0),d([m()],yS.prototype,"_size",void 0),d([m({readOnly:!0})],yS.prototype,"size",null),yS=d([U("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],yS);const Yl=C(),ed=yr(),mce=xe(),DG=xe();let Qmt=class extends Zd{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=Ws(),this._tmpMat4=xe()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Ve(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*mC(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Kmt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},egt=class extends g${constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function NQ(t){return Uh(t)&&t.intersector===Fr.LOD&&!!t.target}let tgt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materials=e.materials,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new zCe(s.material,this._materials),this.vertexBufferLayout=o,this.vbo=lr.createVertex(r,Hi.STATIC_DRAW,l.buffer),this.vao=new Pm(r,di,{geometry:Lc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(u,h,p,f,g)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const _=new egt(o.layerUid,o.graphicUid(n),c,p,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Fr.LOD,_,u,h,e.transform.transform,g),e.options.store!==Lo.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Fr.LOD,_,u,h,e.transform.transform,g),e.options.store===Lo.ALL){const v=MZ(e.results.min.ray);v.set(Fr.LOD,_,u,h,e.transform.transform,g),e.results.all.push(v)}}})}},igt=class IAe{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new tgt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(YC);if(qn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),yt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new IAe(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Or();this.components.forEach(i=>{i.boundingInfo!=null&&(pp(e,i.boundingInfo.bbMin),pp(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=C();qd(e,i),this._boundingSphere={center:i,radius:.5*p0e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const rgt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new Kmt(e,i)};let rh=class extends oQe{constructor(e,i){super(e),this.type=Fr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new br,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[ye.OPAQUE_MATERIAL,r=>this._produces(r)],[ye.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new yS({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(wt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=ngt(this.optionalFields),this._glInstanceBufferLayout=Lc(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,s)=>r+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=r.triangleCount;i.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new pce(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new pce(r,this._instanceBufferLayout)),igt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(YC);if(qn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),yt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=rgt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>i.material.produces.get(ye.TRANSPARENT_MATERIAL)?.(V.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==V.Highlight&&e!==V.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!wr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(wc),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>r.push(this._beginComponent(e,s[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let s=0;e.rctx.bindVAO(),r.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[s++],n[a],l,a))}))}_getInstanceDatas(e){const i=e!==V.Highlight&&e!==V.ShadowHighlight,r=e!==V.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=C();_e(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,_ce),e.transform.set(_ce),Ve(vce,r,e.transform.inverse),Ve(bce,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;at(!!(l&Br.ACTIVE),"invalid instance state"),at(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,vce,bce,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,i=e.view?.state;if(!i)return null;this._octreeCached=new Qmt(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)i.get(r)&Br.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Oe(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,Zd.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,Zd.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,Hp),_e(Hp,Hp,n);const a=pe(Hp,i)-Hp[3];o.boundingSphere.getVec(s,Hp),_e(Hp,Hp,n);const l=pe(Hp,i)+Hp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Br.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(p&Br.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),p&Br.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),p&Br.REMOVE)n.freeInstance(c);else if(p&Br.VISIBLE){let _=0;i&&(o.modelOrigin.getVec(c,yce),_=s.selectLevel(yce,n.getCombinedMedianScaleFactor(c),r)),f=p&~(Br.ACTIVE|Br.TRANSFORM_CHANGED),_>=0&&(p&Br.HIGHLIGHT?(gce(this._highlightRenderInstanceData[0][_],o,c),f|=Br.HIGHLIGHT_ACTIVE):(gce(this._defaultRenderInstanceData[0][_],o,c),f|=Br.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,_)}else f=p&~(Br.ACTIVE|Br.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const _=!!(p&Br.ACTIVE),v=!!(f&Br.ACTIVE);!_&&v?this._octreeCached.addInstance(c):_&&!v?this._octreeCached.removeInstance(c):_&&v&&p&Br.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const s=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,s,n){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,o,s.material.parameters,ogt);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),wr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===V.Color&&(l.setUniform4fv("externalColor",wce[Math.min(n,wce.length-1)]),l.setUniform1i("colorMixMode",JTe.replace));const c=r.capacity,u=r.headIndex,h=r.tailIndex,p=r.firstIndex,f=this._glInstanceBufferLayout,g=(_,v)=>{VZ(a,di,r.buffer,f,_),a.drawArraysInstanced(i.primitiveType,0,s.vertexCount,v-_),Owe(a,di,r.buffer,f)};s.material.parameters.transparent&&p!=null?u>h?(at(p>=h&&p<=u,"invalid firstIndex"),g(p,u),g(h,p)):u<h&&(p<=u?(at(p>=0&&p<=u,"invalid firstIndex"),g(p,u),g(h,c),g(0,p)):(at(p>=h&&p<=c,"invalid firstIndex"),g(p,c),g(0,u),g(h,p))):u>h?g(h,u):u<h&&(g(0,u),g(h,c)),a.bindVAO(null)}};function gce(t,e,i){const r=t.allocateHead();sgt(e,i,t.view,r)}function sgt(t,e,i,r){cJe(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function ngt(t){let e=cs().vec3f(O.INSTANCEMODELORIGINHI).vec3f(O.INSTANCEMODELORIGINLO).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(O.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([m({constructOnly:!0})],rh.prototype,"symbol",void 0),d([m({constructOnly:!0})],rh.prototype,"optionalFields",void 0),d([m({constructOnly:!0})],rh.prototype,"metadata",void 0),d([m({constructOnly:!0})],rh.prototype,"shaderTransformation",void 0),d([m()],rh.prototype,"_instanceData",void 0),d([m()],rh.prototype,"_cycleStartIndex",void 0),d([m({readOnly:!0})],rh.prototype,"_enableLevelSelection",null),d([m()],rh.prototype,"_updateCyclesWithStaticCamera",void 0),d([m({readOnly:!0})],rh.prototype,"running",null),rh=d([U("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],rh);const yce=C(),Hp=Yt(),_ce=xe(),vce=C(),bce=C(),wce=[kt(1,0,1,1),kt(0,0,1,1),kt(0,1,0,1),kt(1,1,0,1),kt(1,0,0,1)],ogt=new fnt;let xce=class{constructor(e,i,r,s,n,o,a,l,c,u,h,p){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=h,this.pivotOffset=p}},agt=class extends Dm{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&nz(this.symbolLayer))throw new Error;if(this._isPrimitive){const i=this.symbolLayer.resource,r=i&&sst(i?.primitive)?i.primitive:E0e;this._resources=await this._createResourcesForPrimitive(r,e)}else{const i=await Wmt(this.symbol.styleOrigin),r=i?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,i=this.symbolLayer?.material?.color){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=r,e.cullFace=s?Er.None:Er.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,s=pn(K5e(e)),n=ya(SD(s)),o=ya(oB(n,r)),a=Se(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...YJ],ambient:Uf,diffuse:Uf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:w,minWorldLength:T,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:dn(w),minWorldLength:T||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=wh;else{const w=r.material!=null?r.material.color:null,T=w!=null?et.toUnitRGBA(w):wh;u.externalColor=T}this._fastUpdates=RC(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const f=new xp(u),g=kSe(e,f);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const _=DI(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,h,i),b=await this._createLodRenderer(g,i);return new xce(g,b,v,_,n,l,c,s,o,a,h,null)}async _createResourcesForUrl(e,i){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=RC(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:N,minWorldLength:j,maxWorldLength:z}=s.verticalOffset;r.materialParameters.verticalOffset={screenLength:dn(N),minWorldLength:j||0,maxWorldLength:z??1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await CAe(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=Pft(o.lods),u=this._context,h=this.symbolLayer.material,p=this._getExternalColorParameters(h),f=this.symbolLayer?.material?.color,g=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=DI(c),b=DI(c).map(N=>({opacity:N.parameters.opacity||1,transparent:N.parameters.transparent}));v.forEach(N=>{const j=N.parameters;N.setParameters(p);const z=j.opacity*g,X=z<1||_||j.transparent;N.setParameters({opacity:z,transparent:X}),u.screenSizePerspectiveEnabled&&N.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,T=ya(SD(w)),S=ya(c.levels[0].pivotOffset),A=ya(oB(T,this.symbolLayer)),P=Se(A),R=this._fastUpdates;$C(R,this._context.renderer,this._fastVisualVariableConvertOptions(w,A,T,S))&&v.forEach(N=>N.setParameters(R.materialParameters));const F=await this._createStageResources(c,n,i),k=await this._createLodRenderer(c,i);return new xce(c,k,F,b,T,a,l,w,A,P,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=DI(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Toe(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),r))),yt(r);const a=Soe(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,hL),tn(u,wit(n.materialParameters,hL,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,hL),EJ(l,n.materialParameters,hL)}}:null,a=new rh({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=wh:e?.color!=null?i.externalColor=et.toUnitRGBA(e.color):(i.externalColor=wh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=pw(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=this.symbolLayer?.material?.color,l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,u=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:u}),this._isPrimitive&&o.setParameters({cullFace:u?Er.None:Er.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,dv)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return js.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!$C(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return js.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return js.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=w2e(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+G_(c.data,c.indices),0),s=Soe(e).reduce((a,l)=>a+r(l),0),n=Toe(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...b2e(this.symbol,this.symbolLayer),resourceBytes:n};return new mh({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(ts(i,pT,this._context.elevationProvider.spatialReference),l!=null&&!iX(l,pT))return null;const c=Sce(s),u=this._computeGlobalTransform(i,s,NG,dL),h=this._computeLocalTransform(this._resources,this.symbolLayer,r,Cce),p=this._resources.lodRenderer.instanceData,f=p.addInstance();this._instanceIndexToGraphicUid.set(f,n),p.setLocalTransform(f,h,!1),p.setGlobalTransform(f,u),a&&p.setFeatureAttribute(f,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(f,aO(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(f,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new Eft(this,f,jrt,s);return c&&(g.alignedSampledElevation=dL.sampledElevation),g.needsElevationUpdates=dv(s.mode),Yw(g,i,this._context.elevationProvider),g}_computeGlobalTransform(e,i,r,s){return hv(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),pT[0]=e.x,pT[1]=e.y,pT[2]=s.z,Io(e.spatialReference,pT,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return Ih(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=woe(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||E0(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&pw(i);if(r==null)return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,NG,dL),Sce(e.elevationContext)&&(e.alignedSampledElevation=dL.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,NG,!0),Yw(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(g,_,v)=>(g!=null&&g.type==="complete"?g.newValue:_)??v,s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),h=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:h},f=this._resources;this.loadStatus===hu.LOADED&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=ya(oB(f.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,_)=>{const v=this._computeLocalTransform(f,p,_,Cce),b=g.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=s!=null?et.toUnitRGBA(s):wh;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_applyObjectRotation(e,i,r){if(!this._fastUpdates?.requiresShaderTransformation||!i)return tst(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const s=Tce(e.resourceBoundingBox,e.pivotOffset,i);s&&Aa(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=e!=null?ya(SD(e)):Uf,o=e!=null?Tce(e,s,this.symbolLayer):xs,a=this._context.renderCoordsHelper.unitInMeters,l=woe(i??void 0,i,r,a),c=Ce(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new E$({size:!0,color:!0,rotation:!0,opacity:!1},n,i??Uf,a,o,l,c)}};function Tce(t,e,i){const r=C();switch(i.anchor){case"center":ae(r,qd(t)),Yn(r,r);break;case"top":{const s=qd(t);te(r,-s[0],-s[1],-t[5]);break}case"bottom":{const s=qd(t);te(r,-s[0],-s[1],-t[2]);break}case"relative":{const s=qd(t),n=SD(t),o=i.anchorPosition,a=o?Ce(o.x,o.y,o.z):xs;gk(r,n,a),me(r,r,s),Yn(r,r);break}default:e!=null?Yn(r,e):ae(r,xs)}return r}function Sce(t){return t.mode!=="absolute-height"}const pT=C(),Cce=xe(),NG=xe(),hL=Yt(),dL=new P$;let lgt=class{constructor(e,i,r,s){this.vertices=e,this.positionsES=i,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=Ce(l,c,u),this.positions=os(3*n);const h=this.offset+3*n;for(let p=this.offset;p<h;p+=3)this.positions[p]=r[p]-l,this.positions[p+1]=r[p+1]-c,this.positions[p+2]=r[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return G_(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const s=this.positions;i.vRight[0]=s[r+3]-s[r],i.vRight[1]=s[r+4]-s[r+1],i.vRight[2]=s[r+5]-s[r+2],r+=3;let n=Se(i.vRight);i.vMinSiblingLength=n,fe(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[r+3]-s[r],l.vRight[1]=s[r+4]-s[r+1],l.vRight[2]=s[r+5]-s[r+2];const c=Se(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,fe(l.vRight,l.vRight)}else ae(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,r+=3}}},cgt=class{constructor(e,i,r,s,n,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=vGe(1*this.numVerticesTotal),this.profileRightAxes=os(4*this.numVerticesTotal),this.profileUpAxes=os(4*this.numVerticesTotal),this.profileVertexAndNormals=os(4*this.numVerticesTotal),this.positions=B4(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return G_(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=B4(e,i,3*r.length);let s=0;const n=(a,l,c,u,h)=>this.emitCapVertex(s,a,l,c,u,h),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=1;s<r.length-1;++s)this.extruder.extrude(r[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(r[s],n),s=r.length-1,this.endCap.rebuildCapGeometry(r[s],n)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,h)=>{n.push(c),n.push(u),n.push(h),o.push(c),o.push(u),o.push(h),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[h])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],h=this.profile.indices[2*c+1];for(let p=0;p<r;++p){const f=p*e+u,g=(p+1)*e+h,_=p*e+h;l(f,(p+1)*e+u,g),l(f,g,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Qf(n),this.normalIndices=Qf(o),this.pathVertexIndices=Qf(a)}onPathChanged(){this._rebuildGeometry()}},FQ=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],0,0)}},Ece=class extends FQ{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},pL=class extends FQ{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const s=this.profilePlaneOffset;for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],s,0)}rebuildCapGeometry(e,i){const r=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=LAe;bi(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,n,s)}buildTopology(e,i){const r=this.profile,s=this.vertexBufferStart+r.indices[0];for(let n=1;n<r.numSegments;++n){const o=r.indices[2*n],a=r.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,s):i(s,l,c)}}},Ace=class extends FQ{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const s=i.indices[2*r],n=i.indices[2*r+1];i.poleIndices[s]===i.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,s=e.frame,n=.5*this.sign,o=ugt,a=LAe;bi(a,0,0);for(const l of r.poles)l.normal?i(s,l.position,l.normal,n,0):i(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(s,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),h=Math.cos(c);for(let p=0;p<r.vertices.length;++p){const f=r.poles[r.poleIndices[p]];Rf(o,r.vertices[p],f.position),mu(o,o,u),f.normal?(Cd(o,o,f.position),i(s,o,f.normal,n*h,0)):(tR(a,o),mu(a,a,u),Cd(o,o,f.position),i(s,o,a,n*h,this.sign*h))}}}buildTopology(e,i){const r=this.profile,s=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let h=s+a,p=s+l;for(let f=0;f<this.numSegments-1;++f){const g=n+f*r.vertices.length+a,_=n+f*r.vertices.length+l;this.flip?(i(g,p,h),i(p,g,_)):(i(h,p,g),i(_,g,p)),h=g,p=_}this.flip?(i(c,p,h),c!==u&&i(c,u,p)):(i(h,p,c),c!==u&&i(p,u,c))}}};const ugt=it(),LAe=it();let hgt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],!1)}},FG=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=pgt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Bl(Pce,.5*-n+c*n/this.numBendSubdivisions,l),dgt(s,a,Pce);for(let u=0;u<i.vertices.length;++u)wn(i.vertices[u],o)*n>=0?r(s,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(Mce,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=wn(i.vertices[c],o)*n>=0;r(a,e.applyMiterStretch(Mce,i.vertices[c]),i.normals[c],!u)}}},DAe=class{constructor(){this.up=C(),this.right=C()}};function dgt(t,e,i){Ve(t.up,e.up,i),Ve(t.right,e.right,i)}const Mce=it(),Pce=xe(),pgt=new DAe;let fgt=class extends rn{constructor(e,i,r,s,n,o){super(e,i,null,ws.Mesh,o),this.path=r,this.geometrySR=s,this.stencilWidth=n}};var sm;function NAe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(sm||(sm={}));let FAe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},kAe=class extends FAe{constructor(e){super(e),this.vertexAttributeColor=kt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=os(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const h=u===0||u===s.vertices.length-1;u*=3;const p=vgt;let f=0,g=0;const _=4*c,v=te(bgt,o[_],o[_+1],o[_+2]),b=te(wgt,a[_],a[_+1],a[_+2]),w=bi(Oce,l[_]*e[0],l[_+1]*e[1]);if(h)Ke(p,b,v),f=o[_+3]*e[0],g=a[_+3];else{const P=ggt,R=ygt;bi(P,o[_+3],a[_+3]);const F=ZX(P);tR(P,P);const k=wn(w,P);if(Math.abs(k)>F){bi(R,-P[1],P[0]);const N=wn(w,R);mu(P,P,F*Math.sign(k)),mu(R,R,N),Cd(w,P,R)}te(p,0,0,0)}const T=te(_gt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=n[u]+T[0]+p[0]*f,this.vertexAttributePosition[S+1]=n[u+1]+T[1]+p[1]*f,this.vertexAttributePosition[S+2]=n[u+2]+T[2]+p[2]*f;const A=bi(Oce,l[_+2],l[_+3]);kh(this.vertexAttributeNormal,c,v[0]*A[0]+b[0]*A[1]+p[0]*g,v[1]*A[0]+b[1]*A[1]+p[1]*g,v[2]*A[0]+b[2]*A[1]+p[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[O.POSITION,new Ze(this.vertexAttributePosition,r,3,!0)],[O.NORMALCOMPRESSED,new Ze(this.vertexAttributeNormal,i,2,!0)],[O.COLOR,new Ze(this.vertexAttributeColor,wv(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r,s){const n=this.builder.vertexIndices,o=new y$(this.vertexAttributePosition,3),a=n.length/3;qSe(e,i,0,a,n,o,void 0,r,(l,c,u)=>{s(l,u,c,!1)})}},mgt=class extends FAe{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new kAe(e),this.vvData=os(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[O.POSITION,new Ze(e,n,3,!0)],[O.PROFILERIGHT,new Ze(i,o,4,!0)],[O.PROFILEUP,new Ze(r,o,4,!0)],[O.PROFILEVERTEXANDNORMAL,new Ze(s,o,4,!0)],[O.FEATUREVALUE,new Ze(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(O.POSITION);i&&(i.data=this.builder.positions)}};const Oce=it(),ggt=it(),ygt=it(),_gt=C(),vgt=C(),bgt=C(),wgt=C();function xgt(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=C(),o=C(),a=C(),l=C(),c=C(),u=C(),h=Ui();let p=t.vertices[0];ae(o,e),te(n,0,1,0),G4(p.vRight,o,n,n,a,o,s),ae(p.frame.up,o),ae(p.frame.right,a);const f=t.positions;let g=t.offset;i=p;for(let _=1;_<r;++_){p=t.vertices[_],me(c,p.vLeft,p.vRight);let v=Se(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=f[g]+i.frame.up[0],u[1]=f[g+1]+i.frame.up[1],u[2]=f[g+2]+i.frame.up[2],g+=3;const b=te(Tgt,f[g],f[g+1],f[g+2]);a$(b,c,h),fx(h,Ou(u,p.vLeft),l)?(l[0]-=f[g],l[1]-=f[g+1],l[2]-=f[g+2],fe(o,l),Ke(a,c,o),fe(a,a)):G4(c,i.frame.up,i.frame.right,n,a,o,s),ae(p.frame.up,o),ae(p.frame.right,a),i=p}}const Tgt=C();let UAe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(CM(e)),this.normals.push(CM(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:CM(e),normal:i?CM(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*G_(this.vertices[0])*2+G_(this.indices)}};const zAe={top:[0,-.5],bottom:[0,.5]};function kG(t){const i=LSe,r=new UAe,s={v0:0,v1:0};r.addPole(ci(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=ci(l*.5,c*.5),h=ci(l,c);r.addVertex(u,h)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,s)}const n={v0:i-1,v1:0};if(r.addSegment(n,s),t!=="center"){const o=zAe[t];r.translate(o[0],o[1])}return r}const Sgt={center:kG("center"),top:kG("top"),bottom:kG("bottom")},Cgt={center:UG("center"),top:UG("top"),bottom:UG("bottom")};function UG(t){const r=new UAe,s=ci(.5*-1,.5*-1),n=ci(.5*1,.5*-1),o=ci(.5*1,.5*1),a=ci(.5*-1,.5*1),l=ci(0,-1),c=ci(1,0),u=ci(0,1),h=ci(-1,0);if(r.addPole(ci(0,.5*1),u),r.addPole(ci(0,.5*1)),r.addPole(ci(0,.5*-1)),r.addPole(ci(0,.5*-1),l),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,h),r.addVertex(s,h),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=zAe[t];r.translate(p[0],p[1])}return r}function Egt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Agt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function BAe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Mgt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Pgt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function Ogt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function Rgt(t){return t[0]*t[3]-t[2]*t[1]}function VAe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*u,t[3]=s*c+o*u,t}function $gt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function Igt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function Lgt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function Dgt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Ngt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Fgt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function kgt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function Ugt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function GAe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function zgt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Bgt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=go();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function Vgt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Ggt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const jgt=VAe,Hgt=GAe;Object.freeze(Object.defineProperty({__proto__:null,LDU:kgt,add:Ugt,adjoint:Ogt,copy:Egt,determinant:Rgt,equals:Bgt,exactEquals:zgt,frob:Fgt,fromRotation:Lgt,fromScaling:Dgt,identity:Agt,invert:Pgt,mul:jgt,multiply:VAe,multiplyScalar:Vgt,multiplyScalarAndAdd:Ggt,rotate:$gt,scale:Igt,set:BAe,str:Ngt,sub:Hgt,subtract:GAe,transpose:Mgt},Symbol.toStringTag,{value:"Module"}));function jAe(){return[1,0,0,1]}function qgt(t){return[t[0],t[1],t[2],t[3]]}function Wgt(t,e,i,r){return[t,e,i,r]}function Ygt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:qgt,create:jAe,createView:Ygt,fromValues:Wgt},Symbol.toStringTag,{value:"Module"}));let HAe=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new DAe}setFrameFromUpVector(e){ae(this.frame.up,e),me(TA,this.vLeft,this.vRight),fe(TA,TA),ie(Ice,this.frame.up,pe(TA,this.frame.up)),_e(fL,TA,Ice),fe(fL,fL),Ke(this.frame.right,fL,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},Xgt=class extends HAe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return W_e}get rotationAngle(){return ie(gy,this.frame.up,pe(this.frame.up,this.vLeft)),_e(gy,this.vLeft,gy),Yn(gy,gy),fe(gy,gy),ie(mT,this.frame.up,pe(this.frame.up,this.vRight)),_e(mT,this.vRight,mT),fe(mT,mT),Ke(I5,this.rotationFrameUp,this.vLeft),Math.sign(pe(I5,this.vRight))*(Math.PI-Zn(pe(gy,mT)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const s=Mj(Math.cos(.5*r));return bi(e,(s-1+1)*i[0],i[1])}},Zgt=class extends HAe{get rotationFrameUp(){const e=Math.sign(pe(this.frame.right,this.vRight));return Ke(xA,this.vRight,this.vLeft),ie(xA,xA,e),fe(xA,xA)}get rotationRight(){const e=this.rotationFrameUp,i=pe(e,this.frame.up),r=pe(e,this.frame.right);return ie(fT,this.frame.up,-r),ie($ce,this.frame.right,i),me(fT,fT,$ce),fe(fT,fT),Jgt(Rce,this.frame,fT),Rce}get rotationAngle(){const e=Math.sign(pe(this.frame.right,this.vRight));return Yn(I5,this.vLeft),-e*(Math.PI-Zn(pe(I5,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*Mj(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const s=Mj(Math.cos(.5*r)),n=this.rotationRight,o=BAe(Kgt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return sve(e,i,o)}};function Jgt(t,e,i){bi(t,pe(i,e.right),pe(i,e.up))}function Qgt(t){switch(t){case sm.World:return new Xgt;case sm.Path:return new Zgt}}const xA=C(),Rce=it(),fT=C(),$ce=C(),I5=C(),gy=C(),mT=C(),Ice=C(),TA=C(),fL=C(),Kgt=jAe(),zG=8;function e0t(t,e){const i=O.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(x`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Ar("size",s=>s.size)),e.vvSize?(r.uniforms.add(new Rt("vvSizeMinSize",s=>s.vvSize.minSize),new Rt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Rt("vvSizeOffset",s=>s.vvSize.offset),new Rt("vvSizeFactor",s=>s.vvSize.factor)),r.code.add(x`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(x`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",zG),r.uniforms.add(new el("vvOpacityValues",s=>s.vvOpacity.values,zG),new el("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,zG)),r.code.add(x`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",L2),r.uniforms.add(new el("vvColorValues",s=>s.vvColor.values,L2),new hSe("vvColorColors",s=>s.vvColor.colors,L2)),r.code.add(x`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(x$),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let t0t=class extends A${constructor(){super(...arguments),this.size=ci(1,1)}};function SR(t,e){e.spherical?t.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function i0t(t){const e=new Pi,{vertex:i,fragment:r}=e;switch(Dl(i,t),e.varyings.add("vpos","vec3"),e.include(e0t,t),t.output!==V.Color&&t.output!==V.ObjectAndLayerIdColor||(e.include(Sa,t),e.include(NC,t),e.include(gE,t),e.include(xx,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===V.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),e.include(Im,t),t.output){case V.Color:e.include(Ks,t),e.include(Ww,t),e.include(I$,t),e.include(NC,t),e.include(GSe,t),wp(r,t),L$(r),xE(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Rt("ambient",s=>s.ambient),new Rt("diffuse",s=>s.diffuse),new Rt("specular",s=>s.specular),new Ue("opacity",s=>s.opacity)),r.include(Rm),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),Em(r),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===Qe.ColorAlpha?x`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case V.Depth:e.include(Sa,t),i.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Ks,t),r.code.add(x`void main() {
discardBySlice(vpos);
}`);break;case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:case V.ViewshedShadow:e.include(Sa,t),BU(e),e.varyings.add("depth","float"),i.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Ks,t),e.include(lz,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case V.ObjectAndLayerIdColor:e.include(Ks,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case V.Normal:e.include(Sa,t),e.include(SR,t),PC(i),e.varyings.add("vnormal","vec3"),i.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Ks,t),r.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case V.Highlight:e.include(Sa,t),e.include(SR,t),e.varyings.add("vnormal","vec3"),i.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Ks,t),e.include(Mv,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const r0t=Object.freeze(Object.defineProperty({__proto__:null,build:i0t},Symbol.toStringTag,{value:"Module"})),qAe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4],[O.OBJECTANDLAYERIDCOLOR,5]]);let s0t=class extends t0t{constructor(){super(...arguments),this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.specular=Ce(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},WAe=class YAe extends Ni{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Fi(e.rctx,YAe.shader.get().build(this.configuration),qAe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===Qe.NONE,s=e===Qe.FrontFace;return Lt({blending:i.output===V.Color&&i.transparent?r?Ac:L0(e):null,culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==as.None?gwe:null,depthTest:{func:Pv(e)},depthWrite:r||s?Oc:null,drawBuffers:i.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:i.hasOccludees?ym:null,stencilTest:i.hasOccludees?Ov:null,polygonOffset:r||s?null:iz})}};WAe.shader=new Oi(r0t,()=>ue(()=>import("./Path.glsl-10ed17c4.js"),[],import.meta.url));let yn=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.doubleSidedMode=as.None,this.transparencyPassType=Qe.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}};d([B({count:V.COUNT})],yn.prototype,"output",void 0),d([B({count:as.COUNT})],yn.prototype,"doubleSidedMode",void 0),d([B({count:Qe.COUNT})],yn.prototype,"transparencyPassType",void 0),d([B()],yn.prototype,"spherical",void 0),d([B()],yn.prototype,"receiveShadows",void 0),d([B()],yn.prototype,"receiveAmbientOcclusion",void 0),d([B()],yn.prototype,"vvSize",void 0),d([B()],yn.prototype,"vvColor",void 0),d([B()],yn.prototype,"vvOpacity",void 0),d([B()],yn.prototype,"hasSlicePlane",void 0),d([B()],yn.prototype,"transparent",void 0),d([B()],yn.prototype,"hasOccludees",void 0),d([B()],yn.prototype,"multipassEnabled",void 0),d([B()],yn.prototype,"cullAboveGround",void 0),d([B()],yn.prototype,"doublePrecisionRequiresObfuscation",void 0),d([B({constValue:!1})],yn.prototype,"occlusionPass",void 0),d([B({constValue:mt.Disabled})],yn.prototype,"pbrMode",void 0),d([B({constValue:!0})],yn.prototype,"hasVvInstancing",void 0),d([B({constValue:!1})],yn.prototype,"useCustomDTRExponentForWater",void 0),d([B({constValue:!1})],yn.prototype,"useFillLights",void 0),d([B({constValue:!1})],yn.prototype,"hasColorTexture",void 0);let n0t=class XAe extends Av{constructor(e){super(e,new a0t),this.supportsEdges=!0,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>(this.parameters.castShadows&&E2(i)||eO(i))&&!this.parameters.transparent],[ye.TRANSPARENT_MATERIAL,i=>(this.parameters.castShadows&&E2(i)||eO(i))&&this.parameters.transparent]]),this._vertexAttributeLocations=qAe,this._configuration=new yn,this._vertexBufferLayout=XAe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===V.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?as.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?as.WindingOrder:as.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==V.Shadow&&e!==V.ShadowExcludeHighlight&&e!==V.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!NAe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:b,factor:w,minSize:T,maxSize:S}=this.parameters.vvSize,A=l.sizeAttributeValue;c[0]*=Te(b[0]+A*w[0],T[0],S[0]),c[1]*=Te(b[2]+A*w[2],T[2],S[2])}const u=new O$(!1,r.options.normalRequired),h=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void Lce(l,c,s,n,u,o);const f=Iw(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],_=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),v=[_/g[0],_/g[1],_/g[2]];jJ(f,s,v,r.tolerance)&&Lce(l,c,s,n,u,o)}createBufferWriter(){return new bE(this._vertexBufferLayout)}createGLMaterial(e){return new o0t(e)}static getVertexBufferLayout(){const e=cs().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE);return se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}},o0t=class extends Ev{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===V.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(WAe,e)}};function Lce(t,e,i,r,s,n){t.baked.size&&t.baked.size[0]===e[0]&&t.baked.size[1]===e[1]||t.baked.bake(e),t.baked.intersect(i,r,s,n)}let a0t=class extends s0t{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const l0t=["polyline"];let c0t=class extends Dm{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=ci(1,1),this._upVectorAlignment=sm.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new E$({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?RC(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?sm.World:sm.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=Sgt[r];break;case"quad":this._profile=Cgt[r]}switch(this.symbolLayer.join){case"round":this._extruder=new FG(0,ISe);break;case"bevel":this._extruder=new FG(0,1);break;case"miter":this._extruder=new FG(.8*Math.PI,1);break;default:this._extruder=new hgt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new Ece,this._endCap=new Ece;break;case"butt":default:this._startCap=new pL(this._profile,0),this._endCap=new pL(this._profile,0,!0);break;case"square":this._startCap=new pL(this._profile,-.5),this._endCap=new pL(this._profile,.5,!0);break;case"round":{const p=s==="quad";this._startCap=new Ace({profile:this._profile,flip:!1,breakNormals:p,subdivisions:x7}),this._endCap=new Ace({profile:this._profile,flip:!0,breakNormals:p,subdivisions:x7});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=ya(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?Er.None:Er.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(bi(this._intrinsicSize,e,i),!w7(this._intrinsicSize[0])||!w7(this._intrinsicSize[1])))throw new W("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||mu(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const p={...h,...this._fastUpdates.materialParameters,size:V_e(this._intrinsicSize)};this._materials[0]=new n0t(p)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=zi.Compressed,this._materials[0]=new xp(h);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,l0t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,dv)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!$C(this._fastUpdates,i,this._vvConvertOptions))return js.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return js.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of r)i+=h.length;const l=jn(3*i);let c,u=0;for(const h of r){s.push({offset:u,numVertices:h.length});for(const p of h)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||n.equals(o)||jr(l,n,0,l,o,0,i)?(o==null||o.equals(a)?c=U_e(l):(c=jn(3*i),jr(l,o,0,c,a,0,i)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,s){this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=pn(),u=this._context.renderCoordsHelper,h=new OZ(o.vertexDataES);for(const g of o.pathVertexDataInfos){const _=g.numVertices;if(_<2)continue;const v=g.offset;if(this._context.clippingExtent!=null&&(Or(c),Tc(c,o.vertexDataES,v,_),!Wd(c,this._context.clippingExtent)))continue;const b=new Array,w=v+3*_;for(let k=v;k<w;k+=3){h.offset=k;const N=Drt(h,this._context.elevationProvider,r,u);te(Rs,o.vertexDataRS[k],o.vertexDataRS[k+1],o.vertexDataRS[k+2]),u.setAltitude(Rs,N),o.vertexDataRS[k]=Rs[0],o.vertexDataRS[k+1]=Rs[1],o.vertexDataRS[k+2]=Rs[2],b.push(Qgt(this._upVectorAlignment))}const T=new lgt(b,o.vertexDataES,o.vertexDataRS,v);ZAe(T,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new cgt(T,this._profile,this._extruder,this._startCap,this._endCap);let A=null;if(this._fastUpdates){const k=this._fastUpdates.visualVariables,N=np(k.size?.field,e)??0,j=np(k.color?.field,e)??0,z=np(k.opacity?.field,e)??0;A=new mgt(S,N,j,z)}else{const k=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const z=i.size;k[0]*=Dce(z[0],z[2]==="symbol-value"?this.symbolLayer.height||0:z[2],this.symbolLayer.width||0),k[1]*=Dce(z[2],z[0]==="symbol-value"?this.symbolLayer.width||0:z[0],this.symbolLayer.height||0)}let N;this._drivenProperties.color&&(N=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(N=N?[N[0],N[1],N[2],i.opacity]:[1,1,1,i.opacity]);const j=new kAe(S);j.bake(k),N&&j.bakeVertexColors(N),A=j}const P=A.createGeometryData(),R=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),F=new fgt(this._materials[0],P,A,l,this._stencilWidth,R);F.transformation=Aa(xe(),Cr,S.path.origin),a.push(F),this.usedMemory+=S.usedMemory}if(a.length===0)return null;const p=new Rv({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),f=new Lm(this,p,a,null,null,(g,_,v,b,w)=>h0t(g,_,b,w,this._upVectorAlignment),r);return f.alignedSampledElevation=0,f.needsElevationUpdates=dv(r.mode),f}};function ZAe(t,e,i){const{origin:r,positions:s}=t;let n=t.offset;switch(e){default:case sm.World:for(const o of t.vertices)Rs[0]=s[n++]+r[0],Rs[1]=s[n++]+r[1],Rs[2]=s[n++]+r[2],i.worldUpAtPosition(Rs,Rs),o.setFrameFromUpVector(Rs);break;case sm.Path:Rs[0]=s[n]+r[0],Rs[1]=s[n+1]+r[1],Rs[2]=s[n+2]+r[2],i.worldUpAtPosition(Rs,Rs),xgt(t,Rs)}}function Dce(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function u0t(t,e,i,r){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)te(Rs,l[u],l[u+1],l[u+2]),i(Rs,BG),s+=BG.sampledElevation,Rs[0]=a[u]+n[0],Rs[1]=a[u+1]+n[1],Rs[2]=a[u+2]+n[2],r.setAltitude(Rs,BG.z),a[u]=Rs[0]-n[0],a[u+1]=Rs[1]-n[1],a[u+2]=Rs[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function h0t(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!NAe(l))continue;const c=l.path,u=c.builder.path;a+=u0t(u,e,i,r),s!==sm.World&&ZAe(u,s,r),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}const Rs=C(),BG=new P$;function d0t(t,e,i,r,s=1){if(i.isGeographic&&r===Ne.Global){const c=jn(e.length),u=e.length,h=er(i);for(let p=0;p<u;p+=3)EX(e,p,c,p,h);e=c}bi(Sn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Sn[0]=Math.min(Sn[0],e[c]),Sn[1]=Math.min(Sn[1],e[c+1]);const n=Sn[0]%s,o=Sn[1]%s,a=Sn[0]-n,l=Sn[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function JAe(t,e,i,r,s=1){te(u1,1,0,0),te(h1,0,1,0),te(yT,0,0,1),f0t(VG,i),MGe(Nce,i)&&p0t(Nce,u1,h1,yT,r,VG),bi(Sn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),bi(d1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){te(gT,i[u],i[u+1],i[u+2]);const h=pe(u1,gT),p=pe(h1,gT);Sn[0]=Math.min(Sn[0],h),Sn[1]=Math.min(Sn[1],p),d1[0]=Math.max(d1[0],h),d1[1]=Math.max(d1[1],p)}const n=pe(yT,VG);jG(yy,Sn[0],Sn[1],n,u1,h1,yT),jG(p1,d1[0],Sn[1],n,u1,h1,yT),jG(f1,Sn[0],d1[1],n,u1,h1,yT),_e(p1,p1,yy),ie(p1,p1,.5),_e(f1,f1,yy),ie(f1,f1,.5),me(yy,yy,p1),me(yy,yy,f1);const o=Sn[0]%s,a=Sn[1]%s,l=Sn[0]-o,c=Sn[1]-a;for(let u=0;u<i.length;u+=3){te(gT,i[u],i[u+1],i[u+2]);const h=u/3,p=4*h;t[p]=(pe(u1,gT)-l)/s,t[p+1]=(pe(h1,gT)-c)/s,t[p+2]=l/s,t[p+3]=c/s;const f=9*h;for(let g=0;g<3;g++)e[f+g]=yy[g],e[f+g+3]=p1[g],e[f+g+6]=f1[g]}}const VG=C(),gT=C(),Nce=Ui(),u1=C(),h1=C(),yT=C(),Sn=it(),d1=it(),yy=C(),p1=C(),f1=C();function p0t(t,e,i,r,s,n){s!=null?(s.basisMatrixAtPosition(n,qp),te(mL,qp[0],qp[1],qp[2]),te(gL,qp[4],qp[5],qp[6]),te(GG,qp[8],qp[9],qp[10])):(te(mL,1,0,0),te(gL,0,1,0),te(GG,0,0,1));const o=t;pe(o,GG)<0&&ie(o,o,-1),ae(r,o);const a=pe(o,gL),l=pe(o,mL);Math.abs(a)>Math.abs(l)?(hn(e,mL,o,-l),fe(e,e),Ke(i,e,o),fe(i,i),ie(i,i,-1)):(hn(i,gL,o,-a),fe(i,i),Ke(e,i,o),fe(e,e))}const qp=xe(),mL=C(),gL=C(),GG=C();function f0t(t,e){te(SA,0,0,0);for(let i=0;i<e.length-3;i+=3)SA[0]+=e[i],SA[1]+=e[i+1],SA[2]+=e[i+2];ie(t,SA,1/(e.length/3-1))}const SA=C();function jG(t,e,i,r,s,n,o){te(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}let kQ=class extends Av{intersect(e,i,r,s,n,o){return jSe(e,r,s,n,void 0,o)}};function m0t(t){const e=new Pi,{vertex:i,fragment:r,attributes:s,varyings:n}=e;Dl(i,t),e.include(Sa,t),e.include(Tx,t),e.include(t0,t),e.include(xx,t),s.add(O.POSITION,"vec3"),t.vvColor&&s.add(O.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&t.output===V.Color;o&&n.add("depth","float"),i.uniforms.add(new Ei("eColor",l=>l.color)),i.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Ks,t),o&&e.include(Im,t),r.include(Rm);const a=t.output===V.Highlight;return a&&e.include(Mv,t),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===V.ObjectAndLayerIdColor?x`fColor.a = 1.0;`:""}

    if (fColor.a < ${x.float(Ro)}) {
      discard;
    }

    ${t.output===V.Color?x`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===Qe.ColorAlpha?x`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${a?x`outputHighlight();`:""};
    ${t.output===V.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const g0t=Object.freeze(Object.defineProperty({__proto__:null,build:m0t},Symbol.toStringTag,{value:"Module"}));let QAe=class KAe extends Ni{initializeProgram(e){return new Fi(e.rctx,KAe.shader.get().build(this.configuration),di)}_createPipeline(e,i){const r=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Lt({blending:r.output===V.Color&&r.transparent?s?Ac:L0(e):null,culling:kU(r.cullFace),depthTest:r.draped?null:{func:Pv(e)},depthWrite:r.draped?null:(s||n)&&r.writeDepth?Oc:null,drawBuffers:r.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?pv:Ov:null,polygonOffset:s||n?r.polygonOffset?y0t:null:rz(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};QAe.shader=new Oi(g0t,()=>ue(()=>import("./ColorMaterial.glsl-99c6ab9a.js"),[],import.meta.url));const y0t={factor:1,units:1};let ro=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.cullFace=Er.None,this.transparencyPassType=Qe.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};d([B({count:V.COUNT})],ro.prototype,"output",void 0),d([B({count:Er.COUNT})],ro.prototype,"cullFace",void 0),d([B({count:Qe.COUNT})],ro.prototype,"transparencyPassType",void 0),d([B()],ro.prototype,"hasSlicePlane",void 0),d([B()],ro.prototype,"hasVertexColors",void 0),d([B()],ro.prototype,"transparent",void 0),d([B()],ro.prototype,"polygonOffset",void 0),d([B()],ro.prototype,"enableOffset",void 0),d([B()],ro.prototype,"writeDepth",void 0),d([B()],ro.prototype,"hasOccludees",void 0),d([B()],ro.prototype,"multipassEnabled",void 0),d([B()],ro.prototype,"cullAboveGround",void 0),d([B()],ro.prototype,"objectAndLayerIdColorInstanced",void 0),d([B()],ro.prototype,"vvColor",void 0),d([B()],ro.prototype,"draped",void 0),d([B({constValue:!1})],ro.prototype,"occlusionPass",void 0),d([B({constValue:!0})],ro.prototype,"hasVvInstancing",void 0),d([B({constValue:!1})],ro.prototype,"vvSize",void 0),d([B({constValue:!1})],ro.prototype,"vvOpacity",void 0);let Fce=class extends kQ{constructor(e){super(e,new v0t),this.supportsEdges=!0,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>i===V.Highlight||XB(i)&&!this._isTransparent],[ye.OPAQUE_NO_SSAO_DEPTH,i=>k_(i)&&this.parameters.writeLinearDepth&&!this._isTransparent],[ye.TRANSPARENT_MATERIAL,i=>XB(i)&&this._isTransparent&&this.parameters.writeDepth],[ye.TRANSPARENT_NO_SSAO_DEPTH,i=>k_(i)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(XB(i)||k_(i)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[ye.DRAPED_MATERIAL,i=>fxe(i)]]),this._configuration=new ro}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tz,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new _0t(e)}createBufferWriter(){const e=cs().vec3f(O.POSITION);return se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new bE(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},_0t=class extends Ev{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===V.Color&&this._updateOccludeeState(e),this.ensureTechnique(QAe,e)}},v0t=class extends A${constructor(){super(...arguments),this.color=Cu,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Er.None,this.hasOccludees=!1,this.draped=!1}};var Oo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Oo||(Oo={}));const Z7=.70710678118,kce=Z7,b0t=.08715574274;function w0t(t){const e=new Pi,i=t.multipassEnabled&&t.output===V.Color,{vertex:r,fragment:s,attributes:n,varyings:o}=e;Dl(r,t),e.include(Sa,t),e.include(Tx,t),e.include(t0,t),e.include(xx,t),t.draped?r.uniforms.add(new Ue("worldToScreenRatio",(l,c)=>1/c.screenToPCSRatio)):n.add(O.BOUNDINGRECT,"mat3"),n.add(O.POSITION,"vec3"),n.add(O.UVMAPSPACE,"vec4"),t.vvColor&&n.add(O.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new Ei("uColor",l=>l.color));const a=t.style===Oo.ForwardDiagonal||t.style===Oo.BackwardDiagonal||t.style===Oo.DiagonalCross;return a&&r.code.add(x`
      const mat2 rotate45 = mat2(${x.float(Z7)}, ${x.float(-kce)},
                                 ${x.float(kce)}, ${x.float(Z7)});
    `),t.draped||(wp(r,t),r.uniforms.add(new Ue("worldToScreenPerDistanceRatio",(l,c)=>1/c.camera.perScreenPixelRatio)),r.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(b0t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),r.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Ks,t),s.include(Rm),t.draped&&s.uniforms.add(new Ue("texelSize",(l,c)=>1/c.camera.pixelRatio)),t.output===V.Highlight&&e.include(Mv,t),i&&e.include(Im,t),t.output!==V.Highlight&&(s.code.add(x`
      const float lineWidth = ${x.float(t.lineWidth)};
      const float spacing = ${x.float(t.patternSpacing)};
      const float spacingINV = ${x.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(x`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==V.Highlight?x`color.a *= ${x0t(t)};`:""}

      ${t.output===V.ObjectAndLayerIdColor?x`color.a = 1.0;`:""}

      if (color.a < ${x.float(Ro)}) {
        discard;
      }

      ${t.output===V.Color?x`fragColor = color; ${t.transparencyPassType===Qe.ColorAlpha?x`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${t.output===V.Highlight?x`outputHighlight();`:""}
      ${t.output===V.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function x0t(t){function e(i){return t.draped?x`coverage(vuv.${i}, texelSize)`:x`sampleAA(vuv.${i})`}switch(t.style){case Oo.ForwardDiagonal:case Oo.Horizontal:return e("y");case Oo.BackwardDiagonal:case Oo.Vertical:return e("x");case Oo.DiagonalCross:case Oo.Cross:return x`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const T0t=Object.freeze(Object.defineProperty({__proto__:null,build:w0t},Symbol.toStringTag,{value:"Module"}));let eMe=class tMe extends Ni{initializeProgram(e){return new Fi(e.rctx,tMe.shader.get().build(this.configuration),se("enable-feature:objectAndLayerId-rendering")?rMe:iMe)}_setPipelineState(e,i){const r=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Lt({blending:r.output===V.Color?s?Ac:L0(e):null,culling:kU(r.cullFace),depthTest:r.draped?null:{func:Pv(e)},depthWrite:r.draped?null:s?Oc:ez(e),drawBuffers:r.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?pv:Ov:null,polygonOffset:s||n?r.polygonOffset?S0t:null:rz(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};eMe.shader=new Oi(T0t,()=>ue(()=>import("./Pattern.glsl-8793c704.js"),[],import.meta.url));const S0t={factor:1,units:1};let Dn=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.cullFace=Er.None,this.transparencyPassType=Qe.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};d([B({count:V.COUNT})],Dn.prototype,"output",void 0),d([B({count:Er.COUNT})],Dn.prototype,"cullFace",void 0),d([B({count:Oo.COUNT})],Dn.prototype,"style",void 0),d([B({count:Qe.COUNT})],Dn.prototype,"transparencyPassType",void 0),d([B()],Dn.prototype,"hasSlicePlane",void 0),d([B()],Dn.prototype,"hasVertexColors",void 0),d([B()],Dn.prototype,"polygonOffset",void 0),d([B()],Dn.prototype,"hasOccludees",void 0),d([B()],Dn.prototype,"patternSpacing",void 0),d([B()],Dn.prototype,"lineWidth",void 0),d([B()],Dn.prototype,"enableOffset",void 0),d([B()],Dn.prototype,"draped",void 0),d([B()],Dn.prototype,"multipassEnabled",void 0),d([B()],Dn.prototype,"cullAboveGround",void 0),d([B()],Dn.prototype,"vvColor",void 0),d([B({constValue:!0})],Dn.prototype,"writeDepth",void 0),d([B({constValue:!1})],Dn.prototype,"occlusionPass",void 0),d([B({constValue:!1})],Dn.prototype,"hasVvInstancing",void 0),d([B({constValue:!1})],Dn.prototype,"vvSize",void 0),d([B({constValue:!1})],Dn.prototype,"vvOpacity",void 0);const iMe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6]]),rMe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6],[O.OBJECTANDLAYERIDCOLOR,9]]);let UQ=class extends kQ{constructor(e){super(e,new M0t),this.supportsEdges=!0,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>uw(i)],[ye.TRANSPARENT_MATERIAL,i=>Kg(i)],[ye.TRANSPARENT_NO_SSAO_DEPTH,i=>k_(i)&&this.parameters.writeLinearDepth],[ye.DRAPED_MATERIAL,i=>this.parameters.draped&&i===V.Color||uw(i)]]),this._vertexAttributeLocations=se("enable-feature:objectAndLayerId-rendering")?rMe:iMe,this._configuration=new Dn}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tz,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new C0t(e)}createBufferWriter(){const e=cs().vec3f(O.POSITION).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),new E0t(e)}},C0t=class extends Ev{_updateParameters(e){return this.ensureTechnique(eMe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},E0t=class extends bE{write(e,i,r,s,n){rSe(r,this.vertexBufferLayout,e,i,s,n);for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a?.indices;if(a&&l)switch(o){case O.UVMAPSPACE:{at(a.size===4);const c=s.getField(o,gp);c&&IC(a,c,n);break}case O.BOUNDINGRECT:{at(a.size===9);const c=s.getField(o,rv);c&&A0t(a,e,c,n);break}}}}};function A0t(t,e,i,r){const{data:s,indices:n}=t,o=e,a=i.typedBuffer,l=i.typedBufferStride,c=n.length;r*=l;for(let u=0;u<c;++u){const h=9*n[u],p=s[h],f=s[h+1],g=s[h+2];a[r]=o[0]*p+o[4]*f+o[8]*g+o[12],a[r+1]=o[1]*p+o[5]*f+o[9]*g+o[13],a[r+2]=o[2]*p+o[6]*f+o[10]*g+o[14];for(let _=3;_<9;++_)a[r+_]=s[h+_];r+=l}}let M0t=class extends A${constructor(){super(...arguments),this.color=kt(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Er.None,this.hasOccludees=!1,this.style=Oo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function P0t(t,e){const i=t?.pattern??null;return i==null?new Fce(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=kt(0,0,0,0),e.forceTransparentMode=!0),new Fce(e)):(e.style=O0t(i.style),new UQ(e))}function O0t(t){switch(t){case"horizontal":return Oo.Horizontal;case"vertical":return Oo.Vertical;case"cross":return Oo.Cross;case"forward-diagonal":return Oo.ForwardDiagonal;case"backward-diagonal":return Oo.BackwardDiagonal;case"diagonal-cross":return Oo.DiagonalCross;default:return}}function R0t(t){return t.material instanceof UQ&&!t.material.parameters.draped}function $0t(t,e){if(R0t(t)){const i=t.attributes.get(O.POSITION).data,r=t.getMutableAttribute(O.UVMAPSPACE).data,s=t.getMutableAttribute(O.BOUNDINGRECT).data;JAe(r,s,i,e)}}function I0t(t,e,i,r,s){const n=CSe(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)$0t(a,s);return n}const L0t=["polyline","polygon","extent"],Uce=new E$({size:!1,color:!0,rotation:!1,opacity:!1});let sMe=class nMe extends Dm{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1}async doLoad(){this._fastUpdates=RC(this._context.renderer,Uce)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e);this._materials[Ms.Fill]=P0t(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Ms.Fill]instanceof UQ;const r=this.symbolLayer.outline;if(F0t(r)){const s=aAe(r.pattern);this._materials[Ms.Outline]=new XS({width:dn(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,cap:W7(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,L0t,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!$C(this._fastUpdates,i,Uce))return js.RecreateSymbol;this._materials[Ms.Fill]?.setParameters(this._fastUpdates.materialParameters)}return js.FastUpdate}layerOpacityChanged(){if(this._materials[Ms.Fill]!=null){const e=this._materials[Ms.Fill].parameters.color,i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i);this._materials[Ms.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Ms.Outline]!=null){const e=this._materials[Ms.Outline].parameters.color;this._materials[Ms.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=M$(nMe.elevationModeChangeTypes,r,s);if(n!==Ts.UPDATE)return n;const o=Fh(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(this._materials[Ms.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Ms.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Ms.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=bR(e.geometry);if(!s)return null;const n=xQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new D0t(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=os(4*a,!0),o.boundingRect=jn(9*a,!0),JAe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Ms.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Rv({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Lm(this,l,o.outGeometries,null,null,I0t,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Fh(r.mode),c}_createAs3DShapeFill(e,i){const r=i.renderData.polygons;for(const{position:s,mapPositions:n,holeIndices:o,index:a,count:l}of r){if(this._context.clippingExtent!=null&&(Or(td),Tc(td,n),!Wd(td,this._context.clippingExtent)))continue;const c=Kot(n,o,this._context.elevationProvider.spatialReference);if(c.length===0)continue;const u=this._fastUpdates?.visualVariables.color,h=Hoe({material:this._materials[Ms.Fill],indices:c,mapPositions:n,attributeData:{position:s,color:u?null:i.color,colorFeature:u?np(u.field,e):null,uvMapSpace:this._needsUV?B4(i.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?Ph(i.boundingRect,9*a,9*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(h)}}_createAs3DShapeOutline(e){if(this._materials[Ms.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:s}of i){if(this._context.clippingExtent!=null&&(Or(td),Tc(td,r),!Wd(td,this._context.clippingExtent)))continue;const n=Y7(this._materials[Ms.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,i){const r=bR(e.geometry);if(r==null)return null;this._materials[Ms.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Ms.Outline]!=null&&(this._materials[Ms.Outline].renderPriority=this._renderPriority);const s=YCe(r,this._context.overlaySR),n=new N0t(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=os(4*o,!0),d0t(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Or(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Ms.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new wz(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){const r=i.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){const l=Or(td);if(Tc(l,s),!Wd(l,this._context.clippingExtent))continue;const c=fC(s,n,3);if(c.length===0)continue;eC(i.outBoundingBox,l);const u=this._fastUpdates?.visualVariables.color,h=Hoe({material:this._materials[Ms.Fill],indices:c,attributeData:{position:s,color:u?null:i.color,colorFeature:u?np(u.field,e):null,uvMapSpace:this._needsUV?B4(i.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new UC(h,i))}}_createAsOverlayOutline(e){if(this._materials[Ms.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Or(td),Tc(td,s),!Wd(td,this._context.clippingExtent))continue;eC(e.outBoundingBox,td);const n=Y7(this._materials[Ms.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new UC(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,i=this._getOutlineOpacity();return aO(e!=null?et.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};sMe.elevationModeChangeTypes={definedChanged:Ts.RECREATE,staysOnTheGround:Ts.NONE,onTheGroundChanged:Ts.RECREATE};const td=pn();let D0t=class extends fz{constructor(e,i,r,s){super(e,r,s),this.color=i}},N0t=class extends fz{constructor(e,i,r,s){super(e,r,s),this.color=i}};var Ms;function F0t(t){return t?.size!=null&&t.size>0&&t.color!=null&&(t.pattern==null||t.pattern.type!=="style"||t.pattern.style!=="none")}(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Ms||(Ms={}));let oMe=class{constructor(e,i="center",r=!1,s=it(),n=kt(0,0,0,-1),o="world",a=C(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},aMe=class{constructor(e,i="center",r="center",s=null,n=it()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n}},lMe=class cMe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=zce(e.color),this.haloStyle=k0t(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?zce(e.background.color):null}fontString(e){const i=this.definition.font,r="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${i.style} ${i.weight} ${e}px ${i.family}, ${r}`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){const r=e?.material?.color,s=et.toUnitRGBA(r)??Cu,n=e.size!=null?dn(e.size):12,o=e.lineHeight,a=e.background!=null?et.toUnitRGBA(e.background.color):Cu,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,u=c?.color!=null&&c.size>0?{size:dn(c.size),color:et.toUnitRGBA(c.color)}:{size:0,color:Cu},h=new cMe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let p=!1;const f=h.fontString(n);try{p=(await document.fonts.load(f)).some(g=>!fut(g))}catch{le.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}if(!p&&!U0t.has(e.font.family))try{await put(e.font)}catch{}}return h}};function k0t(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function zce(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const U0t=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),_y=4096;let Hb=class extends Pe{constructor(e){super(e),this.type=ws.Texture,this.id=wu(),this.events=new Ls,this._glTexture=null,this._atlas=new V0t(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Tt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return bO=0,[_y-vy-bO,_y-vy-bO-Bce]}load(e){if(this._glTexture)return this._glTexture;const i=new $r;return i.wrapMode=hi.CLAMP_TO_EDGE,i.samplingMode=Zt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new ur(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(wt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=gr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Tt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(n=>{this._stageObjects.get(n.textRenderer.key)?.forEach(a=>HG(a,n))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new Vce(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new Vce(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){this._stageObjects.get(e)?.delete(i)&&(i.geometries[0].setAttributeData(O.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],O.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+vy,a=n+vy+Bce;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(N_(Math.max(o,1.5*r.width)),_y);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(N_(Math.max(l,1.5*r.height)),_y);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<_y){const u=Math.min(N_(1.5*r.width),_y);this._resizeAtlas(u,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-vy,i[1]-vy,r.renderedWidth+2*vy,r.renderedHeight+2*vy),r.render(this._ctx,i[0],i[1]),this._stageObjects.get(r.key)?.forEach(n=>HG(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return $o;for(;this._needsRepack&&(this._canRepack||this._atlas.height<_y&&this._atlas.height<_y);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let s=this._elements.get(r);s==null&&(s=new B0t(this._atlas,e),this._processAddition(s),this.setDirty()),z0t(i,s),HG(i,s)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const s=this._stageObjects.get(r);s&&s.size!==0||this._elements.delete(r),s?.size===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function z0t(t,e){t.geometries[0].setAttributeData(O.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],O.SIZE)}function HG(t,e){t.geometries[0].setAttributeData(O.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],O.UV0,!0)}d([m({constructOnly:!0})],Hb.prototype,"view",void 0),d([m({type:Boolean})],Hb.prototype,"updating",void 0),Hb=d([U("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Hb);const vy=2,Bce=2;let B0t=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=Yt(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Cu;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return Zr(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},V0t=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=bO}},Vce=class{constructor(e){this.y=e,this.x=bO}},bO=0,G0t=class{constructor(e,i,r){this._renderer=new KEe(e,i,r,Hb.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=O5(j0t,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new fv(e,{wrap:{s:hi.CLAMP_TO_EDGE,t:hi.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const j0t={canvas:null},H0t=Ce(0,0,1);let q0t=class extends Dm{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=nz(this.symbolLayer.size);if(e)throw new W("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await lMe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=pw(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=pX(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!$0e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new oMe(n);dpt(o,a.screenOffset);const l=new aMe(a,this.symbolLayer.horizontalAlignment,hpt(o));return this._createAs3DShape(i,r,s,l)}createLabel(e,i,r,s,n){const o=e.graphic,a=pw(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,s,n)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return Gce(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Ts.UPDATE}slicePlaneEnabledChanged(e,i){return Gce(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=Fh(r.mode)||r.mode==="absolute-height"}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=pw(i);if(!n)return!1;const o=T2e(s,this._context,n,r);if(o==null)return!1;const a=sQ(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,Yw(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return Y0t}_createAs3DShape(e,i,r,s,n=null,o=null,a=()=>s.placement.elevationOffset){const l=this.setGraphicElevationContext(e,new a5,s.placement.elevationOffset),c=e.geometry?.type==="polyline",u=e.uid;let h=null,p=null;if(o==null){const z=tAe(s.horizontalPlacement);h=new G0t(r,z,this._textRenderParameters);let X=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create()),p.texture.events.on("unloaded",()=>X=Xt(X));const q=this._context.stage.renderView.textures.acquire(p.texture.id);if(q==null||$c(q))return p.release(),null;X=q}}const f=W0t(h,s),g={occlusionTest:!se("enable-feature:non-occluded-hud"),screenOffset:s.placement.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(c&&(g.shaderPolygonOffset=1e-4),o?g.textureId=o.id:p&&(g.textureId=p.texture.id),s.placement.verticalOffset!=null){const{screenLength:z,minWorldLength:X,maxWorldLength:q}=s.placement.verticalOffset;g.verticalOffset={screenLength:dn(z),minWorldLength:X||0,maxWorldLength:q??1/0}}const _={screenOffset:g.screenOffset,anchorPosition:f,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:z,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources,q=QEe(this._textRenderParameters);g.screenSizePerspective=X.overrideFontHeight(q.maxHeight),g.screenSizePerspectiveAlignment=z,_.fontHeight=q.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const v=(z,X,q)=>{let Z=z.get(q);return Z==null&&(Z=new LC(X),z.add(q,Z)),Z},b=n?v(n,g,JSON.stringify(_)):new LC(g),w=s.placement.translation,T=h?ci(h.displayWidth,h.displayHeight):Bw,S=s.placement.centerOffset,A=H0t,P=it(),R=Y9(b,A,w,null,T,S,P,null),F=rQ(this._context,i,R,l,u);if(F==null)return null;const k=(z,X,q,Z,ce,I)=>{const D=a()||s.placement.elevationOffset,G=this.setGraphicElevationContext(e,X,D);return dw(z,G,q,Z,ce,I)},N=new Lm(this,F.object,[R],n==null?[b]:null,p,k,l);N.alignedSampledElevation=F.sampledElevation,N.needsElevationUpdates=Fh(l.mode)||l.mode==="absolute-height",N.getScreenSize=(z=it())=>(z[0]=h?h.displayWidth:s.displaySize[0],z[1]=h?h.displayHeight:s.displaySize[1],z);const j=new $Se(s.placement.elevationOffset,r);return N.metadata=j,Yw(N,i,this._context.elevationProvider),N}};function Gce(t,e,i){t&&t.forEach(r=>{const s=e(r);s!=null&&i(s,r.graphic)})}function W0t(t,e){if(e.verticalPlacement==="baseline"){const r=lpt[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return ci(r,s)}const i=upt(e.horizontalPlacement,e.verticalPlacement);return IN[i]}const Y0t={mode:"relative-to-ground",offset:0};function jce(t){t.fragment.uniforms.add(new ct("texWaveNormal",e=>e.waveNormal),new ct("texWavePerturbation",e=>e.wavePerturbation),new Ei("waveParams",e=>Zr(X0t,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Ar("waveDirection",e=>bi(Z0t,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(lat),t.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const X0t=Yt(),Z0t=it();function J0t(t){const e=new Pi,{vertex:i,fragment:r}=e;Dl(i,t),e.include(Sa,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const s=new Ei("waterColor",n=>n.color);if(t.output===V.Color&&t.draped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Ro)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(x`void main() {
fragColor = waterColor;
}`),e;switch(t.output===V.Color&&(e.include(SR,t),e.include(gE,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Ro)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===V.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Im,t),t.output){case V.Color:e.include(I4),e.include(XZ,{pbrMode:mt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(jce),e.include(Ks,t),e.include(NC,t),e.include(nCe,t),r.uniforms.add(s,new Ue("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),wp(r,t),r.include(Rm),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),I0(r),Em(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===Qe.ColorAlpha?x`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case V.Normal:e.include(SR,t),e.include(jce,t),e.include(Ks,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Ro)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Ue("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case V.Highlight:e.include(Mv,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Ro)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Ks,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case V.ObjectAndLayerIdColor:e.include(xx,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Ro)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Ks,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const Q0t=Object.freeze(Object.defineProperty({__proto__:null,build:J0t},Symbol.toStringTag,{value:"Module"}));let uMe=class hMe extends Ni{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Fi(e.rctx,hMe.shader.get().build(this.configuration),di)}_setPipelineState(e){const i=this.configuration,r=e===Qe.NONE,s=e===Qe.FrontFace;return Lt({blending:i.output!==V.Normal&&i.output!==V.Highlight&&i.output!==V.ObjectAndLayerIdColor&&i.transparent?r?Ac:L0(e):null,depthTest:i.draped?null:{func:Pv(e)},depthWrite:i.draped?null:r?i.writeDepth?Oc:null:ez(e),drawBuffers:D0(e),colorWrite:qt,polygonOffset:r||s?null:rz(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};uMe.shader=new Oi(Q0t,()=>ue(()=>import("./WaterSurface.glsl-3087aca5.js"),[],import.meta.url));let Nn=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=Qe.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};d([B({count:V.COUNT})],Nn.prototype,"output",void 0),d([B({count:Qe.COUNT})],Nn.prototype,"transparencyPassType",void 0),d([B()],Nn.prototype,"spherical",void 0),d([B()],Nn.prototype,"receiveShadows",void 0),d([B()],Nn.prototype,"hasSlicePlane",void 0),d([B()],Nn.prototype,"transparent",void 0),d([B()],Nn.prototype,"enableOffset",void 0),d([B()],Nn.prototype,"writeDepth",void 0),d([B()],Nn.prototype,"hasScreenSpaceReflections",void 0),d([B()],Nn.prototype,"doublePrecisionRequiresObfuscation",void 0),d([B()],Nn.prototype,"hasCloudsReflections",void 0),d([B()],Nn.prototype,"objectAndLayerIdColorInstanced",void 0),d([B()],Nn.prototype,"draped",void 0),d([B()],Nn.prototype,"multipassEnabled",void 0),d([B()],Nn.prototype,"cullAboveGround",void 0),d([B({constValue:!1})],Nn.prototype,"occlusionPass",void 0),d([B({constValue:mt.Water})],Nn.prototype,"pbrMode",void 0),d([B({constValue:!0})],Nn.prototype,"useCustomDTRExponentForWater",void 0),d([B({constValue:!0})],Nn.prototype,"highStepCount",void 0),d([B({constValue:!1})],Nn.prototype,"useFillLights",void 0);let K0t=class extends Ev{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===V.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(uMe,e)}},eyt=class extends kQ{constructor(e){super(e,new dMe),this._configuration=new Nn,this._animation=new Rxe,this.produces=new Map([[ye.OPAQUE_MATERIAL,i=>Kg(i)&&!this.parameters.transparent||uw(i)],[ye.TRANSPARENT_MATERIAL,i=>Kg(i)&&this.parameters.transparent||uw(i)],[ye.DRAPED_MATERIAL,i=>this.parameters.draped&&i===V.Color||uw(i)],[ye.DRAPED_WATER,i=>i===V.Normal]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tz,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<tyt;const r=this._animation.advance(e);return this.setParameters({timeElapsed:nY(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new K0t(e)}createBufferWriter(){return new bE(se("enable-feature:objectAndLayerId-rendering")?sft:ift)}get test(){}},dMe=class extends MJ{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ci(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=kt(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const tyt=35e3,iyt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},ryt=["polyline","polygon","extent"];let qb=class J7 extends Dm{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,ryt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new dMe,i=this.symbolLayer.color;i!=null&&(e.color=et.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?J7.headingVectorFromAngle(this.symbolLayer.waveDirection):ci(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=iyt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new eyt(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=M$(J7.elevationModeChangeTypes,r,s);if(n!==Ts.UPDATE)return n;const o=Fh(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=bR(e.geometry);if(s==null)return null;const n=xQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=jn(2*o);Hce(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new syt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Rv({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new Lm(this,c,l.outGeometries,null,null,CSe,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=Fh(i.mode),u}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(Or(m1),Tc(m1,a),!Wd(m1,this._context.clippingExtent)))continue;const c=fC(a,l,3);if(c.length===0)continue;const u=Ph(r,2*n,2*s),h=qoe({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(h)}}_createAsOverlay(e){const i=bR(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=YCe(i,this._context.overlaySR),s=r.position.length/3,n=jn(2*s);Hce(n,r.position,s,this._context.overlaySR);const o=new nyt(r,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=Or(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new wz(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Or(m1),Tc(m1,s),!Wd(m1,this._context.clippingExtent))continue;eC(e.outBoundingBox,m1);const l=fC(s,n,3);if(l.length===0)continue;const c=Ph(i,2*o,2*a),u=qoe({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new UC(u,e))}}static headingVectorFromAngle(e){const i=it(),r=mk(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};function Hce(t,e,i,r){const s=sl(r);Mu(by);for(let a=0;a<i;a++)bi(qce,e[3*a],e[3*a+1]),EY(by,qce);kw(by,by,s);const n=by[0]%qb.unitSizeOfTexture,o=by[1]%qb.unitSizeOfTexture;yL[0]=by[0]-n,yL[1]=by[1]-o;for(let a=0;a<i;a++)t[2*a]=(e[3*a]*s-yL[0])/qb.unitSizeOfTexture,t[2*a+1]=(e[3*a+1]*s-yL[1])/qb.unitSizeOfTexture}qb.unitSizeOfTexture=100,qb.elevationModeChangeTypes={definedChanged:Ts.RECREATE,staysOnTheGround:Ts.NONE,onTheGroundChanged:Ts.RECREATE};const yL=it(),by=Vt(),qce=it(),m1=pn();let syt=class extends fz{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}},nyt=class extends fz{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function oyt(t,e,i,r){const s=lyt[t.type]?.[e.type]||ayt[e.type];return s?new s(t,e,i,r):(le.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const ayt={icon:q7,object:agt,line:lAe,path:c0t,fill:sMe,extrude:dct,text:q0t,water:qb},lyt={"mesh-3d":{fill:dft}};let cyt=class extends iQ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.at(n);if(o.enabled===!1)continue;_L.renderPriority=1-(1+n)/r,_L.renderPriorityStep=1/r,_L.ignoreDrivers=o.ignoreDrivers;const a=oyt(this.symbol,o,this._context,_L),l=zR(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await Nk(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),yt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new Iot(r,i||this,s,e.layer,n)}get complexity(){return tQ(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Lm?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==hu.LOADED?js.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==js.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,js.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===hu.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===hu.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(YC).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return yt(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const _L=new Lot;let uyt=class extends iQ{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:_2e}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):js.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){return this.graphics3DSymbol?.updateTransform(e,i,r,s)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function zQ(t){return t instanceof uyt?t.graphics3DSymbol:t instanceof cyt?t:null}const CR=()=>le.getLogger("esri.views.3d.layers.graphics.labelPlacement");let hyt=class{constructor(e,i,r,s=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=s}};function Wce(t){const e=byt(t);if(e==null)return null;const i=dyt(t,e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return fyt(new oMe(n,r,s),i,t)}function dyt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Jd[i],s=r||L5(t);return i&&!r&&CR().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),pyt(s,t)}function BQ(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=zQ(e);return i!=null?i.symbol.symbolLayers.at(0):null}function pyt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(CR().warnOncePerTick(Yce(t?.placement,e.disablePlacement.logEntityDescription)),L5(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return CR().warnOncePerTick(Yce(t?.placement,`'${r}' geometries`)),L5(e);break;case"point":case"mesh":return t}return t}function Yce(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function L5(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:xs,anchor:"center"};case"polygon":{const i=BQ(t);return i!=null&&i.type==="extrude"?Jd["above-center"]:{placement:"center-center",normalizedOffset:xs,anchor:"center"}}case"point":case"mesh":return Jd["above-center"];default:return}}function fyt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":case"mesh":gyt(t,e,i);break;case"polygon":myt(t,e,i)}const s=ipt-R5;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function myt(t,e,i){const r=BQ(i);if(r!=null)switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(wO),qd(wO,t.translation),t.translation[2]=yv(wO)/2):te(t.translation,0,0,0),pMe(t,e,s);break}}}function gyt(t,e,i){const r=BQ(i);if(r==null)return;const s=i.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):te(t.translation,0,0,0),r.type){case"icon":case"text":yyt(t,e,i,s);break;case"object":case"fill":pMe(t,e,s)}}function yyt(t,e,i,r){const{graphics3DGraphic:s}=i,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Jd[i.labelClass.labelPlacement]&&CR().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=_yt(i);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function _yt(t,e=wyt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=r?.stageObject.geometries[0].material??null;if(s&&s instanceof LC){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function pMe(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(wO):wO,s=Ce(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Se(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function vyt(t){return t==="above-center"}function byt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=zQ(r.graphics3DSymbol),n=s?.symbol.type==="point-3d"?s.symbol:null,o=Jd[e]||L5(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&vyt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(CR().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}const Jd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Xce={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Xce){const e=Xce[t],i=Jd[t];e.forEach(r=>{Jd[r]=i})}Object.freeze&&(Object.freeze(Jd),Object.keys(Jd).forEach(t=>{Object.freeze(Jd[t]),Object.freeze(Jd[t]?.normalizedOffset)}));const wyt=[0,0],wO=pn();let Zce=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},Jce=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},xyt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},Tyt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new fCe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},ub=class extends Pe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([he(()=>this.view.state?.camera,()=>this.setDirty()),he(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(wt.LABELER,this)]),this._textTextureAtlas=new Hb({view:this.view}),this._hudMaterialCollection=new Zce(this.view._stage),this._calloutMaterialCollection=new Zce(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Tt(this._textTextureAtlas),this._hudMaterialCollection=Tt(this._hudMaterialCollection),this._calloutMaterialCollection=Tt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),id.graphic=null,id.renderingInfo=null,id.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new Jce(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(uo.LABEL,Zo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(uo.LABEL,Zo.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),$o}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(qG(i))this._dirty=!0;else if(WG(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else vu(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),yt(i),e.scaleVisibility?.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo?.filter(o=>!!o.symbol);!n||n.length===0||(await Nk(n,async(o,a)=>{const l=o.symbol,c=zQ(r.getOrCreateGraphics3DSymbol(l));if(c==null)return void le.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),yt(i);let u=null;pX(l)&&l.hasVisibleCallout()&&(u=qnt(l,r.symbolCreationContext),await u.load(),yt(i));const h=await fp(Irt(o,e.layer.fieldsIndex,this.view.spatialReference));if(yt(i),h.ok===!0){const p=await this._createTextRenderParameters(c.symbol);yt(i),e.labelClassContexts[a]=new xyt(o,c,u,p,h.value)}else le.getLogger(this).error(`Label expression failed to evaluate: ${h.error}`)}),yt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(sn(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:lMe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,il(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new aMe(r,jle(r.anchor),cpt(r.anchor),e.text,ci(e.displayWidth,e.displayHeight));return id.graphic=i,id.renderingInfo=null,id.layer=s,n.createLabel(id,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=Wce(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,s,n){id.graphic=e,id.layer=n;const o=s.screenOffset[0];return id.renderingInfo=new jnt(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(id)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(WG(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=vL(r.layer);for(let c=0;c<s.length;c++){const u=e.textRenderers[c],h=e.textLabelPlacements[c];if(u==null||h==null)continue;const p=s[c],f=p.graphics3DSymbol,g=f.symbol&&f.symbol.type==="label-3d"?f.symbol:null,_=f.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(r.elevationInfoOverride);const v=new hyt(i,g,p.labelClass),b=this._createTextSymbolGraphic(u,o,h,a,_,v);if(b==null)return!1;b._labelClass=p.labelClass,b._labelIndex=c,i.addLabelGraphic(b,r.stageLayer),i.deconflictionPriority=p.textRenderParameters?.definition.size??0,i.setVisibilityFlag(uo.LABEL,Zo.USER,l),i.setVisibilityFlag(uo.LABEL,Zo.SCALE_RANGE,!0),i.setVisibilityFlag(uo.LABEL,Zo.DECONFLICTION,!1),n=!0;const w=p.graphics3DCalloutSymbolLayer;if(w&&h.hasLabelVerticalOffset){w.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,g,w,h,a);T!=null&&(p.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(T,r.stageLayer))}break}return n&&r.scaleVisibility?.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;i[r._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(WG(r))return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?yrt(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,u=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const h=e.graphics3DGraphic,p=o.labelClass,f=i.disablePlacement,g=Wce({graphics3DGraphic:h,labelSymbol:u,labelClass:p,disablePlacement:f});if(g==null)continue;const _=jle(g.anchor),v=tAe(_);e.textRenderers[n]=new KEe(l,v,o.textRenderParameters,Hb.maxSize),e.textLabelPlacements[n]=g}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new Jce(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=vL(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r?.emptySymbolLabelSupported||!1,n=r?.elevationInfoOverride||null,o=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new Tyt(this.view._stage,a,e,i,s,n,o,vL(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>vL(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>qG(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(qG(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function qG(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function WG(t){return!t||t.length===0}function vL(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}d([m({constructOnly:!0})],ub.prototype,"view",void 0),d([m({constructOnly:!0})],ub.prototype,"deconflictor",void 0),d([m()],ub.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],ub.prototype,"updating",null),ub=d([U("esri.views.3d.layers.graphics.Labeler")],ub);const id=new Hnt(null,null,null);let vP=class _S{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=Vt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ol.VISIBLE_ON_SURFACE,screenRect:Vt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=_S.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new _S(i,r,s,this.tilingScheme),new _S(i,r+1,s,this.tilingScheme),new _S(i,r,s+1,this.tilingScheme),new _S(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,u0(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var Ol;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ol||(Ol={}));function Syt(t,e,i,r,s,n,o=1){const a=Q_(e,s,Wk);if(a==null)return!1;if(a===gs){if(t===r&&i===n)return!0;const c=i+o;for(let u=i,h=n;u<c;++u,++h)ae(r[h],t[u]);return!0}const l=i+o;for(let c=i,u=n;c<l;++c,++u)a(t[c],0,r[u],0);return!0}const fMe=.5*Math.PI,Cyt=fMe/Math.PI*180;let Eyt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let i=0;i<4;i++)this._extent[i]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[i]=Ui();this._planes[ar.NEAR]=Ui(),this._planes[ar.FAR]=Ui(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),me(this._center.origin,n[0].origin,n[2].origin),ie(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ie(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,S0(a.cap.direction,a.origin,l.origin),KO(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ie(a.direction,a.direction,-1)}KO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[ar.NEAR]),s?Q8(this._planes[ar.NEAR],this._planes[ar.FAR]):(tU(this._planes[ar.FAR],this._planes[ar.NEAR]),Q8(this._planes[ar.NEAR],this._planes[ar.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*er(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ne.Global){const n=this._maxSpanSpatialReference.isGeographic?Cyt:fMe*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(Ou(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(Ou(o.origin,o.direction))||e.intersectsLineSegment(cw(o.origin,o.cap.next,Myt),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(PQe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){AY(e,rd),rd[2]=r,Io(i,rd,YG,this._renderCoordsHelper.spatialReference),Is(Qce,YG),Or(Xl);for(const{x0:n,x1:o,y0:a,y1:l}of Ayt)for(let c=0;c<5;c++){const u=c/4;rd[0]=Et(e[n],e[o],u),rd[1]=Et(e[a],e[l],u),rd[2]=r,_o(rd,i,rd,this._renderCoordsHelper.spatialReference),Ve(rd,rd,Qce),pp(Xl,rd)}te(this._extent[0].origin,Xl[0],Xl[1],Xl[2]),te(this._extent[1].origin,Xl[3],Xl[1],Xl[2]),te(this._extent[2].origin,Xl[3],Xl[4],Xl[2]),te(this._extent[3].origin,Xl[0],Xl[4],Xl[2]);for(let n=0;n<4;++n)Ve(this._extent[n].origin,this._extent[n].origin,YG)}_toRenderBoundingExtentLocal(e,i,r){xU(e,i,Jm,this._renderCoordsHelper.spatialReference),te(this._extent[0].origin,Jm[0],Jm[1],r),te(this._extent[1].origin,Jm[2],Jm[1],r),te(this._extent[2].origin,Jm[2],Jm[3],r),te(this._extent[3].origin,Jm[0],Jm[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Ne.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Ne.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(fr(e.planes[ar.NEAR],this._center.origin)<0&&pe(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(fr(e.planes[ar.NEAR],r.origin)<0&&pe(r.direction,e.direction)<0)return!0}return!1}};const Ayt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],rd=C(),YG=xe(),Qce=xe(),Xl=pn(),Jm=Vt(),Myt=Cp();let Pyt=class{constructor(e,i){this._renderCoordsHelper=e,this._getIsGroundOpaque=i,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=C(),this._frustumBoundingSphereRadius=0,this._frustum=new E_(e),this._extendedFrustum=new E_(e),this._intersector=new Eyt({renderCoordsHelper:e}),this._renderSR=e.spatialReference;const r=qs(this._renderSR);this._renderSREllipsoidRadius=er(r).radius,this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),rue(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const i=this._renderCoordsHelper.viewingMode===Ne.Global&&e.lij[0]>=Oyt&&e.lij[0]<Ryt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==Ol.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_calculateAggregatedChildrenVisibility(e){let i=Ol.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=iue.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Ol.INVISIBLE&&(i=o,o===Ol.VISIBLE_ON_SURFACE))break}return iue.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ne.Global&&e.lij[0]<$yt?this._calculateSingleTileVisibilitySided(e,!1)===Ol.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Ne.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=jyt;fe(r,e.direction);const s=e.points,n=Hyt;yi(n,s[4],i);const o=.5*pe(n,n)/pe(r,n),a=this._frustumBoundingSphereCenter;hn(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._renderSR,n=kyt;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!jr(n,i,0,n,s,0,2))return!1;const o=nue;te(o[0],n[0],n[1],0),te(o[1],n[3],n[1],0),te(o[2],n[3],n[4],0),te(o[3],n[0],n[4],0);const a=oue;te(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const l=Uyt;te(l,0,0,1);const c=.5*P_(o[0],o[2]),u=this._frustum,h=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=Wyt;yi(f,p,a);const g=pe(l,f),_=qyt;if(hn(_,a,l,g),P_(_,p)>c+h)return!1;const v=Fyt,b=this._isGroundOpaque&&this._aboveGround,w=this._isGroundOpaque&&!this._aboveGround,T=Math.min(w?EA:1/0,g+h),S=Math.max(b?-EA:-1/0,g-h);for(let A=0;A<4;++A)hn(v[A],o[A],l,T),hn(v[A+4],o[A],l,S);return!Q7(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround;if(e.lij[0]<mMe)return!0;const o=nue,a=.5*(r[0]+r[2]);if(te(o[0],r[0],r[1],0),te(o[1],r[2],r[1],0),te(o[2],r[2],r[3],0),te(o[3],r[0],r[3],0),te(o[4],a,r[1],0),te(o[5],a,r[3],0),!Syt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,u=l||c,h=this._renderSREllipsoidRadius;if(u){const Q=Ce(0,0,1),ee=zyt;Yy(ee,Q,o[0]);const de=Byt;if(Yy(de,Q,o[1]),l){const we=aue,Re=o[4],tt=lue;Yy(tt,Re,Q),Yy(we,tt,Re);const Ye=o[0];Ke(Ye,ee,we),CA(Ye,h);const qe=o[1];Ke(qe,de,we),CA(qe,h)}else if(c){const we=aue,Re=o[5],tt=lue;Yy(tt,Re,Q),Yy(we,Re,tt);const Ye=o[3];Ke(Ye,we,ee),CA(Ye,h);const qe=o[2];Ke(qe,we,de),CA(qe,h)}}const p=oue;{const Q=yi(Jyt,o[3],o[0]);fe(Q,Q);const ee=me(Qyt,o[0],o[3]);ie(ee,ee,.5);const de=-pe(ee,Q),we=me(Kyt,o[0],o[1]);ie(we,we,.5);const Re=me(e_t,o[2],o[3]);ie(Re,Re,.5);const tt=yi(t_t,Re,we);fe(tt,tt);const Ye=-(de+pe(Q,we))/pe(Q,tt);hn(p,we,tt,Ye),CA(p,h)}const f=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,_=this._frustum,v=_.planes,b=Vyt;fe(b,p);const w=pe(o[0],b)/ja(o[0]),T=_.origin,S=_.points;let A=!1;if(s){{A=!0;const ee=fe(C(),T);for(let de=0;de<4;++de){const we=S[4+de],Re=yi(C(),we,T);fe(Re,Re);const tt=Ke(C(),ee,Re);fe(tt,tt);const Ye=Ke(C(),Re,tt);if(fe(Ye,Ye),pe(T,Ye)>h){A=!1;break}}}if(A&&pe(T,b)<h*w-EA)return!1;const Q=fe(y_t,_.origin);if(pe(Q,b)<0)return!1;{const ee=fe(__t,_.direction);if(pe(ee,b)>v_t)return!1}}const P=Math.sqrt(1-w*w);if(P>.9)return!0;let R=!1;{const Q=pe(b,g),ee=ja(g);if(ee<=f&&!v.some(Re=>fr(Re,XG)>0)){if(!s)return!0;R=!0}const de=Q/ee;if(!R&&Q<=0&&-Q>f)return!1;const we=f/ee;if(Math.sqrt(1-de*de)*Math.sqrt(1-we*we)-we*de>P)return!1}if(!A&&(o.some(Q=>_.intersectsPoint(Q))||_.intersectsPoint(p)))return!0;const F=Yyt;yi(F,g,XG);const k=pe(F,b),N=Gyt;ie(N,b,k);const j=P_(N,g),z=i.isWGS84,X=e.lij,q=z&&X[2]===2**X[0]-1,Z=z&&X[2]===0,ce=Z?h_t:q?c_t:a_t,I=Z?d_t:q?u_t:l_t;if(!R){const Q=o,ee=p_t,de=i_t,we=r_t,Re=XG;for(const tt of ce){const Ye=Q[tt];if(sue(de,Q[(tt+1)%4],Ye),sue(we,Re,Ye),Yy(ee,we,de),Nyt(ee,S,1))return!1}}let D=null;if(!s&&k<1.01*f){const Q=2.5*f;if(j>w*Q+f)return!1;const ee=Zyt,de=Q/w;for(let we=0;we<4;++we)ie(ee[we],o[we],de/h);te(ee[4],0,0,0),D=ee}else{const Q=(n?h+EA:k+f)/w,ee=s?h-EA:(k-f)/w,de=Xyt;for(let we=0;we<4;++we){const Re=o[we];ie(de[we],Re,ee/h),ie(de[we+4],Re,Q/h)}D=de}if(Q7(v,D,D.length))return!1;const G=_.lines,H=s_t,J=n_t;for(const Q of G){fe(J,Q.direction);for(const ee of I){const de=D[ee];if(fe(H,de),ZG(J,H,D,S))return!1;const we=(ee+1)%4;if(s){const Re=D[we];if(yi(H,Re,de),fe(H,H),ZG(J,H,D,S))return!1}if(n){const Re=D[4+ee],tt=D[4+we];if(yi(H,tt,Re),fe(H,H),ZG(J,H,D,S))return!1}}}return!0}_calculateSingleTileVisibilitySided(e,i){return this._isTileVisibleInFrustum(e)?(this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?Ol.VISIBLE_ON_SURFACE:Ol.VISIBLE_WHEN_EXTENDED):Ol.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),rue(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,nu);this._aboveGround||Yn(i,i);const r=Zn(-pe(i,e.viewForward));if(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum)return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,nu),a){case ot.FAR_BOTTOM_LEFT:case ot.FAR_TOP_LEFT:case ot.NEAR_BOTTOM_LEFT:case ot.NEAR_TOP_LEFT:K8(this._extendedFrustum.planes[ar.LEFT],nu,nu);break;case ot.FAR_BOTTOM_RIGHT:case ot.FAR_TOP_RIGHT:case ot.NEAR_BOTTOM_RIGHT:case ot.NEAR_TOP_RIGHT:K8(this._extendedFrustum.planes[ar.RIGHT],nu,nu)}ie(nu,nu,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Ou(l,nu),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ba(n[ot.NEAR_BOTTOM_LEFT],n[ot.NEAR_BOTTOM_RIGHT],n[ot.NEAR_TOP_RIGHT],eue),ba(n[ot.NEAR_BOTTOM_RIGHT],n[ot.NEAR_TOP_RIGHT],n[ot.NEAR_TOP_LEFT],tue),pe(eue,tue)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[ot.NEAR_BOTTOM_LEFT],o[ot.NEAR_BOTTOM_RIGHT]]=[o[ot.NEAR_BOTTOM_RIGHT],o[ot.NEAR_BOTTOM_LEFT]]:[o[ot.NEAR_TOP_LEFT],o[ot.NEAR_TOP_RIGHT]]=[o[ot.NEAR_TOP_RIGHT],o[ot.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Kce;return{zWithMargin:e,pointIndices:E_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Kce;return{zWithMargin:e,pointIndices:E_.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const Oyt=2,Ryt=6,$yt=12,Iyt=.95,Kce=1,nu=C(),eue=Ui(),tue=Ui(),iue=new Ko(Array,t=>{t.length!==4&&(t[0]=new vP,t[1]=new vP,t[2]=new vP,t[3]=new vP)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function rue(t){const e=E_.nearFarLineIndices,i=t.mutablePoints;for(const r of e){const[s,n]=r,o=i[s],a=i[n];_e(nu,a,o),ie(nu,nu,Iyt),me(i[n],o,nu)}t.updatePoints(i)}function Yy(t,e,i){return Ke(t,e,i),fe(t,t),t}function sue(t,e,i){return yi(t,e,i),fe(t,t),t}function CA(t,e){return ie(t,t,e/ja(t)),t}const Lyt=[ar.LEFT,ar.RIGHT,ar.BOTTOM,ar.TOP,ar.FAR];function Dyt(t,e,i){for(let r=0;r<i;++r)if(fr(t,e[r])<=0)return!1;return!0}function Q7(t,e,i){for(const r of Lyt)if(Dyt(t[r],e,i))return!0;return!1}const mMe=4;function Nyt(t,e,i){for(const r of e)if(pe(r,t)<i)return!1;return!0}const Fyt=[C(),C(),C(),C(),C(),C(),C(),C()],kyt=[0,0,0,0,0,0],nue=[C(),C(),C(),C(),C(),C()],oue=C(),Uyt=C(),aue=C(),zyt=C(),Byt=C(),lue=C(),Vyt=C(),Gyt=C(),jyt=C(),Hyt=C(),qyt=C(),Wyt=C(),XG=Ce(0,0,0),Yyt=C(),Xyt=[C(),C(),C(),C(),C(),C(),C(),C()],Zyt=[C(),C(),C(),C(),C()],Jyt=C(),Qyt=C(),Kyt=C(),e_t=C(),t_t=C(),i_t=C(),r_t=C(),s_t=C(),n_t=C(),o_t=C(),a_t=[0,1,2,3],l_t=[0,1,2,3],c_t=[0,1,3],u_t=[0,1,3],h_t=[1,2,3],d_t=[1,2,3],p_t=C();function f_t(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=pe(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function m_t(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=pe(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const g_t=[0,0];function ZG(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=o_t;Yy(s,t,e);const n=r[0]<i[0],o=n?i:r,a=g_t;return f_t(a,s,n?r:i),m_t(a[0],a[1],s,o)}const EA=430,y_t=C(),__t=C(),v_t=Math.cos(.25*Math.PI);let b_t=class{constructor(e){this._camera=new br,this._focusOnMap=[0,0],this._screenRect=Vt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Pyt(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,yk(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=MDe(e.extent,this._focusOnMap),e.measures.visibility!==Ol.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=w_t,r=1<<i,s=e.measures.screenRect;Mu(s);let n=0;const o=e.lij,a=o[0],l=a+i,c=o[1]<<i,u=o[2]<<i,h=this._tileSizeWithBias(e),p=h*h,f=this._camera,{frustum:g,viewport:_}=f;if(this._renderCoordsHelper.viewingMode===Ne.Local||a>mMe){const v=cue;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=_T,w=S_t,T=Mu();for(let P=0;P<4;++P)this._toRenderCoords(v,due[P][0],due[P][1],w[P]),f.projectToScreen(w[P],b[P]),EY(T,b[P]);const S=Q7(g,w,4),A=T[0]>_[2]||T[1]>_[3]||T[2]<_[0]||T[3]<_[1];if(S||A)return void(e.measures.shouldSplit=!1)}for(let v=0;v<r;v++)for(let b=0;b<r;b++)if(n+=this._computeScreenArea(l,c+v,u+b,s),n>p)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Ol.VISIBLE_WHEN_EXTENDED?this._tileSize*x_t:this._tileSize}_computeScreenArea(e,i,r,s){this._tilingScheme.ensureMaxLod(e);const n=cue;this._tilingScheme.getExtent(e,i,r,n);const o=T_t;return this._toRenderCoords(n,0,3,o[0]),this._toRenderCoords(n,2,3,o[1]),this._toRenderCoords(n,2,1,o[2]),this._toRenderCoords(n,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],s)+this._computeTriangleScreenArea([o[2],o[1],o[3]],s)}_computeTriangleScreenArea(e,i){const r=this._camera.frustum[ar.NEAR];let s=0,n=-1,o=-1;for(let a=0;a<3;++a)fr(r,e[a])>0?(s++,n===-1&&(n=a)):o===-1&&(o=a);if(s===0)return this._computeTriangleScreenAreaInside(e,i);if(s===1){const a=hue,l=(n+1)%3,c=(n+2)%3,u=n;ae(a[0],e[l]),ae(a[1],e[c]),wL(a[2],e[c],e[u],r);const h=this._computeTriangleScreenAreaInside(a,i);return wL(a[1],e[l],e[u],r),h+this._computeTriangleScreenAreaInside(a,i)}if(s===2){const a=hue,l=o;ae(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return wL(a[1],e[l],e[c],r),wL(a[2],e[l],e[u],r),this._computeTriangleScreenAreaInside(a,i)}return 0}_computeTriangleScreenAreaInside(e,i){for(let r=0;r<3;r++)this._camera.projectToRenderScreen(e[r],uue),this._camera.renderToScreen(uue,_T[r]),R_(i,_T[r],i);return sJe(_T[0],_T[1],_T[2])}_toRenderCoords(e,i,r,s){return bL[0]=e[i],bL[1]=e[r],bL[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(bL,this._tilingScheme.spatialReference,s),s}};const w_t=2,x_t=5,_T=[ns(),ns(),ns(),ns()],cue=Vt(),bL=C(),T_t=[C(),C(),C(),C()],uue=Jo(),hue=[C(),C(),C()];function wL(t,e,i,r){const s=fr(r,e),n=fr(r,i),o=Math.abs(n-s);ie(t,e,Math.abs(n)/o),hn(t,t,i,Math.abs(s)/o)}const S_t=[C(),C(),C(),C()],due=[[0,3],[2,3],[2,1],[0,1]];function _Vt(t,e,i){if(t==null||i==null)return!1;let r=!0;return Tn[0]=t.xmin!=null?t.xmin:0,Tn[1]=t.ymin!=null?t.ymin:0,Tn[2]=t.zmin!=null?t.zmin:0,r=r&&jr(Tn,t.spatialReference,0,e,i,0,1),Tn[0]=t.xmax!=null?t.xmax:0,Tn[1]=t.ymax!=null?t.ymax:0,Tn[2]=t.zmax!=null?t.zmax:0,r=r&&jr(Tn,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function gMe(t,e,i){if(t==null||i==null)return!1;let r=!0;return Tn[0]=t.xmin!=null?t.xmin:0,Tn[1]=t.ymin!=null?t.ymin:0,Tn[2]=t.zmin!=null?t.zmin:0,r=r&&jr(Tn,t.spatialReference,0,Tn,i,0,1),e[0]=Tn[0],e[1]=Tn[1],Tn[0]=t.xmax!=null?t.xmax:0,Tn[1]=t.ymax!=null?t.ymax:0,Tn[2]=t.zmax!=null?t.zmax:0,r=r&&jr(Tn,t.spatialReference,0,Tn,i,0,1),e[2]=Tn[0],e[3]=Tn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Tn=C();let Mo=class extends Pe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void le.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Vt();return gMe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new lt,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Gt}initialize(){this.addHandles([he(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Ji),he(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),qi),he(()=>this.terrain?.baseOpacity??1,()=>this._setDirty())]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(wt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=gr(this._frameWorker)}addClient(){const e=wu();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Mi(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(wc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=wt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=wt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new b_t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>(this.terrain?.baseOpacity??1)===1}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new vP(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){if(e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),!(e.length>E_t))return e.toArray();Mu(xL);for(let i=0;i<e.length;i++)if(R_(xL,e.data[i].measures.screenRect,xL),Il(xL)>C_t)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!bk(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Ol.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===Ol.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};d([m({constructOnly:!0})],Mo.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Mo.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],Mo.prototype,"tilingSchemeOwner",void 0),d([m({constructOnly:!0})],Mo.prototype,"cameraOnSurface",void 0),d([m({constructOnly:!0})],Mo.prototype,"focus",void 0),d([m({constructOnly:!0})],Mo.prototype,"viewState",void 0),d([m({constructOnly:!0})],Mo.prototype,"terrain",void 0),d([m()],Mo.prototype,"tiles",void 0),d([m()],Mo.prototype,"tileSize",void 0),d([m({readOnly:!0})],Mo.prototype,"tilingScheme",null),d([m()],Mo.prototype,"filterExtent",null),d([m({readOnly:!0})],Mo.prototype,"_filterExtentRect",null),d([m({readOnly:!0})],Mo.prototype,"_rootTileIds",null),d([m({value:!1})],Mo.prototype,"suspended",null),d([m({readOnly:!0})],Mo.prototype,"updating",null),Mo=d([U("esri.views.3d.layers.support.FeatureTileTree3D")],Mo);const xL=Vt(),C_t=10,E_t=50;let ms=class extends Pe{constructor(){super(...arguments),this._propertiesPool=new g0({camera:br},this),this._lastSeenCameraProjectionValues=new br,this.mode=gi.ANIMATING,this._cssCamera=new br,this._camera=new br,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Ls,this.viewingMode=Ne.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new yg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new g0({camera:br},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ne.Global){const e=er(this.spatialReference).radius;this.camera=new br({eye:Ce(4*e,0,0),center:Ce(e,0,0),up:Ce(0,0,1)})}else this.camera=new br({eye:Ce(0,0,100),center:Ce(0,0,0),up:Ce(0,1,0)})}get animation(){return this.cameraController instanceof pR&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==Gu&&Gu.copyFrom(e),Gu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Gu);const i=this._camera;if(M_t(this._lastSeenCameraProjectionValues,Gu)&&(this._lastSeenCameraProjectionValues.copyFrom(Gu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(Gu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Gu),this._cameraChanged=!i.almostEquals(Gu),this._cameraChanged)){const r=Fpe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===gi.IDLE}get updating(){return this.mode!==gi.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ne.Global}get isLocal(){return this.viewingMode===Ne.Local}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(pue),this.addHandles(zl(()=>e.state===Yr.Finished||e.state===Yr.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),pue),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Yr.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Yr.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Gu.copyFrom(this._get("camera")),e(Gu),this.camera=Gu,this._processingUpdates=!1,this._processUpdateQueue()}};d([m()],ms.prototype,"mode",void 0),d([m({readOnly:!0,type:EC})],ms.prototype,"animation",null),d([m({type:br})],ms.prototype,"cssCamera",null),d([m()],ms.prototype,"_cssCamera",void 0),d([m({type:br})],ms.prototype,"camera",null),d([m()],ms.prototype,"_camera",void 0),d([m({readOnly:!0})],ms.prototype,"pixelRatio",null),d([m()],ms.prototype,"rasterPixelRatio",void 0),d([m()],ms.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],ms.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],ms.prototype,"updating",null),d([m({})],ms.prototype,"_contentCamera",void 0),d([m({type:br})],ms.prototype,"contentCamera",null),d([m({readOnly:!0})],ms.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],ms.prototype,"constraints",void 0),d([m({readOnly:!0})],ms.prototype,"events",void 0),d([m({readOnly:!0})],ms.prototype,"isGlobal",null),d([m({readOnly:!0})],ms.prototype,"isLocal",null),d([m({readOnly:!0})],ms.prototype,"viewingMode",void 0),d([m({readOnly:!0})],ms.prototype,"spatialReference",void 0),d([m()],ms.prototype,"navigating",null),d([m()],ms.prototype,"stationary",null),d([m()],ms.prototype,"_cameraChanged",void 0),d([m()],ms.prototype,"cameraController",null),ms=d([U("esri.views.3d.state.ViewState")],ms);const A_t=ms;function M_t(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[ei.TOP]!==e.padding[ei.TOP]||t.padding[ei.RIGHT]!==e.padding[ei.RIGHT]||t.padding[ei.BOTTOM]!==e.padding[ei.BOTTOM]||t.padding[ei.LEFT]!==e.padding[ei.LEFT]}const Gu=new br,pue="ViewStateHandles";function yMe(t){return t?D_t:N_t}function P_t(t,e){return e?.mode?e.mode:yMe(t).mode}function O_t(t,e){return e??yMe(t)}function _Me(t,e){return P_t(t!=null&&t.hasZ,e)}function wVt(t,e){return O_t(t!=null&&!!t.hasZ,e)}function xVt(t){const e=vMe(t);return _Me(t.geometry,e)}function TVt(t){const e=vMe(t),i=_Me(t.geometry,e),r=e!=null&&i!=="on-the-ground"?wMe(e):0,s=e?.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function SVt(t){return $_t(t)||R_t(t)}function R_t(t){return t?.featureExpressionInfo?.expression==="0"}function $_t(t){if(!t||t.mode==="on-the-ground")return!1;const e=t?.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function vMe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function VQ(t,e){if(!t?.offset)return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=Mfe(e);return n?Cn(i,s,n):0}function CVt(t,e,i){if(!i?.mode)return;const r=t.hasZ?t.z:0,s=VQ(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function EVt(t,e,i,r=null){return bMe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function AVt(t,e,i,r,s=null){return bMe(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function bMe(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=I_t(e,i,r,s,t,n);return L_t(l,e,i,r,s,t,o,a)}function I_t(t,e,i,r,s,n){const o=VQ(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function L_t(t,e,i,r,s,n,o,a){const l=VQ(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function MVt(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function PVt(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function OVt(t,e,i){return i?.mode===e?`${t} do not support ${e} elevation mode`:null}function RVt(t,e){return e?.featureExpressionInfo!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function $Vt(t,e){e&&t.warn(".elevationInfo=",e)}function wMe(t){return(t?.offset??0)*Yve(t?.unit)}const D_t={mode:"absolute-height",offset:0},N_t={mode:"on-the-ground",offset:null},F_t="OBJECTID";let IVt=class extends g${constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function xMe(t){return Uh(t)&&t.intersector===Fr.PCL&&!!t.target}let DVt=class extends Q1e{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},FVt=class extends g${constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},UVt=class extends g${constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function Sz(t){return Uh(t)&&t.intersector===Fr.I3S&&!!t.target}function TMe(t){return Uh(t)&&t.intersector===Fr.VOXEL&&!!t.target}function k_t(t){return Uh(t)&&t.intersector===Fr.TILES3D&&!!t.target}function SMe(t,e){return OU(t)||RU(t)?ER(t.target?.object,e):Blt(t)?e.map?.ground:xMe(t)||Sz(t)||UCe(t)||TMe(t)?ER(t.target,e):null}function BVt(t,e){const i=GQ(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function GQ(t,e){if(t==null)return null;if(OU(t)||RU(t))return fue(t.target?.object,e);if(xMe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(TMe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(k_t(t)){const i=t.target.createTiles3DGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return UCe(t)||NQ(t)?fue(t.target,e):Sz(t)?U_t(t.target,e):null}function fue(t,e){if(t?.graphicUid==null)return null;const i=ER(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function U_t(t,e){const i=ER(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?B_t(r.getGraphicFromIntersectorTarget(t)):null}function z_t(t,e){const i=ER(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function B_t(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function ER(t,e){return t?.layerUid==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function VVt(t,e){if(OU(t)||RU(t))return L_(t.target.object.boundingVolumeWorldSpace.bounds);if(NQ(t)){Vk(TL,t.transformation);const i=Math.max(TL[0],TL[1],TL[2]);return t.target.baseBoundingSphere.radius*i}if(Sz(t)){const i=z_t(t.target,e);return i?.5*p0e(i):null}return null}function GVt(t){return!OU(t)&&!RU(t)&&(NQ(t)?t.target.numLodLevels>1:!!Sz(t))}const TL=C();async function V_t(t,e,i,r){const s=i?AMe(t,i):r,n=ns(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=Nh(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Lo.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=j_t(t,o.results.all,s.graphics),l=o.results.ground,c=SMe(l,t),u=c!=null&&"type"in c&&jO(c.type)?c:null,h={screenPoint:e,results:a,ground:{mapPoint:e2(t,l),distance:Uh(l)?l.distanceInRenderSpace:0,layer:u}};return wr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=o),h}function G_t(t,e,i,r){const s=i?AMe(t,i):r,n=!(!s.graphics?.include&&!s.graphics?.exclude),o=!(!s.mediaElements?.include&&!s.mediaElements?.exclude),a=zd(e);s.enableDraped=s.include&&!s.include.has(nv)||s.exclude?.has(nv);const l=t.sceneIntersectionHelper,c=Nh(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?Lo.ALL:Lo.MIN,c.options.hud=!i?.excludeHud,l.intersectIntersectorScreen(a,c,s),n||o){for(const u of c.results.all){const h=GQ(u,t);if(h==null||n&&(h.type!=="graphic"||CMe(s.graphics,h.graphic))||o&&(h.type!=="media"||EMe(s.mediaElements,h.element)))return e2(t,u)}return null}return e2(t,c.results.min)}function j_t(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=SMe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&jO(a.type)))break;const l=GQ(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const h=jQ(l.graphic);if(s.has(h))continue;s.add(h)}if(!CMe(i,l.graphic))continue}const c=e2(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const h=l.element.toSource(c);r.push({...l,mapPoint:c,distance:u,sourcePoint:h})}else r.push({...l,mapPoint:c,distance:u})}return r}function e2(t,e,i){return e.getIntersectionPoint(t2)?(i=K7(t,t2,i),e.intersector===Fr.TERRAIN&&t.basemapTerrain&&(i.z=Bf(t.basemapTerrain,i)??0),i):null}function jQ(t){const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const s=r.objectIdField??F_t,n=t.attributes?.[s];if(n)return`o-${r.id}-${n}`}return`u-${t.uid}`}function CMe(t,e){return EMe(t,jQ(e))}function EMe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function K7(t,e,i){let r=t.spatialReference||We.WGS84;return _o(e,t.renderSpatialReference,t2,r)?e=t2:(r=We.WGS84,_o(e,t.renderSpatialReference,t2,r)&&(e=t2)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new Xe(e,r),i}function AMe(t,e){const i=eW(t,e.include,zC.INCLUDE),r=eW(t,e.exclude,zC.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function eW(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof X_)H_t(r,jQ(e)),i===zC.INCLUDE&&(t.graphicsView!=null&&e.layer===t?vT(r,t.graphicsView.processor.layer.id):e.layer&&vT(r,e.layer.uid));else if("layer"in e&&"element"in e)q_t(r,e.element),i===zC.INCLUDE&&vT(r,e.layer.uid);else if(tj(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?vT(r,t.graphicsView.processor.layer.id):s===t.map.ground?vT(r,nv):eW(t,s,i,r);else"uid"in e&&vT(r,e.uid);return r}function vT(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function H_t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function q_t(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const t2=C();var zC;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(zC||(zC={}));let W_t=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Gt,this._tolerance=SC,this._tmpRay=Gn(),this._tmpRegion=Vt(),this._validateHUDIntersector=Nh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),mue(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,mue(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=Lo.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(CL,r,s),CL[0]+=.0466,CL[1]-=.0123,gJ(e,CL,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Uh(s)&&s.intersector!==Fr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=SC){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Fr.TERRAIN?1:r.type===Fr.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Fr.TERRAIN?1:r.type===Fr.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return mJ(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Ne.Local||e==null||me(i,e.origin,fe(ze.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=LO(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=wMe(i)/a,u=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:h}=n.state;if(l==="absolute-height"){const S=o?.getAltitude(h.eye),A=pe(fe(AA,e.direction),o.worldUpAtPosition(h.eye,Z_t));if(S<u&&A<0||S>=u&&A>0)return null;if(o.intersectInfiniteManifold(e,u,AA)){const P=K7(n,AA);return P.z??(P.z=0),P.z-=c,P}return null}const p=ze.get();h.projectToRenderScreen(e.origin,p);const f=new gue(null,this._forEachLayer),{slicePlane:g}=n,_=g!=null?Pre(g):null,v=Nh(this.viewingMode);v.options.store=Lo.MIN,v.options.verticalOffset=u,v.options.normalRequired=!1;const b=e.origin,w=me(ze.get(),b,e.direction);v.reset(b,w,h),v.point=p;const T=s?"type"in s&&s.type==="graphics"?S=>S.layerUid!==s.uid:S=>S.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const S=A=>(!T||T(A))&&!!A.lastValidElevationBB;v.intersect(f.layers,p,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(A=>{if(A.type===Fr.I3S||A.type===Fr.TERRAIN||A.type===Fr.TILES3D){const P=A.slicePlaneEnabled?_:null;A.intersect(v,P,v.rayBegin,v.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const A=S.slicePlaneEnabled?_:null;S.intersect(v,A,v.rayBegin,v.rayEnd,p)}})}if(v.results.min.getIntersectionPoint(AA)){const S=K7(n,AA);return S.z=r,S}return null}computeIntersection(e,i,r,s){if(e==null)return;const n=this._view.state.camera,o=ze.get();n.projectToRenderScreen(e.origin,o);const a=new gue(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=me(ze.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,h=u!=null?Pre(u):null;i.intersect(a.sliceableLayers,o,this._tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const v=_.layerUid,b=Array.isArray(v),w=b?v:[v];b&&(i.options.filteredLayerUids=[]);let T=!1;for(const S of w)a.filterLayerUid(S)?T=!0:b&&i.options.filteredLayerUids.push(S);if(i.options.isFiltered=!T,_.isGround&&p||!i.options.isFiltered){const S=_.slicePlaneEnabled?h:null;_.intersect(i,S,l,c,o,s)}});const f=ze.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(f)){const _=g.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,b=ze.get();this._view.renderCoordsHelper.fromRenderCoords(f,b,g.spatialReference),b[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],v,"ground")??0,_.intersect(i,b,i.results.ground,w=>a.filterRenderGeometry(w))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;u0(this._tmpRegion,Lj);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new X_t(b);r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),EY(n,w.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-bP),u=Math.max(0,n[1]-bP),h=Math.min(Ta(n)+2*bP,a-c),p=Math.min(Il(n)+2*bP,l-u);if(h<=0||p<=0)return;const f=new Uint8Array(h*p*4);this._view._stage.renderer.readHUDVisibility(c,u,h,p,f);let g=!0;const _=e.results.max.dist==null;let v=0;for(const b of s)for(const w of Y_t){const T=4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*h);if(!(T<0||T>=f.length)&&f[T]){g&&(e.results.min.copy(b.result),g=!1),_&&e.results.max.copy(b.result),e.options.store===Lo.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const bP=1,Y_t=(()=>{const t=[],e=bP;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let X_t=class{constructor(e){this.result=e,this.screenPoint=Jo()}},SL;function mue(t){return SL&&SL.viewingMode===t||(SL=Nh(t)),SL}let gue=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function yue(t){return typeof t=="object"&&"intersect"in t}const AA=C(),Z_t=C(),CL=Jo();let WVt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},J_t=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(wt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(wc);else for(const i of this._queries)i.result.reject(vi())}queryElevation(e,i,r,s=0){const n=Pn(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),un(r,()=>{Nde(this._queries,o),n.reject(vi())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const s=i.map(u=>[u.x,u.y]),n=i.reduce((u,h)=>Math.min(u,h.minDemResolution),1/0),o=new JC({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(h=>un(h.signal,()=>{u++,h.result.reject(vi()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((h,p)=>{h.signal!=null&&h.signal.aborted?h.result.reject(vi()):h.result.resolve(u.geometry.points[p][2])})}).catch(u=>{i.forEach(h=>h.result.reject(u))}),e.madeProgress()}get test(){}},D5=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},wP=class extends Ls.EventedMixin(Pe){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Oe(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&ls(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=EL(o,this._im,e,i,r,s,n),o==null&&(o=EL(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=EL(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new D5;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new D5;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?EL(c,this._scene,e,i,r,s,n):c}catch(c){return a0(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&ls(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new J_t(this.view.resourceController.scheduler,new We({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function EL(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([m({constructOnly:!0})],wP.prototype,"view",void 0),d([m()],wP.prototype,"spatialReference",null),wP=d([U("esri.views.3d.support.CombinedElevationProvider")],wP);let AR=class tW{static isValidProfile(e){return e in tW.profiles}static getDefaultProfile(){return se("esri-iPhone")?"low":"medium"}static apply(e,i){const r=tW.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};AR.test={reset(){const t=MMe();for(const e of Object.keys(t))AR.profiles[e]=t[e]}};const MA={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function MMe(){const t=!!se("esri-mobile"),e=!!se("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+MA.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+MA.GalaxyS20:750+MA.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+MA.SurfacePro7:1500+MA.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=MMe()})(AR||(AR={}));const DN=AR,PMe=new et([0,255,255]),OMe=1,RMe=.25,$Me=new et([0,0,0]),IMe=.4,LMe=.2;let vf=class extends Pe{constructor(){super(...arguments),this.color=PMe.clone(),this.haloColor=null,this.haloOpacity=OMe,this.fillOpacity=RMe,this.shadowOpacity=IMe,this.shadowColor=$Me.clone(),this.shadowDifference=LMe}};d([m({type:et})],vf.prototype,"color",void 0),d([m({type:et})],vf.prototype,"haloColor",void 0),d([m()],vf.prototype,"haloOpacity",void 0),d([m()],vf.prototype,"fillOpacity",void 0),d([m()],vf.prototype,"shadowOpacity",void 0),d([m({type:et})],vf.prototype,"shadowColor",void 0),d([m()],vf.prototype,"shadowDifference",void 0),vf=d([U("esri.views.3d.support.HighlightOptions")],vf);const DMe=vf;function Q_t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function K_t(t){return typeof t=="string"?Hs(t):ge(t)}function evt(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>evt(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i?.[s]);r[s]=e?o:JSON.stringify(o)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}function KVt(t){return{geometryType:RY(t[0]),geometries:t.map(e=>e.toJSON())}}function tvt(t,e,i){const r=BDe(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let hb=class extends Me{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=fee(this.outSpatialReference),r.inSR=fee(i.spatialReference),r.geometries=JSON.stringify({geometryType:RY(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};d([m()],hb.prototype,"geometries",void 0),d([m({json:{read:{source:"outSR"}}})],hb.prototype,"outSpatialReference",void 0),d([m()],hb.prototype,"transformation",void 0),d([m()],hb.prototype,"transformForward",void 0),hb=d([U("esri.rest.support.ProjectParameters")],hb);const HQ=hb,ivt=mo(HQ);async function NMe(t,e,i){e=ivt(e);const r=K_t(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=RY(e.geometries[0]),a=Q_t(s,i);return Yi(r.path+"/project",a).then(({data:{geometries:l}})=>tvt(l,o,n))}async function qQ(t=null,e){if(Gi.geometryServiceUrl)return Gi.geometryServiceUrl;if(!t)throw new W("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||Ea.getDefault():t,await i.load({signal:e});const r=i.helperServices?.geometry?.url;if(!r)throw new W("internal:geometry-service-url-not-configured");return r}async function rvt(t,e,i=null,r){const s=await qQ(i,r),n=new HQ({geometries:[t],outSpatialReference:e}),o=await NMe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new W("internal:geometry-service-projection-failed")}const svt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:qQ,projectGeometry:rvt},Symbol.toStringTag,{value:"Module"}));let nvt=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=sl(this.spatialReference,er(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=qQ(r).catch(()=>{throw new W("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof Xe?l:new Xe(l,this.spatialReference)),o=new HQ({geometries:n,outSpatialReference:We.WGS84}),a=(await NMe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}};var Nt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Nt||(Nt={}));const db=[Nt.ELEVATION,Nt.MAP];async function ovt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+avt),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const avt=.05;async function lvt(t,e){const{results:i,ground:r}=await ovt(t,e),s=(!r.layer||!jO(r.layer.type))&&r.mapPoint,n=[],o=hvt(t),a=s?cvt(t,o):uvt;let l=0,c=0;const u=()=>{const p=a.layerViews[c];s&&p&&"fetchPopupFeaturesAtLocation"in p&&n.push({mapPoint:r.mapPoint,layerView:p}),++c};let h=null;for(;l<i.length||c<a.layerViews.length;){const p=i[l];if(p&&p.type!=="graphic")++l;else if(p?.layer?.type!=="scene"||p?.layer?.parent!==t?.map?.basemap)if(p){const f=p.layer?.uid,g=a.layerUids.has(f)&&p.distance===r.distance,_=o.get(p.layer?.uid);if(h??(h=p.mapPoint),c<a.layerViews.length&&(g||(p.distance??0)>r.distance)&&a.layerViews[c]!==_){u();continue}n.push({graphic:p.graphic,layerView:_}),++l}else u();else++l}return h??(h=r.mapPoint),{hits:n,location:h}}function cvt(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(Nt.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,Nt.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const uvt={layerUids:new Set,layerViews:[]};function hvt(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let ru=class extends Pe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};d([m()],ru.prototype,"minTotalNumberOfFeatures",void 0),d([m()],ru.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],ru.prototype,"maxNumberOfDrawCalls",void 0),d([m()],ru.prototype,"maxTotalNumberOfVertices",void 0),d([m()],ru.prototype,"snapshotAvailable",void 0),d([m()],ru.prototype,"polygonLodFactor",void 0),d([m()],ru.prototype,"polylineLodFactor",void 0),d([m()],ru.prototype,"skipHighSymbolLods",void 0),d([m()],ru.prototype,"uncompressedTextureDownsamplingEnabled",void 0),ru=d([U("esri.views.3d.support.QualitySettings.Graphics3DSettings")],ru);let Qd=class extends Pe{constructor(){super(...arguments),this.lodFactor=1}};d([m()],Qd.prototype,"lodFactor",void 0),Qd=d([U("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Qd);let Rg=class extends Pe{constructor(){super(...arguments),this.object=new Qd,this.point=new Qd,this.integratedMesh=new Qd,this.pointCloud=new Qd,this.uncompressedTextureDownsamplingEnabled=!1}};d([m({type:Qd})],Rg.prototype,"object",void 0),d([m({type:Qd})],Rg.prototype,"point",void 0),d([m({type:Qd})],Rg.prototype,"integratedMesh",void 0),d([m({type:Qd})],Rg.prototype,"pointCloud",void 0),d([m()],Rg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Rg=d([U("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Rg);let $g=class extends Pe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};d([m()],$g.prototype,"lodBias",void 0),d([m()],$g.prototype,"angledSplitBias",void 0),d([m()],$g.prototype,"vtlContentZoom",void 0),d([m()],$g.prototype,"elevationLevelDelta",void 0),d([m()],$g.prototype,"reduceTileLevelDifferences",void 0),$g=d([U("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],$g);let i2=class extends Pe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],i2.prototype,"pixelRatio",void 0),d([m()],i2.prototype,"maxTotalNumberOfFeatures",void 0),i2=d([U("esri.views.3d.support.QualitySettings.HeatmapSettings")],i2);let Vo=class extends Pe{constructor(){super(...arguments),this.graphics3D=new ru,this.sceneService=new Rg,this.tiledSurface=new $g,this.heatmap=new i2,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:ru})],Vo.prototype,"graphics3D",void 0),d([m({type:Rg})],Vo.prototype,"sceneService",void 0),d([m({type:$g})],Vo.prototype,"tiledSurface",void 0),d([m({type:i2})],Vo.prototype,"heatmap",void 0),d([m()],Vo.prototype,"fadeDuration",void 0),d([m()],Vo.prototype,"antialiasingEnabled",void 0),d([m()],Vo.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],Vo.prototype,"highQualityTransparency",void 0),d([m()],Vo.prototype,"highResolutionAtmosphere",void 0),d([m()],Vo.prototype,"reflections",void 0),d([m()],Vo.prototype,"ambientOcclusion",void 0),d([m()],Vo.prototype,"memoryLimit",void 0),d([m()],Vo.prototype,"additionalCacheMemory",void 0),d([m()],Vo.prototype,"frameRate",void 0),d([m()],Vo.prototype,"maximumPixelRatio",void 0),Vo=d([U("esri.views.3d.support.QualitySettings")],Vo);const _ue=Vo;let dvt=class iW{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=F8e(s),this.referenceEllipsoid=er(i),this.sphericalPCPF=qs(i)}set extent(e){e&&k8e(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return q8e(this._coordinateSystem,e)}setAltitude(e,i,r=e){return M1e(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){W8e(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return V8e(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return G8e(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,Xr.X,ze.get()),s=this.worldBasisAtPosition(e,Xr.Y,ze.get()),n=this.worldBasisAtPosition(e,Xr.Z,ze.get());return Sm(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,ze.get()),s=this.worldBasisAtPosition(e,Xr.Y,ze.get()),n=B_e(i,s,r);return ea(n)}intersectManifoldClosestSilhouette(e,i,r){return AB(this._coordinateSystem,i,this._tmpCoordinateSystem),H8e(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){AB(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=ze.get();return j8e(this._tmpCoordinateSystem,e,s)?ae(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Ne.Global)return this.intersectManifold(e,i,r);AB(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=ze.get();return fx(s.plane,e,n)?ae(r,n):null}toRenderCoords(e,i,r){return R4(e)?ts(e,i,this.spatialReference):_o(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return R4(i)?(r!=null&&(i.spatialReference=r),Sv(e,this.spatialReference,i)?i:null):_o(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case Ne.Local:return new iW(Ne.Local,i,sl(i),B8e());case Ne.Global:return new iW(Ne.Global,i,1,z8e(i))}}static renderUnitScaleFactor(e,i){return Cj(e)/Cj(i)}};var kf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(kf||(kf={}));const pvt=(()=>{const t=new Array;return t[kf.ELEVATION]=10,t[kf.BASEMAP]=10,t[kf.I3S_INDEX]=10,t[kf.I3S_DATA]=10,t[kf.SYMBOLOGY]=5,t})(),fvt=30;function mvt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function gvt(t){return new Ua({view:t})}const vue=.1,AL=1,JG=1,yvt=.75,_vt=.6,bue=1.3;let Ua=class extends Pe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new VCe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(xw({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(AL),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new Ylt(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<_vt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(AL);else if(e)(this._memoryPredicted>1.1*JG||this._usedMemory>JG)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>vue&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/bue),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>JG)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/bue),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<yvt&&this._quality<AL){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,vue),AL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();const e=this.view._stage?.renderer?.usedMemory;let i=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(mvt(a)){const l=a.ignoresMemoryFactor?this._quality:1;i+=a.usedMemory*l,r+=a.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);le.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(i)} Projected: ${a(i+r)} Quality: ${l}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};d([m({constructOnly:!0})],Ua.prototype,"view",void 0),d([m()],Ua.prototype,"maxMemory",null),d([m()],Ua.prototype,"additionalCacheMemory",null),d([m({readOnly:!0})],Ua.prototype,"memoryFactor",null),d([m({readOnly:!0})],Ua.prototype,"updating",null),d([m({readOnly:!0})],Ua.prototype,"usedMemory",null),d([m({readOnly:!0})],Ua.prototype,"usedCacheMemory",null),d([m()],Ua.prototype,"_quality",void 0),d([m()],Ua.prototype,"_usedMemory",void 0),d([m()],Ua.prototype,"_updating",void 0),d([m()],Ua.prototype,"_stableQuality",void 0),d([m()],Ua.prototype,"_maxMemory",void 0),d([m()],Ua.prototype,"_additionalCacheMemory",void 0),Ua=d([U("esri.views.3d.support.MemoryController")],Ua);let vvt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},bvt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new wvt}},wvt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},xvt=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new bvt(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,at(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},Tvt=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function vS(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function FMe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function kMe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function Cz(t){return t!=null&&"type"in t&&t.type==="image+type"}let NN=class extends Pe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new xvt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(wt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=gr(this._frameTask),this._tasks.forEach(e=>il(e.abortController)),this._loadQueue=Oe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=Pn();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return un(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new Evt(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){EO(e.resolvers,i),i.reject(vi()),e.resolvers.length===0&&(e.status===ah.DOWNLOADING&&(e.status=ah.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=ah.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=Avt(s?.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(at(e.status===ah.DOWNLOADING),e.status=ah.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();yt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==ah.DOWNLOADED&&(i.err=i.err||vi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!sn(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=Cz(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)sn(i)?s.reject(i):s.reject(new W("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?ge(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===ah.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=ah.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Yi(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===ah.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,u=Cvt(c);if(s="image",e.size=c.byteLength,u==="unknown")return e.request=Yi(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(f=>o(f.data),a);const h=new Blob([c],{type:u}),p=window.URL.createObjectURL(h);e.request=Yi(p,{responseType:s,timeout:r,signal:n}),e.request.then(f=>o(new Tvt(f.data,u)),a).finally(()=>window.URL.revokeObjectURL(p))},a),!0)}get test(){}};d([m({readOnly:!0})],NN.prototype,"updating",void 0),NN=d([U("esri.views.3d.support.StreamDataLoader")],NN);const Svt={numRetries:0};function Cvt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Evt=class extends vvt{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=ah.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Svt.numRetries}};function Avt(t,e,i){return`${t}:${e}:${i}`}var ah;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(ah||(ah={}));let FN=class extends Pe{constructor(){super(...arguments),this.updating=!1}};function Mvt(t){return new vd({view:t})}d([m({readOnly:!0})],FN.prototype,"updating",void 0),FN=d([U("esri.views.3d.support.ResourceController.ResourceControllerMain")],FN);let vd=class extends FN{constructor(){super(...arguments),this._immediateTask=hC,this._normalTask=hC,this._updatingObjects=Jf([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=UBe(),this._memoryController=gvt(this.view),this._streamDataLoader=new NN,this._streamDataLoader.setup(fvt,pvt,this._scheduler),this.addHandles([he(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Ji),he(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=xw({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(wt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(wt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=gr(this._frameTask),this._streamDataLoader=Oe(this._streamDataLoader),this._memoryController=Oe(this._memoryController),this._scheduler=Oe(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Mi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(nY(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};d([m()],vd.prototype,"view",void 0),d([m()],vd.prototype,"_scheduler",void 0),d([m()],vd.prototype,"_memoryController",void 0),d([m()],vd.prototype,"_streamDataLoader",void 0),d([m()],vd.prototype,"_immediateTask",void 0),d([m()],vd.prototype,"_normalTask",void 0),d([m()],vd.prototype,"_updatingObjects",void 0),d([m({readOnly:!0})],vd.prototype,"updating",null),vd=d([U("esri.views.3d.support.ResourceController")],vd);var rW;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(rW||(rW={}));let _Gt=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function Pvt(t){return"performanceInfo"in t}let Ovt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},Rvt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*rW.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e._stage?.renderer.usedMemory.edges??0,this.fboMemory=e._stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach(i=>{Pvt(i)&&this.layerPerformanceInfos.push(new Ovt(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},$vt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):wue(this._gltfLoading,this._gltfMemCache,s,o=>wAe(new vAe(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):wue(this._wosrLoading,this._wosrMemCache,r,n=>xAe(e,n),i)}};async function wue(t,e,i,r,s){yt(s);const n=un(s,()=>Ivt(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a,a.size),t.delete(i),yt(s),a}finally{gr(n)}}function Ivt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i?.abortController.abort())}let r2=class extends Pe{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(wt.TEXTURE_UNLOAD)??hC}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new zMe;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new UMe(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};d([m()],r2.prototype,"_frameTask",void 0),d([m()],r2.prototype,"updating",null),r2=d([U("esri.views.3d.support.TextureCollection")],r2);let UMe=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},zMe=class{constructor(){this.referenceCount=0}},Lvt=class extends r2{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){yt(r);const s=r?.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new zMe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const h=this._createTexture(e,u,i);return c.texture=h,c.abortController=null,await h.load(this._stage.renderView.renderingContext),this._stage.add(h),new UMe(n,h,()=>this._release(n))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await sY(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){const s={width:i.width,height:i.height,wrap:{s:hi.CLAMP_TO_EDGE,t:hi.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(efe(e)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new fv(i,s)}},Dvt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(kf.SYMBOLOGY),this.objectResourceCache=new $vt((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new Lvt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=er(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=DTe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=tit(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Mi();this._graphicsOwners.push(e);const i=he(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Mi(()=>{i.remove(),EO(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new _m;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([he(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Ji),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Oe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;ML.distance=e.centerOnSurfaceInfrequent.distance,ML.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(ML),this.screenSizePerspectiveSettingsLabels.update(ML),this._view._stage.renderView.requestRender()}get test(){}};const ML={distance:0,fovY:0};let bS=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new zf({symbolLayers:new lt([new T_({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ox({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new Xe({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new X_({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},f_=class extends Pe{constructor(e){super(e)}};d([m({constructOnly:!0})],f_.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],f_.prototype,"surface",void 0),d([m({constructOnly:!0})],f_.prototype,"state",void 0),f_=d([U("esri.views.3d.support.pointsOfInterest.PointOfInterest")],f_);const Nvt=Array;let bd=class extends f_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new g0({location:Xe,renderLocation:Nvt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new Xe}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(yo(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Oe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=hr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return ov(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),$o;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>Fvt&&this.renderCoordsHelper.viewingMode===Ne.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?kvt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{sn(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,$o}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(QG,this._estimatedSurfaceAltitude,this._camera.eye),ho(this._get("renderLocation"),QG)||(this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),QG)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],bd.prototype,"scheduler",void 0),d([m({constructOnly:!0})],bd.prototype,"cache",void 0),d([m({constructOnly:!0})],bd.prototype,"task",void 0),d([m()],bd.prototype,"location",null),d([m({constructOnly:!0})],bd.prototype,"map",void 0),d([m()],bd.prototype,"renderLocation",void 0),d([m()],bd.prototype,"scale",null),d([m()],bd.prototype,"updating",null),bd=d([U("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],bd);const QG=C(),Fvt=1e5,kvt=1e6,Uvt=Array;let lh=class extends f_{constructor(e){super(e),this._propertiesPool=new g0({location:Xe,renderLocation:Uvt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=gr(this._frameWorker),this._propertiesPool=Oe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,$o}_updateRenderLocation(){const e=Bvt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=Vvt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ae(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=hr(this._camera.eye,e):(ie(e,this._camera.viewForward,this._get("distance")),me(e,e,this._camera.eye)),ho(this._get("renderLocation"),e)||this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const s=er(this.renderCoordsHelper.spatialReference).radius,n=s+e,o=xa(r.eye),a=o<n*n,l=hr(r.eye,i);if(a&&l>s/4){const c=n-Math.sqrt(o);return ie(i,r.viewForward,c),me(i,i,r.eye),!0}}else{const s=this.surface?.ready?this.surface.extent:null;s!=null&&xU(s,this.surface?.spatialReference,PA,this.renderCoordsHelper.spatialReference)&&(i[0]=Te(i[0],PA[0],PA[2]),i[1]=Te(i[1],PA[1],PA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(wr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=hr(r,e),n=hr(r,i);if(Math.abs(n-s)/s>zvt)return!0}return!1}};d([m({constructOnly:!0})],lh.prototype,"scheduler",void 0),d([m({constructOnly:!0})],lh.prototype,"task",void 0),d([m()],lh.prototype,"distance",void 0),d([m({constructOnly:!0})],lh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],lh.prototype,"location",null),d([m({readOnly:!0})],lh.prototype,"renderLocation",void 0),d([m()],lh.prototype,"updating",void 0),lh=d([U("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],lh);const zvt=.05,Bvt=C(),Vvt=C(),PA=Vt();let Gvt=class{constructor(e){this._handles=new _m,this.events=new Ls,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Oe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",jvt)}};const jvt={},Hvt=Array;let wd=class extends f_{constructor(e){super(e),this._propertiesPool=new g0({location:Xe,renderLocation:Hvt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([he(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),he(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(wt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Oe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,xue);const n=Math.max(0,(Math.acos(pe(xue,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Rw(e,i)){const c=this._propertiesPool.get("renderLocation");ae(c,i),this._set("renderLocation",c)}return $o}const o=1-Te(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Tue);const l=this._propertiesPool.get("renderLocation");return or(l,i,Tue,a),e&&Rw(e,l)||this._set("renderLocation",l),$o}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Jo());if(r[1]=i.aboveGround?i.padding[ei.BOTTOM]:i.fullHeight-i.padding[ei.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,OA)){_e(OA,OA,i.eye);const n=fe(OA,OA);if(this.renderCoordsHelper.intersectInfiniteManifold(Ou(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],wd.prototype,"_dirty",void 0),d([m({constructOnly:!0})],wd.prototype,"scheduler",void 0),d([m({constructOnly:!0})],wd.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],wd.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m()],wd.prototype,"updating",null),d([m()],wd.prototype,"location",null),d([m()],wd.prototype,"renderLocation",void 0),d([m()],wd.prototype,"worldUnitsPerContentPixel",null),wd=d([U("esri.views.3d.support.pointsOfInterest.Focus")],wd);const xue=C(),OA=C(),Tue=C();let vg=class extends Pe{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([he(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),yo(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=AY(this.surfaceView.extent),i=new Xe({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{})):this._set("location",i)}};d([m({constructOnly:!0})],vg.prototype,"view",void 0),d([m({constructOnly:!0})],vg.prototype,"cache",void 0),d([m()],vg.prototype,"surface",null),d([m()],vg.prototype,"surfaceView",null),d([m({readOnly:!0})],vg.prototype,"location",void 0),d([m({readOnly:!0})],vg.prototype,"renderLocation",null),vg=d([U("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],vg);let bg=class extends Pe{constructor(e){super(e),this._tileGeometryUpdateExtent=Mu(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ls,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(wt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",qvt),Mu(this._tileGeometryUpdateExtent),this._set("updating",!1)),$o}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,R_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=Wvt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,g1,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,y1,i),g1[0]<y1[0]?(s[0]=g1[0],s[2]=y1[0]):(s[0]=y1[0],s[2]=g1[0]),g1[1]<y1[1]?(s[1]=g1[1],s[3]=y1[1]):(s[1]=y1[1],s[3]=g1[1]),bk(s,e)}};d([m({constructOnly:!0})],bg.prototype,"state",void 0),d([m({constructOnly:!0})],bg.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],bg.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],bg.prototype,"scheduler",void 0),d([m({constructOnly:!0})],bg.prototype,"surface",void 0),d([m({readOnly:!0})],bg.prototype,"updating",void 0),bg=d([U("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],bg);const qvt={},g1=C(),y1=C(),Wvt=Mu();let El=class extends Pe{constructor(e){super(e),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=Gn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new g0({renderPointOfView:Yvt},this)}initialize(){const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=Nh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Lo.MIN,this._contentIntersector=Nh(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new lh({...l,task:wt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new lh({...l,task:wt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new lh({...l,task:wt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new bd({...l,cache:a,task:wt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new bg({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Gvt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new vg({cache:a,view:this.view})),this._set("focus",new wd({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(u,h)=>this._estimateSurfaceIntersectionAtRenderPoint(u,this.view.state.contentCamera,h)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new bS(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new bS(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new bS(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new bS(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new bS(c,"green","Focus")),this.addHandles([he(()=>e.contentCamera,u=>this._cameraChanged(u),Ji),he(()=>i.extent,()=>this._updateCenterPointsOfInterest()),zl(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Ji),yo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),yo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),zl(()=>wr.SHOW_POI,u=>this._setDebug(u),Ki)]),this._cameraChanged(this.view.state.contentCamera);for(const u of this._pois)u.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,bT,Zvt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(bT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=me(bT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(bT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(bT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=gJ(i,e,Xvt);if(s==null)return null;const n=s.origin,o=me(bT,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;ho(this.renderPointOfView,i)||this._set("renderPointOfView",ae(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this.removeHandles("debug");for(const i of this._pois)this.addHandles(he(()=>i.renderLocation,r=>this._debugCenters.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Ki),"debug")}get test(){}};d([m()],El.prototype,"centerOnContent",void 0),d([m()],El.prototype,"centerOnSurfaceFrequent",void 0),d([m()],El.prototype,"centerOnSurfaceInfrequent",void 0),d([m()],El.prototype,"cameraOnSurface",void 0),d([m()],El.prototype,"focus",void 0),d([m()],El.prototype,"renderPointOfView",void 0),d([m()],El.prototype,"surfaceOrigin",void 0),d([m()],El.prototype,"contentGeometryUpdates",void 0),d([m()],El.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],El.prototype,"view",void 0),d([m()],El.prototype,"updating",null),El=d([U("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],El);const Yvt=Array,bT=C(),Xvt=Gn(),Zvt={exclude:new Set([nv])};let Jvt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}};function mw(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function BMe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Qvt(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Kvt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:BMe,create:mw,createView:Kvt,fromValues:Qvt},Symbol.toStringTag,{value:"Module"}));var dc,Sue,Cue;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(dc||(dc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Sue||(Sue={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Cue||(Cue={}));let x0=class pb{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new pb(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new pb(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,i){return`${this.level}/${this.row+i}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new pb(e,i,r,s),new pb(e,i,r+1,s),new pb(e,i+1,r,s),new pb(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};x0.pool=new Ko(x0,null,null,25,50);function wy(t,e){return[t,e]}function _1(t,e,i){return t[0]=e,t[1]=i,t}function e1t(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const sd=new x0("0/0/0/0");let t1t=class VMe{static create(e,i,r=null){const s=Yg(e.spatialReference),n=i.origin||wy(e.origin.x,e.origin.y),o=wy(e.size[0]*i.resolution,e.size[1]*i.resolution),a=wy(-1/0,-1/0),l=wy(1/0,1/0),c=wy(1/0,1/0);r!=null&&(_1(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),_1(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),_1(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:h}=i;let p,f,g,_;return!r&&u&&h&&(_1(a,u[0],h[0]),_1(l,u[1],h[1]),_1(c,u[1]-u[0]+1,h[1]-h[0]+1)),e.isWrappable?(p=wy(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),f=wy(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=wy(p[0]+f[0]-1,l[1]),_=!0):(f=a,g=l,p=c,_=!1),new VMe(i.level,i.resolution,i.scale,n,a,l,c,o,f,g,p,_)}constructor(e,i,r,s,n,o,a,l,c,u,h,p){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=h,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){sd.set(i);const s=r?sd.col:this.denormalizeCol(sd.col,sd.world),n=sd.row;return e1t(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){sd.set(i);const s=r?sd.col:this.denormalizeCol(sd.col,sd.world);return Array.isArray(e)?_1(e,this.getXForColumn(s),this.getYForRow(sd.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(sd.row)),e}},sW=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new x0(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};sW.pool=new Ko(sW);let KG=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Ns=new x0("0/0/0/0");let i1t=class GMe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,h=(Math.floor(s)-s)*c;return new GMe(r,Math.floor(s),Math.ceil(o),c,a<0?u:h,a<0?h:u,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const Vc=[[0,0],[0,0],[0,0],[0,0]],r1t=1e-6;let zGt=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>t1t.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Ns.set(i);const s=this._infoByLevel[Ns.level];return s?s.getTileBounds(e,Ns,r):e}getTileCoords(e,i,r=!1){Ns.set(i);const s=this._infoByLevel[Ns.level];return s?s.getTileCoords(e,Ns,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=sW.pool.acquire(n),a=this._wrap;let l,c,u,h=1/0,p=-1/0;const f=o.spans;Vc[0][0]=Vc[0][1]=Vc[1][1]=Vc[3][0]=-i,Vc[1][0]=Vc[2][0]=e.size[0]+i,Vc[2][1]=Vc[3][1]=e.size[1]+i;for(const b of Vc)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let _=3;for(let b=0;b<4;b++){if(Vc[b][1]===Vc[_][1]){_=b;continue}const w=i1t.create(Vc[b],Vc[_]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),_=b}if(h==null||p==null||p-h>100)return null;let v=[];for(l=h;l<p;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(u/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)f.push(new KG(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),u)))}else f.push(new KG(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),f.push(new KG(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){Ns.set(e);const i=this._infoByLevel[Ns.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Ns,this._lodInfos[r],Ns),Ns.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Ns.set(i);const r=this._infoByLevel[Ns.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Ns,s,Ns);const o=s.denormalizeCol(Ns.col,Ns.world);for(const a of e.spans)if(a.row===Ns.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((_,v)=>(_[0]=Math.min(_[0],v.row),_[1]=Math.max(_[1],v.row),_[2]=Math.min(_[2],v.colFrom),_[3]=Math.max(_[3],v.colTo),_),[1/0,-1/0,1/0,-1/0]),u=r.denormalizeCol(Ns.col,Ns.world),h=s.getColumnForX(r.getXForColumn(u)),p=s.getRowForY(r.getYForRow(Ns.row)),f=s.getColumnForX(r.getXForColumn(u+1))-1,g=s.getRowForY(r.getYForRow(Ns.row+1))-1;return!(h>c||f<l||p>a||g<o)}const n=s.denormalizeCol(Ns.col,Ns.world);return e.spans.some(o=>o.row===Ns.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=Yg(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+r1t)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},s1t=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},n1t=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new rN,this._controllers=new rN,this._processingItems=new rN,this._pausedSignal=Jf(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new x4(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=gr(this._schedule),this._task=gr(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=un(i,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(vi())},a=()=>{l.remove(),n?.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=zR(s.signal,o),c=Pn();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(vi("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=XC(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new s1t(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}$c(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};function o1t(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const e6=new Set,PL=[],wT=new Map,Eue=[0,0];let v1=class extends Pe{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new n1t({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Oe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(s,s),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const h=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(h.key);wT.has(p)||(wT.set(p,[]),r=Math.max(p,r),s=Math.min(p,s)),wT.get(p).push(h.key),e6.add(p)});let n=this.state.scale;wT.has(n)||(o1t(PL,e6),PL.sort((u,h)=>u-h),n=PL.reduce((u,h)=>Math.abs(h-n)<Math.abs(u-n)?h:u,PL[0])),n=Math.min(n,r),n=Math.max(n,s);const o=wT.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,h)=>{const p=a.denormalizeCol(u.col,u.world),f=a.denormalizeCol(h.col,h.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))}),e6.clear(),wT.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Eue,a.key);const l=iv(Eue,r);l<n&&(n=l,s=a.key)}),s.id}};d([m({constructOnly:!0})],v1.prototype,"concurrency",void 0),d([m({constructOnly:!0})],v1.prototype,"process",void 0),d([m()],v1.prototype,"state",void 0),d([m({constructOnly:!0})],v1.prototype,"strategy",void 0),d([m({constructOnly:!0})],v1.prototype,"tileInfoView",void 0),v1=d([U("esri.views.2d.tiling.TileQueue")],v1);new x0(0,0,0,0);let a1t=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},l1t=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function Aue(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let jMe=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function c1t(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new a1t(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const u=e[r++];for(let f=0;f<u;f++){const g=e[r++],_=e[r++],v=e[r++],b=e[r++],w=!!e[r++],T=e[r++],S=i[r++],A=i[r++],P=e[r++],R=e[r++];c.colliders.push({xTile:g,yTile:_,dxPixels:v,dyPixels:b,hard:w,partIndex:T,width:P,height:R,minLod:S,maxLod:A})}const h=t[r++];for(let f=0;f<h;f++)c.textVertexRanges.push([t[r++],t[r++]]);const p=t[r++];for(let f=0;f<p;f++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function u1t(t,e,i){for(const[r,s]of t.symbols)h1t(t,e,i,s,r)}function h1t(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===dc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=i?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let h=c;h<c+u;h+=4)n.iconOpacity[h/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=i?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let h=c;h<c+u;h+=4)n.textOpacity[h/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function d1t(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,Sdt(i,e.x,e.y,n,o,a,l)))return!0;return!1}let Ez=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},p1t=class extends Ez{constructor(e,i){super(e,i),this.type=dc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Tt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=lr.createVertex(e,Hi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=lr.createIndex(e,Hi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new bp(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},f1t=class extends Ez{constructor(e,i){super(e,i),this.type=dc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Tt(this.fillVAO),this.outlineVAO=Tt(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=lr.createVertex(e,Hi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=lr.createIndex(e,Hi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],h=lr.createVertex(e,Hi.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const p=s[r++],f=lr.createIndex(e,Hi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,p));r+=p;const g=this.layer,_=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new bp(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new bp(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:h},f)}},m1t=class extends Ez{constructor(e,i,r){super(e,i),this.type=dc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++],c=s[a++],u=s[a++],h=new x0(l,c,u,0),p=s[a++];for(let v=0;v<p;v++){const b=s[a++],w=s[a++],T=s[a++];this.iconPerPageElementsMap.set(b,[w,T])}const f=s[a++];for(let v=0;v<f;v++){const b=s[a++],w=s[a++],T=s[a++];this.glyphPerPageElementsMap.set(b,[w,T])}const g=s[a++],_=s[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(_),a=c1t(s,n,o,a,this.symbols,r,h),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+G_(this.iconOpacity)+G_(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=Tt(this.iconVAO),this.textVAO=Tt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=lr.createVertex(e,Hi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=lr.createIndex(e,Hi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],h=lr.createVertex(e,Hi.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const p=s[r++],f=lr.createIndex(e,Hi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,p));r+=p;const g=lr.createVertex(e,Hi.STATIC_DRAW,this.iconOpacity.buffer),_=lr.createVertex(e,Hi.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new bp(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new bp(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:h,opacity:_},f)}},g1t=class extends Ez{constructor(e,i){super(e,i),this.type=dc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Tt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=lr.createVertex(e,Hi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=lr.createIndex(e,Hi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new bp(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const KGt=!0,y1t=32,nW=200;let _1t=class extends Ls{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Pn(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Pn(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){const r=se("mapview-transitions-duration")===0?0:1/se("mapview-transitions-duration");if(this.fadeTransitionEnabled&&r!==0){const s=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===s)this.computedVisible=this.visible;else{const o=e*r;this.computedOpacity=n>s?Math.max(s,n-o):Math.min(s,n+o),this.computedVisible=this.computedOpacity>0;const a=s===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},HMe=class extends _1t{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new x0(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;WX(r,o,0,0,0,a,0,s,n,1),gC(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},i6t=class qMe extends HMe{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<nW}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<nW)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const s=this.layerData.get(r);s&&(this._memoryUsedByLayerData-=s.memoryUsed,s.type===dc.SYMBOL&&this.symbols.delete(r)&&(i=!0),s.destroy(),this.layerData.delete(r))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,WMe.delete(this),qMe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){this.featureIndex?.clear();let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===dc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===dc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;rU(o),yC(o,o,n),sU(o,o,Math.PI*e.rotation/180),u$(o,o,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:mw(),tileMat3:mw(),tileUnitsToPixels:mw()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case dc.FILL:r=new f1t(e,this.styleRepository);break;case dc.LINE:r=new p1t(e,this.styleRepository);break;case dc.SYMBOL:r=new m1t(e,this.styleRepository,this);break;case dc.CIRCLE:r=new g1t(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const WMe=new Map;function v1t(){WMe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}let b1t=class{constructor(e="scene"){this.context=e,this.extent=Mu()}};const s6t={value:.5,readOnly:!0},w1t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let s2=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},x1t=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},T1t=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new x1t(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,h=.5*DZ;let p=(c-1)/o,f=(r-this.j*o)*p,g=(i-this.i*o)*p;if(p<1){const _=Math.floor(f),v=Math.floor(g),b=_+v*c,w=u[b],T=u[b+1],S=u[b+c],A=u[b+c+1];if(w+T+S+A<h){const P=f-_,R=g-v,F=x3(w,T,S,A,P,R),k=x3(w,T,S,A,P+p,R),N=x3(w,T,S,A,P,R+p),j=x3(w,T,S,A,P+p,R+p);return s.min=Math.min(F,k,N,j),s.max=Math.max(F,k,N,j),s}f=_,g=v,p=1}else f=Math.floor(f),g=Math.floor(g),p=Math.ceil(p);for(let _=f;_<=f+p;_++)for(let v=g;v<=g+p;v++){const b=u[_+v*c];b<h?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const S1t=.5*DZ;function ss(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Te(r.dy*(r.y1-e),0,s),o=Te(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,u=a*c+l,h=r.data.values,p=h[u],f=h[u+1],g=u+c,_=h[g],v=h[g+1];if(p+_+f+v<S1t){n-=a,o-=l;const b=p+(f-p)*o;return b+(_+(v-_)*o-b)*n}}return null}var gt;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(gt||(gt={}));function YMe(t){return WQ(t)||ex(t)||tx(t)}function WQ(t){return c0(t)||G2(t)}const xT=C(),C1t=C(),Qm=C(),Km=C();function E1t(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return tme(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return ADe(r,e,i*s)}function OL(t,e,i,r){ae(xT,i),xT[r]=e[r];const s=_e(xT,xT,e),n=_e(C1t,t,e),o=pe(n,s),a=pe(s,s);let l;l=o<=0?e:a<=o?i:me(xT,e,ie(s,s,o/a));const c=_e(xT,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function A1t(t,e,i){const r=t.extent;if(r==null)return 0;Qm[0]=r[0],Qm[1]=r[1],Qm[2]=i,Km[0]=r[2],Km[1]=r[3],Km[2]=i;let s=1/0,n=1/0;return e[0]<Qm[0]?s=OL(e,Qm,Km,0):e[0]>Km[0]&&(s=OL(e,Km,Qm,0)),e[1]<Qm[1]?n=OL(e,Qm,Km,1):e[1]>Km[1]&&(n=OL(e,Km,Qm,1)),Math.min(s,n)}function M1t(t,e,i,r){if(t==null)return LZ();const s=t.spatialReference;if(s.isGeographic&&!WQ(s))return new W("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=gc.checkUnsupported(t);return n??(i==null?new W("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):P1t(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function P1t(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=eme(e),a=Vt();gc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>zS){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new W("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:zS})}return null}const O1t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:M1t,isInsideExtent:E1t,tiltToExtentEdge:A1t},Symbol.toStringTag,{value:"Module"}));function R1t(){return!0}function $1t(){return 0}function I1t(t,e,i,r){if(t==null)return LZ();const s=t?.lods.length-1,n=t.spatialReference;if(n.isWebMercator){if(!gc.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new W("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!YMe(n))return new W("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!gc.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new W("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new W("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const L1t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:I1t,isInsideExtent:R1t,tiltToExtentEdge:$1t},Symbol.toStringTag,{value:"Module"})),D1t={[Ne.Global]:L1t,[Ne.Local]:O1t};function _n(t,e){t||console.warn("Terrain: "+e)}let Vn=!1,N5=!1;function N1t(t){N5=t,Vn=Vn||t}function F1t(t){Vn=t}function Ie(t,e){if(Vn&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function oW(t){return YQ(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function F5(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function YQ(t){return t?.type==="imagery-tile-3d"}function XMe(t){return t?.type==="tile-3d"}function BC(t){return t?.type==="vector-tile-3d"}function ZMe(t){return t?.type==="wmts-3d"}function aW(t){return t?.type==="elevation-3d"}function RA(t){return t?.type==="group"}function MR(t){return t&&(XMe(t)||ZMe(t)||YQ(t)||BC(t))}function lW(t){return t&&(XMe(t)||YQ(t)||BC(t)||ZMe(t))}function cW(t){return lW(t)||aW(t)}function k1t(t){return FMe(t?.sourceLayerInfo?.data)}function U1t(t){return JMe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function z1t(t){return kMe(t?.sourceLayerInfo?.data)}function B1t(t){const e=t?.sourceLayerInfo?.data;return Cz(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function JMe(t){return vS(t?.data)}function k2(t){return t!=null&&"release"in t&&t.release(),null}function l6t(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function XQ(t,e,i,r,s){return D1t[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function Az(t,e,i){let r=null,s=null;if(t?.type==="wmts"){const o=V1t(t,e,i);r=o.tileInfo,s=o.fullExtent}else{s=F5(t)?t.getCompatibleFullExtent(e):t.fullExtent;const o=i===Ne.Local;F5(t)?r=t.getCompatibleTileInfo(e,s,o):t?.type==="vector-tile"?r=o&&!G1t(e)||j1t.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?t.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&s!=null&&XQ(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function V1t(t,e,i){const r=Jke(t);if(r!=null){if(!lt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>XQ(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function G1t(t){return t.isWGS84||t.isWebMercator||G2(t)||!Sw(t)}const j1t={force512VTL:!1};function Mue(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function eg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function bh(t,e,i=W1t){return Math.abs(t-e)<i}function k5(t){return t===gt.NORTH_EAST?gt.SOUTH_WEST:t===gt.NORTH_WEST?gt.SOUTH_EAST:t===gt.SOUTH_WEST?gt.NORTH_EAST:gt.NORTH_WEST}function ZQ(t){return t===gt.NORTH?gt.SOUTH:t===gt.EAST?gt.WEST:t===gt.SOUTH?gt.NORTH:gt.EAST}function H1t(t){return t===gt.NORTH_WEST||t===gt.SOUTH_WEST}function q1t(t){return t===gt.NORTH_WEST||t===gt.NORTH_EAST}function Pue(t){return t===gt.NORTH_WEST||t===gt.WEST||t===gt.SOUTH_WEST}function Oue(t){return t===gt.NORTH_EAST||t===gt.EAST||t===gt.SOUTH_EAST}function Rue(t){return t===gt.SOUTH_EAST||t===gt.SOUTH||t===gt.SOUTH_WEST}function $ue(t){return t===gt.NORTH_EAST||t===gt.NORTH||t===gt.NORTH_WEST}const Kd=[gt.NORTH,gt.EAST,gt.SOUTH,gt.WEST],U5=[gt.NORTH_EAST,gt.SOUTH_EAST,gt.SOUTH_WEST,gt.NORTH_WEST],W1t=1e-5;let nh=class extends Pe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&Zke(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=QMe(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(eme(s))}}),e}};function Y1t(t,e){return t===Ne.Global?new uW(e):new hW(e)}d([m({readOnly:!0})],nh.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],nh.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],nh.prototype,"stencilEnabledExtents",null),d([m()],nh.prototype,"viewSpatialReference",void 0),d([m()],nh.prototype,"tilingScheme",void 0),d([m()],nh.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],nh.prototype,"layers",void 0),d([m({constructOnly:!0})],nh.prototype,"layerViews",void 0),nh=d([U("esri.views.3d.terrain.ExtentHelper")],nh);let uW=class extends nh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Hbe:z7e}};uW=d([U("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],uW);let hW=class extends nh{_computeLayerViewsExtent(){const e=Mu(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=QMe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);R_(e,a,e)}});const r=Rj(e)?e:null,s=this._get("layerViewsExtent");return Jb(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=Mu();this.layers.forEach(o=>{if(o.loaded&&VP(o)){const a=Az(o,i,Ne.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a,u="tilemapCache"in o?o.tilemapCache?.effectiveMaxLOD:void 0;l!=null&&c!=null&&(F5(o)||e.compatibleWith(l,u)&&c.spatialReference.equals(e.spatialReference))&&R_(r,c,r)}}),R_(r,this.defaultTiledLayersExtent,r);const s=Rj(r)?r:null,n=this._get("tiledLayersExtent");return Jb(s,n)?n:s}};function QMe(t,e){return t==null||t.spatialReference.equals(e)?t:qP(t,t.spatialReference,e)}hW=d([U("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],hW);function KMe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}const ePe=1.3,X1t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let xy,Tl=class extends Pe{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=se("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new ih({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=Nh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([he(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>e._stage?.renderer.setParameters({hasOverlayWater:r})),this.renderer.events.on("content-changed",i),he(()=>e.state.camera.pixelRatio,i),he(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),he(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),he(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Ji),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(wt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(wc,r.camera,Vi.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Vi.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),xy&&(xy.hide(),xy=null),this.renderer=Oe(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||wr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?er(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return ePe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(Vi.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Z_(-20037508342787e-6,20037508342787e-6):new Z_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,tu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Vi.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return $o;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,Wp),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Wp.stretch);const n=this._updateOverlay(ln.INNER,Wp.inner,s,1*Wp.pixelRatioAdjustment,Wp.mapUnitsPerPixel),o=Ta(Wp.inner)/Ta(Wp.outer),a=this._updateOverlay(ln.OUTER,Wp.outer,s,o*Wp.pixelRatioAdjustment,Wp.mapUnitsPerPixel);n!==Sf.EXTENT&&a!==Sf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),n===Sf.NONE&&a===Sf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(N_(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return Sf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,Z1t(i,o.extent)&&r===o.resolution)return a===n?Sf.NONE:Sf.RERENDER_ONLY;u0(o.extent,i),o.resolution=r;const l=AY(o.extent);return o.renderLocalOrigin=m5(l[0],l[1],0,"OV_"+this._latestOriginId++),Sf.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[ln.INNER],s=this.renderer.overlays[ln.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,ln.INNER,i),this._setTileOverlayData(n,ln.OUTER,i)):(this._clearTileOverlayData(ln.INNER,i),this._clearTileOverlayData(ln.OUTER,i))}else this._clearTileOverlayData(ln.INNER,i),this._clearTileOverlayData(ln.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[ln.INNER],s=this.renderer.overlays[ln.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=Ta(s),o=Il(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Ta(e)/n,Il(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){KMe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(wc)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new QTe(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,ebt,i,r);if(n==null)return!1;const o=n.origin,a=me(RL,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Te(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=RL;dE(CU(EU,er(this.view.spatialReference).radius+l),Ou(e.eye,e.viewForward),u),_e(u,u,e.eye);const h=J_.normalize(B_e(e.viewForward,u,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:s;r=c?p*h:h+p*(1-h)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(u),p=kt(0,h,1,0),f=Cc(p,p,e.projectionMatrix)[1],g=Te(.5+.5*f,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&DO(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=C();this._findHorizonBasedPointOfInterest(e,n)||ae(n,s),wr.OVERLAY_SHOW_CENTER?(xy==null&&(xy=new bS(this.view.graphics,"red")),xy.show(n,this._renderSR)):xy?.hide();const o=Math.max(.1,hr(e.eye,n)),a=lv(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||_o(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference?.isGeographic,u=c&&this._spatialReference?1/er(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/h*o*u;r.mapUnitsPerPixel=p/this._worldToPCSRatio,r.stretch=this._overlayStretch;let f=i*p/2*r.stretch,g=!1,_=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(f/=Math.cos(LF(n[1])),_=l[3]):(g=!0,f/=er(this._spatialReference).metersPerDegree,_=90),f>=_&&(f=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(xt(n[1])))),f*v>180&&(v=180/f),r.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,T=32,S=.5*i/(T*w),A=.5*i/(T*f);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*A)/A;const P=r.inner;P[0]=n[0]-w,P[1]=n[1]-f,P[2]=n[0]+w,P[3]=n[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(P,1/0,_);const R=r.outer;if(6*w>Ta(l))u0(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=P[0]-w,R[1]=P[1]-f,R[2]=P[2]+w,R[3]=P[3]+f;else{_o(e.eye,this._renderSR,RL,this._spatialReference),Rf(b1,n,RL);let k=-Math.atan2(b1[1],b1[0])+.125*Math.PI;k<0&&(k+=2*Math.PI);const N=Math.floor(k/(.25*Math.PI));kw(b1,X1t[N],2*f),b1[0]*=v,b1[2]*=v,DX(R,P,b1)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-_),R[3]=Math.min(R[3],_);else{const k=$j(P,l,Q1t),N=$j(R,l,K1t);Pee(k,N)&&(R[2]=R[0],R[3]=R[1])}const F=Math.abs(P[2]-P[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,F),r.pixelRatioAdjustment=r.mapUnitsPerPixel/F}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Vi.UPDATE),r?(this.surface.requestRender(e),e===Vi.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Vi.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):bk(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:Pee(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),VF(e,s,n)}get test(){}};function Z1t(t,e){const r=wr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}d([m()],Tl.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],Tl.prototype,"running",null),d([m()],Tl.prototype,"_placementDirty",void 0),d([m()],Tl.prototype,"_contentUpdated",void 0),d([m()],Tl.prototype,"_isSpherical",null),d([m()],Tl.prototype,"_worldToPCSRatio",null),d([m()],Tl.prototype,"renderer",void 0),d([m({constructOnly:!0})],Tl.prototype,"view",void 0),d([m({constructOnly:!0})],Tl.prototype,"surface",void 0),d([m()],Tl.prototype,"suspended",null),d([m()],Tl.prototype,"updating",null),d([m({type:Boolean})],Tl.prototype,"rendersOccludedDraped",null),Tl=d([U("esri.views.3d.terrain.OverlayManager")],Tl);let J1t=class{constructor(){this.inner=Vt(),this.outer=Vt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=ePe}};const b1=Yt(),RL=C(),Wp=new J1t,Q1t=Vt(),K1t=Vt(),ebt=Gn();var Sf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Sf||(Sf={}));let tbt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Or(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Xt(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Or(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),me(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;uct(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,u){const h=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(h,r,s,n),this._setUV(h,o,a),this._setNormal(h,l,c,u)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;kh(n,e,i,r,s,o)}_setUV(e,i,r){ap(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return Ie(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const Iue=16384;function ap(t,e,i,r){t.setValues(e,i*Iue,r*Iue)}let ibt=class{constructor(){this.sinLonLUT=new Array(OM+1),this.cosLonLUT=new Array(OM+1),this.sinLatLUT=new Array(OM+1),this.cosLatLUT=new Array(OM+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},rbt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},tPe=class kN{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Oe(this._current),this._next=Oe(this._next),this._waiting=Oe(this._waiting),this._delayed=Oe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=kN.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,V_.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Qs.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(Oe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=kN.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=V_.Immediate){this._delayed=Oe(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=kN.test.fadeMoment||performance.now();return i!==V_.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Oe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var V_;tPe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(V_||(V_={}));var VC;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(VC||(VC={}));let iPe=class{constructor(){this._queue=new Gt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},sbt=class{constructor(){this._q=new Gt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function xO(t,e,i){if(e?.fullExtent==null)return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Wf(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function nbt(t,e,i=null){i==null||i.length===0?t===VC.BACK_TO_FRONT?e.sort(obt):e.sort(abt):e.sort((r,s)=>lbt(r,s,t,i))}function obt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function abt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function rPe(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:Wf(t,e)}function lbt(t,e,i,r){return Lue(t,r)===Lue(e,r)?rPe(t,e,i):t?i:-i}function Lue(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function cbt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function ubt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(cbt)}function hbt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function dbt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function v6t(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let JQ=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Qs.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=oW(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?xO:()=>!0;let u=this.tile;const h=u.level;let p;const f=this._tileLayerInfo.upsampleInfo,g=f!=null?f.tile.level:-1,_=f!=null&&g-h>=a,v=s?.tilemapCache,b=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const w=u.level,T=h-w,S=u.layerInfo[i][e];if(S.data&&T>=a){(!_||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const A=b?.getLevelRowColumn(u.lij)??u.lij;if(v?.getAvailability(A[0],A[1],A[2])!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!p||u.level===n||w%jbe==0||h-p.level<a)&&(p=u),T>=l))break;u=u.parent}if(p!=null&&h-p.level<a)if(f)p=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),p=w.layerInfo[i][e].dataInvalidated?w:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Qs.FADING,i)}get test(){}},pbt=class extends JQ{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw Due}get _progressiveLevelModulo(){throw Due}dispose(){}};const Due=new Error("Abstract method called on TileAgent"),Zl=new pbt;let fbt=class extends JQ{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function mbt(t){return t.type==="elevation"}let gbt=class extends JQ{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return jbe}};function ybt(t){return t.type==="map"}var _a;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(_a||(_a={}));let UN=class{constructor(){this.waitingAgents=new Gt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=t6.acquire();return i._init(e),i}release(){this.dispose(),zN.delete(this),t6.release(this)}dispose(){this.loadingAgent=Tt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=k2(this._data)}static prune(){t6.prune(0)}_init(e){this.waitingAgents.clear(),this._data=k2(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=il(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),hbt(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){k2(this._data),this._data=e}};const t6=new Ko(UN,null,()=>{}),zN=new Map;function _bt(){zN.size>0&&(console.log(`${zN.size} live TilePerLayerInfo allocations:`),zN.forEach(t=>console.log(t,`
`)))}var ht;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(ht||(ht={}));const vbt=.1;let QQ=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Vt(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Vt(),this.centerAtSeaLevel=C(),this._center=[C(),Ws(),C()],this.up=wY(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){KQ.prune(0),eK.prune(0),UN.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Js.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??_a.INTERSECTS;this._frustumVisibility=i===_a.INSIDE?_a.INSIDE:i===_a.OUTSIDE?_a.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==_a.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=er(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Js.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of db){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=UN.acquire(this._surface.upsampleInfoPool),o===Nt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,OM)}dispose(){_n(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of db){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Nt.MAP].reduce((e,{data:i})=>e+(vS(i)?i.usedMemory/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[Nt.MAP])vS(r)?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[Nt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===Nt.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Nt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return kMe(e)?e.texture.usedMemory:FMe(e)?e.memoryUsage:vS(e)?e.usedMemory/e.referenced:Cz(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[Js.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===_a.OUTSIDE))return ht.NONE;const s=this.level;_e(IL,this._center[Js.MIDDLE],i);let n=xa(IL),o=IL,a=this._center[Js.MIDDLE];_e(i6,this._center[Js.TOP],i);const l=xa(i6);l<n&&(n=l,o=i6,a=this._center[Js.TOP]),_e(r6,this._center[Js.BOTTOM],i);const c=xa(r6);if(c<n&&(n=c,o=r6,a=this._center[Js.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return ht.SPLIT;const u=Math.sqrt(n),h=e.fovX*u*2,p=this._edgeLen/h,f=()=>{if(s<e.maxLod)return this.elevationLevel=s,ht.NONE;const R=s+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return R!==this.elevationLevel?(this.elevationLevel=R,ht.ELEVATION):ht.NONE},g=r!=null?r-s:1/0;if(g<=.5)return f();const _=pe(this.up,IL),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&_>0&&b<.001&&_/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return ht.NONE;const w=r!=null?3-Math.min(g,2):1;if(p*w<e.relativeWidthLimit||s>=e.maxLod)return f();if(s<7)return ht.SPLIT;ie(wo,this.up,_),_e(wo,wo,o);const T=xa(wo);if(T<=this.radius*this.radius)return ht.SPLIT;ie(wo,wo,this.radius/Math.sqrt(T)),me(wo,wo,a),_e(wo,i,wo);const S=Math.min(1,(Math.abs(pe(wo,this.up))+.5*v+this._curvatureHeight)/Se(wo)),A=vbt/e.angledSplitBias,P=e.fovY*u*2;return S*(this._edgeLen/P*w)<A*e.relativeHeightLimit?ht.NONE:ht.SPLIT}setChildren(e,i,r,s){_n(!!(e&&i&&r&&s),"Null child passed");const n=this._children;return n[0]=e,n[1]=i,n[2]=r,n[3]=s,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of db)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of db){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Zl&&($L(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(ht.GEOMETRY),this.resetPendingUpdate(ht.TEXTURE_NOFADING),this.resetPendingUpdate(ht.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Nt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Zl&&($L(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Jb(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(ht.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of db){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Zl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(ht.SPLIT)||e!==Nt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===ht.SPLIT||e===ht.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=vS(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;il(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return xa(_e(wo,this._center[Js.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;_n(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=vS(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case Nt.MAP:return this._updateTexture(i);case Nt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Qs.FADING?ht.TEXTURE_NOFADING:ht.TEXTURE_FADING),this.setPendingUpdate(e===Qs.FADING?ht.TEXTURE_FADING:ht.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ht.GEOMETRY);for(const e of this.layerInfo[Nt.ELEVATION])e.pendingUpdates|=ht.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[Nt.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;ie(wo,this.up,r),me(s[Js.MIDDLE],this.centerAtSeaLevel,wo),ie(wo,this.up,e),me(s[Js.TOP],this.centerAtSeaLevel,wo),ie(wo,this.up,i),me(s[Js.BOTTOM],this.centerAtSeaLevel,wo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Nt.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Nt.ELEVATION),l=oW(a);if(!xO(this,l,!1))return;const c=wbt;let u=!1;const h=r.data;if(h&&h.level<=n){const p=r.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,f,g=0;for(let _=this._parent;_&&(!f||g<s)&&(g=this.elevationLevel-_.level,p=f||p,f=_.layerInfo[Nt.ELEVATION][e].data,!(!f&&p&&_.level<=n));_=_.parent);f=f||p,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=f.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new s2),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Zl&&($L(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:UN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Qs.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Zl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of db){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Zl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Zl&&this.updateRenderData(e,Qs.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Zl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Zl,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||rC(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let s=e;s<i;++s){const n=this._surface.layerViewByIndex(s,r);if(MR(n)&&n?.layer?.blendMode!=="normal"||rC(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=oW(l);if(o.loadingAgent?xO(this,c,!1)?(o.loadingAgent!==Zl&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Zl&&(a=o.loadingAgent.update())):o.dispose():xO(this,c,!1)&&(o.loadingAgent=bbt(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Zl&&this.setPendingUpdate(ht.GEOMETRY):($L(o.loadingAgent),o.loadingAgent=Zl)),o.loadingAgent===Zl&&this.updateRenderData(i,Qs.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=Te(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(xbt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this.getNeighborLIJ(r,e);return s?BN(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===gt.NORTH_EAST?1:e===gt.NORTH_WEST?0:e===gt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(k5(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===gt.NORTH?[0,1]:e===gt.NORTH_EAST?[1]:e===gt.EAST?[1,3]:e===gt.SOUTH_EAST?[3]:e===gt.SOUTH?[2,3]:e===gt.SOUTH_WEST?[2]:e===gt.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Ie(!Vn||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,u=n?s-1-c:c;return Vn&&(Ie(a<=l&&l<a+s),Ie(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;Kd.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(ZQ(s),o=>!!o.isLoaded&&(e(o,s),!0))}),U5.forEach(s=>{const n=this.findNeighborTile(s,r)?.findCorner(k5(s),o=>o.isLoaded);Ie(!n||dW(this,n,s)),n?.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=$ue(i)?-1:Rue(i)?1:0,s=Pue(i)?-1:Oue(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=e?.[1]??null;return i!=null&&this.extent[1]+go()>=i}checkGeometryWaterproofness(){N5&&(Ie(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if($ue(e)&&i[3]+s>=r[3]||Rue(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Pue(e)&&i[0]-s<=r[0])&&!(!n&&Oue(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ae(this._lastPOI,e);const r=this._center[Js.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}get test(){return{cachedMemory:this._cachedMemory}}};function bbt(t,e,i,r){const s=i===Nt.ELEVATION?eK.acquire():KQ.acquire();return s.init(t,e,i,r),s}function $L(t){t.dispose(),mbt(t)?eK.release(t):ybt(t)&&KQ.release(t)}const KQ=new Ko(gbt),eK=new Ko(fbt),wbt=new s2;var Js;function xbt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function BN(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Tbt(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===gt.EAST||t.isWestEnd&&e.isEastEnd&&i===gt.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case gt.NORTH:return bh(t.extent[3],e.extent[1],r);case gt.SOUTH:return bh(t.extent[1],e.extent[3],r);case gt.EAST:return bh(t.extent[2],e.extent[0],r)||bh(t.extent[2],-e.extent[0],r);case gt.WEST:return bh(t.extent[0],e.extent[2],r)||bh(t.extent[0],-e.extent[2],r)}}function dW(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Nue(t,e,i):Nue(e,t,k5(i)))}function Nue(t,e,i){Ie(t.level>=e.level);const r=H1t(i),s=q1t(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=bh(a[0],l[0],c)||t.surface.isGlobal&&bh(a[0],-l[0],c),h=bh(a[1],l[1],c);if(u&&h)return!0;if(t.level===e.level||!u&&!h)return Ie(!1),!1;const p=u?Fue(o[1],o[3],n[1],n[3],c):Fue(o[0],o[2],n[0],n[2],c);return Ie(p),p}function Fue(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Js||(Js={}));const IL=C(),i6=C(),r6=C(),wo=C();let Sbt=class{constructor(){this._scales=kt(-1,-1,-1,-1),this._offsets=kt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function Cbt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function tK(t){t.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var Yf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Yf||(Yf={}));let Ebt=class extends QJ{constructor(){super(...arguments),this.overlayOpacity=1}};function Abt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new kue("texOffsetAndScale")),r.uniforms.add(new Uue("tex")),r.uniforms.add(new s6("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new kue("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new Uue("texNext")),r.uniforms.add(new s6("nextTexOpacities")),r.uniforms.add(new Mbt("fadeFactor")));const o=e.tileBlendInput===Yf.ColorComposite,a=e.tileBlendInput===Yf.GridComposite;a&&r.include(tK),o&&r.uniforms.add(new s6("backgroundColor")),i.code.add(x`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),r.code.add(x`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?x`backgroundColor`:x`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:x`return color;`}
    }`),n?r.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(x`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Mbt=class extends Ss{constructor(e){super(e,"float")}},s6=class extends Ss{constructor(e){super(e,"vec3")}},kue=class extends Ss{constructor(e){super(e,"vec4")}},Uue=class extends Ss{constructor(e){super(e,"sampler2D")}},sPe=class extends Ebt{};function Pbt(t){const e=new Pi,{vertex:i,fragment:r,varyings:s}=e;e.include(x$),e.include(vE,t),e.include(Yd,t);const n=()=>{e.include(SR,t),i.code.add(x`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Dl(i,t),e.include(Sa,t);const o=t.overlayMode!==jf.Disabled,a=o&&t.invisible;switch(t.output){case V.Color:{e.include(Abt,t),e.include(Ww,t),o&&e.include(pA,{...t,pbrMode:t.pbrMode===mt.Simplified?mt.TerrainWithWater:mt.Water});const l=t.overlayMode===jf.EnabledWithWater;l&&e.include(Cbt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&PC(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(gE,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(x`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?x`forwardVertexTangent(vnormal);`:x``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?x`setOverlayVTC(uv);`:""}
          ${t.tileBorders?x`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?x`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?x`forwardLinearDepth();`:""}

        }
      `),e.include(Ks,t),e.include(Ww,t),e.include(I$,t),e.include(NC,t),wp(r,t),L$(r),xE(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Rt("viewDirection",(u,h)=>fe(zue,te(zue,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))),l&&r.uniforms.add(new ct("ovWaterTex",(u,h)=>h.overlay?.getTexture(Nr.WaterNormal)),new mxe("view",(u,h)=>Aa(Obt,h.camera.viewMatrix,u.origin))),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),I0(r),Em(r),r.code.add(x`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?x`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?x`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===mt.Simplified||t.pbrMode===mt.TerrainWithWater?x`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:x`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?x`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?x`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?x`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:x`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?x`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case V.Depth:a&&e.include(pA,t),i.code.add(x`
              void main(void) {
                ${a?x`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),r.code.add(x`
              void main() {
                ${a?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:case V.ViewshedShadow:e.include(lz,t),j9(e),BU(e),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`);break;case V.Normal:a&&e.include(pA,t),s.add("vnormal","vec3"),PC(i),n(),i.code.add(x`
        void main(void) {
          ${a?x`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),r.code.add(x`
        void main() {
          ${a?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case V.Highlight:o&&e.include(pA,t),i.code.add(x`
          void main() {
            ${o?x`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Mv,t),r.code.add(x`
          void main() {
            ${o?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===V.ObjectAndLayerIdColor&&(o?(e.include(pA,{...t,pbrMode:mt.Disabled}),i.code.add(x`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(x`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(x`void main(void) {
        ${t.opaque?x` gl_Position = transformPosition(proj, view, position);`:""}
      }`),r.code.add(x`void main() {
fragColor = vec4(0.0);
}`))),e}const Obt=xe(),zue=C(),Rbt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:sPe,build:Pbt},Symbol.toStringTag,{value:"Module"}));let nPe=class oPe extends Ni{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Fi(e.rctx,oPe.shader.get().build(this.configuration),aPe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Lt({blending:i.renderOccluded?Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA):null,culling:r?zZ:null,depthTest:i.renderOccluded?null:{func:tr.LESS},depthWrite:i.renderOccluded?null:Oc,colorWrite:qt,stencilTest:e?Ust(Nl.IntegratedMeshMaskExcluded):null,drawBuffers:i.output===V.Depth?{buffers:[zn.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};nPe.shader=new Oi(Rbt,()=>ue(()=>import("./Terrain.glsl-ee1df916.js"),[],import.meta.url));const aPe=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let $bt=class{constructor(){this.geometry=new tbt,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new tPe(()=>this.tile.surface.fadeDuration),this.overlay=new Sbt,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new rbt,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Vn&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Ie(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return s}const n=r.level,o=Kd[e];if(!i)return Ie(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const l=i,c=l.renderData.geometryState,u=n-l.level;if(Ie(u>=0),u===0){const f=c.numVerticesPerSide-1;return Math.max(f,s)}const h=2**u,p=c.edgeResolutions[(e+2)%4]/h;return Math.max(1,p)}Ie(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(ZQ(o),l=>l===r||(l.isLoaded?(a=Math.max(a,2**(l.level-n)),!0):(Ie(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=o=>(o.isLoaded||o.level===e.level)&&o?.intersectsClippingArea,s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let o=0;o<4;++o){const a=e.findNeighborTile(Kd[o],r),l=$b(e,a),c=l?.renderData?.geometryState.samplerDataVersion??-1,u=s[o],h=l!==$b(e,u),p=n[o]!==c;Vn&&a&&(Ie(e.level>=a.level),Ie(e.level-a.level<=xn)),s[o]=a,(h||p)&&(n[o]=c,this._markEdgeDirty(o));const f=i.edgeResolutions[o],g=this._calculateEdgeResolution(o,a);Ie(NO(g)),Ie(g>=1),i.edgeResolutions[o]=g,f!==g&&this._markEdgeResolutionDirty(o)}for(let o=0;o<4;++o){const a=e.findNeighborTile(U5[o],r);i.cornerPeerNeighbors[o]=a;const l=$b(e,s[o]),c=$b(e,s[(o+1)%4]),u=$b(e,a);nd[o]=u,nd[(o+1)%4]=c,nd[(o+2)%4]=e,nd[(o+3)%4]=l,Ie(nd.some(g=>g?.isLoaded||g===e));const h=nd.reduce((g,_)=>Math.min(g,_?.level??1/0),1/0);nd.forEach((g,_)=>{g&&g?.level>h&&(nd[_]=null)}),Ie(nd.some(g=>g?.isLoaded||g===e));const p=i.cornerNeighborCornerTiles,f=i.cornerNeighborCornerTileSamplerVersions;for(let g=0;g<4;++g){const _=nd[g],v=_?.renderData.geometryState.samplerDataVersion??-1,b=4*o+g,w=p[b]!==_,T=!w&&f[b]!==v;(w||T)&&(p[b]=_,f[b]=v,this._markCornerDirty(o))}Vn&&Ie(iK.some(g=>p[4*o+g]?.isLoaded||p[4*o+g]===e))}Vn&&Ie(this.geometryState.edgeResolutions.every(o=>o>0));for(let o=0;o<4;++o)nd[o]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Vn&&Ie(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||!{geometry:s}||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((f,g)=>f+g+1,0),c=o||a&&l>(s?.maxEdgeVertexCount??0),u=!c&&a,h=!u&&(this.dirtyEdges!==0||a),p=!h&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?i.updateEdgeElevationsAndResolutions():h||p?i.updateEdgeElevations():p?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Tt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const s=i?Pt.RGBA:Pt.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&Lbt)}get samplerDataChanged(){return!!(this._modifiedFlags&Dbt)}get clippingAreaChanged(){return!!(this._modifiedFlags&Nbt)}get wireframeChanged(){return!!(this._modifiedFlags&Fbt)}get dirtyEdges(){return this._modifiedFlags>>n6&15}get dirtyCorners(){return this._modifiedFlags>>o6&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>a6&15}_markCornerDirty(e){const i=1<<e<<o6;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<n6;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<a6;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<o6|15<<n6|15<<a6}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),s0(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new Pm(e,aPe,{geometry:Lc(i.layout)},{geometry:lr.createVertex(e,s.STATIC_DRAW,i.buffer)},lr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=V_.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Nt.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let u=0;u<r;u++){const h=i[u];if(h.upsampleInfo!=null){const p=h.upsampleInfo.tile,f=p.layerInfo[Nt.ELEVATION][u].data,g=f&&f.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,p.lij[0])}else if(h.data){const p=this.tile.surface.layerViewByIndex(u,Nt.ELEVATION);if(xO(this.tile,p.layer,!1)){const f=h.data;e&&e[n]===f.samplerData||(a=!0),s[n++]=f.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Vn)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Ie(e?.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=Kd.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;Ie(this.dirtyCorners===0),Ie(this.dirtyEdges===0),Ie(this.dirtyEdgeResolutions===0),Ie(!this.numVerticesPerSideChanged),Ie(!this.samplerDataChanged),Ie(!this.clippingAreaChanged),Ie(!this.wireframeChanged);const n=U5.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Ie(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Kd.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,J=>(J.level===s||J?.isLoaded)&&J?.intersectsClippingArea);if(!c){const J=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Ie(!J)}Ie(c.isLoaded||c.level===e.level),Ie(c===this.geometryState.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return Ie(!c.isLeaf),void Ie(u===0);const h=c.renderData;Ie(Tbt(e,c,a)),Ie(u>=0);const p=2**u;if(u<0)return void Ie(!1);const f=e.renderData,g=f.geometry,_=f.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=h.geometry;if(!w)return void Ie(!1);const T=h.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S?.isLoaded){const J=S.renderData;Ie(f.geometryState.edgePeerNeighborSamplerVersions[l]===J.geometryState.samplerDataVersion),Ie(this.geometryState.edgePeerNeighborSamplerVersions[l]===J.geometryState.samplerDataVersion)}const A=(l+2)%4,P=w.getEdgeCount(A),R=v-1,F=P-1;Ie(R*p===F,`Tile[${e.lij}]:e${l},res=${R} edgeRes mismatch with Neighbor[${c.lij}]:e${A},res=${F} (expected:${R*p})`);const k=e.extent,N=a===gt.NORTH||a===gt.SOUTH,j=P-1,z=j>>u,X=v-1;if(z<1)return void Ie(X===1);Ie(z===X),Ie(NO(z));const q=w.numVerticesPerSide-1;Ie(u>0||z===Math.max(q,b));const Z=e.getNeighborEdgeStartVertexIndex(l,c);Ie(0<=Z&&Z<p);const ce=Z*z;Ie(0<=ce&&ce<=j-z);let I=0,D=ce;g.getEdgeVertexPosition(l,Yp,_,0),g.getEdgeVertexPosition(l,Xp,_,v-1);const G=hr(Yp,Xp),H=Math.max(Ibt,1e-4*G);for(let J=0;J<=z;++J){g.getEdgeVertexPosition(l,Yp,_,I),w.getEdgeVertexPosition(A,Xp,T,D);const Q=J/z,ee=N?k[0]+Q*(k[2]-k[0]):a===gt.WEST?k[0]:k[2],de=N?a===gt.SOUTH?k[1]:k[3]:k[1]+Q*(k[3]-k[1]),we=e.surface.extent;if(we==null||vk(we,ee,de)){const Re=P_(Yp,Xp),tt=ja(Yp)-ji.radius,Ye=ja(Xp)-ji.radius,qe=Re<H;if(!qe){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${I}/${v}] and [${c.lij}].edge${A}[${D}/${P}]`),we!=null&&console.warn("  surface extent= ",we," x,y=",ee,",",de);const Jt=C();_e(Jt,f.localOrigin,h.localOrigin),ja(Jt)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${h.localOrigin} d=${ja(Jt)} [${Jt}]`),(()=>{const Dt=Kr(Yp),De=Kr(Xp);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,Yp,_,I),w.getEdgeVertexPosition(A,Xp,T,D);const $e=C();yi($e,Yp,Dt),ja($e)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Dt} vs ${Yp} d=${ja($e)} [${$e}]`),yi($e,Xp,De),ja($e)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${De} vs ${Xp} d=${ja($e)} [${$e}]`)})();const Wt=g.getEdgeCount(l),Le=w.getEdgeCount(P);Ie(qe,`Mismatch in tile [${e.lij}].edge[${l}][${I}/${Wt}] vs neighbor [${c.lij}].edge[${A}][${D}/${Le}] ${eg(Yp)} vs ${eg(Xp)}  dist=${Re} h(t|n|d)=${tt}|${Ye}|${Ye-tt}`)}g.getEdgeNormal(l,TT,I),w.getEdgeNormal(A,ST,D),fe(Bue,TT),fe(Vue,ST);const He=pe(Bue,Vue),je=1-He<.01||!1||e===c;if(!je){const Jt=C();yi(Jt,TT,ST);const Wt=()=>`Mismatch in tile edge normal ${Mue(e.lij)} (${I}/${v-1}) edge ${l} vs neighbor ${Mue(c.lij)}  (${D}/${P-1}) nedge ${A} :${eg(TT)} vs ${eg(ST)}  dot = ${He} : ${eg(Jt)}`;console.warn("Mismatch in tile edge normal: ",Wt());{e.updateEdgeElevations(),c.updateEdgeElevations();const Le=C(),Dt=C();g.getEdgeNormal(l,Le,I),w.getEdgeNormal(A,Dt,D),Rw(TT,Le)||console.warn("Missing update in tile normal: ",eg(TT)," => ",eg(Le)),Rw(ST,Dt)||console.warn("Missing update in neighbor normal: ",eg(ST)," => ",eg(Dt))}Ie(je,Wt())}}I+=1,D+=1}})}};const Yp=C(),Xp=C(),TT=C(),ST=C(),Bue=C(),Vue=C(),Ibt=1,nd=[null,null,null,null];function $b(t,e){return e?.isLoaded||e===t?e:null}const Lbt=1,Dbt=2,Nbt=4,Fbt=8,n6=4,o6=8,a6=12,iK=[0,1,2,3],kbt=65536;function Ubt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=s,h=c-1,p=(c-2)**2,f=a&&(e===vh.HAS_SOUTH_POLE||e===vh.HAS_BOTH_POLES),g=a&&(e===vh.HAS_NORTH_POLE||e===vh.HAS_BOTH_POLES),_=((f?1:0)+(g?1:0))*VN*c,v=xPe(s),b=p+_+4*v,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=v;const{boundingBox:T}=r;Or(T);const S=sK(t);Po.update(h,n,S),Bbt(t),r.poleVerticesStartIndex=p;const A=zbt(t,f,g);r.edgeVerticesStartIndex=p+_,oK(t),rK(t),fPe(r,A,u),t.intersectionData=null}function zbt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=n,p=c-1,f=s[0],g=s[1],_=s[2],v=a.radius,b=o[1],w=o[3],T=[];let S=h;const A=(P,R)=>{const F=R*c;Rh(-f,-g,P*v-_,l),T.push(new nwt(P===1,F,P===1?0:2,S,VN));const k=uPe(P===-1?b:w,v),N=P*Math.PI/2-k,j=.99*(P===1?1:-1),z=v+0,{position:X,uv0:q}=u,{typedBuffer:Z,typedBufferStride:ce}=u.normalCompressed;for(let I=1;I<=VN;++I){const D=k+N*(I/VN),G=Math.cos(D),H=Math.sin(D);for(let J=0;J<=p;J++){const Q=J/p,ee=Po.sinLonLUT[J],de=Po.cosLonLUT[J]*G,we=ee*G,Re=H,tt=de*z-f,Ye=we*z-g,qe=Re*z-_;Rh(tt,Ye,qe,l),X.setValues(S,tt,Ye,qe),ap(q,S,Q,j),kh(Z,S,de,we,Re,ce),++S}}};return e&&A(-1,0),i&&A(1,p),T}function Bbt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:u}=i,h=c.position,p=c.uv0,{typedBuffer:f,typedBufferStride:g}=c.normalCompressed,{extent:_}=e,v=_[0],b=_[2],w=_[1],T=_[3],S=e.ellipsoid.radius,A=s[0],P=s[1],R=s[2],F=h.typedBuffer,k=h.typedBufferStride,N=1/l;let j=0;if(1<=a){const z=N,X=w*(1-z)+T*z,q=Po.sinLatLUT[1],Z=Po.cosLatLUT[1];for(let ce=1;ce<=a;ce++){const I=ce*N,D=v*(1-I)+b*I,G=Po.sinLonLUT[ce],H=Po.cosLonLUT[ce],J=S+ss(D,X,o),Q=J*H*Z-A,ee=J*G*Z-P,de=J*q-R;Rh(Q,ee,de,u);const we=(ce-1)*k;F[we]=Q,F[we+1]=ee,F[we+2]=de,ap(p,ce-1,I,z)}}for(let z=1;z<=a;z++){const X=z*N,q=w*(1-X)+T*X,Z=Po.sinLatLUT[z],ce=Po.cosLatLUT[z],I=z+1,D=I*N,G=w*(1-D)+T*D,H=Po.sinLatLUT[I],J=Po.cosLatLUT[I],Q=Po.sinLonLUT[0],ee=Po.cosLonLUT[0],de=S+ss(v,q,o);let we=ee*ce*de-A,Re=Q*ce*de-P,tt=Z*de-R;const Ye=j*k;let qe=F[Ye],He=F[Ye+1],je=F[Ye+2];for(let Jt=1;Jt<=a;Jt++){const Wt=Jt*N,Le=v*(1-Wt)+b*Wt,Dt=Po.sinLonLUT[Jt],De=Po.cosLonLUT[Jt];let $e=0,_t=0,bt=0;if(Jt<a){const rr=(j+1)*k;$e=F[rr],_t=F[rr+1],bt=F[rr+2]}else{const rr=Po.sinLonLUT[l],us=Po.cosLonLUT[l],Ds=S+ss(b,q,o);$e=us*ce*Ds-A,_t=rr*ce*Ds-P,bt=Z*Ds-R}const $t=we,st=Re,Be=tt;we=qe,Re=He,tt=je,qe=$e,He=_t,je=bt;const Ge=$e-$t,St=_t-st,jt=bt-Be;let Wi=0,ai=0,pi=0;if(z>1){const rr=(j-a)*k;Wi=F[rr],ai=F[rr+1],pi=F[rr+2]}else{const rr=Po.sinLatLUT[0],us=Po.cosLatLUT[0],Ds=S+ss(Le,w,o);Wi=De*us*Ds-A,ai=Dt*us*Ds-P,pi=rr*Ds-R}const Xi=S+ss(Le,G,o),ir=De*J*Xi-A,Ri=Dt*J*Xi-P,$i=H*Xi-R;if(z<a){const rr=j+a,us=rr*k;F[us]=ir,F[us+1]=Ri,F[us+2]=$i,Rh(ir,Ri,$i,u),ap(p,rr,Wt,D)}const wi=Wi-ir,Ht=ai-Ri,ri=pi-$i;let Ii=De*ce,Bi=Dt*ce,zr=Z;zr*zr<.999&&(Ii=jt*Ht-St*ri,Bi=Ge*ri-jt*wi,zr=St*wi-Ge*Ht);const Zi=1/Math.sqrt(Ii*Ii+Bi*Bi+zr*zr);kh(f,j,Ii*Zi,Bi*Zi,zr*Zi,g),++j}}}function Vbt(t){t.tile.intersectsClippingArea&&(rK(t),SE(t),t.intersectionData=null)}function Gbt(t){t.tile.intersectsClippingArea&&(yPe(t),rK(t),SE(t),bPe(t),t.intersectionData=null)}function jbt(t){t.tile.intersectsClippingArea&&(cPe(t),lPe(t,!0),SE(t),t.intersectionData=null)}function rK(t){t.tile.intersectsClippingArea&&(cPe(t),lPe(t))}function lPe(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,u=c.radius,h=l[0],p=l[2],f=l[1],g=l[3],{samplerData:_}=r,v=a[0],b=a[2],w=a[1],T=a[3],S=sK(t),{boundingBox:A,vertexAttributes:P}=i,R=n[0],F=n[1],k=n[2],N=P.position,j=N.typedBuffer,z=N.typedBufferStride,X=P.uv0;for(let q=0;q<4;++q){const Z=q===1||q===3,ce=r.edgeResolutions[q];Ie(NO(ce));const I=ce+1,D=$b(s,r.edgePeerNeighbors[q]);if(wPe(s,D,q)){_Pe(t,q,D);continue}const G=D!=null;Ie(!G||D.level===s.level),Ie(!G||Wf(s,D)<=0);const H=D?.renderData,J=H?.geometryState;if(Vn){const Ge=s.surface;if(!D&&Ge&&!Ge.updatingRootTiles){const St=Kd[q],jt=s.findNeighborTile(St,Wi=>Wi.isLoaded||Wi.isLeaf||Wi.level===s.level);jt?jt.intersectsClippingArea&&(Ie(!jt.isLoaded),Ie(!jt.isLeaf),Ie(jt.level===o)):Ie(Ge?.rootTiles==null||!s.shouldHaveNeighbor(St))}}const Q=q===1?a[2]:a[0],ee=D?.extent,de=ee&&Z?q===1?ee[0]:ee[2]:Q,we=q===0?a[3]:a[1],Re=q===1?1:0,tt=q===0?1:0,Ye=q===1?p:h,qe=q===0?g:f,He=Math.sin(Ye),je=Math.cos(Ye),Jt=Math.sin(qe),Wt=Math.cos(qe),Le=J?.samplerData,Dt=G?(Ge,St,jt)=>.5*(ss(Ge,St,_)+ss(jt,St,Le)):(Ge,St,jt)=>ss(Ge,St,_),De=i.outerEdgesOffsetAndLength[2*q+0],$e=e&&I>3?I-3:1,_t=_!=null&&_.some(Ge=>Ge!=null),bt=Le!=null&&Le.some(Ge=>Ge!=null),$t=_t||bt,st=1/ce,Be=De;Ie(!ee||bh(ee[2]-ee[0],a[2]-a[0])),(()=>{const Ge=q===1?-1:q===3?1:0,St=q===0?-1:q===2?1:0,jt=(a[2]-a[0])*st,Wi=Ge*jt,ai=St*jt,pi=Z?Ge*((p-h)*st):0,Xi=Z?0:St*st,ir=tt,Ri=Z?Ye+pi:Ye,$i=Z?Math.sin(Ri):He,wi=Z?Math.cos(Ri):je,Ht=Z?Ye-pi:Ye,ri=Z?Math.sin(Ht):He,Ii=Z?Math.cos(Ht):je,Bi=Z?qe:S(ir+Xi),zr=Z?Jt:Math.sin(Bi),Zi=Z?Wt:Math.cos(Bi),rr=Z?qe:S(ir-Xi),us=Z?Jt:Math.sin(rr),Ds=Z?Wt:Math.cos(rr);let vo=0,al=0,$n=0;{const li=0*st,Ys=Z?Q:v*(1-li)+b*li,mn=Z?de:Ys,on=Z?w*(1-li)+T*li:we,oe=Z?Ye:h*(1-li)+p*li,Ir=Z?He:Math.sin(oe),jh=Z?je:Math.cos(oe),Qn=Z?S(li):qe,Hh=Z?Math.sin(Qn):Jt,pt=Z?Math.cos(Qn):Wt,jl=u+Dt(Ys,on,mn);vo=jh*pt*jl,al=Ir*pt*jl,$n=Hh*jl}let Jn=0,fn=0,hs=0;{const li=1*st,Ys=Z?Q:v*(1-li)+b*li,mn=Z?de:Ys,on=Z?w*(1-li)+T*li:we,oe=Z?Ye:h*(1-li)+p*li,Ir=Z?He:Math.sin(oe),jh=Z?je:Math.cos(oe),Qn=Z?S(li):qe,Hh=Z?Math.sin(Qn):Jt,pt=Z?Math.cos(Qn):Wt,jl=u+Dt(Ys,on,mn);Jn=jh*pt*jl,fn=Ir*pt*jl,hs=Hh*jl}for(let li=1;li<I-1;li+=$e){let Ys=0,mn=0,on=0;{const Ra=(li+1)*st,Hl=Z?Q:v*(1-Ra)+b*Ra,Ap=Z?de:Hl,eo=Z?w*(1-Ra)+T*Ra:we,ds=Z?Ye:h*(1-Ra)+p*Ra,U0=Z?He:Math.sin(ds),Dv=Z?je:Math.cos(ds),Nv=Z?S(Ra):qe,Sx=Z?Math.sin(Nv):Jt,Fv=Z?Math.cos(Nv):Wt,z0=u+Dt(Hl,eo,Ap);Ys=Dv*Fv*z0,mn=U0*Fv*z0,on=Sx*z0}const oe=Ys,Ir=mn,jh=on,Qn=Jn,Hh=fn,pt=hs;Jn=oe,fn=Ir,hs=jh;{const Ra=Be+li,Hl=Ra*z,Ap=Qn-R,eo=Hh-F,ds=pt-k;j[Hl]=Ap,j[Hl+1]=eo,j[Hl+2]=ds,Rh(Ap,eo,ds,A);const U0=li*st;ap(X,Ra,Z?Re:U0,Z?U0:tt)}const jl=vo,Kn=al,$v=$n;vo=Qn,al=Hh,$n=pt;const Iv=Qn,ll=Hh,Nm=pt,Lv=1/Math.sqrt(Iv*Iv+ll*ll+Nm*Nm),Qt=Nm*Lv;let F0=0,Fm=0,k0=0;if($t&&Qt*Qt<.999){let Ra=0,Hl=0,Ap=0;{const eo=q===0?-1:1;Ra=eo*(oe-jl),Hl=eo*(Ir-Kn),Ap=eo*(jh-$v)}{const eo=li*st,ds=Z?Q:v*(1-eo)+b*eo,U0=Z?de:ds,Dv=Z?w*(1-eo)+T*eo:we,Nv=Z?Ye:h*(1-eo)+p*eo,Sx=Z?He:Math.sin(Nv),Fv=Z?je:Math.cos(Nv),z0=Z?S(eo):qe,W$=Z?Math.sin(z0):Jt,cl=Z?Math.cos(z0):Wt;let EE=Iv,AE=ll,Y=Nm;if(G){const ve=u+ss(U0-Wi,Dv-ai,Le),Ae=Z?cl:Ds;EE=(Z?Ii:Fv)*Ae*ve,AE=(Z?ri:Sx)*Ae*ve,Y=(Z?W$:us)*ve}{const ve=u+ss(ds+Wi,Dv+ai,_),Ae=Z?cl:Zi,fi=(Z?wi:Fv)*Ae*ve,an=(Z?$i:Sx)*Ae*ve,Cs=(Z?W$:zr)*ve;G||(EE=2*Iv-fi,AE=2*ll-an,Y=2*Nm-Cs);const $a=q===3?-1:1,kv=$a*(EE-fi),SK=$a*(AE-an),CK=$a*(Y-Cs);F0=Ap*SK-Hl*CK,Fm=Ra*CK-Ap*kv,k0=Hl*kv-Ra*SK;const Rz=1/Math.sqrt(F0*F0+Fm*Fm+k0*k0);F0*=Rz,Fm*=Rz,k0*=Rz}}}else F0=Iv*Lv,Fm=ll*Lv,k0=Nm*Lv;i.setEdgeNormalFromValues(q,li,F0,Fm,k0)}})()}}function cPe(t){vPe(t)}function uPe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function Hbt(t,e,i,r){return uPe(t*(1-r)+e*r,i)}function qbt(t,e,i){return t*(1-i)+e*i}function sK(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>Hbt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>qbt(i[1],i[3],r)}function Wbt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],u=n[2]-l,h=n[3]-c,{numVerticesPerSide:p,clippingArea:f}=r,g=f!=null?Math.max(0,(f[0]-l)/u):0,_=f!=null?Math.max(0,(f[1]-c)/h):0,v=f!=null?Math.min(1,(f[2]-l)/u):1,b=f!=null?Math.min(1,(f[3]-c)/h):1,w=(p-2)**2,T=xPe(r),S=w+4*T,A=o.renderer.tileGeometryCache.acquire(S),{boundingBox:P}=s;Or(P),s.numVerticesPerSide=p,s.vertexAttributes=A,s.maxEdgeVertexCount=T,s.minu=g,s.minv=_,s.maxu=v,s.maxv=b,Ybt(t),s.edgeVerticesStartIndex=w,oK(t),nK(t),fPe(s,[],a),t.intersectionData=null}function Ybt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:h}=l,p=o??aK,f=c[0],g=c[1],_=c[2],v=c[3],b=Math.max(f,p[0]),w=Math.min(_,p[2]),T=Math.max(g,p[1]),S=Math.min(v,p[3]),A=u.radius,P=e.horizontalScale,R=a-1,F=a-2,{minu:k,minv:N,maxu:j,maxv:z,boundingBox:X,vertexAttributes:q}=i,Z=q.position,ce=q.uv0,{typedBuffer:I,typedBufferStride:D}=q.normalCompressed,G=s[0],H=s[1],J=s[2],Q=Z.typedBuffer,ee=Z.typedBufferStride;let de=0;const we=Te(g,T,S),Re=h?(Math.PI/2-2*Math.atan(Math.exp(-we/A)))*A:we*P,tt=1/R,Ye=Te(g*(1-tt)+v*tt,T,S);let qe=Re,He=h?(Math.PI/2-2*Math.atan(Math.exp(-Ye/A)))*A:Ye*P;for(let je=1;je<=F;je++){const Jt=je/R,Wt=Te(g*(1-Jt)+v*Jt,T,S),Le=Te(Jt,N,z),Dt=He,De=(je-1)/R,$e=Te(g*(1-De)+v*De,T,S),_t=qe,bt=(je+1)/R,$t=Te(g*(1-bt)+v*bt,T,S),st=h?(Math.PI/2-2*Math.atan(Math.exp(-$t/A)))*A:$t*P,Be=Te(bt,N,z);qe=He,He=st;const Ge=Te(f,b,w);let St=Ge*P,jt=ss(Ge,Wt,n);const Wi=1/R,ai=Te(Wi,k,j),pi=Te(f*(1-ai)+_*ai,b,w);let Xi=ai,ir=pi,Ri=pi*P,$i=ss(pi,Wt,n);if(je===1){const wi=Ri-G,Ht=qe-H,ri=$i-J,Ii=0*ee;Q[Ii]=wi,Q[Ii+1]=Ht,Q[Ii+2]=ri,Rh(wi,Ht,ri,X);const Bi=Te(Wi,k,j);ap(ce,de,Bi,Le)}for(let wi=1;wi<=F;wi++){const Ht=Ri,ri=$i,Ii=(wi+1)/R,Bi=Te(Ii,k,j),zr=Te(f*(1-Ii)+_*Ii,b,w),Zi=ir;ir=zr;{const fn=de+1,hs=fn*ee;if(je===1||wi===F){const li=zr*P,Ys=ss(zr,Wt,n);if(je===1&&wi<F){const mn=li-G,on=Dt-H,oe=Ys-J;Q[hs]=mn,Q[hs+1]=on,Q[hs+2]=oe,Rh(mn,on,oe,X),ap(ce,fn,Bi,Le)}Ri=li,$i=Ys}else Ri=Q[hs]+G,$i=Q[hs+2]+J}const rr=Ri,us=$i,Ds=St,vo=jt;St=Ht,jt=ri;const al=(de-F)*ee,$n=je===1?ss(Zi,$e,n):Q[al+2]+J,Jn=ss(Zi,$t,n);if(je<F){const fn=de+F,hs=fn*ee,li=Ht-G,Ys=st-H,mn=Jn-J;Q[hs]=li,Q[hs+1]=Ys,Q[hs+2]=mn,Rh(li,Ys,mn,X);const on=Xi;Xi=Bi,ap(ce,fn,on,Be)}{const fn=rr-Ds,hs=_t-st,li=hs*(us-vo),Ys=fn*($n-Jn),mn=-hs*fn,on=li*li+Ys*Ys+mn*mn;if(on===0)kh(I,de,0,0,1,D);else{const oe=1/Math.sqrt(on);kh(I,de,li*oe,Ys*oe,mn*oe,D)}}++de}}}function Xbt(t,e){t.tile.intersectsClippingArea&&(dPe(t),hPe(t,!0),SE(t),t.intersectionData=null)}function Zbt(t,e){t.tile.intersectsClippingArea&&(yPe(t),nK(t),SE(t),bPe(t),t.intersectionData=null)}function Jbt(t,e){t.tile.intersectsClippingArea&&(nK(t),SE(t),t.intersectionData=null)}function nK(t,e){t.tile.intersectsClippingArea&&(dPe(t),hPe(t,!1))}function hPe(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,u=l??aK,h=a[0],p=a[2],f=a[1],g=a[3],_=[g>u[3],p>u[2],f<u[1],h<u[0]],v=n.horizontalScale,b=pPe(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:T,maxu:S,maxv:A,boundingBox:P}=i,R=Math.max(h,u[0]),F=Math.min(p,u[2]),k=Math.max(f,u[1]),N=Math.min(g,u[3]),j=s[0],z=s[1],X=s[2];for(let q=0;q<4;++q){const Z=q===1||q===3,ce=r.edgeResolutions[q];Ie(NO(ce));const I=ce+1,D=_[q],G=$b(n,r.edgePeerNeighbors[q]);if(!D&&wPe(n,G,q)){_Pe(t,q,G);continue}const H=G!=null&&!D,J=G?.renderData,Q=J?.geometryState;if(Vn&&(Ie(!H||G.level===n.level),Ie(!H||Wf(n,G)<=0),n&&!G&&!o.updatingRootTiles)){const st=Kd[q],Be=n.findNeighborTile(st,Ge=>Ge.isLoaded||Ge.isLeaf||Ge.level===n.level);o.updatingRootTiles||(Be?Be.intersectsClippingArea&&(Ie(!Be.isLoaded),Ie(!Be.isLeaf),Ie(Be.level===n.level)):Ie(o?.rootTiles==null||!n.shouldHaveNeighbor(st)))}const ee=Te(q===1?p:h,R,F),de=Te(q===0?g:f,k,N),we=Q?.samplerData,Re=e&&I>3?I-3:1,tt=Te(q===1?1:0,w,S),Ye=Te(q===0?1:0,T,A),qe=H?(st,Be)=>.5*(ss(st,Be,we)+ss(st,Be,c)):(st,Be)=>ss(st,Be,c),He=(p-h)/ce,je=Z?q===1?He:-He:0,Jt=Z?0:q===0?He:-He,Wt=-je,Le=-Jt;let Dt=0,De=0,$e=0;{const st=0/ce,Be=Z?ee:Te(h*(1-st)+p*st,R,F),Ge=Z?Te(f*(1-st)+g*st,k,N):de,St=qe(Be,Ge);Dt=Be*v,De=b(Ge),$e=St}let _t=0,bt=0,$t=0;{const st=1/ce,Be=Z?ee:Te(h*(1-st)+p*st,R,F),Ge=Z?Te(f*(1-st)+g*st,k,N):de,St=qe(Be,Ge);_t=Be*v,bt=b(Ge),$t=St}for(let st=1;st<I-1;st+=Re){const Be=st/ce,Ge=_t,St=bt,jt=$t;{const ri=Z?tt:Te(Be,w,S),Ii=Z?Te(Be,T,A):Ye,Bi=Ge-j,zr=St-z,Zi=jt-X;Rh(Ge,zr,Zi,P),i.setEdgeVertexFromValuesRawPositionUV(q,st,Bi,zr,Zi,ri,Ii)}{const ri=(st+1)/ce,Ii=Z?ee:Te(h*(1-ri)+p*ri,R,F),Bi=Z?Te(f*(1-ri)+g*ri,k,N):de,zr=qe(Ii,Bi);_t=Ii*v,bt=b(Bi),$t=zr}const Wi=_t,ai=$t,pi=Dt,Xi=De,ir=$e;Dt=Ge,De=St,$e=jt;let Ri=0,$i=0,wi=0;if(Z){const ri=bt-St,Ii=ai-jt,Bi=Xi-St,zr=ir-jt,Zi=Te(f*(1-Be)+g*Be,k,N),rr=ee+Wt,us=rr*v-Ge,Ds=ss(rr,Zi,c)-jt,vo=q===3?-1:1;if(Ri=vo*(-Bi+ri)*Ds,$i=vo*us*(-zr+Ii),wi=-vo*us*(-Bi+ri),H){const al=ee+je,$n=al*v-Ge;Ri=(-Bi+ri)*(Ds-(ss(al,Zi,we)-jt)),$i=(us-$n)*(-zr+Ii),wi=-(us-$n)*(-Bi+ri)}}else{const ri=Wi-Ge,Ii=ai-jt,Bi=pi-Ge,zr=ir-jt,Zi=Te(h*(1-Be)+p*Be,R,F),rr=de+Le,us=ss(Zi,rr,c)-jt,Ds=b(rr)-St,vo=q===2?-1:1;if(Ri=vo*Ds*(-zr+Ii),$i=vo*(-Bi+ri)*us,wi=-vo*Ds*(-Bi+ri),H){const al=Zi,$n=de+Jt,Jn=b($n)-St;Ri=(-Ds+Jn)*(-zr+Ii),$i=(-Bi+ri)*(-us+(ss(al,$n,we)-jt)),wi=-(-Ds+Jn)*(-Bi+ri)}}const Ht=1/Math.sqrt(Ri*Ri+$i*$i+wi*wi);i.setEdgeNormalFromValues(q,st,Ri*Ht,$i*Ht,wi*Ht)}}}function dPe(t,e){vPe(t)}function Qbt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function Kbt(t,e){return t*e}function pPe(t,e,i){return t?r=>Qbt(r,e):r=>Kbt(r,i)}function fPe(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),u=iK.reduce((_,v)=>_+(o+t.getEdgeCount(v)-3),0),h=e.reduce((_,v)=>_+o*(2*(v.latitudeResolution-1)+1),0),p=3*(i?2:1),f=(l+c+h)*p,g=a>=kbt?new Uint32Array(f):new Uint16Array(f);for(let _=0;_<f;++_)g[_]=0;t.indices=g,t.indexCount=(l+u+h)*p,t.poleIndicesStartIndex=l*p,t.edgeIndicesStartIndex=(l+h)*p,i?(iwt(t),rwt(t,e),gPe(t)):(ewt(t),twt(t,e),mPe(t))}function ewt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,u=e-3;let h=0;for(let p=0;p<l;++p){const f=p*a;for(let g=c;g<u;++g){const _=f+g,v=_+1,b=v+a,w=b-1;TPe(_,v,b,w,o,n)?(i[h]=_,i[h+1]=v,i[h+2]=b,i[h+3]=b,i[h+4]=w,i[h+5]=_):(i[h]=_,i[h+1]=v,i[h+2]=w,i[h+3]=w,i[h+4]=v,i[h+5]=b),h+=6}}}function twt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,u=a.isNorth?3:4,h=a.isNorth?4:3;let p=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),f=1;for(let g=0;g<a.latitudeResolution;++g){const _=g===0?a.rowOffset:p+i;for(let v=0;v<n;v++){const b=_+v;r[o]=p,r[o+l]=p+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+u]=p+1,r[o+h]=b+1,r[o+5]=b,o+=6):o+=3,p+=f}p=_,f=1}}}function mPe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=lK[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;Ie(p===s-1);const f=a===1||a===2,g=f?1:2,_=f?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,T=l.stride;for(;c<h-1||u<p-1;){const S=w+u*T,A=v+c*b,P=c<h-1,R=u<p-1,F=P&&(!R||(P?0+s*(c+.5)/(h-1):0)<=(R?1+n*(u+.5)/(p-1):0));F?++c:++u;const k=F?A+b:S+T;e[o]=S,e[o+g]=A,e[o+_]=k,o+=3}}t.indexCount=o}function iwt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const u=c*a;for(let h=0;h<i-3;++h){const p=c*a+h,f=p+1,g=f+a,_=g-1,v=u+h,b=v+1,w=b+a;TPe(v,b,w,w-1,o,n)?(n2(e,l,p,f,g),l+=6,n2(e,l,g,_,p)):(n2(e,l,p,f,_),l+=6,n2(e,l,_,g,f)),l+=6}}}function rwt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let h=0;h<a.latitudeResolution;++h){const p=h===0?a.rowOffset:c+r;for(let f=0;f<n;f++)n2(i,o,c,c+1,p+f),o+=6,h<a.latitudeResolution-1&&(n2(i,o,c+1,p+f+1,p+f),o+=6),c+=u;c=p,u=1}}}function gPe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=lK[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;Ie(p===s-1);const f=a===1||a===2,g=f?1:3,_=f?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,T=l.stride;for(;c<h-1||u<p-1;){const S=w+u*T,A=v+c*b,P=c<h-1,R=u<p-1,F=P&&(!R||(P?0+s*(c+.5)/(h-1):0)<=(R?1+n*(u+.5)/(p-1):0));F?++c:++u;const k=F?A+b:S+T;e[o]=S,e[o+g]=A,e[o+g+1]=A,e[o+_]=k,e[o+_+1]=k,e[o+5]=S,o+=6}}t.indexCount=o}function oK(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),h=(c?0:1)*o+(c?1:0),p=lK[l];p.vertex0Index=u,p.stride=h,p.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function yPe(t){oK(t),t.geometryState.wireframe?gPe(t.geometry):mPe(t.geometry)}function _Pe(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];Ie(NO(l));const c=l+1,{boundingBox:u,minu:h,minv:p,maxu:f,maxv:g,vertexAttributes:_}=s,v=Te(e===1?1:0,h,f),b=Te(e===0?1:0,p,g),w=i.renderData,T=w.geometryState,S=w.geometry,A=(e+2)%4,P=S.getEdgeCount(A),R=n.getNeighborEdgeStartVertexIndex(e,i)*l,F=l*2**(n.level-i.level);Ie(T.edgeResolutions[A]===F),Ie(P-1===F);const k=w.localOrigin[0]-o[0],N=w.localOrigin[1]-o[1],j=w.localOrigin[2]-o[2],z=s.getEdgeFirstVertexIndex(e),X=_.position,q=X.typedBuffer,Z=X.typedBufferStride,ce=_.normalCompressed,I=ce.typedBuffer,D=ce.typedBufferStride,G=_.uv0,H=S.vertexAttributes,J=S.getEdgeFirstVertexIndex(A),Q=H.position.typedBuffer,ee=H.position.typedBufferStride,de=H.normalCompressed.typedBuffer,we=H.normalCompressed.typedBufferStride;for(let Re=1;Re<c-1;++Re){const tt=z+Re,Ye=J+(R+Re),qe=tt*Z,He=Ye*ee,je=Q[He]+k,Jt=Q[He+1]+N,Wt=Q[He+2]+j;q[qe]=je,q[qe+1]=Jt,q[qe+2]=Wt,Rh(je,Jt,Wt,u);const Le=tt*D,Dt=Ye*we;I[Le]=de[Dt],I[Le+1]=de[Dt+1];const De=Re/l,$e=a?v:Te(De,h,f),_t=a?Te(De,p,g):b;ap(G,tt,$e,_t)}}function vPe(t){const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:h}=e,p=t.tile,{surface:f,ellipsoid:g,extent:_,extentInRadians:v,horizontalScale:b}=p,w=f.view?.viewingMode==="local",T=g.radius;let S=0,A=0,P=0;const R=(Le,Dt,De)=>{const $e=v[Dt===0?1:3],_t=v[Le===0?0:2],bt=Math.cos($e),$t=Math.sin($e),st=Math.sin(_t),Be=Math.cos(_t),Ge=T+De;S=Be*bt*Ge,A=st*bt*Ge,P=$t*Ge},F=w?(()=>{const Le=s,Dt=Le!=null&&(_[3]>Le[3]||_[2]>Le[2]||_[1]<Le[1]||_[0]<Le[0]),De=pPe(f.isWebMercatorOnPlateCarree,T,b);return($e,_t,bt)=>{const $t=$e===0?_[0]:_[2],st=_t===0?_[1]:_[3],Be=Dt?Te($t,Le[0],Le[2]):$t,Ge=Dt?Te(st,Le[1],Le[3]):st,St=bt;S=Be*b,A=De(Ge),P=St}})():R;let k=0,N=0,j=0,z=0,X=0,q=0,Z=0,ce=0,I=0;const D=w&&f.isWebMercatorOnPlateCarree,G=(Le,Dt,De,$e,_t)=>{let bt=0,$t=0,st=0;if(w){const Be=Dt*b,Ge=D?(Math.PI/2-2*Math.atan(Math.exp(-De/T)))*T:De*b;bt=Be-S,$t=Ge-A,st=$e-P}else{const Be=sK(Le),Ge=Le.tile,St=Ge.extent,jt=Ge.extentInRadians,Wi=(Dt-St[0])/(St[2]-St[0]),ai=(De-St[1])/(St[3]-St[1]),pi=jt[0]*(1-Wi)+jt[2]*Wi,Xi=Be(ai),ir=Math.cos(Xi),Ri=Math.sin(Xi),$i=Math.sin(pi),wi=Math.cos(pi),Ht=T+$e;bt=wi*ir*Ht-S,$t=$i*ir*Ht-A,st=Ri*Ht-P}switch(_t){case 0:Z+=bt,ce+=$t,I+=st;break;case 1:z-=bt,X-=$t,q-=st;break;case 2:Z-=bt,ce-=$t,I-=st;break;case 3:z+=bt,X+=$t,q+=st}},H=s??aK,J=_[0],Q=_[2],ee=_[1],de=_[3],we=[de>H[3],Q>H[2],ee<H[1],J<H[0]],Re=Math.max(J,H[0]),tt=Math.min(Q,H[2]),Ye=Math.max(ee,H[1]),qe=Math.min(de,H[3]),He=Le=>Math.max(H[0],Math.min(H[2],Le)),je=Le=>Math.max(H[1],Math.min(H[3],Le)),Jt=Le=>{const Dt=i.cornerNeighborCornerTiles;k=0,N=0,j=1,z=0,X=0,q=0,Z=0,ce=0,I=0;let De=1/0;for(let Be=0;Be<4;++Be){const Ge=Dt[4*Le+Be];De=Math.min(De,Ge?.level??1/0)}for(let Be=0;Be<4;++Be){const Ge=Dt[4*Le+Be];$A[Be]=Ge?.level===De?Ge:null}let $e=1,_t=0;for(let Be=0;Be<4;++Be){const Ge=$A[Be];Ge&&($e=Math.max($e,Ge?.renderData.geometryState.numVerticesPerSide),_t=Ge.extent[2]-Ge.extent[0])}const bt=_t,$t=$e;Ie($t>1);const st=bt/$t;for(let Be=0;Be<4;++Be){const Ge=$A[(Be+3)%4],St=$A[Be%4];if(!Ge&&!St)continue;const jt=Be===0?1:Be===1?2:Be===2?3:0,Wi=Be===0?2:Be===1?3:Be===2?0:1;if(Ge&&St){const ai=l6[Be][0]*st,pi=l6[Be][1]*st,Xi=Ge.extent,ir=He(Xi[jt===0||jt===1?2:0]+ai),Ri=je(Xi[jt===0||jt===3?3:1]+pi),$i=St.extent,wi=He($i[Wi===0||Wi===1?2:0]+ai),Ht=je($i[Wi===0||Wi===3?3:1]+pi),ri=Ge.renderData,Ii=St.renderData,Bi=ss(ir,Ri,ri.geometryState.samplerData),zr=ss(wi,Ht,Ii.geometryState.samplerData);G(ri,ir,Ri,.5*(Bi+zr),Be)}else{const ai=Ge??St,pi=Ge?jt:Wi,Xi=ai.extent,ir=l6[Be],Ri=He(Xi[pi===0||pi===1?2:0]+ir[0]*st),$i=je(Xi[pi===0||pi===3?3:1]+ir[1]*st),wi=ai.renderData,Ht=ss(Ri,$i,wi.geometryState.samplerData);G(wi,Ri,$i,Ht,Be)}}if(!w){const Be=Math.sqrt(S*S+A*A+P*P);k=S/Be,N=A/Be,j=P/Be}if(w||j*j<.999){const Be=Math.sqrt(z*z+X*X+q*q);z/=Be,X/=Be,q/=Be;const Ge=Math.sqrt(Z*Z+ce*ce+I*I);Z/=Ge,ce/=Ge,I/=Ge,k=q*ce-X*I,N=z*I-q*Z,j=X*Z-z*ce;const St=1/Math.sqrt(k*k+N*N+j*j);k*=St,N*=St,j*=St}},Wt=i.cornerNeighborCornerTiles;for(let Le=0;Le<4;++Le){const Dt=Le,De=(Le+1)%4,$e=Le===0||Le===1?1:0,_t=Le===0||Le===3?1:0,bt=Te($e,o,l),$t=Te(_t,a,c),st=e.getEdgeFirstVertexIndex(Dt),Be=e.getEdgeCount(Dt),Ge=Le===0||Le===3?Be-1:0,St=e.getEdgeFirstVertexIndex(De),jt=e.getEdgeCount(De),Wi=Le===0||Le===1?jt-1:0;let ai=-1;for(let ir=0;ir<4;++ir){const Ri=Wt[4*Le+ir],$i=Wt[4*Le+ai];Ri&&(ai===-1||Wf($i,Ri)>0)&&(ai=ir)}const pi=ai,Xi=Wt[4*Le+pi];if(Xi!==p){const ir=p.level-Xi.level,Ri=2**ir,$i=[Xi.lij[0]+ir,Xi.lij[1]*Ri,Xi.lij[2]*Ri],wi=[$i[1]+Ri===p.lij[1],Le===0&&(pi===1||pi===0&&Xi!==Wt[4*Le+3])||Le===1&&(pi===0||pi===1&&Xi!==Wt[4*Le+2]),$i[1]===p.lij[1]+1,Le===2&&(pi===3||pi===2&&Xi!==Wt[4*Le+1])||Le===3&&(pi===2||pi===3&&Xi!==Wt[4*Le+0])],Ht=wi.reduce((Zi,rr)=>Zi+(rr?1:0),0);Ie(Ht===1||Ht===2);let ri=-1,Ii=-1;const Bi=Xi.renderData;if(Ht===1){const Zi=wi.findIndex(us=>us);Ie(0<=Zi&&Zi<=3),ri=(Zi+2)%4;const rr=i.edgeResolutions[Zi];Ii=p.getNeighborEdgeStartVertexIndex(Zi,Xi)*rr+rr*(Zi===0&&Le===0||Zi===1&&Le===0||Zi===2&&Le===1||Zi===3&&Le===3?1:0)}else{Ie(wi[1]||wi[3]),ri=wi[1]?3:1;const Zi=Bi.geometryState.edgeResolutions[ri];Ii=Le===0||Le===3?0:Zi}const zr=Bi.geometry;{const Zi=st+Ge,rr=St+Wi,us=zr.getEdgeFirstVertexIndex(ri)+Ii,Ds=zr.vertexAttributes,vo=Bi.localOrigin;{const $n=Ds.position,Jn=$n.typedBuffer,fn=us*$n.typedBufferStride,hs=Jn[fn]+vo[0]-r[0],li=Jn[fn+1]+vo[1]-r[1],Ys=Jn[fn+2]+vo[2]-r[2];Rh(hs,li,Ys,u);const mn=h.position,on=mn.typedBuffer;{const oe=Zi*mn.typedBufferStride;on[oe]=hs,on[oe+1]=li,on[oe+2]=Ys}{const oe=rr*mn.typedBufferStride;on[oe]=hs,on[oe+1]=li,on[oe+2]=Ys}}const al=h.uv0;ap(al,Zi,bt,$t),ap(al,rr,bt,$t);{const $n=Ds.normalCompressed.typedBuffer,Jn=us*Ds.normalCompressed.typedBufferStride,fn=h.normalCompressed,hs=fn.typedBuffer;{const li=Zi*fn.typedBufferStride;hs[li]=$n[Jn],hs[li+1]=$n[Jn+1]}{const li=rr*fn.typedBufferStride;hs[li]=$n[Jn],hs[li+1]=$n[Jn+1]}}}}else{const ir=we[Dt],Ri=we[De];let $i;if(ir||Ri){const Ii=Te(J*(1-$e)+Q*$e,Re,tt),Bi=Te(ee*(1-_t)+de*_t,Ye,qe);$i=ss(Ii,Bi,n)}else $i=swt(Wt,Le);F($e,_t,$i),Jt(Le);const wi=S-r[0],Ht=A-r[1],ri=P-r[2];Rh(wi,Ht,ri,u),e.setEdgeVertexFromValuesRawPositionUVNormal(Dt,Ge,wi,Ht,ri,bt,$t,k,N,j),e.setEdgeVertexFromValuesRawPositionUVNormal(De,Wi,wi,Ht,ri,bt,$t,k,N,j)}}for(let Le=0;Le<4;++Le)$A[Le]=null}function swt(t,e){const i=4*e,r=iK.reduce((a,l)=>Math.min(a,t[i+l]?.level??1/0),1/0);Vn&&(Ie(!t[i+0]||!t[i+2]||dW(t[i+0],t[i+2],gt.SOUTH_WEST)),Ie(!t[i+1]||!t[i+3]||dW(t[i+1],t[i+3],gt.NORTH_WEST)));let s=0,n=0;for(let a=0;a<4;++a){const l=t[i+a];if(l&&l.level===r){const c=a===0||a===1,u=a===0||a===3,h=l.extent,p=h[c?0:2],f=h[u?1:3],g=l.renderData?.geometryState?.samplerData;n+=ss(p,f,g),s++}}const o=s?n/s:0;return Ie(o!=null),o}function SE(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.geometry.setSubData(n,s,s,n.length)}function bPe(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let nwt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const l6=[[0,1],[1,0],[0,-1],[-1,0]],Po=new ibt,aK=yk(-1/0,-1/0,1/0,1/0),$A=[null,null,null,null];function wPe(t,e,i){if(!e)return!1;const r=Wf(t,e);return r>0||r===0&&i>=2}let LL=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Ie(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const lK=[new LL,new LL,new LL,new LL];function Rh(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function xPe(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function TPe(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],u=e*s,h=n[u],p=n[u+1],f=n[u+2],g=i*s,_=n[g],v=n[g+1],b=n[g+2],w=r*s,T=n[w],S=n[w+1],A=n[w+2];return(h-T)*(h-T)+(p-S)*(p-S)+(f-A)*(f-A)>(a-_)*(a-_)+(l-v)*(l-v)+(c-b)*(c-b)}function n2(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const VN=6;let owt=class extends QQ{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Vt(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&Cw(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,u=this._extentInRenderSR,h=this.extent;if(c){const p=Ce(h[0],h[1],0);_o(p,We.WebMercator,p,We.PlateCarree);const f=Ce(h[2],h[3],0);_o(f,We.WebMercator,f,We.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=f[0],u[3]=f[1]}else for(let p=0;p<4;++p)u[p]=h[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[Js.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const h=e[u],p=h[0],f=h[1],g=h[2],_=h[3];if(p*(p>0?r:o)+f*(f>0?s:a)+g*(g>0?n:l)+_>=0)return _a.OUTSIDE;c=c&&p*(p<0?r:o)+f*(f<0?s:a)+g*(g<0?n:l)+_<=0}return c?_a.INSIDE:_a.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return Y5e(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return DL[0]=1/i[0],DL[1]=1/i[1],DL[2]=1/i[2],HJ(this._aabb(),e,DL,r,s)}createGeometry(){Wbt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.isLeaf){s=1/0,n=-1/0;for(const o of this.children)s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n,this.parent?._updateSubtreeGeometryElevationsBounds())}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){Xbt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){Jbt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){Zbt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const DL=C();let awt=class{constructor(){this.extent=Yt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},GN=class extends Pe{constructor(){super(...arguments),this._queries=new Gt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Gt({initialSize:30}),this._queryPool=new Ko(awt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();Ch(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};d([m()],GN.prototype,"updating",null),GN=d([U("esri.views.3d.terrain.ScaleRangeQueries")],GN);function lwt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let cwt=class extends QQ{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Ws(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],h=Et(l,u,.5),p=Et(a,c,.5),f=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),lwt(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),fe(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)te(e[Js.MIDDLE],0,0,0),te(e[Js.TOP],0,0,0),te(e[Js.BOTTOM],0,0,0),e[Js.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[Js.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,uwt(i,r,3*n));e[Js.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!C_(e,this._boundingSphere))return _a.OUTSIDE;if(this.lij[0]<10)return _a.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<fE;n++){const o=n===ar.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],h=a[3]-(o?r:0);let p=!1;for(let f=0;f<8;++f){const g=3*f;if(l*i[g]+c*i[g+1]+u*i[g+2]+h<0){if(p=!0,!s)break}else s=!1}if(!p)return _a.OUTSIDE}return s?_a.INSIDE:_a.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){Ubt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Vn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)te(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];w1(Hue,l,c,n),w1(que,l,u,n),me(i,Hue,que),ie(i,i,(n+.5*(r+s))/ja(i));const h=this.convexHull;let p=0;const f=(_,v)=>{const b=_[0]-h[3*v],w=_[1]-h[3*v+1],T=_[2]-h[3*v+2];return Math.sqrt(b*b+w*w+T*T)};for(let _=0;_<8;++_){const v=f(i,_);p=Math.max(p,v)}const g=p;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===vh.HAS_NORTH_POLE,l=o&&n===vh.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,h=e[0],p=e[2],f=l?-u:e[1],g=a?u:e[3],_=.5*(h+p),v=r,b=i+(c?Math.min(0,v-1):v),w=(I,D,G)=>w1(I,D,G,b),T=C(),S=C(),A=C(),P=C();w(T,h,f),w(S,h,g),w(A,p,g),w(P,p,f);const R=(I,D)=>{for(let G=0;G<3;++G)this._convexHull[3*D+G]=I[G]};R(T,0),R(S,1),R(A,2),R(P,3);const F=s,k=i+(c?Math.max(0,F+1):F),N=C(),j=C(),z=C();w1(j,_,g,b),w1(z,_,f,b),me(N,j,z),fe(N,N);const X=C(),q=C(),Z=(I,D)=>{yi(q,I,D),fe(q,q);const G=-pe(I,X)/pe(q,X);Ie(G>=0),ie(q,q,G),me(I,I,q)};if(2**this.lij[0]>2*this.lij[1]){const I=z,D=C();Ke(D,jue,I),fe(D,D),Ke(X,I,D),fe(X,X),Ie(bh(pe(X,I)/ja(I),0)),Z(T,S),Z(P,A),R(T,0),R(P,3)}else if(2**this.lij[0]!==2*this.lij[1]){const I=j,D=C();Ke(D,jue,I),fe(D,D),Ke(X,D,I),fe(X,X),Z(S,T),Z(A,P),R(S,1),R(A,2)}const ce=(I,D)=>{const G=k/pe(D,N);for(let H=0;H<3;++H)this._convexHull[3*I+H]=D[H]*G};ce(4,T),ce(5,S),ce(6,A),ce(7,P)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?vh.HAS_BOTH_POLES:vh.HAS_NORTH_POLE:r?vh.HAS_SOUTH_POLE:vh.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],h=(l*i[0]+c*i[1]+u*i[2])/a,p=i[0]*h-l,f=i[1]*h-c,g=i[2]*h-u;return p*p+f*f+g*g<o*o}getDefaultVerticesPerSide(){return this.level<Gue.length?Gue[this.level]+1:2}updateCornerElevations(){jbt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Vbt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){Gbt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Vn||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=C(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,u=0,h=this._center[Js.MIDDLE][3],p=this.convexHull,f=(De,$e)=>{for(let _t=0;_t<3;++_t)De[_t]=p[3*$e+_t]};{const De=C(),$e=C(),_t=C(),bt=C(),$t=C(),st=(Be,Ge,St,jt)=>{f($e,Be),f(_t,Ge),f(bt,St),yi($e,$e,_t),yi(bt,bt,_t),Ke(De,$e,bt),fe(De,De);const Wi=pe(De,_t);f($t,jt);const ai=pe(De,$t),pi=Math.abs(ai-Wi);Ie(bh(pi,0),`Non coplanar ${Be},${Ge},${St},${jt} diff = ${pi}`)};st(0,1,2,3),st(4,5,6,7),st(0,1,4,5),st(1,2,5,6),st(2,3,6,7),st(3,0,7,4)}const g=jn(24),_=(De,$e,_t)=>{const bt=4*De;for(let $t=0;$t<3;++$t)g[bt+$t]=$e[$t];g[bt+3]=_t},v=C(),b=C(),w=C(),T=C(),S=(De,$e,_t,bt)=>{f(v,$e),f(b,_t),f(w,bt),yi(v,v,b),fe(v,v),yi(w,w,b),fe(w,w),Ke(T,v,w),fe(T,T);const $t=pe(T,b);_(De,T,$t)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const A=1,P=(De,$e,_t,bt)=>{const $t=4*De;return g[$t]*$e+g[$t+1]*_t+g[$t+2]*bt-g[$t+3]},R=(De,$e,_t,bt)=>P(De,$e,_t,bt)>=-A,F=(De,$e)=>R(De,$e[0],$e[1],$e[2]),k=2**this.lij[0]>2*this.lij[1],N=(De,$e,_t)=>Math.sqrt(SPe(De,$e,_t,r[0],r[1],r[2]))<i,j=De=>N(De[0],De[1],De[2]),z=(De,$e)=>N(De[$e],De[$e+1],De[$e+2]),X=this.extentInRadians,q=.5*(X[0]+X[2]),Z=X[1],ce=X[3],I=C(),D=C();w1(I,q,ce,l),w1(D,q,Z,l);const G=k?"Upper":"Lower";let H=!0;for(let De=0;De<6;++De){for(let $e=0;$e<8;++$e){const _t=3*$e,bt=R(De,p[_t],p[_t+1],p[_t+2]);H&&(H=bt),Ie(bt,`Tile[${this.lij}] Convex hull point ${$e} outside of plane ${De}`)}Ie(F(De,D),`Tile[${this.lij}] (${G}) bottom mid outside of plane ${De}`),Ie(F(De,I),`Tile[${this.lij}] (${G}) top mid outside of plane ${De}`)}Ie(H,"Not all convex hull points are inside  convex hull polyhedron"),Ie(j(D),`Tile[${this.lij}] (${G}) bottom mid outside of bounding sphere`),Ie(j(I),`Tile[${this.lij}] (${G}) top mid outside of bounding sphere`);for(let De=0;De<8;++De){const $e=z(p,3*De);Ie($e,`Tile[${this.lij}] Convex hull point ${De} outside of bounding sphere`)}for(let De=0;De<6;++De)for(let $e=0;$e<8;++$e){const _t=3*$e;R(De,p[_t],p[_t+1],p[_t+2])||console.error(`Tile[${this.lij}] Convex hull point ${$e} outside of plane ${De}`)}const{extentInRadians:J}=this,Q=Math.max(J[2]-J[0],J[3]-J[1]),ee=Math.round(Q*n),{renderData:de}=this;if(!de)return;const{geometry:we,geometryState:Re,localOrigin:tt}=de,Ye=we.vertexAttributes?.position;if(!Ye)return;const qe=C(),He=we.numVerticesPerSide-2,{indices:je,indexCount:Jt,edgeVerticesStartIndex:Wt,poleVerticesStartIndex:Le}=we;if(!je)return;const Dt=new Set;for(let De=0;De<Jt;++De){const $e=je[De];if(Dt.has($e))continue;Dt.add($e);const _t=$e<Le,bt=$e>=Wt;let $t=!1,st=-1;if(bt){let Ht=Wt;for(let ri=0;ri<4;++ri){const Ii=Re.edgeResolutions[ri];if($e===Ht||$e===Ht+Ii-1){$t=!0;break}if(Ht+=Ii,$e<Ht){st=ri;break}}}const Be=bt?Re.edgePeerNeighbors[st]:null,Ge=bt&&Be&&Wf(this,Be)>0;Ye.getVec($e,s),me(qe,s,tt);const St=ja(qe)-n;let jt=0,Wi=!1;const ai=o-St,pi=St-a,Xi=ai>c,ir=pi>c,Ri=Xi||ir,$i=()=>{const Ht=_t?"internal":bt&&!$t?"edge":$t?"corner":"pole";return`Tile[${this.lij}].vertex[${$e}]:${Ht}`+(Xi?"(below)":ir?"(above)":"")+(Ge?"(Neighbor)":"")},wi=P_(qe,r);if(wi>=i+u){const Ht=wi-i;Ri||(console.error(`${$i()} is out of the bounding sphere by ${Ht.toFixed(0)} / ${i.toFixed(0)}[tol=${u}] h=${St.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Ht/i).toFixed(0)})`),Wi=!0)}for(let Ht=0;Ht<6;++Ht)if(!R(Ht,qe[0],qe[1],qe[2])){const ri=P(Ht,qe[0],qe[1],qe[2]),Ii=$e%He,Bi=($e-Ii)/He;Ht===0&&ai||Ht===5&&pi||(console.error(`${$i()} (${Ii},${Bi})|${He}] is out of the bounding trapezoid plane ${Ht} h=${Math.round(St)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(ri)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${ee}`),++jt)}if(Wi||jt>0)break}}get convexHull(){return this._convexHull}};const Gue=[128,64,64,32,16,8,8,4];function uwt(t,e,i){return SPe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function SPe(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const w1=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},jue=[0,0,1],Hue=C(),que=C();let xd=class extends Pe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],xd.prototype,"fovX",void 0),d([m()],xd.prototype,"fovY",void 0),d([m()],xd.prototype,"relativeWidthLimit",void 0),d([m()],xd.prototype,"relativeHeightLimit",void 0),d([m()],xd.prototype,"maxLod",void 0),d([m()],xd.prototype,"angledSplitBias",void 0),d([m()],xd.prototype,"aboveGround",void 0),d([m()],xd.prototype,"frustum",void 0),xd=d([U("esri.views.3d.terrain.SplitLimits")],xd);const hwt=cs().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0});let dwt=class{constructor(e){this._storage=new B$((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=pwt(r),o=s.pop(n);if(o)return o;const a=hwt.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function pwt(t){return t.toString()}var Fe;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Fe||(Fe={}));const pW={normal:Fe.Normal,average:Fe.Average,lighten:Fe.Lighten,lighter:Fe.Lighter,screen:Fe.Screen,plus:Fe.Plus,"color-dodge":Fe.ColorDodge,darken:Fe.Darken,multiply:Fe.Multiply,"color-burn":Fe.ColorBurn,overlay:Fe.Overlay,"soft-light":Fe.SoftLight,"hard-light":Fe.HardLight,"vivid-light":Fe.VividLight,hue:Fe.Hue,saturation:Fe.Saturation,luminosity:Fe.Luminosity,color:Fe.Color,difference:Fe.Difference,exclusion:Fe.Exclusion,minus:Fe.Minus,invert:Fe.Invert,reflect:Fe.Reflect,"destination-over":Fe.DestinationOver,"destination-atop":Fe.DestinationAtop,"destination-in":Fe.DestinationIn,"destination-out":Fe.DestinationOut,"source-atop":Fe.SourceAtop,"source-in":Fe.SourceIn,"source-out":Fe.SourceOut,xor:Fe.Xor};function fwt(t){return t===Fe.DestinationOver||t===Fe.DestinationAtop||t===Fe.DestinationIn||t===Fe.DestinationOut||t===Fe.SourceAtop||t===Fe.SourceIn||t===Fe.SourceOut||t===Fe.Xor}let CPe=class extends ol{constructor(){super(...arguments),this.blendMode=Fe.Normal}};d([B({count:Fe.COUNT})],CPe.prototype,"blendMode",void 0);var pa;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(pa||(pa={}));var cn;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(cn||(cn={}));var Rd;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(Rd||(Rd={}));let TO=class extends CPe{constructor(){super(...arguments),this.output=cn.Composite,this.baseOpacityMode=pa.NotRequired,this.premultipliedSource=Rd.Off}};d([B({count:cn.COUNT})],TO.prototype,"output",void 0),d([B({count:pa.COUNT})],TO.prototype,"baseOpacityMode",void 0),d([B()],TO.prototype,"premultipliedSource",void 0);let EPe=class extends xr{constructor(){super(...arguments),this.scale=1,this.offset=Bw}};function APe(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new Ue("scale",e=>e.scale),new Ar("offset",e=>e.offset)).code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}function mwt(t,e){const i=e.blendMode;i!==Fe.Normal&&(i===Fe.Reflect&&t.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Fe.ColorDodge&&i!==Fe.VividLight||t.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Fe.ColorBurn&&i!==Fe.VividLight||t.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Fe.Overlay&&t.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Fe.HardLight&&t.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Fe.SoftLight&&t.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Fe.VividLight&&t.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Fe.Hue&&i!==Fe.Saturation&&i!==Fe.Color&&i!==Fe.Luminosity||(t.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Fe.Hue&&i!==Fe.Saturation||t.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Fe.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Fe.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Fe.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Fe.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Fe.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Fe.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Fe.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Fe.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Fe.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Fe.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Fe.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Fe.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Fe.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}function MPe(t,e){const i=e.output===cn.GridComposite,r=e.output===cn.ColorComposite,s=e.output===cn.GroupBackgroundComposite,n=e.output===cn.Composite,o=e.baseOpacityMode===pa.Required,a=t.fragment;o&&a.uniforms.add(new Ue("baseOpacity",h=>h.baseOpacity)),i?a.include(tK):r?a.uniforms.add(new Rt("backgroundColor",h=>h.backgroundColor)):n&&a.uniforms.add(new ct("fboColor",h=>h.fboTexture));const l=e.blendMode!==Fe.Normal,c=e.premultipliedSource===Rd.On,u=!l&&!c&&(n&&!o||s);a.include(mwt,e),a.code.add(x`
    vec4 getBackground(vec2 uv) {
      return ${o?x`baseOpacity *`:""} ${s?x`vec4(0.0, 0.0, 0.0, 0.0)`:r?x`vec4(backgroundColor, 1.0)`:i?x`vec4(gridColor(uv), 1.0)`:x`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?x`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:x`
          float composeAlpha = colorLayer.a * opacity;
          ${u?x`return colorLayer * opacity;`:x`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var Jw;function gwt(t){const e=new Pi,i=e.fragment;if(e.include(APe),t.background===Jw.Only){const r=t.output===cn.ColorComposite;return r?i.uniforms.add(new Rt("backgroundColor",s=>s.backgroundColor)):i.include(tK),i.code.add(x`
      void main() {
        fragColor = vec4(${r?x`backgroundColor`:x`gridColor(uv)`}, 1.0);
      }
    `),e}return e.include(MPe,t),i.uniforms.add(new ct("tex",r=>r.texture),new Ue("opacity",r=>r.opacity)).code.add(x`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Jw||(Jw={}));const ywt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Jw},build:gwt},Symbol.toStringTag,{value:"Module"}));let _wt=class extends EPe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=xs}},PPe=class OPe extends Ni{initializeProgram(e){return new Fi(e.rctx,OPe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};PPe.shader=new Oi(ywt,()=>ue(()=>import("./BlendLayers.glsl-2fdfc396.js"),[],import.meta.url));let RPe=class extends TO{constructor(){super(...arguments),this.background=Jw.BelowLayer}};d([B()],RPe.prototype,"background",void 0);let fW=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=kt(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ce(s,n,o)}destroy(){this.texture.release()}};var gw,Qw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(gw||(gw={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Qw||(Qw={}));var mW,m_,z5,Fd,gW,B5,yW,g_,_W;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(mW||(mW={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(m_||(m_={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(z5||(z5={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Fd||(Fd={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(gW||(gW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(B5||(B5={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(yW||(yW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(g_||(g_={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(_W||(_W={}));let od=class{};od.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:m_.VISIBLE}},od.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:m_.VISIBLE}},od.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:m_.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:I7.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:L7.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},od.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:m_.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:z5.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:B5.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Fd.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:B5.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:gW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Fd.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:yW.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[_W.HORIZONTAL]}},od.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:m_.VISIBLE}},od.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},od.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:g_.MAP}},od.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:g_.MAP},"line-width":{type:"number",minimum:0,default:1}},od.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:g_.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:g_.MAP}},od.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},od.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:g_.MAP}};function vwt(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:h}=r;let p=0;for(const f of t.colliders){const[g,_]=f.partIndex===0?l:u,v=f.partIndex===0?c:h,b=f.minLod<=n&&n<=f.maxLod;p+=b?0:1,f.enabled=b,f.xScreen=f.xTile*s[0]+f.yTile*s[3]+s[6],f.yScreen=f.xTile*s[1]+f.yTile*s[4]+s[7],v===g_.MAP?(f.xScreen+=i*g-e*_,f.yScreen+=e*g+i*_):(f.xScreen+=g,f.yScreen+=_),Fd.VIEWPORT===(f.partIndex===0?o:a)?(f.dxScreen=f.dxPixels,f.dyScreen=f.dyPixels):(f.dxScreen=i*(f.dxPixels+f.width/2)-e*(f.dyPixels+f.height/2)-f.width/2,f.dyScreen=e*(f.dxPixels+f.width/2)+i*(f.dyPixels+f.height/2)-f.height/2)}t.colliders.length>0&&p===t.colliders.length&&(t.unique.show=!1)}let bwt=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new jMe(i,r,y1t),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,BMe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[u,h,p,f]=i.getCellSpan(o,a,l,c);for(let g=h;g<=f;g++)for(let _=u;_<=p;_++){const v=i.cells[g][_];for(const b of v){const w=b.xScreen+b.dxScreen,T=b.yScreen+b.dyScreen,S=w+b.width,A=T+b.height;if(!(l<w||o>S||c<T||a>A))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;vwt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:u,textAllowOverlap:h,textIgnorePlacement:p}=o;for(const f of a.colliders){if(!f.enabled)continue;const g=l.parts[f.partIndex];g.show&&!(f.partIndex?h:c)&&r(f)&&(f.hard?l.show=!1:g.show=!1)}if(l.show)for(const f of a.colliders){if(!f.enabled||(f.partIndex?p:u)||!l.parts[f.partIndex].show)continue;const g=f.xScreen+f.dxScreen,_=f.yScreen+f.dyScreen,v=g+f.width,b=_+f.height,[w,T,S,A]=this._gridIndex.getCellSpan(g,_,v,b);for(let P=T;P<=A;P++)for(let R=w;R<=S;R++)this._gridIndex.cells[P][R].push(f)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==z5.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===Fd.AUTO&&(o=n?Fd.MAP:Fd.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===Fd.AUTO&&(a=n?Fd.MAP:Fd.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),u=s.getPaintValue("text-translate",r),h=s.getPaintValue("text-translate-anchor",r),p={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:h,textTranslate:u};return this._styleProps.set(e,p),p}};function wwt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let xwt=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let u=0;u<c.uniqueSymbols.length;u++){const h=c.uniqueSymbols[u];for(const p of h.tileSymbols)p.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const u=performance.now();for(;s<e.length;s++,r=0){const h=e[s],p=h.styleLayerUID;if(!n(p)){i[s]||(i[s]={styleLayerUID:p,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:p,symbols:[]};const f=i[s];for(;r<h.uniqueSymbols.length;r++){if(c=h.uniqueSymbols[r],r%100==99&&performance.now()-u>l)return!1;let g=null,_=!1,v=!1;for(const b of c.tileSymbols)if(!v||!_){const w=b.tile;(!g||w.isCoverage||w.neededForCoverage&&!_)&&(g=b,(w.neededForCoverage||w.isCoverage)&&(v=!0),w.isCoverage&&(_=!0))}if(g.selectedForRendering=!0,v){f.symbols.push(g),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const h of i)h.symbols.sort(wwt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){const a=n.symbols;for(const[l,c]of a)Twt(c,o);e(n,o);for(const l of n.childrenTiles)s(l,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function Twt(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/nW),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const Swt=32,Cwt=8,Ewt=64,Awt=20;let Mwt=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=Swt){let u=this.tileCoordRange;do u/=2,c/=4;while(c>Cwt&&u>Ewt);const h=new jMe(this.tileCoordRange,this.tileCoordRange,u);o.set(a,{flat:l,index:h}),r.symbols.set(a,{flat:l,index:h});for(const p of l)h.getCell(p.xTile,p.yTile).push(p)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const u of c){const h=u.tileSymbols.find(p=>p.selectedForRendering);h&&d1t(h,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:h,styleLayerUID:l,tileKey:h.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const h of o){const p=Aue(this.tileCoordRange,h.xTile,i.level,i.col,e.key.level,e.key.col),f=Aue(this.tileCoordRange,h.yTile,i.level,i.row,e.key.level,e.key.row);p>=0&&p<this.tileCoordRange&&f>=0&&f<this.tileCoordRange&&a.push({symbol:h,xTransformed:p,yTransformed:f})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+Awt,u=this._tiles.get(e.id).symbols.get(n);if(u){const h=u.flat;for(const p of a){let f,g=!1;const _=p.xTransformed,v=p.yTransformed;f=u.index!=null?u.index.getCell(_,v):h;const b=p.symbol,w=b.hash;for(const T of f)if(w===T.hash&&Math.abs(_-T.xTile)<=c&&Math.abs(v-T.yTile)<=c){const S=T.unique;b.unique=S,S.tileSymbols.push(b),g=!0;break}g||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function Pwt(t,e){const i=t.transforms.tileUnitsToPixels,r=mk(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));rU(Zp),yC(Zp,Zp,[o/2,o/2]),sU(Zp,Zp,r),yC(Zp,Zp,[-256,-256]),u$(Zp,Zp,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Zp;const a=[],l=new Mwt(4096,a,()=>new l1t),c=new xwt(a,l,(u,h,p)=>new bwt(u,h,p,t.styleRepository,t.key.level,e),(u,h)=>{u1t(u,h,!1)},()=>0,u=>{const h=t.styleRepository.getStyleLayerByUID(u).getLayoutProperty("visibility");return!h||h.getValue()!==m_.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const Zp=mw();let Owt=class extends HMe{_createTransforms(){return{displayViewScreenMat3:mw(),tileMat3:mw()}}},Rwt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const $wt=.125;let Iwt=class{constructor(){this._renderParams={reshuffleManager:new Rwt,context:null,drawPhase:1,state:new Lwt,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new Owt(new x0(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,u){const h=this._backgroundTile;this._updateRenderParameters(e,i,h,r,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,h,s)}renderContent(e,i,r,s,n,o,a,l,c,u,h,p){this._declutter(r),s.forAll(g=>this._declutter(g.sourceLayerInfo.data)),this._stencilSymbols(e,i,r,s,n,o,a,Math.round(1/l),c,u,h,p);let f=1;r.stencilRef=f++,e.setStencilFunction(tr.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,u,h,p),s.forAll(g=>{g.sourceLayerInfo.data.stencilRef=f++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,n,o,a,Math.round(1/l),g.offset,u,h,p)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,u,h,p){let f=1;r.stencilRef=f++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(es.KEEP,es.KEEP,es.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(tr.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,u,h,p);for(const g of s.toArray()){const{sourceLod:_,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=f++,e.setStencilFunction(tr.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,_,b.data,n,o,a,l,v,u,h,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,u,h){e.setStencilFunction(tr.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,u,h,mW.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,u,h,p){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,h),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,p)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,u,h){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,h),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const h=i[0]-n.getLevelShift(i[0]),p=this._renderParams;p.context=e,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=h,p.requiredLevel=h;const f=n.getScale(i[0]),[g,_]=n.getOffset(i,o*f),v=$wt*o*f/l,b=r.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+_+(1-a[1])*o*2-2;const w=p.state,T=l/u;w.size[0]=T,w.size[1]=T,w.pixelRatio=u,w.rotation=(360-this._heading)%360;const S=2/T;WX(w.displayViewMat3,S,0,0,0,-S,0,-1,1,1);const A=rU(w.displayMat3),P=mk(this._heading);yC(A,A,[T/2,T/2]),sU(A,A,P),yC(A,A,[-T/2,-T/2]),gC(A,w.displayViewMat3,A)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(Pwt(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},Lwt=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=yr(),this.displayViewMat3=yr(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};function Dwt(t){t.fragment.uniforms.add(new ct("u_colormap",e=>e.u_colormap),new Ue("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ue("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ue("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(x`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function Nwt(t){t.fragment.uniforms.add(new ct("u_transformGrid",e=>e.u_transformGrid),new Ar("u_transformSpacing",e=>e.common.u_transformSpacing),new Ar("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(x`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let Fwt=class extends EPe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function kwt(t,e){t.include(Nwt),t.fragment.uniforms.add(new ct("u_image",r=>r.u_image),new tm("u_flipY",r=>r.common.u_flipY),new tm("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new Ar("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(x`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(x`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let cK=class extends Fwt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=xs,this.fboTexture=null,this.baseOpacity=1}},Uwt=class extends cK{},zwt=class extends cK{};function Bwt(t){const e=new Pi;return e.include(APe),e.include(kwt,t),e.include(Dwt,t),e.include(MPe,t),e.fragment.code.add(x`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===gw.Stretch?Gwt(e,t):t.colorizerType===gw.Lut?Vwt(e):t.colorizerType===gw.Hillshade&&jwt(e,t),e}function Vwt(t){t.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Gwt(t,e){t.fragment.uniforms.add(new wE("u_bandCount",r=>r.symbolizer.u_bandCount),new el("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new el("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new el("u_factor",r=>r.symbolizer.u_factor,3),new Ue("u_minOutput",r=>r.symbolizer.u_minOutput),new Ue("u_maxOutput",r=>r.symbolizer.u_maxOutput),new tm("u_useGamma",r=>r.symbolizer.u_useGamma),new el("u_gamma",r=>r.symbolizer.u_gamma,3),new el("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Ue("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?x`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Qw.Noop?x`
        fragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function jwt(t,e){const i=t.fragment;i.uniforms.add(new ct("u_image",s=>s.u_image),new wE("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new el("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new el("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new el("u_cosZs",s=>s.symbolizer.u_cosZs,6),new el("u_weights",s=>s.symbolizer.u_weights,6),new Ar("u_factor",s=>s.symbolizer.u_factor),new Ue("u_minValue",s=>s.symbolizer.u_minValue),new Ue("u_maxValue",s=>s.symbolizer.u_maxValue),new Ar("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(Rm),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?x`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Hwt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:zwt,ColorizerStretchUniforms:Uwt,ColorizerUniforms:cK,build:Bwt},Symbol.toStringTag,{value:"Module"}));let $Pe=class IPe extends Ni{initializeProgram(e){return new Fi(e.rctx,IPe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};$Pe.shader=new Oi(Hwt,()=>ue(()=>import("./RasterColorizer.glsl-af72315d.js"),[],import.meta.url));let xP=class extends TO{constructor(){super(...arguments),this.colorizerType=gw.Stretch,this.stretchType=Qw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([B({count:gw.COUNT})],xP.prototype,"colorizerType",void 0),d([B({count:Qw.COUNT})],xP.prototype,"stretchType",void 0),d([B()],xP.prototype,"applyColormap",void 0),d([B()],xP.prototype,"requireBilinearWithNN",void 0);let Wue=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new $m(this._rctx,new $r(e),new Zwe(Wo.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const qwt=()=>le.getLogger("esri.views.3d.terrain");let Wwt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new Iwt,this._bindParameters=new zU(null,null),this._blendLayersTechniqueConfig=new RPe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Om(this._rctx,b$)}dispose(){this._fbos.forEach(Tt),this._fbos=null,this._vtFBO=Tt(this._vtFBO),this._vaoQuad=Tt(this._vaoQuad),this._vectorTileHelper=Tt(this._vectorTileHelper),this._backgroundTechnique=Xt(this._backgroundTechnique),this._applyOpacityTechnique=Xt(this._applyOpacityTechnique),this._blendLayersTechnique=Xt(this._blendLayersTechnique)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_getBlendLayersTechnique(e,i,r,s=Rd.Off,n=Jw.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniques.releaseAndAcquire(PPe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Fe.Normal,i?cn.ColorComposite:cn.GridComposite,pa.NotRequired,Rd.Off,Jw.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(ui.TRIANGLE_STRIP,0,Qg(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=Rd.On){i===cn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?pa.Required:pa.NotRequired,a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=Rd.Off){if(e.texture==null)return;const o=e.baseOpacity<1?pa.Required:pa.NotRequired;e.fboTexture=i===cn.GroupBackgroundComposite||s===Fe.Normal&&o===pa.NotRequired&&n===Rd.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,Nt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?pa.Required:pa.NotRequired;e.fboTexture=s===Fe.Normal&&a===pa.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new xP,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Qw.Noop:Qw.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire($Pe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,u=n.sourceLayerInfo.data,h=n.tile.surface.layerViewByIndex(n.layerIndex,Nt.MAP),p=e.baseOpacity<1?pa.Required:pa.NotRequired,f=p===pa.Required||e.opacity<1||s!==Fe.Normal||i!==cn.Composite,g=f?Rd.On:Rd.Off,_=this._getBlendLayersTechnique(s,i,p,g);c.setPipelineState(_.getPipeline());let v=null,b=null;f?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Wue(this._rctx)),v=this._vtFBO.get(r),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clear(Sr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/n.scale),n.offset,a,o,h.contentZoom),u&&this._vectorTileHelper.renderContent(c,n.sourceLod,u,n.vtlNeighborInfos,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/n.scale),n.offset,a,o,h.contentZoom)}catch(w){qwt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=Bw,e.scale=1,this.drawImageData(e,i,r,s,g),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,ur.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(vs.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,ur.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT|Sr.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new Wue(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Ywt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Gt({allocator:e=>e||new Xwt})}},Xwt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Yue=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},Zwt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},Jwt=class{constructor(e,i,r,s){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._passParameters=new _wt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new Wwt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=Tt(this._compositor),this._backgroundTexture=Xt(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=r.view.state.contentPixelRatio;let h=!1;V5.clear(),CT.length=0;const p=e.layerInfo[Nt.MAP];let f=0,g=null;for(;f<p.length;f++){const b=r.layerViewByIndex(f,Nt.MAP),w=b.layer.opacity,T=b.fullOpacity;if(c=c||$D(b.layer),MR(b)){let P=b.layer.blendMode!=="normal";if(rC(b.layer.parent)){const R=vW(b.layer.parent);R!=null&&R!==""&&(P=LPe(b.layer.parent)||P)}P&&(h=P,l=!1)}if(w===0&&!h){p[f].pendingUpdates&=~(ht.TEXTURE_NOFADING&ht.TEXTURE_FADING);continue}++o;const S=BC(b),A=c6(e,f,S);if(A){if(p[f].pendingUpdates&=~(ht.TEXTURE_NOFADING&ht.TEXTURE_FADING),rC(b.layer.parent)){const P=vW(b.layer.parent);P!=null&&P!==""&&DPe(b.layer.parent,f)}S?a=Math.max(a,this.tileSize*u):s===1&&T===1&&(b.isOpaque||this._dataToTexture(A)&&A.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=f)}}const _=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!h&&this._useLayerTexture(e,g)||this._composeLayers(e,i,f-1,c,a,_,!l||h,V5,h):Kwt(e,o,v,i!==Qs.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=Bw,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,Nt.MAP),s=$D(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=c6(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new fW(l.sourceLayerInfo.data,Qs.FADING,l,n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const u=e.surface.baseOpacity;let h=!1,p=Zt.LINEAR_MIPMAP_LINEAR,f=!1,g=0;for(let w=r;w>=0;w--){const T=e.surface.layerViewByIndex(w,Nt.MAP),S=BC(T),A=c6(e,w,S),P=T.layer.opacity;if(!A||P===0&&!c)continue;const R=!$D(T.layer)&&!h;R&&(h=!0);let F=!1;l.forEach(z=>{z.start===w&&(z.output=s?cn.Composite:a&&R?this.backgroundIsGrid?cn.GridComposite:cn.ColorComposite:cn.Composite,z.baseOpacity=R?u:1,CT.push(z),this._compositor.openGroup(n),F=!0)});const k=g===0,N=F?cn.GroupBackgroundComposite:a&&k?this.backgroundIsGrid?cn.GridComposite:cn.ColorComposite:cn.Composite,j=pW[MR(T)?T.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=R&&!F&&u<1?u:1,this._passParameters.opacity=P,U1t(A)?f=this._compositor.drawVectorData(this._passParameters,N,n,j,A,o,this.tileSize,f):k1t(A)?(this._compositor.drawRasterData(this._passParameters,N,n,j,A),Qwt(A)&&(p=Zt.NEAREST)):this._dataToTexture(A)&&(this._passParameters.texture=A.sourceLayerInfo.data.texture,this._passParameters.offset=A.offset,this._passParameters.scale=A.scale,this._compositor.drawImageData(this._passParameters,N,n,j));CT.length>0&&CT[CT.length-1].end===w;){const z=CT.pop();this._passParameters.baseOpacity=z.baseOpacity,this._passParameters.opacity=z.opacity,this._passParameters.offset=Bw,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,z.output,n,pW[z.blendMode])}g++}const _=e.renderData,v=c||h&&u<1,b=_.ensureTexture(n,v,()=>this._buildTexture(n,v,p));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),_.setTextureReference(new fW(b,i,NPe,h?1:u,0,1))}_dataToTexture(e){if(B1t(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return z1t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=Zt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new $r;s.wrapMode=hi.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Pt.RGB);const n=this._rctx;let o;if(typeof e=="number")s.width=s.height=e,o=this._buildTileTexture(s,e);else if(Cz(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=Pt.RGB),o=this._buildTileTexture(s,e.element.width,e.element);else try{s.width=e.width,s.height=e.height,o=this._buildTileTexture(s,e.width,e)}catch{o=new Yue($we(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,ur.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,ur.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,i,r){const s=`${i} ${e.pixelFormat}`,n=this._cache.pop(s);return n?(n.retain(),n.texture.setData(r),n):new Yue(new ur(this._rctx,e,r),this._cache)}get test(){}};function c6(t,e,i){aa.layerIndex=e,aa.vtlNeighborInfos.clear();const r=t.layerInfo[Nt.MAP][e];if(bi(aa.offset,0,0),aa.tile=t,aa.scale=1,aa.sourceLod=t.lij,aa.sourceLayerInfo=r,aa.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[Nt.MAP][e];if(!JMe(a)||r.data===a.data)return;const l=aa.vtlNeighborInfos.pushNew();l.offset=wg[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),aa;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[Nt.MAP][e];return aa.tile=s.tile,ta(aa.offset,s.offset),aa.scale=s.scale,aa.sourceLod=s.tile.lij,aa.sourceLayerInfo=n,aa}return i?aa:null}function vW(t){return t.uid}function Qwt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function LPe(t){let e=t.blendMode!=="normal";return rC(t.parent)&&(e=LPe(t.parent)||e),e}function DPe(t,e){rC(t.parent)&&DPe(t.parent,e);const i=vW(t);if(i!=null&&i!==""){const r=V5.get(i);r?r.start=e:V5.set(i,new Zwt(e,e,t.blendMode,t.opacity,cn.Composite,1))}}function Kwt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?V_.Delayed:V_.Immediate;s.setTextureReference(new fW(i,Qs.FADING,NPe,t.surface.baseOpacity,0,1),n)}const V5=new Map,CT=new Array,aa=new Ywt,NPe={offset:[0,0],scale:1},wg=new Array;wg[gt.NORTH]=[0,-1],wg[gt.NORTH_EAST]=[-1,-1],wg[gt.EAST]=[-1,0],wg[gt.SOUTH_EAST]=[-1,1],wg[gt.SOUTH]=[0,1],wg[gt.SOUTH_WEST]=[1,1],wg[gt.WEST]=[1,0],wg[gt.NORTH_WEST]=[1,-1];const ext=200,u6=40,txt=.8,ixt=10,TP=1e-6;function rxt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=TP)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-TP){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-TP)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=TP){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let Xue=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},FPe=class bW{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=C(),this._callback=Jue,this._intersectionOptions=Zue,this.bspNodeTree=new Array;const n=r-i,o=new(n<lxt?Uint8Array:n<cxt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=axt(e,i,r,s.data,s.stride),l=Te(Math.log2(n/u6),2,ixt),c=(u,h,p)=>{const f=nxt(o,a,u,h),g=h-u;if(g<=u6){const S=new Xue(f,void 0,0,u,h);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=oxt(f),b=sxt(o,a,u,h,_,v),w=(S,A)=>{if(p>l)return;const P=A-S;return P<u6||P>=txt*g?void 0:c(S,A,p+1)},T=new Xue(f,_,v,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=w(u,b.next),T.rightNode=w(b.mid,h),T};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;WSe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),bW.numFacesTested+=i-e}intersectRay(e,i,r,s){bW.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<TP)return;this._rayFrom=n;const u=this._rayDirection;u[0]=a,u[1]=l,u[2]=c;const h=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,h),this._callback=Jue,this._intersectionOptions=Zue}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!rxt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};FPe.numFacesTested=0;const ET=[1/0,1/0,1/0],AT=[-1/0,-1/0,-1/0];function sxt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function nxt(t,e,i,r){if(r<=i)return Iw(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)ET[n]=e[s+0+n],AT[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)ET[o]=Math.min(ET[o],e[n+0+o]),AT[o]=Math.max(AT[o],e[n+3+o])}return Iw(ET[0],ET[1],ET[2],AT[0],AT[1],AT[2])}function oxt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function axt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,h=t[l+2]*s;for(let p=0;p<3;++p){const f=r[c+p],g=r[u+p],_=r[h+p];o[6*a+p]=Math.min(f,g,_),o[6*a+3+p]=Math.max(f,g,_)}}return o}const lxt=255,cxt=65535,Zue=new O$,Jue=()=>{};let Es=class extends Fl{constructor(){super(...arguments),this.output=V.Color,this.overlayMode=jf.Disabled,this.tileBlendInput=Yf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=mt.Simplified}};d([B({count:V.COUNT})],Es.prototype,"output",void 0),d([B({count:jf.COUNT})],Es.prototype,"overlayMode",void 0),d([B({count:Yf.COUNT})],Es.prototype,"tileBlendInput",void 0),d([B()],Es.prototype,"spherical",void 0),d([B()],Es.prototype,"doublePrecisionRequiresObfuscation",void 0),d([B()],Es.prototype,"receiveShadows",void 0),d([B()],Es.prototype,"hasSlicePlane",void 0),d([B()],Es.prototype,"backfaceCullingEnabled",void 0),d([B()],Es.prototype,"textureFadingEnabled",void 0),d([B()],Es.prototype,"renderOccluded",void 0),d([B()],Es.prototype,"hasScreenSpaceReflections",void 0),d([B()],Es.prototype,"hasCloudsReflections",void 0),d([B()],Es.prototype,"invisible",void 0),d([B()],Es.prototype,"opaque",void 0),d([B()],Es.prototype,"tileBorders",void 0),d([B()],Es.prototype,"visualizeNormals",void 0),d([B()],Es.prototype,"screenSizePerspective",void 0),d([B()],Es.prototype,"receiveAmbientOcclusion",void 0),d([B({count:mt.COUNT})],Es.prototype,"pbrMode",void 0),d([B({constValue:zi.Compressed})],Es.prototype,"normalType",void 0),d([B({constValue:Qr.Compressed})],Es.prototype,"textureCoordinateType",void 0),d([B({constValue:!1})],Es.prototype,"highStepCount",void 0),d([B({constValue:!1})],Es.prototype,"useCustomDTRExponentForWater",void 0),d([B({constValue:!1})],Es.prototype,"useFillLights",void 0),d([B({constValue:!0})],Es.prototype,"hasColorTexture",void 0);const h6=7,uxt=10,d6=pn();var va;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(va||(va={}));let sh=class extends Dxe{get _isGlobal(){return this._stage.viewingMode===Ne.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(t,e,i,r,s){super({}),this._overlayRenderer=t,this._stage=e,this._allTiles=i,this._ellipsoidRadius=r,this.type=Fr.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Es,this._passParameters=new sPe,this._drawParameters=new P7,this._renderDataPool=new Ko($bt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new iPe,this._transparencyState=va.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=ki.Occlude,this.produces=new Map([[ye.OPAQUE_TERRAIN,()=>this._produces()],[ye.TRANSPARENT_TERRAIN,()=>this._produces()],[ye.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new B$((n,o)=>s.newCache(n,o),"TileTexture"),this.tileGeometryCache=new dwt(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(he(()=>this._overlayRenderer.rendersOccludedDraped,t=>{this.renderOccludedFlags=t?T5:ki.Occlude,this.setNeedsRender()},Ji))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?tJ:VU}set renderingDisabled(t){this._set("renderingDisabled",!!t),this.setDirty()}set visible(t){this._set("visible",!!t),this.setDirty()}updateHeading(t){this._tileRenderer?.updateHeading(t)}set transparency(t){this._transparencyState!==t&&(this._techniqueConfiguration.invisible=t===va.TransparentWithDraped||t===va.Empty,this._techniqueConfiguration.opaque=t===va.Opaque,this._transparencyState=t,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(t){this._techniqueConfiguration.tileBorders!==t&&(this._techniqueConfiguration.tileBorders=t,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(t){this._techniqueConfiguration.visualizeNormals!==t&&(this._techniqueConfiguration.visualizeNormals=t,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(t){this._techniqueConfiguration.backfaceCullingEnabled!==t&&(this._techniqueConfiguration.backfaceCullingEnabled=t,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(t){this._set("renderOrder",t),this._setSortingDirty()}get layerUid(){return nv}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(t){this._techniqueConfiguration.hasSlicePlane!==t&&(this._techniqueConfiguration.hasSlicePlane=t,this.setNeedsRender())}set textureFadingEnabled(t){this._techniqueConfiguration.textureFadingEnabled!==t&&(this._techniqueConfiguration.textureFadingEnabled=t,this.setNeedsRender())}set pbrMode(t){this._techniqueConfiguration.pbrMode!==t&&(this._techniqueConfiguration.pbrMode=t,this.setNeedsRender())}setDebugScreenSizePerspective(t){this._techniqueConfiguration.screenSizePerspective!==t&&(this._techniqueConfiguration.screenSizePerspective=t,this.setNeedsRender())}setRootTiles(t){this._rootTiles=t,this.setDirty()}setStencilEnabledLayerExtents(t){this._stencilEnabledLayerExtents=t,this._setSortingDirty()}setTileSize(t){this._tileSize=t,this._tileRenderer!=null&&(this._tileRenderer.tileSize=t),this.setDirty()}_prepareTileForLoading(t){t.renderData||(t.renderData=this._renderDataPool.acquire(),t.renderData.init(t,this._getLocalOriginOfTile(t)))}loadTile(t){this._prepareTileForLoading(t),this.updateTileGeometryState(t),this.updateTileTexture(t,ht.TEXTURE_FADING)}updateTileTexture(t,e){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(t,e===ht.TEXTURE_FADING?Qs.FADING:Qs.UNFADED),this.setNeedsRender(),t.resetPendingUpdate(e))}updateTileGeometryState(t){for(const i of t.layerInfo[Nt.ELEVATION])i.pendingUpdates&=~ht.GEOMETRY;t.resetPendingUpdate(ht.GEOMETRY);const e=t.renderData.updateGeometryState();return e&&this.setDirty(),e}updateGeometryIfNeeded(t){t.isLoaded&&t.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(t){const e=t.renderData;e&&(e.releaseGeometry(),this._renderDataPool.release(e),e.clear(),t.renderData=null,t.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(t){const e=uxt-h6,i=Math.max(0,Math.floor((t.level-e)/h6)*h6);if(this._isGlobal&&i===0)return xs;for(;t.parent&&t.level>i;)t=t.parent;return t.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(t){this._get("wireframe")!==t&&(this._set("wireframe",t),this.setNeedsRender())}setDirty(t=Vi.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(t)}_setSortingDirty(t=Vi.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(t)}setNeedsRender(t=Vi.UPDATE){this._context.requestRender(t)}initializeRenderContext(t){this._context=t,this._tileRenderer=new Jwt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=$we(this._rctx)}uninitializeRenderContext(){this._emptyTex=Tt(this._emptyTex),this._tileRenderer=Tt(this._tileRenderer)}intersect(t,e,i,r){if(!this._rootTiles||t.options.selectOpaqueTerrainOnly&&t.options.selectionMode&&this.transparency!==va.Opaque)return;const s=hxt,n=dxt;_e(s,r,i),te(n,1/s[0],1/s[1],1/s[2]);const o=t.results.min,a=t.results.max,l=t.results.ground,c=t.options.store===Lo.MIN,u=!!t.results.ground.target,h=W9e(t.verticalOffset),p=t.tolerance;let f,g=c&&o.dist!=null?o.dist:1/0;const _=t.options,v=_.normalRequired||!_.backfacesTerrain,b=new O$(!1,v),w=S=>{const A=S.renderData;if(!A?.vao)return;const P=A.geometry;Ik(d6,P.boundingBox);const R=A.localOrigin;h!=null&&(h.localOrigin=R,h.applyToAabb(d6));const F=d6;if(MT[0]=i[0]-R[0],MT[1]=i[1]-R[1],MT[2]=i[2]-R[2],!HJ(F,MT,n,p,g))return;const k=(D,G,H)=>{D.set(this.type,S,G,H,Cr),g=c&&o.dist!=null?o.dist:1/0},N=(D,G,H)=>{if((!v||H!=null)&&D>=0&&(_.backfacesTerrain||pe(H,s)<0)&&(_.invisibleTerrain||!_.selectionMode||e==null||e(i,r,D))){if((l.dist==null||D<l.dist)&&k(l,D,H),_.isFiltered)return;_.store===Lo.ALL&&(f==null?(f=MZ(t.ray),k(f,D,H),t.results.all.push(f)):D<f.dist&&k(f,D,H)),(o.dist==null||D<o.dist)&&k(o,D,H),_.store!==Lo.MIN&&(a.dist==null||D>a.dist)&&k(a,D,H)}},j=pxt;_e(j,r,R);const{indices:z,indexCount:X}=P,q=P.vertexAttributes,Z=q.getField(O.POSITION,Xn),ce=new y$(Z.typedBuffer,3,q.stride/4),I=X/3;if(!h&&I>ext){const D=S.renderData;D.intersectionData==null&&(D.intersectionData=new FPe(z,0,I,ce)),D.intersectionData.intersectRay(MT,j,b,N)}else qSe(MT,j,0,I,z,ce,h,b,N)},T=this._rootTiles;T!=null&&(()=>{const S=this._tileIterator;S.reset(T);const A=t.options.invisibleTerrain;for(let P=S.next();P;P=S.next())!(P.visible||A&&P.intersectsClippingArea)||h==null&&!P.intersectsRay(i,s,p,g)||u&&this._useStencilForTile(P)?S.skipSubtree():w(P)})()}processScaleRangeQueries(t,e){if(!e.done)for(this._updatePatchGroups();t.updating&&!e.done;){t.prepare();for(const i of this._visiblePatchesByOrigin.values())for(const r of i)r.renderData?.textureReference!=null&&t.queriesForTile(r);t.process(),e.madeProgress()}}prepareTechnique(t){const e=se("enable-feature:terrain-shadows")&&t.bindParameters.shadowMap.enabled;e!==this._castShadows&&(this._castShadows=e,this._patchesByOriginDirty=!0);const i=t.bindParameters.viewshedEnabled;if(this._inViewshed!==i&&(this._inViewshed=i,this._patchesByOriginDirty=!0),t.bindParameters.slot===ye.OCCLUDED_TERRAIN){if(!(t.renderOccludedMask&T5))return null}else{const r=this.transparency===va.Opaque?ye.OPAQUE_TERRAIN:ye.TRANSPARENT_TERRAIN;if(t.bindParameters.slot!==r)return null}if(this.transparency===va.Empty)return null;switch(t.output){case V.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=t.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=t.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=t.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=t.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(V.Color,t.bindParameters.slot===ye.OCCLUDED_TERRAIN);case V.Shadow:case V.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Shadow,!1)):null;case V.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.ViewshedShadow,!1)):null;case V.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Depth,!1);case V.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Normal,!1);case V.ObjectAndLayerIdColor:return this._updateTechnique(V.ObjectAndLayerIdColor,!1);case V.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Highlight,!1)):null}return null}renderNode(t,e){switch(this._updatePatchGroups(),e.useStencil=!1,t.output){case V.Color:{const i=t.bindParameters.slot===ye.OCCLUDED_TERRAIN?Nr.Occluded:Nr.Color;this._renderMaterialPass(t,e,i);break}case V.Depth:case V.Normal:this._renderAuxiliaryPass(t,e,Nr.Color,this._visiblePatchesByOrigin);break;case V.Highlight:this._renderAuxiliaryPass(t,e,Nr.Highlight,this._visiblePatchesByOrigin);break;case V.Shadow:case V.ShadowExcludeHighlight:case V.ViewshedShadow:this._renderAuxiliaryPass(t,e,null,this._allPatchesByOrigin);break;case V.ObjectAndLayerIdColor:this._renderAuxiliaryPass(t,e,Nr.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(t){if(this._tileRenderer==null)return;const e=this._tileRenderer;let i;if(t!=null){const r=et.toUnitRGBA(t);i=Ce(r[0]||0,r[1]||0,r[2]||0)}e.setBackground(i),this._allTiles.forAll(r=>e.updateTileTexture(r,Qs.FADING)),this._techniqueConfiguration.tileBlendInput=e.backgroundIsGrid?Yf.GridComposite:e.backgroundColor!=null?Yf.ColorComposite:Yf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==VC.NONE){const t=Array.from(this._visiblePatchesByOrigin.values()),e=this._stencilEnabledLayerExtents;for(const i of t)nbt(this.renderOrder,i,e);t.sort((i,r)=>rPe(i[0],r[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(t.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const t=this._rootTiles;if(t!=null){t[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const e of t)this._rebuildPatchGroupsForRootTile(e)}}_rebuildPatchGroupsForRootTile(t){const e=this._tileIterator;for(e.resetOne(t);!e.done;){const i=e.next(),r=i.renderData;if(!r){this._numTilesCulled++;continue}const s=r.localOrigin;if(this._castShadows||this._inViewshed){let o=this._allPatchesByOrigin.get(s);o||(o=[],this._allPatchesByOrigin.set(s,o)),o.push(i)}if(!i.visible){this._numTilesCulled++,e.skipSubtree();continue}let n=this._visiblePatchesByOrigin.get(s);n||(n=[],this._visiblePatchesByOrigin.set(s,n)),n.push(i),e.skipSubtree()}}_useStencilForTile(t){for(const e of this._stencilEnabledLayerExtents)if(t.intersectsExtent(e))return!0;return!1}_renderAuxiliaryPass(t,e,i,r){const s=t.rctx;this._passParameters.overlayContent=i,s.bindTechnique(e,t.bindParameters,this._passParameters);const n=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,e.program.bindDraw(this._drawParameters,t.bindParameters,this._passParameters);for(let a=0;a<o.length;a++)this._renderPatch(t,e,o[a],ui.TRIANGLES,n,i)}),t.rctx.bindVAO(null)}_renderMaterialPass(t,e,i){const{rctx:r}=t;this._passParameters.overlayContent=i,r.bindTechnique(e,t.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=t.bindParameters.camera,n=e.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=DTe(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Nr.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",xs),n.setUniform4fv("texOffsetAndScale",Cu));const l=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:xs;this._techniqueConfiguration.tileBlendInput===Yf.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?ui.LINES:ui.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const u=this._visiblePatchesByOrigin;for(const h of u.values()){const p=h[0].renderData.localOrigin;e.program.bindDraw(new P7(p),t.bindParameters,this._passParameters),this._numOriginsRendered++;for(const f of h){const g=f.renderData,_=g.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=g.textureFadeFactor,b=v<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(t,e,f,c,o,i),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}t.rctx.bindVAO(null)}_renderPatch(t,e,i,r,s,n){const o=i.renderData,a=o.vao,l=a?.indexBuffer;if(!a||l==null)return void(Vn&&console.error("Rendered tile with no indices: ",i.lij," : ",o));const c=e.program;n==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),s&&(e.useStencil=this._useStencilForTile(i),t.rctx.setPipelineState(e.getPipeline()));const u=o.geometry.indexCount;t.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),t.rctx.drawElements(r,u,l.indexType,0)}_bindOverlayPatchData(t,e){t.setUniform4fv("overlayTexOffset",e.offsets),t.setUniform4fv("overlayTexScale",e.scales)}_updateTechnique(t,e){return this._techniqueConfiguration.output=t,this._techniqueConfiguration.renderOccluded=e,this._shaderTechnique=this._techniques.releaseAndAcquire(nPe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};d([m({readOnly:!0})],sh.prototype,"_isGlobal",null),d([m()],sh.prototype,"renderOccludedFlags",void 0),d([m({value:!1})],sh.prototype,"renderingDisabled",null),d([m({value:!0})],sh.prototype,"visible",null),d([m()],sh.prototype,"renderPatchBorders",null),d([m()],sh.prototype,"visualizeNormals",null),d([m()],sh.prototype,"cullBackFaces",null),d([m({value:VC.FRONT_TO_BACK})],sh.prototype,"renderOrder",null),d([m()],sh.prototype,"wireframe",null),sh=d([U("esri.views.3d.terrain.TerrainRenderer")],sh);const hxt=C(),dxt=C(),MT=C(),pxt=C();let fxt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},bf=class extends Pe{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),he(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!VP(i)||i.isRejected())&&!(i.isFulfilled()&&!mxt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||F5(i)))),e)if(e.isResolved()){const i=Az(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new gc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Ne.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=gc.makeWebMercatorAuxiliarySphere(i):WQ(r)&&(e=gc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(he(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ne.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=gc.WebMercatorAuxiliarySphere:YMe(e)&&(this.tilingScheme=gc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Jb(e,this.extent)||(this.tilingScheme=gc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function mxt(t,e,i){return Az(t,e,i)!=null}d([m()],bf.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],bf.prototype,"extent",void 0),d([m({value:!1})],bf.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],bf.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],bf.prototype,"layers",void 0),d([m({constructOnly:!0})],bf.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],bf.prototype,"viewingMode",void 0),bf=d([U("esri.views.3d.terrain.TilingSchemeLogic")],bf);let gxt=class{constructor(){this.offset=it(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var jN;let Bt=jN=class extends Ls.EventedMixin(Pe){constructor(t){super(t),this._scaleRangeQueries=new GN,this._iteratorPool=new Ko(iPe,e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new sbt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new fxt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new xd,this._frustum=uR(),this._viewProjectionMatrix=xe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Xg,this._frameTask=hC,this._allTiles=new Gt,this._upsampleInfoPool=new Ko(gxt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Vt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=We.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new s2(1/0,-1/0),this.rootTileElevationBounds=new s2(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=PX(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Tl({...t,surface:this}),this._isGlobal=!t.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?cwt:owt}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new B$((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new Jvt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new sh(r.renderer,t._stage,this._allTiles,er(t.spatialReference).radius,i),this.addHandles([he(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),he(()=>this.renderer.visible,l=>this.suspended=!l),he(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(Qs.FADING)}),he(()=>({heading:t.camera?.heading,state:t.state?.mode}),({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const u=Math.round(l)%360,h=Math.abs(u-this.heading);(c===gi.IDLE||Math.min(h,360-h)>=30)&&(this.heading=u)})],"overlayManager"),this.addHandles([he(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Qs.UNFADED:Qs.IMMEDIATE)},qi),he(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Qs.UNFADED:Qs.IMMEDIATE),qi),he(()=>this.backgroundColor,(l,c)=>{l?.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Ji),he(()=>this.snapLevel,()=>this._viewChanged=!0,Ji),he(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),he(()=>wr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?ue(()=>import("./TerrainTileTree3DDebugger-8fd4864c.js"),["./TerrainTileTree3DDebugger-8fd4864c.js","./TileTreeDebugger-3a2898fc.js"],import.meta.url).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&wr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Oe(this._treeDebugger))},Ki)]);const{spatialReference:s}=t;this._extentHelper=Y1t(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new qO({getCollections:()=>t.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new bf({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(kf.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(kf.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(wt.TERRAIN_SURFACE,this),this.addHandles([he(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Ki),he(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Ji),he(()=>this.extent,()=>this._updateRootTiles(),Ki),t.on("resize",()=>this._viewChangeUpdate()),he(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),qi),he(()=>t.qualitySettings?.fadeDuration,l=>this._renderer.textureFadingEnabled=l>0,Ki),he(()=>t.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?mt.Simplified:mt.Disabled,Ki),he(()=>t.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),he(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ji)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Oe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Oe(this.overlayManager)),this._tileCache=Oe(this._tileCache),QQ.prune(),this._treeDebugger=Oe(this._treeDebugger),this._renderer=Oe(this._renderer),this._iteratorPool=Oe(this._iteratorPool),this._upsampleMapCache=Oe(this._upsampleMapCache),this._elevationQueryCache=Oe(this._elevationQueryCache),this._set("view",null),this._extentHelper=Oe(this._extentHelper),this._upsampleInfoPool=Oe(this._upsampleInfoPool),v1t(),_bt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===hO.ON){const t=this.view,e=this.tilingScheme,i=t.terrainScale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return Math.min(r,s||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?hO.ON:hO.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Vt(),r=gMe(e,i,t)?i:null,s=this._get("extent");return Jb(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=$j(this.groundExtent,this._userClippingExtent,Vt()),e=this._get("extent");return Jb(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===va.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!s?.length||s[0].layerInfo[Nt.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=Q_(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return le.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=te(IA,t,e,i);return n(o,0,o,0),Que(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[Nt.ELEVATION].length:0;if(r?.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,Que(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!ts(t,IA,this.spatialReference))return le.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i?.containsPoint(IA)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;IA[0]>s[2]&&(n+=1),IA[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const i=Q_(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureSEBProject(e);if(i==null)return le.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;Vw(t,PT);const r=PT;i(r,0,r,0);const s=new D5,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!Mee(l.extent,PT))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return s}getRootElevationBounds(){return new D5(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!ts(t,PT,this.spatialReference))return le.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;PT[3]=e;let i=null;const r=n=>{if(n&&Mee(n.extent,PT)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?va.Empty:va.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?va.Opaque:va.Semitransparent,s=i!==r;return s&&(this._renderer.transparency=r,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;_n(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const e=t?.spatialReference??We.WebMercator;this._spatialReference=e,this._isWebMercator=!!e?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&Cw(this.view?.renderSpatialReference),this._isGeographic=e?.isGeographic??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(jN._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=_xt;let r=e.rootTilesInExtent(t,i,5*zS);if(this._rootTiles!=null){if(r.length>zS)return void le.getLogger(this).warn(B7e);const s=this._rootTiles.map(o=>o.lij),n=H6(s,r,BN);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>BN(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>zS&&(le.getLogger(this).warn(V7e),r=e.rootTilesInExtent(t,i,zS)),this._setRootTiles(r.map(s=>this._newRootTile(s)));Jb(i,this._rootTilesExtent)||(this._rootTilesExtent=Vt(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.sort(Wf),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Wf);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ht.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(ht.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(ht.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=dbt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(ht.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new s2(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i?.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new s2(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=F4(this._splitLimits.frustum??uR(),e.frustum):this._splitLimits.frustum=null,F4(this._frustum,t.frustum),Ai(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ae(this._eyePosRenderSR,e.eye),_o(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Nt.MAP].some(BC)&&e.setPendingUpdate(ht.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(ht.TEXTURE_FADING)?ht.TEXTURE_FADING:!!t.resetPendingUpdate(ht.TEXTURE_NOFADING)&&ht.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=p6.extent;Mu(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>R_(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),p6.spatialReference=this.spatialReference,this.emit("elevation-change",p6),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Vn&&this._checkTileInvariant(),!t.hasProgressed)return $o}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{if(_n(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const i=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,r=e.children.reduce((s,n)=>s+(i(n)?0:1),0);if(_n(e.unmergableChildCount===r,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${r}`),e.hasPendingUpdate(ht.MERGE)){_n(!e.hasPendingUpdate(ht.SPLIT),"Tile can be both split and merge at the same time");for(const s of e.children)_n(s.isLeaf||s.hasPendingUpdate(ht.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(e.rendered){const o=e.renderData?.geometryState.edgePeerNeighbors[i];if(o!=null){{const a=e.level-o.level<=xn;a||(console.log(`tile level delta [${e.lij.toString()}] vs [${o.lij.toString()}] > ${xn}  (edge[${i}])`),_n(a,`tile level delta [${e.level}] vs [${o.level}] > ${xn}`))}_n(e.level-o.level<=xn,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${o.lij.toString()}]`)}}const r=e.level-xn,s=o=>o.isLeaf||o.level===e.level,n=e.findNeighborTile(Kd[i],s);if(n!=null){if(e.isLeaf&&e.level>=xn){let o=n;for(;e.level-o.level<xn;)o=o.parent;const a=[r,e.lij[1]>>xn,e.lij[2]>>xn];if(!BN(a,o.lij)){const l=t.get(o);_n(!l.has(e),"Cannot already have neighbor"),l.add(e)}}_n(n.rendered||n.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),_n(e.level-n.level<=xn,`Tile level delta [${e.level}] vs [${n.level}] > ${xn}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);_n(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new vxt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(ht.MERGE),c=l?ht.MERGE:o.shouldSplit(r,s,i),u=c===ht.SPLIT;o.isLeaf?f6(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(ht.SPLIT),o.isLeaf||o.setPendingUpdate(ht.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(ht.MERGE),o.isLeaf&&o.setPendingUpdate(ht.SPLIT)):(o.resetPendingUpdate(ht.SPLIT)&&o.updateAgentSuspension(),c===ht.ELEVATION&&o.updateAgents(Nt.ELEVATION),o.isLeaf||(o.setPendingUpdate(ht.MERGE),o.resetPendingUpdate(ht.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(ubt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Ie(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!n?.isLoaded||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(Wf);const r=e.length;for(let s=0;s<r;++s){const n=e[s];Ie(n.isLoaded),Ie(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{const h=U5[u];i(n,l.cornerPeerNeighbors[u]?.findCorner(k5(h),p=>p.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const h=o.geometryState.edgePeerNeighbors[u];h&&h?.level>=n.level&&h.forAllSubtreeOnSide(ZQ(Kd[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(Ie(t.has(p)||Wf(n,p)<0),i(n,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Vn&&N5&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(ht.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(ht.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(ht.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(ht.SPLIT)){let c=!0;const u=a.level;if(u>=xn){const h=p=>p.isLeaf||u-p.level<xn;for(let p=0;p<4;++p){const f=a.findNeighborTile(Kd[p],h);f!=null&&u-f.level===xn&&(c=!1,Vn&&(Ie(f.isLeaf),Ie(f.hasPendingUpdate(ht.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(ht.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(ht.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Vi.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*U7e}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=Te(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let i=0;i<4;++i)this._purgeTile(e[i])}_purgeTile(t){t.isLeaf?Kue(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(jN._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){_n(t.isLeaf,"Tile that is already split should not be split again!"),_n(t.rendered,"Tile marked to split is not rendered"),Kue(t);const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2],s=t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t));this._allTiles.pushArray(s),t.updateAgentSuspension(),_n(t.rendered,"parent should be rendered"),this._unloadTile(t),s.forEach(n=>this._loadTile(n)),s.forEach(n=>this._pendingTilesToUpdate.add(n)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),s.forEach(n=>f6(n,n.hasPendingUpdate(ht.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){NL.spatialReference=this.spatialReference,NL.extent=t.extent,NL.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",NL)}_createTile(t,e,i,r){_n(!!r,"_createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(ht.SPLIT),s}get _shortBatches(){return this.view.state.mode!==gi.IDLE}_mergeTile(t){_n(!t.hasPendingUpdate(ht.SPLIT),"_mergeTile sanity check"),_n(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),_n(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),f6(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_handleLayerViewChanges(t=wc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),cW(n)||RA(n))if(this._basemapLayerViewHandles.has(n.uid)&&!RA(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){let t=this.view.map?.ground?.opacity===0;for(const e of this.view.allLayerViews.items)if(lW(e)&&!$D(e.layer)&&e.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((MR(t)||RA(t))&&fwt(pW[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return aW(t)?Nt.ELEVATION:Nt.MAP}_registerTiledLayerView(t){const e=[];if((MR(t)||RA(t))&&e.push(he(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Qs.UNFADED)})),!RA(t)){const i=this._layerClassFromLayerView(t);e.push(he(()=>t.suspended,()=>this._updateTiledLayers())),e.push(he(()=>t.fullOpacity,()=>this._updateTileTextures(Qs.UNFADED))),e.push(he(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!cW(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Nt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of db){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){const h=n[u].uid;this._layerIndexByUid[r].set(h,u);const p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===Nt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Nt.MAP),t===Qs.IMMEDIATE?this.renderer.updateTileTexture(e,ht.TEXTURE_NOFADING):e.updateRenderData(Nt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=Vi.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||BC(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,yt(r),sn(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){const s=e===Nt.ELEVATION;return r.requester??(r.requester=s?this._elevationDataRequester:this._mapDataRequester),s?aW(i)?this._requestElevationTileData(t,i,r):Promise.reject():lW(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!qn(i)&&n&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{sn(n)||(le.getLogger(this).error(`Tile ${t.lij.toString()} layer ${Nt.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,Nt.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[Nt.ELEVATION].get(e.uid);if(r==null)return void le.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Nt.ELEVATION,t.lij.toString());const s=new T1t(t.lij,t.extent,i);t.dataArrived(r,Nt.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{k2(l),qn(i)||(console.error(`Tile ${t.lij.toString()} layer ${Nt.MAP}/${e.uid} error ${a}`),this._dataMissing(t,Nt.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),qn(i)?k2(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(Nt.MAP,e.uid);if(r==null)return k2(i),void le.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,Nt.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):le.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=e[0],r=e[1]>>i,s=e[2]>>i;let n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return _n(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!N5)return;const t=this._rootTiles;if(t==null)return;const e=n=>n?.renderData?.geometry?.indices?.length>0,i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!n.renderData?.geometry||(n.renderData.geometry.indices?.length??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const o of n.children)i(o,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const o of n.children)r(o)},s=n=>{const o=n.parent?.visible??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const c of n.children)s(c)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){F1t(t)}enableWaterproofnessChecks(t){N1t(t)}};Bt._tileMemcacheKey="TerrainTileMemcache",d([m()],Bt.prototype,"_renderer",void 0),d([m({constructOnly:!0})],Bt.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],Bt.prototype,"view",void 0),d([m({constructOnly:!0})],Bt.prototype,"overlayManager",void 0),d([m()],Bt.prototype,"_hasPendingUpdates",void 0),d([m()],Bt.prototype,"_asyncWorkItems",void 0),d([m()],Bt.prototype,"_allTilesDirty",void 0),d([m()],Bt.prototype,"_allTilesSorted",void 0),d([m()],Bt.prototype,"_viewChanged",void 0),d([m({type:Number})],Bt.prototype,"heading",void 0),d([m()],Bt.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],Bt.prototype,"_watchUpdatingTracking",void 0),d([m()],Bt.prototype,"_frameTask",void 0),d([m({readOnly:!0})],Bt.prototype,"snapLevel",null),d([m({readOnly:!0})],Bt.prototype,"lodSnapping",null),d([m()],Bt.prototype,"_userClippingExtent",null),d([m()],Bt.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],Bt.prototype,"extent",null),d([m({readOnly:!0})],Bt.prototype,"groundExtent",null),d([m({readOnly:!0})],Bt.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],Bt.prototype,"updating",null),d([m({readOnly:!0})],Bt.prototype,"running",null),d([m(w1t)],Bt.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],Bt.prototype,"updatingProgressValue",null),d([m()],Bt.prototype,"_maxNumUpdating",void 0),d([m()],Bt.prototype,"baseOpacity",null),d([m()],Bt.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],Bt.prototype,"viewingMode",null),d([m()],Bt.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],Bt.prototype,"ready",null),d([m({value:VC.FRONT_TO_BACK})],Bt.prototype,"renderOrder",null),d([m({readOnly:!0})],Bt.prototype,"rootTiles",null),d([m()],Bt.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],Bt.prototype,"spatialReference",null),d([m({type:et})],Bt.prototype,"backgroundColor",null),d([m({value:!1})],Bt.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],Bt.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],Bt.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],Bt.prototype,"tilingSchemeLogic",void 0),d([m()],Bt.prototype,"wireframe",null),d([m({value:!1})],Bt.prototype,"suspended",null),d([m()],Bt.prototype,"fadeDuration",null),d([m()],Bt.prototype,"visibleElevationBounds",void 0),d([m()],Bt.prototype,"rootTileElevationBounds",void 0),d([m()],Bt.prototype,"_layerViewsDirty",void 0),d([m()],Bt.prototype,"renderPatchBorders",null),d([m()],Bt.prototype,"visualizeNormals",null),d([m()],Bt.prototype,"renderingDisabled",null),Bt=jN=d([U("esri.views.3d.terrain.TerrainSurface")],Bt);const yxt=Bt,IA=C(),PT=Ws(),_xt=Vt();new Gt;const p6=new b1t("ground"),NL={spatialReference:null,extent:null,scale:0};function Que(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let s=r;for(;s&&!s.renderData;){const o=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return ss(e,i,n)}return null}class vxt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function f6(t,e){!t.isLeaf||t.level<xn||uK(t,i=>{e&&kPe(i);const r=wW(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=wW(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function kPe(t){if(t.hasPendingUpdate(ht.SPLIT))return;let e=t.parent;for(;e?.resetPendingUpdate(ht.MERGE);)e=e.parent;t.resetPendingUpdate(ht.MERGE),t.isLeaf&&t.setPendingUpdate(ht.SPLIT),t.level<xn||uK(t,i=>{kPe(i)})}function Kue(t){t.level<xn||uK(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,wW(i));)i=i.parent}})}function wW(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function uK(t,e){if(t.level<xn)return;const i=t.level-xn,r=t.lij[1]>>xn,s=t.lij[2]>>xn,n=o=>o.isLeaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(Kd[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let bxt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},SP=class extends Pe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let h=!1;if(l===qr.UPDATE){const p=o.get(u);if(p){if(c&An.TRANSFORMATION){const f=this.model.getObject(n);this.model.updateRenderGeometryTransformation(f,a,p)&&(h=!0)}h||i.updates.push({renderGeometry:p,updateType:c})}else at(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===qr.REMOVE||h){const p=o.get(u);p?(i.removes.push(p),o.delete(u)):l===qr.REMOVE&&at(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===qr.ADD||h){const p=this.model.getObject(n);if(p!=null){const f=this.model.getRenderGeometry(p,a);i.adds.push(f),o.set(u,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},h)=>{let p=!1;if(l===qr.UPDATE&&u){const f=o.get(h);if(f){if(c&An.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,f)&&(p=!0)}p||i.updates.push({renderGeometry:f,updateType:c})}else at(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,qr.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(An.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(An.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(An.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,qr.UPDATE,An.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,qr.UPDATE,An.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,qr.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,qr.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=An.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),u=c.get(l);let h=!1;if(u){const p=u.operation;p===qr.REMOVE&&s===qr.ADD&&u.states!==An.NONE?u.operation=qr.UPDATE:p===qr.REMOVE&&s===qr.ADD||p===qr.ADD&&s===qr.REMOVE?(c.delete(l),h=!0):p!==qr.UPDATE||s!==qr.REMOVE&&s!==qr.UPDATE?(at((p===qr.REMOVE||p===qr.ADD)&&s===qr.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new bxt(s,i,n,o));this.dirty=!h||this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){for(const e of this._dirtyGeomRecords.values())for(const i of e.values())if(i.size>0)return!0;return!1}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:A3e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};d([m({constructOnly:!0})],SP.prototype,"model",void 0),d([m()],SP.prototype,"dirty",void 0),SP=d([U("esri.views.3d.webgl-engine.lib.ModelDirtySet")],SP);const wxt=SP;let HN=class extends Pe{constructor(){super(...arguments),this.dirtySet=new wxt({model:this}),this._content=new Map,this._originFactory=new FCe(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;at(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),_5(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),_5(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(at(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(at(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new UC(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,ehe);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,ehe);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<ws.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};d([m({constructOnly:!0})],HN.prototype,"dirtySet",void 0),HN=d([U("esri.views.3d.webgl-engine.parts.Model")],HN);const ehe=xe();let xxt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Txt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function Txt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let Sxt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new xxt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=Cxt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function Cxt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let Ext=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Oe(this.intersectionGeometry),this.renderable=Oe(this.renderable),this.components=Oe(this.components)}};function Axt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let u=0;u<l;++u){const h=3*(u+t),p=s*i[h+0],f=r[p+0],g=r[p+1],_=a/(r[p+2]-o),v=f*_,b=g*_,w=s*i[h+1],T=r[w+0],S=r[w+1],A=a/(r[w+2]-o),P=T*A,R=S*A,F=s*i[h+2],k=r[F+0],N=r[F+1],j=a/(r[F+2]-o),z=k*j,X=N*j,q=4*u;c[q+0]=Math.min(v,P,z),c[q+1]=Math.min(b,R,X),c[q+2]=Math.max(v,P,z),c[q+3]=Math.max(b,R,X)}return c}function Mxt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],u=r[c+0],h=r[c+1],p=s*i[l+1],f=r[p+0],g=r[p+1],_=s*i[l+2],v=r[_+0],b=r[_+1],w=4*a;o[w+0]=Math.min(u,f,v),o[w+1]=Math.min(h,g,b),o[w+2]=Math.max(u,f,v),o[w+3]=Math.max(h,g,b)}return o}function Pxt(t,e){return new(Oxt(t))(e)}function Oxt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let UPe=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Ce(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:u,maxMidIndexIndex:h,maxIndexIndex:p,aabb2D:f}=o;if(i<f[0]||i>f[2]||r<f[1]||r>f[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,p);break}{this._intersectRange(u,h);const g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,u);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(h,p);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let g=0,_=1;const v=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<v&&w<v||(b<v&&(g=(v-b)/(w-b)),w<v&&(_=(v-b)/(w-b)),g>_))return;const T=(1-g)*e[0]+g*i[0],S=(1-g)*e[1]+g*i[1],A=(1-g)*e[2]+g*i[2],P=(1-_)*e[0]+_*i[0],R=(1-_)*e[1]+_*i[1],F=(1-_)*e[2]+_*i[2],{planetCenterZ:k}=this,N=a-k,j=N/(A-k);r=T*j,s=S*j;const z=N/(F-k);n=P*z,o=R*z}const l=n-r,c=o-s,u=this._bspNodes;let h=1;{const{aabb2D:g}=u[0],_=(w,T,S,A)=>{if(Math.abs(T)<1e-5*Math.max(A-S,1))return!1;const P=T>0,R=P?A:S,F=w+h*T;return(P?F<R:F>R)&&(h=Math.max((R-w)/T,h),!0)},v=()=>_(r,l,g[0],g[2]),b=()=>_(s,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?v()||b():b()||v()}const p=[0,0,h];let f=0;for(;f<p.length;){const g=p[f];let _=p[f+1],v=p[f+2];if(f+=3,_>v)continue;const b=u[g],{minIndexIndex:w,maxIndexIndex:T}=b,{child0:S,child1:A,minMidIndexIndex:P,maxMidIndexIndex:R,aabb2D:F,d:k,dim:N}=b;{const j=r+_*l,z=r+v*l,X=Math.min(j,z),q=Math.max(j,z),Z=F[0],ce=F[2];if(q<Z||ce<X)continue;if(X<Z){const I=(Z-r)/l;l>0?_=Math.max(_,I):v=Math.min(v,I)}if(ce<q){const I=(ce-r)/l;l>0?v=Math.min(v,I):_=Math.max(_,I)}}{const j=s+_*c,z=s+v*c,X=Math.min(j,z),q=Math.max(j,z),Z=F[1],ce=F[3];if(q<Z||ce<X)continue;if(X<Z){const I=(Z-s)/c;c>0?_=Math.max(_,I):v=Math.min(v,I)}if(ce<q){const I=(ce-s)/c;c>0?v=Math.min(v,I):_=Math.max(_,I)}}if(S===-1&&A===-1)this._intersectRange(w,T);else{const j=N===0?r:s,z=N===0?l:c,X=j+_*z,q=j+v*z,Z=Math.min(X,q),ce=Math.max(X,q),I=Te((k-j)/z,0,h);w<P&&Z<=k&&(S!==-1?(p.push(S),p.push(z>=0?_:Math.max(_,I)),p.push(z>=0?Math.min(v,I):v)):this._intersectRange(w,P)),this._intersectRange(P,R),R<T&&k<=ce&&(A!==-1?(p.push(A),p.push(z>=0?Math.max(_,I):_),p.push(z>=0?v:Math.min(v,I))):this._intersectRange(R,T))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=Pxt(e,e);this._elementIndexMap=i;for(let f=0;f<e;++f)i[f]=f;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:f,geometryMinZ:g}=this;a=f>=0||g<.5*f}const l=[],c=(f,g,_,v,b)=>{l.push(f),l.push(g),l.push(_),l.push(v<0?-1:(b?0:1)+2*v)},{maxBspNodeDepth:u,minBspNodeElementCount:h}=this,p=(f,g,_,v,b)=>{const w=n.length;if(w>0&&(a||_>=u||g-f<h))return;const T=[0,0,0,0];Lxt(T,f,g,i,r);const{d:S,dim:A}=o?Rxt(T):$xt(T),{rangeMidStart:P,rangeMidEnd:R}=Ixt(f,g,A,S,i,r),F=_===u-1,k=!F&&P>=f+h,N=!F&&g>=R+h;if(k||N||w===0){const j=new Dxt(f,P,R,g,A,S,T);if(k&&c(f,P,_+1,w,!0),N&&c(R,g,_+1,w,!1),n.push(j),v!==-1){const z=n[v];b?z.child0=w:z.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const f=l[s],g=l[s+1],_=l[s+2],v=l[s+3];s+=4;const b=v>>1;p(f,g,_,b,v-(b<<1)==0)}this._generatedBVH=!0}};function Rxt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function $xt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function Ixt(t,e,i,r,s,n){let o=t;{let u=e;for(;o<u;){const h=s[o];the(h,i,r,n)<0?++o:(--u,s[o]=s[u],s[u]=h)}}const a=o;let l=o,c=e;for(;l<c;){const u=s[c-1];the(u,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=u,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function the(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function Lxt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const u=4*r[c];n=Math.min(n,s[u+0]),o=Math.min(o,s[u+1]),a=Math.max(a,s[u+2]),l=Math.max(l,s[u+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let Dxt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},Nxt=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=C(),this.ray0=C(),this.isVerticalRay=!1,this._triangleHitCallback=ihe,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new UPe(o-n,this)}getAabbs2D(){return this.localMode?Mxt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):Axt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ae(this.ray0,e),yi(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=ihe}intersectRange(e,i){const r=this._bvh.elementIndexMap;zPe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function zPe(t,e,i,r,s,n,o,a,l,c,u,h=null,p=0){a!==0?Pst(t,e,i,r,s,n,o,a,l,c,u,h,p):WSe(t,e,i,r,s,n,o,c,u,h,p)}function ihe(){}function Fxt(t,e,i,r){if(i>=e)return t;t==null&&(t=kxt());const s=t.isVisibleBit;let n=t.data;const o=BPe(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=n,h=r===s;if(!(i<u.length*o)&&h){const p=a+1,f=Math.ceil(u.length*Z5),g=c+1;let _=Math.max(p,f);_=Math.min(_,g),n=new Uint32Array(_),n.set(u)}return a<n.length&&(n[a]=zxt(n[a],l,h)),t.data=n,t}function xW(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=BPe(r);return e<r.length*s?Uxt(i,r,e,s):!t.isVisibleBit}function kxt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Uxt(t,e,i,r){const s=i/r|0,n=i-s*r;return Bxt(e[s],n)===t}function BPe(t){return t.BYTES_PER_ELEMENT*8}function zxt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function Bxt(t,e){return!!(t&1<<e)}let Vxt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=qxt,this._ray1=Wxt,this._invDir=C(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=Yxt,this._callback=rhe,this.rayDirectionC=C(),this._componentIndexMap=null,this._bvh=new UPe(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],u=n[a+2],h=n[a+3],p=n[a+4],f=r/(u-i),g=r/(n[a+5]-i),_=Math.min(l*f,l*g),v=Math.min(c*f,c*g),b=Math.max(h*f,h*g),w=Math.max(p*f,p*g),T=4*o;s[T+0]=_,s[T+1]=v,s[T+2]=b,s[T+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],u=4*s;i[u+0]=o,i[u+1]=a,i[u+2]=l,i[u+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,Dst(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=rhe}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;xW(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!xW(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,Gxt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:u,_tolerance:h,rayDirectionC:p,componentIntersectionData:f}=this,{isVerticalRay:g}=this._intersectionOptions,_=this._components.offsets,v=ae(jxt,a),b=ae(Hxt,l),w=n?.[e]??0,T=w+(o?.offset??0);if(T!==0&&(s?(v[2]=a[2]-T,b[2]=l[2]-T,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||T===0||o.applyToAabb(i),!jJ(i,v,c,h))return;yi(p,b,v);const S=_[e]/3,A=_[e+1]/3,P=A-S,R=(X,q,Z)=>{this._callback(X,q,e,Z)},{vertexData:F,vertexStride:k,indexData:N,_intersectionOptions:j}=this,{normalRequired:z}=j;if(P>Xxt){let X=f[e];X==null&&(X=new Nxt(e,F,k,N,S,A,this.geometryMinZ,u,s),f[e]=X),X.intersectRay(v,b,g,r?0:T,R,z)}else zPe(v,p,S,A,N,F,k,r?0:T,u,z,R)}};const Gxt=pn(),jxt=C(),Hxt=C(),qxt=C(),Wxt=C(),rhe=()=>{},Yxt=new O$,Xxt=40;let Zxt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=C(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?Qf(i.indices):px(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,u=yi(Jxt,e,c),h=yi(Qxt,i,c),p=c$(Kxt,o.rotationScale);On(u,u,p),On(h,h,p);const f=mx(tTt,p);if(this.viewingMode===Ne.Global){const _=this._planetCenter;Yn(_,c),On(_,_,p)}const g=(_,v,b,w)=>{l(b,_,w?On(eTt,w,f):null,v)};this._intersectComponents(u,h,n,s,g,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=os(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let u=0,h=1/0,p=1/0,f=1/0,g=-1/0,_=-1/0,v=-1/0;for(let b=0;b<n;b++){const w=c[b],T=c[b+1];let S=1/0,A=1/0,P=1/0,R=-1/0,F=-1/0,k=-1/0;if(w<T)for(let N=w;N<T;N++){const j=3*a[N],z=l[j],X=l[j+1],q=l[j+2];S=Math.min(S,z),A=Math.min(A,X),P=Math.min(P,q),R=Math.max(R,z),F=Math.max(F,X),k=Math.max(k,q)}else S=i,A=r,P=s,R=i,F=r,k=s;o[u++]=S,o[u++]=A,o[u++]=P,o[u++]=R,o[u++]=F,o[u++]=k,h=Math.min(h,S),p=Math.min(p,A),f=Math.min(f,P),g=Math.max(g,R),_=Math.max(_,F),v=Math.max(v,k)}return this._aabb[0]=h,this._aabb[1]=p,this._aabb[2]=f,this._aabb[3]=g,this._aabb[4]=_,this._aabb[5]=v,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new Vxt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Ne.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const Jxt=C(),Qxt=C(),Kxt=yr(),eTt=C(),tTt=yr();let iTt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},rTt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},hK=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function sTt(t,e){return{near:t,far:e}}function G$(t){return t?PR(t,1/0,-1/0):sTt(1/0,-1/0)}function PR(t,e,i){return t.near=e,t.far=i,t}function GC(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function FL(t,e){return t.near<=e&&e<=t.far}const TW={near:0,far:0};function nTt(t,e){const i=G$(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=pe(yi(Jc,a.center,r),n),c=a.projectedRadius(n);if(FL(i,l-c)&&FL(i,l+c))return;const u=uTt(a,s);if(u===-1)return;if(u===0)return tg.far=l+c,tg.near=l-c,void GC(i,tg);const h=kL.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=o});for(let o=0;o<kL.length;o++){const a=kL.data[o];if(FL(i,a.near)&&FL(i,a.far))continue;tg.far=a.far,tg.near=1/0,cTt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,oTt,c=>{let u=aTt;for(let h=0;h<VPe&&c.length>0;h++){if(!(a.mask&1<<h))continue;lTt(s[h],c,u);const p=c;c=u,u=p}for(let h=0;h<c.length;h+=3){te(Al,c.data[h],c.data[h+1],c.data[h+2]);const p=pe(yi(Al,Al,r),n);tg.near=Math.min(tg.near,p)}})===0&&(tg.near=0),GC(i,tg)}return kL.length=0,i}const kL=new Gt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),tg=G$(),Al=C(),x1=C(),oTt=new Gt({deallocator:null}),aTt=new Gt({deallocator:null});function lTt(t,e,i){i.length=0;const r=e.length-3;m6(Al,e,r);const s=fr(t,Al);s<=0&&(i.push(Al[0]),i.push(Al[1]),i.push(Al[2]));let n=0,o=s;for(;n<r;n+=3){m6(x1,e,n);const a=fr(t,x1);o*a<0&&(or(Al,x1,Al,a/(a-o)),Ml(i,Al)),a<=0&&Ml(i,x1),o=a,ae(Al,x1)}o*s<0&&(m6(x1,e,r),or(Al,x1,Al,s/(s-o)),Ml(i,Al))}function m6(t,e,i){return te(t,e.data[i],e.data[i+1],e.data[i+2])}function Ml(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function cTt(t,e,i,r){$_(nhe,t.quaternion),yi(Jc,e,t.center),uc(Jc,Jc,nhe);const s=t.halfSize,n=8*((Jc[0]<-s[0]?-1:Jc[0]>s[0]?1:0)+3*(Jc[1]<-s[1]?-1:Jc[1]>s[1]?1:0)+9*(Jc[2]<-s[2]?-1:Jc[2]>s[2]?1:0)+13),o=she[n];if(o===0)return o;eR(UL,t.quaternion),u$(UL,UL,t.halfSize);const a=(l,c)=>{const u=she[n+c+1];return te(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),On(l,l,UL),me(l,t.center,l)};return i.length=0,Ml(i,a(g6,0)),Ml(i,a(ohe,1)),Ml(i,a(Jc,2)),Ml(i,a(ahe,3)),r(i),o===1||(i.length=0,Ml(i,g6),Ml(i,ahe),Ml(i,a(Jc,4)),Ml(i,a(lhe,5)),r(i),o===2||(i.length=0,Ml(i,g6),Ml(i,lhe),Ml(i,a(Jc,6)),Ml(i,ohe),r(i))),o}const she=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),VPe=4;function uTt(t,e){let i=0;for(let r=0;r<VPe;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const UL=yr(),nhe=Gl(),Jc=C(),g6=C(),ohe=C(),ahe=C(),lhe=C();let hTt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?nTt(e,this._objects.visibleObjects):null}};function dTt(t){const e=cs().vec3f(O.POSITION);return t.hasNormals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Qr.Default?e.vec2f(O.UV0):t.textureCoordinates===Qr.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e}let pTt=class{constructor(){this.externalColor=Yt(),this.externalColorMixMode=Mn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var _c;function fTt(t,e){const i=t.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case _c.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case _c.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case _c.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case _c.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(_c||(_c={}));var nm;function Djt(t){return t&&ex(t)?nm.Mars:t&&tx(t)?nm.Moon:nm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(nm||(nm={}));var xh;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(xh||(xh={}));let ni=class extends ol{constructor(){super(...arguments),this.output=V.Color,this.textureCoordinateType=Qr.None,this.componentData=rm.Uniform,this.cullFace=Er.Back,this.vertexDiscardMode=_c.None,this.doubleSidedMode=as.WindingOrder,this.alphaDiscardMode=mr.Opaque,this.integratedMeshMode=xh.None,this.transparencyPassType=Qe.NONE,this.ellipsoidMode=nm.Earth,this.pbrMode=mt.Disabled,this.normalType=zi.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([B({count:V.COUNT})],ni.prototype,"output",void 0),d([B({count:Qr.COUNT})],ni.prototype,"textureCoordinateType",void 0),d([B({count:rm.COUNT})],ni.prototype,"componentData",void 0),d([B({count:Er.COUNT})],ni.prototype,"cullFace",void 0),d([B({count:_c.COUNT})],ni.prototype,"vertexDiscardMode",void 0),d([B({count:as.COUNT})],ni.prototype,"doubleSidedMode",void 0),d([B({count:mr.COUNT})],ni.prototype,"alphaDiscardMode",void 0),d([B({count:xh.COUNT})],ni.prototype,"integratedMeshMode",void 0),d([B({count:Qe.COUNT})],ni.prototype,"transparencyPassType",void 0),d([B({count:nm.COUNT})],ni.prototype,"ellipsoidMode",void 0),d([B({count:mt.COUNT})],ni.prototype,"pbrMode",void 0),d([B({count:zi.COUNT})],ni.prototype,"normalType",void 0),d([B()],ni.prototype,"spherical",void 0),d([B()],ni.prototype,"doublePrecisionRequiresObfuscation",void 0),d([B()],ni.prototype,"hasVertexColors",void 0),d([B()],ni.prototype,"hasNormals",void 0),d([B()],ni.prototype,"hasSlicePlane",void 0),d([B()],ni.prototype,"hasColorTexture",void 0),d([B()],ni.prototype,"receiveAmbientOcclusion",void 0),d([B()],ni.prototype,"receiveShadows",void 0),d([B()],ni.prototype,"blendingEnabled",void 0),d([B()],ni.prototype,"hasScreenSpaceReflections",void 0),d([B()],ni.prototype,"hasPolygonOffset",void 0),d([B()],ni.prototype,"hasMetallicRoughnessTexture",void 0),d([B()],ni.prototype,"hasEmissionTexture",void 0),d([B()],ni.prototype,"hasOcclusionTexture",void 0),d([B()],ni.prototype,"hasNormalTexture",void 0),d([B()],ni.prototype,"hasOccludees",void 0),d([B()],ni.prototype,"multipassEnabled",void 0),d([B()],ni.prototype,"cullAboveGround",void 0),d([B()],ni.prototype,"hasNormalTextureTransform",void 0),d([B()],ni.prototype,"hasCloudsReflections",void 0),d([B()],ni.prototype,"snowCover",void 0),d([B()],ni.prototype,"objectAndLayerIdColor",void 0),d([B({constValue:!1})],ni.prototype,"occlusionPass",void 0),d([B({constValue:Di.Draw})],ni.prototype,"pbrTextureBindType",void 0),d([B({constValue:!0})],ni.prototype,"hasSliceHighlight",void 0),d([B({constValue:!1})],ni.prototype,"hasSliceInVertexProgram",void 0),d([B({constValue:!1})],ni.prototype,"useCustomDTRExponentForWater",void 0),d([B({constValue:!1})],ni.prototype,"hasVertexTangents",void 0),d([B({constValue:!0})],ni.prototype,"supportsTextureAtlas",void 0),d([B({constValue:!1})],ni.prototype,"highStepCount",void 0),d([B({constValue:!1})],ni.prototype,"instancedDoublePrecision",void 0),d([B({constValue:!1})],ni.prototype,"hasModelTransformation",void 0),d([B({constValue:!0})],ni.prototype,"useFillLights",void 0),d([B({constValue:!1})],ni.prototype,"objectAndLayerIdColorInstanced",void 0);function mTt(t,e){t.include(Tx,e),t.fragment.include(KJ);const i=t.fragment;i.uniforms.add(new c5("baseColor",r=>r.baseColor)),i.uniforms.add(new s2e("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function che(t,e){const i=t.fragment;switch(e.doubleSidedMode){case as.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case as.View:t.include(A2,e),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case as.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case as.COUNT:}switch(e.normalType){case zi.Attribute:case zi.Compressed:t.include(oz,e),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case zi.ScreenDerivative:t.include(A2,e),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case zi.Ground:e.spherical?(t.include(A2,e),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case zi.COUNT:}}function gTt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===V.Color||e.alphaDiscardMode!==mr.Opaque)){t.include(qZ,e);const r=e.textureCoordinateType===Qr.Atlas;i.uniforms.add(new em("baseColorTexture",s=>s.texture)),r?(t.include(HZ),i.code.add(x`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(x`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function yTt(t){const e=new Pi;e.include(A2,t),e.include(oz,t),e.include(Tx,t),e.include(Yd,t),e.include(gE,t),e.include(_st,t),e.include(Gst,t),e.include(Oit,t),e.include(gTt,t),e.include(fTt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==mt.Normal&&t.pbrMode!==mt.Schematic||(e.include(YZ,t),t.hasNormalTexture&&e.include(a2e,t));const s=t.output===V.Shadow||t.output===V.ShadowHighlight||t.output===V.ShadowExcludeHighlight;s&&t.componentData===rm.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===xh.ColorOverlay||t.integratedMeshMode===xh.ColorOverlayWithWater,o=n&&t.output===V.Color&&t.pbrMode===mt.WaterOnIntegratedMesh;n&&(e.include(Ww,t),e.include(hat,t),t.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(t.ellipsoidMode===nm.Earth?ji.radius:t.ellipsoidMode===nm.Mars?tp.radius:l0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===V.ObjectAndLayerIdColor?x`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${x.float(Ro)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===V.ObjectAndLayerIdColor?x`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===V.Color&&(r.include(UZ),e.include(Im,t),e.include(mTt,t),e.include(che,t),e.include(Ww,t),t.transparencyPassType===Qe.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),t.receiveShadows?(e.include(D$,t),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new ct("ovColorTex",(l,c)=>aCe(l,c))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?x`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===mt.Normal||t.pbrMode===mt.Schematic?(Em(r),r.code.add(x`
        ${t.pbrMode===mt.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${t.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${t.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):t.spherical?(xE(r),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),o&&r.uniforms.add(new ct("ovNormalTex",(l,c)=>c.overlay?.getTexture(Nr.WaterNormal))),t.snowCover&&r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===Qe.ColorAlpha?x`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const a=t.output===V.Depth;return(a||s||t.output===V.ViewshedShadow)&&(a||e.include(lz,t),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?"":x`outputDepth(linearDepth);`}
      }
    `)),t.output===V.Normal&&(e.include(che,t),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===zi.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===V.ObjectAndLayerIdColor&&e.fragment.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===V.Highlight&&(e.include(Mv),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const _Tt=Object.freeze(Object.defineProperty({__proto__:null,build:yTt},Symbol.toStringTag,{value:"Module"}));let GPe=class jPe extends Ni{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ne.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Fi(e.rctx,jPe.shader.get().build(this.configuration),HPe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==xh.None,s=e===Qe.NONE,n=e===Qe.FrontFace;return Lt({blending:i.output===V.Color&&i.blendingEnabled?s?Ac:L0(e):null,culling:kU(i.cullFace),depthTest:{func:Pv(e)},depthWrite:s||n?Oc:null,drawBuffers:i.output===V.Depth?{buffers:[zn.NONE]}:D0(e),colorWrite:qt,stencilWrite:r||i.hasOccludees?ym:null,stencilTest:r?zst(Nl.IntegratedMeshMaskExcluded):i.hasOccludees?Ov:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:iz})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};GPe.shader=new Oi(_Tt,()=>ue(()=>import("./ComponentShader.glsl-4a1c917d.js"),[],import.meta.url));const HPe=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let vTt=class extends xr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},dK=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function _s(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function uhe(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let qPe=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ae(this._low,ae(hhe,e));const i=yi(hhe,e,this._low);ae(this._high,i)}get(e){return me(e,this._low,this._high)}getLowScaled(e){return ie(e,this._low,1)}};const hhe=yc();let so=class extends vTt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=kt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=ya(az),this.emissiveFactor=Ce(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new qN,this.componentParameters=new SO,this.textureAlphaCutoff=s5,this.alphaDiscardMode=mr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=nm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ni;const r=new qPe(e.position),s=f_e(e.rotationScale);c$(s,s),mx(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Xt(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=i.identifier===Xa.Material&&r.transparencyPassType!=null?r.transparencyPassType:Qe.NONE,n.multipassEnabled=i.identifier===Xa.Material&&r.multipassEnabled,n.cullAboveGround=i.identifier===Xa.Material&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?as.View:as.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===Ba.Transparent||o===Ba.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?xTt(r)?wTt(r)?xh.ColorOverlayWithWater:xh.ColorOverlay:xh.NoOverlay:xh.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===xh.ColorOverlayWithWater?mt.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.needsNormals&&this.isIntegratedMesh?mt.Disabled:mt.Schematic:mt.Normal:mt.Disabled,n.normalType=s.needsNormals?n.hasNormals?zi.Compressed:zi.ScreenDerivative:zi.Ground,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Xa.ShadowMap)n.output=V.Shadow,n.vertexDiscardMode=_c.None;else if(i.identifier===Xa.ViewshedShadowMap)n.output=V.ViewshedShadow,n.vertexDiscardMode=_c.None;else if(i.identifier===Xa.Highlight)n.output=V.Highlight,n.vertexDiscardMode=_c.None;else{switch(o===Ba.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?_c.Opaque:_c.Transparent:n.vertexDiscardMode=_c.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case V.Color:n.receiveAmbientOcclusion=r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,n.hasCloudsReflections=r.cloudsFade.data!=null;break;case V.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(GPe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ba.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Ba.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Ba.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Ba.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),bTt(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==Bn.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,s,a,o),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ba.IntegratedMesh:this.objectOpacity<1?Ba.Transparent:this.componentParameters.opaqueOverride===Bn.All?Ba.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===mr.Blend||this.alphaDiscardMode===mr.MaskBlend?Ba.Transparent:this.componentParameters.transparent===Bn.None?Ba.Opaque:this.componentParameters.transparent===Bn.All?Ba.Transparent:Ba.OpaqueAndTransparent}};var Ba,Bn;d([_s({vectorOps:w_e})],so.prototype,"baseColor",void 0),d([_s()],so.prototype,"usePBR",void 0),d([_s()],so.prototype,"hasParametersFromSource",void 0),d([_s({vectorOps:Cee})],so.prototype,"mrrFactors",void 0),d([_s({vectorOps:Cee})],so.prototype,"emissiveFactor",void 0),d([_s({dispose:!0})],so.prototype,"baseColorTexture",void 0),d([_s({dispose:!0})],so.prototype,"metallicRoughnessTexture",void 0),d([_s({dispose:!0})],so.prototype,"emissionTexture",void 0),d([_s({dispose:!0})],so.prototype,"occlusionTexture",void 0),d([_s({dispose:!0})],so.prototype,"normalTexture",void 0),d([_s()],so.prototype,"objectOpacity",void 0),d([uhe()],so.prototype,"commonMaterialParameters",void 0),d([uhe()],so.prototype,"componentParameters",void 0),d([_s()],so.prototype,"textureAlphaCutoff",void 0),d([_s()],so.prototype,"alphaDiscardMode",void 0),d([_s()],so.prototype,"isIntegratedMesh",void 0),d([_s()],so.prototype,"polygonOffsetEnabled",void 0),d([_s()],so.prototype,"ellipsoidMode",void 0),d([_s()],so.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Ba||(Ba={}));let qN=class extends dK{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Er.Back,this.hasSlicePlane=!0}};d([_s()],qN.prototype,"doubleSided",void 0),d([_s()],qN.prototype,"cullFace",void 0),d([_s()],qN.prototype,"hasSlicePlane",void 0);let SO=class extends dK{constructor(){super(...arguments),this.externalColor=kt(1,1,1,1),this.externalColorMixMode=Mn.Multiply,this.castShadows=Bn.All}get transparent(){return this.externalColor[3]<1?Bn.All:Bn.None}get opaqueOverride(){return this.externalColorMixMode===Mn.Replace&&this.externalColor[3]===1?Bn.All:Bn.None}get visible(){return this.externalColor[3]>0?Bn.All:Bn.None}get type(){return rm.Uniform}};d([_s({vectorOps:w_e})],SO.prototype,"externalColor",void 0),d([_s()],SO.prototype,"externalColorMixMode",void 0),d([_s()],SO.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Bn||(Bn={}));let CP=class extends dK{constructor(){super(...arguments),this.texture=null,this.transparent=Bn.None,this.opaqueOverride=Bn.None,this.castShadows=Bn.None}get type(){return rm.Varying}};function bTt(t){return t.overlay?.getTexture(Nr.Highlight)!=null}function wTt(t){return t.overlay?.getTexture(Nr.WaterNormal)!=null}function xTt(t){return t.overlay?.getTexture(Nr.ColorNoRasterImage)!=null}d([_s()],CP.prototype,"texture",void 0),d([_s()],CP.prototype,"transparent",void 0),d([_s()],CP.prototype,"opaqueOverride",void 0),d([_s()],CP.prototype,"castShadows",void 0);const WPe=cs().vec3f(O.POSITION).u16(O.COMPONENTINDEX).freeze(),TTt=cs().vec2u8(O.SIDENESS).freeze(),jjt=Lc(TTt),SW=cs().vec3f(O.POSITION0).vec3f(O.POSITION1).vec2i16(O.NORMALCOMPRESSED).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).freeze(),CW=cs().vec3f(O.POSITION0).vec3f(O.POSITION1).vec2i16(O.NORMALCOMPRESSED).vec2i16(O.NORMAL2COMPRESSED).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Hjt=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMALCOMPRESSED,6],[O.NORMAL2COMPRESSED,7],[O.SIDENESS,8]]);function dhe(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<r;b++){const w=t[3*b],T=t[3*b+1],S=t[3*b+2];o(w,T),o(T,S),o(S,w)}let a=0,l=0;for(let b=0;b<i;b++){const w=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=T}const c=new Uint32Array(6*r),u=s[i],h=(b,w,T)=>{if(b<w){const S=s[b+1]++;c[2*S]=w,c[2*S+1]=T}else{const S=n[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=T}};for(let b=0;b<r;b++){const w=t[3*b],T=t[3*b+1],S=t[3*b+2];h(w,T,b),h(T,S,b),h(S,w,b)}const p=(b,w)=>{const T=2*b,S=w-b;for(let A=1;A<S;A++){const P=c[T+2*A],R=c[T+2*A+1];let F=A-1;for(;F>=0&&c[T+2*F]>P;F--)c[T+2*F+2]=c[T+2*F],c[T+2*F+3]=c[T+2*F+1];c[T+2*F+2]=P,c[T+2*F+3]=R}};for(let b=0;b<i;b++)p(s[b],s[b+1]),p(u+n[b],u+n[b+1]);const f=new Int32Array(3*r),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,_=(b,w)=>{const T=g(b,w);f[3*w+T]=-1},v=(b,w,T,S)=>{const A=g(b,w);f[3*w+A]=S;const P=g(T,S);f[3*S+P]=w};for(let b=0;b<i;b++){let w=s[b];const T=s[b+1];let S=n[b];const A=n[b+1];for(;w<T&&S<A;){const P=c[2*w],R=c[2*u+2*S];P===R?(v(b,c[2*w+1],R,c[2*u+2*S+1]),w++,S++):P<R?(_(b,c[2*w+1]),w++):(_(R,c[2*u+2*S+1]),S++)}for(;w<T;)_(b,c[2*w+1]),w++;for(;S<A;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return f}const y6=.7;let YPe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?CTt:STt}write(e,i,r){zL.seed=this._edgeHashFunction(r);const s=zL.getIntRange(0,255),n=zL.getIntRange(0,this.settings.variants-1),o=zL.getFloat(),a=255*(.5*ETt(-(1-Math.min(o/y6,1))+Math.max(0,o-y6)/(1-y6),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,n),e.variantExtension.set(i,a)}};const l_=new Float32Array(6),c_=new Uint32Array(l_.buffer),o2=new Uint32Array(1);function STt(t){return l_[0]=t.position0[0],l_[1]=t.position0[1],l_[2]=t.position0[2],l_[3]=t.position1[0],l_[4]=t.position1[1],l_[5]=t.position1[2],o2[0]=31*(31*(31*(31*(31*(166811+c_[0])+c_[1])+c_[2])+c_[3])+c_[4])+c_[5],o2[0]}function CTt(t){const e=l_;e[0]=OT(t.position0[0]),e[1]=OT(t.position0[1]),e[2]=OT(t.position0[2]),e[3]=OT(t.position1[0]),e[4]=OT(t.position1[1]),e[5]=OT(t.position1[2]),o2[0]=5381;for(let i=0;i<c_.length;i++)o2[0]=31*o2[0]+c_[i];return o2[0]}const phe=1e4;function OT(t){return Math.round(t*phe)/phe}function ETt(t,e){return Math.abs(t)**e*Math.sign(t)}let EW=class{constructor(){this._commonWriter=new YPe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return SW.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),me(RT,r.faceNormal0,r.faceNormal1),fe(RT,RT);const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;kh(s,i,RT[0],RT[1],RT[2],n)}};EW.Layout=SW,EW.glLayout=Lc(SW,1);let AW=class{constructor(){this._commonWriter=new YPe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return CW.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r);{const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;kh(s,i,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],n)}{const{typedBuffer:s,typedBufferStride:n}=e.normal2Compressed;kh(s,i,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],n)}}};AW.Layout=CW,AW.glLayout=Lc(CW,1);const RT=C(),zL=new Yb;let ATt=class{constructor(){this.position0=C(),this.position1=C(),this.faceNormal0=C(),this.faceNormal1=C(),this.componentIndex=0,this.cosAngle=0}};const WN=-1;function MTt(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=Ql.position0,o=Ql.position1,a=Ql.faceNormal0,l=Ql.faceNormal1,{edges:c,normals:u}=$Tt(t),h=c.length/4,p=e.allocate(h);let f=0;const g=h,_=i?.allocate(g);let v=0,b=0,w=0;BL.length=0;for(let F=0;F<h;++F){const k=4*F;r.getVec(c.data[k],n),r.getVec(c.data[k+1],o);const N=BL.pushNew();N.index=4*F,N.length=hr(n,o)}BL.sort((F,k)=>k.length-F.length);const T=new Array,S=new Array;BL.forAll(({length:F,index:k})=>{const N=c.data[k],j=c.data[k+1],z=c.data[k+2],X=c.data[k+3],q=X===WN;if(r.getVec(N,n),r.getVec(j,o),q){const Z=3*z;te(a,u.data[Z],u.data[Z+1],u.data[Z+2]),ae(l,a),Ql.componentIndex=s.get(N),Ql.cosAngle=pe(a,l)}else{let Z=3*z;if(te(a,u.data[Z],u.data[Z+1],u.data[Z+2]),Z=3*X,te(l,u.data[Z],u.data[Z+1],u.data[Z+2]),Ql.componentIndex=s.get(N),Ql.cosAngle=pe(a,l),OTt(Ql,DTt))return;Ql.cosAngle<-.9999&&ae(l,a)}b+=F,w++,q||PTt(Ql,FTt)?(e.write(p,f++,Ql),T.push(F)):RTt(Ql,XPe)&&(_&&i&&i.write(_,v++,Ql),S.push(F))});const A=new Float32Array(T.reverse()),P=new Float32Array(S.reverse()),R=_&&i?{instancesData:_.slice(0,v),lodInfo:{lengths:P}}:void 0;return{regular:{instancesData:p.slice(0,f),lodInfo:{lengths:A}},silhouette:R,averageEdgeLength:b/w}}function PTt(t,e){return t.cosAngle<e}function OTt(t,e){return t.cosAngle>e}function RTt(t,e){const i=Zn(t.cosAngle);return S0(fhe,t.position1,t.position0),i*(pe(Ke(LTt,t.faceNormal0,t.faceNormal1),fhe)>0?-1:1)>e}function $Tt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;Jl.length=_6.length=0;for(let n=0;n<e;n++){const o=3*n,a=r[o],l=r[o+1],c=r[o+2],u=i[o],h=i[o+1],p=i[o+2];s.getVec(u,T1),s.getVec(h,VL),s.getVec(p,GL),_e(VL,VL,T1),_e(GL,GL,T1),Ke(T1,VL,GL),fe(T1,T1),_6.pushArray(T1),(a===WN||u<h)&&(Jl.push(u),Jl.push(h),Jl.push(n),Jl.push(a)),(l===WN||h<p)&&(Jl.push(h),Jl.push(p),Jl.push(n),Jl.push(l)),(c===WN||p<u)&&(Jl.push(p),Jl.push(u),Jl.push(n),Jl.push(c))}return{edges:Jl,normals:_6}}let ITt=class{constructor(){this.index=0,this.length=0}};const BL=new Gt({allocator:t=>t||new ITt,deallocator:null}),Jl=new Gt({deallocator:null}),_6=new Gt({deallocator:null}),Ql=new ATt,LTt=C(),fhe=C(),T1=C(),VL=C(),GL=C(),XPe=xt(4),DTt=Math.cos(XPe),NTt=xt(35),FTt=Math.cos(NTt);function Jjt(t){const e=kTt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return mhe.updateSettings(t.writerSettings),ghe.updateSettings(t.writerSettings),MTt(e,mhe,ghe)}function kTt(t,e,i,r){if(e){const o=dhe(i,r,t.count);return new UTt(i,r,o,t)}const s=eq(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=dhe(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:WPe.createView(s.buffer)}}let UTt=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const mhe=new EW,ghe=new AW,Kjt=cs().vec3f(O.POSITION0).vec3f(O.POSITION1),zTt=cs().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX);let BTt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},VTt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new $r(this.textureWidth,1);r.samplingMode=Zt.NEAREST,r.wrapMode=hi.CLAMP_TO_EDGE,this._texture=new ur(this._rctx,r),this._data=new Ma(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new Ma(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const ZPe=65536;let GTt=class{constructor(e,i=1){this.textureBuffer=new VTt(e,i),this._indexManager=new BTt(ZPe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},jTt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>ZPe)return null;const i=new GTt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const yhe=()=>le.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let HTt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new Gt,this._hidden=new Gt,this._renderSubmit=new hTt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=se("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new jTt(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){at(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new Sxt(this._componentBufferManager,Qf(i.componentOffsets)),s=this._createRenderable(e,r),n=new Zxt(this._viewingMode,i.positionData,r),o=new Ext(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Wn(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new pTt,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let p=0,f=0,g=0,_=n.verticalOffsets,v=1/0,b=-1/0,w=!1,T=!1,S=0;for(let A=0;A<n.count;A++){i(A,l),p+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===Mn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,zSe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[A],0,u[0],u[1],u[2],u[3]),w||(w=A>0&&S!==h[0]),S=h[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(A).fill(0)),_!=null&&(_[A]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),yst(l.elevationOffset,u),c.setData(a[A],1,u[0],u[1],u[2],u[3]);const P=l.objectAndLayerIdColor;P!=null&&c.setData(a[A],2,P[0],P[1],P[2],P[3]),l.pickable!==xW(n.pickability,A)&&(n.pickability=Fxt(n.pickability,n.count,A,l.pickable))}n.verticalOffsets=T?_:null,r.offsetObb=T?sbe(r.obb,v,b,this._viewingMode,r.offsetObb??r.obb.clone()):null,w||T||this._hasObjectAndLayerId?(s.componentParameters=new CP,s.componentParameters.castShadows=v6(g,n.count),s.componentParameters.transparent=v6(p,n.count),s.componentParameters.opaqueOverride=v6(f,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new SO,s.componentParameters.castShadows=l.castShadows?Bn.All:Bn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===Ne.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Ure(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.components,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,u=this._viewingMode===Ne.Local,h=c.getComponentAabbs(),p=WTt;let f=1/0,g=-1/0;for(let _=0;_<a;_++){const v=6*_,b=l?.[_]??0;let w=1/0,T=-1/0;if(u)w=h[v+2]+b+i,T=h[v+5]+b+i;else{if(p[0]=h[v],p[1]=h[v+1],p[2]=h[v+2],p[3]=h[v+3],p[4]=h[v+4],p[5]=h[v+5],b!==0){const R=Ure(b);R.localOrigin=n.transform.position,R.applyToAabb(p)}const S=Math.max(Math.abs(p[3]),Math.abs(p[0])),A=Math.max(Math.abs(p[4]),Math.abs(p[1])),P=i+p[5]+r;s.expandElevationRangeValues(i+p[2],Math.sqrt(S*S+A*A+P*P)-r)}s.expandElevationRangeValues(w,T),f=Math.min(f,w),g=Math.max(g,T)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:u}=c;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(i,r,s,n,l.components.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.components.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:zTt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=WPe.createBuffer(a.length/3);Tz(c.position.typedBuffer,a,c.position.typedBufferStride,3),bve(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,h=this._computeVisibilityIndices(o,n,l,u);return{origin:Kr(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=am(e)?new Array(n):e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],h=r[c];for(let p=u;p<h;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void yhe().warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else yhe().warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=lr.createVertex(r,Hi.STATIC_DRAW,s.vertices.data),a=s.indices?lr.createIndex(r,Hi.STATIC_DRAW,s.indices):null,l=Lc(dTt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<i.count;_++){const v=i.offsets[_],b=i.offsets[_+1],w=i.materialDataIndices[_];if(s.indices!=null)for(let T=v;T<b;T++)c[s.indices[T]]=w;else for(let T=v;T<b;T++)c[T]=w}const u=lr.createVertex(r,Hi.STATIC_DRAW,c.buffer),h=new so(e.transform,e.toMapSpace),p=new bp(r,HPe,{data:l,componentIndices:qTt},{data:o,componentIndices:u},a),f=new rTt(p,ui.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new iTt(h,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const qTt=Lc(cs().u16(O.COMPONENTINDEX));function v6(t,e){return t===e?Bn.All:t===0?Bn.None:Bn.Some}const WTt=pn();let JPe=class extends xr{};function YTt(){const t=new Pi,{outputs:e,fragment:i}=t;return t.include(ra),i.uniforms.add(new em("textureInput",r=>r.input)),i.constants.add("sampleArea","int",Math.ceil(G5/2)),e.add("fragGrid","vec2"),i.code.add(x`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${x.int(Cf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const Cf=32,G5=9,QPe=.4,XTt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:JPe,blurSize:QPe,build:YTt,gridCellPixelSize:Cf,outlineSize:G5},Symbol.toStringTag,{value:"Module"}));function ZTt(){const t=new Pi,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new ct("coverageTex",n=>n.coverageTexture),new Ar("coverageRounding",n=>n.coverageRounding)),r.add(x`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new ct("tex",n=>n.blurTexture),new ct("highlightTexture",n=>n.highlightTexture),new Ei("uColor",n=>n.color),new Ei("haloColor",n=>n.haloColor),new Ei("opacities",n=>Zr(JTt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("inner","float",1-(G5-QPe)/G5),s.add(x`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const JTt=Yt(),QTt=Object.freeze(Object.defineProperty({__proto__:null,build:ZTt},Symbol.toStringTag,{value:"Module"}));let KPe=class eOe extends Ni{initializeProgram(e){return new Fi(e.rctx,eOe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};KPe.shader=new Oi(QTt,()=>ue(()=>import("./HighlightApply.glsl-a191b949.js"),[],import.meta.url));let tOe=class extends xr{constructor(){super(...arguments),this.blurSize=it()}};function KTt(){const t=new Pi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(O.POSITION,"vec2"),e.add(O.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new ct("coverageTex",n=>n.coverageTexture),new Ar("coverageRounding",n=>n.coverageRounding)),r.code.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new c2e("blurSize",n=>n.blurSize),new em("tex",n=>n.blurInputTexture)),s.code.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const eSt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:tOe,build:KTt},Symbol.toStringTag,{value:"Module"}));let iOe=class rOe extends Ni{initializeProgram(e){return new Fi(e.rctx,rOe.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};iOe.shader=new Oi(eSt,()=>ue(()=>import("./HighlightBlur.glsl-d07986ec.js"),[],import.meta.url));let sOe=class nOe extends Ni{initializeProgram(e){return new Fi(e.rctx,nOe.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};sOe.shader=new Oi(XTt,()=>ue(()=>import("./HighlightDownsample.glsl-f51bfead.js"),[],import.meta.url));let tSt=class extends xr{constructor(){super(...arguments),this.color=kt(1,0,1,1),this.haloColor=kt(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=ci(1,1)}},wS=class extends R${constructor(e){super(e),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new tSt,this._downsampleDrawParameters=new JPe,this._blurDrawParameters=new tOe,this._blurColorFormat=se("mac")?kr.RGBA:kr.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=e.techniques.acquire(iOe),this._downsampleTechnique=e.techniques.acquire(sOe),this._applyTechnique=e.techniques.acquire(KPe)}initialize(){this.addHandles([he(()=>this.view.highlightOptions.color,e=>{this._passParameters.color=cR(e??PMe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender(Vi.UPDATE)},qi),he(()=>this.view.highlightOptions.haloColor,e=>{this._passParameters.haloColor=e!=null?cR(e):this._passParameters.color,this.requestRender(Vi.UPDATE)},qi),he(()=>this.view.highlightOptions.haloOpacity,e=>{this._passParameters.haloOpacity=e??OMe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender(Vi.UPDATE)},qi),he(()=>this.view.highlightOptions.fillOpacity,e=>{this._passParameters.fillOpacity=e??RMe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender(Vi.UPDATE)},qi)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=Xt(this._grid.coverage),this._grid.vao=Tt(this._grid.vao)}render(e){if(this.bindParameters.decorations===Ka.OFF)return e.find(({name:b})=>b==="highlight-color");if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender(Vi.UPDATE),e.find(({name:b})=>b==="highlight-color");const i=e.find(({name:b})=>b==="highlights").getTexture(),r=this.bindParameters.camera,s=r.fullWidth,n=r.fullHeight,o=r.pixelRatio,a=Math.ceil(s/o),l=Math.ceil(n/o),c=this.renderingContext;this._gridUpdateResources(i),this._gridComputeCoverage(i,this.bindParameters),this._passParameters.highlightTexture=i,this._passParameters.coverageTexture=this._grid.coverage?.getTexture();const{width:u,height:h}=i.descriptor;bi(this._passParameters.coverageRounding,u/(Math.ceil(u/Cf)*Cf),h/(Math.ceil(h/Cf)*Cf));const p=this._grid.vao;c.bindVAO(p);const f=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture(f.fbo?.colorTexture),c.bindFramebuffer(f.fbo),c.setClearColor(0,0,0,0),c.clear(Sr.COLOR_BUFFER_BIT),c.setViewport(0,0,a,l),this._blurDrawParameters.blurInputTexture=i,bi(this._blurDrawParameters.blurSize,1/a,0);const g=c.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);c.drawArrays(this._blurTechnique.primitiveType,0,Qg(p,"geometry"));const _=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture(_.fbo?.colorTexture),c.bindFramebuffer(_.fbo),c.setClearColor(0,0,0,0),c.clear(Sr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=f.getTexture(),bi(this._blurDrawParameters.blurSize,0,1/l),g.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),c.drawArrays(this._blurTechnique.primitiveType,0,Qg(p,"geometry"));const v=e.find(({name:b})=>b==="highlight-color");return c.bindFramebuffer(v.fbo),c.setViewport4fv(r.fullViewport),this._passParameters.blurTexture=_.getTexture(),c.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),c.drawArrays(this._applyTechnique.primitiveType,0,Qg(p,"geometry")),f.release(),_.release(),v}_gridUpdateResources(e){const i=this.renderingContext,r=this._grid,s=Math.ceil(e.descriptor.height/Cf),n=Math.ceil(e.descriptor.width/Cf);if(r.vao&&r.verticalCellCount===s&&r.horizontalCellCount===n)return;r.verticalCellCount=s,r.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let h=0;for(let p=0;p<o;p++)for(let f=0;f<a;f++)u[h++]=(f-.5)*c*2-1,u[h++]=(p-.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f+.5)*c*2-1,u[h++]=(p-.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f-.5)*c*2-1,u[h++]=(p+.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f-.5)*c*2-1,u[h++]=(p+.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f+.5)*c*2-1,u[h++]=(p-.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f+.5)*c*2-1,u[h++]=(p+.5)*l*2-1,u[h++]=f*c,u[h++]=p*l;r.vao?.dispose(),r.vao=new Pm(i,di,{geometry:b$},{geometry:lr.createVertex(i,Hi.STATIC_DRAW,u)})}_gridComputeCoverage(e,i){const r=this.renderingContext,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/Cf),a=Math.ceil(n.height/Cf);this._downsampleDrawParameters.input=e,s.coverage?.release(),s.coverage=this.fboCache.acquire(o,a,"highlight coverage",kr.RG),r.unbindTexture(s.coverage.fbo?.colorTexture),r.bindFramebuffer(s.coverage.fbo),r.bindTechnique(this._downsampleTechnique,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){}};d([m()],wS.prototype,"produces",void 0),d([m()],wS.prototype,"consumes",void 0),d([m({constructOnly:!0})],wS.prototype,"techniques",void 0),wS=d([U("esri.views.3d.webgl-engine.effects.highlight.Highlight")],wS);let pK=class extends ol{constructor(){super(...arguments),this.receiveShadows=!0}};d([B()],pK.prototype,"receiveShadows",void 0);function oOe(t){const e=t.fragment;t.include($$),e.include(Cm),e.code.add(x`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}const iSt=.99999,rSt=.025;function sSt(t){const e=new Pi;e.include(D$,t),e.include(ra),e.include(oOe);const i=e.fragment;return i.include(Ep),i.uniforms.add(new ct("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(Zw.ExcludeHighlight)),new ct("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(Zw.Highlight)),new ct("depthMap",(r,s)=>s.depth?.attachment),new ct("highlightTexture",r=>r.highlight),new Ei("uColor",r=>r.shadowColor),new Ue("opacity",r=>r.shadowOpacity),new Ue("occludedOpacity",r=>r.occludedShadowOpacity),new Ue("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Rt("lightingMainDirectionView",(r,s)=>fe(vhe,Ve(vhe,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Gr("inverseViewMatrix",(r,s)=>Is(_he,Aa(_he,s.camera.viewMatrix,s.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",RJ),i.code.add(x`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${x.float(iSt)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${x.float(rSt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const _he=xe(),vhe=C(),nSt=Object.freeze(Object.defineProperty({__proto__:null,build:sSt},Symbol.toStringTag,{value:"Module"}));let oSt=class extends QJ{constructor(){super(...arguments),this.shadowColor=kt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},aOe=class lOe extends Ni{constructor(e){super(e,new pK,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,lOe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt,depthTest:null,depthWrite:null})}get primitiveType(){return ui.TRIANGLE_STRIP}};aOe.shader=new Oi(nSt,()=>ue(()=>import("./ShadowHighlight.glsl-a35d95d1.js"),[],import.meta.url));const aSt=.001953125,lSt=4e4,cSt=5e4;let fb=class extends R${constructor(e){super(e),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new oSt,this._maxOpacity=1,this._shadowDifference=.2,this._technique=e.techniques.acquire(aOe)}initialize(){this.addHandles([he(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??IMe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},qi),he(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??LMe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},qi),he(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=cR(e??$Me),this._updateMaxOpacity()},qi)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}render(e){const i=e.find(({name:n})=>n==="composite-color"),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;if(!this._technique.compiled)return this.requestRender(Vi.UPDATE),i;this._passParameters.highlight=e.find(({name:n})=>n==="highlights")?.getTexture(),this._passParameters.origin=r.camera.center;const s=this.renderingContext;return s.bindFramebuffer(i.fbo),s.bindTechnique(this._technique,r,this._passParameters),s.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-FO(lSt,cSt,e.relativeElevation);const r=this.viewingMode===Ne.Global?fe(bhe,e.center):te(bhe,0,0,1),s=pe(r,i);return this._passParameters.dayNightTerminator=FO(0,1,Te(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=aSt}};d([m()],fb.prototype,"produces",void 0),d([m()],fb.prototype,"consumes",void 0),d([m({constructOnly:!0})],fb.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],fb.prototype,"techniques",void 0),fb=d([U("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],fb);const bhe=C();let cOe=class extends xr{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function uSt(){const t=new Pi;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ei("drawPosition",(e,i)=>hSt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new ct("textureInput",e=>e.input)),t.fragment.uniforms.add(new ct("textureMask",e=>e.mask)),t.fragment.uniforms.add(new ct("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new tm("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new tm("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function hSt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;zd(t.magnifier.position,whe);const n=e.camera.screenToRender(whe,dSt),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Zr(pSt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const whe=ns(),dSt=r0e(),pSt=Yt(),fSt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:cOe,build:uSt},Symbol.toStringTag,{value:"Module"}));let uOe=class hOe extends Ni{initializeProgram(e){return new Fi(e.rctx,hOe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:qt})}};uOe.shader=new Oi(fSt,()=>ue(()=>import("./Magnifier.glsl-52c2e692.js"),[],import.meta.url));async function mSt(t){const e=ue(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=ue(()=>import("./overlay-svg-d838c8e3.js"),[],import.meta.url),r=w0((await e).default,{signal:t}),s=w0((await i).default,{signal:t}),n={mask:await r,overlay:await s};return yt(t),n}let Xy=class extends R${constructor(e){super(e),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new cOe,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=ns(),this._tmpRenderPoint=r0e()}initialize(){this.addHandles([he(()=>this.view.magnifier,e=>this._update(e),qi)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(he(()=>this._magnifier?.version,i)),i()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Tt(this._vao)}_disposeTextures(){this._passParameters.mask=Tt(this._passParameters.mask),this._passParameters.overlay=Tt(this._passParameters.overlay),this._passParameters.input=Tt(this._passParameters.input)}render(e){const i=this._validMagnifier,r=e.find(({name:v})=>v==="magnifier-color");if(i==null)return r;if(this._imageSources==null)return this.requestRender(Vi.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);if(this._vao??(this._vao=Om(s,BZ,di,0,1)),this._technique??(this._technique=this.techniques.acquire(uOe)),this._ensureTextureResources(s,o),!this._technique?.compiled||!this._passParameters.input)return this.requestRender(Vi.UPDATE),r;const a=Math.ceil(1/this._factor*o),l=this._passParameters.input;l.resize(a,a),zd(i.position,this._tmpScreenPoint);const c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,h=this.camera.fullHeight,p=.5*a,f=.5*a;c[0]=Te(c[0],p,u-p-1),c[1]=Te(c[1],f,h-f-1);const g=Math.floor(c[0]-p),_=Math.floor(c[1]-f);return s.bindFramebuffer(r.fbo),this._technique.program.bindTexture("textureInput",l),s.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,_,a,a,0),this._passParameters.magnifier=i,s.bindTechnique(this._technique,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(ui.TRIANGLE_STRIP,0,4),r}_loadResources(e){const{maskUrl:i,overlayUrl:r}=e;this._imageLoadTask?.maskUrl===i&&this._imageLoadTask?.overlayUrl===r||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:Tm(async s=>{const n=i==null||r==null?mSt(s):null,o=i!=null?w0(i,{signal:s}):n.then(l=>l.mask),a=r!=null?w0(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new $r;r.internalFormat=Pt.RGBA,r.wrapMode=hi.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!efe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new ur(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Pt.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new ur(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Pt.RGBA,r.flipped=!1,this._passParameters.input=new ur(e,r)}};d([m()],Xy.prototype,"produces",void 0),d([m()],Xy.prototype,"consumes",void 0),d([m()],Xy.prototype,"_imageSources",void 0),d([m()],Xy.prototype,"_imageLoadTask",void 0),d([m({constructOnly:!0})],Xy.prototype,"techniques",void 0),Xy=d([U("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],Xy);const $T={maxSearchSteps:8,maxDistanceAreaTex:16};function gSt(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("edgesTexture",e=>e.inputTexture),new ct("areaTexture",e=>e.areaTexture),new ct("searchTexture",e=>e.searchTexture)),t.fragment.code.add(x`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${x.int($T.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${x.int($T.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${x.int($T.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${x.int($T.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${x.int($T.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int($T.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const ySt=Object.freeze(Object.defineProperty({__proto__:null,build:gSt},Symbol.toStringTag,{value:"Module"}));let dOe=class pOe extends Ni{initializeProgram(e){return new Fi(e.rctx,pOe.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};dOe.shader=new Oi(ySt,()=>ue(()=>import("./BlendWeights.glsl-98c724a0.js"),[],import.meta.url));function _St(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("blendWeightsTexture",e=>e.inputTexture),new ct("colorTexture",e=>e.color)),t.fragment.code.add(x`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const vSt=Object.freeze(Object.defineProperty({__proto__:null,build:_St},Symbol.toStringTag,{value:"Module"}));let fOe=class mOe extends Ni{initializeProgram(e){return new Fi(e.rctx,mOe.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};fOe.shader=new Oi(vSt,()=>ue(()=>import("./Blur.glsl-a66b7045.js"),[],import.meta.url));const xhe={threshold:.05,localConstrastAdaption:2};function bSt(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(x`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${x.float(xhe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${x.float(xhe.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const wSt=Object.freeze(Object.defineProperty({__proto__:null,build:bSt},Symbol.toStringTag,{value:"Module"}));let gOe=class yOe extends Ni{initializeProgram(e){return new Fi(e.rctx,yOe.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:qt})}};gOe.shader=new Oi(wSt,()=>ue(()=>import("./EdgeDetect.glsl-d33da5e8.js"),[],import.meta.url));let xSt=class extends xr{},Zy=class extends R${constructor(e){super(e),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new xSt,this._edgeTechnique=e.techniques.acquire(gOe),this._blendTechnique=e.techniques.acquire(dOe),this._blurTechnique=e.techniques.acquire(fOe)}initialize(){this.addHandles([he(()=>this.isEnabled(),e=>e?this.enable():this.disable(),qi)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await ue(()=>import("./SMAAData-660b7d34.js"),[],import.meta.url);await this._loadTextures(i,e),this.requestRender(Vi.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){yt(i);const[r,s]=await Promise.allSettled([w0(e.areaTexture,{signal:i}),w0(e.searchTexure,{signal:i})]);if(yt(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=The(n,Zt.LINEAR,Pt.RGB,r.value),this._searchTexture=The(n,Zt.NEAREST,Pt.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=Tt(this._searchTexture),this._areaTexture=Tt(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(e){const i=e.find(({name:c})=>c==="aa-color");if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(Vi.UPDATE),i;const r=e.find(({name:c})=>c==="composite-color"),s=r.fbo.width,n=r.fbo.height,o=this.renderingContext;o.setViewport(0,0,s,n);const a=this.fboCache.acquire(s,n,"smaa edges",kr.RG);o.unbindTexture(a.fbo?.colorTexture),o.bindFramebuffer(a.fbo),o.setClearColor(0,0,0,1),o.clear(Sr.COLOR_BUFFER_BIT),this._smaaParameters.color=r.getTexture(),o.bindTechnique(this._edgeTechnique,null,this._smaaParameters),o.screen.draw();const l=this.fboCache.acquire(s,n,"smaa blend");return o.unbindTexture(l.fbo?.colorTexture),o.bindFramebuffer(l.fbo),o.setClearColor(0,0,1,1),o.clear(Sr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=a.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,o.bindTechnique(this._blendTechnique,null,this._smaaParameters),o.screen.draw(),a.release(),o.bindFramebuffer(i.fbo),o.setClearColor(0,1,0,1),o.clear(Sr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=l.getTexture(),o.bindTechnique(this._blurTechnique,null,this._smaaParameters),o.screen.draw(),l.release(),i}};function The(t,e,i,r){const s=new $r;return s.pixelFormat=i,s.wrapMode=hi.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new ur(t,s,r)}d([m()],Zy.prototype,"produces",void 0),d([m()],Zy.prototype,"consumes",void 0),d([m({constructOnly:!0})],Zy.prototype,"isEnabled",void 0),d([m({constructOnly:!0})],Zy.prototype,"techniques",void 0),d([m()],Zy.prototype,"_abortController",void 0),Zy=d([U("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Zy);let fK=class extends xr{constructor(){super(...arguments),this.opacity=1}};function TSt(t){const e=new Pi;return e.include(ra),e.fragment.uniforms.add(new ct("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ue("opacity",i=>i.opacity)),t.isDepthBlit&&(e.fragment.uniforms.add(new Ar("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.include(Cm),e.fragment.include(Ep)),e.fragment.code.add(x`
    void main() {
      ${t.isDepthBlit?x`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:x`
              fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}
    }`),e}const SSt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:fK,build:TSt},Symbol.toStringTag,{value:"Module"}));var xc;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(xc||(xc={}));let CO=class extends ol{constructor(){super(...arguments),this.alphaMode=xc.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}};d([B({count:xc.COUNT})],CO.prototype,"alphaMode",void 0),d([B()],CO.prototype,"hasOpacityFactor",void 0),d([B()],CO.prototype,"isDepthBlit",void 0);let mK=class _Oe extends Ni{initializeProgram(e){return new Fi(e.rctx,_Oe.shader.get().build(this.configuration),di)}initializePipeline(){switch(this.configuration.alphaMode){case xc.None:return Lt({colorWrite:qt});case xc.Alpha:return Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt});case xc.PremultipliedAlpha:case xc.COUNT:return Lt({blending:Ru(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}}};mK.shader=new Oi(SSt,()=>ue(()=>import("./Compositing.glsl-e212408f.js"),[],import.meta.url));let vOe=class extends xr{};function CSt(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("tex",e=>e.texture)),t.fragment.code.add(x`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const ESt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:vOe,build:CSt},Symbol.toStringTag,{value:"Module"}));let bOe=class wOe extends Ni{initializeProgram(e){return new Fi(e.rctx,wOe.shader.get().build(),di)}initializePipeline(){return Lt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};bOe.shader=new Oi(ESt,()=>ue(()=>import("./HUDCompositing.glsl-f803de5d.js"),[],import.meta.url));let xOe=class extends xr{};function ASt(){const t=new Pi;return t.include(ra),t.fragment.uniforms.add(new ct("colorTexture",e=>e.colorTexture),new ct("alphaTexture",e=>e.alphaTexture),new ct("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(x`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),t}const MSt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:xOe,build:ASt},Symbol.toStringTag,{value:"Module"}));let gK=class TOe extends Ni{initializeProgram(e){return new Fi(e.rctx,TOe.shader.get().build(),di)}initializePipeline(){return Lt({blending:Fo(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};gK.shader=new Oi(MSt,()=>ue(()=>import("./OITCompositing.glsl-489a9dc8.js"),[],import.meta.url));let PSt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new CO,this._passParameters=new fK,this._oitParameters=new xOe,this._hudParameters=new vOe}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._techniques.acquire(gK);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.acquire(bOe);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}composite(e,i,r=xc.None,s=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.acquire(mK,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}blitDepthToLinearDepth(e,i){this._configuration.isDepthBlit=!0,this.composite(e,i),this._configuration.isDepthBlit=!1}};const OSt=1e4,MW=100,RSt=500,$St=500,ISt=.1;function LSt(t,e,i){return BJ(e,t)*(i[1]-i[0])+i[0]}function DSt(t,e,i){let r=0;if(!e.some(n=>!!n.materialReference&&(r+=n.numGeometries,r>=OSt)))return jSt.compute(t,e);const s=G$();return i.forAll(n=>GC(s,NSt(t,n))),s}function NSt(t,e){if(!e.visible)return;const i=G$(),r=e.getSpatialQueryAccelerator();return r?FSt(i,t,r):kSt(i,t,e.objects),i}function FSt(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<RSt)PR(dh,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,Zd.DepthOrder.FRONT_TO_BACK,dh,(l,c)=>{PW(t,e,l),dh.far=t.near,c.setRange(dh)},n,o),PR(dh,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,Zd.DepthOrder.BACK_TO_FRONT,dh,(l,c)=>{PW(t,e,l),dh.near=t.far,c.setRange(dh)},n,o);else{const l=Math.max(Math.min(a,$St),Math.ceil(a*ISt)),c=i.findClosest(s,Zd.DepthOrder.FRONT_TO_BACK,n,o,l),u=i.findClosest(s,Zd.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(She(t,e,c.boundingVolumeWorldSpace.bounds),She(t,e,u.boundingVolumeWorldSpace.bounds))}}function kSt(t,e,i){IT.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&IT.add(r)}),IT.empty||(IT.sort(e),PR(dh,e.near,Math.min(t.near,e.far)),IT.forEachInDepthRange(dh,Zd.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&PW(t,e,r)}),PR(dh,Math.max(t.far,e.near),e.far),IT.forEachInDepthRange(dh,Zd.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function PW(t,e,i){if(!i.visible||!C_(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=GSt;i.geometries.forEach(n=>{Ai(s,r,n.transformation);const o=mC(s);SOe(t,e,n.boundingInfo,s,o)})}function SOe(t,e,i,r,s){if(i==null)return;Ve(qa,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(qa[0]-n[0])+o[1]*(qa[1]-n[1])+o[2]*(qa[2]-n[2]);if(qa[3]=i.radius*s,!(a-qa[3]>t.near&&a+qa[3]<t.far)&&C_(e.frustum,qa))if(i.radius>MW&&i.getChildren())for(const l of i.getChildren())SOe(t,e,l,r,s);else OW.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function She(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let USt=class{constructor(){this._items=new Gt({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===Zd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},zSt=class{constructor(){this._view=xe(),this._viewProj=xe(),this._frustum=uR(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),tn(this._view,e.viewMatrix),Ai(this._viewProj,e.projectionMatrix,this._view),F4(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(p=>{p.materialReference&&p.forEachGeometry&&p.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;const g=f.boundingSphere,_=s*g[0]+n*g[1]+o*g[2]+a,v=_-g[3],b=_+g[3];this._geometries.push(f),this._near.push(-b),this._far.push(-v)})});const l=new hK;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,h=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[h++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,f)=>this._near[p]<this._near[f]?-1:this._near[p]>this._near[f]?1:0),this._farCandidates.sort((p,f)=>this._far[p]<this._far[f]?1:this._far[p]>this._far[f]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const f=this._nearCandidates[p];if(this._near[f]<l.near){const g=this._geometries[f],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const f=this._farCandidates[p];if(this._far[f]>l.far){const g=this._geometries[f],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const s=e.center;Ve(qa,s,i);const n=mC(i),o=qa[0],a=qa[1],l=qa[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const h=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=h+c;if(!(-(h-c)<2||-p>=r.near))if(-p>this._looseRange.near)r.near=-p;else{if(c>MW){const f=e.getChildren();if(f!==void 0){for(const g of f)this._includeNearBoundingInfoRec(g,i,r);return}}OW.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let s=e.radius;const n=e.center;Ve(qa,n,i);const o=mC(i),a=qa[0],l=qa[1],c=qa[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const h=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-h<=r.far))if(-h<this._looseRange.far)r.far=-h;else{if(s>MW){const p=e.getChildren();if(p!==void 0){for(const f of p)this._includeFarBoundingInfoRec(f,i,r);return}}OW.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},BSt=class{constructor(){this._modelViewProj=xe(),this._clipPosition=[Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;Ai(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],h=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*h+o[8]*p+o[12],c[1]=o[1]*u+o[5]*h+o[9]*p+o[13],c[2]=o[2]*u+o[6]*h+o[10]*p+o[14],c[3]=o[3]*u+o[7]*h+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=VSt(this._clipPosition[w6[l][0]],this._clipPosition[w6[l][1]],this._clipPosition[w6[l][2]]);let u=!0;for(let h=0;h<c.length;++h)if(c[h][3]>=2){u=!1;break}if(!u){a=!0;for(let h=0;h<c.length;++h){const p=c[h][3];Number.isFinite(p)&&(e.near=Math.min(p,e.near),e.far=Math.max(p,e.far))}}}return a}};function VSt(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];b6(l,s)?(b6(a,s)||r.push(Che(a,l,s)),r.push(l)):b6(a,s)&&r.push(Che(a,l,s))}}return r}function b6(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void at(!1)}function Che(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),kX(Yt(),t,e,r)}const w6=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],qa=Ws(),GSt=xe(),dh=G$(),IT=new USt,jSt=new zSt,OW=new BSt;let HSt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Ma(new ArrayBuffer(4)),this._layerToOidToColor=new uv,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new uv,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return kt(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Ma(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:n})}return e}};var y_,Wb;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(y_||(y_={})),function(t){t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color"}(Wb||(Wb={}));let COe=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var jC;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(jC||(jC={}));let EOe=class extends COe{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},qSt=class extends EOe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=jC.COLOR}},Ehe=class extends EOe{constructor(){super(...arguments),this.type=jC.DEPTH}};function WSt(t){return t?.attachment.type===v0.Texture}let AOe=class extends COe{constructor(e,i,r,s,n,o){super(e,o),this.type=jC.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get name(){return this._name}setName(e){this._name=e}getTexture(e=En.COLOR_ATTACHMENT0){return e===MC?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}getAttachment(e=En.COLOR_ATTACHMENT0){return e===MC?this._depth:this._colors.get(e)}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=Xt(this._depth)}obtainDepthTexture(){const e=this._depth;return WSt(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){return e.retain(),this.detachColor(i),this.fbo?.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i?.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},x6=class{constructor(e,i){this._last=new Gt,this._incarnation=0,this._cache=new B$(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new Gt:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}},YSt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new x6(e.newCache,"FBOCache"),this._depthCache=new x6(e.newCache,"DepthAttachmentCache"),this._colorCache=new x6(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===jC.FBO&&e(i.name,i.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+("getTexture"in i?i.getTexture()?.usedMemory??0:i.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=kr.RGBA){const n=T6(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([En.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(a)}else o=new AOe(n,r,new $m(this.rctx,{...Ahe[s],width:e,height:i}),a=>{a??(a=co.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=kr.RGBA);const c=this._acquireColor(l,e,i,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=T6(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===co.DEPTH_STENCIL_TEXTURE?new Ehe(n,new ur(this.rctx,{...Mhe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Ehe(n,new Jwe(this.rctx,{...Mhe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=T6(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new qSt(n,new ur(this.rctx,{...Ahe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const OR=new AOe("default","default",null,()=>OR,()=>OR,()=>{});function T6(t,e,i){return`${t}x${e}x${i}`}const YN=new $r;YN.pixelFormat=Pt.RED,YN.internalFormat=ut.R8,YN.wrapMode=hi.CLAMP_TO_EDGE;const XN=new $r;XN.pixelFormat=Pt.RG,XN.internalFormat=ut.RG8,XN.wrapMode=hi.CLAMP_TO_EDGE;const ZN=new $r;ZN.internalFormat=ut.RGBA4,ZN.dataType=Pa.UNSIGNED_SHORT_4_4_4_4,ZN.wrapMode=hi.CLAMP_TO_EDGE;const MOe=new $r;MOe.wrapMode=hi.CLAMP_TO_EDGE;const EP=new $r;EP.wrapMode=hi.CLAMP_TO_EDGE,EP.samplingMode=Zt.LINEAR_MIPMAP_LINEAR,EP.hasMipmap=!0,EP.maxAnisotropy=8;const AP=new $r;AP.pixelFormat=Pt.RED,AP.dataType=Pa.HALF_FLOAT,AP.internalFormat=ut.R16F,AP.samplingMode=Zt.NEAREST;const JN=new $r;JN.dataType=Pa.HALF_FLOAT,JN.internalFormat=ut.RGBA16F,JN.samplingMode=Zt.NEAREST;const Ahe={[kr.RED]:YN,[kr.RG]:XN,[kr.RGBA4]:ZN,[kr.RGBA]:MOe,[kr.RGBA_MIPMAP]:EP,[kr.R16F]:AP,[kr.RGBA16F]:JN},MP=new $r;MP.pixelFormat=Pt.DEPTH_STENCIL,MP.dataType=Pa.UNSIGNED_INT_24_8,MP.samplingMode=Zt.NEAREST,MP.wrapMode=hi.CLAMP_TO_EDGE;const Mhe={[co.DEPTH_STENCIL_TEXTURE]:MP,[co.DEPTH16_BUFFER]:new Zwe(Wo.DEPTH_COMPONENT16,4)};var RR;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(RR||(RR={}));let ig=class{constructor(e,i,r=RR.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new Gt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===n&&l.configuration.transparencyPassType===Qe.NONE||(s.bindTechnique(l,i,e),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,p=h.length;if(c.indexType!==0){const f=QN.get(c.indexType);for(let g=0;g<p;g+=2){const _=h[g],v=h[g+1];s.drawElements(u.primitiveType,v,c.indexType,_*f)}}else for(let f=0;f<p;f+=2){const g=h[f],_=h[f+1];s.drawArrays(u.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===RR.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const QN=new Map;QN.set(dt.UNSIGNED_BYTE,1),QN.set(dt.UNSIGNED_SHORT,2),QN.set(dt.UNSIGNED_INT,4);let RW=class extends nQe{constructor(){super({}),this._passes=null,this.produces=new Map([[ye.OPAQUE_MATERIAL,e=>this._produces(e)],[ye.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[ye.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new sat,this._shadowPassParameters=new nat,this._highlightPassParameters=new oat,this._viewshedPassParameters=new aat,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new ig(i,r),materialTransparent:new ig(i,r,RR.BackToFront),materialIntegratedMesh:new ig(i,r),shadowMap:new ig(i,r),highlight:new ig(i,r),highlightIntegratedMesh:new ig(i,r),highlightShadowMap:new ig(i,r),viewshedShadowMap:new ig(i,r),defaultShadowMap:new ig(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===V.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==V.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===V.Shadow||e.output===V.ShadowHighlight||e.output===V.ShadowExcludeHighlight?this._shadowPassParameters:e.output===V.ViewshedShadow?this._viewshedPassParameters:e.output===V.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===ye.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,s)=>r.dispatch(s,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case ye.OPAQUE_MATERIAL:switch(e.output){case V.Color:case V.Depth:case V.Normal:case V.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case V.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case V.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case V.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case V.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters);case V.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case ye.TRANSPARENT_MATERIAL:switch(e.output){case V.Color:case V.Depth:case V.Normal:case V.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case ye.INTEGRATED_MESH:switch(e.output){case V.Color:case V.Depth:case V.Normal:case V.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case V.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new hK;return this._systems.forEach(r=>GC(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;te(S6,s[3],s[7],s[11]),C6.set(S6),ae(i.transformWorldFromViewTH,C6.high),ae(i.transformWorldFromViewTL,C6.low),ae(i.slicePlaneLocalOrigin,S6),$u(i.transformViewFromCameraRelativeRS,e.viewMatrix),tn(i.transformProjFromView,e.projectionMatrix),i.identifier===Xa.Material&&(this._materialPassParameters.transparent=r,mx(Phe,i.transformViewFromCameraRelativeRS),c$(i.transformNormalViewFromGlobal,Phe))}};RW=d([U("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],RW);const S6=C(),Phe=yr(),C6=new qPe;function jL(t){return t.name}let XSt=class{constructor(e){this._context=e,this._nodes=new Gt}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),D4&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),D4&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.required.includes(e)&&l===n?1:0),0),0)}optional(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.optional?.includes(e)&&l===n?1:0),0),0)}updateAnimation(){return this._nodes.reduce((e,i)=>i.updateAnimation()||e,!1)}render(e,i,r=()=>{}){const s=jL(e)?e.name:e,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0||(n.forEach(o=>{const a=jL(e)?[e]:[];for(const l of o.consumes.required){if(l===s)continue;const c=i.get(l);if(!c)return void(r&&r(a));a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=i.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(jL(e)?(e.release(),e=l,i.set(s,e)):e=l)}catch(l){le.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState()),jL(e)?e:OR}},ZSt=class{constructor(e){this._context=e,this._renderPlugins=new Gt,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=Jf(0);for(let i=0;i<ye.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),vi();this._renderPlugins.push(e),e.materialReference&&this._materialRenderers.set(e.materialReference,e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},s=e.initializeRenderContext(this._context,i);if($c(s))return s.then(r);r()}remove(e){if(e.materialReference!=null&&this._materialRenderers.delete(e.materialReference),this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(...e){for(const i of e)this._context.renderContext.bindParameters.slot=i,this._slots[i].forEach(r=>{r.produces.get(i)?.(V.Color)&&(Q9(r)&&r.prepareTechnique(this._context.renderContext),tne(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(){const e=this._context.renderContext.bindParameters.slot,i=this._context.renderContext.output??V.Color,r=new Map;return this._slots[e].forEach(s=>{if(s.produces.get(e)?.(i)&&(!s.isDecoration||this._context.renderContext.bindParameters.decorations!==Ka.OFF))if(Q9(s)){const o=s.prepareTechnique(this._context.renderContext);o!=null&&r.set(s,o)}else if(tne(s)){const o=s.prepareTechniques(this._context.renderContext);o!=null&&r.set(s,o)}else r.set(s,null)}),r}render(e,...i){for(const r of i)this._context.renderContext.bindParameters.slot=r,this._getRenderables().forEach((s,n)=>n.renderNode(this._context.renderContext,s,e))}queryDepthRange(e){const i=new hK;return this._renderPlugins.forAll(r=>{const s=r.queryDepthRange?.(e);GC(i,s)}),i}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){for(const r of i)if(this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))return!0;return!1}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}getMaterialRenderer(e){return this._materialRenderers.get(e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(this._materialRenderers.delete(e.materialReference),e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,ki.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.materialReference!==null?e:e+(i.usedMemory??0),0)}get test(){}},JSt=class{constructor(e){this.techniques=e,this._blitConfiguration=new CO,this._blitParameters=new fK}render(e,i,r,s,n){e.bindFramebuffer(r.fbo);const o=this.techniques.acquire(mK,this._blitConfiguration);return e.setClearColor(0,0,0,1),e.clear(Sr.COLOR_BUFFER_BIT),o?.compiled?(this._blitParameters.texture=i.getTexture(),e.bindTechnique(o,s,this._blitParameters),e.screen.draw(),o.release(),r):(n(Vi.UPDATE),r)}},QSt=class{constructor(){this._step=$he,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,se("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=Ohe+e2t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Ohe?t2t:1}const r=Te(e/KSt,$he,r2t);this._step===1/0?this._step=r:this._step=this._step*Rhe+r*(1-Rhe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const KSt=.5,Ohe=12e4,e2t=1e4,t2t=10,Rhe=.9,i2t=30,$he=1e3/1,r2t=1e3/i2t;let s2t=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4,this._clearColor=Yt()}dispose(){this._color=Xt(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=r===Ld.Default;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,Bb(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),Ch(this._clearColor,i),n}releaseBuffers(){this._color?.detachDepth(),this._depth=Xt(this._depth)}renderHUDVisibility(e,i,r){return e?.fbo?.width===this._width&&e?.fbo?.height===this._height||(e?.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",kr.RGBA4)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(n2t),i(),e.detachDepth(),e}compositeToHUDVisibility(e,i){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let s,n;const{_width:o,_height:a}=this;switch(i){case Qe.ColorAlpha:s=this._fbos.acquire(o,a,r?"oit hud color alpha":"oit color alpha",kr.RGBA16F),s.acquireColor(En.COLOR_ATTACHMENT1,kr.R16F),n=[0,0,0,1];break;case Qe.FrontFace:s=this._fbos.acquire(o,a,r?"oit hud front":"oit front"),n=[0,0,0,0]}return r?s.acquireDepth(co.DEPTH16_BUFFER):s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.clearFramebuffer(n,r,r),e(),s.detachDepth(),s}compositeToFramebuffer(e,i,r,s){this.bindFbo(),this.compositingHelper.composite(e,i,r,s)}compositeOIT(e,i,r,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(Sr.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.getTexture(),i.getTexture(En.COLOR_ATTACHMENT1),r.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,s,n=kr.RGBA,o=co.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){return e?.fbo?.width===a&&e?.fbo?.height===l||(e=Xt(e)),e=e??this._fbos.acquire(a,l,i,n),c?.forEach(u=>e.acquireColor(u.attachment,u.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(s,!0,!0),r(),e}renderToTargets(e,i,r,s,n=!1,o=!1){this._bindTarget(i,r),this._fbos.rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT|Sr.STENCIL_BUFFER_BIT)}}_bindTarget(e,i){e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(co.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const n2t=[0,1,0,1];let o2t=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}};const Mz=255,a2t=1/Mz;function l2t(t){const e=new Pi,i=e.fragment;return i.include(Ep),i.include(Cm),e.include($$),e.include(ra),e.include(D$,t),i.uniforms.add(new ct("shadowMap",(r,s)=>s.shadowMap.depthTexture),new ct("depthMap",(r,s)=>s.depth?.attachment),new Gr("inverseViewMatrix",(r,s)=>Is(Ihe,Aa(Ihe,s.camera.viewMatrix,s.camera.center)))),i.constants.add("sampleValue","float",a2t),e.outputs.add("sampleCount","float"),i.code.add(x`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const Ihe=xe(),c2t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:Mz,build:l2t},Symbol.toStringTag,{value:"Module"}));var HC;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(HC||(HC={}));let $W=class extends ol{constructor(){super(...arguments),this.visualization=HC.Gradient,this.bandsEnabled=!1}};d([B({count:HC.COUNT})],$W.prototype,"visualization",void 0),d([B()],$W.prototype,"bandsEnabled",void 0);let POe=class extends xr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=n$(u2t),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const u2t=kt(.01,0,.25,1);function h2t(t){const e=new Pi,i=e.fragment;i.include(Ep),i.include(UZ),e.include($$),e.include(ra);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",Mz),i.uniforms.add(new ct("shadowCastMap",a=>a.shadowCastMap),new Ue("sampleScale",a=>a.sampleScale),new Ue("opacityFromElevation",a=>a.opacityFromElevation),new Ei("uColor",a=>a.color));const n=r===HC.Gradient,o=r===HC.Threshold;return n&&s?i.uniforms.add(new Ue("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Ue("threshold",a=>a.threshold)),i.code.add(x`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?x`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
    }
  `),e}const d2t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:POe,build:h2t},Symbol.toStringTag,{value:"Module"}));let OOe=class ROe extends Ni{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,ROe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:Ac,colorWrite:qt,depthTest:null,depthWrite:null})}get primitiveType(){return ui.TRIANGLE_STRIP}};OOe.shader=new Oi(d2t,()=>ue(()=>import("./ShadowCastVisualize.glsl-ef0739de.js"),[],import.meta.url));const p2t=4e4,f2t=5e4,$Oe=1/512;let KN=class extends Pe{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new POe(this._data),this._techniqueConfig=new $W,this._enabled=!1,this._vao=Om(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Tt(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(OOe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,Qg(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>$Oe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;y2(e,i)||(Ch(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],KN.prototype,"opacityFromElevation",null),KN=d([U("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],KN);let IOe=class LOe extends Ni{constructor(e){super(e,new pK,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,LOe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({blending:Fo(Ee.ONE,Ee.ONE,Ee.ONE,Ee.ONE),colorWrite:qt,depthTest:null,depthWrite:null})}get primitiveType(){return ui.TRIANGLE_STRIP}};IOe.shader=new Oi(c2t,()=>ue(()=>import("./ShadowCastAccumulate.glsl-7bebf9d4.js"),[],import.meta.url));let Sl=class extends Pe{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new QJ,this._cachedLightDirections=[],this._depthRange=TW,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new zU(new yQ(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=Om(this._rctx),this._accumulationRenderer=new KN(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(wt.SHADOW_ACCUMULATOR,this),he(()=>r.renderView,l=>{this.removeHandles(Lhe),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Lhe)},qi),he(()=>this._previewing,()=>this._requestRenderIfEnabled(),Ji)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Tt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Tt(this._fbo),this._vao=Tt(this._vao),this._accumulationTechniqueCached=Xt(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new IOe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==TW&&this._opacityFromElevation>$Oe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(s0(i,e,Rw))return;const r=Math.min(Mz,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ae(i[s]??C(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(m2t,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),n>0}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Pt.RGBA,Pa.UNSIGNED_BYTE,Dhe),Dhe[0]/this._progress)}_enable(){this._progress=0;const e=new $r;e.pixelFormat=Pt.RED,e.internalFormat=ut.R8,e.wrapMode=hi.CLAMP_TO_EDGE,this._fbo=new $m(this._rctx,e),this._requestRender()}_disable(){this._fbo=Tt(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Sr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Qg(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-FO(p2t,f2t,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};d([m()],Sl.prototype,"_progress",void 0),d([m()],Sl.prototype,"_sampleCount",void 0),d([m()],Sl.prototype,"_fbo",void 0),d([m()],Sl.prototype,"_depthRange",void 0),d([m()],Sl.prototype,"_previewing",void 0),d([m()],Sl.prototype,"_accumulationRenderer",void 0),d([m()],Sl.prototype,"_isRefining",null),d([m()],Sl.prototype,"_isActive",null),d([m()],Sl.prototype,"canAccumulate",null),d([m()],Sl.prototype,"_isDoneAccumulating",null),d([m()],Sl.prototype,"_opacityFromElevation",null),d([m()],Sl.prototype,"running",null),Sl=d([U("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Sl);const m2t=6,Lhe="renderView",Dhe=new Uint8Array(4),Nhe=$0();let g2t=class{constructor(){this._plane=$0()}get isEnabled(){return!f1e(this.plane,Nhe)}get plane(){return this._plane}set plane(e){yx(e||Nhe,this._plane)}},Jy=class extends br{constructor(){super(...arguments),this.sectionAngles=Yt()}get sectionAnglesDeg(){return XO(this.sectionAngles.map(e=>ea(e)))}set sectionAnglesDeg(e){this.sectionAngles=XO(e.map(i=>xt(i)))}get projectionMatrix(){const e=xe();return WO(e,this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const e=this.sectionAngles[0],i=this.sectionAngles[1],r=this.sectionAngles[2],s=this.sectionAngles[3];at(e<=i),at(r<=s);const n=2*Math.tan(this.fovX/2),o=2*Math.tan(this.fovY/2),a=Math.tan(e),l=Math.tan(i),c=Math.tan(r),u=l-a,h=Math.tan(s)-c,p=n/u,f=o/h,g=-(a+u/2)/n*2,_=-(c+h/2)/o*2,v=xe();ux(v,[g,_,0]);const b=xe();W0e(b,[p,f,1]);const w=xe();return WO(w,b,v)}get _sectionRatioX(){const e=Math.tan(this.sectionAngles[0]),i=Math.tan(this.sectionAngles[1]),r=2*Math.tan(this.fovX/2);return Math.min(1,(i-e)/r)}setViewport(e,i){const r=i*this._sectionRatioX;return this.viewport=[e[0],e[1],r,i],r}};d([m()],Jy.prototype,"sectionAngles",void 0),d([m()],Jy.prototype,"sectionAnglesDeg",null),d([m()],Jy.prototype,"projectionMatrix",null),d([m()],Jy.prototype,"sectionMatrix",null),d([m()],Jy.prototype,"_sectionRatioX",null),Jy=d([U("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],Jy);let y2t=class{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(e){return e?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(e){return Math.ceil(e/this.textureSizeMultiple)*this.textureSizeMultiple}};const E6=["front","left","right","back","top","bottom"];function _2t(t){return!["top","bottom"].includes(t)}let v2t=class{constructor(e){this._fbos=e,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new y2t,this._maxTextureWidth=Math.min(se("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}get depthTexture(){return this._handle?.getTexture()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get isTextureZero(){return this._textureWidth===0||this._textureHeight===0}get nearFar(){const e=this.faces;return e.length===0?null:e[0].nearFar}get numActiveFaces(){const e=this._faces;let i=0;return Object.keys(e).forEach(r=>{e[r]&&(i+=1)}),i}get faces(){const e=this._faces,i=[];for(const r of E6){const s=e[r];s&&i.push(s)}return i}get atlasRegions(){return this.faces.map(e=>[e.x/this._textureWidth,(e.x+e.width)/this._textureWidth,e.y/this._textureHeight,(e.y+e.height)/this._textureHeight])}get viewshedProjectionMatrices(){return this.faces.map(e=>e.projectionMatrix)}get viewshedViewMatrices(){return this.faces.map(e=>e.viewMatrix)}_setupFaceCamera(e,i,r,s){const{observerRenderSpace:n,tiltedUpVector:o,targetRenderSpace:a,farDistanceRenderSpace:l,horizontalFieldOfView:c,verticalFieldOfView:u}=i,h=C();yi(h,a,n);const p=C(),f=C(),g=(k,N)=>{const j=C(),z=xe();return Bl(z,k,N),Ve(j,h,z),me(j,n,j),j};let _,v=o;const b=Math.min(90,c),w=Math.min(90,Math.max(0,(c-90)/2));let T=-45,S=45,A=-45,P=45;if(_2t(e)){const k=N=>Te(N,-45,45);A=k(-u/2)-this.settings.toleranceBottomTop,P=k(+u/2)+this.settings.toleranceBottomTop}switch(e){case"front":_=a,T=-b/2,S=b/2;break;case"left":_=g(Math.PI/2,o),T=45-w;break;case"right":_=g(-Math.PI/2,o),S=-45+w;break;case"top":_=me(p,n,o),v=Yn(f,h);break;case"bottom":_=yi(p,n,o),v=h;break;case"back":_=g(Math.PI,o)}const R=new Jy({center:_,eye:n,up:v,far:l});R.sectionAnglesDeg=[T-this.settings.toleranceSides,S+this.settings.toleranceSides,A,P],R.fovY=Math.PI/2;const F=R.setViewport(r,s);return this._faces[e]=R,F}_bindFBO(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_computeActiveFaces(e){const i=new Set,{horizontalFieldOfView:r,verticalFieldOfView:s}=e,n=-s/2,o=s/2;return r===0||s===0||(n<=45&&o>=-45&&i.add("front"),r>90&&(i.add("left"),i.add("right")),r>270&&i.add("back"),o>45-this.settings.toleranceBottomTop&&i.add("top"),n<-45+this.settings.toleranceBottomTop&&i.add("bottom")),i}_computeBaseTextureSize(e,i,r,s){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,o=this.settings.textureSizeModifier(r),a=N_(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*o)),l=Math.floor(this._maxTextureWidth/s),c=Math.min(l,a);return Iwe(c)}_ensureFBO(){const e=this._textureWidth,i=this._textureHeight;this._handle?.fbo?.width===e&&this._handle?.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(e,i,"viewshed shadow map",kr.RGBA4)),this._handle.acquireDepth(co.DEPTH16_BUFFER)}clearFBO(){const e=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),e.setClearColor(1,1,1,1),e.clear(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=Xt(this._handle)}start(e,i,r,s){if(this._faces={},!this.enabled)return!1;const n=this._computeActiveFaces(i),o=n.size;if(o===0)return!1;const a=this._computeBaseTextureSize(e,s,r,o);if(a===0)return!1;let l=0,c=0,u=0;return E6.filter(h=>n.has(h)).forEach(h=>{const p=b2t(h,o);p>c&&(u=Math.max(u,l),l=0),c=p;const f=p*a;l+=this._setupFaceCamera(h,i,[l,f],a)}),u=Math.max(u,l),this._textureWidth=this.settings.textureResizeModulo(u),this._textureHeight=w2t(o)*a,this.clearFBO(),!0}finish(){this._handle?.detachDepth()}get test(){return{faces:this._faces,faceTypes:E6}}};function b2t(t,e){if(e<4)return 0;const i=t==="front"||t==="left";return e===4?i?0:1:i||t==="right"?0:1}function w2t(t){return t<4?1:2}let x2t=class extends xr{constructor(){super(...arguments),this.localOrigin=bY()}};function T2t(t){t.include($$),t.fragment.uniforms.add(new Gr("inverseViewMatrix",(e,i)=>{const r=xe();return Aa(r,i.camera.viewMatrix,e.localOrigin),vv(r,r)})),t.fragment.code.add(x`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}let DOe=class extends x2t{constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=Cr.flat(),this.viewMatrices=Cr.flat()}};function S2t(t){const e=new Pi,i=e.fragment;e.include(ra),e.include(T2t),e.include(HZ),i.include(Cm),i.include(XJ),i.uniforms.add(new ct("depthTexture",(s,n)=>n.depth?.attachment)),i.uniforms.add(new Gr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Gr("inverseViewNormalMatrix",(s,n)=>vv(C2t,n.camera.viewInverseTransposeMatrix))),i.uniforms.add(new Rt("viewshedTargetVector",(s,n)=>s.targetVector),new Rt("viewshedUpVector",(s,n)=>s.upVector),new Ar("viewshedFOVs",(s,n)=>s.fovs),new Ar("viewshedHeadingAndTilt",(s,n)=>s.headingAndTilt),new Ar("viewshedNearFar",(s,n)=>s.shadowMap.nearFar??[1,100])),i.uniforms.add(new ct("viewshedShadowMap",s=>s.shadowMap.depthTexture),new T7("viewshedProjectionMatrices",(s,n)=>s.projectionMatrices,6),new T7("viewshedViewMatrices",(s,n)=>s.viewMatrices,6),new wE("viewshedNumFaces",(s,n)=>s.shadowMap.numActiveFaces),new el("viewshedAtlasRegions",(s,n)=>s.shadowMap.atlasRegions.flat(),24)),i.constants.add("visibleColor","vec4",[0,1,0,.5]),i.constants.add("occludedColor","vec4",[1,0,0,.5]);const r=t.useNormalMap;return r?(i.uniforms.add(new ct("normalMap",(s,n)=>s.normalTexture)),i.code.add(x`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):e.include(oOe),i.code.add(x`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${r?x`vec3 normal = normalFromTexture();`:x`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),e}const C2t=xe(),E2t=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:DOe,build:S2t},Symbol.toStringTag,{value:"Module"}));let NOe=class FOe extends Ni{initializeProgram(e){return new Fi(e.rctx,FOe.shader.get().build(this.configuration),di)}initializePipeline(){return Lt({colorWrite:qt,blending:Ac})}};NOe.shader=new Oi(E2t,()=>ue(()=>import("./Viewshed.glsl-0a2179ff.js"),[],import.meta.url));let kOe=class extends ol{constructor(){super(...arguments),this.useNormalMap=!0}};d([B()],kOe.prototype,"useNormalMap",void 0);let mb=class extends iJ{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(e,i){super(e),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new DOe,this._configuration=new kOe,this._viewsheds=new lt,this.produces=new Map([[ye.VIEWSHED,()=>!0]]),this._renderShadowMap=i}initialize(){this.addHandles(he(()=>this.view.qualitySettings.maximumPixelRatio,e=>this._maximumPixelRatio=e,qi))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?tJ:VU}initializeRenderContext(e){this._pluginContext=e,this._viewshedShadowMap=new v2t(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(e,i,r){const{bindParameters:s,rctx:n}=e;if(!this.enabled||!s.depth||r==null)return;const o=this._setupNormals(r);if(this._technique!=null&&this._configuration.useNormalMap===o||(this._configuration.useNormalMap=o,this._technique=this._pluginContext?.techniques.acquire(NOe,this._configuration)),this._technique?.compiled)for(const a of this._viewsheds){const l=e.rctx.getBoundFramebufferObject(),c=this._renderViewshedShadowCubeMap(s,a),u=this._viewshedShadowMap;c&&u.depthTexture!=null&&!u.isTextureZero&&(this._setPassParameters(a),e.rctx.bindFramebuffer(l),n.bindTechnique(this._technique,s,this._parameters),n.screen.draw())}else this._pluginContext?.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=Oe(this._technique)}updateViewsheds(e){const i=e.removes;i!=null&&(lt.isCollection(i)?this._viewsheds.removeMany(i):this._viewsheds.remove(i));const r=e.adds;if(r!=null)if(lt.isCollection(r)){const s=r.filter(n=>!this._viewsheds.includes(n));this._viewsheds.addMany(s)}else this._viewsheds.includes(r)||this._viewsheds.add(r)}_renderViewshedShadowCubeMap(e,i){const r=this._viewshedShadowMap;if(!r.enabled)return!1;const s=r.start(e.camera,i,this.renderHighQuality,this._maximumPixelRatio);if(s)for(const n of r.faces)this._renderShadowMap(e,n,V.ViewshedShadow);return r.finish(),s}_setPassParameters(e){const i=this._parameters,r=this._viewshedShadowMap,s=e.observerRenderSpace;i.localOrigin=s,i.fovs=[xt(e.horizontalFieldOfView),xt(e.verticalFieldOfView)],i.headingAndTilt=[xt(e.heading),xt(e.tiltParallelToSurface)],i.upVector=e.tiltedUpVector;const n=A2t(e.targetRenderSpace,s);i.targetVector=n,i.shadowMap=r;const o=[],a=[];for(let l=0;l<r.numActiveFaces;l++)Aa(A6,r.viewshedViewMatrices[l],s),o.push(...A6.flat()),M2t(r.viewshedProjectionMatrices[l],A6,Fhe),a.push(...Fhe.flat());i.viewMatrices=o,i.projectionMatrices=a}_setupNormals(e){const i=e.get("normals"),r=i?.getTexture();return this._parameters.normalTexture=r,r!=null}get test(){return{viewsheds:this._viewsheds}}};function A2t(t,e){const i=C();return yi(i,t,e)}function M2t(t,e,i){const r=Ce(.5,.5,.5);return ux(i,r),E0(i,i,r),WO(i,i,t),WO(i,i,e),i}d([m()],mb.prototype,"_pluginContext",void 0),d([m()],mb.prototype,"fboCache",void 0),d([m()],mb.prototype,"view",void 0),d([m()],mb.prototype,"viewshedShadowMap",null),mb=d([U("esri.views.3d.webgl-engine.lib.Viewshed")],mb);const A6=xe(),Fhe=xe();let khe=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},xg=!1;function P2t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new khe(()=>t.createQuery(),r=>{t.deleteQuery(r),xg=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{xg||(xg=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),xg=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new khe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),xg=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{xg||(xg=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),xg=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function O2t(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new R2t(i,e)}let R2t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){xg||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var ys;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.LASER_LINES="laser lines",t.VIEWSHED="viewshed",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(ys||(ys={}));const M6=Object.values(y_).concat(Object.values(Wb)).concat(Object.values(ys)),Uhe="Total";let $2t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Gg(Uhe),this._cpuTimeSamplers=new Map(M6.map(i=>[i,new Gg(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Gg("GPU"),this._gpuTimeSamplers=new Map(M6.map(i=>[i,new Gg(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...M6,Uhe];this._gpuTimerPool=O2t(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Tt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(ys.FINISH);this._gpuTimeSamplers.get(ys.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class eF{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=a=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=kt(0,0,0,1),this._sliceHelper=new g2t,this._blit=null,this._state=Jf(gi.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=va.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new QSt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=Jf(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new o2t,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new YSt(s),this._renderStateFeatures=Jf(kne(!se("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new s2t(this.fboCache,this._compositingHelper),this.performanceInfo=new $2t(this._rctx),this._shadowMap=new yQ(this.fboCache,e.viewingMode),this._viewshed=new mb({fboCache:this.fboCache,view:e.view},(a,l,c)=>{l.setGLViewport(this._rctx);const{camera:u,contentCamera:h}=a;this._ensureBindParametersCamera(l,l),this._renderAllGeometry(c),this._ensureBindParametersCamera(u,h),a.camera.setGLViewport(this._rctx)}),this._shadowAccumulator=new Sl(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const u=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,u),this._renderShadowCascades(V.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new Ilt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new XSt(this._renderContext),this._plugins=new ZSt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this.renderPassManager=new RW,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[he(()=>this._stage.view.state.camera,()=>o(),qi),he(()=>wr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(pu.TRANSPARENT):()=>{},o()},Ki),he(()=>this._stage.view.environment.background?.color,a=>{const l=a?cR(a):Cu;Zr(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},qi),he(()=>this._stage.view.state.camera.relativeElevation,a=>{this._inGlobeView=(a??1/0)>=p5},qi)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=gr(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=il(this._loadEdgeViewTask),this._edgeView=Oe(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),Cxe.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,i=!se("disable-feature:high-quality-idle")){this._renderStateFeatures.value=kne(i,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Os.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(Os.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(V.Highlight,ye.OPAQUE_MATERIAL,ye.TRANSPARENT_MATERIAL,ye.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,ye.LASERLINES,ye.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(Os.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(Os.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Os.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Xt(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=Xt(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=Xt(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Xt(this._bindParameters.depth),this._bindParameters.hudVisibility=Xt(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=Tm(async e=>{const{EdgeView:i}=await ue(()=>import("./EdgeView-b3bf7739.js").then(s=>s.E),["./EdgeView-b3bf7739.js","./EdgeWorkerHandle-7a5403af.js","./WorkerHandle-becb41d0.js","./workerHelper-a9182cf3.js"],import.meta.url);yt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:I2t(this._stage.view.resourceController)});return this._handles.push(he(()=>r.updating,()=>this._requestRender(),Ji)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&Hk(this._bindParameters.ssr.reprojectionMatrix,Cr)}set _reprojectionMatrix(e){Ide(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:i,_bindParameters:r}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;if(r.length===0&&s.length===0&&n.length===0)return;const o=nxe(e);let a=!1;o.forEach((l,c)=>{if(i.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const h=new pO({material:c});h.initializeRenderContext(this._plugins._context),u=h,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(h=>e.removes.removeUnordered(h)),l.adds.forEach(h=>e.adds.removeUnordered(h)),l.updates.forEach(h=>e.updates.removeUnordered(h)),i.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(V.Color,ye.LINE_CALLOUTS_HUD_DEPTH,ye.HUD_MATERIAL,ye.LABEL_MATERIAL),e.water=this._plugins.produces(V.Normal,ye.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const i=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?gr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=Ld.Default,s=Ka.ON){this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(i),this._bindParameters.overlay&&this.performanceInfo.advance(ys.OVERLAY),this._renderContext.time=i,this._bindParameters.transparencyPassType=Qe.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=s,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const u=this._nodes.produces("magnifier-color"),h=this._nodes.produces("final-color"),p=$0(this._sliceHelper.plane);s===Ka.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const f=n.initializeFrame(o,this._backgroundColor,r);this.hasReflections?this._bindParameters.ssr.lastFrameColor=f:f?.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&s===Ka.ON;const g=this._plugins.produces(V.Color,ye.OPAQUE_TERRAIN)&&(this._terrainTransparency===va.Semitransparent||this._terrainTransparency===va.TransparentWithDraped),_=this._highQualityTransparency&&g,v=this._plugins.produces(V.Color,...HL);this._prepareShaders(_,v),this.performanceInfo.advance(ys.PREPARE);const b=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(o,a);let w=this._renderNormals();if(this._pluginInput.set("normals",w),w){let X=null;this._needsDepth&&(X=w.getAttachment(MC),X?.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(X),w=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(b,o,a),this._ensureBindParametersSSR(i),this._renderContext.output=V.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture;const T=this.plugins.produces(V.Color,...P6);T&&this._renderOpaqueGeometry(),this._offscreen.updateColor(X=>this._renderNodes(y_.OPAQUE,X,T)),this.fboCache.debugCallback?.("opaque-color",this._offscreen.color.fbo),this._renderPlugins(ye.OPAQUE_ENVIRONMENT,ys.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth(_),this._setMultipassTerrain(_),this._renderEdges(pu.OPAQUE),n.bindFbo(),this._renderPlugins(ye.VOXEL,ys.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(a2.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(X=>this._renderNodes(y_.TRANSPARENT,X,v)),this.fboCache.debugCallback?.("transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth(_),this._renderHUDVisibility(),_||this._plugins.render(this._pluginInput,ye.LINE_CALLOUTS);const S=r===Ld.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(pu.TRANSPARENT);const A=g?this._renderTransparentTerrain():null;A&&(this.performanceInfo.advance(ys.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(_?this._renderLineCallouts(Pl.Occluded):n.compositeToHUDVisibility(this._bindParameters,A.getTexture()),this._renderHUD(Pl.Occluded,n.color))),this._setTerrainCulling(!1),A&&(n.compositeToFramebuffer(this._bindParameters,A.getTexture(),xc.PremultipliedAlpha,1),A.release(),_&&(this._renderEdges(pu.OPAQUE),v&&(this._oitEnabled?this._renderOITPass(a2.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(ys.TRANSPARENT)),this._renderEdges(pu.TRANSPARENT))),this._bindParameters.ssao=Xt(this._bindParameters.ssao),_&&this._renderLineCallouts(Pl.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor(X=>this._renderNodes(y_.COMPOSITE,X));const P=this._nodes.produces("aa-color"),R=!(r!==Ld.Default||h||u&&s===Ka.ON&&r===Ld.Default),F=this._pluginInput.get("composite-color"),k=R?OR:this.fboCache.acquire(F.fbo.width,F.fbo.height,"aa-color"),N=P?this._renderNodes(Wb.ANTIALIASING,k):this._blitToDefault(F,k,!1);this._pluginInput.set(Wb.ANTIALIASING,N),this._renderHUD(Pl.NotOccluded,N);const j=this._renderNodes(Wb.HIGHLIGHTS,N);let z=this._renderNodes(Wb.MAGNIFIER,j);return u&&s===Ka.ON&&r===Ld.Default&&!h&&(z=this._blitToDefault(z)),h?(z.attachDepth(n.depth),this._blitToDefault(this._renderNodes(y_.FINAL,z)),z.detachDepth()):this._pluginInput.set(y_.FINAL,z),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=p,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Ld.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:S}}_prepareShaders(e,i){this._renderContext.output=V.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(ye.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(ye.LINE_CALLOUTS),i&&this._prepareTransparencySlots(),this._plugins.prepare(ye.VIEWSHED,ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ye.TRANSPARENT_ENVIRONMENT,ye.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!se("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,i=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return i.acquireDepth(co.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(V.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=Pl.NotOccluded,this._plugins.render(this._pluginInput,ye.HUD_MATERIAL),this._renderContext.output=e,this.performanceInfo.advance(ys.OBJECT_AND_LAYER_ID_COLOR),i}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===Vi.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0,n=i?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readDepthPixels(e,i){if(!this._bindParameters.mainDepth)return;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"linear-depth");this._rctx.bindFramebuffer(n.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),n.fbo?.readPixels(e[0],e[1],e[2],e[3],Pt.RGBA,Pa.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,i,r,s,Pt.RGBA,Pa.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e){const i=this._edgeView;if(!i?.shouldRender())return;const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"edges"),a=()=>i.render(this._bindParameters,e),l=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets(a,o,l??n,Bhe),this._offscreen.compositeToFramebuffer(this._bindParameters,o.getTexture(),xc.Alpha,1),o.release(),this.performanceInfo.advance(e===pu.OPAQUE?ys.OPAQUE_EDGES:ys.TRANSPARENT_EDGES)}_renderShadowMap(e,i,r){const s=this._shadowMap;s.enabled&&(s.start(e,i,r,this.isFeatureEnabled(Os.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(V.ShadowHighlight,this._shadowMap),s.moveSnapshot(Zw.Highlight),this._renderShadowCascades(V.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(Zw.ExcludeHighlight),this._renderShadowCascades(V.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(V.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(ys.SHADOW_MAP))}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this._renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(V.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=Xt(this._bindParameters.depth));const{width:i,height:r}=this._offscreen,s=this.fboCache.acquire(i,r,"depth");s.attachDepth(e),e.release(),this._rctx.bindFramebuffer(s.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(V.Depth),Xt(this._bindParameters.depth),this._bindParameters.depth=s.obtainDepthTexture(),s.release(),this.performanceInfo.advance(ys.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=Xt(this._bindParameters.depth));const{width:e,height:i}=this._offscreen,r=this.fboCache.acquire(e,i,"depth").acquireDepth(co.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(V.Depth),Xt(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(ys.DEPTH)}_renderMultipassTerrainDepth(e){if(!e)return void(this._bindParameters.multipassTerrain.depth=Xt(this._bindParameters.multipassTerrain.depth));const i=this._renderContext.output;this._renderContext.output=V.Depth;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"terrain depth").acquireDepth(co.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),Xt(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderMultipassGeometryDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.depth=Xt(this._bindParameters.multipassGeometry.depth));const i=this._renderContext.output,{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(co.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(V.Depth),this._renderContext.output=i,Xt(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return TW;const i=DSt(e,this._plugins.plugins,this._stage.layers);return GC(i,this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}_renderNormals(){const e=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),i=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+e;if(i===0)return;const r=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(V.Normal),[0,0,0,0],kr.RGBA,co.DEPTH_STENCIL_TEXTURE),s=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return r.retain(i+s-1),this.performanceInfo.advance(ys.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void e?.detachDepth();const i=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(ys.SSAO),i}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(ye.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(ye.TRANSPARENT_MATERIAL,ye.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,ye.INTEGRATED_MESH,ye.OPAQUE_TERRAIN,ye.OPAQUE_MATERIAL,ye.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,ye.OPAQUE_NO_SSAO_DEPTH,ye.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...P6,ye.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...P6)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...HL)}_renderTransparentTerrain(){const e=this._renderContext.output;if(!this._plugins.produces(e,ye.TRANSPARENT_TERRAIN))return;const i=()=>this._plugins.render(this._pluginInput,ye.TRANSPARENT_TERRAIN);if(e!==V.Color)return void i();const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"transparent terrain");return this._offscreen.renderToTargets(i,o,n,[0,0,0,0]),o}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,ye.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(this._pluginInput,ye.OCCLUSION_PIXELS),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(ys.HUD_VISIBILITY)):this._bindParameters.hudVisibility=Xt(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===Pl.Occluded){const i=()=>this._plugins.render(this._pluginInput,ye.LINE_CALLOUTS),{width:r,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(co.DEPTH16_BUFFER,r,s,"line callouts");this._offscreen.renderToTargets(i,n,o,void 0,!0,!0),o.release()}else this._plugins.render(this._pluginInput,ye.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,ye.LASERLINES),this._plugins.produces(this._renderContext.output,ye.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:i,height:r,depth:s}=e,n=this.fboCache.acquire(i,r,"laser lines"),o=()=>this._plugins.render(this._pluginInput,ye.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,n,s,Bhe),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),xc.PremultipliedAlpha,1),n.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(ys.LASER_LINES)}}_renderHUD(e,i){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOITPass(a2.HUD,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.composite(this._bindParameters,r.getTexture(),xc.PremultipliedAlpha),r.release()}else if(e===Pl.Occluded){this._renderContext.output=V.Color;const r=()=>this._renderHUDElements(e),{width:s,height:n,color:o}=this._offscreen,a=this.fboCache.acquireDepth(co.DEPTH16_BUFFER,s,n,"hud");this._offscreen.renderToTargets(r,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=V.Color,i.acquireDepth(co.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===Pl.Occluded?ys.HUD_OCCLUDED:ys.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(ye.LINE_CALLOUTS_HUD_DEPTH,ye.HUD_MATERIAL,ye.LABEL_MATERIAL),this._plugins.render(this._pluginInput,ye.LINE_CALLOUTS_HUD_DEPTH,ye.HUD_MATERIAL,ye.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(V.ShadowHighlight,ye.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(V.Highlight),this._rctx.clear(Sr.DEPTH_BUFFER_BIT),this._renderHUDElements(Pl.Both)},i=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],kr.RGBA4,co.DEPTH_STENCIL_TEXTURE);return i.detachDepth(),i}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,i,r){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(ys.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=V.Color,this._bindParameters.transparencyPassType=Qe.ColorAlpha,this._plugins.prepare(...HL),this._bindParameters.transparencyPassType=Qe.FrontFace,this._plugins.prepare(...HL),this._bindParameters.transparencyPassType=Qe.NONE,this._techniques.acquire(gK).release()}_renderOITPass(e,i=Pl.Both){const r=e===a2.HUD,s=r?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=r?()=>this._renderHUDElements(i):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=V.Color,this._bindParameters.transparencyPassType=Qe.ColorAlpha;const a=this._offscreen.renderOITPass(n,Qe.ColorAlpha,r);this._bindParameters.transparencyPassType=Qe.FrontFace;const l=this._offscreen.renderOITPass(n,Qe.FrontFace,r);return this._offscreen.compositeOIT(this._bindParameters,a,l,s),s?.detachDepth(),l.release(),a.release(),this._bindParameters.transparencyPassType=Qe.NONE,this._renderContext.output=o,s}_renderOccluded(){let e=0;Gc.clear(),this._plugins.plugins.forAll(l=>{l.materialReference&&l.queryRenderOccludedState(ki.OccludeAndTransparentStencil)&&(e|=ki.OccludeAndTransparentStencil,Gc.push(l))});const i=this._offscreen,r=(l,c,u,h,p)=>{if(!(e&c))return;const{width:f,height:g,depth:_}=i,v=this.fboCache.acquire(f,g,"tmp color");i.renderToTargets(u,v,_,[0,0,0,0],h,p),i.compositeToFramebuffer(this._bindParameters,v.getTexture(),xc.PremultipliedAlpha,l),v.release()},s=(l,c)=>{this._bindParameters.slot=l,c.forAll(u=>{if(Q9(u)){const h=u.prepareTechnique(this._renderContext);h&&u.renderNode(this._renderContext,h)}})};Gc.length!==0&&(s(ye.OCCLUDER_MATERIAL,Gc),r(.5,ki.OccludeAndTransparentStencil,()=>s(ye.TRANSPARENT_OCCLUDER_MATERIAL,Gc),!1,!1));const n=Gc.length>0;Gc.clear(),this._plugins.plugins.forAll(l=>{if(!l.materialReference)return;const c=l.queryRenderOccludedState(ki.OccludeAndTransparent),u=l.queryRenderOccludedState(ki.Transparent),h=l.queryRenderOccludedState(ki.Opaque);(c||u||h)&&(e|=c?ki.OccludeAndTransparent:u?ki.Transparent:ki.Opaque,Gc.push(l))});const o=this._plugins.renderOccludedFlags;if(e|=o,!e)return;const a=l=>{this._renderContext.renderOccludedMask=l,o>ki.Occlude&&this._plugins.render(this._pluginInput,ye.OCCLUDED_TERRAIN),s(ye.OPAQUE_MATERIAL,Gc),s(ye.TRANSPARENT_MATERIAL,Gc),s(ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Gc),this._renderContext.renderOccludedMask=w5};this._renderContext.output=V.Color,r(.5,ki.OccludeAndTransparent,()=>a(ki.OccludeAndTransparent),!0,Nl.OutlineVisualElementMask),r(.5,ki.Transparent,()=>a(ki.Transparent),!0,Nl.OutlineVisualElementMask),r(1,ki.Opaque,()=>a(ki.Opaque),!0,Nl.OutlineVisualElementMask),(n||Gc.length>0)&&this.performanceInfo.advance(ys.OCCLUDED),Gc.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,ye.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ye.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(ys.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(Os.HighResolutionViewshed),this._plugins.render(this._pluginInput,ye.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(ys.VIEWSHED))}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;i.setName(e),this._pluginInput.set(e,i);const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitToDefault(e,i=OR,r=!0){this._blit||(this._blit=new JSt(this._techniques));const s=this._blit.render(this._rctx,e,i,this._bindParameters,this._requestRender);return this._pluginInput.set(e.name,s),r&&e.release(),s}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Cr:(Is(Ghe,this._bindParameters.camera.viewMatrix),Is(Vhe,this._bindParameters.camera.projectionMatrix),Ai(LT,Ghe,Vhe),Ai(LT,this._renderContext.lastFrameCamera.viewMatrix,LT),Ai(LT,this._renderContext.lastFrameCamera.projectionMatrix,LT),this._reprojectionMatrix=LT);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Cr,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,ye.VIEWSHED)}get test(){}}var a2,zhe;d([m({readOnly:!0})],eF.prototype,"fullResolutionAtmosphere",null),d([m()],eF.prototype,"_edgeView",void 0),d([m()],eF.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(a2||(a2={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility",t[t.ViewshedShadowMap=4]="ViewshedShadowMap"}(zhe||(zhe={}));const Bhe=[0,0,0,0],P6=[ye.INTEGRATED_MESH,ye.OPAQUE_TERRAIN,ye.OPAQUE_MATERIAL,ye.OPAQUE_NO_SSAO_DEPTH],HL=[ye.TRANSPARENT_MATERIAL,ye.TRANSPARENT_NO_SSAO_DEPTH],Gc=new Gt,Vhe=xe(),Ghe=xe(),LT=xe();function I2t(t){return e=>t.immediate.schedule(e)}let L2t=class{constructor(e){this._rctx=e,this._vao=D2t(e)}destroy(){this._vao=Tt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(ui.TRIANGLES,0,3))}get test(){}};function D2t(t,e=BZ,i=di){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Pm(t,i,{geometry:e},{geometry:lr.createVertex(t,Hi.STATIC_DRAW,r)})}let UOe=class zOe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=zOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return lr.createIndex(this._rctx,Hi.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,vt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(ui.POINTS,1,dt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},jhe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ee.ONE,dstRGB:Ee.ZERO,srcAlpha:Ee.ONE,dstAlpha:Ee.ZERO},this.blendEquation={mode:y0.ADD,modeAlpha:y0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Xd.BACK,this.frontFace=AC.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=tr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Xd.FRONT_AND_BACK,func:tr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Xd.FRONT_AND_BACK,fail:es.KEEP,zFail:es.KEEP,zPass:es.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[zn.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},N2t=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Vs.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations?.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations?.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Vs.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Vs.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Vs[i]}: ${r}
`)}}return e+=this._allocations?.resetLog(),e}},F2t=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const k2t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Hhe,BOe={exports:{}};(Hhe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(BOe.exports=Hhe);const U2t=o$(BOe.exports);var qhe,VOe={exports:{}};qhe=VOe,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(qhe.exports=e)}();const Whe=o$(VOe.exports);var GOe={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(GOe);const z2t=o$(GOe.exports);var ad=999,Yhe=9999,O6=0,R6=1,Xhe=2,Zhe=3,Jhe=4,qL=5,B2t=6,V2t=7,G2t=8,Qhe=9,j2t=10,Khe=11,H2t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function q2t(){var t,e,i,r=0,s=0,n=ad,o=[],a=[],l=1,c=0,u=0,h=!1,p=!1,f="";return function(z){return a=[],z!==null?_(z.replace?z.replace(/\r\n/g,`
`):z):v()};function g(z){z.length&&a.push({type:H2t[n],data:z,position:u,line:l,column:c})}function _(z){var X;for(r=0,i=(f+=z).length;t=f[r],r<i;){switch(X=r,n){case O6:r=A();break;case R6:r=S();break;case Xhe:r=T();break;case Zhe:r=P();break;case Jhe:r=k();break;case Khe:r=F();break;case qL:r=N();break;case Yhe:r=j();break;case Qhe:r=w();break;case ad:r=b()}X!==r&&(f[X]===`
`?(c=0,++l):++c)}return s+=r,f=f.slice(r),a}function v(z){return o.length&&g(o.join("")),n=j2t,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+r-1,n=O6,e=t,r+1):e==="/"&&t==="/"?(u=s+r-1,n=R6,e=t,r+1):t==="#"?(n=Xhe,u=s+r,r):/\s/.test(t)?(n=Qhe,u=s+r,r):(h=/\d/.test(t),p=/[^\w_]/.test(t),u=s+r,n=h?Jhe:p?Zhe:Yhe,r)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=ad,r):(o.push(t),e=t,r+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=ad,r)}function S(){return T()}function A(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=ad,r+1):(o.push(t),e=t,r+1)}function P(){if(e==="."&&/\d/.test(t))return n=qL,r;if(e==="/"&&t==="*")return n=O6,r;if(e==="/"&&t==="/")return n=R6,r;if(t==="."&&o.length){for(;R(o););return n=qL,r}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return g(t),n=ad,r+1}var z=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||z){for(;R(o););return n=ad,r}return o.push(t),e=t,r+1}function R(z){for(var X,q,Z=0;;){if(X=Whe.indexOf(z.slice(0,z.length+Z).join("")),q=Whe[X],X===-1){if(Z--+z.length>0)continue;q=z.slice(0,1).join("")}return g(q),u+=q.length,(o=o.slice(q.length)).length}}function F(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=ad,r):(o.push(t),e=t,r+1)}function k(){return t==="."||/[eE]/.test(t)?(o.push(t),n=qL,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Khe,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=ad,r):(o.push(t),e=t,r+1)}function N(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=ad,r):(o.push(t),e=t,r+1)}function j(){if(/[^\d\w_]/.test(t)){var z=o.join("");return n=U2t.indexOf(z)>-1?G2t:z2t.indexOf(z)>-1?V2t:B2t,g(o.join("")),n=ad,r}return o.push(t),e=t,r+1}}function W2t(t){var e=q2t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function Y2t(t){return W2t(t)}function X2t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const $6=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function Z2t(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function J2t(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function PP(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,PP(t,e,r+"_"+e[r],r);return i}function jOe(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function s(l){let c=-1,u=0,h=-1;for(let p=0;p<l.length;p++){const f=l[p];if(f.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(f.data)?++u:/#endif\s*.*/.test(f.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||f.type==="preprocessor"&&f.data.startsWith("#version")&&(h=Math.max(h,p)),i==="afterPrecision"&&f.type==="keyword"&&f.data==="precision"){const g=r(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Q2t(t,e,i,r="lowp"){jOe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function K2t(t,e,i,r,s="lowp"){jOe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function eCt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function ede(t,e){if(t.startsWith("#version 300"))return t;const i=Y2t(t);if(Z2t(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===du.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===du.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===du.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=PP(i,n,"fragColor"),Q2t(i,r,"vec4")),l.data=r),e===du.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=eCt(i,a+1),u=PP(i,n,"fragData");K2t(i,u,"vec4",c,"mediump"),l.data=u}else e===du.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=PP(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(k2t.includes(l.data)){if(e===du.VERTEX_SHADER&&J2t(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=PP(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c?.[1]&&$6.has(c[1].trim())){const p=i[a+1];i.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/#ifdef\s+(.*)/);u?.[1]&&$6.has(u[1].trim())&&(l.data="#if 1");const h=l.data.match(/#ifndef\s+(.*)/);h?.[1]&&$6.has(h[1].trim())&&(l.data="#if 0")}}return tCt(t,X2t(i))}function tCt(t,e){return e}const iCt=4294967295;let rCt=class{constructor(e,i,r,s,n=new Map,o=[]){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=ede(i,du.VERTEX_SHADER),r=ede(r,du.FRAGMENT_SHADER),this._vShader=tde(this._context,du.VERTEX_SHADER,i),this._fShader=tde(this._context,du.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Vs.Shader,this),I9()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((c,u)=>a.bindAttribLocation(l,c,u)),this._transformFeedbackVaryings?.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),I9()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[c,u]of this._uniformBlockBindings){const h=a.getUniformBlockIndex(l,c);h<iCt&&a.uniformBlockBinding(l,h,u)}this._glName=l,this._context.instanceCounter.increment(Vs.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Vs.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Vs.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Vs.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Vs.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Vs.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){Jp(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Jp(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Jp(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Jp(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){Jp(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){Jp(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&Jp(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&Jp(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Jp(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Jp(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function tde(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),I9()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===du.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(sCt(i))),s}function sCt(t){let e=2;return t.replaceAll(`
`,()=>`
`+nCt(e++)+":")}function nCt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Jp(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let oCt=class{constructor(e){this._rctx=e,this._store=new uv}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new rCt(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},Pz=class{constructor(){this._result=!1}dispose(){this._program=Tt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},aCt=class extends Pz{constructor(e){super(),this._rctx=e,this._helperProgram=null,se("mac")&&se("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new $r(1);l.wrapMode=hi.CLAMP_TO_EDGE,l.samplingMode=Zt.NEAREST;const c=new $m(i,l),u=lr.createIndex(this._rctx,Hi.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(u,vt.ELEMENT_ARRAY_BUFFER),i.drawElements(ui.POINTS,1,dt.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(ui.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,Pt.RGBA,Pa.UNSIGNED_BYTE,h),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),u.dispose(),h[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${x.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${x.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=UOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},lCt=class extends Pz{constructor(e){super(),this._rctx=e,this._program=ide(this._rctx,!1),this._obfuscated=ide(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Tt(this._obfuscated)}_test(e){if(se("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new $r(1);r.wrapMode=hi.CLAMP_TO_EDGE,r.samplingMode=Zt.NEAREST;const s=new $m(i,r),n=lr.createVertex(i,Hi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new bp(i,new Map([["position",0]]),{geometry:[new vp("position",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ce(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ce(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);V9(a,c,3);const u=new Float32Array(6);V9(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(ui.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);s.readPixels(0,0,1,1,Pt.RGBA,Pa.UNSIGNED_BYTE,h),o.dispose(),s.dispose();const p=(a[2]-l[2])/25,f=BJ(h);return Math.abs(p-f)}};function ide(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}let cCt=class extends Pz{constructor(e){if(super(),this._rctx=e,!e.gl||!(e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new $r(1);r.wrapMode=hi.CLAMP_TO_EDGE,r.dataType=Pa.FLOAT,r.internalFormat=ut.RGBA32F,r.samplingMode=Zt.NEAREST;const s=new $m(i,r),n=lr.createVertex(i,Hi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new bp(i,new Map([["a_pos",0]]),{geometry:[new vp("a_pos",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:n});i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(ui.TRIANGLE_STRIP,0,4);const p=Lt({blending:Ru(Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA)});i.setPipelineState(p),i.drawArrays(ui.TRIANGLE_STRIP,0,4);const f=i.gl.getError();return i.setViewport(l,c,u,h),i.bindFramebuffer(a),o.dispose(),s.dispose(),f!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};new vp("a_pos",2,dt.BYTE,0,2);new vp("a_pos",2,dt.BYTE,0,4),new vp("a_tex",2,dt.BYTE,2,4);const uCt={geometry:[new vp("a_pos",2,dt.UNSIGNED_SHORT,0,4)]};let hCt=class extends Pz{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new $r(1);r.wrapMode=hi.CLAMP_TO_EDGE,r.samplingMode=Zt.NEAREST;const s=new $m(i,r),n=lr.createVertex(i,Hi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new bp(i,new Map([["a_pos",0]]),uCt,{geometry:n}),a=new $r;a.samplingMode=Zt.LINEAR,a.wrapMode=hi.CLAMP_TO_EDGE;const l=new ur(i,a,OP);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:h,width:p,height:f}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(Sr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(ui.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Pt.RGBA,Pa.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),i.setViewport(u,h,p,f),i.bindFramebuffer(c),g[0]!==255}};const OP=new Image;OP.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",OP.width=5,OP.height=5,OP.decode();let dCt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new cCt(e),this.svgPremultipliesAlpha=new hCt(e),this.doublePrecisionRequiresObfuscation=new lCt(e),this.drawArraysRequiresIndicesTypeReset=new aCt(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function pCt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function fCt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function mCt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function gCt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function yCt(t,e,i,r,s){if(r)return!0;if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function _Ct(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function vCt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let bCt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=pCt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=fCt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=mCt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=P2t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=gCt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get loseContext(){return this._loseContext??(this._loseContext=vCt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=_Ct(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=yCt(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},wCt=class{constructor(e,i){this.gl=e,this.instanceCounter=new N2t,this.programCache=new oCt(this),this._transformFeedbackRequestInfo=null,this._state=new jhe,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new bCt(this.gl,e),this._parameters=new F2t(this.gl,this._capabilities,e),ur.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new jhe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new uXe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([zn.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([zn.NONE]):this.setDrawBuffers([En.COLOR_ATTACHMENT0])}}}),this.enforceState(),Tt(this._driverTest),this._driverTest=new dCt(this)}dispose(){Tt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(vt.ARRAY_BUFFER),this.unbindBuffer(vt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(vt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(vt.PIXEL_PACK_BUFFER),this.unbindBuffer(vt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(vt.COPY_READ_BUFFER),this.unbindBuffer(vt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,Md()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Xd.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Xd.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Xd.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(VB+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if(s?.length!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==zn.BACK&&e[0]!==zn.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(zn.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){if(e){if(e&Sr.COLOR_BUFFER_BIT){const r=this._state.drawFramebuffer?.colorAttachments;r&&this.setDrawBuffers(r),this.setColorMask(!0,!0,!0,!0)}e&Sr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Sr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=Sr.COLOR_BUFFER_BIT}i&&(s|=Sr.DEPTH_BUFFER_BIT),r===!1?r=0:(r===!0&&(r=255),s|=Sr.STENCIL_BUFFER_BIT),s&&this.clear(s,r)}drawArrays(e,i,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(this._state.program?.hasTransformFeedbackVaryings==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Md()){this._numOfDrawCalls++,this._numOfTriangles+=rde(e,r);const s=this._state.textureUnitMap;for(let n=0;n<s.length;n++){const o=s[n];if(o!=null&&o===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${n}`)}}this.gl.drawArrays(e,i,r),Lf(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),Lf(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Md()&&(this._numOfDrawCalls++,this._numOfTriangles+=rde(e,i)),this.gl.drawElements(e,i,r,s),Md()){const n=Pwe(this);if(n){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:i,type:r,offset:s},h=a?.size??0,p=s+i,f=h<p?`. Buffer is too small. Attempted to draw index ${p} of ${h}`:"";console.error(`drawElements: ${n}${f}`,{args:u,vao:c})}}}logInfo(){Md()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Md()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return e?.glName==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(fa.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(fa.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===fa.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,u=i.height,h=Sr.COLOR_BUFFER_BIT,p=Zt.NEAREST){this.bindFramebufferSeparate(e,fa.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,fa.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,u,h,p)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case vt.ARRAY_BUFFER:this._state.vertexBuffer=_l(this.gl,e,i,this._state.vertexBuffer);break;case vt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=_l(this.gl,e,i,this._state.indexBuffer);break;case vt.UNIFORM_BUFFER:this._state.uniformBuffer=_l(this.gl,e,i,this._state.uniformBuffer);break;case vt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=_l(this.gl,e,i,this._state.pixelPackBuffer);break;case vt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=_l(this.gl,e,i,this._state.pixelUnpackBuffer);break;case vt.COPY_READ_BUFFER:this._state.copyReadBuffer=_l(this.gl,e,i,this._state.copyReadBuffer);break;case vt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=_l(this.gl,e,i,this._state.copyWriteBuffer);break;case vt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=_l(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===vt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Md()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(vt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(vt.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(vt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(vt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case vt.ARRAY_BUFFER:this._state.vertexBuffer=_l(this.gl,null,e,this._state.vertexBuffer);break;case vt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=_l(this.gl,null,e,this._state.indexBuffer);break;case vt.UNIFORM_BUFFER:this._state.uniformBuffer=_l(this.gl,null,e,this._state.uniformBuffer);break;case vt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=_l(this.gl,null,e,this._state.pixelPackBuffer);break;case vt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=_l(this.gl,null,e,this._state.pixelUnpackBuffer);break;case vt.COPY_READ_BUFFER:this._state.copyReadBuffer=_l(this.gl,null,e,this._state.copyReadBuffer);break;case vt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=_l(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync($9.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Vs.Sync,r),i.flush();do await PO(e),s=i.clientWaitSync(r,0,0);while(s===L4.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Vs.Sync,r),i.deleteSync(r),s===L4.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=fa.FRAMEBUFFER){return e===fa.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(vt.ARRAY_BUFFER),this.unbindBuffer(vt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(vt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(vt.PIXEL_PACK_BUFFER),this.unbindBuffer(vt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(vt.COPY_READ_BUFFER),this.unbindBuffer(vt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ee.ONE,Ee.ZERO),this.setBlendEquation(y0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Xd.BACK),this.setFrontFace(AC.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(tr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(tr.ALWAYS,0,0),this.setStencilOp(es.KEEP,es.KEEP,es.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([zn.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(vt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(vt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(vt.UNIFORM_BUFFER,null);for(let r=0;r<this._parameters.maxUniformBufferBindings;r++){const s=this._state.uniformBufferBindingPoints[r];if(s!=null){const{buffer:n,offset:o,size:a}=s;n!==null?o===0&&a===0?e.bindBufferBase(vt.UNIFORM_BUFFER,r,n.glName):e.bindBufferRange(vt.UNIFORM_BUFFER,r,n.glName,o,a):e.bindBufferBase(vt.UNIFORM_BUFFER,r,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(vt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(vt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(vt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(vt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(fa.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(fa.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(En.COLOR_ATTACHMENT0)),e.bindFramebuffer(fa.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),this._state.drawFramebuffer===null){const r=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(r??[zn.BACK])}else{const r=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(r??[En.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const r=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(r)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(VB+r),e.bindTexture(vs.TEXTURE_2D,null),e.bindTexture(vs.TEXTURE_CUBE_MAP,null),e.bindTexture(vs.TEXTURE_3D,null),e.bindTexture(vs.TEXTURE_2D_ARRAY,null);const s=this._state.textureUnitMap[r];s!=null&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(VB+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function _l(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function rde(t,e){switch(t){case ui.POINTS:return 2*e;case ui.TRIANGLES:return e/3;case ui.TRIANGLE_STRIP:case ui.TRIANGLE_FAN:return e-2;default:return 0}}let xCt=class extends wCt{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new L2t(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy()}bindTechnique(e,i,r,s,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(r,i),s&&e.program.bindDraw(s,i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new UOe(this)),this._appleAmdDriverHelper.run())}get test(){}};function sde(t){return!!t.frameUpdate}let xS=class extends Pe{constructor(e,i,r){super({}),this._stage=e,this._techniques=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ls,this._frameTask=e.view.resourceController.scheduler.registerTask(wt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(ws.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(vQ,new bQ)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",Vi.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return at(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new TCt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),sde(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),sde(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,sn(l)||le.getLogger(this).error(l),null);return $c(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",Vi.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([m()],xS.prototype,"_loadingCount",void 0),d([m()],xS.prototype,"_frameTask",void 0),d([m()],xS.prototype,"updating",null),xS=d([U("esri.views.3d.webgl-engine.lib.TextureRepository")],xS);let TCt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(le.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function SCt(t,e){return new gCe(i=>wlt(i,t),i=>i,e)}let RP=class extends Pe{constructor(){super(...arguments),this._passParameters=new CCt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=il(this._resourcesTask),this._passParameters.waveNormal=Tt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Tt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Tm(async i=>{await Promise.allSettled([this._loadImageResource(e,sr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,sr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?av.LOADED:av.LOADING}async _loadImageResource(e,i,r,s){try{const n=await w0(i,{signal:s});yt(s);const o=new $r(n.width,n.height);o.pixelFormat=Pt.RGB,o.samplingMode=Zt.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new ur(e,o,n))}catch(n){le.getLogger(this).error("Failed to load water material normal texture.",n)}}};d([m()],RP.prototype,"_resourcesTask",void 0),d([m({type:Boolean,readOnly:!0})],RP.prototype,"updating",null),RP=d([U("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],RP);let CCt=class extends xr{};const nde=2048,ECt=1.5,ACt=8;function MCt(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=yK(t,e.padding),a=DCt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=LCt(t,a),u=kCt(i),h=GCt[u];return{format:u,quality:Te(r??h,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function PCt(t,e){const i=MCt(t,e),r=i.area,s=i.width/r.width,n=yK(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),h=Math.floor(c*s+a),p=t?.layers??[],f=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:f,ignorePadding:g,objectAndLayerIdColor:!1}}function I6(t,e,i){const{ctx:r,canvas:s}=HOe(t,i),n=r.getImageData(0,0,t.width,t.height),o=RCt(s,e);return qOe(s),{dataUrl:o,data:n}}function L6(t,e){const{ctx:i,canvas:r}=HOe(t,e),s=i.getImageData(0,0,t.width,t.height);return qOe(r),s}function HOe(t,e){const i=OCt();e.premultipliedAlpha&&zCt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&UCt(r),{ctx:r,canvas:i}}function qOe(t){t.width=0,t.height=0}function OCt(){return D6==null&&(D6=document.createElement("canvas")),D6}let D6=null;function RCt(t,e){const i=BCt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function $Ct(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:h}=e,p=n/c,f=o/u,g=Math.ceil(p/2),_=Math.ceil(f/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const T=4*(w+(a?u-b-1:b)*c);let S=0,A=0,P=0,R=0,F=0,k=0;const N=(b+.5)*f;for(let j=Math.floor(b*f);j<(b+1)*f;j++){const z=Math.abs(N-(j+.5))/_,X=(w+.5)*p,q=z*z;for(let Z=Math.floor(w*p);Z<(w+1)*p;Z++){const ce=Math.abs(X-(Z+.5))/g,I=Math.sqrt(q+ce*ce);if(I>=1)continue;let D=2*I*I*I-3*I*I+1;const G=4*(r+Z+(s+j)*v);k+=D*l[G+3],A+=D,!i&&l[G+3]<255&&(D=D*l[G+3]/255),P+=D*l[G],R+=D*l[G+1],F+=D*l[G+2],S+=D}}h[T]=P/S,h[T+1]=R/S,h[T+2]=F/S,h[T+3]=k/A}return e}function ICt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=yK(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,h=s-c,p=Math.min(ACt,Math.min((nde-l)/u,(nde-c)/h));return p<ECt?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:r,height:s}}}function LCt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function DCt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return NCt(FCt(i,t),e)}function NCt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function FCt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function yK(t,e){return!e||t?.ignorePadding?jCt:e}function kCt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return VCt}}function UCt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function zCt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const BCt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},ode=98,VCt="png",GCt={png:100,jpg:ode,jpeg:ode},jCt={top:0,right:0,bottom:0,left:0};let HCt=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},qCt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Vi.BACKGROUND);const i=Pn();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?Ka.OFF:Ka.ON,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=_B(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Pt.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=_B(n.width,n.height,a);return $Ct(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=_B(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Pt.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};Bb(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,u=l||a||c||i.objectAndLayerIdColor;let h=null,p=null;if(u){const v=s.clone();if(i.ignorePadding){const A=n$(v.padding);for(let P=0;P<4;P++)A[P]=Math.round(A[P]/v.pixelRatio*i.pixelRatio);v.padding=A}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const b=s.fovX-v.fovX,w=s.fovY-v.fovY;b<0&&b<w?v.fovX=s.fovX:w<0&&w<b&&(v.fovY=s.fovY);const T={camera:v,contentCamera:v,mode:gi.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),o=!0;const S=this._renderFunctions.renderScene(T,r,i.objectAndLayerIdColor?Ld.ObjectAndLayerID:Ld.Screenshot,i.disableDecorations?Ka.OFF:Ka.ON);p=S.screen,h=S.oid}const f=()=>{this._rctx.bindFramebuffer(null),p?.release()};this._rctx.bindFramebuffer(p?.fbo);const g=this._readbackScreenshot(i,f);let _=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h?.release()};this._rctx.bindFramebuffer(h?.fbo),_=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function IW(t,e={}){return t.getContext("webgl2",e)||null}let Go=class extends Pe{constructor(e){super({}),this.events=new Ls,this.waterTextures=new RP,this.objectAndLayerIdRenderHelper=se("enable-feature:objectAndLayerId-rendering")?new HSt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(s){return void console.error("Failed to initialize context",s)}const{memoryController:i}=e.view.resourceController;this.stippleTextures=Oat(this._rctx,i),this.markerTextures=SCt(this._rctx,i),this._techniques=new cCe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new xS(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",s=>this.requestRender(s))),this._materials=new uCe(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new PSt(this._rctx,this._techniques),this.renderer=new eF(e,this._materials,this._techniques,this._rctx,this._compositingHelper,s=>this.requestRender(s)),this.addHandles([he(()=>e.view.ready,s=>{s&&this._createRenderNodes(e.view,e.viewingMode)},Ki),he(()=>this.waterTextures?.updating,()=>this.requestRender(),Ki),he(()=>e.view.qualityProfile,s=>this.renderer?.updateRenderFeatures(s),qi)]);const r={renderScene:(s,n,o,a)=>this.renderer.render(s,n,o,a),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new qCt(this._rctx,r,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=gr(this._frameTask),this._techniques=Oe(this._techniques),this._componentObjects=Oe(this._componentObjects),this._screenshotManager=Oe(this._screenshotManager),Oe(this.renderer),this._textures=Oe(this._textures),Oe(this.waterTextures),Oe(this.markerTextures),Oe(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Oe(this._rctx)}_createRenderNodes(e,i){new sb({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new Zy({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new Xy({view:e,techniques:this._techniques}),new wS({view:e,techniques:this._techniques}),new fb({view:e,viewingMode:i,techniques:this._techniques})}requestRender(e=Vi.UPDATE){this._needsRender=!0,e===Vi.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const h=LSt(4*u,l,s.nearFar);c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}if(e){const u=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){KMe(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=Vi.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?Vi.UPDATE:Vi.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new QTe(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(Vi.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(Vi.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new HCt(i,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(i.mode===gi.IDLE?s:Vi.UPDATE),n=!1)}};this._frameTask=xw(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=IW(this._canvas,r);s!=null?(this._rctx=WCt(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&le.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&se("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):le.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new HTt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function WCt(t,e){const i={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>e.view.resourceController.memoryController.newCache(s,n);return new xCt(t,i,r)}d([m({type:Boolean,readOnly:!0})],Go.prototype,"updating",null),d([m()],Go.prototype,"_rctx",void 0),d([m()],Go.prototype,"_container",void 0),d([m()],Go.prototype,"_canvas",void 0),d([m()],Go.prototype,"stippleTextures",void 0),d([m()],Go.prototype,"markerTextures",void 0),d([m()],Go.prototype,"waterTextures",void 0),d([m({readOnly:!0})],Go.prototype,"objectAndLayerIdRenderHelper",void 0),d([m()],Go.prototype,"_textures",void 0),d([m({readOnly:!0})],Go.prototype,"renderer",void 0),d([m()],Go.prototype,"_screenshotManager",void 0),d([m()],Go.prototype,"componentObjectCollection",null),d([m()],Go.prototype,"_componentObjects",void 0),d([m()],Go.prototype,"_needsUpdate",void 0),d([m()],Go.prototype,"_needsWaterReflectionUpdate",void 0),Go=d([U("esri.views.3d.webgl-engine.parts.RenderView")],Go);let Qc=class extends Pe{constructor(e){super(e),this._model=new HN,this._layers=new Gt,this._asyncChangeSet=new k9,this._syncChangeSet=new k9,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Go(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(wt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),_5(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(_5(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return $o}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===z_.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?wc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,wc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==z_.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===z_.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,wc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,wc),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,wc))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{yue(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if($c(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(yue(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};Qc.DebugSettings={endFrameContentValidation:!1},d([m({constructOnly:!0})],Qc.prototype,"view",void 0),d([m({constructOnly:!0})],Qc.prototype,"options",void 0),d([m({readOnly:!0})],Qc.prototype,"viewingMode",null),d([m({constructOnly:!0})],Qc.prototype,"container",void 0),d([m({readOnly:!0})],Qc.prototype,"updating",null),d([m({constructOnly:!0})],Qc.prototype,"_model",void 0),d([m()],Qc.prototype,"renderView",void 0),d([m({readOnly:!0})],Qc.prototype,"renderer",null),d([m({readOnly:!0})],Qc.prototype,"running",null),Qc=d([U("esri.views.3d.webgl-engine.Stage")],Qc);function S8t(t){return t&&typeof t.highlight=="function"}function YCt(t){return t&&typeof t.maskOccludee=="function"}function XCt(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function C8t(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(ZCt(i,r))return XCt(e,i,r)}return!0}function ZCt(t,e){return t!=null&&t>0||e!=null&&e>0}function E8t(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}let N6;function JCt(){return N6||(N6=eEt()),N6}let QCt=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function KCt(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=IW(e,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=IW(e),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function eEt(){const t=new QCt,e=KCt(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function tEt(t){const e=JCt();return e.available?t==="3d"&&e.majorPerformanceCaveat?new W("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new W("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new W("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new W("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function iEt(t){return t&&"nodeType"in t}function rEt(t){return t&&typeof t.render=="function"}const ade={component:"esri-component"};let gb=class extends Pe{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(ade.component),i&&i.classList.remove(ade.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||iEt(e)?(this._set("widget",null),wU(e)):(rEt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m()],gb.prototype,"id",null),d([m()],gb.prototype,"node",null),d([cr("node")],gb.prototype,"castNode",null),d([m({readOnly:!0})],gb.prototype,"widget",void 0),gb=d([U("esri.views.ui.Component")],gb);const tF=gb,WOe="calcite-mode-";function sEt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function nEt(){return sEt().startsWith("dark")}function YOe(){return`${WOe}${nEt()?"dark":"light"}`}function oEt(t){aEt(t),t.classList.add(YOe())}function aEt(t){Array.from(t.classList).forEach(e=>{e.startsWith(WOe)&&t.classList.remove(e)})}const lEt={left:0,top:0,bottom:0,right:0},XOe={bottom:30,top:15,right:15,left:15},rg="esri-ui",Kl={ui:rg,corner:`${rg}-corner`,innerContainer:`${rg}-inner-container`,manualContainer:`${rg}-manual-container`,cornerContainer:`${rg}-corner-container`,topLeft:`${rg}-top-left`,topRight:`${rg}-top-right`,bottomLeft:`${rg}-bottom-left`,bottomRight:`${rg}-bottom-right`};function cEt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function WL(t){return t===0?"0":`${t}px`}function F6(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function k6(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let wf=class extends Ls.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Ec(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&k6(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&k6(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([he(()=>[this.view?.padding,this.container],this._applyViewPadding,Ki),he(()=>this.padding,this._applyUIPadding,Ki),he(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Ki),xme(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(Kl.ui),oEt(e),this._attachContainers(e)),i&&(i.classList.remove(Kl.ui),k6(i,{top:"",bottom:"",left:"",right:""}),Xve(i)),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...XOe,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=F6(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&this._componentMap.get(r)?.key!==i)return;const s=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),r.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(s,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||i.removeInternal);for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=F6(e)||F6(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof tF||(e=new tF({node:e}));const{widget:o}=e;o!=null&&o instanceof Pe&&o.addHandles(Mi(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof tF?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??lEt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Kl.innerContainer,Kl.cornerContainer);const i=document.createElement("div");i.classList.add(Kl.innerContainer,Kl.manualContainer);const r=document.createElement("div");r.classList.add(Kl.topLeft,Kl.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Kl.topRight,Kl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Kl.bottomLeft,Kl.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Kl.bottomRight,Kl.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=Zqe();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(cEt(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?ere(r.node,n.firstChild):n.appendChild(r.node));s>=a.length?n.appendChild(r.node):ere(r.node,a[s])}_toPixelPosition(e){return{top:WL(e.top),left:WL(e.left),right:WL(e.right),bottom:WL(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(YC).filter(s=>i.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:n})=>s??n)}};d([m()],wf.prototype,"_locale",void 0),d([m()],wf.prototype,"container",null),d([m()],wf.prototype,"height",null),d([m({value:XOe})],wf.prototype,"padding",null),d([cr("padding")],wf.prototype,"castPadding",null),d([m()],wf.prototype,"view",void 0),d([m()],wf.prototype,"width",null),wf=d([U("esri.views.ui.UI")],wf);const uEt=wf,hEt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},dEt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},pEt=t=>({...dEt,...t}),fEt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},mEt=(t,e)=>t.find(e),lde=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r?.children?mEt(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},gEt=t=>{let e;const i={...hEt,...t},r=pEt(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,f,g)=>{let _;r.eventHandlerInterceptor=(b,w,T,S)=>function(A){let P;s("domEvent",A);const R=fEt(A.currentTarget,_.domNode),F=R.some(N=>customElements.get(N?.tagName?.toLowerCase()));if(A.eventPhase===Event.CAPTURING_PHASE||!F)R.reverse(),P=lde(_.getLastRender(),R);else{const N=A.composedPath(),j=N.slice(N.indexOf(A.currentTarget),N.indexOf(_.domNode)).reverse();P=lde(_.getLastRender(),j,!0)}let k;return P&&(k=i.handleInterceptedEvent(e,P,this,A)),s("domEventProcessed",A),k},i.postProcessProjectionOptions?.(r);const v=g();_=p(f,v,r),r.eventHandlerInterceptor=void 0,l.push(_),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(_,v)};let h=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const f=c[p]();s("rendered",void 0),l[p].update(f),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(h=i.modifyDoRenderImplementation(h,l,c)),e={renderNow:h,scheduleRender:()=>{n||a||(n=requestAnimationFrame(h))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,f)=>{u(S_.append,p,f)},insertBefore:(p,f)=>{u(S_.insertBefore,p,f)},merge:(p,f)=>{u(S_.merge,p,f)},replace:(p,f)=>{u(S_.replace,p,f)},detach:p=>{for(let f=0;f<c.length;f++)if(c[f]===p)return c.splice(f,1),l.splice(f,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const ZOe="calcite-mode-auto",JOe="calcite-mode-dark",yEt="calcite-mode-light",O8t={autoMode:ZOe,darkMode:JOe,lightMode:yEt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};var Bg={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},_Et=Object.defineProperty,vEt=(t,e)=>{for(var i in e)_Et(t,i,{get:e[i],enumerable:!0})},bEt=t=>{const e=new URL(t,ia.$resourcesUrl$);return e.origin!==H$.location.origin?e.href:e.pathname},wEt=t=>ia.$resourcesUrl$=t,cde={},xEt="http://www.w3.org/2000/svg",TEt="http://www.w3.org/1999/xhtml",SEt=t=>t!=null,_K=t=>(t=typeof t,t==="object"||t==="function");function CEt(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var EEt={};vEt(EEt,{err:()=>QOe,map:()=>AEt,ok:()=>LW,unwrap:()=>MEt,unwrapErr:()=>PEt});var LW=t=>({isOk:!0,isErr:!1,value:t}),QOe=t=>({isOk:!1,isErr:!0,value:t});function AEt(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>LW(r)):LW(i)}if(t.isErr){const i=t.value;return QOe(i)}throw"should never get here"}var MEt=t=>{if(t.isOk)return t.value;throw t.value},PEt=t=>{if(t.isErr)return t.value;throw t.value},Kw=(t,e="")=>()=>{},OEt="slot-fb{display:contents}slot-fb[hidden]{display:none}",ude="http://www.w3.org/1999/xlink",KOe=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=h=>{for(let p=0;p<h.length;p++)r=h[p],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!_K(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?j5(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,IEt);const u=j5(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},j5=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},REt={},$Et=t=>t&&t.$tag$===REt,IEt={forEach:(t,e)=>t.map(hde).forEach(e),map:(t,e)=>t.map(hde).map(e).map(LEt)},hde=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),LEt=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),KOe(t.vtag,i,...t.vchildren||[])}const e=j5(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},DEt=t=>cAt.map(e=>e(t)).find(e=>!!e),NEt=(t,e)=>t!=null&&!_K(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,FEt=t=>t,R8t=(t,e,i)=>{const r=FEt(t);return{emit:s=>kEt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},kEt=(t,e,i)=>{const r=ia.ce(e,i);return t.dispatchEvent(r),r},dde=new WeakMap,UEt=(t,e,i)=>{let r=W5.get(t);dAt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,W5.set(t,r)},zEt=(t,e,i)=>{var r;const s=eRe(e,i),n=W5.get(s);if(t=t.nodeType===11?t:lp,n)if(typeof n=="string"){t=t.head||t;let o=dde.get(t),a;if(o||dde.set(t,o=new Set),!o.has(s)){{a=lp.createElement("style"),a.innerHTML=n;const l=(r=ia.$nonce$)!=null?r:CEt(lp);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=OEt),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},BEt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=Kw("attachStyles",e.$tagName$),n=zEt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},eRe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),pde=(t,e,i,r,s,n)=>{if(i!==r){let o=bde(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=fde(i),u=fde(r);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):bde(H$,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(tRe);e=e.replace(GEt,""),i&&ia.rel(t,e,i,l),r&&ia.ael(t,e,r,l)}}else{const l=_K(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(ude,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(ude,e,r):t.setAttribute(e,r))}}},VEt=/\s/,fde=t=>t?t.split(VEt):[],tRe="Capture",GEt=new RegExp(tRe+"$"),iRe=(t,e,i,r)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||cde,o=e.$attrs$||cde;for(r of mde(Object.keys(n)))r in o||pde(s,r,n[r],void 0,i,e.$flags$);for(r of mde(Object.keys(o)))pde(s,r,n[r],o[r],i,e.$flags$)};function mde(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var TS,DW,qC,vK=!1,H5=!1,bK=!1,uu=!1,q5=(t,e,i,r)=>{var s;const n=e.$children$[i];let o=0,a,l,c;if(vK||(bK=!0,n.$tag$==="slot"&&(TS&&r.classList.add(TS+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=lp.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=lp.createTextNode("");else{if(uu||(uu=n.$tag$==="svg"),a=n.$elm$=lp.createElementNS(uu?xEt:TEt,n.$flags$&2?"slot-fb":n.$tag$),uu&&n.$tag$==="foreignObject"&&(uu=!1),iRe(null,n,uu),SEt(TS)&&a["s-si"]!==TS&&a.classList.add(a["s-si"]=TS),n.$children$)for(o=0;o<n.$children$.length;++o)l=q5(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?uu=!1:a.tagName==="foreignObject"&&(uu=!0)}return a["s-hn"]=qC,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=DW,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===n.$tag$&&t.$elm$&&$R(t.$elm$,!1)),a},$R=(t,e)=>{ia.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&Bg.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===qC&&i.push(r)}for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==qC&&s["s-ol"]&&(nRe(s).insertBefore(s,wK(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,bK=!0),e&&$R(s,e)}ia.$flags$&=-2},rRe=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===qC&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=q5(null,i,s,t),a&&(r[s].$elm$=a,o.insertBefore(a,wK(e))))},sRe=(t,e,i)=>{for(let r=e;r<=i;++r){const s=t[r];if(s){const n=s.$elm$;lRe(s),n&&(H5=!0,n["s-ol"]?n["s-ol"].remove():$R(n,!0),n.remove())}}},jEt=(t,e,i,r,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],h=e[c],p=r.length-1,f=r[0],g=r[p],_,v;for(;n<=c&&o<=p;)if(u==null)u=e[++n];else if(h==null)h=e[--c];else if(f==null)f=r[++o];else if(g==null)g=r[--p];else if(YL(u,f,s))SS(u,f,s),u=e[++n],f=r[++o];else if(YL(h,g,s))SS(h,g,s),h=e[--c],g=r[--p];else if(YL(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&$R(u.$elm$.parentNode,!1),SS(u,g,s),t.insertBefore(u.$elm$,h.$elm$.nextSibling),u=e[++n],g=r[--p];else if(YL(h,f,s))(u.$tag$==="slot"||g.$tag$==="slot")&&$R(h.$elm$.parentNode,!1),SS(h,f,s),t.insertBefore(h.$elm$,u.$elm$),h=e[--c],f=r[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===f.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==f.$tag$?_=q5(e&&e[o],i,a,t):(SS(v,f,s),e[a]=void 0,_=v.$elm$),f=r[++o]):(_=q5(e&&e[o],i,o,t),f=r[++o]),_&&nRe(u.$elm$).insertBefore(_,wK(u.$elm$))}n>c?rRe(t,r[p+1]==null?null:r[p+1].$elm$,i,r,o,p):o>p&&sRe(e,n,c)},YL=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,wK=t=>t&&t["s-ol"]||t,nRe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,SS=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(uu=o==="svg"?!0:o==="foreignObject"?!1:uu,o==="slot"&&!vK||iRe(t,e,uu),s!==null&&n!==null?jEt(r,s,e,n,i):n!==null?(t.$text$!==null&&(r.textContent=""),rRe(r,null,e,n,0,n.length-1)):s!==null&&sRe(s,0,s.length-1),uu&&o==="svg"&&(uu=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},oRe=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of e)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])||s.nodeType===3&&r===s["s-sn"]){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}oRe(i)}},Ng=[],aRe=t=>{let e,i,r;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const n=s["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!Bg.experimentalSlotFixes)if(gde(e,n)){let o=Ng.find(a=>a.$nodeToRelocate$===e);H5=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],Ng.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&Ng.map(a=>{gde(a.$nodeToRelocate$,e["s-sn"])&&(o=Ng.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else Ng.some(o=>o.$nodeToRelocate$===e)||Ng.push({$nodeToRelocate$:e})}s.nodeType===1&&aRe(s)}},gde=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",lRe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(lRe)},HEt=(t,e,i=!1)=>{var r,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||j5(null,null),h=$Et(e)?e:KOe(null,null,e);if(qC=l.tagName,c.$attrsToReflect$&&(h.$attrs$=h.$attrs$||{},c.$attrsToReflect$.map(([p,f])=>h.$attrs$[f]=l[p])),i&&h.$attrs$)for(const p of Object.keys(h.$attrs$))l.hasAttribute(p)&&!["key","ref","style","class"].includes(p)&&(h.$attrs$[p]=l[p]);h.$tag$=null,h.$flags$|=4,t.$vnode$=h,h.$elm$=u.$elm$=l.shadowRoot||l,TS=l["s-sc"],vK=(c.$flags$&1)!==0,DW=l["s-cr"],H5=!1,SS(u,h,i);{if(ia.$flags$|=1,bK){aRe(h.$elm$);for(const p of Ng){const f=p.$nodeToRelocate$;if(!f["s-ol"]){const g=lp.createTextNode("");g["s-nr"]=f,f.parentNode.insertBefore(f["s-ol"]=g,f)}}for(const p of Ng){const f=p.$nodeToRelocate$,g=p.$slotRefNode$;if(g){const _=g.parentNode;let v=g.nextSibling;{let b=(r=f["s-ol"])==null?void 0:r.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===f["s-sn"]&&_===w.parentNode){for(w=w.nextSibling;w===f||w?.["s-sr"];)w=w?.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&_!==f.parentNode||f.nextSibling!==v)&&f!==v&&(!f["s-hn"]&&f["s-ol"]&&(f["s-hn"]=f["s-ol"].parentNode.nodeName),_.insertBefore(f,v),f.nodeType===1&&(f.hidden=(n=f["s-ih"])!=null?n:!1)),f&&typeof g["s-rf"]=="function"&&g["s-rf"](f)}else f.nodeType===1&&(i&&(f["s-ih"]=(o=f.hidden)!=null?o:!1),f.hidden=!0)}}H5&&oRe(h.$elm$),ia.$flags$&=-2,Ng.length=0}if(Bg.experimentalScopedSlotChanges&&c.$flags$&2)for(const p of h.$elm$.childNodes)p["s-hn"]!==qC&&!p["s-sh"]&&(i&&p["s-ih"]==null&&(p["s-ih"]=(a=p.hidden)!=null?a:!1),p.hidden=!0);DW=void 0},qEt=(t,e)=>{},xK=(t,e)=>(t.$flags$|=16,qEt(t,t.$ancestorComponent$),fAt(()=>WEt(t,e))),WEt=(t,e)=>{const i=t.$hostElement$,r=Kw("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;let n;return e?n=U2(s,"componentWillLoad"):n=U2(s,"componentWillUpdate"),n=yde(n,()=>U2(s,"componentWillRender")),r(),yde(n,()=>XEt(t,s,e))},yde=(t,e)=>YEt(t)?t.then(e):e(),YEt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",XEt=async(t,e,i)=>{const r=t.$hostElement$,s=Kw("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&BEt(t);const n=Kw("render",t.$cmpMeta$.$tagName$);ZEt(t,e,r,i),n(),s(),JEt(t)},_de=null,ZEt=(t,e,i,r)=>{try{_de=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Bg.hasRenderFn||Bg.reflect)&&(Bg.vdomRender||Bg.reflect)&&(Bg.hydrateServerSide||HEt(t,e,r))}catch(l){j$(l,t.$hostElement$)}return _de=null,null},JEt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=Kw("postUpdate",e),s=i;t.$ancestorComponent$,U2(s,"componentDidRender"),t.$flags$&64?(U2(s,"componentDidUpdate"),r()):(t.$flags$|=64,U2(s,"componentDidLoad"),r())},$8t=t=>{{const e=CE(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&xK(e,!1),i}},U2=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){j$(r)}},QEt=(t,e)=>CE(t).$instanceValues$.get(e),KEt=(t,e,i,r)=>{const s=CE(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=NEt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const h=r.$watchers$[e];h&&h.map(p=>{try{l[p](i,o,e)}catch(f){j$(f,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;xK(s,!1)}}}},eAt=(t,e,i)=>{var r;const s=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const n=Object.entries(e.$members$);n.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,o,{get(){return QEt(this,o)},set(l){KEt(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;s.attributeChangedCallback=function(a,l,c){ia.jmp(()=>{var u;const h=o.get(a);if(this.hasOwnProperty(h))c=this[h],delete this[h];else{if(s.hasOwnProperty(h)&&typeof this[h]=="number"&&this[h]==c)return;if(h==null){const p=CE(this),f=p?.$flags$;if(f&&!(f&8)&&f&128&&c!==l){const _=this,v=(u=e.$watchers$)==null?void 0:u[a];v?.forEach(b=>{_[b]!=null&&_[b].call(_,c,l,a)})}return}}this[h]=c===null&&typeof this[h]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((r=e.$watchers$)!=null?r:{}),...n.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)==null||c.push([a,u])),u})]))}}return t},tAt=async(t,e,i,r)=>{let s;if(!(e.$flags$&32)&&(e.$flags$|=32,i.$lazyBundleId$,s=t.constructor,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=DEt(t)]);const a=eRe(i,e.$modeName$);if(!W5.has(a)){const l=Kw("registerStyles",i.$tagName$);UEt(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>xK(e,!0))()},vde=t=>{},iAt=t=>{if(!(ia.$flags$&1)){const e=CE(t),i=e.$cmpMeta$,r=Kw("connectedCallback",i.$tagName$);e.$flags$&1?(cRe(t,e,i.$listeners$),e?.$lazyInstance$?vde(e.$lazyInstance$):e?.$onReadyPromise$&&e.$onReadyPromise$.then(()=>vde(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&rAt(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),tAt(t,e,i)),r()}},rAt=t=>{const e=t["s-cr"]=lp.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},sAt=async t=>{if(!(ia.$flags$&1)){const e=CE(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},I8t=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){lAt(this,i)},connectedCallback(){iAt(this),r&&r.call(this)},disconnectedCallback(){sAt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,eAt(t,i)},L8t=(t,e)=>e,cRe=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=oAt(t,s),l=nAt(e,o),c=aAt(s);ia.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>ia.rel(a,n,l,c))})},nAt=(t,e)=>i=>{try{Bg.lazyLoad||t.$hostElement$[e](i)}catch(r){j$(r)}},oAt=(t,e)=>e&4?lp:e&8?H$:e&16?lp.body:t,aAt=t=>uAt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,uRe=new WeakMap,CE=t=>uRe.get(t),lAt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return cRe(t,i,e.$listeners$),uRe.set(t,i)},bde=(t,e)=>e in t,j$=(t,e)=>(0,console.error)(t,e),W5=new Map,cAt=[],H$=typeof window<"u"?window:{},lp=H$.document||{head:{}},D8t=H$.HTMLElement||class{},ia={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},uAt=(()=>{let t=!1;try{lp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),hAt=t=>Promise.resolve(t),dAt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),NW=!1,FW=[],hRe=[],dRe=(t,e)=>i=>{t.push(i),NW||(NW=!0,e&&ia.$flags$&4?pAt(kW):ia.raf(kW))},wde=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){j$(i)}t.length=0},kW=()=>{wde(FW),wde(hRe),(NW=FW.length>0)&&ia.raf(kW)},pAt=t=>hAt().then(t),N8t=dRe(FW,!1),fAt=dRe(hRe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function xde(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(JOe)||t.contains(ZOe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function mAt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?xde():document.addEventListener("DOMContentLoaded",()=>xde(),{once:!0}))}const gAt=mAt;gAt();let pRe;function yAt(){try{bEt(".")}catch{wEt(Ja(sr(pRe)))}}function Oz(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}pRe="components/assets";const fRe=Symbol("widget"),mRe=Symbol("widget-test-data"),_At=[],vAt={},Y5=new WeakMap;function gRe(t,e){let i=e.children;if(i?.length)for(let s=0;s<i.length;++s)i[s]=gRe(t,i[s]);else i=_At;const r=e.vnodeSelector;if(X5(r)){const s=e.properties||vAt,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:bAt,afterUpdate:wAt,afterRemoved:yRe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function bAt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,Y5.set(t,o),o.afterCreate?.(o,t),r.addHandles(Mi(()=>yRe(t))),queueMicrotask(()=>{o[mRe].projector.renderNow()})}function wAt(t,e,i,{widgetProperties:r}){const s=Y5.get(t);s&&(s.set(r),s.afterUpdate?.(s,t))}function yRe(t){const e=Y5.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),Y5.delete(t))}function X5(t){return typeof t=="function"&&t[fRe]}const Tde=new Set;function xAt(t){Tde.add(t),t.finally(()=>Tde.delete(t))}var _Re;const TAt="esri.widgets.Widget";let SAt=0;function vRe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?vRe(t[r],e[r]):t[r]=e[r]);return t}const CAt=gEt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e?.(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),u=f=>a?.call(n,f);n.addEventListener(c,u,l);const h=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=f=>{p?.(f),h()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(G1e(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let U6=!1,Ao=class extends e$(Ls.EventedAccessor){constructor(t,e){super(t,e),this._attached=!1,this._projector=CAt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=Mpe(async()=>{if(this._messageBundleProps?.length){const a=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:l,propertyName:c})=>{if(this.destroyed)return;let u=await Mge(l);this.uiStrings&&Object.keys(this.uiStrings)&&(u=vRe(ge(u),this.uiStrings)),this[c]=u}));if(this.destroyed)return;for(const l of a)l.status==="rejected"&&le.getLogger(this).error("widget-intl:locale-error",this.declaredClass,l.reason)}await this.loadLocale()}),yAt();const i="esri-widget-uid-"+Zk(),r=this.render.bind(this);this._trackingTarget=new ak(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const s=()=>({vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),n=()=>{var u;if(!this._readyForTrueRender||this.destroyed)return null;const a=r()??s(),l=a.properties??(a.properties={});if(l.key??(l.key=i),X5(a.vnodeSelector)){if(!this.visible)return s()}else this.visible?l.styles||(l.styles={}):(l.class="",l.styles={display:"none"}),(u=l.styles).display??(u.display="");let c=0;return a.children?.forEach(h=>{var p;X5(h.vnodeSelector)||(h.properties??(h.properties={}),(p=h.properties).key??(p.key=`${this.id}--${c++}`))}),gRe(this,a)};this.render=()=>{if(U6)return n();let a=Wqe(this)??null;if(a)return a;this._trackingTarget.clear(),U6=!0;try{a=n0(this._trackingTarget,n)}catch(l){throw le.getLogger(this).error(l),l}finally{U6=!1}return a&&Yqe(this,a),a};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),xAt(this._resourcesFetch)}normalizeCtorArgs(t,e){const i={...t};return e&&(i.container=e),i}postInitialize(){}beforeFirstRender(){const t=this.loadDependencies();return this._messageBundleProps?.length||t?Promise.all([t,this._loadLocale()]).then(()=>{}).catch(QK):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Oe(this._trackingTarget),Oe(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,OB(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return wU(t)}get domNode(){return this.container}set domNode(t){this.container=t}get icon(){return null}set icon(t){this._overrideIfSome("icon",t)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+SAt++}set id(t){t&&this._set("id",t)}get label(){return this.declaredClass.split(".").pop()}set label(t){this._overrideIfSome("label",t)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(t){this._set("visible",t)}get[(_Re=fRe,mRe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(OB(this),this._projector.scheduleRender())}own(t){rY(le.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(t)}classes(...t){return Xqe.apply(this,t)}renderNow(){OB(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(he(()=>this.viewModel,(e,i)=>{i&&this.removeHandles("delegated-events"),e&&sk(e)&&this.addHandles(this._delegatedEventNames.map(r=>qg(e,r,s=>{this.emit(r,s)})),"delegated-events")},qi)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(QK),this.scheduleRender()};this.addHandles([xme(t),he(()=>this.uiStrings,t),zl(()=>this.container,e=>{this.destroyed||this._attach(e)},{initial:!0,once:!0})])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){this._attached&&(this._projector.detach(this.render),this._attached=!1),t?.parentNode?.removeChild(t)}};Ao[_Re]=!0,d([m()],Ao.prototype,"_readyForTrueRender",void 0),d([m({value:null})],Ao.prototype,"container",null),d([cr("container")],Ao.prototype,"castContainer",null),d([m()],Ao.prototype,"icon",null),d([m()],Ao.prototype,"id",null),d([m()],Ao.prototype,"label",null),d([m()],Ao.prototype,"renderable",null),d([m()],Ao.prototype,"uiStrings",void 0),d([m()],Ao.prototype,"viewModel",void 0),d([m({value:!0})],Ao.prototype,"visible",null),d([m()],Ao.prototype,"key",void 0),d([m()],Ao.prototype,"children",void 0),d([m()],Ao.prototype,"afterCreate",void 0),d([m()],Ao.prototype,"afterUpdate",void 0),d([m()],Ao.prototype,"afterRemoved",void 0),Ao=d([U(TAt)],Ao);const q$=Ao;let iF,rF=null;const z2=new Map;async function F8t(t){rF==null&&(iF==null&&(iF=ue(()=>import("./Lyr3DWasmPerSceneView-185051b4.js"),["./Lyr3DWasmPerSceneView-185051b4.js","./ILyr3DWasmPerSceneView-b1ab6e1f.js","./WorkerHandle-becb41d0.js","./Lyr3DModule-8a2f3baf.js","./makeScheduleFunction-e2d1207a.js"],import.meta.url)),rF=await iF);const e=t.view;let i=z2.get(e);return i||(i=new rF.default({view:e}),z2.set(e,i)),await i.initializeWasm(),i.add3DTilesLayerView(t)}function EAt(t){return z2.get(t)}function k8t(t){const e=t.view,i=z2.get(e);i&&i.remove3DTilesLayerView(t)<1&&(z2.delete(e),z2.size===0&&(iF=null,rF=null))}function Sde(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function AAt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function LA(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function MAt(t){return t.type==="bing-maps"}const sg=[];let CS=class extends Pe{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new lt,this.view=null,this._allLayerViewsChange=e=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=this.view?.allLayerViews;i&&(this.addHandles(i.map(r=>he(()=>[r.suspended,r.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(r=>{r.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(r.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),e?.removed&&e.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.addHandles([yo(()=>this.view?.allLayerViews,"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),zl(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t?.allLayerViews;if(sg.length=0,!t||!e)return void this._clear();e.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const s=r.layer;if(Sde(s,"user"))return void LA(sg,r,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?LA(sg,r,this._getDynamicAttribution(o,t,s)):Sde(s)&&LA(sg,r,s.copyright))}return void this._fetchAttributionData(r)}const n="portalItem"in s?s.portalItem?.accessInformation:void 0;LA(sg,r,n||s.copyright)});const i=e.find(r=>r.layer?.type==="integrated-mesh-3dtiles");if(this.view&&i){const r=EAt(this.view);if(r){const s=r.getAttributionText();for(let n=0;n<s.length;++n)LA(sg,i,s[n])}}AAt(this.items,sg)&&(this.items.removeAll(),this.items.addMany(sg)),sg.length=0,this.notifyChange("state")}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await fp(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,MAt(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),u=a.zoomMax-(e&&a.zoomMax?1:0),h=new Qi({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:We.WGS84}),p={extent:DP(h),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let f=c;f<=u;f++)r[f]??(r[f]=[]),r[f].push(p)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(t,e,i){const{extent:r,scale:s}=e;let n=i.tileInfo?.scaleToZoom(s)??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!r||n==null||n<=-1)return"";const o=t[n],a=HR(r.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(c=>{const u=c.id,h=!l.has(u)&&a&&c.extent&&_Y(c.extent,a);return h&&l.add(u),h}).sort((c,u)=>u.score-c.score||c.objectId-u.objectId).map(c=>c.attribution).join(", "):""}};d([m({readOnly:!0,type:lt})],CS.prototype,"items",void 0),d([m({readOnly:!0})],CS.prototype,"state",null),d([m()],CS.prototype,"view",void 0),CS=d([U("esri.widgets.Attribution.AttributionViewModel")],CS);const bRe=CS,om={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function PAt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:RAt(t[e])}}}function OAt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function RAt(t){return function(e,...i){OAt(e)?e9e(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function WC(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var $At=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},wRe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?wRe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=$At(s)),e.push(s))}},IAt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return wRe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function is(t,e,...i){return typeof t!="function"||X5(t)?IAt(t,e,...i):t(e,...i)}function U8t(...t){return t}const DT="esri-attribution",NT={base:DT,poweredBy:`${DT}__powered-by`,sources:`${DT}__sources`,open:`${DT}--open`,sourcesOpen:`${DT}__sources--open`,link:`${DT}__link`};let Cl=class extends q${constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new bRe}initialize(){this.addHandles(yo(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[NT.open]:this._isOpen};return is("div",{bind:this,class:this.classes(NT.base,om.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return is("div",{class:NT.poweredBy},"Powered by"," ",is("a",{class:NT.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[NT.sourcesOpen]:e,[om.interactive]:i};return is("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(NT.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],Cl.prototype,"_isOpen",void 0),d([m()],Cl.prototype,"_isInteractive",null),d([m()],Cl.prototype,"_attributionTextOverflowed",void 0),d([m()],Cl.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Cl.prototype,"attributionText",null),d([m()],Cl.prototype,"icon",null),d([m()],Cl.prototype,"itemDelimiter",void 0),d([m()],Cl.prototype,"label",null),d([m(),WC("esri/widgets/Attribution/t9n/Attribution")],Cl.prototype,"messages",void 0),d([m()],Cl.prototype,"view",null),d([m({type:bRe})],Cl.prototype,"viewModel",void 0),d([PAt()],Cl.prototype,"_toggleState",null),Cl=d([U("esri.widgets.Attribution")],Cl);const LAt=Cl;function DAt(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}const NAt=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return rk(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return d([m()],e.prototype,"goToOverride",void 0),d([m()],e.prototype,"view",void 0),e=d([U("esri.widgets.support.GoTo")],e),e};let yb=class extends NAt(Pe){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(he(()=>this.view,this._updateRotationWatcher,Ki))}destroy(){this.view=null}get canShowNorth(){return DAt(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:se("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?he(()=>e?.rotation,this._updateForRotation,Ki):he(()=>e?.camera,this._updateForCamera,Ki))}};d([m({readOnly:!0})],yb.prototype,"canShowNorth",null),d([m({readOnly:!0})],yb.prototype,"orientation",void 0),d([m({readOnly:!0})],yb.prototype,"state",null),d([m()],yb.prototype,"view",void 0),yb=d([U("esri.widgets.Compass.CompassViewModel")],yb);const xRe=yb,Cde="esri-compass",Ede={base:Cde,iconContainer:`${Cde}__icon-container`};let Tg=class extends q${constructor(e,i){super(e,i),this.messages=null,this.viewModel=new xRe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return Oz({button:()=>ue(()=>import("./calcite-button-7bb2c1e3.js"),["./calcite-button-7bb2c1e3.js","./form-27f04ab4.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./interactive-d5976705.js","./label2-befbcd8e.js","./component-af7c3ce5.js","./loadable-596a369b.js","./t9n-51a20bbe.js","./key-00c523d6.js","./observers-39f112e1.js","./icon-8be2d493.js","./loader-eda99408.js"],import.meta.url),icon:()=>ue(()=>import("./calcite-icon-4cbce3a7.js"),["./calcite-icon-4cbce3a7.js","./icon-8be2d493.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./observers-39f112e1.js"],import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return is("div",{class:this.classes(Ede.base,om.widget)},is("calcite-button",{class:om.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},is("div",{"aria-hidden":"true",class:Ede.iconContainer,title:r.reset},is("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};d([m()],Tg.prototype,"goToOverride",null),d([m()],Tg.prototype,"icon",null),d([m()],Tg.prototype,"label",null),d([m(),WC("esri/widgets/Compass/t9n/Compass")],Tg.prototype,"messages",void 0),d([m()],Tg.prototype,"view",null),d([m({type:xRe})],Tg.prototype,"viewModel",void 0),Tg=d([U("esri.widgets.Compass")],Tg);const FAt=Tg,Ade="esri-navigation-toggle",Mde={base:Ade,isLayoutHorizontal:`${Ade}--horizontal`};let ES=class extends Pe{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(zl(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){const e=this.view?.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};d([m({readOnly:!0})],ES.prototype,"state",null),d([m()],ES.prototype,"_navigationMode",void 0),d([m()],ES.prototype,"view",void 0),ES=d([U("esri.widgets.NavigationToggle.NavigationToggleViewModel")],ES);const TRe=ES;let Sg=class extends q${constructor(e,i){super(e,i),this.messages=null,this.viewModel=new TRe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{(this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton)?.setFocus(),this.toggle()}}loadDependencies(){return Oz({button:()=>ue(()=>import("./calcite-button-7bb2c1e3.js"),["./calcite-button-7bb2c1e3.js","./form-27f04ab4.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./interactive-d5976705.js","./label2-befbcd8e.js","./component-af7c3ce5.js","./loadable-596a369b.js","./t9n-51a20bbe.js","./key-00c523d6.js","./observers-39f112e1.js","./icon-8be2d493.js","./loader-eda99408.js"],import.meta.url)})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r=this.messages.toggle;return is("div",{class:this.classes(Mde.base,om.widget,{[Mde.isLayoutHorizontal]:this.layout==="horizontal"})},is("calcite-button",{afterCreate:s=>{this._panButton=s},appearance:i?"outline-fill":"solid",class:om.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),is("calcite-button",{afterCreate:s=>{this._rotateButton=s},appearance:i?"solid":"outline-fill",class:om.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};d([m()],Sg.prototype,"icon",null),d([m()],Sg.prototype,"label",null),d([m({value:"vertical"})],Sg.prototype,"layout",null),d([m(),WC("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Sg.prototype,"messages",void 0),d([m()],Sg.prototype,"view",null),d([m({type:TRe})],Sg.prototype,"viewModel",void 0),Sg=d([U("esri.widgets.NavigationToggle")],Sg);const kAt=Sg;let _b=class extends Pe{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};d([m({readOnly:!0})],_b.prototype,"canZoomIn",null),d([m({readOnly:!0})],_b.prototype,"canZoomOut",null),d([m()],_b.prototype,"view",void 0),d([m()],_b.prototype,"_scale",null),_b=d([U("esri.widgets.Zoom.ZoomConditions2D")],_b);const UAt=_b;let AS=class extends Pe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],AS.prototype,"canZoomIn",null),d([m({readOnly:!0})],AS.prototype,"canZoomOut",null),d([m()],AS.prototype,"view",void 0),AS=d([U("esri.widgets.Zoom.ZoomConditions3D")],AS);const zAt=AS;let Qy=class extends Pe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new UAt({view:e}):e.type==="3d"&&(this._zoomConditions=new zAt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():vF(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():vF(e.goTo({zoomFactor:.5}))}};d([m()],Qy.prototype,"_zoomConditions",void 0),d([m()],Qy.prototype,"canZoomIn",null),d([m()],Qy.prototype,"canZoomOut",null),d([m({readOnly:!0})],Qy.prototype,"state",null),d([m()],Qy.prototype,"view",null),Qy=d([U("esri.widgets.Zoom.ZoomViewModel")],Qy);const SRe=Qy,Pde={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let Cg=class extends q${constructor(e,i){super(e,i),this.messages=null,this.viewModel=new SRe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Oz({button:()=>ue(()=>import("./calcite-button-7bb2c1e3.js"),["./calcite-button-7bb2c1e3.js","./form-27f04ab4.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./interactive-d5976705.js","./label2-befbcd8e.js","./component-af7c3ce5.js","./loadable-596a369b.js","./t9n-51a20bbe.js","./key-00c523d6.js","./observers-39f112e1.js","./icon-8be2d493.js","./loader-eda99408.js"],import.meta.url)})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Pde.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return is("div",{class:this.classes(Pde.base,om.widget,e)},is("calcite-button",{class:om.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),is("calcite-button",{class:om.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};d([m()],Cg.prototype,"icon",null),d([m()],Cg.prototype,"label",null),d([m({value:"vertical"})],Cg.prototype,"layout",null),d([m(),WC("esri/widgets/Zoom/t9n/Zoom")],Cg.prototype,"messages",void 0),d([m()],Cg.prototype,"view",null),d([m({type:SRe})],Cg.prototype,"viewModel",void 0),Cg=d([U("esri.widgets.Zoom")],Cg);const BAt=Cg;function VAt(t){return t?.view!==void 0}let sF=class extends uEt{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(i=>{const r=this._find(i),s=r?.widget;VAt(s)&&(s.view=e)})},this._componentsWatcher=(e,i)=>{this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([he(()=>this.components,this._componentsWatcher,Ki),he(()=>this.view,this._updateViewAwareWidgets,Ki)])}_add(t,e,i,r,s){let n=t;if(typeof t=="string"&&this._defaultPositionLookup[t]){if(this._find(t))return;n=this._createComponent(t)}super._add(n,e,i,r,s)}_removeComponents(t){t.forEach(e=>{const i=this._find(e);i&&(this.remove(i),i.destroy())})}_adjustPadding(t){if(!t.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(t){this.constructed&&t.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(t){const e=this._createWidget(t);return new tF({id:t,node:e})}_createWidget(t){const e=this.view;switch(t){case"attribution":return new LAt({view:e});case"compass":return new FAt({view:e});case"navigation-toggle":return new kAt({view:e});case"zoom":return new BAt({view:e})}}};d([m()],sF.prototype,"components",void 0),sF=d([U("esri.views.ui.DefaultUI")],sF);const CRe=sF;let nF=class extends CRe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],nF.prototype,"components",void 0),nF=d([U("esri.views.ui.3d.DefaultUI3D")],nF);const ERe=nF;let Je=class extends eqe(iWe(m9e(JWe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new g0({slicePlane:a1e},this),this._resourceController=Mvt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new b7({view:this}),this.labeler=new ub({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new xC,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Sb,this.environment=new dS,this.environmentManager=new yd,this.floors=new lt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new eYe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new A_t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new ERe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new DMe,e8e();const e=(i=null)=>{i!=null&&i.type===vr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([yo(()=>this.map?.allLayers,"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),he(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new Ztt({view:this}),this.stateManager=new ks({view:this})}initialize(){this.groundView=new j7e({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(yo(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Ki),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Ki),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>y3e(e>0?1e3/Math.ceil(e):0),Ki),this.updatingHandles.add(()=>this.map?.ground,t,qi),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),qi),this.addHandles(he(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Ji))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Oe(this.sharedSymbolResources),this._set("labeler",Oe(this.labeler)),this._set("deconflictor",Oe(this.deconflictor)),this._resourceController=Oe(this._resourceController),this._set("stateManager",Oe(this.stateManager)),this._set("inputManager",Oe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Oe(this.environmentManager)),this._set("environment",Oe(this.environment)),this.groundView=Oe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||qK(t,"clippingArea");return!this._userClippingArea&&!qK(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof Qi?this.spatialReference&&(e=XL(e,this.spatialReference),e==null)?(le.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(le.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?le.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Ne.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:XL(e,t)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||We.WGS84,i=XL(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||We.WGS84;let e;const i=n=>{const o=XL(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){const n=r.groundExtent;i(new Qi({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}castEnvironment(t){return t?t instanceof dS?t:t instanceof uC?this.environment?.cloneWithWebsceneEnvironment(t)??dS.fromWebsceneEnvironment(t):mo(dS,t):new dS}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){DN.isValidProfile(t)&&(DN.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||DN.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");yx(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?X8e(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get terrainScale(){return this.stateManager?.terrainScale}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?hx.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(e=!0,s.suspended||cW(s))return;++i,t+=s.updatingProgress}}else++i});for(const s of this._updatingObjects)s!=null&&s.updating&&(i+=.1,t+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++i,t+=s.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())||this.textures?.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const s=performance.now();if(t<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-n)+t*n}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?s:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return gB(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?gB(this.defaultsFromMap.viewingMode):YO(e,Ne.Global)?"global":"local":"global"}set viewingMode(t){this.ready?le.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Rvt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return le.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=ose(t)?nse(this,t):t;return G_t(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return le.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Bf(this.elevationProvider,t):null)??0;return ts(t,ZL,this.renderSpatialReference,e),this.state.camera.projectToScreen(ZL,z6),$h(z6[0],z6[1])}pixelSizeAt(t){return this.ready?t?(ts(t,ZL,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(ZL)):0:(le.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return le.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=ose(t)?nse(this,t):t;return V_t(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return lvt(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new W("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return I6(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return L6(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[L6(i[0],this._pixelFormat()),L6(i[1],this._pixelFormat())]}_completeSettings(t){const e=PCt(t,this);return e.pixelRatio/=this.state.pixelRatio,ICt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!se("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=I6(i[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[r,I6(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return pse.importLayerView(t)}hasLayerViewModule(t){return pse.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=tEt(this.type);const e=se("safari");if(e&&e<9&&(t=new W("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw le.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?Qte(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Ne.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Ne.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Ne.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Ne.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!YO(t,i)&&(e==null||!!Ote(e)||(!VP(e)||Az(e,t,i)!=null)&&(!Pte(e)||i!==Ne.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:s}=t;return Ote(e)&&(r||s)?!s||i===Ne.Local||XQ(e.tileInfo,e.fullExtent,t,Ne.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:We.WebMercator,viewingMode:i}]:[{spatialReference:r?We.WGS84:We.WebMercator,viewingMode:i}]:VP(e)||Pte(e)||!r&&!s?VP(e)&&r&&i!==Ne.Global?[{spatialReference:t,viewingMode:i},{spatialReference:We.WGS84,viewingMode:Ne.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?We.WGS84:We.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?le.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${gB(i)} viewing mode.`):t.isGeographic&&le.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return le.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{!r&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Mi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return vw(t.map(i=>this.highlight(i)));if(lt.isCollection(t))return vw(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Mi()}maskOccludee(t){if(!t)return le.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&n!=null&&YCt(n)&&(i=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Mi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await iC(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new W("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new yxt({view:this})),this._set("elevationProvider",new wP({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new El({view:this})),this._set("featureTiles",new Mo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?bv(_k(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>wr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ue(()=>import("./FeatureTileTree3DDebugger-24bc6fd4.js"),["./FeatureTileTree3DDebugger-24bc6fd4.js","./TileTreeDebugger-3a2898fc.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&wr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||wr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},qi),this.updatingHandles.add(()=>this.clippingArea,t,qi),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,qi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new nvt(this.map,t));const e=this.state.isGlobal,i=Y8e(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",dvt.create(this.state.viewingMode,i)),e||this.addHandles(he(()=>this.basemapTerrain?.extent,r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!xU(r,this.basemapTerrain.spatialReference,Ode,s)||(this.renderCoordsHelper.extent=Ode)},Ji),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(SC/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===vr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(he(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Ji),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Ka.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},e=new W_t(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=wU(this.surface);this._stage=new Qc({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Ki),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),qg(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new W("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(SC/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Oe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Dvt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ue(()=>import("./GraphicsView3D-1844db1d.js"),["./GraphicsView3D-1844db1d.js","./GraphicsProcessor-032fe6c3.js","./diffUtils-0e3a2a24.js","./Graphics3DObjectStates-d0fd362c.js","./UniqueValueRenderer-e5955946.js","./ColorStop-6a565283.js","./colorRamps-aa93f22c.js","./jsonUtils-e39cab6d.js","./FieldsIndex-e68ff75c.js","./UnknownTimeZone-bc39bc88.js","./heatmapUtils-b63f4199.js","./optimizedFeatureQueryEngineAdapter-1aff7530.js","./PooledRBush-db11685a.js","./quickselect-0cb10df8.js","./popupUtils-0412893d.js"],import.meta.url)).default;yt(t),await iC(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Qte(this.viewingMode);t===Ne.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(yo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e?.environment;i&&i1e(this.environment,i),this.timeExtent=e?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new r2(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Oe(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(nv);for(const t of this.map.allLayers.items)jO(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(nv);for(const t of this.map.allLayers.items)jO(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function XL(t,e){return t!=null&&Vl(t.spatialReference,e)?bv(t,e):null}Je.type="3d",d([m()],Je.prototype,"_userClippingArea",void 0),d([m()],Je.prototype,"_resourceController",void 0),d([m()],Je.prototype,"_stage",void 0),d([m({readOnly:!0})],Je.prototype,"deconflictor",void 0),d([m({readOnly:!0})],Je.prototype,"labeler",void 0),d([m(w4(xC,"analyses"))],Je.prototype,"analyses",void 0),d([m({type:EC,readOnly:!0})],Je.prototype,"animation",null),d([m({readOnly:!0})],Je.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],Je.prototype,"elevationProvider",void 0),d([m()],Je.prototype,"camera",null),d([m({type:Pu})],Je.prototype,"contentCamera",null),d([m({readOnly:!0})],Je.prototype,"canvas",void 0),d([m({type:Xe})],Je.prototype,"center",null),d([m({type:Qi})],Je.prototype,"clippingArea",null),d([m({type:Sb})],Je.prototype,"constraints",void 0),d([m({type:Qi,readOnly:!0})],Je.prototype,"renderDataExtent",null),d([m({readOnly:!0})],Je.prototype,"tileInfo",null),d([m({type:Qi,readOnly:!0})],Je.prototype,"dataExtent",null),d([m({type:Qi,readOnly:!0})],Je.prototype,"_groundAndLayersExtent",null),d([m({type:dS})],Je.prototype,"environment",void 0),d([cr("environment")],Je.prototype,"castEnvironment",null),d([m({readOnly:!0})],Je.prototype,"environmentManager",void 0),d([m({type:Qi})],Je.prototype,"extent",null),d([m()],Je.prototype,"floors",void 0),d([m()],Je.prototype,"screenCenter",null),d([m()],Je.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],Je.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],Je.prototype,"graphicsView",void 0),d([m({readOnly:!0})],Je.prototype,"analysisViewManager",void 0),d([m()],Je.prototype,"groundView",void 0),d([m({type:Boolean})],Je.prototype,"initialExtentRequired",null),d([m()],Je.prototype,"_defaultsFromMapSettings",null),d([m()],Je.prototype,"interacting",null),d([m()],Je.prototype,"stationary",null),d([m()],Je.prototype,"navigating",null),d([m()],Je.prototype,"map",void 0),d([m({readOnly:!0})],Je.prototype,"mapCoordsHelper",void 0),d([m()],Je.prototype,"padding",null),d([m({type:El,readOnly:!0})],Je.prototype,"pointsOfInterest",void 0),d([m({type:Mo,readOnly:!0})],Je.prototype,"featureTiles",void 0),d([m()],Je.prototype,"_featureTreeDebugger",void 0),d([m({type:Boolean})],Je.prototype,"screenSizePerspectiveEnabled",void 0),d([m({constructOnly:!0})],Je.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],Je.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],Je.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],Je.prototype,"state",void 0),d([m({readOnly:!0})],Je.prototype,"inputManager",void 0),d([m({readOnly:!0})],Je.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],Je.prototype,"qualityProfile",null),d([m({type:_ue,get(){let t=this._get("qualitySettings");return t||(t=new _ue,DN.apply(this.qualityProfile,t)),t}})],Je.prototype,"qualitySettings",void 0),d([m()],Je.prototype,"slicePlane",null),d([m({readOnly:!0})],Je.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],Je.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],Je.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Je.prototype,"resolution",null),d([m({type:Number})],Je.prototype,"scale",null),d([m()],Je.prototype,"heightModelInfo",null),d([m()],Je.prototype,"spatialReference",void 0),d([m({type:Boolean,constructOnly:!0})],Je.prototype,"alphaCompositingEnabled",void 0),d([m({constructOnly:!0})],Je.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],Je.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],Je.prototype,"type",void 0),d([m(),cr(t=>t instanceof CRe?t:_w(ERe,t))],Je.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Je.prototype,"updating",null),d([m()],Je.prototype,"_updatingObjects",null),d([m()],Je.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],Je.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],Je.prototype,"viewingMode",null),d([m({type:mp})],Je.prototype,"viewpoint",null),d([m({type:Number})],Je.prototype,"zoom",null),d([m({type:DMe})],Je.prototype,"highlightOptions",void 0),d([m({readOnly:!0})],Je.prototype,"quality",null),d([m({readOnly:!0})],Je.prototype,"resolutionScale",null),d([m()],Je.prototype,"textures",void 0),Je=d([U("esri.views.SceneView")],Je);const ZL=C(),z6=ns(),Ode=Vt(),GAt=Je;const B6="esri-identity-modal",V6={base:B6,info:`${B6}__info`,notice:`${B6}__notice`},jAt="ArcGIS Online";let Kc=class extends q${constructor(t,e){super(t,e),this.container=document.createElement("div"),this.error=null,this.oAuthPrompt=!1,this.open=!1,this.signingIn=!1,this.server=null,this.resource=null,this._usernameInputNode=null,this._passwordInputNode=null,document.body.appendChild(this.container)}loadDependencies(){return Oz({button:()=>ue(()=>import("./calcite-button-7bb2c1e3.js"),["./calcite-button-7bb2c1e3.js","./form-27f04ab4.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./interactive-d5976705.js","./label2-befbcd8e.js","./component-af7c3ce5.js","./loadable-596a369b.js","./t9n-51a20bbe.js","./key-00c523d6.js","./observers-39f112e1.js","./icon-8be2d493.js","./loader-eda99408.js"],import.meta.url),input:()=>ue(()=>import("./calcite-input-5060ba4a.js"),["./calcite-input-5060ba4a.js","./input2-dd4e7010.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./form-27f04ab4.js","./interactive-d5976705.js","./key-00c523d6.js","./label2-befbcd8e.js","./component-af7c3ce5.js","./loadable-596a369b.js","./t9n-51a20bbe.js","./observers-39f112e1.js","./icon-8be2d493.js"],import.meta.url),label:()=>ue(()=>import("./calcite-label-6d35420e.js"),["./calcite-label-6d35420e.js","./label2-befbcd8e.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./component-af7c3ce5.js"],import.meta.url),modal:()=>ue(()=>import("./calcite-modal-c75077ab.js"),["./calcite-modal-c75077ab.js","./conditionalSlot-298d9f1d.js","./observers-39f112e1.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./focusTrapComponent-c607dee9.js","./loadable-596a369b.js","./openCloseComponent-4b0993bf.js","./t9n-51a20bbe.js","./key-00c523d6.js","./component-af7c3ce5.js","./icon-8be2d493.js","./loader-eda99408.js","./scrim-2e62e3d6.js"],import.meta.url),notice:()=>ue(()=>import("./calcite-notice-499e665b.js"),["./calcite-notice-499e665b.js","./conditionalSlot-298d9f1d.js","./observers-39f112e1.js","./dom-4b2f4ae5.js","./guid-dbdce6d5.js","./loadable-596a369b.js","./t9n-51a20bbe.js","./key-00c523d6.js","./openCloseComponent-4b0993bf.js","./component-af7c3ce5.js","./icon-8be2d493.js"],import.meta.url)})}get title(){return this.commonMessages?.auth.signIn}render(){const{open:t,title:e,messages:i,signingIn:r,oAuthPrompt:s,server:n,resource:o,error:a}=this,{info:l,oAuthInfo:c,lblItem:u,invalidUser:h,noAuthService:p,lblUser:f,lblPwd:g,lblCancel:_,lblSigning:v,lblOk:b}=i;return is("div",{class:this.classes(V6.base,YOe())},is("form",{bind:this,onsubmit:this._submit},is("calcite-modal",{bind:this,open:t,outsideCloseDisabled:!0,scale:"s",widthScale:"s",onCalciteModalClose:this._cancel,onCalciteModalOpen:this._focusUsernameInput},is("div",{slot:"header"},e),is("div",{slot:"content"},is("div",{class:V6.info},l4e(s?c:l,{server:n&&/\.arcgis\.com/i.test(n)?jAt:n,resource:`(${o||u})`})),a?is("calcite-notice",{class:V6.notice,icon:"exclamation-mark-triangle",kind:"danger",open:!0},is("div",{slot:"message"},a.details?.httpStatus?h:p)):null,s?null:[is("calcite-label",null,f,is("calcite-input",{afterCreate:w=>this._usernameInputNode=w,autocomplete:"off",bind:this,name:"username",required:!0,spellcheck:!1,type:"text",value:""})),is("calcite-label",null,g,is("calcite-input",{afterCreate:w=>this._passwordInputNode=w,bind:this,name:"password",required:!0,type:"password",value:""}))]),is("calcite-button",{appearance:"outline",bind:this,onclick:this._cancel,slot:"secondary",type:"button",width:"full"},_),is("calcite-button",{loading:!!r,slot:"primary",type:"submit",width:"full"},r?v:b))))}_focusUsernameInput(){requestAnimationFrame(()=>{this._usernameInputNode?.setFocus()})}_cancel(){this._set("signingIn",!1),this.open=!1,this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(t){t.preventDefault(),this._set("signingIn",!0);const e=this.oAuthPrompt?{}:{username:this._usernameInputNode?.value,password:this._passwordInputNode?.value};this.emit("submit",e)}};d([m({readOnly:!0})],Kc.prototype,"container",void 0),d([m(),WC("esri/t9n/common")],Kc.prototype,"commonMessages",void 0),d([m()],Kc.prototype,"error",void 0),d([m(),WC("esri/identity/t9n/identity")],Kc.prototype,"messages",void 0),d([m()],Kc.prototype,"oAuthPrompt",void 0),d([m()],Kc.prototype,"open",void 0),d([m()],Kc.prototype,"signingIn",void 0),d([m()],Kc.prototype,"server",void 0),d([m({readOnly:!0})],Kc.prototype,"title",null),d([m()],Kc.prototype,"resource",void 0),Kc=d([U("esri.identity.IdentityModal")],Kc);const Rde=Kc,G6="esriJSAPIOAuth";class UW{constructor(e,i){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=i,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const i=Date.now();this.expires>i&&(this.expires-i)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),i=this.oAuthInfo;if(i?.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r||(r=e[i.authNamespace]={}),this.appId||(this.appId=i.appId),r[i.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(G6,JSON.stringify(e))}catch(s){return console.warn(s),!1}return!0}return!1}destroy(){const e=this._load(),i=this.oAuthInfo;if(i?.appId&&i?.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const r=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",s=new FormData;if(s.append("f","json"),s.append("auth_token",this.refreshToken||this.token),s.append("client_id",i.appId),s.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(r,s);else{const n=new XMLHttpRequest;n.open("POST",r),n.send(s)}}if(i?.authNamespace&&i.portalUrl&&this.storage){const r=e[i.authNamespace];if(r){delete r[i.portalUrl];try{this.storage.setItem(G6,JSON.stringify(e))}catch(s){console.log(s)}}}i&&(i._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),i=this.oAuthInfo;if(i?.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r&&(r=r[i.portalUrl],r&&(this.appId=r.appId,this.codeVerifier=r.codeVerifier,this.expires=r.expires,this.refreshToken=r.refreshToken,this.ssl=r.ssl,this.stateUID=r.stateUID,this.token=r.token,this.userId=r.userId))}}_load(){let e={};if(this.storage){const i=this.storage.getItem(G6);if(i)try{e=JSON.parse(i)}catch(r){console.warn(r)}}return e}}UW.prototype.declaredClass="esri.identity.OAuthCredential";var zW;let ca=zW=class extends Me{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return zW.fromJSON(this.toJSON())}};d([m({json:{write:!0}})],ca.prototype,"appId",void 0),d([m({json:{write:!0}})],ca.prototype,"authNamespace",void 0),d([m({json:{write:!0}})],ca.prototype,"expiration",void 0),d([m({json:{write:!0}})],ca.prototype,"flowType",void 0),d([m({json:{write:!0}})],ca.prototype,"forceLogin",void 0),d([m({json:{write:!0}})],ca.prototype,"forceUserId",void 0),d([m({json:{write:!0}})],ca.prototype,"locale",void 0),d([m({json:{write:!0}})],ca.prototype,"minTimeUntilExpiration",void 0),d([m({json:{write:!0}})],ca.prototype,"popup",void 0),d([m({json:{write:!0}})],ca.prototype,"popupCallbackUrl",void 0),d([m({json:{write:!0}})],ca.prototype,"popupWindowFeatures",void 0),d([m({json:{write:!0}})],ca.prototype,"portalUrl",void 0),d([m({json:{write:!0}})],ca.prototype,"preserveUrlHash",void 0),d([m({json:{write:!0}})],ca.prototype,"userId",void 0),ca=zW=d([U("esri.identity.OAuthInfo")],ca);const BW=ca;let eu=class extends Me{constructor(t){super(t),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};d([m({json:{write:!0}})],eu.prototype,"adminTokenServiceUrl",void 0),d([m({json:{write:!0}})],eu.prototype,"currentVersion",void 0),d([m({json:{write:!0}})],eu.prototype,"hasPortal",void 0),d([m({json:{write:!0}})],eu.prototype,"hasServer",void 0),d([m({json:{write:!0}})],eu.prototype,"owningSystemUrl",void 0),d([m({json:{write:!0}})],eu.prototype,"owningTenant",void 0),d([m({json:{write:!0}})],eu.prototype,"server",void 0),d([m({json:{write:!0}})],eu.prototype,"shortLivedTokenValidity",void 0),d([m({json:{write:!0}})],eu.prototype,"tokenServiceUrl",void 0),d([m({json:{write:!0}})],eu.prototype,"webTierAuth",void 0),eu=d([U("esri.identity.ServerInfo")],eu);const j6=eu,oF={},ARe=t=>{const e=new vc(t.owningSystemUrl).host,i=new vc(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},VW=(t,e)=>!!(ARe(t)&&e&&e.some(i=>i.test(t.server)));let aF=null,lF=null;try{aF=window.localStorage,lF=window.sessionStorage}catch{}class MRe extends Ls{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=Hs(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^/]+\/[^/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^/]+).*/i,this._gwItem=/http.+\/items\/([^/]+).*/i,this._gwGroup=/http.+\/groups\/([^/]+).*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getPlatformSelfError=null,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const i=this.serverInfos;i?(e=e.filter(r=>!this.findServerInfo(r.server)),this.serverInfos=i.concat(e)):this.serverInfos=e,e.forEach(r=>{r.owningSystemUrl&&this._portals.push(r.owningSystemUrl),r.hasPortal&&this._portals.push(r.server)})}registerOAuthInfos(e){const i=this.oAuthInfos;if(i){for(const r of e){const s=this.findOAuthInfo(r.portalUrl);s&&i.splice(i.indexOf(s),1)}this.oAuthInfos=i.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const i=this._sanitizeUrl(e.server),r=this._isServerRsrc(i);let s,n=this.findServerInfo(i),o=!0;n||(n=new j6,n.server=this._getServerInstanceRoot(i),r?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(i),n.hasPortal=!0),this.registerServers([n])),s=this._findCredential(i),s?(delete e.server,Object.assign(s,e),o=!1):(s=new zs({userId:e.userId,server:n.server??void 0,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?"server":"portal"}),s.resources=[i],this.credentials.push(s)),s.emitTokenChange(!1),o||s.refreshServerTokens()}toJSON(){return K5({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const i=e.serverInfos,r=e.oAuthInfos,s=e.credentials;if(i){const n=[];i.forEach(o=>{o.server&&o.tokenServiceUrl&&n.push(o.declaredClass?o:new j6(o))}),n.length&&this.registerServers(n)}if(r){const n=[];r.forEach(o=>{o.appId&&n.push(o.declaredClass?o:new BW(o))}),n.length&&this.registerOAuthInfos(n)}s&&s.forEach(n=>{n.server&&n.token&&n.expires&&n.expires>Date.now()&&((n=n.declaredClass?n:new zs(n)).emitTokenChange(),this.credentials.push(n))})}findServerInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){i=r;break}return i}findOAuthInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){i=r;break}return i}findCredential(e,i){if(!e)return;let r;e=this._sanitizeUrl(e);const s=this._isServerRsrc(e)?"server":"portal";if(i){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,e)&&i===n.userId&&n.scope===s){r=n;break}}else for(const n of this.credentials)if(this._hasSameServerInstance(n.server,e)&&this._getIdenticalSvcIdx(e,n)!==-1&&n.scope===s){r=n;break}return r}getCredential(e,i){let r,s,n=!0;i&&(r=!!i.token,s=i.error,n=i.prompt!==!1),i={...i},e=this._sanitizeUrl(e);const o=new AbortController,a=Pn();if(i.signal&&un(i.signal,()=>{o.abort()}),un(o,()=>{a.reject(new W("identity-manager:user-aborted","ABORTED"))}),qn(o))return a.promise;i.signal=o.signal;const l=this._isAdminResource(e),c=r?this.findCredential(e):null;let u;if(c&&s&&s.details&&s.details.httpStatus===498)c.destroy();else if(c)return u=new W("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+e,{error:s}),a.reject(u),a.promise;const h=this._findCredential(e,i);if(h)return a.resolve(h),a.promise;let p=this.findServerInfo(e);if(p)!p.hasPortal&&p.server&&p.owningSystemUrl&&this._hasSameServerInstance(p.server,p.owningSystemUrl)&&(p.hasPortal=!0),!p.hasServer&&this._isServerRsrc(e)&&(p._restInfoPms=this._getTokenSvcUrl(e),p.hasServer=!0);else{const f=this._getTokenSvcUrl(e);if(!f)return u=new W("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),a.reject(u),a.promise;p=new j6,p.server=this._getServerInstanceRoot(e),typeof f=="string"?(p.tokenServiceUrl=f,p.hasPortal=!0):(p._restInfoPms=f,p.hasServer=!0),this.registerServers([p])}return p.hasPortal&&p._selfReq===void 0&&(n||ac(p.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(f=>f.tokenServiceUrl===p.tokenServiceUrl))&&(p._selfReq={owningTenant:i?.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,p,i,a,l)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,i,r){const s=this._rePortalTokenSvc.test(e.tokenServiceUrl),n=new vc(this._appOrigin),o=e.shortLivedTokenValidity;let a,l,c,u,h,p,f,g;i&&(g=this.tokenValidity||o||this._defaultTokenValidity,g>o&&o>0&&(g=o)),r&&(a=r.isAdmin,l=r.serverUrl,c=r.token,p=r.signal,f=r.ssl,e.customParameters=r.customParameters),a?u=e.adminTokenServiceUrl:(u=e.tokenServiceUrl,h=new vc(u.toLowerCase()),e.webTierAuth&&r?.serverUrl&&!f&&n.scheme==="http"&&(ac(n.uri,u,!0)||h.scheme==="https"&&n.host===h.host&&n.port==="7080"&&h.port==="7443")&&(u=u.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:i?.username,password:i?.password,serverUrl:l,token:c,expiration:g,referer:a||s?this._appOrigin:null,client:a?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,r),signal:p,...r?.ioArgs};return s||(_.withCredentials=!1),Yi(u,_).then(v=>{const b=v.data;if(!b?.token)return new W("identity-manager:authentication-failed","Unable to generate token");const w=e.server;return oF[w]||(oF[w]={}),i&&(oF[w][i.username]=i.password),b.validity=g,b})}isBusy(){return!!this._busy}async checkSignInStatus(e){return(await this.checkAppAccess(e,"")).credential}checkAppAccess(e,i,r){let s=!1;return this.getCredential(e,{prompt:!1}).then(n=>{let o;const a={f:"json"};if(n.scope==="portal")if(i&&(this._doPortalSignIn(e)||r?.force))o=n.server+"/sharing/rest/oauth2/validateAppAccess",a.client_id=i;else{if(!n.token)return{credential:n};o=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};o=n.server+"/rest/services"}return n.token&&(a.token=n.token),Yi(o,{query:a,authMode:"anonymous"}).then(l=>{if(l.data.valid===!1)throw new W("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,l.data);return s=!!l.data.viewOnlyUserTypeApp,{credential:n}}).catch(l=>{if(l.name==="identity-manager:not-authorized")throw l;const c=l.details?.httpStatus;if(c===498)throw n.destroy(),new W("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new W("identity-manager:invalid-request");return{credential:n}})}).then(n=>({credential:n.credential,viewOnly:s}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.substring(1)),this._processOAuthPopupParams(Ib(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,i,r={}){const s=Pn(),n=()=>{l?.remove(),c?.remove(),this.dialog?.destroy(),this.dialog=l=c=null},o=()=>{n(),this._oAuthDfd=null,s.reject(new W("identity-manager:user-aborted","ABORTED"))};r.signal&&un(r.signal,()=>{o()});const a=new Rde({open:!0,resource:this.getResourceName(e),server:i.server});this.dialog=a,this.emit("dialog-create");let l=a.on("cancel",o),c=a.on("submit",u=>{this.generateToken(i,u,{isAdmin:r.isAdmin,signal:r.signal}).then(h=>{n();const p=new zs({userId:u.username,server:i.server??void 0,token:h.token,expires:h.expires!=null?Number(h.expires):null,ssl:!!h.ssl,isAdmin:r.isAdmin,validity:h.validity});s.resolve(p)}).catch(h=>{a.error=h,a.signingIn=!1})});return s.promise}oAuthSignIn(e,i,r,s){this._oAuthDfd=Pn();const n=this._oAuthDfd;let o;s?.signal&&un(s.signal,()=>{const p=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;p&&!p.closed?p.close():this.dialog&&u()}),n.resUrl_=e,n.sinfo_=i,n.oinfo_=r;const a=r._oAuthCred;if(a.storage&&(r.flowType==="authorization-code"||r.flowType==="auto"&&i.currentVersion>=8.4)){let p=crypto.getRandomValues(new Uint8Array(32));o=Nz(p),a.codeVerifier=o,p=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=Nz(p),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let l,c;this._getCodeChallenge(o).then(p=>{const f=!s||s.oAuthPopupConfirmation!==!1;if(!r.popup||!f)return void this._doOAuthSignIn(e,i,r,p);const g=new Rde({oAuthPrompt:!0,server:i.server,open:!0});this.dialog=g,this.emit("dialog-create"),l=g.on("cancel",u),c=g.on("submit",()=>{h(),this._doOAuthSignIn(e,i,r,p)})});const u=()=>{h(),this._oAuthDfd=null,n.reject(new W("identity-manager:user-aborted","ABORTED"))},h=()=>{l?.remove(),c?.remove(),this.dialog?.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=qg(window,"message",i=>{if((i.origin===this._appOrigin||i.origin.endsWith(".arcgis.com"))&&i.data?.type==="arcgis:auth:requestCredential"){const r=i.source;this.getCredential(e).then(s=>{r.postMessage({type:"arcgis:auth:credential",credential:{expires:s.expires,server:s.server,ssl:s.ssl,token:s.token,userId:s.userId}},i.origin)}).catch(s=>{r.postMessage({type:"arcgis:auth:error",error:{name:s.name,message:s.message}},i.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.substring(1));const r=Ib(e);let s=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),r.state.portalUrl&&(this._oAuthLocationParams=r,s=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(s=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}s&&(window.location.hash=r.state?.hash||"")}let i=window.location.search;if(i){i.charAt(0)==="?"&&(i=i.substring(1));const r=Ib(i);let s=!1;if(r.code&&r.state)try{r.state=JSON.parse(r.state),r.state.portalUrl&&r.state.uid&&(this._oAuthLocationParams=r,s=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(s=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}if(s){const n={...r};["code","error","error_description","message_code","persist","state"].forEach(l=>{delete n[l]});const o=Tw(n),a=window.location.pathname+(o?`?${o}`:"")+(r.state?.hash||"");window.history.replaceState(window.history.state,"",a)}}}_getOAuthToken(e,i,r,s,n){return e=e.replace(/^http:/i,"https:"),Yi(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:s&&n?{grant_type:"authorization_code",code:i,redirect_uri:s,client_id:r,code_verifier:n}:{grant_type:"refresh_token",refresh_token:i,client_id:r}}).then(o=>o.data)}async _getCodeChallenge(e){if(e&&globalThis.isSecureContext){const i=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",i);return Nz(new Uint8Array(r))}return null}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const i=new W("identity-manager:user-aborted","ABORTED");this._errbackFunc(i)}}_findCredential(e,i){let r,s,n,o,a=-1;const l=i?.token,c=i?.resource,u=this._isServerRsrc(e)?"server":"portal",h=this.credentials.filter(p=>this._hasSameServerInstance(p.server,e)&&p.scope===u);if(e=c||e,h.length)if(h.length===1){if(r=h[0],n=this.findServerInfo(r.server),s=n?.owningSystemUrl,o=s?this.findCredential(s,r.userId):void 0,a=this._getIdenticalSvcIdx(e,r),!l)return a===-1&&r.resources.push(e),this._addResource(e,o),r;a!==-1&&(r.resources.splice(a,1),this._removeResource(e,o))}else{let p,f;if(h.some(g=>(f=this._getIdenticalSvcIdx(e,g),f!==-1&&(p=g,n=this.findServerInfo(p.server),s=n?.owningSystemUrl,o=s?this.findCredential(s,p.userId):void 0,a=f,!0))),l)p&&(p.resources.splice(a,1),this._removeResource(e,o));else if(p)return this._addResource(e,o),p}}_findOAuthInfo(e){let i=this.findOAuthInfo(e);if(!i){for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){i=r;break}}return i}_addResource(e,i){i&&this._getIdenticalSvcIdx(e,i)===-1&&i.resources.push(e)}_removeResource(e,i){let r=-1;i&&(r=this._getIdenticalSvcIdx(e,i),r>-1&&i.resources.splice(r,1))}_useProxy(e,i){return i?.isAdmin&&!ac(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!ac(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const i=new vc(e);return i.scheme+"://"+i.host+(i.port!=null?":"+i.port:"")}_getServerInstanceRoot(e){const i=e.toLowerCase();let r=i.indexOf(this._agsRest);return r===-1&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),r!==-1||Wpe(i)||(r=i.indexOf("/sharing")),r===-1&&i.endsWith("/")&&(r=i.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,i){return e.endsWith("/")&&(e=e.slice(0,-1)),e=e.toLowerCase(),i=this._getServerInstanceRoot(i).toLowerCase(),e=CF(e),i=CF(i),(e=e.substring(e.indexOf(":")))===(i=i.substring(i.indexOf(":")))}_sanitizeUrl(e){const i=(Gi.request.proxyUrl||"").toLowerCase(),r=i?e.toLowerCase().indexOf(i+"?"):-1;return r!==-1&&(e=e.substring(r+i.length+1)),e=ip(e),Hs(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,i){let r=!1;if(this._isRESTService(e)&&this._isRESTService(i)){const s=this._getSuffix(e).toLowerCase(),n=this._getSuffix(i).toLowerCase();if(r=s===n,!r){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;r=s.replaceAll(o,"$1")===n.replaceAll(o,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(i)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(i)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const i=new vc(e.toLowerCase()),r=this._portalConfig;let s=this._gwDomains.some(n=>n.regex.test(i.uri));return!s&&r&&(s=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),i.uri)),s||Gi.portalUrl&&(s=ac(i,Gi.portalUrl,!0)),s||(s=this._portals.some(n=>this._hasSameServerInstance(n,i.uri))),s=s||this._agsPortal.test(i.path),s}_isIdProvider(e,i){let r=-1,s=-1;this._gwDomains.forEach((o,a)=>{r===-1&&o.regex.test(e)&&(r=a),s===-1&&o.regex.test(i)&&(s=a)});let n=!1;if(r>-1&&s>-1&&(r===0||r===4?s!==0&&s!==4||(n=!0):r===1?s!==1&&s!==2||(n=!0):r===2?s===2&&(n=!0):r===3&&s===3&&(n=!0)),!n){const o=this.findServerInfo(i),a=o?.owningSystemUrl;a&&ARe(o)&&this._isPortalDomain(a)&&this._isIdProvider(e,a)&&(n=!0)}return n}_getIdenticalSvcIdx(e,i){let r=-1;for(let s=0;s<i.resources.length;s++){const n=i.resources[s];if(this._isIdenticalService(e,n)){r=s;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let i,r,s;if(this._isRESTService(e)||this._isAdminResource(e)){const n=this._getServerInstanceRoot(e);return i=n+"/admin/generateToken",r=Yi(e=n+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:i,promise:r}}if(this._isPortalDomain(e)){let n="";if(this._gwDomains.some(o=>(o.regex.test(e)&&(n=o.tokenServiceUrl),!!n)),n||this._portals.some(o=>(this._hasSameServerInstance(o,e)&&(n=o+this._gwTokenUrl),!!n)),n||(s=e.toLowerCase().indexOf("/sharing"),s!==-1&&(n=e.substring(0,s)+this._gwTokenUrl)),n||(n=this._getOrigin(e)+this._gwTokenUrl),n){const o=new vc(e).port;/^http:\/\//i.test(e)&&o==="7080"&&(n=n.replace(/:7080/i,":7443")),n=n.replace(/http:/i,"https:")}return n}}_processOAuthResponseParams(e,i,r){const s=i._oAuthCred;if(e.code){const o=s.codeVerifier;return s.codeVerifier=null,s.stateUID=null,s.save(),this._getOAuthToken(r.server,e.code,i.appId,this._getRedirectURI(i,!0),o).then(a=>{const l=new zs({userId:a.username,server:r.server??void 0,token:a.access_token,expires:Date.now()+1e3*a.expires_in,ssl:a.ssl,oAuthState:e.state,_oAuthCred:s});return i.userId=l.userId,s.storage=a.persist?aF:lF,s.refreshToken=a.refresh_token,s.token=null,s.expires=a.refresh_token_expires_in?Date.now()+1e3*a.refresh_token_expires_in:null,s.userId=l.userId,s.ssl=l.ssl,s.save(),l})}const n=new zs({userId:e.username,server:r.server??void 0,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:s});return i.userId=n.userId,s.storage=e.persist?aF:lF,s.refreshToken=null,s.token=n.token,s.expires=n.expires,s.userId=n.userId,s.ssl=n.ssl,s.save(),Promise.resolve(n)}_processOAuthPopupParams(e){const i=this._oAuthDfd;if(this._oAuthDfd=null,i)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const r=e.error==="access_denied",s=new W(r?"identity-manager:user-aborted":"identity-manager:authentication-failed",r?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);i.reject(s)}else this._processOAuthResponseParams(e,i.oinfo_,i.sinfo_).then(r=>{i.resolve(r)}).catch(r=>{i.reject(r)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.substring(1)),this._processOAuthPopupParams(Ib(e)))}async _exchangeToken(e,i,r){return(await Yi(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:i,token:r}})).data.token}async _getPlatformSelf(e,i){if(this._getPlatformSelfError&&Date.now()-this._getPlatformSelfError[1]<1e3)throw this._getPlatformSelfError[0];e=e.replace(/^http:/i,"https:");try{const r=await Yi(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":i,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0});return this._getPlatformSelfError=null,r.data}catch(r){throw r.details?.messageCode==="OAUTH_0066"&&(this._getPlatformSelfError=[r,Date.now()]),r}}_getPortalSelf(e,i){let r;return this._gwDomains.some(s=>(s.regex.test(e)&&(r=s.customBaseUrl),!!r)),r?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:r,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(i)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),Yi(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(s=>s.data))}_doPortalSignIn(e){const i=this._portalConfig,r=window.location.href,s=this.findServerInfo(e);return!(!i&&!this._isPortalDomain(r)||!(s?s.hasPortal||s.owningSystemUrl&&this._isPortalDomain(s.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(r,e)||i&&(this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e)||this._isIdProvider(i.restBaseUrl,e))||ac(r,e,!0)))}_checkProtocol(e,i,r,s){let n=!0;const o=s?i.adminTokenServiceUrl:i.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&VR(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:i}),!n)&&r(new W("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(e,i,r,s,n,o){return s||(s=Pn()),s.resUrl_=e,s.sinfo_=i,s.options_=r,s.admin_=n,s.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const i=c=>{const u=e.options_?.resource,h=e.resUrl_,p=e.refresh_;let f=!1;this.credentials.includes(c)||(p&&this.credentials.includes(p)?(p.userId=c.userId,p.token=c.token,p.expires=c.expires,p.validity=c.validity,p.ssl=c.ssl,p.creationTime=c.creationTime,f=!0,c=p):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(u||h)||c.resources.push(u||h),c.scope=this._isServerRsrc(h)?"server":"portal",c.emitTokenChange();const g=this._soReqs,_={};this._soReqs=[],g.forEach(v=>{if(!this._isIdenticalService(h,v.resUrl_)){const b=this._getSuffix(v.resUrl_);_[b]||(_[b]=!0,c.resources.push(v.resUrl_))}}),e.resolve(c),g.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(h),v.resUrl_)?v.resolve(c):this._soReqs.push(v)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,f||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=c=>{e.reject(c),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(c,u,h,p)=>{const f=e.sinfo_,g=!e.options_||e.options_.prompt!==!1,_=f.hasPortal&&this._findOAuthInfo(e.resUrl_);let v,b;if(c)i(new zs({userId:c,server:f.server??void 0,token:h??void 0,expires:p!=null?Number(p):null,ssl:!!u}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const w=qg(window,"message",T=>{T.source===window.parent&&T.data&&(T.data.type==="arcgis:auth:credential"?(w.remove(),T.data.credential.expires<Date.now()?r(new W("identity-manager:credential-request-failed","Parent application's token has expired.")):i(new zs(T.data.credential))):T.data.type==="arcgis:auth:error"&&(w.remove(),T.data.error.name==="tokenExpiredError"?r(new W("identity-manager:credential-request-failed","Parent application's token has expired.")):r(W.fromJSON(T.data.error))))});un(e.options_?.signal,()=>{w.remove()})}else if(_){let w=_._oAuthCred;if(!w){const T=new UW(_,aF),S=new UW(_,lF);T.isValid()&&S.isValid()?T.expires>S.expires?(w=T,S.destroy()):(w=S,T.destroy()):w=T.isValid()?T:S,_._oAuthCred=w}if(w.isValid()){v=new zs({userId:w.userId??void 0,server:f.server??void 0,token:w.token??void 0,expires:w.expires,ssl:w.ssl??void 0,_oAuthCred:w});const T=_.appId!==w.appId&&this._doPortalSignIn(e.resUrl_);T||w.refreshToken?(e._pendingDfd=w.refreshToken?this._getOAuthToken(f.server,w.refreshToken,w.appId).then(S=>(v.expires=Date.now()+1e3*S.expires_in,v.token=S.access_token,v)):Promise.resolve(v),e._pendingDfd.then(S=>T?this._exchangeToken(S.server,_.appId,S.token).then(A=>(S.token=A,S)).catch(()=>S):S).then(S=>{i(S)}).catch(()=>{w?.destroy(),s()})):i(v)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===w.stateUID&&w.codeVerifier)){const T=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(T,_,f).then(S=>{i(S)}).catch(r)}else{const T=()=>{g?e._pendingDfd=this.oAuthSignIn(e.resUrl_,f,_,e.options_).then(i,r):(b=new W("identity-manager:not-authenticated","User is not signed in."),r(b))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(f.server,_.appId).then(S=>{ac(S.portalUrl,this._appOrigin,!0)?(v=new zs({userId:S.username,server:f.server??void 0,expires:Date.now()+1e3*S.expires_in,token:S.token}),i(v)):T()}).catch(T):T()}}else if(g){if(this._checkProtocol(e.resUrl_,f,r,e.admin_)){let w=e.options_;e.admin_&&(w=w||{},w.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,f,w).then(i,r)}}else b=new W("identity-manager:not-authenticated","User is not signed in."),r(b)},n=()=>{const c=e.sinfo_,u=c.owningSystemUrl,h=e.options_;let p,f,g,_;if(h&&(p=h.token,f=h.error,g=h.prompt),_=this._findCredential(u,{token:p,resource:e.resUrl_}),!_){for(const v of this.credentials)if(this._isIdProvider(u,v.server)){_=v;break}}if(_){const v=this.findCredential(e.resUrl_,_.userId);if(v)i(v);else if(VW(c,this._legacyFed)){const b=_.toJSON();b.server=c.server,b.resources=null,i(new zs(b))}else(e._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:e.resUrl_,token:_.token,signal:e.options_.signal,ssl:_.ssl})).then(b=>{i(new zs({userId:_?.userId,server:c.server??void 0,token:b.token,expires:b.expires!=null?Number(b.expires):null,ssl:!!b.ssl,isAdmin:e.admin_,validity:b.validity}))},r)}else this._busy=null,p&&(e.options_.token=null),(e._pendingDfd=this.getCredential(u.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:c.owningTenant,signal:e.options_.signal,token:p,error:f,prompt:g})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},v=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(v)})};this._errbackFunc=r;const o=e.sinfo_.owningSystemUrl,a=this._isServerRsrc(e.resUrl_),l=e.sinfo_._restInfoPms;l?l.promise.then(c=>{const u=e.sinfo_;if(u._restInfoPms){u.adminTokenServiceUrl=u._restInfoPms.adminUrl,u._restInfoPms=null,u.tokenServiceUrl=(Vg("authInfo.tokenServicesUrl",c)||Vg("authInfo.tokenServiceUrl",c)||Vg("tokenServiceUrl",c))??null,u.shortLivedTokenValidity=Vg("authInfo.shortLivedTokenValidity",c)??null,u.currentVersion=c.currentVersion,u.owningTenant=c.owningTenant;const h=u.owningSystemUrl=c.owningSystemUrl;h&&this._portals.push(h)}a&&u.owningSystemUrl?n():s()},()=>{e.sinfo_._restInfoPms=null;const c=new W("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");r(c)}):a&&o?n():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(c=>{const u={};let h,p,f,g;return c&&(h=c.user?.username,u.username=h,u.allSSL=c.allSSL,p=c.supportsOAuth,g=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(f=c.customBaseUrl),e.sinfo_.currentVersion=g),e.sinfo_.webTierAuth=!!h,h&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:u.allSSL}).catch(()=>null).then(_=>(u.portalToken=_?.token,u.tokenExpiration=_?.expires,u)):!h&&p&&g>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:f,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>u):u}).catch(()=>null).then(c=>{e.sinfo_._selfReq=null,c?s(c.username,c.allSSL,c.portalToken,c.tokenExpiration):s()}):s()}_generateOAuthInfo(e){let i,r=null,s=e.portalUrl;const n=e.customBaseUrl,o=e.owningTenant,a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){r=window.location.href;let l=r.indexOf("?");l>-1&&(r=r.slice(0,l)),l=r.search(/\/(apps|home)\//),r=l>-1?r.slice(0,l):null}return a&&r?(this._hasTestedIfAppIsOnPortal=!0,i=Yi(r+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new BW({appId:"arcgisonline",popupCallbackUrl:r+"/home/oauth-callback.html"})})):i=Promise.resolve(),i.then(()=>{if(this._defaultOAuthInfo)return s=s.replace(/^http:/i,"https:"),Yi(s+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:Ja(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const c=this._defaultOAuthInfo.clone();l.data.urlKey&&n?c.portalUrl="https://"+l.data.urlKey.toLowerCase()+"."+n:c.portalUrl=s,c.popup=window!==window.top||!(ac(s,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(s)&&u.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(e,i,r,s){const n=r._oAuthCred,o={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),n.stateUID&&(o.uid=n.stateUID);const a={client_id:r.appId,response_type:n.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:r.expiration,locale:r.locale,redirect_uri:this._getRedirectURI(r,!!n.codeVerifier)};r.forceLogin&&(a.force_login=!0),r.forceUserId&&r.userId&&(a.prepopulatedusername=r.userId),!r.popup&&this._doPortalSignIn(e)&&(a.redirectToUserOrgUrl=!0),n.codeVerifier&&(a.code_challenge=s||n.codeVerifier,a.code_challenge_method=s?"S256":"plain");const l=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=l+"?"+Tw(a);if(r.popup){const u=window.open(c,"esriJSAPIOAuth",r.popupWindowFeatures);if(u)u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(()=>{if(u.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const h=this._oAuthDfd;if(h){const p=new W("identity-manager:user-aborted","ABORTED");h.reject(p)}}},500),this._oAuthOnPopupHandle=qg(window,["arcgis:auth:hash","arcgis:auth:location:search"],h=>{h.type==="arcgis:auth:hash"?this.setOAuthResponseHash(h.detail):this._setOAuthResponseQueryString(h.detail)});else{const h=new W("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(h)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:a,authorizeUrl:l,resourceUrl:e,serverInfo:i,oAuthInfo:r}):window.location.href=c}_getRedirectURI(e,i){const r=window.location.href.replace(/#.*$/,"");if(e.popup)return Ja(e.popupCallbackUrl);if(i){const s=Hs(r);return s.query&&["code","error","error_description","message_code","persist","state"].forEach(n=>{delete s.query[n]}),iD(s.path,s.query)}return r}}MRe.prototype.declaredClass="esri.identity.IdentityManagerBase";let zs=class extends Ls.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t?._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const t=Jr,e=t.findServerInfo(this.server),i=e?.owningSystemUrl,r=!!i&&this.scope==="server",s=r&&VW(e,t._legacyFed),n=e.webTierAuth,o=n&&t.normalizeWebTierAuth,a=oF[this.server],l=a?.[this.userId];let c,u=this.resources&&this.resources[0],h=r?t.findServerInfo(i):null,p={username:this.userId,password:l};if(n&&!o)return;r&&!h&&t.serverInfos.some(g=>(t._isIdProvider(i,g.server)&&(h=g),!!h));const f=h?t.findCredential(h.server,this.userId):null;if(!r||f){if(!s){if(r)c={serverUrl:u,token:f?.token,ssl:f?.ssl};else if(o)p=null,c={ssl:this.ssl};else{if(!l){let g;return u&&(u=t._sanitizeUrl(u),this._enqueued=1,g=t._enqueue(u,e,null,null,this.isAdmin,this),g.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),g}this.isAdmin&&(c={isAdmin:!0})}return t.generateToken(r?h:e,r?null:p,c).then(g=>{this.token=g.token,this.expires=g.expires!=null?Number(g.expires):null,this.creationTime=Date.now(),this.validity=g.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}f?.refreshToken()}}refreshServerTokens(){if(this.scope==="portal"){const t=Jr;t.credentials.forEach(e=>{const i=t.findServerInfo(e.server),r=i?.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&e.scope==="server"&&(t._hasSameServerInstance(this.server,r)||t._isIdProvider(r,this.server))&&(VW(i,t._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=Jr,i=this.server?e.findServerInfo(this.server):null,r=i?.owningSystemUrl,s=r?e.findServerInfo(r):null;t===!1||r&&this.scope!=="portal"&&(!s?.webTierAuth||e.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=Jr,e=t.credentials.indexOf(this);e>-1&&t.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=K5({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};d([m()],zs.prototype,"creationTime",void 0),d([m()],zs.prototype,"expires",void 0),d([m()],zs.prototype,"isAdmin",void 0),d([m()],zs.prototype,"oAuthState",void 0),d([m()],zs.prototype,"resources",void 0),d([m()],zs.prototype,"scope",void 0),d([m()],zs.prototype,"server",void 0),d([m()],zs.prototype,"ssl",void 0),d([m()],zs.prototype,"token",void 0),d([m()],zs.prototype,"tokenRefreshBuffer",void 0),d([m()],zs.prototype,"userId",void 0),d([m()],zs.prototype,"validity",void 0),zs=d([U("esri.identity.Credential")],zs);class PRe extends MRe{}PRe.prototype.declaredClass="esri.identity.IdentityManager";const yw=new PRe;OIe(yw);const HAt=Object.freeze(Object.defineProperty({__proto__:null,default:yw},Symbol.toStringTag,{value:"Module"}));var qAt=Object.defineProperty,WAt=Object.getOwnPropertyDescriptor,TK=(t,e,i,r)=>{for(var s=r>1?void 0:r?WAt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&qAt(e,i,s),s};const ORe=new BW({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:`${document.location.origin}${document.location.pathname}oauth-callback-api.html`});yw.registerOAuthInfos([ORe]);window.setOAuthResponseHash=t=>{yw.setOAuthResponseHash(t)};let IR=class extends Pe{constructor(){super(),yw.on("credential-create",t=>{const e=new Ea;e.authMode="immediate",e.load().then(()=>{this.user=e.user})})}get authenticated(){return!!this.user}signIn(){yw.getCredential(ORe.portalUrl+"/sharing",{oAuthPopupConfirmation:!1})}signOut(){yw.destroyCredentials(),this.user=null}};TK([m()],IR.prototype,"authenticated",1);TK([m()],IR.prototype,"user",2);IR=TK([U("arcgis-core-template.UserStore")],IR);const YAt=IR;console.log(`Using ArcGIS Maps SDK for JavaScript v${uk}`);console.log({UserStore:YAt});const XAt=new URLSearchParams(document.location.search.slice(1)),ZAt=XAt.get("webscene")||"5bc5aaa31c284830afd90ae51b38686e",cF=new tVe({portalItem:{id:ZAt}}),$P=new GAt({container:"viewDiv",map:cF});window.view=$P;const RRe=Zje.fromJSON({spatialReference:{latestWkid:3857,wkid:102100},components:[{faces:[8,9,10,8,10,11],material:{colorTexture:{data:{type:"video-element",src:"./Shot_02_1080.mp4",autoplay:!1,loop:!1,muted:!1,crossOrigin:"anonymous",preload:"none"},wrap:"repeat"},alphaMode:"auto",alphaCutoff:.5,doubleSided:!0},shading:"source"},{faces:[0,1,2,0,2,3,4,5,6,4,6,7,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],material:{color:[40,20,20,255],alphaMode:"auto",alphaCutoff:.5,doubleSided:!0},shading:"source"}],vertexSpace:{type:"local",origin:[950184.2042933014,6004001337255693e-9,420]},transform:{translation:[0,0,0],rotationAxis:[0,0,1],rotationAngle:250,scale:[11/6,1.5,1.5]},vertexAttributes:{position:[-8,-.5,0,8,-.5,0,8,-.5,11,-8,-.5,11,8,-.5,0,8,.5,0,8,.5,11,8,-.5,11,8,.5,0,-8,.5,0,-8,.5,11,8,.5,11,-8,.5,0,-8,-.5,0,-8,-.5,11,-8,.5,11,-8,-.5,11,8,-.5,11,8,.5,11,-8,.5,11,-8,.5,0,8,.5,0,8,-.5,0,-8,-.5,0],uv:[0,.625,.25,.625,.25,.375,0,.375,.25,.625,.5,.625,.5,.375,.25,.375,0,1,1,1,1,0,0,0,.75,.625,1,.625,1,.375,.75,.375,0,.375,.25,.375,.25,.125,0,.125,0,.875,.25,.875,.25,.625,0,.625],normal:[0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]}}),$Re=RRe.components[0].material.colorTexture.data;console.log({video:$Re});const $de=new OHe({graphics:[new X_({geometry:RRe,symbol:new sE({symbolLayers:[new _v({material:{color:"white"}})]})})]});$P.when(async()=>{try{await cF.loadAll()}catch{}cF.add($de),$P.on("click",async e=>{const{results:i}=await $P.hitTest(e);for(const r of i)r.layer===$de&&$Re.play()});const t=cF.presentation.slides;window.onkeydown=e=>{const i=Number.parseInt(e.key);0<i&&i<=t.length&&t.getItemAt(i-1).applyTo($P)}});export{zwt as $,Cf as A,Pbt as B,G5 as C,n5 as D,cOe as E,Lit as F,uSt as G,gSt as H,_St as I,bSt as J,jst as K,Kst as L,sSt as M,ZJ as N,fK as O,TSt as P,vOe as Q,CSt as R,UYe as S,xOe as T,ASt as U,yTt as V,Ywe as W,KXe as X,hnt as Y,ynt as Z,sPe as _,Dwe as a,il as a$,Uwt as a0,cK as a1,Bwt as a2,xlt as a3,b5 as a4,Mz as a5,l2t as a6,DOe as a7,S2t as a8,POe as a9,hx as aA,SX as aB,RX as aC,kze as aD,QMt as aE,Hs as aF,gRt as aG,Vl as aH,l6t as aI,DZ as aJ,qn as aK,le as aL,zl as aM,z_ as aN,_Gt as aO,cX as aP,lt as aQ,he as aR,Ji as aS,dm as aT,se as aU,E7 as aV,C8t as aW,X_ as aX,w1t as aY,qi as aZ,Tm as a_,h2t as aa,Lpt as ab,nft as ac,i0t as ad,w0t as ae,J0t as af,m0t as ag,Xg as ah,Ki as ai,d as aj,m as ak,mv as al,U as am,ZY as an,Oe as ao,vte as ap,Pe as aq,bye as ar,Xt as as,W as at,a0 as au,Yi as av,Tw as aw,ue as ax,yt as ay,_i as az,ZXe as b,ip as b$,fp as b0,bw as b1,kk as b2,Ea as b3,Jr as b4,nE as b5,et as b6,zf as b7,fX as b8,O0e as b9,Gge as bA,uOt as bB,hOt as bC,nOt as bD,UO as bE,BY as bF,tl as bG,ZW as bH,dp as bI,cOt as bJ,dj as bK,qPt as bL,QFe as bM,o$ as bN,XR as bO,Xe as bP,xk as bQ,JC as bR,Qi as bS,We as bT,iN as bU,BRt as bV,Ut as bW,Gi as bX,XRt as bY,_Rt as bZ,XMt as b_,Ake as ba,ox as bb,oE as bc,Et as bd,uO as be,sn as bf,I5t as bg,L5t as bh,yrt as bi,Mi as bj,_0 as bk,Qre as bl,r4t as bm,bzt as bn,Ul as bo,tOt as bp,Nge as bq,No as br,dn as bs,kX as bt,Yt as bu,Te as bv,Gt as bw,q6 as bx,Lde as by,t5e as bz,vxe as c,iC as c$,C0e as c0,gIe as c1,KY as c2,Dw as c3,PHe as c4,KK as c5,n3t as c6,Nde as c7,YR as c8,Ot as c9,Me as cA,$w as cB,ge as cC,rp as cD,Kye as cE,Qye as cF,YPt as cG,Ic as cH,dWe as cI,NPt as cJ,zRt as cK,M5e as cL,Hge as cM,iOt as cN,gOt as cO,p5e as cP,ZF as cQ,XF as cR,ZPt as cS,rOt as cT,LO as cU,ls as cV,wze as cW,Xf as cX,mHe as cY,gHe as cZ,Vze as c_,rW as ca,zO as cb,ek as cc,cLe as cd,Cn as ce,uLe as cf,hLe as cg,dLe as ch,FIt as ci,CX as cj,lPt as ck,cPt as cl,aOt as cm,lOt as cn,FPt as co,o4e as cp,W_ as cq,zPt as cr,UPt as cs,kPt as ct,K_t as cu,fu as cv,Ko as cw,Do as cx,Zbe as cy,Tk as cz,YZe as d,Ud as d$,HRt as d0,s6t as d1,ZCt as d2,E8t as d3,XQ as d4,vi as d5,e$ as d6,Ls as d7,yo as d8,Ti as d9,QO as dA,B$t as dB,j$t as dC,zve as dD,Yzt as dE,Kke as dF,JIe as dG,Yg as dH,s5t as dI,zte as dJ,HY as dK,Jf as dL,vr as dM,eD as dN,pn as dO,YC as dP,UOt as dQ,S5t as dR,Vt as dS,O_ as dT,Mu as dU,DPt as dV,m3t as dW,cp as dX,J2 as dY,Qb as dZ,kd as d_,HR as da,rvt as db,zke as dc,At as dd,Lze as de,D5 as df,w1e as dg,kt as dh,cpe as di,ik as dj,aX as dk,tC as dl,VO as dm,cze as dn,b_ as dp,xu as dq,lke as dr,RO as ds,cke as dt,Zk as du,vm as dv,ZMt as dw,MIe as dx,VOt as dy,Zje as dz,NJe as e,nv as e$,RDe as e0,WLe as e1,H7e as e2,vw as e3,D_ as e4,Rf as e5,Cd as e6,ZX as e7,v6e as e8,it as e9,IF as eA,Iye as eB,Jke as eC,ev as eD,Bf as eE,Nh as eF,Lo as eG,Gn as eH,zd as eI,POt as eJ,T$t as eK,mJ as eL,fx as eM,CVt as eN,Se as eO,ae as eP,ns as eQ,Lye as eR,Ui as eS,_e as eT,M$t as eU,a$ as eV,x$t as eW,pe as eX,ie as eY,me as eZ,d3t as e_,wn as ea,ive as eb,mu as ec,XPt as ed,c5e as ee,yNt as ef,gR as eg,_Nt as eh,Or as ei,_o as ej,pp as ek,Ke as el,fe as em,te as en,C as eo,qO as ep,Zzt as eq,wt as er,lE as es,cC as et,bv as eu,sl as ev,vj as ew,Bs as ex,_j as ey,wj as ez,WJe as f,yfe as f$,Fr as f0,UU as f1,Cp as f2,Ce as f3,ki as f4,n1e as f5,ho as f6,y2 as f7,Ch as f8,XS as f9,Ze as fA,xe as fB,Tv as fC,SVt as fD,xt as fE,_k as fF,KOe as fG,$8t as fH,I8t as fI,D8t as fJ,REt as fK,bEt as fL,Ec as fM,sMt as fN,hdt as fO,ddt as fP,pdt as fQ,Jjt as fR,kTt as fS,MTt as fT,WPe as fU,Kjt as fV,zTt as fW,KZe as fX,xDt as fY,kq as fZ,JO as f_,UC as fa,ODt as fb,cw as fc,nZe as fd,Yn as fe,YLt as ff,qLt as fg,WLt as fh,O as fi,wQ as fj,c3t as fk,ult as fl,hlt as fm,LC as fn,Tc as fo,Drt as fp,a5 as fq,ze as fr,Y9 as fs,mQ as ft,hr as fu,Fce as fv,xs as fw,ux as fx,E0 as fy,rn as fz,Nnt as g,KUe as g$,IX as g0,oOt as g1,Eot as g2,Aot as g3,RY as g4,J2e as g5,_5t as g6,y5t as g7,c0 as g8,FC as g9,kRt as gA,sr as gB,am as gC,WW as gD,R8t as gE,N8t as gF,PMt as gG,Bdt as gH,SD as gI,K5e as gJ,Pn as gK,tUe as gL,j_ as gM,t$t as gN,Dve as gO,Nve as gP,dOt as gQ,GR as gR,BR as gS,THe as gT,SHe as gU,nl as gV,xm as gW,t$ as gX,cx as gY,nze as gZ,sze as g_,Rc as ga,i5e as gb,fOt as gc,e5e as gd,pOt as ge,jd as gf,CDe as gg,Ja as gh,iD as gi,v5t as gj,cot as gk,DA as gl,rbe as gm,jr as gn,D9 as go,$_ as gp,uc as gq,Gl as gr,yc as gs,gMt as gt,vIe as gu,ac as gv,fY as gw,H$e as gx,i$ as gy,gme as gz,NZe as h,vF as h$,Mpe as h0,$te as h1,r$t as h2,bX as h3,RS as h4,Jze as h5,ea as h6,Ve as h7,bfe as h8,Yfe as h9,g8 as hA,Jte as hB,yRt as hC,Hze as hD,Zte as hE,gBe as hF,Kte as hG,Q_t as hH,evt as hI,_w as hJ,CUe as hK,MVt as hL,sY as hM,bF as hN,_zt as hO,EO as hP,T0 as hQ,$c as hR,HQ as hS,NMe as hT,FA as hU,DP as hV,b$t as hW,Ga as hX,YMt as hY,ePt as hZ,pBe as h_,Xfe as ha,yi as hb,$Vt as hc,PVt as hd,RVt as he,_F as hf,Lw as hg,f3t as hh,fee as hi,Rr as hj,R_ as hk,Aze as hl,Jb as hm,Lj as hn,OHe as ho,Id as hp,cr as hq,XC as hr,qRt as hs,Jye as ht,QAt as hu,Hte as hv,s0 as hw,H6 as hx,YRt as hy,qze as hz,lCe as i,eme as i$,NR as i0,VMt as i1,Y3e as i2,mo as i3,Mg as i4,i$t as i5,O3e as i6,Ta as i7,Il as i8,MDt as i9,Is as iA,EY as iB,L9e as iC,E8e as iD,l8 as iE,pm as iF,PX as iG,_ze as iH,gs as iI,re as iJ,uM as iK,tw as iL,ji as iM,hB as iN,t4t as iO,e4t as iP,wVt as iQ,_4 as iR,hv as iS,P$ as iT,On as iU,mx as iV,bi as iW,gC as iX,HGe as iY,WX as iZ,yr as i_,bk as ia,jn as ib,os as ic,Nk as id,wr as ie,un as ig,u0 as ih,qr as ii,fv as ij,hi as ik,ln as il,$j as im,Kr as io,Io as ip,er as iq,Sst as ir,HW as is,qW as it,eMt as iu,KAt as iv,qs as iw,pst as ix,Mn as iy,Tst as iz,HCe as j,cm as j$,sYe as j0,fC as j1,zxe as j2,uPt as j3,hn as j4,ba as j5,AGe as j6,xa as j7,O$t as j8,sJe as j9,put as jA,fUt as jB,_P as jC,xG as jD,ndt as jE,cb as jF,URt as jG,jye as jH,VRt as jI,GRt as jJ,fBe as jK,Rze as jL,qP as jM,Cj as jN,KMt as jO,PO as jP,h0 as jQ,Y$t as jR,V$t as jS,WPt as jT,Iw as jU,DOt as jV,_Me as jW,kLe as jX,OPt as jY,vc as jZ,SIe as j_,gr as ja,$d as jb,q_ as jc,x1t as jd,G3t as je,rk as jf,F7e as jg,Pee as jh,MS as ji,f8 as jj,l5t as jk,lot as jl,Boe as jm,vRt as jn,n5t as jo,wu as jp,DUt as jq,I7 as jr,L7 as js,Ws as jt,Zd as ju,l3t as jv,L8e as jw,xw as jx,wMe as jy,m$t as jz,ict as k,wRt as k$,KW as k0,GEe as k1,AQ as k2,VEe as k3,ok as k4,ofe as k5,Au as k6,G_ as k7,v3e as k8,KVt as k9,ez as kA,D0 as kB,qt as kC,ym as kD,pv as kE,Ov as kF,rz as kG,Fl as kH,kQ as kI,ye as kJ,uw as kK,Kg as kL,tz as kM,ift as kN,WZ as kO,bE as kP,at as kQ,nU as kR,NFt as kS,Pit as kT,MJ as kU,h4 as kV,w$t as kW,uE as kX,zF as kY,bC as kZ,vu as k_,tvt as ka,m5t as kb,Pi as kc,Dl as kd,Sa as ke,x as kf,Ks as kg,Im as kh,ct as ki,Ue as kj,Qe as kk,Rm as kl,s5 as km,V as kn,Oi as ko,Ru as kp,Ee as kq,B as kr,Er as ks,Ni as kt,Fi as ku,Lt as kv,L0 as kw,kU as kx,Pv as ky,Oc as kz,fat as l,N_e as l$,U_e as l0,OLe as l1,q2 as l2,h5t as l3,F_t as l4,y$ as l5,_m as l6,rve as l7,tR as l8,r0e as l9,E_ as lA,Os as lB,MZ as lC,FVt as lD,rN as lE,CF as lF,en as lG,$ye as lH,xte as lI,MPt as lJ,eC as lK,zOt as lL,nMt as lM,s$ as lN,WRt as lO,JW as lP,Nw as lQ,aS as lR,ti as lS,jRt as lT,ipe as lU,zse as lV,vAe as lW,wAe as lX,d4 as lY,XP as lZ,_O as l_,Jo as la,or as lb,C$t as lc,CGe as ld,tn as le,fCe as lf,Rv as lg,n$ as lh,Ezt as li,Y7 as lj,f5 as lk,ws as ll,q$e as lm,Yve as ln,XW as lo,s4 as lp,iJ as lq,tr as lr,Xd as ls,es as lt,fye as lu,ot as lv,ar as lw,dvt as lx,Ne as ly,Y8e as lz,Jw as m,wSe as m$,cmt as m0,zw as m1,N6e as m2,d0 as m3,bve as m4,k6e as m5,Fft as m6,$u as m7,G6e as m8,j6e as m9,c$ as mA,dx as mB,Aa as mC,oC as mD,sVe as mE,Qr as mF,dTt as mG,Bn as mH,Djt as mI,Jg as mJ,Vkt as mK,pve as mL,hU as mM,cU as mN,_me as mO,vX as mP,QY as mQ,aRt as mR,bme as mS,KOt as mT,Ert as mU,lRt as mV,uRt as mW,Kzt as mX,Xke as mY,JUt as mZ,XFt as m_,Uft as ma,Lft as mb,Dft as mc,gp as md,H6e as me,Ma as mf,kft as mg,h$ as mh,lU as mi,Xn as mj,F6e as mk,Nft as ml,uU as mm,Lh as mn,gx as mo,_2 as mp,uT as mq,ui as mr,mr as ms,O$ as mt,UVt as mu,F8t as mv,EAt as mw,k8t as mx,ya as my,vfe as mz,SXe as n,rMt as n$,LJ as n0,ZFt as n1,JFt as n2,jR as n3,yk as n4,Vz as n5,rX as n6,r4 as n7,vze as n8,bze as n9,Uht as nA,T6e as nB,An as nC,sOt as nD,KPt as nE,QK as nF,$0 as nG,UR as nH,gf as nI,yx as nJ,mNt as nK,m0 as nL,fr as nM,fZ as nN,Bl as nO,jX as nP,W0e as nQ,Ai as nR,Cu as nS,Rzt as nT,O8t as nU,L as nV,rPt as nW,Vg as nX,L8t as nY,tv as nZ,ts as n_,Yte as na,b1t as nb,RRt as nc,IRt as nd,$Rt as ne,$h as nf,AVt as ng,Zg as nh,Pa as ni,$r as nj,ut as nk,Pt as nl,Zt as nm,ur as nn,Bw as no,Tt as np,JCt as nq,hPt as nr,nYe as ns,Ppe as nt,OMt as nu,Eje as nv,q$t as nw,W$t as nx,X8e as ny,BO as nz,gwt as o,N_t as o$,$pe as o0,FMt as o1,NMt as o2,w5t as o3,b5t as o4,S3e as o5,T3e as o6,kde as o7,BRe as o8,SPt as o9,ja as oA,PZ as oB,cR as oC,XIt as oD,GIt as oE,E9 as oF,HIt as oG,xme as oH,wPt as oI,Mge as oJ,YP as oK,E6e as oL,gh as oM,ci as oN,xPt as oO,mk as oP,xOt as oQ,bm as oR,JMt as oS,Ape as oT,b5e as oU,z$t as oV,U$t as oW,OVt as oX,JDt as oY,KDt as oZ,Vxe as o_,oRt as oa,u5t as ob,_Se as oc,JPt as od,QPt as oe,eOt as of,Ok as og,mOt as oh,aot as oi,sv as oj,wHe as ok,xHe as ol,c1e as om,d8e as on,XCt as oo,Ol as op,Yke as oq,kBe as or,QDt as os,Ei as ot,Ac as ou,cs as ov,Av as ow,Ev as ox,WIt as oy,T7e as oz,eJ as p,rl as p$,D_t as p0,xSe as p1,XO as p2,ADt as p3,hC as p4,brt as p5,Gde as p6,x0 as p7,Kpe as p8,ck as p9,KO as pA,nC as pB,MOt as pC,det as pD,mZ as pE,X0e as pF,sC as pG,B_e as pH,g8e as pI,Xr as pJ,TU as pK,rse as pL,Ih as pM,jVe as pN,xGe as pO,jse as pP,EJe as pQ,qIt as pR,RDt as pS,$Dt as pT,CJe as pU,PDt as pV,P_ as pW,jIt as pX,jPt as pY,tPt as pZ,u6e as p_,WMt as pa,_fe as pb,nee as pc,w0e as pd,Cm as pe,$$ as pf,Rt as pg,Gr as ph,Ar as pi,Pm as pj,Lc as pk,lr as pl,Hi as pm,ol as pn,ra as po,Cc as pp,di as pq,xr as pr,Dxe as ps,tJ as pt,a3t as pu,Cit as pv,Ou as pw,i8e as px,Fo as py,sse as pz,ZTt as q,iX as q$,br as q0,YFt as q1,pZ as q2,AOt as q3,Wn as q4,u3t as q5,m4 as q6,EPt as q7,VQ as q8,Sm as q9,xU as qA,CPt as qB,ise as qC,TVt as qD,EVt as qE,dt as qF,VVe as qG,Jk as qH,rVe as qI,Uf as qJ,$Ve as qK,NOt as qL,q5e as qM,V4 as qN,BOt as qO,FFt as qP,mxe as qQ,c2e as qR,Eu as qS,Oj as qT,Ep as qU,Mv as qV,zn as qW,vp as qX,k_ as qY,Zr as qZ,f0e as q_,MX as qa,K_e as qb,wp as qc,PC as qd,Ro as qe,iz as qf,XB as qg,jSe as qh,rSe as qi,PJ as qj,qd as qk,FOt as ql,YIt as qm,FJ as qn,F_e as qo,lR as qp,Rw as qq,h3t as qr,Sz as qs,S4 as qt,k_t as qu,Blt as qv,BVt as qw,I_t as qx,GVt as qy,VVt as qz,tOe as r,mMt as r$,Ik as r0,IVt as r1,FBe as r2,_Vt as r3,kf as r4,K7 as r5,Wbe as r6,RM as r7,Y_e as r8,E$t as r9,VLe as rA,Z2e as rB,_Y as rC,gPt as rD,VCe as rE,Ylt as rF,nk as rG,wc as rH,YW as rI,Zfe as rJ,Nke as rK,xUe as rL,Y0e as rM,WO as rN,o1e as rO,Qte as rP,Z_ as rQ,gIt as rR,LGe as rS,mb as rT,vWe as rU,Xut as rV,HPt as rW,Ale as rX,rx as rY,Y_ as rZ,t$e as r_,Afe as ra,A$t as rb,S$t as rc,SGe as rd,iv as re,NF as rf,Qf as rg,ta as rh,n0e as ri,T5t as rj,zoe as rk,C5t as rl,g5t as rm,W2e as rn,X2e as ro,H2e as rp,pk as rq,rD as rr,Goe as rs,Dot as rt,r5t as ru,fme as rv,PPt as rw,zfe as rx,vPt as ry,DLe as rz,KTt as s,lzt as s$,t2e as s0,YJ as s1,xXe as s2,uAe as s3,afe as s4,b1e as s5,O7 as s6,Xzt as s7,Vw as s8,D8e as s9,Npt as sA,Xw as sB,nX as sC,Yde as sD,FRe as sE,TDe as sF,Ure as sG,DVt as sH,vL as sI,bCe as sJ,LRt as sK,SDt as sL,pC as sM,rE as sN,pu as sO,eCe as sP,tCe as sQ,s4t as sR,L_ as sS,nzt as sT,VIt as sU,v$ as sV,vYe as sW,Od as sX,Sue as sY,uzt as sZ,azt as s_,S4t as sa,az as sb,eRt as sc,zR as sd,MMt as se,uR as sf,Cw as sg,Q_ as sh,KFt as si,exe as sj,sbe as sk,oVe as sl,DO as sm,C_ as sn,S8e as so,Kwe as sp,gMe as sq,fvt as sr,vue as ss,Fde as st,GW as su,Bxe as sv,aPt as sw,oPt as sx,bQe as sy,vlt as sz,JPe as t,aMt as t$,czt as t0,mW as t1,od as t2,Fd as t3,ma as t4,tzt as t5,KGt as t6,MQ as t7,B5 as t8,KUt as t9,zi as tA,mw as tB,qPe as tC,zJ as tD,FCe as tE,TTt as tF,jTt as tG,Coe as tH,Tz as tI,yst as tJ,jjt as tK,EW as tL,AW as tM,dT as tN,Gmt as tO,cyt as tP,qnt as tQ,jnt as tR,SYe as tS,H4t as tT,j4t as tU,g0 as tV,M5t as tW,uo as tX,Zo as tY,WVt as tZ,$o as t_,izt as ta,jEe as tb,ezt as tc,dc as td,fc as te,yW as tf,z5 as tg,_W as th,gW as ti,szt as tj,Vct as tk,ozt as tl,but as tm,Qkt as tn,Cue as to,qZe as tp,WZe as tq,zh as tr,DC as ts,s2e as tt,v4t as tu,em as tv,_4t as tw,Ss as tx,Hjt as ty,y0 as tz,hxe as u,NUt as u$,hu as u0,f5t as u1,Xte as u2,a5t as u3,Jrt as u4,Dk as u5,Jzt as u6,aE as u7,uyt as u8,js as u9,Vst as uA,tu as uB,$m as uC,Om as uD,Sr as uE,Qg as uF,_ot as uG,px as uH,t4 as uI,gzt as uJ,Yot as uK,yzt as uL,iCe as uM,hMt as uN,rRt as uO,sRt as uP,nRt as uQ,ep as uR,dC as uS,lDe as uT,Kk as uU,xRt as uV,FF as uW,gk as uX,zGt as uY,i6t as uZ,Qvt as u_,Eyt as ua,V_e as ub,ove as uc,Uw as ud,S0 as ue,VX as uf,I_ as ug,tU as uh,X_e as ui,P$t as uj,P6e as uk,_Pt as ul,n1t as um,WDe as un,iPt as uo,d5t as up,APt as uq,iMt as ur,v6t as us,TPt as ut,yWe as uu,p5t as uv,gc as uw,lx as ux,_v as uy,AMt as uz,FXe as v,is as v$,bp as v0,kUt as v1,bPt as v2,g_ as v3,C2e as v4,nW as v5,Mf as v6,FUt as v7,m_ as v8,G1t as v9,R$t as vA,kF as vB,b_e as vC,P8e as vD,up as vE,Y2 as vF,x8e as vG,wZ as vH,nve as vI,TRt as vJ,mRt as vK,iRt as vL,A6e as vM,wGe as vN,NU as vO,J_ as vP,oze as vQ,oYe as vR,B2 as vS,fPt as vT,_We as vU,x$e as vV,l4e as vW,BPt as vX,WC as vY,q$ as vZ,Oz as v_,j1t as va,kot as vb,Not as vc,Fot as vd,R5t as ve,ga as vf,Qzt as vg,cRt as vh,YRe as vi,hRt as vj,MAe as vk,_Ye as vl,Yb as vm,hWe as vn,e0e as vo,lm as vp,DMt as vq,eee as vr,u5e as vs,dPt as vt,pPt as vu,kA as vv,w3t as vw,bMe as vx,go as vy,R6e as vz,Hwe as w,NIt as w$,om as w0,v3t as w1,_3t as w2,Zqe as w3,Xqe as w4,fzt as w5,J5 as w6,g5e as w7,WWe as w8,nEt as w9,yPt as wA,YLe as wB,Mfe as wC,LIt as wD,UIt as wE,kIt as wF,zIt as wG,Rfe as wH,BIt as wI,tNt as wJ,wQe as wK,b3e as wL,LMt as wM,lLe as wN,sPt as wO,nPt as wP,oEt as wQ,qg as wR,O_t as wS,P_t as wT,h$e as wU,dMt as wV,R_t as wW,kOt as wX,vk as wY,$_t as wZ,eNt as w_,d5e as wa,QF as wb,e4 as wc,oMt as wd,um as we,U8t as wf,Ere as wg,vzt as wh,mzt as wi,JY as wj,T5e as wk,S5e as wl,NAt as wm,S8t as wn,fLe as wo,Tf as wp,Ipt as wq,$pt as wr,dfe as ws,hfe as wt,xj as wu,VPt as wv,Ofe as ww,pLe as wx,Lht as wy,RVe as wz,QPe as x,FRt as x$,BX as x0,pzt as x1,Cr as x2,f$t as x3,iGe as x4,Sc as x5,s8e as x6,TQe as x7,yDe as x8,g6e as x9,JAt as xA,Eht as xB,mUt as xC,qUt as xD,WUt as xE,GUt as xF,VUt as xG,IUt as xH,LUt as xI,lMt as xJ,Vae as xK,$ht as xL,Lge as xM,Crt as xN,Lrt as xO,W5e as xP,bht as xQ,E5t as xR,YV as xS,XV as xT,yY as xU,BUt as xV,Nle as xW,MK as xX,x5t as xY,BHe as xZ,DRt as x_,y6e as xa,DIt as xb,xVt as xc,QUt as xd,jUt as xe,HUt as xf,Gd as xg,Jht as xh,NEe as xi,tdt as xj,kht as xk,Nht as xl,e3t as xm,$Ut as xn,hzt as xo,Cht as xp,Tut as xq,Rn as xr,qR as xs,Ah as xt,qf as xu,zUt as xv,UUt as xw,rzt as xx,Di as xy,rCt as xz,KP as y,k$t as y0,$5t as y1,Wzt as y2,YTt as z};
