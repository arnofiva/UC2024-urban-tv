import{cx as O,k0 as _,mR as T,at as l,ax as q,bl as P,mS as J,mT as U,b4 as g,bZ as Q,aj as a,ak as u,az as R,bW as w,am as M,cA as D,mU as j,lG as Z,mV as k,mW as z,mX as C,mY as H,mZ as W,m_ as X,m$ as Y,n0 as K,n1 as ee,n2 as te,cC as F,aL as re}from"./index-b9c5f9ae.js";import{r as ne}from"./featureQueryAll-129e8c41.js";import{p as oe}from"./jsonUtils-a21420ee.js";import{A as ie}from"./UniqueValueRenderer-7b7c2094.js";import{c as ae,d as G}from"./RelationshipQuery-cee87a2d.js";const Pe=new O({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Se(e,t,n,r){const o=await m(e);if(await $(e,t,r),!o.addAttachment)throw new l(r,"Layer source does not support addAttachment capability");return o.addAttachment(t,n)}function $(e,t,n){const{attributes:r}=t,{objectIdField:o}=e;return e.capabilities?.data?.supportsAttachment?t?r?o&&r[o]?Promise.resolve():Promise.reject(new l(n,`feature is missing the identifying attribute ${o}`)):Promise.reject(new l(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new l(n,"A feature is required to add/delete/update attachments")):Promise.reject(new l(n,"this layer doesn't support attachments"))}async function Le(e,t,n,r,o){const i=await m(e);if(await $(e,t,o),!i.updateAttachment)throw new l(o,"Layer source does not support updateAttachment capability");return i.updateAttachment(t,n,r)}async function Ee(e,t,n){const{applyEdits:r}=await q(()=>import("./editingSupport-936813b5.js"),["./editingSupport-936813b5.js","./index-b9c5f9ae.js","./index-e15ba190.css","./normalizeUtils-512dfd53.js","./normalizeUtilsCommon-050bf0c4.js","./EditBusLayer-a507ef76.js"],import.meta.url),o=await e.load();let i=n;return o.type==="feature"&&o.infoFor3D&&t.deleteFeatures!=null&&o.globalIdField!=null&&(i={...i,globalIdToObjectId:await le(o,t.deleteFeatures,o.globalIdField)}),r(o,o.source,t,n)}async function Ie(e,t,n){const{uploadAssets:r}=await q(()=>import("./editingSupport-936813b5.js"),["./editingSupport-936813b5.js","./index-b9c5f9ae.js","./index-e15ba190.css","./normalizeUtils-512dfd53.js","./normalizeUtilsCommon-050bf0c4.js","./EditBusLayer-a507ef76.js"],import.meta.url),o=await e.load();return r(o,o.source,t,n)}async function $e(e,t,n,r){const o=await m(e);if(await $(e,t,r),!o.deleteAttachments)throw new l(r,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(t,n)}async function Ae(e,t,n){const r=(await e.load({signal:t?.signal})).source;if(!r.fetchRecomputedExtents)throw new l(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function je(e,t,n,r){t=ae.from(t),await e.load();const o=e.source,i=e.capabilities;if(!i?.data?.supportsAttachment)throw new l(r,"this layer doesn't support attachments");const{attachmentTypes:p,objectIds:f,globalIds:h,num:c,size:d,start:y,where:A}=t;if(!i?.operations?.supportsQueryAttachments&&(p?.length>0||h?.length>0||d?.length>0||c||y||A))throw new l(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(f?.length||h?.length||A))throw new l(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!o.queryAttachments)throw new l(r,"Layer source does not support queryAttachments capability",t);return o.queryAttachments(t)}async function Ce(e,t,n,r){const o=await m(e);if(!o.queryObjectIds)throw new l(r,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(P.from(t)??e.createQuery(),n)}async function Fe(e,t,n,r){const o=await m(e);if(!o.queryFeatureCount)throw new l(r,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(P.from(t)??e.createQuery(),n)}async function Oe(e,t,n,r){const o=await m(e);if(!o.queryExtent)throw new l(r,"Layer source does not support queryExtent capability");return o.queryExtent(P.from(t)??e.createQuery(),n)}async function qe(e,t,n,r){const o=await m(e);if(!o.queryRelatedFeatures)throw new l(r,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(G.from(t),n)}async function Re(e,t,n,r){const o=await m(e);if(!o.queryRelatedFeaturesCount)throw new l(r,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(G.from(t),n)}async function Me(e){const t=e.source;if(t?.refresh)try{const{dataChanged:n,updates:r}=await t.refresh();if(r!=null&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),n)return!0}catch{}if(e.definitionExpression)try{return(await J(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function De(e){const t=new P,n=e.capabilities?.data,r=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),n.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:o,timeExtent:i}=e;return t.timeExtent=o!=null&&i!=null?i.offset(-o.value,o.unit):i||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function Ge(e){const{globalIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Ne(e){const{objectIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function Ve(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}function Be(e,t){const{subtypes:n,subtypeField:r}=e;if(!t||!n?.length||!r)return null;const o=t.attributes[r];return o==null?null:n.find(i=>i.code===o)}async function m(e){return(await e.load()).source}async function se(e,t){if(!g||g.findCredential(e))return;let n;try{const r=await Q(e,t);r&&(n=await g.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=t!=null?t.signal:null;await g.getCredential(e,{signal:r})}catch{}}async function _e(e,t,n){const r=e.parsedUrl?.path;r&&e.authenticationTriggerEvent===t&&await se(r,n)}function Te(e){return!ue(e)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const S=_({types:T});function Je(e,t){if(e.defaultSymbol)return e.types?.length?new ie({defaultSymbol:S(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:S(n.symbol,n,t)}))}):new oe({symbol:S(e.defaultSymbol,e,t)})}function Ue(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;const n=e.editingInfo?.lastEditDate?.getTime();return n==null||(t*=1e3,Date.now()-n<t)}async function le(e,t,n){if(t==null)return null;const r=[],{objectIdField:o}=e;if(t.forEach(c=>{let d=null;if("attributes"in c){const{attributes:y}=c;d={globalId:y[n],objectId:y[o]!=null&&y[o]!==-1?y[o]:null}}else d={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};d.globalId!=null&&(d.objectId!=null&&d.objectId!==-1||r.push(d.globalId))}),r.length===0)return null;const i=e.createQuery();i.where=r.map(c=>`${n}='${c}'`).join(" OR "),i.returnGeometry=!1,i.outFields=[o,n],i.cacheHint=!1;const p=await U(ne(e,i));if(!p.ok)return null;const f=new Map,h=p.value.features;for(const c of h){const d=c.attributes[n],y=c.attributes[o];d!=null&&y!=null&&y!==-1&&f.set(d,y)}return f}function Qe(e,t,n){if(!t||!n||!e)return null;const r=n.getAttribute(t);return r==null?null:e.find(o=>{const{id:i}=o;return i!=null&&i.toString()===r.toString()})??null}function ue(e){return e.sourceJSON?.isMultiServicesView||ce(e)}function ce(e){return!!e.sourceJSON?.capabilities?.toLowerCase().split(",").map(t=>t.trim()).includes("map")}var E;let b=E=class extends D{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?j(t.value):e}writeExpression(e,t,n){this.value!=null&&(e=j(this.value)),e!=null&&(t[n]=e)}clone(){return new E({expression:this.expression,title:this.title,value:this.value})}};a([u({type:String,json:{write:{writerEnsuresNonNull:!0}}})],b.prototype,"expression",void 0),a([R("expression",["expression","value"])],b.prototype,"readExpression",null),a([w("expression")],b.prototype,"writeExpression",null),a([u({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"title",void 0),a([u({json:{read:!1,write:!1}})],b.prototype,"value",void 0),b=E=a([M("esri.layers.support.LabelExpressionInfo")],b);const N=b;var I;const v=new O({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function x(e,t,n){return{enabled:!H(n?.layer)}}function V(e){return!e||e.origin!=="service"&&e.layer?.type!=="map-image"}function pe(e){return e?.type==="map-image"}function B(e){return!!pe(e)&&!!e.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function de(e){return V(e)||B(e?.layer)}let s=I=class extends D{static evaluateWhere(e,t){const n=(r,o,i)=>{switch(o){case"=":return r==i;case"<>":return r!=i;case">":return r>i;case">=":return r>=i;case"<":return r<i;case"<=":return r<=i}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return n(t[r[0]],r[1],r[2]);if(r.length===7){const o=n(t[r[0]],r[1],r[2]),i=r[3],p=n(t[r[4]],r[5],r[6]);switch(i){case"AND":return o&&p;case"OR":return o||p}}return!1}catch{}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=W,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,t){const n=t.labelExpressionInfo;if(!n||!n.value&&!n.expression)return e}writeLabelExpression(e,t,n){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=X(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Y(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[n]=e)}writeLabelExpressionInfo(e,t,n,r){if(e==null&&this.labelExpression!=null&&V(r))e=new N({expression:this.getLabelExpressionArcade()});else if(!e)return;const o=e.toJSON(r);o.expression&&(t[n]=o)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return K(this)}getLabelExpressionArcade(){return ee(this)}getLabelExpressionSingleField(){return te(this)}hash(){return JSON.stringify(this)}clone(){return new I({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:F(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:F(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};a([u({type:String,json:{write:!0}})],s.prototype,"name",void 0),a([u({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:x}}}}})],s.prototype,"allowOverrun",void 0),a([u({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:x}}}}})],s.prototype,"deconflictionStrategy",void 0),a([u({type:String,json:{write:{overridePolicy(e,t,n){return this.labelExpressionInfo&&n?.origin==="service"&&B(n.layer)?{enabled:!1}:{allowNull:!0}}}}})],s.prototype,"labelExpression",void 0),a([R("labelExpression")],s.prototype,"readLabelExpression",null),a([w("labelExpression")],s.prototype,"writeLabelExpression",null),a([u({type:N,json:{write:{overridePolicy:(e,t,n)=>de(n)?{allowNull:!0}:{enabled:!1}}}})],s.prototype,"labelExpressionInfo",void 0),a([w("labelExpressionInfo")],s.prototype,"writeLabelExpressionInfo",null),a([u({type:v.apiValues,json:{type:v.jsonValues,read:v.read,write:v.write}})],s.prototype,"labelPlacement",void 0),a([u({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],s.prototype,"labelPosition",void 0),a([u({type:Number})],s.prototype,"maxScale",void 0),a([w("maxScale")],s.prototype,"writeMaxScale",null),a([u({type:Number})],s.prototype,"minScale",void 0),a([w("minScale")],s.prototype,"writeMinScale",null),a([u({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:x}}}}})],s.prototype,"repeatLabel",void 0),a([u({type:Number,cast:Z,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:x}}}}})],s.prototype,"repeatLabelDistance",void 0),a([u({types:k,json:{origins:{"web-scene":{types:z,write:C,default:null}},write:C,default:null}})],s.prototype,"symbol",void 0),a([u({type:Boolean,json:{write:!0}})],s.prototype,"useCodedValues",void 0),a([u({type:String,json:{write:!0}})],s.prototype,"where",void 0),s=I=a([M("esri.layers.support.LabelClass")],s);const ye=s,L=()=>re.getLogger("esri.layers.support.labelingInfo"),fe=/\[([^[\]]+)\]/gi;function Ze(e,t,n){return e?e.map(r=>{const o=new ye;if(o.read(r,n),o.labelExpression){const i=t.fields||t.layerDefinition?.fields||this.fields;o.labelExpression=o.labelExpression.replaceAll(fe,(p,f)=>`[${be(f,i)}]`)}return o}):null}function be(e,t){if(!t)return e;const n=e.toLowerCase();for(let r=0;r<t.length;r++){const o=t[r].name;if(o.toLowerCase()===n)return o}return e}const me={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function ke(e,t){const n=[];for(const r of e){const o=r.labelPlacement,i=me[t];if(!r.symbol)return L().warn("No ILabelClass symbol specified."),[];if(!i)return L().error(new l("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),[];if(i.includes(o))n.push(r);else{const p=i[0];o&&L().warn(`Found invalid label placement type ${o} for ${t}. Defaulting to ${p}`);const f=r.clone();f.labelPlacement=p,n.push(f)}}return n}export{Fe as A,ye as C,Me as E,Ce as F,Ae as I,le as J,Be as L,Ne as M,Qe as N,Oe as O,qe as P,Ge as R,Re as S,_e as T,Je as U,Ue as V,ue as Z,ke as a,Ee as b,Ve as c,Ie as g,$e as j,Ze as l,Se as m,je as q,Te as v,Le as w,De as x,Pe as y};
