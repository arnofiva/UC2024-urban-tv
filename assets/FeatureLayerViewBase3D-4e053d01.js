import{aO as B,bT as N,cy as U,aX as z,k6 as V,aj as a,ak as o,am as F,aq as M,o5 as J,ay as P,d5 as Y,ob as k,ao as E,aR as q,aN as b,oc as K,ai as T,aZ as $,aM as W,d8 as D,bq as A,ed as Q,aL as C,bl as j,dK as X,nD as Z,od as ee,nE as G,oe as te,of as re,nz as v,og as I,at as O,oh as se,oi as ie,aY as ae}from"./index-b9c5f9ae.js";import{b as oe,C as ne,T as le,u as ue}from"./Graphics3DGraphicsPipeline-b3952dd1.js";import{l as ce}from"./LayerView3D-2a51d3a6.js";import{E as pe,c as de}from"./query-3a4c8fa9.js";import{h as he}from"./WorkerHandle-8f3c3e4b.js";import{h as ye}from"./EventedSet-c6899c49.js";import{w as me}from"./FeatureEffect-72786df8.js";import{d as fe}from"./FeatureFilter-cd09ce2a.js";import{o as H}from"./floorFilterUtils-73949d2d.js";import{p as S,n as ge}from"./popupUtils-a16b4cb5.js";import{y as Fe}from"./LayerView-fa457db7.js";import{i as we}from"./RefreshableLayerView-355ffb88.js";class be extends B{constructor(t,e,r,i,n,c){super(t.usedMemory,t.displayedFeatures,t.totalFeatures,t.maximumFeatures,t.nodes,t.core),this.storedFeatures=e,this.totalVertices=r,this.partial=i,this.mode=n,this.symbolComplexity=c}}class _e{constructor(t){this._controller=t,this._handle=new ve(e=>t.schedule(e))}destroy(){this._handle.destroy()}invoke(t,e){return t.buffer&&t.buffer.byteLength!==0?(t.options.sourceSpatialReference&&t.options.sourceSpatialReference instanceof N&&(t.options={...t.options,sourceSpatialReference:t.options.sourceSpatialReference.toJSON()}),this._handle.invoke(t,e).then(r=>{let i=0,n=0;const c=N.fromJSON(r.spatialReference);r.spatialReference=c;const p=async u=>{const l=r.fields;if(l){for(;i<l.length;)if(l[i]=U.fromJSON(l[i]),i++,u.madeProgress())return this._controller.reschedule(h=>p(h))}const f=r.features;for(;n<f.length;){const h=f[n];++n,h.uid=z.generateUID();const d=h.geometry;if(d!=null&&(d.spatialReference=c,xe(d),u.madeProgress()))return this._controller.reschedule(w=>p(w))}return r};return this._controller.schedule(u=>p(u))})):Promise.resolve(null)}}function xe(s){switch(s.type){case"polyline":s.paths.reduce((t,e)=>t+e.length,0)<V&&(s.paths=s.hasZ||s.hasM?s.paths.map(t=>t.map(e=>[e[0],e[1],e[2]])):s.paths.map(t=>t.map(e=>[e[0],e[1]])));break;case"polygon":s.rings.reduce((t,e)=>t+e.length,0)<V&&(s.rings=s.hasZ||s.hasM?s.rings.map(t=>t.map(e=>[e[0],e[1],e[2]])):s.rings.map(t=>t.map(e=>[e[0],e[1]])))}}class ve extends he{constructor(t){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:e=>[e.buffer]},t)}}let g=class extends M{constructor(s){super(s)}get implicitFields(){if(!this.layer.outFields?.includes("*"))return new Set;const t=new Set(this.layerView.requiredFields),e=new Set(this.layerView.availableFields);return J(e,t)}get queryFeaturesDehydrated(){const{layer:s}=this,t=s.capabilities,e=t&&t.query,r=e&&e.supportsFormatPBF,i=s.parsedUrl;if(r){this._decoder==null&&(this._decoder=new _e(this.controller));const n={sourceSpatialReference:s.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:L};return(c,p)=>pe(i,c,"pbf",this._createRequestOptions(p)).then(u=>(P(p),this._decoder!=null?this._decoder.invoke({buffer:u.data,options:n},p.signal):Promise.reject(Y())))}return(n,c)=>de(i,n,s.spatialReference,this._createRequestOptions(c)).then(p=>k(p.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:L}))}queryFeatureCount(s,t){return this.layer.queryFeatureCount(s,t)}destroy(){this._decoder=E(this._decoder)}_createRequestOptions(s){return{...s,query:{...this.layer.customParameters,token:this.layer.apiKey,...s?.query}}}};a([o({constructOnly:!0})],g.prototype,"layer",void 0),a([o({constructOnly:!0})],g.prototype,"layerView",void 0),a([o({constructOnly:!0})],g.prototype,"controller",void 0),a([o({readOnly:!0})],g.prototype,"implicitFields",null),a([o({readOnly:!0})],g.prototype,"queryFeaturesDehydrated",null),g=a([F("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],g);let _=class extends M{constructor(s){super(s)}queryFeaturesDehydrated(s,t){return this.layer.queryFeatures(s,t)}queryFeatureCount(s,t){return this.layer.queryFeatureCount(s,t)}};a([o({constructOnly:!0})],_.prototype,"layer",void 0),a([o({readOnly:!0})],_.prototype,"queryFeaturesDehydrated",null),_=a([F("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],_);let R=class extends M{constructor(s){super(s)}queryFeaturesDehydrated(s,t){return this.layer.queryFeatures(s,t)}};a([o({constructOnly:!0})],R.prototype,"layer",void 0),R=a([F("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],R);let x=class extends M{constructor(s){super(s)}queryFeaturesDehydrated(s,t){return this.source.queryFeaturesJSON(s,t).then(k,e=>{if(e&&e.name==="query-features-json:unsupported")return this.layer.queryFeatures(s,t);throw e})}queryFeatureCount(s,t){return this.layer.queryFeatureCount(s,t)}};function Pe(s,t){const{layer:e}=s;return e.type==="feature"&&e.source.type==="feature-layer"||e.type==="catalog-footprint"?"infoFor3D"in e&&e.infoFor3D!=null?new _({layer:e}):new g({layer:e,layerView:s,controller:t}):e.type==="feature"&&e.source.type==="memory"||e.type==="csv"||e.type==="geojson"||e.type==="oriented-imagery"||e.type==="wfs"?new x({layer:e,source:e.source}):e.type==="ogc-feature"?new R({layer:e}):null}a([o({constructOnly:!0})],x.prototype,"layer",void 0),a([o({constructOnly:!0})],x.prototype,"source",void 0),x=a([F("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],x);const L=1024;class Oe{constructor(t){this._memoryCache=null,this._capabilities=null;const e=t.layerView.layer;this._layerView=t.layerView,this.objectIdField=e.objectIdField,this.globalIdField="globalIdField"in e?e.globalIdField:null,this._returnZ=t.returnZ,this._returnM=t.returnM;const r=this._layerView.view.resourceController;this.query=Pe(this._layerView,r.normal),r&&this._memoryCacheEnabled&&(this._memoryCache=r.memoryController.newCache(`fl-${e.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"geojson":case"memory":case"wfs":return!1}}destroy(){this._memoryCache=E(this._memoryCache),this.query.destroy()}createQuery(){const t=this._layerView.layer.createQuery();return t.outFields=this._layerView.availableFields,t.returnZ=this._returnZ,t.returnM=this._returnM,t.outSpatialReference=this.tilingScheme.spatialReference,t}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){const t=this._layerView.view.resourceController;return t?t.scheduler:null}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return this._capabilities!=null||(this._capabilities=oe(this._layerView.layer)),this._capabilities}logFetchError(t,e){t.error("#fetchTile()",this._layerView.layer,e?.message??e)}}let y=class extends ne{constructor(t){super(t),this._controllerTotal=0,this._processorTotal=0,this._needsRefresh=!1,this.suspendResumeExtentMode="data"}initialize(){this.addHandles(q(()=>({controller:this.controller,suspended:this.suspended}),({controller:t,suspended:e})=>{t&&!e&&this._needsRefresh&&(t.refetch(),this._needsRefresh=!1)}))}destroy(){this._fetcherContext=E(this._fetcherContext)}get maximumNumberOfFeatures(){return this.controller?.maximumNumberOfFeatures??this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(t){this._set("maximumNumberOfFeatures",t),this.controller&&(this.controller.maximumNumberOfFeatures=t)}get maximumNumberOfFeaturesExceeded(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}get updatingProgressValue(){let t=0;if(this.controller?.updating){const r=this.controller.updatingRemaining,i=Math.max(this.controller.updatingTotal,this._controllerTotal);i>0&&(t=(i-r)/i,this._controllerTotal=i)}let e=0;if(this.processor?.updating){const r=this.processor.updatingRemaining,i=Math.max(r,this._processorTotal);i>0&&(e=(i-r)/i,this._processorTotal=i)}return .5*(t+e)}get updatePolicy(){if(!this.controller)return b.ASYNC;switch(this.controller.mode){case"snapshot":{const t=Re.get(this.layer.geometryType);return t==null||this.controller.serviceDataCount>t?b.ASYNC:b.SYNC}case"tiles":return b.ASYNC}}get usedMemory(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)}get unloadedMemory(){const t=this.processor?.unprocessedMemoryEstimate??0,e=this.controller?.expectedFeatureDiff??0,r=this.processor?.loadedFeatures??0,i=r+e>0?r/(r+e):1;return t+e*(this.processor?.usedMemoryPerFeature??0)*i}get ignoresMemoryFactor(){return this.controller?.hasMaximumNumberOfFeaturesOverride}get performanceInfo(){const t=this.controller?.displayFeatureLimit,e=t?.averageSymbolComplexity,r=e!=null?`f:${e.verticesPerFeature},v:${e.verticesPerCoordinate}`:"n/a";return new be(super.performanceInfo,this.controller?.performanceInfo?.storedFeatures??0,this.controller?.performanceInfo?.totalVertices??0,this.maximumNumberOfFeaturesExceeded,this.controller?.mode??"n/a",r)}async doRefresh(t){const{controller:e,processor:r,suspended:i}=this;t&&e&&(i?this._needsRefresh=!0:(e.refetch(),this._needsRefresh=!1)),r.refreshFilter()}setVisibility(t,e){this.processor?.setObjectIdVisibility(t,e)}getMissingAttributesForFeature(t){return this.controller.getMissingAttributesForFeature(t)}getHydratedGeometry(t){const e=this.graphics3DProcessor;if(e==null)return null;const r=e.graphics3DGraphicsByObjectID;if(r==null)return null;const i=r.get(t);return i==null?null:K(i.graphic.geometry)}createController(){this._fetcherContext=new Oe({layerView:this.layerView,returnZ:this.hasZ,returnM:this.hasM});const t=new le({layerView:this.layerView,context:this._fetcherContext,graphics:new ye,extent:this.clippingExtent});return this.updatingHandles.add(()=>t.serviceDataExtent,e=>{this.processor&&(this.processor.dataExtent=e)},T),this.addHandles(q(()=>this.suspended&&this.layerView.updateSuspended,e=>{e?t.suspend():t.resume()},$)),this.updatingHandles.add(()=>this.processor?.displayFeatureLimit,e=>t.displayFeatureLimit=e,T),this.addHandles(W(()=>!this.updating,()=>{this._controllerTotal=0,this._processorTotal=0})),t}beforeSetController(t){t.maximumNumberOfFeatures=this.maximumNumberOfFeatures}get test(){return{controller:this.controller,graphics3DProcessor:this.graphics3DProcessor,heatmapProcessor:this.heatmapProcessor,loadedGraphics:this.loadedGraphics}}};a([o()],y.prototype,"layerView",void 0),a([o()],y.prototype,"controller",void 0),a([o()],y.prototype,"_controllerTotal",void 0),a([o()],y.prototype,"_processorTotal",void 0),a([o()],y.prototype,"_needsRefresh",void 0),a([o()],y.prototype,"maximumNumberOfFeatures",null),a([o()],y.prototype,"maximumNumberOfFeaturesExceeded",null),a([o()],y.prototype,"updatingProgressValue",null),a([o()],y.prototype,"updatePolicy",null),a([o()],y.prototype,"suspendResumeExtentMode",void 0),y=a([F("esri.views.3d.layers.graphics.FeatureGraphics3DGraphicsPipeline")],y);const Re=new Map([["point",5e3],["polygon",500],["polyline",1e3]]),qe=s=>{let t=class extends s{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.dataUpdating=!1,this.filter=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){this.addHandles([q(()=>{const e=this.layer;return[e&&"elevationInfo"in e?e.elevationInfo?.featureExpressionInfo:null,e&&"displayField"in e?e.displayField:null,e&&"timeInfo"in e&&e.timeInfo,e&&"renderer"in e&&e.renderer,e&&"labelingInfo"in e&&e.labelingInfo,e&&"floorInfo"in e&&e.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),$),D(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),D(()=>{const e=this.layer;return e&&"sublayers"in e?e.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:r},requiredFields:i}=this;return"outFields"in e&&e.outFields?A(r,[...Q(r,e.outFields),...i]):A(r,i)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){C.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},r=this.filter!=null?this.filter.createQuery(e):new j(e);if("floorInfo"in this.layer&&this.layer.floorInfo){const i=H(this);i!=null&&(r.where=r.where?`(${r.where}) AND (${i})`:i)}return this.timeExtent!=null&&(r.timeExtent=r.timeExtent!=null?r.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),r}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new j(e)}queryFeatures(e,r){throw new Error("missing implementation")}queryObjectIds(e,r){throw new Error("missing implementation")}queryFeatureCount(e,r){throw new Error("missing implementation")}queryExtent(e,r){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,r){return this._validateFetchPopupFeatures(e,r),this._fetchPopupFeatures(e,r)}_loadArcadeModules(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some(r=>r.type==="expression")?X():Promise.resolve()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then(()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e=this.view.type==="3d",{layer:r,layer:{fieldsIndex:i,objectIdField:n}}=this,c="renderer"in r&&r.renderer,p="orderBy"in r&&r.orderBy,u="featureReduction"in r?r.featureReduction:null,l=new Set,f=await Promise.allSettled([c?c.collectRequiredFields(l,i):null,Z(l,r),e&&"elevationInfo"in r?ee(l,r):null,this.filter!=null?G(l,r,this.filter):null,e||this.featureEffect==null?null:G(l,r,this.featureEffect.filter),!e&&u?te(l,r,u):null,!e&&p?re(l,r,p):null]);if("timeInfo"in r&&r.timeInfo&&this.timeExtent&&v(l,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"floorInfo"in r&&r.floorInfo&&v(l,r.fieldsIndex,[r.floorInfo.floorField]),r.type==="feature"&&e&&r.infoFor3D!=null&&(r.globalIdField==null&&C.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),v(l,r.fieldsIndex,[r.globalIdField])),r.type==="subtype-group"){I(l,i,r.subtypeField);const d=r.sublayers.map(w=>Promise.all([w.renderer?.collectRequiredFields(l,i),Z(l,w)]));await Promise.allSettled(d)}if(r.type==="catalog-footprint"&&r.parent){const d=r.parent;v(l,i,[d.itemNameField,d.itemSourceField,d.itemTypeField,d.maxScaleField,d.minScaleField])}for(const d of f)d.status==="rejected"&&C.getLogger(this).error(d.reason);I(l,i,n),e&&"displayField"in r&&r.displayField&&I(l,i,r.displayField);const h=Array.from(l).sort();this._set("requiredFields",h)}_validateFetchPopupFeatures(e,r){if(r!=null)for(const i of e){const n=i.origin&&"layer"in i.origin?i.origin.layer:i.layer;if("popupEnabled"in n&&!n.popupEnabled)throw new O("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:n});if(i.isAggregate){const c="featureReduction"in n?n.featureReduction:null;if(!(c&&"popupTemplate"in c&&c.popupEnabled&&c.popupTemplate))throw new O("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:n})}else if("popupTemplate"in n&&!S(n,r))throw new O("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:n})}}_popupFeatureHasRequiredFields(e,r){return se(r,e)}async _fetchPopupFeatures(e,r){const i=new Array(e.length),n=new Map,c=await this._createPopupQuery(e.map(p=>p.origin?.layer??p.layer),r);for(let p=0;p<e.length;p++){const u=e[p];if(u.isAggregate){i[p]=u;continue}const l=u.origin?.layer??u.layer;if(!l||!("popupEnabled"in l))continue;const f=Q(this.layer.fieldsIndex,c.outFields),h=S(l,r);if(h==null)continue;const d=await this._loadArcadeModules(h);P(r),d&&d.arcadeUtils.hasGeometryOperations(h)||!this._popupFeatureHasRequiredFields(u,f)?n.set(u.getObjectId(),{graphic:u,index:p}):i[p]=u}if(this.layer.type==="stream"||n.size===0)return i.filter(Boolean);c.objectIds=Array.from(n.keys());try{const p=await this.layer.queryFeatures(c,r);for(const u of p.features){const{graphic:{geometry:l,origin:f},index:h}=n.get(u.getObjectId());u.geometry||(u.geometry=l),u.origin=f,i[h]=u}}catch{}return i.filter(Boolean)}async _createPopupQuery(e,r){const i=this.layer.createQuery(),n=new Set;let c=!1;const p=e??[this.layer];for(const u of p){if(!("popupEnabled"in u))continue;const l=S(u,r);if(l==null)continue;const f=await this._loadArcadeModules(l);P(r);const h=f&&f.arcadeUtils.hasGeometryOperations(l);c=!(this.layer.geometryType!=="point"&&!h);const d=await ge(this.layer,l);P(r);for(const w of d)n.add(w)}if(i.returnGeometry=c,i.returnZ=c,i.returnM=c,i.outFields=Array.from(n),i.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo){const u=H(this);u!=null&&(i.where=i.where?`(${i.where}) AND (${u})`:u)}return i}canResume(){return!!super.canResume()&&(this.timeExtent==null||!this.timeExtent.isEmpty)}getTest(){}get test(){}};return a([o()],t.prototype,"_updatingRequiredFieldsPromise",void 0),a([o({readOnly:!0})],t.prototype,"availableFields",null),a([o({readOnly:!0})],t.prototype,"dataUpdating",void 0),a([o({type:me})],t.prototype,"featureEffect",null),a([o({type:fe})],t.prototype,"filter",void 0),a([o()],t.prototype,"layer",void 0),a([o({type:Number})],t.prototype,"maximumNumberOfFeatures",null),a([o({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),a([o({readOnly:!0})],t.prototype,"requiredFields",void 0),a([o()],t.prototype,"suspended",void 0),a([o()],t.prototype,"view",void 0),t=a([F("esri.views.layers.FeatureLayerView")],t),t};let m=class extends we(ue(qe(ce(Fe)))){constructor(s){super(s)}initialize(){this.addHandles(q(()=>this._updatingRequiredFieldsPromise,s=>this._updatingHandles.addPromise(s),$))}destroy(){this._updatingHandles.removeAll(),this._fetcherContext=E(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(s){this.graphicsPipeline.maximumNumberOfFeatures=s}get maximumNumberOfFeaturesExceeded(){return this.graphicsPipeline!=null&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){return this.graphicsPipeline?.updatingProgressValue??0}get updatePolicy(){return this.graphicsPipeline?.updatePolicy??b.ASYNC}get hasZ(){const s=this.layer,t=s.capabilities&&s.capabilities.data;return!(!t||!t.supportsZ)&&("returnZ"in s&&s.returnZ!=null?s.returnZ:t.supportsZ)}get hasM(){const s=this.layer,t=s.capabilities&&s.capabilities.data;return!(!t||!t.supportsM)&&"returnM"in s&&s.returnM!=null&&s.returnM}setVisibility(s,t){this.graphicsPipeline?.setVisibility(s,t)}createQuery(){return super.createQuery()}queryFeatures(s,t){const e=()=>super.queryFeatures(s,t);return this.layer.geometryType==="mesh"?this._queryFeaturesMesh(this._ensureQuery(s),e):e()}createGraphicsPipeline(){return new y({layerView:this})}async doRefresh(s){return await this.graphicsPipeline.doRefresh(s)}_popupFeatureHasRequiredFields(s,t){if(!super._popupFeatureHasRequiredFields(s,t))return!1;const e=ie(s,this.layer.objectIdField);if(e==null)return!0;const r=this.graphicsPipeline.getMissingAttributesForFeature(e);if(r==null)return!0;for(const i of t)if(r.has(i))return!1;return!0}get usedMemory(){return this.graphicsPipeline?.usedMemory??0}get unloadedMemory(){return this.graphicsPipeline?.unloadedMemory??0}get ignoresMemoryFactor(){return this.graphicsPipeline?.ignoresMemoryFactor??!1}async _queryFeaturesMesh(s,t){await this._validateQueryFeaturesMesh(s);const e=await t(),r=this.graphicsPipeline;if(s?.outStatistics||r==null)return e;const i=this.layer.objectIdField,n=[];for(const c of e.features)if(c.geometry){const p=r.getHydratedGeometry(c.attributes[i]);p&&(c.geometry=p,n.push(c))}else n.push(c);return e.features=n,e}async _validateQueryFeaturesMesh(s){if(!s)return;const t=r=>{throw new O("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${r}'`)},e=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const r of e)s[r]!=null&&t(r);"returnM"in s&&s.returnM&&t("returnM"),"returnCentroid"in s&&s.returnCentroid&&t("returnCentroid"),s.outSpatialReference==null||s.outSpatialReference.equals(this.view.spatialReference)||t("outSpatialReference")}get test(){}};a([o()],m.prototype,"layer",void 0),a([o()],m.prototype,"graphicsPipeline",void 0),a([o()],m.prototype,"maximumNumberOfFeatures",null),a([o()],m.prototype,"maximumNumberOfFeaturesExceeded",null),a([o(ae)],m.prototype,"updatingProgress",void 0),a([o({readOnly:!0})],m.prototype,"updatingProgressValue",null),a([o({readOnly:!0})],m.prototype,"updatePolicy",null),a([o({readOnly:!0})],m.prototype,"hasZ",null),a([o({readOnly:!0})],m.prototype,"hasM",null),m=a([F("esri.views.3d.layers.FeatureLayerViewBase3D")],m);const Ze=m;export{Ze as g};
