import{aQ as d,i6 as u,aj as a,ak as h,hq as m,am as p,h0 as v,h$ as y,aL as g}from"./index-cc5260cc.js";import{a as I}from"./layerContainerType-e1118fe6.js";const n=new d,o=new WeakMap;function b(e){$(e)&&n.push(new WeakRef(e))}function w(e){const t=n.find(s=>s.deref()===e);t&&n.remove(t)}function $(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function c(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:c(t,e%t):0}let f=0,i=0;function C(){const e=Date.now();let t=!1;for(const s of n){const r=s.deref();r?r.refreshInterval&&e-(o.get(r)??0)+5>=6e4*r.refreshInterval&&(o.set(r,e),r.refresh(e)):t=!0}if(t)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}u(()=>{const e=Date.now();let t=0;for(const s of n){const r=s.deref();r&&(t=c(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?o.get(r)||o.set(r,e):o.delete(r))}if(t!==i){if(i=t,clearInterval(f),i===0)return void(f=0);f=setInterval(C,i)}});function j(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const l=.1,k=e=>{let t=class extends e{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=v(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||b(this)},()=>{})}destroy(){w(this)}castRefreshInterval(s){return s>=l?s:s<=0?0:l}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){y(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:r})},r=>{g.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return a([h({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:I}}}}})],t.prototype,"refreshInterval",void 0),a([m("refreshInterval")],t.prototype,"castRefreshInterval",null),a([h({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),a([h({readOnly:!0})],t.prototype,"refreshParameters",null),t=a([p("esri.layers.mixins.RefreshableLayer")],t),t};export{k as f,j as m};
