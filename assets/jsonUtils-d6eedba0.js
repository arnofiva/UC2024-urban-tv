import{aj as i,ak as s,cA as N,b6 as f,hj as ue,am as S,gH as pe,bf as ye,rV as de,aL as D,av as Z,dK as ce,at as he,lN as me,rW as ge,cC as n,jC as be,rX as fe,rY as we,rZ as O,bW as Y,hq as ve,r_ as xe,gW as W,b5 as Q,dd as A,cH as L,bo as Se,hr as $e,gY as ee,og as je,lG as te,r$ as _e,dP as Ie,k0 as Ve,b1 as De}from"./index-cc5260cc.js";import{v as F,p as P,j as Pe,n as Ee,A as ie,w as se}from"./UniqueValueRenderer-54c126a1.js";import{Z as Re}from"./FieldsIndex-fc537b48.js";import{a as Ne,e as Ce,c as Te}from"./heatmapUtils-829de23b.js";var H;let C=H=class extends N{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new H({color:this.color&&this.color.clone(),ratio:this.ratio})}};i([s({type:f,json:{type:[ue],default:null,write:!0}})],C.prototype,"color",void 0),i([s({type:Number,json:{write:!0}})],C.prototype,"ratio",void 0),C=H=i([S("esri.renderers.support.HeatmapColorStop")],C);const T=C,K="esri.renderers.support.DictionaryLoader",qe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class re{constructor(t,r,o){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new pe(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=t,this.config=r,this.fieldMap=o}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,r){let o;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{o=await this._dictionaryPromise}catch(u){if(ye(u))return this._dictionaryPromise=null,null}const d=this._dictionaryVersion?.since(4,0),a={};if(this.fieldMap)for(const u of this._symbolFields){const c=de(this.fieldMap[u],this._fieldIndex);if(c){const l=t.attributes[c];a[u]=d?l:l!=null?""+t.attributes[c]:""}else a[u]=""}let p=null;try{p=o?.(a,r)}catch{return null}if(!p||typeof p!="string"||p==="invalid")return null;const $=p.split(";"),_=[],m=[];for(const u of $)if(u)if(u.includes("po:")){const c=u.substr(3).split("|");if(c.length===3){const l=c[0],w=c[1];let g=c[2];if(w==="DashTemplate")g=g.split(" ").map(v=>Number(v));else if(w==="Color"){const v=new f(g).toRgba();g=[v[0],v[1],v[2],255*v[3]]}else g=Number(g);m.push({primitiveName:l,propertyName:w,value:g,defaultValue:null})}}else if(u.includes("|")){for(const c of u.split("|"))if(this._itemNames.has(c)){_.push(c);break}}else this._itemNames.has(u)&&_.push(u);const E=t.geometry==null||!t.geometry.hasZ&&t.geometry.type==="point";return this._cimPartsToCIMSymbol(t,_,m,E,r)}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void D.getLogger(K).error("no valid URL!");const r=Z(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:t!=null?t.signal:null}),[{data:o}]=await Promise.all([r,ce()]);if(!o)throw this._dictionaryPromise=null,new he("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:d,dictionary_version:a,expression:p,itemsNames:$}=o,_=p;let m=!1;a&&(this._dictionaryVersion=me.parse(a),m=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+o.cimRefTemplateUrl,this._itemNames=new Set($),this._symbolFields=d.symbol;const E={};if(this.config){const l=this.config;for(const w in l)E[w]=l[w]}if(d.configuration)for(const l of d.configuration)E.hasOwnProperty(l.name)||(E[l.name]=l.value);const u=[];if(t?.fields&&this.fieldMap)for(const l in this.fieldMap){const w=this.fieldMap[l],g=t.fields.filter(v=>v.name.toLowerCase()===w?.toLowerCase());g.length>0&&u.push({...g[0],type:m?g[0].type:"esriFieldTypeString"})}u.length>0&&(this._fieldIndex=new Re(u));const c=ge(_,t!=null?t.spatialReference:null,u,E).then(l=>{const w={scale:0};return(g,v)=>{if(l==null)return null;const ae=l.repurposeFeature({geometry:null,attributes:g});return w.scale=v!=null?v.scale??void 0:void 0,l.evaluate({$feature:ae,$view:w},l.services)}}).catch(l=>(D.getLogger(K).error("Creating dictionary expression failed:",l),null));return this._dictionaryPromise=c,c}async _cimPartsToCIMSymbol(t,r,o,d,a){const p=new Array(r.length);for(let m=0;m<r.length;m++)p[m]=this._getSymbolPart(r[m],a);let $=await Promise.all(p);const _=this.fieldMap;if(_){$=n($);for(const m of $)be.applyDictionaryTextOverrides(m,t,_,this._fieldIndex,fe(m))}return new we({data:Me($,o,d)})}async _getSymbolPart(t,r){const o=this._symbolCache.get(t);if(o)return o;if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(p=>p.data);const d=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,t),a=Z(d,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(t,a),a.finally(()=>this._ongoingRequests.delete(t));try{const p=await a;return this._symbolCache.put(t,p.data),p.data}catch(p){throw p}}}function Me(e,t,r){if(!e||e.length===0)return null;const o={...e[0]};if(e.length>1){o.symbolLayers=[];for(const d of e){const a=d;o.symbolLayers.unshift(...a.symbolLayers)}}return r&&(o.callout=qe),{type:"CIMSymbolReference",symbol:o,primitiveOverrides:t}}var k;let x=k=class extends F(P){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new re(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,o){o?.origin||super.writeVisualVariables(e,t,r,o)}clone(){return new k({config:n(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:n(this.fieldMap),url:n(this.url),visualVariables:n(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await O(e,t,this.scaleExpression);for(const r in this.fieldMap){const o=this.fieldMap[r];t.has(o)&&e.add(o)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};i([s({type:re})],x.prototype,"_loader",null),i([s({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],x.prototype,"config",void 0),i([s({type:Object,json:{write:!0}})],x.prototype,"fieldMap",void 0),i([s({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],x.prototype,"scaleExpression",void 0),i([Y("scaleExpression")],x.prototype,"writeData",null),i([s({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],x.prototype,"scaleExpressionTitle",void 0),i([s({type:String,json:{write:!0}})],x.prototype,"url",void 0),i([Y("visualVariables")],x.prototype,"writeVisualVariables",null),x=k=i([S("esri.renderers.DictionaryRenderer")],x);const Oe=x;var B;let j=B=class extends N{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(D.getLogger(this).error(".field: field must be a string value"),null):xe(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new B({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};i([s({type:f,json:{type:[Number],write:!0}})],j.prototype,"color",void 0),i([s({type:String,json:{write:!0}})],j.prototype,"field",void 0),i([ve("field")],j.prototype,"castField",null),i([s({type:String,json:{write:!0}})],j.prototype,"label",void 0),i([s({type:String,json:{write:!0}})],j.prototype,"valueExpression",void 0),i([s({type:String,json:{write:!0}})],j.prototype,"valueExpressionTitle",void 0),j=B=i([S("esri.renderers.support.AttributeColorInfo")],j);const oe=j;var z;let q=z=class extends N{constructor(){super(...arguments),this.unit=null}clone(){return new z({unit:this.unit})}};i([s({type:String,json:{write:!0}})],q.prototype,"unit",void 0),q=z=i([S("esri.renderers.support.DotDensityLegendOptions")],q);const Ae=q;var J;let h=J=class extends F(P){constructor(e){super(e),this.attributes=null,this.backgroundColor=new f([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new W,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new Q({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new J({attributes:n(this.attributes),backgroundColor:n(this.backgroundColor),dotBlendingEnabled:n(this.dotBlendingEnabled),dotShape:n(this.dotShape),dotSize:n(this.dotSize),dotValue:n(this.dotValue),legendOptions:n(this.legendOptions),outline:n(this.outline),referenceScale:n(this.referenceScale),seed:n(this.seed),visualVariables:n(this.visualVariables),authoringInfo:n(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(t=>t.field||t.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await O(e,t,r.valueExpression),r.field&&e.add(r.field)}};i([s({type:[oe],json:{write:!0}})],h.prototype,"attributes",void 0),i([s({type:f,json:{write:!0}})],h.prototype,"backgroundColor",void 0),i([s({type:Boolean,json:{write:!0}})],h.prototype,"dotBlendingEnabled",void 0),i([s({type:String,json:{write:!1}})],h.prototype,"dotShape",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"dotSize",void 0),i([s({type:Ae,json:{write:!0}})],h.prototype,"legendOptions",void 0),i([s({type:W,json:{default:null,write:!0}})],h.prototype,"outline",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"dotValue",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"referenceScale",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"seed",void 0),i([A({dotDensity:"dot-density"})],h.prototype,"type",void 0),h=J=i([S("esri.renderers.DotDensityRenderer")],h);const Le=h;let R=class extends L(N){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};i([s({type:String,json:{write:!0}})],R.prototype,"minLabel",void 0),i([s({type:String,json:{write:!0}})],R.prototype,"maxLabel",void 0),i([s({type:String,json:{write:!0}})],R.prototype,"title",void 0),R=i([S("esri.renderers.support.HeatmapLegendOptions")],R);var U;function X(e){if(e!=null){const{maxDensity:t,minDensity:r,radius:o}=e;if(t!=null||r!=null||o!=null){const{blurRadius:d,maxPixelIntensity:a,minPixelIntensity:p,...$}=e;return $}}return e}let y=U=class extends P{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new T({ratio:0,color:new f("rgba(255, 140, 0, 0)")}),new T({ratio:.75,color:new f("rgba(255, 140, 0, 1)")}),new T({ratio:.9,color:new f("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return X(e)}get blurRadius(){return Ne(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",Ce(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Te**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Se(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,$e(()=>{_e(D.getLogger(this),e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=X(e),super.read(e,t)}getSymbol(){return new ee}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,o=this.valueExpression;r&&typeof r=="string"&&je(e,t,r),o&&typeof o=="string"&&await O(e,t,o)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new U({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:n(this.colorStops),field:this.field,legendOptions:n(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};i([s({type:Pe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],y.prototype,"authoringInfo",void 0),i([s({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"blurRadius",null),i([s({type:[T],json:{write:!0}})],y.prototype,"colorStops",void 0),i([s({type:String,json:{write:!0}})],y.prototype,"field",void 0),i([s({type:R,json:{write:!0}})],y.prototype,"legendOptions",void 0),i([s({type:Number,json:{write:!0}})],y.prototype,"maxDensity",void 0),i([s({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"maxPixelIntensity",null),i([s({type:Number,json:{write:!0}})],y.prototype,"minDensity",void 0),i([s({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"minPixelIntensity",null),i([s({type:Number,cast:te,json:{write:!0}})],y.prototype,"radius",void 0),i([s({type:Number,range:{min:0},json:{default:0,write:!0}})],y.prototype,"referenceScale",void 0),i([A({heatmap:"heatmap"})],y.prototype,"type",void 0),i([s({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],y.prototype,"valueExpression",void 0),i([s({type:String})],y.prototype,"valueExpressionTitle",void 0),i([s({readOnly:!0})],y.prototype,"_pixelIntensityToDensity",null),y=U=i([S("esri.renderers.HeatmapRenderer")],y);const ne=y;let V=class extends L(N){constructor(){super(...arguments),this.color=new f([0,0,0,0]),this.label=null,this.threshold=0}};i([s({type:f,json:{write:!0}})],V.prototype,"color",void 0),i([s({type:String,json:{write:!0}})],V.prototype,"label",void 0),i([s({type:Number,range:{min:0,max:1},json:{write:!0}})],V.prototype,"threshold",void 0),V=i([S("esri.renderers.support.OthersCategory")],V);let M=class extends L(N){constructor(){super(...arguments),this.title=null}};i([s({type:String,json:{write:!0}})],M.prototype,"title",void 0),M=i([S("esri.renderers.support.PieChartLegendOptions")],M);let b=class extends F(L(P)){constructor(t){super(t),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new f([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new V,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new ee({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(Ie)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,r)=>t+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,r)=>t+JSON.stringify(r),"")}async collectRequiredFields(t,r){await this.collectVVRequiredFields(t,r);for(const o of this.attributes)o.valueExpression&&await O(t,r,o.valueExpression),o.field&&t.add(o.field)}};i([s({type:[oe],json:{write:!0}})],b.prototype,"attributes",void 0),i([s({type:Q,json:{default:null,write:!0}})],b.prototype,"backgroundFillSymbol",void 0),i([s({type:f,json:{write:!0}})],b.prototype,"defaultColor",void 0),i([s({type:String,json:{write:!0}})],b.prototype,"defaultLabel",void 0),i([s({type:Number,range:{min:0,max:1},json:{write:!0}})],b.prototype,"holePercentage",void 0),i([s({type:V,json:{write:!0}})],b.prototype,"othersCategory",void 0),i([s({type:M,json:{write:!0}})],b.prototype,"legendOptions",void 0),i([s({type:W,json:{default:null,write:!0}})],b.prototype,"outline",void 0),i([s({type:Number,cast:te,json:{write:!0}})],b.prototype,"size",void 0),i([A({pieChart:"pie-chart"})],b.prototype,"type",void 0),b=i([S("esri.renderers.PieChartRenderer")],b);const Fe=b;var G;let I=G=class extends F(P){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new G({description:this.description,label:this.label,symbol:n(this.symbol),visualVariables:n(this.visualVariables),authoringInfo:n(this.authoringInfo)})}};i([s({type:String,json:{write:!0}})],I.prototype,"description",void 0),i([s({type:String,json:{write:!0}})],I.prototype,"label",void 0),i([s(Ee)],I.prototype,"symbol",void 0),i([A({simple:"simple"})],I.prototype,"type",void 0),I=G=i([S("esri.renderers.SimpleRenderer")],I);const le=I,He={key:"type",base:P,typeMap:{heatmap:ne,simple:le,"unique-value":ie,"class-breaks":se,"dot-density":Le,dictionary:Oe,"pie-chart":Fe},errorContext:"renderer"},tt={key:"type",base:P,typeMap:{simple:le,"unique-value":ie,"class-breaks":se,heatmap:ne},errorContext:"renderer",validate:ke};function ke(e){switch(e.type){case"simple":return Be(e);case"unique-value":return ze(e);case"class-breaks":return Je(e);case"heatmap":return e}}function Be(e){if(e.symbol)return e;D.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function ze(e){const t=e.uniqueValueInfos,r=t?.filter(({symbol:o,label:d},a)=>(o||D.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${a}] ${d}) without a symbol from web scene.`),!!o));return r?.length!==t?.length&&(e.uniqueValueInfos=r),e}function Je(e){const t=e.classBreakInfos,r=t?.filter(({symbol:o,label:d},a)=>(o||D.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${a}] ${d}) without a symbol from web scene.`),!!o));return r?.length!==t?.length&&(e.classBreakInfos=r),e}function it(e,t){return Ge(e,null,t)}const Ue=Ve({types:He});function Ge(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(r?.messages&&r.messages.push(new De("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):Ue(e,t,r):null}export{T as l,He as m,Ge as o,le as p,it as t,tt as u};
